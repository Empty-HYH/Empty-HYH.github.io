<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>Spark 面试题解析</title>
      <link href="post/cccf27af.html"/>
      <url>post/cccf27af.html</url>
      
        <content type="html"><![CDATA[<h2 id="Spark-内核"><a href="#Spark-内核" class="headerlink" title="Spark 内核"></a>Spark 内核</h2><h3 id="Spark-的有几种部署模式，每种模式特点？"><a href="#Spark-的有几种部署模式，每种模式特点？" class="headerlink" title="Spark 的有几种部署模式，每种模式特点？"></a>Spark 的有几种部署模式，每种模式特点？</h3><ul><li><strong>本地模式</strong>：Spark 不一定非要跑在 Hadoop 集群，可以在本地，起多个线程的方式来指定。将 Spark 应用以多线程的方式直接运行在本地，一般都是为了方便调试，本地模式分三类：<ul><li><code>local</code>：只启动一个 Executor</li><li><code>local[k]</code>:启动 k 个 Executor</li><li><code>local[*]</code>：启动跟 CPU 数目相同的 Executor</li></ul></li><li><strong>standalone 模式</strong>：分布式部署集群，自带完整的服务，资源管理和任务监控是 Spark 自己监控，这个模式也是其他模式的基础。</li><li><strong>Spark on Yarn 模式</strong>：分布式部署集群，资源和任务监控交给 YARN 管理，但是目前仅支持粗粒度资源分配方式，包含 cluster 和 client 运行模式，cluster 适合生产，Driver 运行在集群子节点，具有容错功能，client 适合调试，Driver 运行在客户端。</li><li><strong>Spark On Mesos 模式</strong>：官方推荐这种模式（当然，原因之一是血缘关系）。正是由于 Spark 开发之初就考虑到支持 Mesos，因此，目前而言，Spark 运行在 Mesos 上会比运行在 YARN 上更加灵活，更加自然。用户可选择两种调度模式之一运行自己的应用程序：<ul><li>粗粒度模式（Coarse-grained Mode）：每个应用程序的运行环境由一个 Driver 和若干个 Executor 组成，其中，每个 Executor 占用若干资源，内部可运行多个 Task（对应多少个“slot”）。应用程序的各个任务正式运行之前，需要将运行环境中的资源全部申请好，且运行过程中要一直占用这些资源，即使不用，最后程序运行结束后，回收这些资源。</li><li>细粒度模式（Fine-grained Mode）：鉴于粗粒度模式会造成大量资源浪费，Spark On Mesos 还提供了另外一种调度模式：细粒度模式，这种模式类似于现在的云计算，思想是按需分配。</li></ul></li></ul><h3 id="Spark-为什么比-MapReduce-快？"><a href="#Spark-为什么比-MapReduce-快？" class="headerlink" title="Spark 为什么比 MapReduce 快？"></a>Spark 为什么比 MapReduce 快？</h3><ul><li>基于内存计算，减少低效的磁盘交互；</li><li>高效的调度算法，基于 DAG；</li><li>容错机制 Lineage，精华部分就是 DAG 和 Lineage。</li></ul><h3 id="简单说一下-Hadoop-和-Spark-的-shuffle-相同和差异？"><a href="#简单说一下-Hadoop-和-Spark-的-shuffle-相同和差异？" class="headerlink" title="简单说一下 Hadoop 和 Spark 的 shuffle 相同和差异？"></a>简单说一下 Hadoop 和 Spark 的 shuffle 相同和差异？</h3><ul><li>从 high-level 的角度来看，两者并没有大的差别。都是将 mapper（Spark 里是 ShuffleMapTask）的输出进行 partition，不同的 partition 送到不同的 reducer（Spark 里 reducer 可能是下一个 stage 里的 ShuffleMapTask，也可能是 ResultTask）。Reducer 以内存作缓冲区，边 shuffle 边 aggregate 数据，等到数据 aggregate 好以后进行 reduce（Spark 里可能是后续的一系列操作）。</li><li>从 low-level 的角度来看，两者差别不小。Hadoop MapReduce 是 sort-based，进入 combine 和 reduce 的 records 必须先 sort。这样的好处在于 combine/reduce 可以处理大规模的数据，因为其输入数据可以通过外排得到（mapper 对每段数据先做排序，reducer 的 shuffle 对排好序的每段数据做归并）。目前的 Spark 默认选择的是 hash-based，通常使用 HashMap 来对 shuffle 来的数据进行 aggregate，不会对数据进行提前排序。如果用户需要经过排序的数据，那么需要自己调用类似 sortByKey 的操作；如果你是 Spark 1.1 的用户，可以将 <code>spark.shuffle.manager</code> 设置为 sort，则会对数据进行排序。在 Spark 1.2 中，sort 将作为默认的 Shuffle 实现。</li><li>从实现角度来看，两者也有不少差别。Hadoop MapReduce 将处理流程划分出明显的几个阶段：map，spill，merge，shuffle，sort，reduce 等。每个阶段各司其职，可以按照过程式的编程思想来逐一实现每个阶段的功能。在 Spark 中，没有这样功能明确的阶段，只有不同的 stage 和一系列的 transformation，所以 spill，merge，aggregate 等操作需要蕴含在 transformation 中。</li></ul><p>如果我们将 map 端划分数据、持久化数据的过程称为 shuffle write，而将 reducer 读入数据、aggregate 数据的过程称为 shuffle read。那么在 Spark 中，问题就变为怎么在 job 的逻辑或者物理执行图中加入 shuffle write 和 shuffle read 的处理逻辑？以及两个处理逻辑应该怎么高效实现？</p><p>shuffle write 由于不要求数据有序，shuffle write 的任务很简单：将数据 partition 好，并持久化。之所以要持久化，一方面是要减少内存存储空间压力，另一方面也是为了 fault-tolerance。</p><h3 id="Spark-工作机制？Spark-应用程序的执行过程？"><a href="#Spark-工作机制？Spark-应用程序的执行过程？" class="headerlink" title="Spark 工作机制？Spark 应用程序的执行过程？"></a>Spark 工作机制？Spark 应用程序的执行过程？</h3><ol><li>构建 Application 的运行环境，Driver 创建一个 SparkContext；</li><li>SparkContext 向资源管理器（Standalone、Mesos、Yarn）申请 Executor 资源，资源管理器启动 StandaloneExecutorBackend（Executor）;</li><li>Executor 向 SparkContext 申请 Task;</li><li>SparkContext 将应用程序分发给 Executor;</li><li>SparkContext 就建成 DAG 图，DAG Scheduler 将 DAG 图解析成 Stage，每个 Stage 有多个 Task，形成 TaskSet 发送给 Task Scheduler，由 Task Scheduler 将 Task 发送给 Executor 运行；</li><li>Task 在 Executor 上运行，运行完释放所有资源。</li></ol><h3 id="Spark-的优化怎么做？"><a href="#Spark-的优化怎么做？" class="headerlink" title="Spark 的优化怎么做？"></a>Spark 的优化怎么做？</h3><p>Spark 调优比较复杂，但是大体可以分为三个方面来进行</p><ul><li>平台层面的调优：防止不必要的 jar 包分发，提高数据的本地性，选择高效的存储格式如 parquet；</li><li>应用程序层面的调优：过滤操作符的优化降低过多小任务，降低单条记录的资源开销，处理数据倾斜，复用 RDD 进行缓存，作业并行化执行等等；</li><li>JVM 层面的调优：设置合适的资源量，设置合理的 JVM，启用高效的序列化方法如 Kyro，增大 off-heap 内存等等；</li></ul><h3 id="数据本地性是在哪个环节确定的？"><a href="#数据本地性是在哪个环节确定的？" class="headerlink" title="数据本地性是在哪个环节确定的？"></a>数据本地性是在哪个环节确定的？</h3><p>具体的 Task 运行在那他机器上，DAG 划分 Stage 的时候确定的。</p><h3 id="RDD-的弹性表现在哪几点？"><a href="#RDD-的弹性表现在哪几点？" class="headerlink" title="RDD 的弹性表现在哪几点？"></a>RDD 的弹性表现在哪几点？</h3><ul><li>自动的进行内存和磁盘的存储切换；</li><li>基于 Lineage 的高效容错；</li><li>Task 如果失败会自动进行特定次数的重试；</li><li>Stage 如果失败会自动进行特定次数的重试，而且只会计算失败的分片；</li><li>checkpoint 和 persist，数据计算之后持久化缓存；</li><li>数据调度弹性，DAG TASK 调度和资源无关；</li><li>数据分片的高度弹性。</li></ul><h3 id="RDD-有哪些缺陷？"><a href="#RDD-有哪些缺陷？" class="headerlink" title="RDD 有哪些缺陷？"></a>RDD 有哪些缺陷？</h3><ul><li>不支持细粒度的写和更新操作（如网络爬虫），Spark 写数据是粗粒度的。所谓粗粒度，就是批量写入数据，为了提高效率。但是读数据是细粒度的也就是说可以一条条的读。</li><li>不支持增量迭代计算，Flink 支持</li></ul><h3 id="Spark-的-shuffle-过程？"><a href="#Spark-的-shuffle-过程？" class="headerlink" title="Spark 的 shuffle 过程？"></a>Spark 的 shuffle 过程？</h3><p>从下面三点去展开</p><ul><li>shuffle 过程的划分</li><li>shuffle 的中间结果如何存储</li><li>shuffle 的数据如何拉取过来</li></ul><h3 id="Spark-的数据本地性有哪几种？"><a href="#Spark-的数据本地性有哪几种？" class="headerlink" title="Spark 的数据本地性有哪几种？"></a>Spark 的数据本地性有哪几种？</h3><p>Spark 中的数据本地性有三种：</p><ul><li>PROCESS_LOCAL 是指读取缓存在本地节点的数据</li><li>NODE_LOCAL 是指读取本地节点硬盘数据</li><li>ANY 是指读取非本地节点数据</li></ul><p>通常读取数据 PROCESS_LOCAL &gt; NODE_LOCAL &gt; ANY，尽量使数据以 PROCESS_LOCAL 或 NODE_LOCAL 方式读取。其中 PROCESS_LOCAL 还和 cache 有关，如果 RDD 经常用的话将该 RDD cache 到内存中，注意，由于 cache 是 lazy 的，所以必须通过一个 action 的触发，才能真正的将该 RDD cache 到内存中。</p><h3 id="Spark-为什么要持久化，一般什么场景下要进行-persist-操作？"><a href="#Spark-为什么要持久化，一般什么场景下要进行-persist-操作？" class="headerlink" title="Spark 为什么要持久化，一般什么场景下要进行 persist 操作？"></a>Spark 为什么要持久化，一般什么场景下要进行 persist 操作？</h3><p>Spark 所有复杂一点的算法都会有 persist 身影，Spark 默认数据放在内存，Spark 很多内容都是放在内存的，非常适合高速迭代，1000 个步骤只有第一个输入数据，中间不产生临时数据，但分布式系统风险很高，所以容易出错，就要容错，RDD 出错或者分片可以根据血统算出来，如果没有对父 RDD 进行 persist 或者 cache 的话，就需要重头做。  以下场景会使用 persist：</p><ul><li>某个步骤计算非常耗时，需要进行 persist 持久化；</li><li>计算链条非常长，重新恢复要算很多步骤；</li><li>checkpoint 所在的 RDD 要持久化 persist。checkpoint 前，要持久化，写个 rdd.cache 或者 rdd.persist，将结果保存起来，再写 checkpoint 操作，这样执行起来会非常快，不需要重新计算 RDD 链条了。checkpoint 之前一定会进行 persist；</li><li>shuffle 之后要 persist，shuffle 要进行网络传输，风险很大，数据丢失重来，恢复代价很大；</li><li>shuffle 之前进行 persist，框架默认将数据持久化到磁盘，这个是框架自动做的。</li></ul><h3 id="介绍一下-join-操作优化经验？"><a href="#介绍一下-join-操作优化经验？" class="headerlink" title="介绍一下 join 操作优化经验？"></a>介绍一下 join 操作优化经验？</h3><p>join其实常见的就分为两类：<strong>map-side join</strong> 和 <strong>reduce-side join</strong>。当大表和小表 join 时，用 map-side join 能显著提高效率。将多份数据进行关联是数据处理过程中非常普遍的用法，不过在分布式计算系统中，这个问题往往会变的非常麻烦，因为框架提供的 join 操作一般会将所有数据根据 key 发送到所有的 reduce 分区中去，也就是 shuffle 的过程。造成大量的网络以及磁盘 IO 消耗，运行效率极其低下，这个过程一般被称为 reduce-side-join。如果其中有张表较小的话，我们则可以自己实现在 map 端实现数据关联，跳过大量数据进行 shuffle 的过程，运行时间得到大量缩短，根据不同数据可能会有几倍到数十倍的性能提升。</p><h3 id="描述Yarn执行一个任务的过程？"><a href="#描述Yarn执行一个任务的过程？" class="headerlink" title="描述Yarn执行一个任务的过程？"></a>描述Yarn执行一个任务的过程？</h3><p><img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="/images/post/bigdata_interview/spark_yarn_workflow.png" alt></p><ol><li>客户端 client 向 ResourceManager 提交 Application，ResourceManager 接受 Application 并根据集群资源状况选取一个 node 来启动 Application 的任务调度器 Driver（ApplicationMaster）。</li><li>ResourceManager 找到那个 node，命令其该 node 上的 nodeManager 来启动一个新的 JVM 进程运行程序的 Driver（ApplicationMaster）部分，Driver（ApplicationMaster）启动时会首先向 ResourceManager 注册，说明由自己来负责当前程序的运行。</li><li>Driver（ApplicationMaster）开始下载相关 jar 包等各种资源，基于下载的 jar 等信息决定向 ResourceManager 申请具体的资源内容。</li><li>ResourceManager 接受到 Driver（ApplicationMaster）提出的申请后，会最大化的满足资源分配请求，并发送资源的元数据信息给 Driver（ApplicationMaster）。</li><li>Driver（ApplicationMaster）收到发过来的资源元数据信息后会根据元数据信息发指令给具体机器上的 NodeManager，让其启动具体的 Container。</li><li>NodeManager 收到 Driver 发来的指令，启动 Container，Container 启动后必须向 Driver（ApplicationMaster）注册。</li><li>Driver（ApplicationMaster）收到 Container 的注册，开始进行任务的调度和计算，直到任务完成。</li></ol><p>注意：如果 ResourceManager 第一次没有能够满足 Driver（ApplicationMaster）的资源请求 ，后续发现有空闲的资源，会主动向Driver（ApplicationMaster）发送可用资源的元数据信息以提供更多的资源用于当前程序的运行。</p><h3 id="Spark-on-Yarn-模式有哪些优点？"><a href="#Spark-on-Yarn-模式有哪些优点？" class="headerlink" title="Spark on Yarn 模式有哪些优点？"></a>Spark on Yarn 模式有哪些优点？</h3><ul><li>与其他计算框架共享集群资源（Spark 框架与 MapReduce 框架同时运行，如果不用 Yarn 进行资源分配，MapReduce 分到的内存资源会很少，效率低下）；资源按需分配，进而提高集群资源利用等。</li><li>相较于 Spark 自带的 Standalone 模式，Yarn 的资源分配更加细致。</li><li>Application 部署简化，例如 Spark，Storm 等多种框架的应用由客户端提交后，由 Yarn 负责资源的管理和调度，利用 Container 作为资源隔离的单位，以它为单位去使用内存、CPU 等。</li><li>Yarn 通过队列的方式，管理同时运行在 Yarn 集群中的多个服务，可根据不同类型的应用程序负载情况，调整对应的资源使用量，实现资源弹性管理。</li></ul><h3 id="谈谈你对-Container-的理解？"><a href="#谈谈你对-Container-的理解？" class="headerlink" title="谈谈你对 Container 的理解？"></a>谈谈你对 Container 的理解？</h3><ul><li>Container 作为资源分配和调度的基本单位，其中封装了的资源如内存，CPU，磁盘，网络带宽等。目前 YARN 仅仅封装内存和 CPU</li><li>Container 由 ApplicationMaster 向 ResourceManager 申请的，由 ResourceManager 中的资源调度器异步分配给 ApplicationMaster</li><li>Container 的运行是由 ApplicationMaster 向资源所在的 NodeManager 发起的，Container 运行时需提供内部执行的任务命令</li></ul><h3 id="Spark-使用-parquet-文件存储格式能带来哪些好处？"><a href="#Spark-使用-parquet-文件存储格式能带来哪些好处？" class="headerlink" title="Spark 使用 parquet 文件存储格式能带来哪些好处？"></a>Spark 使用 parquet 文件存储格式能带来哪些好处？</h3><ul><li>如果说 HDFS 是大数据时代分布式文件系统首选标准，那么 parquet 则是整个大数据时代文件存储格式实时首选标准。</li><li>速度更快：从使用 Spark SQL 操作普通文件 CSV 和 parquet 文件速度对比上看，绝大多数情况会比使用 csv 等普通文件速度提升 10 倍左右，在一些普通文件系统无法在 Spark 上成功运行的情况下，使用 parquet 很多时候可以成功运行。</li><li>parquet 的压缩技术非常稳定出色，在 Spark SQL 中对压缩技术的处理可能无法正常的完成工作（例如会导致 lost task，lost executor）但是此时如果使用 parquet 就可以正常的完成。</li><li>极大的减少磁盘 IO，通常情况下能够减少 75% 的存储空间，由此可以极大的减少 Spark SQL 处理数据的时候的数据输入内容，尤其是在 Spark1.6x 中有个下推过滤器在一些情况下可以极大的减少磁盘的 IO 和内存的占用。</li><li>Spark 1.6x parquet 方式极大的提升了扫描的吞吐量，极大提高了数据的查找速度 Spark1.6x 和Spark1.5x 相比而言，提升了大约 1 倍的速度，在 Spark1.6x 中，操作 parquet 时候 CPU 也进行了极大的优化，有效的降低了 CPU 消耗。</li><li>采用 parquet 可以极大的优化 Spark 的调度和执行。我们测试 Spark 如果用 parquet 可以有效的减少 Stage 的执行消耗，同时可以优化执行路径。</li></ul><h3 id="介绍-partition-和-block-有什么关联关系？"><a href="#介绍-partition-和-block-有什么关联关系？" class="headerlink" title="介绍 partition 和 block 有什么关联关系？"></a>介绍 partition 和 block 有什么关联关系？</h3><ul><li>HDFS 中的 block 是分布式存储的最小单元，等分，可设置冗余，这样设计有一部分磁盘空间的浪费，但是整齐的 block 大小，便于快速找到、读取对应的内容；</li><li>Spark 中的 partition 是弹性分布式数据集 RDD 的最小单元，RDD 是由分布在各个节点上的 partition 组成的。partition 是指的 Spark 在计算过程中，生成的数据在计算空间内最小单元，同一份数据（RDD）的 partition 大小不一，数量不定，是根据 application 里的算子和最初读入的数据分块数量决定；</li><li>block 位于存储空间、partition 位于计算空间，block 的大小是固定的、partition 大小是不固定的，是从 2 个不同的角度去看数据。</li></ul><h3 id="不需要排序的-hash-shuffle-是否一定比需要排序的-sort-shuffle-速度快？"><a href="#不需要排序的-hash-shuffle-是否一定比需要排序的-sort-shuffle-速度快？" class="headerlink" title="不需要排序的 hash shuffle 是否一定比需要排序的 sort shuffle 速度快？"></a>不需要排序的 hash shuffle 是否一定比需要排序的 sort shuffle 速度快？</h3><p>不一定，当数据规模小，hash shuffle 快于 sorted shuffle，数据规模大的时候；当数据量大，sorted shuffle 会比 hash shuffle 快很多，因为数量大的有很多小文件，不均匀，甚至出现数据倾斜，消耗内存大，1.x 之前 Spark 使用 hash，适合处理中小规模，1.x 之后，增加了 sorted shuffle，Spark 更能胜任大规模处理了。</p><h3 id="Sort-based-shuffle-的缺陷？"><a href="#Sort-based-shuffle-的缺陷？" class="headerlink" title="Sort-based shuffle 的缺陷？"></a>Sort-based shuffle 的缺陷？</h3><ul><li>如果 mapper 中 task 的数量过大，依旧会产生很多小文件，此时在 shuffle 传递数据到 reducer 的过程中，reduce 会需要同时大量的记录进行反序列化，导致大量的内存消耗和 GC 的巨大负担，造成系统缓慢甚至崩溃。</li><li>如果需要在分片内也进行排序，此时需要进行 mapper 和 reducer 的两次排序。</li></ul><h3 id="spark-storage-memoryFraction-参数的含义，实际生产中如何调优？"><a href="#spark-storage-memoryFraction-参数的含义，实际生产中如何调优？" class="headerlink" title="spark.storage.memoryFraction 参数的含义，实际生产中如何调优？"></a>spark.storage.memoryFraction 参数的含义，实际生产中如何调优？</h3><ul><li><p>用于设置 RDD 持久化数据在 Executor 内存中能占的比例，默认是 0.6，默认 Executor 60% 的内存，可以用来保存持久化的 RDD 数据。根据你选择的不同的持久化策略，如果内存不够时，可能数据就不会持久化，或者数据会写入磁盘；</p></li><li><p>如果持久化操作比较多，可以提高 <code>spark.storage.memoryFraction</code> 参数，使得更多的持久化数据保存在内存中，提高数据的读取性能，如果 shuffle 的操作比较多，有很多的数据读写操作到 JVM 中，那么应该调小一点，节约出更多的内存给 JVM，避免过多的 JVM GC 发生。在 Web UI 中观察如果发现 GC 时间很长，可以设置 <code>spark.storage.memoryFraction</code> 更小一点。</p></li></ul><h3 id="介绍一下你对-Unified-Memory-Management-内存管理模型的理解？"><a href="#介绍一下你对-Unified-Memory-Management-内存管理模型的理解？" class="headerlink" title="介绍一下你对 Unified Memory Management 内存管理模型的理解？"></a>介绍一下你对 Unified Memory Management 内存管理模型的理解？</h3><p>Spark 中的内存使用分为两部分：执行（execution）与存储（storage）。执行内存主要用于 shuffles、joins、sorts 和 aggregations，存储内存则用于缓存或者跨节点的内部数据传输。1.6 之前，对于一个 Executor，内存都由以下部分构成：</p><ul><li>ExecutionMemory：这片内存区域是为了解决 shuffles，joins，sorts 和 aggregations 过程中为了避免频繁 IO 需要的 buffer。通过 <code>spark.shuffle.memoryFraction</code>（默认 0.2）配置。</li><li>StorageMemory：这片内存区域是为了解决 block cache（就是你显示调用 rdd.cache，rdd.persist 等方法），还有就是 broadcasts 以及 task results 的存储。可以通过参数 <code>spark.storage.memoryFraction</code>（默认 0.6）设置。</li><li>OtherMemory：给系统预留的，因为程序本身运行也是需要内存的（默认为 0.2）。</li></ul><p>传统内存管理的不足：</p><ul><li>Shuffle 占用内存 0.2*0.8，内存分配这么少，可能会将数据 spill 到磁盘，频繁的磁盘 IO 是很大的负担，Storage 内存占用 0.6，主要是为了迭代处理。传统的 Spark 内存分配对操作人的要求非常高。（Shuffle 分配内存：ShuffleMemoryManager，TaskMemoryManager，ExecutorMemoryManager）一个 Task 获得全部的 Execution 的Memory，其他 Task 过来就没有内存了，只能等待；</li><li>默认情况下，Task 在线程中可能会占满整个内存，分片数据特别大的情况下就会出现这种情况，其他 Task 没有内存了，剩下的 cores 就空闲了，这是巨大的浪费。这也是人为操作的不当造成的；</li><li>MEMORY_AND_DISK_SER 的 storage 方式，获得 RDD 的数据是一条条获取，iterator 的方式。如果内存不够（spark.storage.unrollFraction），unroll 的读取数据过程，就是看内存是否足够，如果足够，就下一条。unroll 的 space 是从 Storage 的内存空间中获得的。unroll 的方式失败，就会直接放磁盘；</li><li>默认情况下，Task 在 spill 到磁盘之前，会将部分数据存放到内存上，如果获取不到内存，就不会执行。永无止境的等待，消耗 CPU 和内存；</li></ul><p>​在此基础上，Spark 提出了 UnifiedMemoryManager，不再分 ExecutionMemory 和 Storage Memory，实际上还是分的，只不过是 Execution Memory 访问 Storage Memory，Storage Memory 也可以访问 Execution Memory，如果内存不够，就会去借。</p><h3 id="Spark-有哪两种算子？"><a href="#Spark-有哪两种算子？" class="headerlink" title="Spark 有哪两种算子？"></a>Spark 有哪两种算子？</h3><p>​Transformation（转化）算子和 Action（执行）算子。</p><h3 id="Spark-有哪些聚合类的算子，我们应该尽量避免什么类型的算子？"><a href="#Spark-有哪些聚合类的算子，我们应该尽量避免什么类型的算子？" class="headerlink" title="Spark 有哪些聚合类的算子，我们应该尽量避免什么类型的算子？"></a>Spark 有哪些聚合类的算子，我们应该尽量避免什么类型的算子？</h3><p>​在我们的开发过程中，能避免则尽可能避免使用 reduceByKey、join、distinct、repartition 等会进行 shuffle 的算子，尽量使用 map 类的非 shuffle 算子。这样的话，没有 shuffle 操作或者仅有较少 shuffle 操作的 Spark 作业，可以大大减少性能开销。</p><h3 id="如何从-Kafka-中获取数据？"><a href="#如何从-Kafka-中获取数据？" class="headerlink" title="如何从 Kafka 中获取数据？"></a>如何从 Kafka 中获取数据？</h3><ul><li><p>基于 Receiver 的方式</p><p>这种方式使用 Receiver 来获取数据。Receiver 是使用 Kafka 的高层次 Consumer API 来实现的。receiver 从 Kafka 中获取的数据都是存储在 Spark Executor 的内存中的，然后 Spark Streaming 启动的 job 会去处理那些数据。</p></li><li><p>基于 Direct 的方式</p><p>​这种新的不基于 Receiver 的直接方式，是在 Spark 1.3 中引入的，从而能够确保更加健壮的机制。替代掉使用 Receiver 来接收数据后，这种方式会周期性地查询 Kafka，来获得每个 topic + partition 的最新的 offset，从而定义每个 batch 的 offset 的范围。当处理数据的 job 启动时，就会使用 Kafka 的简单 Consumer API 来获取 Kafka 指定 offset 范围的数据。</p></li></ul><h3 id="RDD-创建有哪几种方式？"><a href="#RDD-创建有哪几种方式？" class="headerlink" title="RDD 创建有哪几种方式？"></a>RDD 创建有哪几种方式？</h3><ul><li>使用程序中的集合创建 RDD</li><li>使用本地文件系统创建 RDD</li><li>使用 HDFS 创建 RDD</li><li>基于数据库 db 创建 RDD</li><li>基于 NoSQL 创建 RDD，如 HBase</li><li>基于 s3 创建RDD</li><li>基于数据流，如 socket 创建RDD</li></ul><h3 id="Spark-并行度怎么设置比较合适？"><a href="#Spark-并行度怎么设置比较合适？" class="headerlink" title="Spark 并行度怎么设置比较合适？"></a>Spark 并行度怎么设置比较合适？</h3><p>​Spark 并行度，每个 core 承载 2~4 个 partition，如 32 个 core，那么 64~128 之间的并行度，也就是设置 64~128 个 partition，并行读和数据规模无关，只和内存使用量和 CPU 使用时间有关。</p><h3 id="Spark-如何处理不能被序列化的对象？"><a href="#Spark-如何处理不能被序列化的对象？" class="headerlink" title="Spark 如何处理不能被序列化的对象？"></a>Spark 如何处理不能被序列化的对象？</h3><p>​将不能序列化的内容封装成 object。</p><h3 id="collect-功能是什么，其底层是怎么实现的？"><a href="#collect-功能是什么，其底层是怎么实现的？" class="headerlink" title="collect 功能是什么，其底层是怎么实现的？"></a>collect 功能是什么，其底层是怎么实现的？</h3><p>​Driver 通过 collect 把集群中各个节点的内容收集过来汇总成结果，collect 返回结果是 Array 类型的，collect 把各个节点上的数据抓过来，抓过来数据是 Array 型，collect 对 Array 抓过来的结果进行合并，合并后 Array 中只有一个元素，是 tuple 类型（K-V类型）的。</p><h3 id="为什么-Spark-Application-在没有获得足够的资源，job-就开始执行了，可能会导致什么什么问题发生？"><a href="#为什么-Spark-Application-在没有获得足够的资源，job-就开始执行了，可能会导致什么什么问题发生？" class="headerlink" title="为什么 Spark Application 在没有获得足够的资源，job 就开始执行了，可能会导致什么什么问题发生？"></a>为什么 Spark Application 在没有获得足够的资源，job 就开始执行了，可能会导致什么什么问题发生？</h3><p>​会导致执行该 job 的时候集群资源不足，导致执行 job 结束也没有分配足够的资源，分配了部分 Executor，该 job 就开始执行 task，应该是 task 的调度线程和 Executor 资源申请是异步的；如果想等待申请完所有的资源再执行 job 的，​需要将 ​<code>spark.scheduler.maxRegisteredResourcesWaitingTime</code> 设置的很大；​<code>spark.scheduler.minRegisteredResourcesRatio</code> 设置为 1，但是应该结合实际考虑，​否则很容易出现长时间分配不到资源，job 一直不能运行的情况。</p><h3 id="map-与-flatMap-的区别？"><a href="#map-与-flatMap-的区别？" class="headerlink" title="map 与 flatMap 的区别？"></a>map 与 flatMap 的区别？</h3><ul><li>map：对 RDD 每个元素转换，文件中的每一行数据返回一个数组对象。</li><li>flatMap：对 RDD 每个元素转换，然后再扁平化。</li></ul><p>​将所有的对象合并为一个对象，文件中的所有行数据仅返回一个数组对象，会抛弃值为 null 的值。</p><h3 id="Spark-on-Mesos-中，什么是的粗粒度分配，什么是细粒度分配，各自的优点和缺点是什么？"><a href="#Spark-on-Mesos-中，什么是的粗粒度分配，什么是细粒度分配，各自的优点和缺点是什么？" class="headerlink" title="Spark on Mesos 中，什么是的粗粒度分配，什么是细粒度分配，各自的优点和缺点是什么？"></a>Spark on Mesos 中，什么是的粗粒度分配，什么是细粒度分配，各自的优点和缺点是什么？</h3><ul><li>粗粒度：启动时就分配好资源，程序启动，后续具体使用就使用分配好的资源，不需要再分配资源；好处：作业特别多时，资源复用率高，适合粗粒度；不好：容易资源浪费，假如一个 job 有 1000 个 Task，完成了 999 个，还有一个没完成，那么使用粗粒度，999 个资源就会闲置在那里，资源浪费。</li><li>细粒度分配：用资源的时候分配，用完了就立即回收资源，启动会麻烦一点，启动一次分配一次，会比较麻烦。</li></ul><h3 id="Driver-的功能是什么？"><a href="#Driver-的功能是什么？" class="headerlink" title="Driver 的功能是什么？"></a>Driver 的功能是什么？</h3><ul><li>一个 Spark 作业运行时包括一个 Driver 进程，也是作业的主进程，具有 main 函数，并且有 SparkContext 的实例，是程序的入口点；</li><li>功能：负责向集群申请资源，向 master 注册信息，负责了作业的调度，负责作业的解析、生成 Stage 并调度 Task 到 Executor 上。包括 DAG Scheduler，Task Scheduler。</li></ul><h3 id="Spark-技术栈有哪些组件，每个组件都有什么功能，适合什么应用场景？"><a href="#Spark-技术栈有哪些组件，每个组件都有什么功能，适合什么应用场景？" class="headerlink" title="Spark 技术栈有哪些组件，每个组件都有什么功能，适合什么应用场景？"></a>Spark 技术栈有哪些组件，每个组件都有什么功能，适合什么应用场景？</h3><p>​可以画一个技术栈图先，然后分别解释下每个组件的功能和场景</p><ul><li>Spark Core：是其它组件的基础，Spark 的内核，主要包含：有向循环图、RDD、Lineage、Cache、broadcast等，并封装了底层通讯框架，是 Spark 的基础。</li><li>Spark Streaming 是一个对实时数据流进行高通量、容错处理的流式处理系统，可以对多种数据源（如 Kafka、Flume、Twitter、Zero 和 TCP Socket）进行类似 Map、Reduce 和 Join 等复杂操作，将流式计算分解成一系列短小的批处理作业。</li><li>Spark SQL：Shark 是 SparkSQL 的前身，Spark SQL 的一个重要特点是其能够统一处理关系表和 RDD，使得开发人员可以轻松地使用 SQL 命令进行外部查询，同时进行更复杂的数据分析。</li><li>BlinkDB ：是一个用于在海量数据上运行交互式 SQL 查询的大规模并行查询引擎，它允许用户通过权衡数据精度来提升查询响应时间，其数据的精度被控制在允许的误差范围内。</li><li>MLBase 是 Spark 生态圈的一部分专注于机器学习，让机器学习的门槛更低，让一些可能并不了解机器学习的用户也能方便地使用 MLBase。MLBase 分为四部分：MLlib、MLI、ML Optimizer 和 MLRuntime。</li><li>GraphX 是 Spark 中用于图和图并行计算</li></ul><h3 id="Spark-中-Worker的主要工作是什么？"><a href="#Spark-中-Worker的主要工作是什么？" class="headerlink" title="Spark 中 Worker的主要工作是什么？"></a>Spark 中 Worker的主要工作是什么？</h3><p>​主要功能：管理当前节点内存，CPU 的使用状况，接收 master 分配过来的资源指令，通过 ExecutorRunner 启动程序分配任务，Worker 就类似于包工头，管理分配新进程，做计算的服务，相当于 process 服务。</p><p>​需要注意的是：</p><ul><li>Worker 不会汇报当前信息给 master，worker 心跳给 master 主要只有 workid，它不会发送资源信息以心跳的方式给mater，master 分配的时候就知道 work，只有出现故障的时候才会发送资源。</li><li>worker 不会运行代码，具体运行的是 Executor 是可以运行具体 Application 写的业务逻辑代码，操作代码的节点，它不会运行程序的代码的。</li></ul><h3 id="MapReduce-和-Spark-的都是并行计算，那么他们有什么相同和区别？"><a href="#MapReduce-和-Spark-的都是并行计算，那么他们有什么相同和区别？" class="headerlink" title="MapReduce 和 Spark 的都是并行计算，那么他们有什么相同和区别？"></a>MapReduce 和 Spark 的都是并行计算，那么他们有什么相同和区别？</h3><p>​两者都是用 MR 模型来进行并行计算:：</p><ul><li>Hadoop 的一个作业称为 job，job 里面分为 map task 和 reduce task，每个 task 都是在自己的进程中运行的，当 task 结束时，进程也会结束。</li><li>Spark 用户提交的任务成为 Application，一个 Application 对应一个 SparkContext，app 中存在多个 job，每触发一次 action 操作就会产生一个 job。这些 job 可以并行或串行执行，每个 job 中有多个 Stage，Stage 是 shuffle 过程中 DAG Scheduler 通过 RDD 之间的依赖关系划分 job 而来的，每个 Stage 里面有多个 Task，组成TaskSet 有 Task Scheduler 分发到各个 Executor 中执行，Executor 的生命周期是和 app 一样的，即使没有 job 运行也是存在的，所以 Task 可以快速启动读取内存进行计算。</li><li>Hadoop 的 job 只有 map 和 reduce 操作，表达能力比较欠缺而且在 MR 过程中会重复的读写 HDFS，造成大量的 IO 操作，多个 job 需要自己管理关系。</li><li>Spark 的迭代计算都是在内存中进行的，API 中提供了大量的 RDD 操作如 join，groupBy 等，而且通过 DAG 图可以实现良好的容错。</li></ul><h3 id="RDD-机制？"><a href="#RDD-机制？" class="headerlink" title="RDD 机制？"></a>RDD 机制？</h3><p>​RDD 分布式弹性数据集，简单的理解成一种数据结构，是 Spark 框架上的通用货币。所有算子都是基于 RDD 来执行的，不同的场景会有不同的 RDD 实现类，但是都可以进行互相转换。RDD 执行过程中会形成 DAG 图，然后形成 Lineage 保证容错性等。从物理的角度来看 RDD 存储的是 block 和 node 之间的映射。</p><h3 id="什么是-RDD-宽依赖和窄依赖？"><a href="#什么是-RDD-宽依赖和窄依赖？" class="headerlink" title="什么是 RDD 宽依赖和窄依赖？"></a>什么是 RDD 宽依赖和窄依赖？</h3><p>​RDD 和它依赖的 parent RDD(s) 的关系有两种不同的类型，即窄依赖（narrow dependency）和宽依赖（wide dependency）。</p><ul><li>窄依赖指的是每一个 parent RDD 的 Partition 最多被子 RDD 的一个 Partition 使用</li><li>宽依赖指的是多个子 RDD 的 Partition 会依赖同一个 parent RDD 的 Partition。</li></ul><h3 id="cache-和-persist的区别？"><a href="#cache-和-persist的区别？" class="headerlink" title="cache 和 persist的区别？"></a>cache 和 persist的区别？</h3><p>​cache 和 persist 都是用于将一个 RDD 进行缓存的，这样在之后使用的过程中就不需要重新计算了，可以大大节省程序运行时间</p><ul><li>cache 只有一个默认的缓存级别 <code>MEMORY_ONLY</code>，cache 调用了 persist，而 persist 可以根据情况设置其它的缓存级别；</li><li>Executor 执行的时候，默认 60% 做 cache，40% 做 task 操作，persist 是最根本的函数，最底层的函数。</li></ul><h3 id="cache-后面能不能接其他算子，它是不是-action-操作？"><a href="#cache-后面能不能接其他算子，它是不是-action-操作？" class="headerlink" title="cache 后面能不能接其他算子，它是不是 action 操作？"></a>cache 后面能不能接其他算子，它是不是 action 操作？</h3><p>​- cache 可以接其他算子，但是接了算子之后，起不到缓存应有的效果，因为会重新触发 cache。​- cache 不是 action 操作</p><h3 id="reduceByKey-是不是-action？"><a href="#reduceByKey-是不是-action？" class="headerlink" title="reduceByKey 是不是 action？"></a>reduceByKey 是不是 action？</h3><p>​不是，很多人都会以为是 action，reduce 是 action。</p><h3 id="RDD-通过Lineage（记录数据更新）的方式为何很高效？"><a href="#RDD-通过Lineage（记录数据更新）的方式为何很高效？" class="headerlink" title="RDD 通过Lineage（记录数据更新）的方式为何很高效？"></a>RDD 通过Lineage（记录数据更新）的方式为何很高效？</h3><ul><li>lazy 记录了数据的来源，RDD 是不可变的，且是 lazy 级别的，且 RDD 之间构成了链条，lazy 是弹性的基石。由于 RDD 不可变，所以每次操作就产生新的 RDD，不存在全局修改的问题，控制难度下降，所有有计算链条将复杂计算链条存储下来，计算的时候从后往前回溯是上一个 Stage 的结束，要么就 checkpoint。</li><li>记录原数据，是每次修改都记录，代价很大如果修改一个集合，代价就很小，官方说 RDD 是粗粒度的操作，是为了效率，为了简化，每次都是操作数据集合，写或者修改操作，都是基于集合的 RDD 的写操作是粗粒度的，RDD 的读操作既可以是粗粒度的也可以是细粒度，读可以读其中的一条条的记录。</li><li>简化复杂度，是高效率的一方面，写的粗粒度限制了使用场景如网络爬虫，现实世界中，大多数写是粗粒度的场景。</li></ul><h3 id="为什么要进行序列化序列化？"><a href="#为什么要进行序列化序列化？" class="headerlink" title="为什么要进行序列化序列化？"></a>为什么要进行序列化序列化？</h3><p>​可以减少数据的体积，减少存储空间，高效存储和传输数据，不好的是在使用的时候要反序列化，非常消耗 CPU。</p><h3 id="Yarn-中的-Container-是由谁负责销毁的，在-Hadoop-MapReduce-中-Container-可以复用么？"><a href="#Yarn-中的-Container-是由谁负责销毁的，在-Hadoop-MapReduce-中-Container-可以复用么？" class="headerlink" title="Yarn 中的 Container 是由谁负责销毁的，在 Hadoop MapReduce 中 Container 可以复用么？"></a>Yarn 中的 Container 是由谁负责销毁的，在 Hadoop MapReduce 中 Container 可以复用么？</h3><p>​ApplicationMaster 负责销毁，在 Hadoop MapReduce 不可以复用，在 Spark on Yarn 程序 Container 可以复用。</p><h3 id="提交任务时，如何指定-Spark-Application-的运行模式？"><a href="#提交任务时，如何指定-Spark-Application-的运行模式？" class="headerlink" title="提交任务时，如何指定 Spark Application 的运行模式？"></a>提交任务时，如何指定 Spark Application 的运行模式？</h3><ul><li>cluster 模式：<code>./spark-submit --class xx.xx.xx --master yarn --deploy-mode cluster xx.jar</code></li><li>client 模式：<code>./spark-submit --class xx.xx.xx --master yarn --deploy-mode client xx.jar</code></li></ul><h3 id="不启动-Spark-集群-Master-和-Worker-服务，可不可以运行-Spark-程序？"><a href="#不启动-Spark-集群-Master-和-Worker-服务，可不可以运行-Spark-程序？" class="headerlink" title="不启动 Spark 集群 Master 和 Worker 服务，可不可以运行 Spark 程序？"></a>不启动 Spark 集群 Master 和 Worker 服务，可不可以运行 Spark 程序？</h3><p>​可以，只要资源管理器第三方管理就可以，如由 Yarn 管理，Spark 集群不启动也可以使用 Spark；Spark 集群启动的是 Worker 和 Master，这个其实就是资源管理框架，Yarn中的 ResourceManager 相当于 Master，NodeManager 相当于 Worker，做计算是 Executor，和 Spark 集群的 Worker 和 Manager 可以没关系，归根接底还是 JVM 的运行，只要所在的 JVM 上安装了 Spark 就可以。</p><h3 id="Spark-on-Yarn-Cluster-模式下，ApplicationMaster-和-Driver-是在同一个进程么？"><a href="#Spark-on-Yarn-Cluster-模式下，ApplicationMaster-和-Driver-是在同一个进程么？" class="headerlink" title="Spark on Yarn Cluster 模式下，ApplicationMaster 和 Driver 是在同一个进程么？"></a>Spark on Yarn Cluster 模式下，ApplicationMaster 和 Driver 是在同一个进程么？</h3><p>​是，Driver 位于 ApplicationMaster 进程中。该进程负责申请资源，还负责监控程序、资源的动态情况。</p><h3 id="运行在-Yarn-中-Application-有几种类型的-Container？"><a href="#运行在-Yarn-中-Application-有几种类型的-Container？" class="headerlink" title="运行在 Yarn 中 Application 有几种类型的 Container？"></a>运行在 Yarn 中 Application 有几种类型的 Container？</h3><ul><li>运行 ApplicationMaster 的 Container：这是由 ResourceManager（向内部的资源调度器）申请和启动的，用户提交应用程序时，可指定唯一的 ApplicationMaster 所需的资源；</li><li>运行各类任务的 Container：这是由 ApplicationMaster 向 ResourceManager 申请的，并由 ApplicationMaster 与 NodeManager 通信以启动之。</li></ul><h3 id="Executor-启动时，资源通过哪几个参数指定？"><a href="#Executor-启动时，资源通过哪几个参数指定？" class="headerlink" title="Executor 启动时，资源通过哪几个参数指定？"></a>Executor 启动时，资源通过哪几个参数指定？</h3><ul><li><code>num-executors</code> 是 Executor 的数量</li><li><code>executor-memory</code> 是每个 Executor 使用的内存</li><li><code>executor-cores</code> 是每个 Executor 分配的 CPU</li></ul><h3 id="列出你所知道的调度器，说明其工作原理"><a href="#列出你所知道的调度器，说明其工作原理" class="headerlink" title="列出你所知道的调度器，说明其工作原理"></a>列出你所知道的调度器，说明其工作原理</h3><ul><li>FiFo Schedular：默认的调度器 先进先出</li><li>Capacity Schedular：计算能力调度器 选择占用内存小，优先级高的</li><li>Fair Schedular：公平调度器 所有job 占用相同资源</li></ul><h3 id="导致-Executor-产生-FULL-GC-的原因，可能导致什么问题？"><a href="#导致-Executor-产生-FULL-GC-的原因，可能导致什么问题？" class="headerlink" title="导致 Executor 产生 FULL GC 的原因，可能导致什么问题？"></a>导致 Executor 产生 FULL GC 的原因，可能导致什么问题？</h3><p>​可能导致 Executor 僵死问题，海量数据的 shuffle 和数据倾斜等都可能导致 FULL GC。以 shuffle 为例，伴随着大量的 shuffle 写操作，JVM 的新生代不断 GC，Eden Space 写满了就往 Survivor Space 写，同时超过一定大小的数据会直接写到老生代，当新生代写满了之后，也会把老的数据搞到老生代，如果老生代空间不足了，就触发 FULL GC，还是空间不够，那就 OOM 错误了，此时线程被 Blocked，导致整个 Executor 处理数据的进程被卡住。</p><h3 id="Spark-累加器有哪些特点？"><a href="#Spark-累加器有哪些特点？" class="headerlink" title="Spark 累加器有哪些特点？"></a>Spark 累加器有哪些特点？</h3><ul><li>累加器在全局唯一的，只增不减，记录全局集群的唯一状态；</li><li>在 Executor 中修改它，在 Driver 读取；</li><li>Executor 级别共享的，广播变量是 task 级别的共享，两个 Application 不可以共享累加器，但是同一个 app 不同的 job 可以共享。</li></ul><h3 id="HashPartitioner-的弊端是什么？"><a href="#HashPartitioner-的弊端是什么？" class="headerlink" title="HashPartitioner 的弊端是什么？"></a>HashPartitioner 的弊端是什么？</h3><p>​HashPartitioner 分区的原理很简单，对于给定的 key，计算其 hashCode，并除于分区的个数取余，如果余数小于 0，则用余数 + 分区的个数，最后返回的值就是这个 key 所属的分区 ID；弊端是数据不均匀，容易导致数据倾斜，极端情况下某几个分区会拥有 RDD 的所有数据。</p><h3 id="RangePartitioner-分区的原理？"><a href="#RangePartitioner-分区的原理？" class="headerlink" title="RangePartitioner 分区的原理？"></a>RangePartitioner 分区的原理？</h3><p>​RangePartitioner 分区则尽量保证每个分区中数据量的均匀，而且分区与分区之间是有序的，也就是说一个分区中的元素肯定都是比另一个分区内的元素小或者大；但是分区内的元素是不能保证顺序的。简单的说就是将一定范围内的数映射到某一个分区内。其原理是水塘抽样。RangePartitioner 作用：将一定范围内的数映射到某一个分区内，在实现中，分界的算法尤为重要。算法对应的函数是 rangeBounds。</p><h3 id="如何理解-Standalone-模式下，Spark-资源分配是粗粒度的？"><a href="#如何理解-Standalone-模式下，Spark-资源分配是粗粒度的？" class="headerlink" title="如何理解 Standalone 模式下，Spark 资源分配是粗粒度的？"></a>如何理解 Standalone 模式下，Spark 资源分配是粗粒度的？</h3><p>Spark 默认情况下资源分配是粗粒度的，也就是说程序在提交时就分配好资源，后面执行的时候使用分配好的资源，除非资源出现了故障才会重新分配。比如 Spark shell 启动，已提交，一注册，哪怕没有任务，Worker 都会分配资源给 Executor。</p><h3 id="union-操作是产生宽依赖还是窄依赖？"><a href="#union-操作是产生宽依赖还是窄依赖？" class="headerlink" title="union 操作是产生宽依赖还是窄依赖？"></a>union 操作是产生宽依赖还是窄依赖？</h3><p>​产生窄依赖。</p><h3 id="窄依赖父-RDD-的-partition-和子-RDD-的-partition-是不是都是一对一的关系？"><a href="#窄依赖父-RDD-的-partition-和子-RDD-的-partition-是不是都是一对一的关系？" class="headerlink" title="窄依赖父 RDD 的 partition 和子 RDD 的 partition 是不是都是一对一的关系？"></a>窄依赖父 RDD 的 partition 和子 RDD 的 partition 是不是都是一对一的关系？</h3><p>​不一定，除了一对一的窄依赖，还包含一对固定个数的窄依赖（就是对父 RDD 的依赖的 Partition 的数量不会随着 RDD 数量规模的改变而改变），比如 join 操作的每个 partition 仅仅和已知的 partition 进行 join，这个 join 操作是窄依赖，依赖固定数量的父 RDD，因为是确定的 partition 关系。</p><h3 id="Hadoop中，MapReduce-操作的-mapper-和-reducer-阶段相当于-Spark-中的哪几个算子？"><a href="#Hadoop中，MapReduce-操作的-mapper-和-reducer-阶段相当于-Spark-中的哪几个算子？" class="headerlink" title="Hadoop中，MapReduce 操作的 mapper 和 reducer 阶段相当于 Spark 中的哪几个算子？"></a>Hadoop中，MapReduce 操作的 mapper 和 reducer 阶段相当于 Spark 中的哪几个算子？</h3><p>​相当于 Spark 中的 map 算子和 reduceByKey 算子，当然还是有点区别的，MR 会自动进行排序的，Spark 要看你用的是什么 partitioner。</p><h3 id="什么是-shuffle，以及为什么需要-shuffle？"><a href="#什么是-shuffle，以及为什么需要-shuffle？" class="headerlink" title="什么是 shuffle，以及为什么需要 shuffle？"></a>什么是 shuffle，以及为什么需要 shuffle？</h3><p>​shuffle 中文翻译为洗牌，需要 shuffle 的原因是：某种具有共同特征的数据汇聚到一个计算节点上进行计算。</p><h3 id="Spark-中的-HashShuffle-的有哪些不足？"><a href="#Spark-中的-HashShuffle-的有哪些不足？" class="headerlink" title="Spark 中的 HashShuffle 的有哪些不足？"></a>Spark 中的 HashShuffle 的有哪些不足？</h3><ul><li>shuffle 产生海量的小文件在磁盘上，此时会产生大量耗时的、低效的 IO 操作；</li><li>容易导致内存不够用，由于内存需要保存海量的文件操作句柄和临时缓存信息，如果数据处理规模比较大的话，容易出现 OOM；</li><li>容易出现数据倾斜，导致OOM。</li></ul><h3 id="consolidate-是如何优化-Hash-shuffle-时在-map-端产生的小文件？"><a href="#consolidate-是如何优化-Hash-shuffle-时在-map-端产生的小文件？" class="headerlink" title="consolidate 是如何优化 Hash shuffle 时在 map 端产生的小文件？"></a>consolidate 是如何优化 Hash shuffle 时在 map 端产生的小文件？</h3><ul><li>consolidate 为了解决 Hash Shuffle 同时打开过多文件导致 Writer handler 内存使用过大以及产生过多文件导致大量的随机读写带来的低效磁盘 IO；</li><li>consolidate 根据 CPU 的个数来决定每个 task shuffle map 端产生多少个文件，假设原来有 10 个 task，100 个 reduce，每个节点有 10 个 CPU，那么使用hash shuffle 会产生 <code>10*100=1000</code> 个文件，consolidate 产生 <code>10*10=100</code> 个文件</li></ul><p>​注意：consolidate 部分减少了文件和文件句柄，并行读很高的情况下（task 很多时）还是会很多文件。</p><h3 id="spark-default-parallelism-这个参数有什么意义，实际生产中如何设置？"><a href="#spark-default-parallelism-这个参数有什么意义，实际生产中如何设置？" class="headerlink" title="spark.default.parallelism 这个参数有什么意义，实际生产中如何设置？"></a>spark.default.parallelism 这个参数有什么意义，实际生产中如何设置？</h3><ul><li>参数用于设置每个 Stage 的默认 Task 数量。这个参数极为重要，如果不设置可能会直接影响你的 Spark 作业性能；</li><li>很多人都不会设置这个参数，会使得集群非常低效，你的 CPU，内存再多，如果 Task 始终为 1，那也是浪费，Spark 官网建议 Task 个数为 <code>CPU 的核数 * Executor 的个数的 2~3 倍</code>。</li></ul><h3 id="spark-shuffle-memoryFraction-参数的含义，以及优化经验？"><a href="#spark-shuffle-memoryFraction-参数的含义，以及优化经验？" class="headerlink" title="spark.shuffle.memoryFraction 参数的含义，以及优化经验？"></a>spark.shuffle.memoryFraction 参数的含义，以及优化经验？</h3><ul><li><code>spark.shuffle.memoryFraction</code> 是 shuffle 调优中 重要参数，shuffle 从上一个 task 拉去数据过来，要在 Executor 进行聚合操作，聚合操作时使用 Executor 内存的比例由该参数决定，默认是 20%，如果聚合时数据超过了该大小，那么就会 spill 到磁盘，极大降低性能；</li><li>如果 Spark 作业中的 RDD 持久化操作较少，shuffle 操作较多时，建议降低持久化操作的内存占比，提高 shuffle 操作的内存占比比例，避免 shuffle 过程中数据过多时内存不够用，必须溢写到磁盘上，降低了性能。此外，如果发现作业由于频繁的 GC 导致运行缓慢，意味着 task 执行用户代码的内存不够用，那么同样建议调低这个参数的值。</li></ul><h3 id="Spark-中-Standalone-模式特点，有哪些优点和缺点？"><a href="#Spark-中-Standalone-模式特点，有哪些优点和缺点？" class="headerlink" title="Spark 中 Standalone 模式特点，有哪些优点和缺点？"></a>Spark 中 Standalone 模式特点，有哪些优点和缺点？</h3><ul><li>特点：<ul><li>Standalone 是 Master/Slave 架构，集群由 Master 与 Worker 节点组成，程序通过与 Master 节点交互申请资源，Worker 节点启动 Executor 运行；</li><li>Standalone 调度模式使用 FIFO 调度方式；</li><li>无依赖任何其他资源管理系统，Master 负责管理集群资源</li></ul></li><li>优点：<ul><li>部署简单；</li><li>不依赖其他资源管理系统。</li></ul></li><li>缺点：<ul><li>默认每个应用程序会独占所有可用节点的资源，当然可以通过 <code>spark.cores.max</code> 来决定一个应用可以申请的 CPU cores 个数；</li><li>可能有单点故障，需要自己配置 master HA。</li></ul></li></ul><h3 id="FIFO-调度模式的基本原理、优点和缺点？"><a href="#FIFO-调度模式的基本原理、优点和缺点？" class="headerlink" title="FIFO 调度模式的基本原理、优点和缺点？"></a>FIFO 调度模式的基本原理、优点和缺点？</h3><p>​基本原理：按照先后顺序决定资源的使用，资源优先满足最先来的 job。第一个 job 优先获取所有可用的资源，接下来第二个 job 再获取剩余资源。以此类推，如果第一个 job 没有占用所有的资源，那么第二个 job 还可以继续获取剩余资源，这样多个 job 可以并行运行，如果第一个 job 很大，占用所有资源，则第二个 job 就需要等待，等到第一个 job 释放所有资源。</p><p>​优点和缺点：</p><ul><li>适合长作业，不适合短作业；</li><li>适合CPU繁忙型作业（计算时间长，相当于长作业），不利于IO繁忙型作业（计算时间短，相当于短作业）。</li></ul><h3 id="FAIR-调度模式的优点和缺点？"><a href="#FAIR-调度模式的优点和缺点？" class="headerlink" title="FAIR 调度模式的优点和缺点？"></a>FAIR 调度模式的优点和缺点？</h3><p>​所有的任务拥有大致相当的优先级来共享集群资源，Spark 多以轮训的方式为任务分配资源，不管长任务还是端任务都可以获得资源，并且获得不错的响应时间，对于短任务，不会像 FIFO 那样等待较长时间了，通过参数 <code>spark.scheduler.mode</code> 为 FAIR 指定。</p><h3 id="CAPACITY-调度模式的优点和缺点？"><a href="#CAPACITY-调度模式的优点和缺点？" class="headerlink" title="CAPACITY 调度模式的优点和缺点？"></a>CAPACITY 调度模式的优点和缺点？</h3><ul><li><p>原理：</p><p>计算能力调度器支持多个队列，每个队列可配置一定的资源量，每个队列采用 FIFO 调度策略，为了防止同一个用户的作业独占队列中的资源，该调度器会对同一用户提交的作业所占资源量进行限定。调度时，首先按以下策略选择一个合适队列：计算每个队列中正在运行的任务数与其应该分得的计算资源之间的比值（即比较空闲的队列），选择一个该比值最小的队列；然后按以下策略选择该队列中一个作业：按照作业优先级和提交时间顺序选择，同时考虑用户资源量限制和内存限制</p></li><li>优点：<ul><li>计算能力保证。支持多个队列，某个作业可被提交到某一个队列中。每个队列会配置一定比例的计算资源，且所有提交到队列中的作业共享该队列中的资源；</li><li>灵活性。空闲资源会被分配给那些未达到资源使用上限的队列，当某个未达到资源的队列需要资源时，一旦出现空闲资源资源，便会分配给他们；</li><li>支持优先级。队列支持作业优先级调度（默认是 FIFO）；</li><li>多重租赁。综合考虑多种约束防止单个作业、用户或者队列独占队列或者集群中的资源；</li><li>基于资源的调度。支持资源密集型作业，允许作业使用的资源量高于默认值，进而可容纳不同资源需求的作业。不过，当前仅支持内存资源的调度。</li></ul></li></ul><h3 id="常见的数据压缩方式，你们生产集群采用了什么压缩方式，提升了多少效率？"><a href="#常见的数据压缩方式，你们生产集群采用了什么压缩方式，提升了多少效率？" class="headerlink" title="常见的数据压缩方式，你们生产集群采用了什么压缩方式，提升了多少效率？"></a>常见的数据压缩方式，你们生产集群采用了什么压缩方式，提升了多少效率？</h3><ul><li>数据压缩，大片连续区域进行数据存储并且存储区域中数据重复性高的状况下，可以使用适当的压缩算法。数组，对象序列化后都可以使用压缩，数更紧凑，减少空间开销。常见的压缩方式有 snappy，LZO，gz 等</li><li>Hadoop 生产环境常用的是 snappy 压缩方式（使用压缩，实际上是 CPU 换 IO 吞吐量和磁盘空间，所以如果 CPU 利用率不高，不忙的情况下，可以大大提升集群处理效率）。snappy 压缩比一般 20%~30% 之间，并且压缩和解压缩效率也非常高：<ul><li>GZIP 的压缩率最高，但是其实 CPU 密集型的，对 CPU 的消耗比其他算法要多，压缩和解压速度也慢；</li><li>LZO 的压缩率居中，比 GZIP 要低一些，但是压缩和解压速度明显要比 GZIP 快很多，其中解压速度快的更多；</li><li>Zippy/Snappy 的压缩率最低，而压缩和解压速度要稍微比 LZO 要快一些。</li></ul></li><li>提升了多少效率可以从两个方面回答：<ul><li>数据存储节约多少存储，</li><li>任务执行消耗时间节约了多少，可以举个实际例子展开描述。</li></ul></li></ul><h3 id="使用-scala-代码实现-WordCount？"><a href="#使用-scala-代码实现-WordCount？" class="headerlink" title="使用 scala 代码实现 WordCount？"></a>使用 scala 代码实现 WordCount？</h3><p><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala">​<span class="token keyword">val</span> conf <span class="token operator">=</span> <span class="token keyword">new</span> SparkConf<span class="token punctuation">(</span><span class="token punctuation">)</span>​<span class="token keyword">val</span> sc <span class="token operator">=</span> <span class="token keyword">new</span> SparkContext<span class="token punctuation">(</span>conf<span class="token punctuation">)</span>​<span class="token keyword">val</span> line <span class="token operator">=</span> sc<span class="token punctuation">.</span>textFile<span class="token punctuation">(</span><span class="token string">"xxxx.txt"</span><span class="token punctuation">)</span>line<span class="token punctuation">.</span>flatMap<span class="token punctuation">(</span>_<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">" "</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>map<span class="token punctuation">(</span><span class="token punctuation">(</span>_<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>reduceByKey<span class="token punctuation">(</span>_<span class="token operator">+</span>_<span class="token punctuation">)</span><span class="token punctuation">.</span>collect<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>foreach<span class="token punctuation">(</span>println<span class="token punctuation">)</span>sc<span class="token punctuation">.</span>stop<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h3 id="Spark-RDD-和-MapReduce2-的区别？"><a href="#Spark-RDD-和-MapReduce2-的区别？" class="headerlink" title="Spark RDD 和 MapReduce2 的区别？"></a>Spark RDD 和 MapReduce2 的区别？</h3><ul><li>MR2 只有 2 个阶段，数据需要大量访问磁盘，数据来源相对单一，Spark RDD，可以无数个阶段进行迭代计算，数据来源非常丰富，数据落地介质也非常丰富 Spark 计算基于内存；</li><li>MR2 需要频繁操作磁盘 IO，需要大家明确的是，如果是 SparkRDD 的话，你要知道每一种数据来源对应的是什么，RDD 从数据源加载数据，将数据放到不同的 partition 针对这些 partition 中的数据进行迭代式计算计算完成之后，落地到不同的介质当中。</li></ul><h3 id="Spark和-MapReduce快？为什么快呢？快在哪里呢？"><a href="#Spark和-MapReduce快？为什么快呢？快在哪里呢？" class="headerlink" title="Spark和 MapReduce快？为什么快呢？快在哪里呢？"></a>Spark和 MapReduce快？为什么快呢？快在哪里呢？</h3><p>​Spark 更加快的主要原因有几点：</p><ul><li>基于内存计算，减少低效的磁盘交互；</li><li>高效的调度算法，基于 DAG；</li><li>容错机制 Lineage，主要是 DAG 和 Lineage，即使 Spark 不使用内存技术，也大大快于 MapReduce。</li></ul><h3 id="Spark-SQL-为什么比-Hive-快呢？"><a href="#Spark-SQL-为什么比-Hive-快呢？" class="headerlink" title="Spark SQL 为什么比 Hive 快呢？"></a>Spark SQL 为什么比 Hive 快呢？</h3><p>​计算引擎不一样，一个是 Spark 计算模型，一个是 MapReudce 计算模型。</p><h3 id="RDD-的数据结构是怎么样的？"><a href="#RDD-的数据结构是怎么样的？" class="headerlink" title="RDD 的数据结构是怎么样的？"></a>RDD 的数据结构是怎么样的？</h3><p>一个 RDD 对象，包含如下 5 个核心属性。</p><ul><li>一个分区列表，每个分区里是 RDD 的部分数据（或称数据块）。</li><li>一个依赖列表，存储依赖的其他 RDD。</li><li>一个名为 compute 的计算函数，用于计算 RDD 各分区的值。</li><li>分区器（可选），用于键/值类型的RDD，比如某个 RDD 是按散列来分区。</li><li>计算各分区时优先的位置列表（可选），比如从 HDFS 上的文件生成 RDD 时，RDD 分区的位置优先选择数据所在的节点，这样可以避免数据移动带来的开销。</li></ul><h3 id="RDD-算子里操作一个外部-map，比如往里面-put-数据，然后算子外再遍历-map，会有什么问题吗？"><a href="#RDD-算子里操作一个外部-map，比如往里面-put-数据，然后算子外再遍历-map，会有什么问题吗？" class="headerlink" title="RDD 算子里操作一个外部 map，比如往里面 put 数据，然后算子外再遍历 map，会有什么问题吗？"></a>RDD 算子里操作一个外部 map，比如往里面 put 数据，然后算子外再遍历 map，会有什么问题吗？</h3><p>​频繁创建额外对象，容易 OOM。</p><h3 id="HBase-region-多大会分区，Spark-读取-HBase-数据是如何划分-partition-的？"><a href="#HBase-region-多大会分区，Spark-读取-HBase-数据是如何划分-partition-的？" class="headerlink" title="HBase region 多大会分区，Spark 读取 HBase 数据是如何划分 partition 的？"></a>HBase region 多大会分区，Spark 读取 HBase 数据是如何划分 partition 的？</h3><p>​region 超过了 <code>hbase.hregion.max.filesize</code> 这个参数配置的大小就会自动裂分，默认值是 1G。</p><p>​默认情况下，HBase 有多少个 region，Spark 读取时就会有多少个 partition</p><h2 id="Spark-调优"><a href="#Spark-调优" class="headerlink" title="Spark 调优"></a>Spark 调优</h2>]]></content>
      
      
      <categories>
          
          <category> 教程笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 大数据 </tag>
            
            <tag> 面试题 </tag>
            
            <tag> Spark </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hexo 博客访问日历图</title>
      <link href="post/1a169b5a.html"/>
      <url>post/1a169b5a.html</url>
      
        <content type="html"><![CDATA[<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p><strong>本教程仍在测试中，仍然可能出现跨域请求的问题</strong></p><p>本文教程主要针对 Hexo 博客，参考冰老师的 <a href="https://zfe.space/post/hexo-githubcalendar.html">hexo-githubcalendar 插件</a>，对博客站点的每日的访问进行统计，绘制出类似与 GitHub 贡献日历的博客访问日历。</p><p><img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="/images/post/visit_calendar/demo.png" alt></p><p><div class="note info simple"><ul><li>本文数据来源均为百度统计，请确保博客站点已加入百度统计，以 butterfly 主题为例，可参照 <a href="https://butterfly.js.org/posts/ceeb73f/#%E5%88%86%E6%9E%90%E7%B5%B1%E8%A8%88">Butterfly 安装文档(四) 主题配置-2</a> 的分析统计段落实现。</li><li>本地主机访问（localhost）也会记录到百度统计，推荐在 <strong>【百度统计】--【管理】--【统计规则设置】--【过滤规则设置】--【受访域名统计规则】--【勾选排除 localhost（本地主机）】</strong> 排除本地主机访问（貌似在勾选后生效，但是以前的访问记录仍会统计）。</li><li>本教程将会泄漏属于百度统计的站点 ID 和百度统计 AccessToken，请先前往 <a href="https://tongji.baidu.com/api/manual/">百度统计用户手册</a> 了解，介意者请谨慎部署。</li></ul></div></p><h1 id="博客访问统计"><a href="#博客访问统计" class="headerlink" title="博客访问统计"></a>博客访问统计</h1><h2 id="获取网站统计数据"><a href="#获取网站统计数据" class="headerlink" title="获取网站统计数据"></a>获取网站统计数据</h2><ol><li><p>已经添加百度统计分析的小伙伴可以登录<a href="https://tongji.baidu.com/web/welcome/login">百度统计</a>的官网网站，此处博主使用的是百度账号登录。</p><p> <img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="/images/post/hexo_census/login.png" alt></p></li><li><p>登录进入首页后可以点击<strong>基础报告</strong>查看网站访问统计数据（若无绑定网站，需要先在 <strong>管理</strong>页面--<strong>账户管理</strong>--<strong>网站列表</strong> 添加博客网址）。</p><p> <img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="/images/post/hexo_census/index.png" alt></p></li><li><p>此时我们想要获取这些数据可以调用<strong>百度统计 API</strong>，点击<strong>管理</strong>，进入管理页面后在左边侧边栏找到<strong>数据导出服务</strong>。</p><p> <img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="/images/post/hexo_census/data_export.png" alt></p></li><li><p>登录<a href="http://developer.baidu.com/console#app/project">百度开发者中心控制台</a>，创建工程，应用名称任意。</p><p> <img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="/images/post/hexo_census/project.png" alt></p></li><li><p>点击刚刚创建的工程，记录下 API Key，Secret Key。</p><p> <img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="/images/post/hexo_census/project_info.png" alt></p></li><li><p>填写下面链接参数后打开链接获取授权码，具体步骤可以参考 <a href="https://tongji.baidu.com/api/manual/">Tongji API用户手册</a>。</p><p> <code>http://openapi.baidu.com/oauth/2.0/authorize?response_type=code&amp;client_id=&#123;CLIENT_ID&#125;&amp;redirect_uri=&#123;REDIRECT_URI&#125;&amp;scope=basic&amp;display=popup</code></p><ul><li>API Key：{CLIENT_ID}</li><li><p>回调 URI：{REDIRECT_URI}，可以填写 <code>oob</code>。</p><p><img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="/images/post/hexo_census/auth_code.png" alt></p></li></ul></li><li><p>复制第 6 步获取的授权码，填写下面链接参数后打开链接获取 <code>ACCESS_TOKEN</code> ：。</p><p> <code>http://openapi.baidu.com/oauth/2.0/token?grant_type=authorization_code&amp;code=&#123;CODE&#125;&amp;client_id=&#123;CLIENT_ID&#125;&amp;client_secret=&#123;CLIENT_SECRET&#125;&amp;redirect_uri=&#123;REDIRECT_URI&#125;</code></p><ul><li>Auth Code：{CODE}，第 6 步获取的授权码。</li><li>API Key：{CLIENT_ID}</li><li>Secret Key：{CLIENT_SECRET}</li><li><p>回调 URI：{REDIRECT_URI}，可以填写 <code>oob</code>。</p><p><img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="/images/post/hexo_census/access_token.png" alt></p></li></ul><p><strong>注意：</strong>从上述步骤得到的数据中包含 <code>ACCESS_TOKEN</code> 和 <code>REFRESH_TOKEN</code> 两个值，其中 <code>ACCESS_TOKEN</code> 的有效期为一个月，<code>REFRESH_TOKEN</code> 的有效期为十年。<code>REFRESH_TOKEN</code> 的作用就是刷新获取新的 <code>ACCESS_TOKEN</code> 和 <code>REFRESH_TOKEN</code> ， 如此反复操作来实现 <code>ACCESS_TOKEN</code> 有效期永久的机制。</p><p>一旦 <code>ACCESS_TOKEN</code> 过期，可根据以下请求更换新的 <code>ACCESS_TOKEN</code> 和 <code>REFRESH_TOKEN</code>：</p><p><code>http://openapi.baidu.com/oauth/2.0/token?grant_type=refresh_token&amp;refresh_token=&#123;REFRESH_TOKEN&#125;&amp;client_id=&#123;CLIENT_ID&#125;&amp;client_secret=&#123;CLIENT_SECRET&#125;</code></p><ul><li>API Key：{CLIENT_ID}</li><li>Secret Key：{CLIENT_SECRET}</li><li>Refresh Token：{REFRESH_TOKEN}</li></ul></li><li><p>调用百度统计API</p><p> 第 7 步获取的 <code>ACCESS_TOKEN</code> 是所调用 API 的用户级参数，结合各 API 的应用级参数即可正常调用 API 获取数据，填写下面链接参数后打开链接获取网站 ID：</p><p> <code>https://openapi.baidu.com/rest/2.0/tongji/config/getSiteList?access_token=&#123;ACCESS_TOKEN&#125;</code></p><ul><li><p>Access Token：{ACCESS_TOKEN}</p><p><img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="/images/post/hexo_census/site_id.png" alt></p></li></ul><p>也可以在 <a href="https://tongji.baidu.com/api/debug/#">Tongji API调试工具</a> 输入 <code>ACCESS_TOKEN</code> 获取网址 ID：</p><p> <img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="/images/post/hexo_census/site_id_debug.png" alt></p></li><li><p>在 <a href="https://tongji.baidu.com/api/debug/#">Tongji API调试工具</a> 选择需要获取的报告数据，填写 <code>ACCESS_TOKEN</code> 、必填参数、选填参数获取百度统计数据。</p></li></ol><p><img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="/images/post/hexo_census/site_data.png" alt></p><h2 id="网站统计代码"><a href="#网站统计代码" class="headerlink" title="网站统计代码"></a>网站统计代码</h2><p>以 butterfly 主题为例，可以在 <code>[Blogroot]\js\</code> 目录下新建 <code>visit_calendar.js</code> 文件，然后添加以下内容：</p><p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> <span class="token function-variable function">visit_calendar</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">site_id<span class="token punctuation">,</span> access_token<span class="token punctuation">,</span> metrics<span class="token punctuation">,</span> visit_color</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>  <span class="token keyword">var</span> date <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">var</span> end_date <span class="token operator">=</span> date<span class="token punctuation">.</span><span class="token function">getFullYear</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span>date<span class="token punctuation">.</span><span class="token function">getMonth</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">8</span> <span class="token operator">?</span> <span class="token punctuation">(</span>date<span class="token punctuation">.</span><span class="token function">getMonth</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token punctuation">(</span><span class="token string">"0"</span> <span class="token operator">+</span> <span class="token punctuation">(</span>date<span class="token punctuation">.</span><span class="token function">getMonth</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span>date<span class="token punctuation">.</span><span class="token function">getDate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">9</span> <span class="token operator">?</span> date<span class="token punctuation">.</span><span class="token function">getDate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token punctuation">(</span><span class="token string">"0"</span> <span class="token operator">+</span> date<span class="token punctuation">.</span><span class="token function">getDate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  date<span class="token punctuation">.</span><span class="token function">setFullYear</span><span class="token punctuation">(</span>date<span class="token punctuation">.</span><span class="token function">getFullYear</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  date<span class="token punctuation">.</span><span class="token function">setTime</span><span class="token punctuation">(</span>date<span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">24</span> <span class="token operator">*</span> <span class="token number">3600</span> <span class="token operator">*</span> <span class="token number">1000</span> <span class="token operator">*</span> date<span class="token punctuation">.</span><span class="token function">getDay</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">var</span> start_date <span class="token operator">=</span> date<span class="token punctuation">.</span><span class="token function">getFullYear</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span>date<span class="token punctuation">.</span><span class="token function">getMonth</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">8</span> <span class="token operator">?</span> <span class="token punctuation">(</span>date<span class="token punctuation">.</span><span class="token function">getMonth</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token punctuation">(</span><span class="token string">"0"</span> <span class="token operator">+</span> <span class="token punctuation">(</span>date<span class="token punctuation">.</span><span class="token function">getMonth</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span>date<span class="token punctuation">.</span><span class="token function">getDate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">9</span> <span class="token operator">?</span> date<span class="token punctuation">.</span><span class="token function">getDate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token punctuation">(</span><span class="token string">"0"</span> <span class="token operator">+</span> date<span class="token punctuation">.</span><span class="token function">getDate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">var</span> metrics_name <span class="token operator">=</span> <span class="token punctuation">(</span>metrics <span class="token operator">===</span> <span class="token string">'pv_count'</span> <span class="token operator">?</span> <span class="token string">'次'</span> <span class="token operator">:</span> <span class="token punctuation">(</span>metrics <span class="token operator">===</span> <span class="token string">'visitor_count'</span> <span class="token operator">?</span> <span class="token string">'人'</span> <span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">var</span> visit_apiurl <span class="token operator">=</span> <span class="token string">'https://baidu-tongji-api.vercel.app/api?site_id='</span> <span class="token operator">+</span> site_id <span class="token operator">+</span> <span class="token string">'&amp;access_token='</span> <span class="token operator">+</span> access_token <span class="token operator">+</span> <span class="token string">'&amp;method=overview/getTimeTrendRpt'</span> <span class="token operator">+</span> <span class="token string">'&amp;metrics='</span> <span class="token operator">+</span> metrics <span class="token operator">+</span> <span class="token string">'&amp;start_date='</span> <span class="token operator">+</span> start_date <span class="token operator">+</span> <span class="token string">'&amp;end_date='</span> <span class="token operator">+</span> end_date<span class="token punctuation">;</span>  <span class="token keyword">var</span> visit_fixed <span class="token operator">=</span> <span class="token string">'fixed'</span><span class="token punctuation">;</span>  <span class="token keyword">var</span> visit_px <span class="token operator">=</span> <span class="token string">'px'</span><span class="token punctuation">;</span>  <span class="token keyword">var</span> visit_month <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'一月'</span><span class="token punctuation">,</span> <span class="token string">'二月'</span><span class="token punctuation">,</span> <span class="token string">'三月'</span><span class="token punctuation">,</span> <span class="token string">'四月'</span><span class="token punctuation">,</span> <span class="token string">'五月'</span><span class="token punctuation">,</span> <span class="token string">'六月'</span><span class="token punctuation">,</span> <span class="token string">'七月'</span><span class="token punctuation">,</span> <span class="token string">'八月'</span><span class="token punctuation">,</span> <span class="token string">'九月'</span><span class="token punctuation">,</span> <span class="token string">'十月'</span><span class="token punctuation">,</span> <span class="token string">'十一月'</span><span class="token punctuation">,</span> <span class="token string">'十二月'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token keyword">var</span> visit_monthchange <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token keyword">var</span> visit_oneyearbeforeday <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>  <span class="token keyword">var</span> visit_thisday <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>  <span class="token keyword">var</span> visit_amonthago <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>  <span class="token keyword">var</span> visit_aweekago <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>  <span class="token keyword">var</span> visit_weekdatacore <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>  <span class="token keyword">var</span> visit_datacore <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>  <span class="token keyword">var</span> visit_total <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>  <span class="token keyword">var</span> visit_datadate <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>  <span class="token keyword">var</span> visit_visit_data <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token keyword">var</span> visit_positionplusdata <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token keyword">var</span> visit_firstweek <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token keyword">var</span> visit_lastweek <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token keyword">var</span> visit_beforeweek <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token keyword">var</span> visit_thisweekdatacore <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>  <span class="token keyword">var</span> visit_mounthbeforeday <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>  <span class="token keyword">var</span> visit_mounthfirstindex <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>  <span class="token keyword">var</span> visit_crispedges <span class="token operator">=</span> <span class="token string">'crispedges'</span><span class="token punctuation">;</span>  <span class="token keyword">var</span> visit_thisdayindex <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>  <span class="token keyword">var</span> visit_amonthagoindex <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>  <span class="token keyword">var</span> visit_amonthagoweek <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token keyword">var</span> visit_firstdate <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token keyword">var</span> visit_first2date <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token keyword">var</span> visit_montharrbefore <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token keyword">var</span> visit_monthindex <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>  <span class="token keyword">var</span> <span class="token function-variable function">retinaCanvas</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">canvas<span class="token punctuation">,</span> context<span class="token punctuation">,</span> ratio</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>ratio <span class="token operator">></span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token keyword">var</span> canvasWidth <span class="token operator">=</span> canvas<span class="token punctuation">.</span>width<span class="token punctuation">;</span>      <span class="token keyword">var</span> canvasHeight <span class="token operator">=</span> canvas<span class="token punctuation">.</span>height<span class="token punctuation">;</span>      canvas<span class="token punctuation">.</span>width <span class="token operator">=</span> canvasWidth <span class="token operator">*</span> ratio<span class="token punctuation">;</span>      canvas<span class="token punctuation">.</span>height <span class="token operator">=</span> canvasHeight <span class="token operator">*</span> ratio<span class="token punctuation">;</span>      canvas<span class="token punctuation">.</span>style<span class="token punctuation">.</span>width <span class="token operator">=</span> <span class="token string">'100%'</span><span class="token punctuation">;</span>      canvas<span class="token punctuation">.</span>style<span class="token punctuation">.</span>height <span class="token operator">=</span> canvasHeight <span class="token operator">+</span> <span class="token string">'px'</span><span class="token punctuation">;</span>      context<span class="token punctuation">.</span><span class="token function">scale</span><span class="token punctuation">(</span>ratio<span class="token punctuation">,</span> ratio<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>  <span class="token keyword">function</span> <span class="token function">responsiveChart</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">var</span> ratio <span class="token operator">=</span> window<span class="token punctuation">.</span>devicePixelRatio <span class="token operator">||</span> <span class="token number">1</span>    <span class="token keyword">var</span> visit_tooltip_container <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'visit_tooltip_container'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">var</span> visit_x <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>    <span class="token keyword">var</span> visit_y <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>    <span class="token keyword">var</span> visit_span1 <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>    <span class="token keyword">var</span> visit_span2 <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"visitcanvas"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token keyword">var</span> c <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"visitcanvas"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      c<span class="token punctuation">.</span>style<span class="token punctuation">.</span>width <span class="token operator">=</span> <span class="token string">'100%'</span><span class="token punctuation">;</span>      c<span class="token punctuation">.</span>style<span class="token punctuation">.</span>height <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>      <span class="token keyword">var</span> cmessage <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"visitmessage"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token keyword">var</span> ctx <span class="token operator">=</span> c<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">"2d"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      width <span class="token operator">=</span> c<span class="token punctuation">.</span>width <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"visitcalendarcanvasbox"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>offsetWidth<span class="token punctuation">;</span>      height <span class="token operator">=</span> c<span class="token punctuation">.</span>height <span class="token operator">=</span> <span class="token number">9</span> <span class="token operator">*</span> <span class="token number">0.96</span> <span class="token operator">*</span> c<span class="token punctuation">.</span>width <span class="token operator">/</span> visit_data<span class="token punctuation">.</span>length<span class="token punctuation">;</span>      <span class="token function">retinaCanvas</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> ctx<span class="token punctuation">,</span> ratio<span class="token punctuation">)</span>      <span class="token keyword">var</span> linemaxwitdh <span class="token operator">=</span> height <span class="token operator">/</span> <span class="token number">9</span><span class="token punctuation">;</span>      <span class="token keyword">var</span> lineminwitdh <span class="token operator">=</span> <span class="token number">0.8</span> <span class="token operator">*</span> linemaxwitdh<span class="token punctuation">;</span>      <span class="token keyword">var</span> setposition <span class="token operator">=</span> <span class="token punctuation">&#123;</span> x<span class="token operator">:</span> <span class="token number">0.02</span> <span class="token operator">*</span> width<span class="token punctuation">,</span> y<span class="token operator">:</span> <span class="token number">0.025</span> <span class="token operator">*</span> width <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> week <span class="token keyword">in</span> visit_data<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        weekdata <span class="token operator">=</span> visit_data<span class="token punctuation">[</span>week<span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> day <span class="token keyword">in</span> weekdata<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>          <span class="token keyword">var</span> dataitem <span class="token operator">=</span> <span class="token punctuation">&#123;</span> date<span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span> count<span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span> x<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> y<span class="token operator">:</span> <span class="token number">0</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>          visit_positionplusdata<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>dataitem<span class="token punctuation">)</span><span class="token punctuation">;</span>          ctx<span class="token punctuation">.</span>fillStyle <span class="token operator">=</span> <span class="token function">visit_thiscolor</span><span class="token punctuation">(</span>visit_color<span class="token punctuation">,</span> weekdata<span class="token punctuation">[</span>day<span class="token punctuation">]</span><span class="token punctuation">.</span>count<span class="token punctuation">)</span><span class="token punctuation">;</span>          setposition<span class="token punctuation">.</span>y <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span>setposition<span class="token punctuation">.</span>y <span class="token operator">*</span> <span class="token number">100</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">100</span><span class="token punctuation">;</span>          dataitem<span class="token punctuation">.</span>date <span class="token operator">=</span> weekdata<span class="token punctuation">[</span>day<span class="token punctuation">]</span><span class="token punctuation">.</span>date<span class="token punctuation">;</span>          dataitem<span class="token punctuation">.</span>count <span class="token operator">=</span> weekdata<span class="token punctuation">[</span>day<span class="token punctuation">]</span><span class="token punctuation">.</span>count<span class="token punctuation">;</span>          dataitem<span class="token punctuation">.</span>x <span class="token operator">=</span> setposition<span class="token punctuation">.</span>x<span class="token punctuation">;</span>          dataitem<span class="token punctuation">.</span>y <span class="token operator">=</span> setposition<span class="token punctuation">.</span>y<span class="token punctuation">;</span>          ctx<span class="token punctuation">.</span><span class="token function">fillRect</span><span class="token punctuation">(</span>setposition<span class="token punctuation">.</span>x<span class="token punctuation">,</span> setposition<span class="token punctuation">.</span>y<span class="token punctuation">,</span> lineminwitdh<span class="token punctuation">,</span> lineminwitdh<span class="token punctuation">)</span><span class="token punctuation">;</span>          setposition<span class="token punctuation">.</span>y <span class="token operator">=</span> setposition<span class="token punctuation">.</span>y <span class="token operator">+</span> linemaxwitdh        <span class="token punctuation">&#125;</span>        setposition<span class="token punctuation">.</span>y <span class="token operator">=</span> <span class="token number">0.025</span> <span class="token operator">*</span> width<span class="token punctuation">;</span>        setposition<span class="token punctuation">.</span>x <span class="token operator">=</span> setposition<span class="token punctuation">.</span>x <span class="token operator">+</span> linemaxwitdh      <span class="token punctuation">&#125;</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>document<span class="token punctuation">.</span>body<span class="token punctuation">.</span>clientWidth <span class="token operator">></span> <span class="token number">700</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        ctx<span class="token punctuation">.</span>font <span class="token operator">=</span> <span class="token string">"600  Arial"</span><span class="token punctuation">;</span>        ctx<span class="token punctuation">.</span>fillStyle <span class="token operator">=</span> <span class="token string">'#aaa'</span><span class="token punctuation">;</span>        ctx<span class="token punctuation">.</span><span class="token function">fillText</span><span class="token punctuation">(</span><span class="token string">"日"</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1.9</span> <span class="token operator">*</span> linemaxwitdh<span class="token punctuation">)</span><span class="token punctuation">;</span>        ctx<span class="token punctuation">.</span><span class="token function">fillText</span><span class="token punctuation">(</span><span class="token string">"二"</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">3.9</span> <span class="token operator">*</span> linemaxwitdh<span class="token punctuation">)</span><span class="token punctuation">;</span>        ctx<span class="token punctuation">.</span><span class="token function">fillText</span><span class="token punctuation">(</span><span class="token string">"四"</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">5.9</span> <span class="token operator">*</span> linemaxwitdh<span class="token punctuation">)</span><span class="token punctuation">;</span>        ctx<span class="token punctuation">.</span><span class="token function">fillText</span><span class="token punctuation">(</span><span class="token string">"六"</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">7.9</span> <span class="token operator">*</span> linemaxwitdh<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">var</span> monthindexlist <span class="token operator">=</span> width <span class="token operator">/</span> <span class="token number">24</span><span class="token punctuation">;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> index <span class="token keyword">in</span> visit_monthchange<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>          ctx<span class="token punctuation">.</span><span class="token function">fillText</span><span class="token punctuation">(</span>visit_monthchange<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">,</span> monthindexlist<span class="token punctuation">,</span> <span class="token number">0.7</span> <span class="token operator">*</span> linemaxwitdh<span class="token punctuation">)</span><span class="token punctuation">;</span>          monthindexlist <span class="token operator">=</span> monthindexlist <span class="token operator">+</span> width <span class="token operator">/</span> <span class="token number">12</span>        <span class="token punctuation">&#125;</span>      <span class="token punctuation">&#125;</span>      c<span class="token punctuation">.</span><span class="token function-variable function">onmousemove</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'.visitmessage'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>          visit_tooltip_container<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token string">""</span>        <span class="token punctuation">&#125;</span>        <span class="token function">getMousePos</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> event<span class="token punctuation">)</span>      <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>      visit_tooltip_container<span class="token punctuation">.</span><span class="token function-variable function">onmousemove</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'.visitmessage'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>          visit_tooltip_container<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token string">""</span>        <span class="token punctuation">&#125;</span>      <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>      <span class="token keyword">function</span> <span class="token function">getMousePos</span> <span class="token punctuation">(</span><span class="token parameter">canvas<span class="token punctuation">,</span> event</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">var</span> rect <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getBoundingClientRect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">var</span> x <span class="token operator">=</span> event<span class="token punctuation">.</span>clientX <span class="token operator">-</span> rect<span class="token punctuation">.</span>left <span class="token operator">*</span> <span class="token punctuation">(</span>canvas<span class="token punctuation">.</span>width <span class="token operator">/</span> rect<span class="token punctuation">.</span>width<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">var</span> y <span class="token operator">=</span> event<span class="token punctuation">.</span>clientY <span class="token operator">-</span> rect<span class="token punctuation">.</span>top <span class="token operator">*</span> <span class="token punctuation">(</span>canvas<span class="token punctuation">.</span>height <span class="token operator">/</span> rect<span class="token punctuation">.</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> item <span class="token keyword">of</span> visit_positionplusdata<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>          <span class="token keyword">var</span> lenthx <span class="token operator">=</span> x <span class="token operator">-</span> item<span class="token punctuation">.</span>x<span class="token punctuation">;</span>          <span class="token keyword">var</span> lenthy <span class="token operator">=</span> y <span class="token operator">-</span> item<span class="token punctuation">.</span>y<span class="token punctuation">;</span>          <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">&lt;</span> lenthx <span class="token operator">&amp;&amp;</span> lenthx <span class="token operator">&lt;</span> lineminwitdh<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">&lt;</span> lenthy <span class="token operator">&amp;&amp;</span> lenthy <span class="token operator">&lt;</span> lineminwitdh<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>              visit_span1 <span class="token operator">=</span> item<span class="token punctuation">.</span>date<span class="token punctuation">;</span>              visit_span2 <span class="token operator">=</span> item<span class="token punctuation">.</span>count<span class="token punctuation">;</span>              visit_x <span class="token operator">=</span> event<span class="token punctuation">.</span>clientX <span class="token operator">-</span> <span class="token number">100</span><span class="token punctuation">;</span>              visit_y <span class="token operator">=</span> event<span class="token punctuation">.</span>clientY <span class="token operator">-</span> <span class="token number">60</span><span class="token punctuation">;</span>              html <span class="token operator">=</span> <span class="token function">tooltip_html</span><span class="token punctuation">(</span>visit_x<span class="token punctuation">,</span> visit_y<span class="token punctuation">,</span> visit_span1<span class="token punctuation">,</span> visit_span2<span class="token punctuation">)</span><span class="token punctuation">;</span>              <span class="token function">append_div_visitcalendar</span><span class="token punctuation">(</span>visit_tooltip_container<span class="token punctuation">,</span> html<span class="token punctuation">)</span>            <span class="token punctuation">&#125;</span>          <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>      <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">function</span> <span class="token function">addlastmonth</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>visit_thisdayindex <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token function">thisweekcore</span><span class="token punctuation">(</span><span class="token number">52</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token function">thisweekcore</span><span class="token punctuation">(</span><span class="token number">51</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token function">thisweekcore</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token function">thisweekcore</span><span class="token punctuation">(</span><span class="token number">49</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token function">thisweekcore</span><span class="token punctuation">(</span><span class="token number">48</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      visit_thisweekdatacore <span class="token operator">+=</span> visit_firstdate<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">.</span>count<span class="token punctuation">;</span>      visit_amonthago <span class="token operator">=</span> visit_firstdate<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">.</span>date    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>      <span class="token function">thisweekcore</span><span class="token punctuation">(</span><span class="token number">52</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token function">thisweekcore</span><span class="token punctuation">(</span><span class="token number">51</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token function">thisweekcore</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token function">thisweekcore</span><span class="token punctuation">(</span><span class="token number">49</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token function">thisweek2core</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      visit_amonthago <span class="token operator">=</span> visit_first2date<span class="token punctuation">[</span>visit_thisdayindex <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>date    <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">function</span> <span class="token function">thisweek2core</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> visit_thisdayindex <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> visit_first2date<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      visit_thisweekdatacore <span class="token operator">+=</span> visit_first2date<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>count    <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">function</span> <span class="token function">thisweekcore</span> <span class="token punctuation">(</span><span class="token parameter">index</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> item <span class="token keyword">of</span> visit_data<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      visit_thisweekdatacore <span class="token operator">+=</span> item<span class="token punctuation">.</span>count    <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">function</span> <span class="token function">addlastweek</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> item <span class="token keyword">of</span> visit_lastweek<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      visit_weekdatacore <span class="token operator">+=</span> item<span class="token punctuation">.</span>count    <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">function</span> <span class="token function">addbeforeweek</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> visit_thisdayindex<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> visit_beforeweek<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      visit_weekdatacore <span class="token operator">+=</span> visit_beforeweek<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>count    <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">function</span> <span class="token function">addweek</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>visit_thisdayindex <span class="token operator">===</span> <span class="token number">6</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      visit_aweekago <span class="token operator">=</span> visit_lastweek<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>date<span class="token punctuation">;</span>      <span class="token function">addlastweek</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>      lastweek <span class="token operator">=</span> data<span class="token punctuation">.</span>contributions<span class="token punctuation">[</span><span class="token number">51</span><span class="token punctuation">]</span><span class="token punctuation">;</span>      visit_aweekago <span class="token operator">=</span> lastweek<span class="token punctuation">[</span>visit_thisdayindex <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>date<span class="token punctuation">;</span>      <span class="token function">addlastweek</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token function">addbeforeweek</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">function</span> <span class="token function">spArr</span> <span class="token punctuation">(</span><span class="token parameter">arr<span class="token punctuation">,</span> num</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> newArr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> arr<span class="token punctuation">.</span>length<span class="token punctuation">;</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      newArr<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>arr<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> i <span class="token operator">+=</span> num<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">return</span> newArr  <span class="token punctuation">&#125;</span>  <span class="token function">fetch</span><span class="token punctuation">(</span>visit_apiurl<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">data</span> <span class="token operator">=></span> data<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">var</span> date_arr <span class="token operator">=</span> res<span class="token punctuation">.</span>result<span class="token punctuation">.</span>items<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">var</span> value_arr <span class="token operator">=</span> res<span class="token punctuation">.</span>result<span class="token punctuation">.</span>items<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">var</span> total <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token keyword">var</span> contributions <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> date_arr<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>value_arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">!==</span> <span class="token string">'--'</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        contributions<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> date<span class="token operator">:</span> date_arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\/</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">'-'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> count<span class="token operator">:</span> value_arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        total <span class="token operator">+=</span> value_arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>      <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>        contributions<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> date<span class="token operator">:</span> date_arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\/</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">'-'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> count<span class="token operator">:</span> <span class="token number">0</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">var</span> data <span class="token operator">=</span> <span class="token punctuation">&#123;</span>      total<span class="token operator">:</span> total<span class="token punctuation">,</span>      contributions<span class="token operator">:</span> <span class="token function">spArr</span><span class="token punctuation">(</span>contributions<span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>    visit_data <span class="token operator">=</span> data<span class="token punctuation">.</span>contributions<span class="token punctuation">;</span>    visit_total <span class="token operator">=</span> data<span class="token punctuation">.</span>total<span class="token punctuation">;</span>    visit_first2date <span class="token operator">=</span> visit_data<span class="token punctuation">[</span><span class="token number">48</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    visit_firstdate <span class="token operator">=</span> visit_data<span class="token punctuation">[</span><span class="token number">47</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    visit_firstweek <span class="token operator">=</span> data<span class="token punctuation">.</span>contributions<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    visit_lastweek <span class="token operator">=</span> data<span class="token punctuation">.</span>contributions<span class="token punctuation">[</span><span class="token number">52</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    visit_beforeweek <span class="token operator">=</span> data<span class="token punctuation">.</span>contributions<span class="token punctuation">[</span><span class="token number">51</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    visit_thisdayindex <span class="token operator">=</span> visit_lastweek<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>    visit_thisday <span class="token operator">=</span> visit_lastweek<span class="token punctuation">[</span>visit_thisdayindex<span class="token punctuation">]</span><span class="token punctuation">.</span>date<span class="token punctuation">;</span>    visit_oneyearbeforeday <span class="token operator">=</span> visit_firstweek<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>date<span class="token punctuation">;</span>    visit_monthindex <span class="token operator">=</span> visit_thisday<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">1</span><span class="token punctuation">;</span>    visit_montharrbefore <span class="token operator">=</span> visit_month<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>visit_monthindex<span class="token punctuation">,</span> <span class="token number">12</span> <span class="token operator">-</span> visit_monthindex<span class="token punctuation">)</span><span class="token punctuation">;</span>    visit_monthchange <span class="token operator">=</span> visit_montharrbefore<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>visit_month<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">addweek</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">addlastmonth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">var</span> html <span class="token operator">=</span> <span class="token function">visit_main_box</span><span class="token punctuation">(</span>visit_monthchange<span class="token punctuation">,</span> visit_data<span class="token punctuation">,</span> visit_color<span class="token punctuation">,</span> visit_total<span class="token punctuation">,</span> visit_thisweekdatacore<span class="token punctuation">,</span> visit_weekdatacore<span class="token punctuation">,</span> visit_oneyearbeforeday<span class="token punctuation">,</span> visit_thisday<span class="token punctuation">,</span> visit_aweekago<span class="token punctuation">,</span> visit_amonthago<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">append_div_visitcalendar</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'visit_container'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> html<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'visit_loading'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'visit_loading'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>    <span class="token function">responsiveChart</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  window<span class="token punctuation">.</span><span class="token function-variable function">onresize</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token function">responsiveChart</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>  window<span class="token punctuation">.</span><span class="token function-variable function">onscroll</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'.visitmessage'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      visit_tooltip_container<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token string">""</span>    <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>  <span class="token keyword">var</span> <span class="token function-variable function">visit_thiscolor</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">color<span class="token punctuation">,</span> x</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>metrics <span class="token operator">===</span> <span class="token string">'pv_count'</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>x <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>x <span class="token operator">/</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> color<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>      <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>x <span class="token operator">&lt;</span> <span class="token number">20</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> color<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>      <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>x <span class="token operator">&lt;</span> <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>x <span class="token operator">/</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> color<span class="token punctuation">[</span>i<span class="token punctuation">]</span>      <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> color<span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span>      <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>x <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>x <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> color<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>      <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>x <span class="token operator">&lt;</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> color<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>      <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>x <span class="token operator">&lt;</span> <span class="token number">20</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>x <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> color<span class="token punctuation">[</span>i<span class="token punctuation">]</span>      <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> color<span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span>      <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>  <span class="token keyword">var</span> <span class="token function-variable function">tooltip_html</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> span1<span class="token punctuation">,</span> span2</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">var</span> html <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>    html <span class="token operator">+=</span> <span class="token string">'&lt;div class="visitmessage" style="top:'</span> <span class="token operator">+</span> y <span class="token operator">+</span> <span class="token string">'px;left:'</span> <span class="token operator">+</span> x <span class="token operator">+</span> <span class="token string">'px;position: fixed;z-index:9999">&lt;div class="angle-wrapper" style="display:block;">&lt;span>'</span> <span class="token operator">+</span> span1 <span class="token operator">+</span> <span class="token string">'&amp;nbsp;&lt;/span>&lt;span>'</span> <span class="token operator">+</span> span2 <span class="token operator">+</span> <span class="token string">' '</span> <span class="token operator">+</span> metrics_name <span class="token operator">+</span> <span class="token string">'访问&lt;/span>&lt;/div>&lt;/div>'</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> html  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>  <span class="token keyword">var</span> <span class="token function-variable function">visit_canvas_box</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">var</span> html <span class="token operator">=</span> <span class="token string">'&lt;div id="visitcalendarcanvasbox"> &lt;canvas id="visitcanvas" style="animation: none;">&lt;/canvas>&lt;/div>'</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> html  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>  <span class="token keyword">var</span> <span class="token function-variable function">visit_info_box</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">color</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">var</span> html <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>    html <span class="token operator">+=</span> <span class="token string">'&lt;div id="visit_tooltip_container">&lt;/div>&lt;div class="contrib-footer clearfix mt-1 mx-3 px-3 pb-1">&lt;div class="float-left text-gray">数据来源 &lt;a href="https://tongji.baidu.com/" target="blank">百度统计&lt;/a>&lt;/div>&lt;div class="contrib-legend text-gray">Less &lt;ul class="legend">&lt;li style="background-color:'</span> <span class="token operator">+</span> color<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">'">&lt;/li>&lt;li style="background-color:'</span> <span class="token operator">+</span> color<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">'">&lt;/li>&lt;li style="background-color:'</span> <span class="token operator">+</span> color<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">'">&lt;/li>&lt;li style="background-color:'</span> <span class="token operator">+</span> color<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">'">&lt;/li>&lt;li style="background-color:'</span> <span class="token operator">+</span> color<span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">'">&lt;/li>&lt;/ul>More &lt;/div>&lt;/div>'</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> html  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>  <span class="token keyword">var</span> <span class="token function-variable function">visit_main_box</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">monthchange<span class="token punctuation">,</span> visit_data<span class="token punctuation">,</span> color<span class="token punctuation">,</span> total<span class="token punctuation">,</span> thisweekdatacore<span class="token punctuation">,</span> weekdatacore<span class="token punctuation">,</span> oneyearbeforeday<span class="token punctuation">,</span> thisday<span class="token punctuation">,</span> aweekago<span class="token punctuation">,</span> amonthago</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">var</span> html <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>    <span class="token keyword">var</span> canvasbox <span class="token operator">=</span> <span class="token function">visit_canvas_box</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">var</span> infobox <span class="token operator">=</span> <span class="token function">visit_info_box</span><span class="token punctuation">(</span>color<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">var</span> style <span class="token operator">=</span> <span class="token function">visit_main_style</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    html <span class="token operator">+=</span> <span class="token string">'&lt;div class="position-relative">&lt;div>&lt;span class="visit_title">博客访问日历&lt;/span>&lt;/div>&lt;div class="border py-2 graph-before-activity-overview">&lt;div class="js-visitcalendar-graph mx-md-2 mx-3 d-flex flex-column flex-items-end flex-xl-items-center overflow-hidden pt-1 is-graph-loading graph-canvas visitcalendar-graph height-full text-center">'</span> <span class="token operator">+</span> canvasbox <span class="token operator">+</span> <span class="token string">'&lt;/div>'</span> <span class="token operator">+</span> infobox <span class="token operator">+</span> <span class="token string">'&lt;/div>&lt;/div>'</span><span class="token punctuation">;</span>    html <span class="token operator">+=</span> <span class="token string">'&lt;div style="display:flex;width:100%">&lt;div class="contrib-column contrib-column-first table-column">&lt;span class="text-muted">过去一年访问&lt;/span>&lt;span class="contrib-number">'</span> <span class="token operator">+</span> total <span class="token operator">+</span> <span class="token string">'&lt;/span>&lt;span class="text-muted">'</span> <span class="token operator">+</span> oneyearbeforeday <span class="token operator">+</span> <span class="token string">'&amp;nbsp;-&amp;nbsp;'</span> <span class="token operator">+</span> thisday <span class="token operator">+</span> <span class="token string">'&lt;/span>&lt;/div>&lt;div class="contrib-column table-column">&lt;span class="text-muted">最近一月访问&lt;/span>&lt;span class="contrib-number">'</span> <span class="token operator">+</span> thisweekdatacore <span class="token operator">+</span> <span class="token string">'&lt;/span>&lt;span class="text-muted">'</span> <span class="token operator">+</span> amonthago <span class="token operator">+</span> <span class="token string">'&amp;nbsp;-&amp;nbsp;'</span> <span class="token operator">+</span> thisday <span class="token operator">+</span> <span class="token string">'&lt;/span>&lt;/div>&lt;div class="contrib-column table-column">&lt;span class="text-muted">最近一周访问&lt;/span>&lt;span class="contrib-number">'</span> <span class="token operator">+</span> weekdatacore <span class="token operator">+</span> <span class="token string">'&lt;/span>&lt;span class="text-muted">'</span> <span class="token operator">+</span> aweekago <span class="token operator">+</span> <span class="token string">'&amp;nbsp;-&amp;nbsp;'</span> <span class="token operator">+</span> thisday <span class="token operator">+</span> <span class="token string">'&lt;/span>&lt;/div>&lt;/div>'</span> <span class="token operator">+</span> style<span class="token punctuation">;</span>    <span class="token keyword">return</span> html  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>  <span class="token keyword">var</span> <span class="token function-variable function">visit_main_style</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    style <span class="token operator">=</span> <span class="token string">'&lt;style>#visit_container&#123;text-align:center;margin:0 auto;width:100%;padding:10px;display:flex;display:-webkit-flex;justify-content:center;align-items:center;flex-wrap:wrap;&#125;.visit_title&#123;font-size:1rem;font-weight:550;&#125;.visitcalendar-graph text.wday,.visitcalendar-graph text.month&#123;font-size:10px;fill:#aaa;&#125;.contrib-legend&#123;text-align:right;padding:0 14px 10px 0;display:inline-block;float:right;&#125;.contrib-legend .legend&#123;display:inline-block;list-style:none;margin:0 5px;position:relative;bottom:-7px;padding:0;&#125;.contrib-legend .legend li&#123;display:inline-block;width:10px;height:10px;&#125;.text-small&#123;font-size:12px;color:#767676;&#125;.visitcalendar-graph&#123;padding:15px 0 0;text-align:center;&#125;.contrib-column&#123;text-align:center;border-left:1px solid #ddd;border-top:1px solid #ddd;&#125;.contrib-column-first&#123;border-left:0;&#125;.table-column&#123;padding:10px;display:table-cell;flex:1;vertical-align:top;&#125;.contrib-number&#123;font-weight:400;line-height:1.3em;font-size:24px;display:block;&#125;.visitcalendar img.spinner&#123;width:70px;margin-top:50px;min-height:70px;&#125;.monospace&#123;text-align:center;color:#000;font-family:monospace;&#125;.monospace a&#123;color:#1D75AB;text-decoration:none;&#125;.contrib-footer&#123;font-size:11px;padding:0 10px 12px;text-align:left;width:100%;box-sizing:border-box;height:26px;&#125;.left.text-muted&#123;float:left;margin-left:9px;color:#767676;&#125;.left.text-muted a&#123;color:#4078c0;text-decoration:none;&#125;.left.text-muted a:hover,.monospace a:hover&#123;text-decoration:underline;&#125;h2.f4.text-normal.mb-3&#123;display:none;&#125;.float-left.text-gray&#123;float:left;&#125;#user-activity-overview&#123;display:none;&#125;.day-tooltip&#123;white-space:nowrap;position:absolute;z-index:99999;padding:10px;font-size:12px;color:#959da5;text-align:center;background:rgba(0,0,0,.85);border-radius:3px;display:none;pointer-events:none;&#125;.day-tooltip strong&#123;color:#dfe2e5;&#125;.day-tooltip.is-visible&#123;display:block;&#125;.day-tooltip:after&#123;position:absolute;bottom:-10px;left:50%;width:5px;height:5px;box-sizing:border-box;margin:0 0 0 -5px;content:" ";border:5px solid transparent;border-top-color:rgba(0,0,0,.85)&#125;.position-relative&#123;width:100%;&#125;@media screen and (max-width:650px)&#123;.contrib-column&#123;display:none&#125;&#125;.angle-wrapper&#123;z-index:9999;display:inline;width:200px;height:40px;position:relative;padding:5px 0;background:rgba(0,0,0,0.8);border-radius:8px;text-align:center;color:white;&#125;.angle-box&#123;position:fixed;padding:10px&#125;.angle-wrapper span&#123;padding-bottom:1em;&#125;.angle-wrapper:before&#123;content:"";width:0;height:0;border:10px solid transparent;border-top-color:rgba(0,0,0,0.8);position:absolute;left:47.5%;top:100%;&#125;&lt;/style>'</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> style  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token keyword">var</span> <span class="token function-variable function">append_div_visitcalendar</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">parent<span class="token punctuation">,</span> text</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>parent <span class="token operator">!==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> text <span class="token operator">===</span> <span class="token string">'string'</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token keyword">var</span> temp <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      temp<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> text<span class="token punctuation">;</span>      <span class="token keyword">var</span> frag <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createDocumentFragment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token keyword">while</span> <span class="token punctuation">(</span>temp<span class="token punctuation">.</span>firstChild<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        frag<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>temp<span class="token punctuation">.</span>firstChild<span class="token punctuation">)</span>      <span class="token punctuation">&#125;</span>      parent<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>frag<span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>      parent<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token keyword">var</span> <span class="token function-variable function">loading_visit</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">color</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>  loading <span class="token operator">=</span> <span class="token string">'&lt;div id="visit_loading" style="width:10%;height:100%;margin:0 auto;display: block">&lt;svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"  viewBox="0 0 50 50" style="enable-background:new 0 0 50 50" xml:space="preserve">&lt;path fill="'</span> <span class="token operator">+</span> color <span class="token operator">+</span> <span class="token string">'" d="M25.251,6.461c-10.318,0-18.683,8.365-18.683,18.683h4.068c0-8.071,6.543-14.615,14.615-14.615V6.461z" transform="rotate(275.098 25 25)">&lt;animateTransform attributeType="xml" attributeName="transform" type="rotate" from="0 25 25" to="360 25 25" dur="0.6s" repeatCount="indefinite">&lt;/animateTransform>&lt;/path>&lt;/svg>&lt;/div>'</span><span class="token punctuation">;</span>  <span class="token keyword">return</span> loading<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">init</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">var</span> visit_container <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'visit_container'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">var</span> visit_loading <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'visit_loading'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">var</span> visit_purple <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'#d7dbe2'</span><span class="token punctuation">,</span> <span class="token string">'#fdcdec'</span><span class="token punctuation">,</span> <span class="token string">'#fc9bd9'</span><span class="token punctuation">,</span> <span class="token string">'#fa6ac5'</span><span class="token punctuation">,</span> <span class="token string">'#f838b2'</span><span class="token punctuation">,</span> <span class="token string">'#f5089f'</span><span class="token punctuation">,</span> <span class="token string">'#c4067e'</span><span class="token punctuation">,</span> <span class="token string">'#92055e'</span><span class="token punctuation">,</span> <span class="token string">'#540336'</span><span class="token punctuation">,</span> <span class="token string">'#48022f'</span><span class="token punctuation">,</span> <span class="token string">'#30021f'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token keyword">var</span> visit_yellow <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'#d7dbe2'</span><span class="token punctuation">,</span> <span class="token string">'#f9f4dc'</span><span class="token punctuation">,</span> <span class="token string">'#f7e8aa'</span><span class="token punctuation">,</span> <span class="token string">'#f7e8aa'</span><span class="token punctuation">,</span> <span class="token string">'#f8df72'</span><span class="token punctuation">,</span> <span class="token string">'#fcd217'</span><span class="token punctuation">,</span> <span class="token string">'#fcc515'</span><span class="token punctuation">,</span> <span class="token string">'#f28e16'</span><span class="token punctuation">,</span> <span class="token string">'#fb8b05'</span><span class="token punctuation">,</span> <span class="token string">'#d85916'</span><span class="token punctuation">,</span> <span class="token string">'#f43e06'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token keyword">var</span> visit_green <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'#d7dbe2'</span><span class="token punctuation">,</span> <span class="token string">'#f0fff4'</span><span class="token punctuation">,</span> <span class="token string">'#dcffe4'</span><span class="token punctuation">,</span> <span class="token string">'#bef5cb'</span><span class="token punctuation">,</span> <span class="token string">'#85e89d'</span><span class="token punctuation">,</span> <span class="token string">'#34d058'</span><span class="token punctuation">,</span> <span class="token string">'#28a745'</span><span class="token punctuation">,</span> <span class="token string">'#22863a'</span><span class="token punctuation">,</span> <span class="token string">'#176f2c'</span><span class="token punctuation">,</span> <span class="token string">'#165c26'</span><span class="token punctuation">,</span> <span class="token string">'#144620'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token keyword">var</span> visit_blue <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'#d7dbe2'</span><span class="token punctuation">,</span> <span class="token string">'#f1f8ff'</span><span class="token punctuation">,</span> <span class="token string">'#dbedff'</span><span class="token punctuation">,</span> <span class="token string">'#c8e1ff'</span><span class="token punctuation">,</span> <span class="token string">'#79b8ff'</span><span class="token punctuation">,</span> <span class="token string">'#2188ff'</span><span class="token punctuation">,</span> <span class="token string">'#0366d6'</span><span class="token punctuation">,</span> <span class="token string">'#005cc5'</span><span class="token punctuation">,</span> <span class="token string">'#044289'</span><span class="token punctuation">,</span> <span class="token string">'#032f62'</span><span class="token punctuation">,</span> <span class="token string">'#05264c'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token keyword">var</span> visit_color <span class="token operator">=</span> visit_purple<span class="token punctuation">;</span>  <span class="token function">append_div_visitcalendar</span><span class="token punctuation">(</span>visit_container<span class="token punctuation">,</span> <span class="token function">loading_visit</span><span class="token punctuation">(</span>visit_color<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 统计访问次数 PV 填写 'pv_count'，统计访客数 UV 填写 'visitor_count'，二选一</span>  <span class="token function">visit_calendar</span><span class="token punctuation">(</span><span class="token string">'16****'</span><span class="token punctuation">,</span> <span class="token string">'121.c644d8c4*****'</span><span class="token punctuation">,</span> <span class="token string">'pv_count'</span><span class="token punctuation">,</span> visit_color<span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h2 id="自建-Vercel-API（可选）"><a href="#自建-Vercel-API（可选）" class="headerlink" title="自建 Vercel API（可选）"></a>自建 Vercel API（可选）</h2><p>由于在 js 文件中请求百度统计 API 获取数据会出现跨域请求的错误。</p><p>博主参考 Akilar 的 <a href="https://akilar.top/posts/1f9c68c9/">基于 Butterfly 主题的首页置顶 gitcalendar</a> 自建 Vercel API 部署教程，以及冰老师的 <a href="https://github.com/Zfour/python_github_calendar_api">python_github_calendar_api</a> 搭建了获取百度统计数据的 Vercel API，力求解决百度统计 API 的跨域请求问题，但是仍然有时会出现跨域问题。</p><p><a class="ghcard" rel="external nofollow noopener noreferrer" href="https://github.com/Eurkon/baidu-tongji-api"><img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="https://github-readme-stats.vercel.app/api/pin/?username=Eurkon&repo=baidu-tongji-api&show_owner=true"></a></p><p>虽然 Vercel 的访问应当没有次数限制，但是不排除存在因访问次数过多而限流等限制。所以还是建议各位自建 API。使用 Vercel 部署，完全免费。且无需服务器。</p><p>部署完成后将获取到的默认域名替换 <code>census.js</code> 文件中的 <code>visit_apiurl</code>，如：</p><p><pre class="line-numbers language-DIFF" data-language="DIFF"><code class="language-DIFF">- var visit_apiurl &#x3D; &#39;https:&#x2F;&#x2F;baidu-tongji-api.vercel.app&#x2F;api?site_id&#x3D;&#39; + site_id + &#39;&amp;access_token&#x3D;&#39; + access_token + &#39;&amp;method&#x3D;overview&#x2F;getTimeTrendRpt&#39; + &#39;&amp;metrics&#x3D;&#39; + metrics + &#39;&amp;start_date&#x3D;&#39; + start_date + &#39;&amp;end_date&#x3D;&#39; + end_date;+ var visit_apiurl &#x3D; &#39;https:&#x2F;&#x2F;域名&#x2F;api?site_id&#x3D;&#39; + site_id + &#39;&amp;access_token&#x3D;&#39; + access_token + &#39;&amp;method&#x3D;overview&#x2F;getTimeTrendRpt&#39; + &#39;&amp;metrics&#x3D;&#39; + metrics + &#39;&amp;start_date&#x3D;&#39; + start_date + &#39;&amp;end_date&#x3D;&#39; + end_date;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></p><h1 id="使用访问日历"><a href="#使用访问日历" class="headerlink" title="使用访问日历"></a>使用访问日历</h1><p>在需要显示访问日历的 <code>md</code> 文件中添加以下内容：</p><p><pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>visit_container<span class="token punctuation">"</span></span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">="</span><span class="token attr-value"><span class="token property">border-radius</span><span class="token punctuation">:</span> 8px<span class="token punctuation">;</span></span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">defer</span> <span class="token attr-name">data-pjax</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/js/visit_calendar.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></p><h1 id="可能遇到的问题"><a href="#可能遇到的问题" class="headerlink" title="可能遇到的问题"></a>可能遇到的问题</h1><ul><li><p>控制台报错 <code>Access to fetch at &#39;https://baidu-tongji-api.vercel.app/api?...&#39; from origin &#39;http://...&#39; has been blocked by CORS policy: No &#39;Access-Control-Allow-Origin&#39; header is present on the requested resource. If an opaque response serves your needs, set the request&#39;s mode to &#39;no-cors&#39; to fetch the resource with CORS disabled.</code></p><p><strong>解决方案：</strong></p><p>仍在努力解决跨域问题。</p></li></ul>]]></content>
      
      
      <categories>
          
          <category> 教程笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Hexo </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hexo 博客实时访问统计图</title>
      <link href="post/61763977.html"/>
      <url>post/61763977.html</url>
      
        <content type="html"><![CDATA[<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p><strong>本教程仍在测试中，仍然可能出现跨域请求的问题</strong></p><p>本文教程主要针对 Hexo 博客，对博客站点的的访问地图、每月访问量、访问来源的维度绘制统计图，使用的是 <a href="https://echarts.apache.org/examples/zh/index.html">ECharts</a> 开源可视化库。具体效果可以点击本站的 <a href="/census/">实验室--博客统计</a> 页面查看。</p><p><div class="note info simple"><ul><li>本文数据来源均为百度统计，请确保博客站点已加入百度统计，以 butterfly 主题为例，可参照 <a href="https://butterfly.js.org/posts/ceeb73f/#%E5%88%86%E6%9E%90%E7%B5%B1%E8%A8%88">Butterfly 安装文档(四) 主题配置-2</a> 的分析统计段落实现。</li><li>本地主机访问（localhost）也会记录到百度统计，推荐在 <strong>【百度统计】--【管理】--【统计规则设置】--【过滤规则设置】--【受访域名统计规则】--【勾选排除 localhost（本地主机）】</strong> 排除本地主机访问（貌似在勾选后生效，但是以前的访问记录仍会统计）。</li><li>此文是针对于文章 <a href="/post/ef1da941.html">Hexo 博客访问统计图</a> 改良版，实时调用百度统计 API 获取访问数据。</li><li>本教程将会泄漏属于百度统计的站点 ID 和百度统计 AccessToken，请先前往 <a href="https://tongji.baidu.com/api/manual/">百度统计用户手册</a> 了解，介意者请谨慎部署。</li></ul></div></p><p>如果想绘制博客文章发布统计图的可以参考文章 <a href="/post/1213ef82.html">Hexo 博客文章统计图</a></p><h1 id="新建-census-页面"><a href="#新建-census-页面" class="headerlink" title="新建 census 页面"></a>新建 census 页面</h1><p><div class="tabs" id="tab"><ul class="nav-tabs"><li class="tab"><button type="button" data-href="#tab-1">使用命令创建</button></li><li class="tab"><button type="button" data-href="#tab-2">手动创建</button></li></ul><div class="tab-contents"><div class="tab-item-content" id="tab-1"><p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">hexo new page census<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="tab-2"><p>在 <code>[Blogroot]\source\</code> 目录下新建 <code>census</code> 文件夹，并在新建的 <code>census</code> 文件夹下新建 <code>index.md</code> 文件，添加以下内容：</p><p><pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown"><span class="token hr punctuation">---</span>title: 博客统计<span class="token title important">date: 2020-03-01 08:00:00<span class="token punctuation">---</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div></p><h1 id="引入-ECharts-js"><a href="#引入-ECharts-js" class="headerlink" title="引入 ECharts.js"></a>引入 ECharts.js</h1><p><div class="note info simple"><p>echarts.js 必须在渲染 echarts 实例的 JavaScript 前引入。</p></div></p><p><div class="tabs" id="tab"><ul class="nav-tabs"><li class="tab"><button type="button" data-href="#tab-1">全局引入</button></li><li class="tab"><button type="button" data-href="#tab-2">页面引入</button></li></ul><div class="tab-contents"><div class="tab-item-content" id="tab-1"><p>以 butterfly 主题为例，可以在 <code>[Blogroot]\_config.butterfly.yml</code> 的 <code>inject</code> 配置项中引入 <code>echart.js</code> 文件。</p><p><pre class="line-numbers language-yml" data-language="yml"><code class="language-yml">inject:  head:    - &lt;script src&#x3D;&quot;https:&#x2F;&#x2F;cdn.jsdelivr.net&#x2F;npm&#x2F;echarts@4.7.0&#x2F;dist&#x2F;echarts.min.js&quot;&gt;&lt;&#x2F;script&gt;    - &lt;script src&#x3D;&quot;https:&#x2F;&#x2F;cdn.jsdelivr.net&#x2F;npm&#x2F;echarts@4.7.0&#x2F;map&#x2F;js&#x2F;china.js&quot;&gt;&lt;&#x2F;script&gt; # 绘制地图需要另外添加 china.js<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="tab-2"><p>可以在 <code>index.md</code> 添加以下内容：</p><p><pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://cdn.jsdelivr.net/npm/echarts@4.7.0/dist/echarts.min.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://cdn.jsdelivr.net/npm/echarts@4.7.0/map/js/china.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span> <span class="token comment">&lt;!-- 绘制地图需要另外添加 china.js --></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div></p><h1 id="博客访问统计"><a href="#博客访问统计" class="headerlink" title="博客访问统计"></a>博客访问统计</h1><h2 id="获取网站统计数据"><a href="#获取网站统计数据" class="headerlink" title="获取网站统计数据"></a>获取网站统计数据</h2><ol><li><p>已经添加百度统计分析的小伙伴可以登录<a href="https://tongji.baidu.com/web/welcome/login">百度统计</a>的官网网站，此处博主使用的是百度账号登录。</p><p> <img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="/images/post/hexo_census/login.png" alt></p></li><li><p>登录进入首页后可以点击<strong>基础报告</strong>查看网站访问统计数据（若无绑定网站，需要先在 <strong>管理</strong>页面--<strong>账户管理</strong>--<strong>网站列表</strong> 添加博客网址）。</p><p> <img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="/images/post/hexo_census/index.png" alt></p></li><li><p>此时我们想要获取这些数据可以调用<strong>百度统计 API</strong>，点击<strong>管理</strong>，进入管理页面后在左边侧边栏找到<strong>数据导出服务</strong>。</p><p> <img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="/images/post/hexo_census/data_export.png" alt></p></li><li><p>登录<a href="http://developer.baidu.com/console#app/project">百度开发者中心控制台</a>，创建工程，应用名称任意。</p><p> <img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="/images/post/hexo_census/project.png" alt></p></li><li><p>点击刚刚创建的工程，记录下 API Key，Secret Key。</p><p> <img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="/images/post/hexo_census/project_info.png" alt></p></li><li><p>填写下面链接参数后打开链接获取授权码，具体步骤可以参考 <a href="https://tongji.baidu.com/api/manual/">Tongji API用户手册</a>。</p><p> <code>http://openapi.baidu.com/oauth/2.0/authorize?response_type=code&amp;client_id=&#123;CLIENT_ID&#125;&amp;redirect_uri=&#123;REDIRECT_URI&#125;&amp;scope=basic&amp;display=popup</code></p><ul><li>API Key：{CLIENT_ID}</li><li><p>回调 URI：{REDIRECT_URI}，可以填写 <code>oob</code>。</p><p><img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="/images/post/hexo_census/auth_code.png" alt></p></li></ul></li><li><p>复制第 6 步获取的授权码，填写下面链接参数后打开链接获取 <code>ACCESS_TOKEN</code> ：。</p><p> <code>http://openapi.baidu.com/oauth/2.0/token?grant_type=authorization_code&amp;code=&#123;CODE&#125;&amp;client_id=&#123;CLIENT_ID&#125;&amp;client_secret=&#123;CLIENT_SECRET&#125;&amp;redirect_uri=&#123;REDIRECT_URI&#125;</code></p><ul><li>Auth Code：{CODE}，第 6 步获取的授权码。</li><li>API Key：{CLIENT_ID}</li><li>Secret Key：{CLIENT_SECRET}</li><li><p>回调 URI：{REDIRECT_URI}，可以填写 <code>oob</code>。</p><p><img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="/images/post/hexo_census/access_token.png" alt></p></li></ul><p><strong>注意：</strong>从上述步骤得到的数据中包含 <code>ACCESS_TOKEN</code> 和 <code>REFRESH_TOKEN</code> 两个值，其中 <code>ACCESS_TOKEN</code> 的有效期为一个月，<code>REFRESH_TOKEN</code> 的有效期为十年。<code>REFRESH_TOKEN</code> 的作用就是刷新获取新的 <code>ACCESS_TOKEN</code> 和 <code>REFRESH_TOKEN</code> ， 如此反复操作来实现 <code>ACCESS_TOKEN</code> 有效期永久的机制。</p><p>一旦 <code>ACCESS_TOKEN</code> 过期，可根据以下请求更换新的 <code>ACCESS_TOKEN</code> 和 <code>REFRESH_TOKEN</code>：</p><p><code>http://openapi.baidu.com/oauth/2.0/token?grant_type=refresh_token&amp;refresh_token=&#123;REFRESH_TOKEN&#125;&amp;client_id=&#123;CLIENT_ID&#125;&amp;client_secret=&#123;CLIENT_SECRET&#125;</code></p><ul><li>API Key：{CLIENT_ID}</li><li>Secret Key：{CLIENT_SECRET}</li><li>Refresh Token：{REFRESH_TOKEN}</li></ul></li><li><p>调用百度统计API</p><p> 第 7 步获取的 <code>ACCESS_TOKEN</code> 是所调用 API 的用户级参数，结合各 API 的应用级参数即可正常调用 API 获取数据，填写下面链接参数后打开链接获取网站 ID：</p><p> <code>https://openapi.baidu.com/rest/2.0/tongji/config/getSiteList?access_token=&#123;ACCESS_TOKEN&#125;</code></p><ul><li><p>Access Token：{ACCESS_TOKEN}</p><p><img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="/images/post/hexo_census/site_id.png" alt></p></li></ul><p>也可以在 <a href="https://tongji.baidu.com/api/debug/#">Tongji API调试工具</a> 输入 <code>ACCESS_TOKEN</code> 获取网址 ID：</p><p> <img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="/images/post/hexo_census/site_id_debug.png" alt></p></li><li><p>在 <a href="https://tongji.baidu.com/api/debug/#">Tongji API调试工具</a> 选择需要获取的报告数据，填写 <code>ACCESS_TOKEN</code> 、必填参数、选填参数获取百度统计数据。</p></li></ol><p><img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="/images/post/hexo_census/site_data.png" alt></p><h2 id="网站统计代码"><a href="#网站统计代码" class="headerlink" title="网站统计代码"></a>网站统计代码</h2><p>以 butterfly 主题为例，可以在 <code>[Blogroot]\js\</code> 目录下新建 <code>census.js</code> 文件，然后添加以下内容：</p><p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> start_date <span class="token operator">=</span> <span class="token string">'20210101'</span> <span class="token comment">// 开始日期</span><span class="token keyword">var</span> date <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> end_date <span class="token operator">=</span> date<span class="token punctuation">.</span><span class="token function">getFullYear</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span>date<span class="token punctuation">.</span><span class="token function">getMonth</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">8</span> <span class="token operator">?</span> <span class="token punctuation">(</span>date<span class="token punctuation">.</span><span class="token function">getMonth</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token punctuation">(</span><span class="token string">"0"</span> <span class="token operator">+</span> <span class="token punctuation">(</span>date<span class="token punctuation">.</span><span class="token function">getMonth</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span>date<span class="token punctuation">.</span><span class="token function">getDate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">9</span> <span class="token operator">?</span> date<span class="token punctuation">.</span><span class="token function">getDate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token punctuation">(</span><span class="token string">"0"</span> <span class="token operator">+</span> date<span class="token punctuation">.</span><span class="token function">getDate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 结束日期</span><span class="token keyword">var</span> access_token <span class="token operator">=</span> <span class="token string">'121.c644d8c4*****'</span> <span class="token comment">// accessToken</span><span class="token keyword">var</span> site_id <span class="token operator">=</span> <span class="token string">'16****'</span> <span class="token comment">// 网址id</span><span class="token keyword">var</span> dataUrl <span class="token operator">=</span> <span class="token string">'https://baidu-tongji-api.vercel.app/api?access_token='</span> <span class="token operator">+</span> access_token <span class="token operator">+</span> <span class="token string">'&amp;site_id='</span> <span class="token operator">+</span> site_id<span class="token keyword">var</span> metrics <span class="token operator">=</span> <span class="token string">'pv_count'</span> <span class="token comment">// 统计访问次数 PV 填写 'pv_count'，统计访客数 UV 填写 'visitor_count'，二选一</span><span class="token keyword">var</span> metricsName <span class="token operator">=</span> <span class="token punctuation">(</span>metrics <span class="token operator">===</span> <span class="token string">'pv_count'</span> <span class="token operator">?</span> <span class="token string">'访问次数'</span> <span class="token operator">:</span> <span class="token punctuation">(</span>metrics <span class="token operator">===</span> <span class="token string">'visitor_count'</span> <span class="token operator">?</span> <span class="token string">'访客数'</span> <span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">// 这里为了统一颜色选取的是“明暗模式”下的两种字体颜色，也可以自己定义</span><span class="token keyword">var</span> color <span class="token operator">=</span> document<span class="token punctuation">.</span>documentElement<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">'data-theme'</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string">'light'</span> <span class="token operator">?</span> <span class="token string">'#4c4948'</span> <span class="token operator">:</span> <span class="token string">'rgba(255,255,255,0.7)'</span><span class="token comment">// 访问地图</span><span class="token keyword">function</span> <span class="token function">mapChart</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">let</span> script <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"script"</span><span class="token punctuation">)</span>  <span class="token keyword">let</span> paramUrl <span class="token operator">=</span> <span class="token string">'&amp;start_date='</span> <span class="token operator">+</span> start_date <span class="token operator">+</span> <span class="token string">'&amp;end_date='</span> <span class="token operator">+</span> end_date <span class="token operator">+</span> <span class="token string">'&amp;metrics='</span> <span class="token operator">+</span> metrics <span class="token operator">+</span> <span class="token string">'&amp;method=visit/district/a'</span><span class="token punctuation">;</span>  <span class="token function">fetch</span><span class="token punctuation">(</span>dataUrl <span class="token operator">+</span> paramUrl<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">data</span> <span class="token operator">=></span> data<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">data</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> mapName <span class="token operator">=</span> data<span class="token punctuation">.</span>result<span class="token punctuation">.</span>items<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>    <span class="token keyword">let</span> mapValue <span class="token operator">=</span> data<span class="token punctuation">.</span>result<span class="token punctuation">.</span>items<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>    <span class="token keyword">let</span> mapArr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>    <span class="token keyword">let</span> max <span class="token operator">=</span> mapValue<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> mapName<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      mapArr<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> name<span class="token operator">:</span> mapName<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>name<span class="token punctuation">,</span> value<span class="token operator">:</span> mapValue<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">let</span> mapArrJson <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>mapArr<span class="token punctuation">)</span>    script<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">      var mapChart = echarts.init(document.getElementById('map-chart'), 'light');      var mapOption = &#123;        title: &#123;          text: '博客访问来源地图',          x: 'center',          textStyle: &#123;            color: '</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>color<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">'          &#125;        &#125;,        tooltip: &#123;          trigger: 'item'        &#125;,        visualMap: &#123;          min: 0,          max: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>max<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">,          left: 'left',          top: 'bottom',          text: ['高','低'],          color: ['#1E90FF', '#AAFAFA'],          textStyle: &#123;            color: '</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>color<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">'          &#125;,          calculable: true        &#125;,        series: [&#123;          name: '</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>metricsName<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">',          type: 'map',          mapType: 'china',          showLegendSymbol: false,          label: &#123;            emphasis: &#123;              show: false            &#125;          &#125;,          itemStyle: &#123;            normal: &#123;              areaColor: 'rgba(255, 255, 255, 0.1)',              borderColor: '#121212'            &#125;,            emphasis: &#123;              areaColor: 'gold'            &#125;          &#125;,          data: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>mapArrJson<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">          &#125;]        &#125;;      mapChart.setOption(mapOption);      window.addEventListener("resize", () => &#123;         mapChart.resize();      &#125;);</span><span class="token template-punctuation string">`</span></span>    document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'map-chart'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">after</span><span class="token punctuation">(</span>script<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">// 访问趋势</span><span class="token keyword">function</span> <span class="token function">trendsChart</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">let</span> script <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"script"</span><span class="token punctuation">)</span>  <span class="token keyword">let</span> paramUrl <span class="token operator">=</span> <span class="token string">'&amp;start_date='</span> <span class="token operator">+</span> start_date <span class="token operator">+</span> <span class="token string">'&amp;end_date='</span> <span class="token operator">+</span> end_date <span class="token operator">+</span> <span class="token string">'&amp;metrics='</span> <span class="token operator">+</span> metrics <span class="token operator">+</span> <span class="token string">'&amp;method=trend/time/a&amp;gran=month'</span>  <span class="token function">fetch</span><span class="token punctuation">(</span>dataUrl <span class="token operator">+</span> paramUrl<span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">data</span> <span class="token operator">=></span> data<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">data</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>      <span class="token keyword">let</span> monthArr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>      <span class="token keyword">let</span> monthValueArr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>      <span class="token keyword">let</span> monthName <span class="token operator">=</span> data<span class="token punctuation">.</span>result<span class="token punctuation">.</span>items<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>      <span class="token keyword">let</span> monthValue <span class="token operator">=</span> data<span class="token punctuation">.</span>result<span class="token punctuation">.</span>items<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span>monthName<span class="token punctuation">.</span>length<span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">>=</span> <span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        monthArr<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>monthName<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token string">'-'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>monthValue<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">!==</span> <span class="token string">'--'</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>          monthValueArr<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>monthValue<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>          monthValueArr<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span>        <span class="token punctuation">&#125;</span>      <span class="token punctuation">&#125;</span>      <span class="token keyword">let</span> monthArrJson <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>monthArr<span class="token punctuation">)</span>      <span class="token keyword">let</span> monthValueArrJson <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>monthValueArr<span class="token punctuation">)</span>      script<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">        var trendsChart = echarts.init(document.getElementById('trends-chart'), 'light');        var trendsOption = &#123;          textStyle: &#123;            color: '</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>color<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">'          &#125;,          title: &#123;            text: '博客访问统计图',            x: 'center',            textStyle: &#123;              color: '</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>color<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">'            &#125;          &#125;,          tooltip: &#123;            trigger: 'axis'          &#125;,          xAxis: &#123;            name: '日期',            type: 'category',            axisTick: &#123;              show: false            &#125;,            axisLine: &#123;              show: true,              lineStyle: &#123;                color: '</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>color<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">'              &#125;            &#125;,            data: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>monthArrJson<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">          &#125;,          yAxis: &#123;            name: '</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>metricsName<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">',            type: 'value',            splitLine: &#123;              show: false            &#125;,            axisTick: &#123;              show: false            &#125;,            axisLine: &#123;              show: true,              lineStyle: &#123;                color: '</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>color<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">'              &#125;            &#125;          &#125;,          series: [&#123;            name: '</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>metricsName<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">',            type: 'line',            smooth: true,            lineStyle: &#123;                width: 0            &#125;,            showSymbol: false,            itemStyle: &#123;              opacity: 1,              color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [&#123;                offset: 0,                color: 'rgba(128, 255, 165)'              &#125;,              &#123;                offset: 1,                color: 'rgba(1, 191, 236)'              &#125;])            &#125;,            areaStyle: &#123;              opacity: 1,              color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [&#123;                offset: 0,                color: 'rgba(128, 255, 165)'              &#125;, &#123;                offset: 1,                color: 'rgba(1, 191, 236)'              &#125;])            &#125;,            data: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>monthValueArrJson<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">,            markLine: &#123;              data: [&#123;                name: '平均值',                type: 'average'              &#125;]            &#125;          &#125;]        &#125;;        trendsChart.setOption(trendsOption);        window.addEventListener("resize", () => &#123;           trendsChart.resize();        &#125;);</span><span class="token template-punctuation string">`</span></span>      document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'trends-chart'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">after</span><span class="token punctuation">(</span>script<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">// 访问来源</span><span class="token keyword">function</span> <span class="token function">sourcesChart</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">let</span> script <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"script"</span><span class="token punctuation">)</span>  <span class="token keyword">let</span> paramUrl <span class="token operator">=</span> <span class="token string">'&amp;start_date='</span> <span class="token operator">+</span> start_date <span class="token operator">+</span> <span class="token string">'&amp;end_date='</span> <span class="token operator">+</span> end_date <span class="token operator">+</span> <span class="token string">'&amp;metrics='</span> <span class="token operator">+</span> metrics <span class="token operator">+</span> <span class="token string">'&amp;method=source/all/a'</span><span class="token punctuation">;</span>  <span class="token function">fetch</span><span class="token punctuation">(</span>dataUrl <span class="token operator">+</span> paramUrl<span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">data</span> <span class="token operator">=></span> data<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">data</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>      monthArr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>      <span class="token keyword">let</span> sourcesName <span class="token operator">=</span> data<span class="token punctuation">.</span>result<span class="token punctuation">.</span>items<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>      <span class="token keyword">let</span> sourcesValue <span class="token operator">=</span> data<span class="token punctuation">.</span>result<span class="token punctuation">.</span>items<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>      <span class="token keyword">let</span> sourcesArr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> sourcesName<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        sourcesArr<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> name<span class="token operator">:</span> sourcesName<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>name<span class="token punctuation">,</span> value<span class="token operator">:</span> sourcesValue<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>      <span class="token punctuation">&#125;</span>      <span class="token keyword">let</span> sourcesArrJson <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>sourcesArr<span class="token punctuation">)</span>      script<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">        var sourcesChart = echarts.init(document.getElementById('sources-chart'), 'light');        var sourcesOption = &#123;          textStyle: &#123;            color: '</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>color<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">'          &#125;,          title: &#123;            text: '博客访问来源统计图',            x: 'center',            textStyle: &#123;              color: '</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>color<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">'            &#125;          &#125;,          legend: &#123;            top: 'bottom',            textStyle: &#123;              color: '</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>color<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">'            &#125;          &#125;,          tooltip: &#123;            trigger: 'item',            formatter: "&#123;a&#125; &lt;br/>&#123;b&#125; : &#123;c&#125; (&#123;d&#125;%)"          &#125;,          series: [&#123;            name: '</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>metricsName<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">',            type: 'pie',            radius: [30, 80],            center: ['50%', '50%'],            roseType: 'area',            label: &#123;              formatter: "&#123;b&#125; : &#123;c&#125; (&#123;d&#125;%)"            &#125;,            data: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>sourcesArrJson<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">,            itemStyle: &#123;              emphasis: &#123;                shadowBlur: 10,                shadowOffsetX: 0,                shadowColor: 'rgba(255, 255, 255, 0.5)'              &#125;            &#125;          &#125;]        &#125;;        sourcesChart.setOption(sourcesOption);        window.addEventListener("resize", () => &#123;           sourcesChart.resize();        &#125;);</span><span class="token template-punctuation string">`</span></span>      document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'sources-chart'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">after</span><span class="token punctuation">(</span>script<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function">switchVisitChart</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token comment">// 这里为了统一颜色选取的是“明暗模式”下的两种字体颜色，也可以自己定义</span>  <span class="token keyword">let</span> color <span class="token operator">=</span> document<span class="token punctuation">.</span>documentElement<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">'data-theme'</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string">'light'</span> <span class="token operator">?</span> <span class="token string">'#4c4948'</span> <span class="token operator">:</span> <span class="token string">'rgba(255,255,255,0.7)'</span>  <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> mapOptionNew <span class="token operator">=</span> mapOption    mapOptionNew<span class="token punctuation">.</span>title<span class="token punctuation">.</span>textStyle<span class="token punctuation">.</span>color <span class="token operator">=</span> color    mapOptionNew<span class="token punctuation">.</span>visualMap<span class="token punctuation">.</span>textStyle<span class="token punctuation">.</span>color <span class="token operator">=</span> color    mapChart<span class="token punctuation">.</span><span class="token function">setOption</span><span class="token punctuation">(</span>mapOptionNew<span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> trendsOptionNew <span class="token operator">=</span> trendsOption    trendsOptionNew<span class="token punctuation">.</span>title<span class="token punctuation">.</span>textStyle<span class="token punctuation">.</span>color <span class="token operator">=</span> color    trendsOptionNew<span class="token punctuation">.</span>xAxis<span class="token punctuation">.</span>axisLine<span class="token punctuation">.</span>lineStyle<span class="token punctuation">.</span>color <span class="token operator">=</span> color    trendsOptionNew<span class="token punctuation">.</span>yAxis<span class="token punctuation">.</span>axisLine<span class="token punctuation">.</span>lineStyle<span class="token punctuation">.</span>color <span class="token operator">=</span> color    trendsOptionNew<span class="token punctuation">.</span>textStyle<span class="token punctuation">.</span>color <span class="token operator">=</span> color    trendsChart<span class="token punctuation">.</span><span class="token function">setOption</span><span class="token punctuation">(</span>trendsOptionNew<span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> sourcesOptionNew <span class="token operator">=</span> sourcesOption    sourcesOptionNew<span class="token punctuation">.</span>title<span class="token punctuation">.</span>textStyle<span class="token punctuation">.</span>color <span class="token operator">=</span> color    sourcesOptionNew<span class="token punctuation">.</span>legend<span class="token punctuation">.</span>textStyle<span class="token punctuation">.</span>color <span class="token operator">=</span> color    sourcesOptionNew<span class="token punctuation">.</span>textStyle<span class="token punctuation">.</span>color <span class="token operator">=</span> color    sourcesChart<span class="token punctuation">.</span><span class="token function">setOption</span><span class="token punctuation">(</span>sourcesOptionNew<span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">if</span> <span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'map-chart'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token function">mapChart</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">if</span> <span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'trends-chart'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token function">trendsChart</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">if</span> <span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'sources-chart'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token function">sourcesChart</span><span class="token punctuation">(</span><span class="token punctuation">)</span>document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"darkmode"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"click"</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span>switchVisitChart<span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p>上面是博主自己三个统计图的代码，小伙伴们可以用以参考，根据自己的需求绘制百度分析统计图。</p><p>更多统计图的自定义属性可以查看 <a href="https://echarts.apache.org/zh/option.html#title">ECharts 配置项文档</a>，根据自行喜好对 ECharts 统计图进行修改。</p><h2 id="自建-Vercel-API（可选）"><a href="#自建-Vercel-API（可选）" class="headerlink" title="自建 Vercel API（可选）"></a>自建 Vercel API（可选）</h2><p>由于在 js 文件中请求百度统计 API 获取数据会出现跨域请求的错误。</p><p>博主参考 Akilar 的 <a href="https://akilar.top/posts/1f9c68c9/">基于 Butterfly 主题的首页置顶 gitcalendar</a> 自建 Vercel API 部署教程，以及冰老师的 <a href="https://github.com/Zfour/python_github_calendar_api">python_github_calendar_api</a> 搭建了获取百度统计数据的 Vercel API，，力求解决百度统计 API 的跨域请求问题，但是仍然有时会出现跨域问题。</p><p><a class="ghcard" rel="external nofollow noopener noreferrer" href="https://github.com/Eurkon/baidu-tongji-api"><img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="https://github-readme-stats.vercel.app/api/pin/?username=Eurkon&repo=baidu-tongji-api&show_owner=true"></a></p><p>虽然 Vercel 的访问应当没有次数限制，但是不排除存在因访问次数过多而限流等限制。所以还是建议各位自建 API。使用 Vercel 部署，完全免费。且无需服务器。</p><p>部署完成后将获取到的默认域名替换 <code>census.js</code> 文件中的 <code>data_Url</code>，如：</p><p><pre class="line-numbers language-DIFF" data-language="DIFF"><code class="language-DIFF">- var dataUrl &#x3D; &#39;https:&#x2F;&#x2F;baidu-tongji-api.vercel.app&#x2F;api?access_token&#x3D;&#39; + access_token + &#39;&amp;site_id&#x3D;&#39; + site_id+ var dataUrl &#x3D; &#39;https:&#x2F;&#x2F;域名&#x2F;api?access_token&#x3D;&#39; + access_token + &#39;&amp;site_id&#x3D;&#39; + site_id<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></p><h1 id="使用统计图"><a href="#使用统计图" class="headerlink" title="使用统计图"></a>使用统计图</h1><p>在上文新建的 <code>[Blogroot]\source\census\index.md</code> 文件中添加以下内容：</p><p><pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown"><span class="token comment">&lt;!-- 访问地图 --></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>map-chart<span class="token punctuation">"</span></span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">="</span><span class="token attr-value"><span class="token property">border-radius</span><span class="token punctuation">:</span> 8px<span class="token punctuation">;</span> <span class="token property">height</span><span class="token punctuation">:</span> 600px<span class="token punctuation">;</span> <span class="token property">padding</span><span class="token punctuation">:</span> 10px<span class="token punctuation">;</span></span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token comment">&lt;!-- 访问趋势 --></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>trends-chart<span class="token punctuation">"</span></span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">="</span><span class="token attr-value"><span class="token property">border-radius</span><span class="token punctuation">:</span> 8px<span class="token punctuation">;</span> <span class="token property">height</span><span class="token punctuation">:</span> 300px<span class="token punctuation">;</span> <span class="token property">padding</span><span class="token punctuation">:</span> 10px<span class="token punctuation">;</span></span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token comment">&lt;!-- 访问来源 --></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>sources-chart<span class="token punctuation">"</span></span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">="</span><span class="token attr-value"><span class="token property">border-radius</span><span class="token punctuation">:</span> 8px<span class="token punctuation">;</span> <span class="token property">height</span><span class="token punctuation">:</span> 300px<span class="token punctuation">;</span> <span class="token property">padding</span><span class="token punctuation">:</span> 10px<span class="token punctuation">;</span></span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">defer</span> <span class="token attr-name">data-pjax</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/js/census.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p>当然也可以在其他页面引入博客访问统计图。</p><h1 id="可能遇到的问题"><a href="#可能遇到的问题" class="headerlink" title="可能遇到的问题"></a>可能遇到的问题</h1><ul><li><p>控制台报错 <code>Uncaught ReferenceError: echarts is not defined</code>。</p><p><strong>解决方案：</strong></p><p>需要在统计图的前引入 <code>echarts.js</code> 文件，最好是在页面的头部引入。</p></li><li><p>控制台报错 <code>Access to fetch at &#39;https://baidu-tongji-api.vercel.app/api?...&#39; from origin &#39;http://...&#39; has been blocked by CORS policy: No &#39;Access-Control-Allow-Origin&#39; header is present on the requested resource. If an opaque response serves your needs, set the request&#39;s mode to &#39;no-cors&#39; to fetch the resource with CORS disabled.</code></p><p><strong>解决方案：</strong></p><p>仍在努力解决跨域问题。</p></li></ul>]]></content>
      
      
      <categories>
          
          <category> 教程笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Hexo </tag>
            
            <tag> ECharts </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Spark RDD 常用算子</title>
      <link href="post/c55e5115.html"/>
      <url>post/c55e5115.html</url>
      
        <content type="html"><![CDATA[<h1 id="Spark-的算子的分类"><a href="#Spark-的算子的分类" class="headerlink" title="Spark 的算子的分类"></a>Spark 的算子的分类</h1><ul><li><p>从大方向来说，Spark 算子大致可以分为以下两类:</p><ul><li><p><strong>Transformation 变换/转换算子</strong>：这种变换并不触发提交作业，完成作业中间过程处理。</p><p>Transformation 操作是延迟计算的，也就是说从一个 RDD 转换生成另一个 RDD 的转换操作不是马上执行，需要等到有 Action 操作的时候才会真正触发运算。</p></li><li><p><strong>Action 行动算子</strong>：这类算子会触发 SparkContext 提交 Job 作业。</p><p>Action 算子会触发 Spark 提交作业（Job），并将数据输出 Spark 系统。</p></li></ul></li><li><p>从小方向来说，Spark 算子大致可以分为以下三类:</p><ul><li><a href="#Value-数据类型的-Transformation-算子">Value 数据类型的 Transformation 算子</a>，这种变换并不触发提交作业，针对处理的数据项是 Value 型的数据。</li><li><a href="#Key-Value-数据类型的-Transformation-算子">Key-Value 数据类型的 Transformation 算子</a>，这种变换并不触发提交作业，针对处理的数据项是 Key-Value 型的数据对。</li><li><a href="#Action-算子">Action 算子</a>，这类算子会触发 SparkContext 提交 Job 作业。</li></ul></li></ul><h1 id="Value-数据类型的-Transformation-算子"><a href="#Value-数据类型的-Transformation-算子" class="headerlink" title="Value 数据类型的 Transformation 算子"></a>Value 数据类型的 Transformation 算子</h1><h2 id="输入分区与输出分区一对一型"><a href="#输入分区与输出分区一对一型" class="headerlink" title="输入分区与输出分区一对一型"></a>输入分区与输出分区一对一型</h2><h3 id="map-算子"><a href="#map-算子" class="headerlink" title="map 算子"></a>map 算子</h3><ul><li><p><strong>说明：</strong>通过将函数应用于此 RDD 的所有元素来返回新的 RDD。</p><p>将原来 RDD 的每个数据项通过 map 中的用户自定义函数 f 映射转变为一个新的元素。源码中 map 算子相当于初始化一个 RDD， 新 RDD 叫做 MappedRDD(this, sc.clean(f))。</p><p>图中每个方框表示一个 RDD 分区，左侧的分区经过用户自定义函数 <code>f:T-&gt;U</code> 映射为右侧的新 RDD 分区。但是，实际只有等到 Action 算子触发后，这个 f 函数才会和其他函数在一个 stage 中对数据进行运算。在图中的第一个分区，数据记录 V1 输入 f，通过 f 转换输出为转换后的分区中的数据记录 V&#39;1。</p><p><img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="/images/post/spark_rdd/map.png" alt></p></li><li><p><strong>用法：</strong></p><p><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala"><span class="token keyword">def</span> map<span class="token punctuation">[</span>U<span class="token punctuation">]</span><span class="token punctuation">(</span>f<span class="token operator">:</span> <span class="token punctuation">(</span>T<span class="token punctuation">)</span> ⇒ U<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">implicit</span> arg0<span class="token operator">:</span> ClassTag<span class="token punctuation">[</span>U<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> RDD<span class="token punctuation">[</span>U<span class="token punctuation">]</span>Return a <span class="token keyword">new</span> RDD by applying a function to <span class="token namespace">all</span> elements of <span class="token keyword">this</span> RDD<span class="token punctuation">.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></p></li><li><p><strong>示例：</strong></p><p><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala"><span class="token keyword">val</span> data <span class="token operator">=</span> sc<span class="token punctuation">.</span>parallelize<span class="token punctuation">(</span><span class="token number">1</span> to <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>data<span class="token punctuation">.</span>map<span class="token punctuation">(</span>item <span class="token keyword">=></span> item <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>collectdata<span class="token punctuation">.</span>map<span class="token punctuation">(</span>_ <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>collect<span class="token comment">// 输出结果</span>data<span class="token operator">:</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>spark<span class="token punctuation">.</span>rdd<span class="token punctuation">.</span>RDD<span class="token punctuation">[</span><span class="token builtin">Int</span><span class="token punctuation">]</span> <span class="token operator">=</span> ParallelCollectionRDD<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> at parallelize at <span class="token generics"><span class="token punctuation">&lt;</span>console<span class="token punctuation">></span></span><span class="token operator">:</span><span class="token number">25</span>res0<span class="token operator">:</span> Array<span class="token punctuation">[</span><span class="token builtin">Int</span><span class="token punctuation">]</span> <span class="token operator">=</span> Array<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">)</span>res1<span class="token operator">:</span> Array<span class="token punctuation">[</span><span class="token builtin">Int</span><span class="token punctuation">]</span> <span class="token operator">=</span> Array<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p></li></ul><h3 id="flatMap-算子"><a href="#flatMap-算子" class="headerlink" title="flatMap 算子"></a>flatMap 算子</h3><ul><li><p><strong>说明：</strong>首先向该 RDD 的所有元素应用函数，然后将结果展平，以返回新的RDD。</p><p>将原来 RDD 中的每个元素通过函数 f 转换为新的元素，并将生成的 RDD 的每个集合中的元素合并为一个集合，内部创建 FlatMappedRDD(this，sc.clean(f))。</p><p>下图表示 RDD 的一个分区，进行 flatMap 函数操作，flatMap 中传入的函数为 <code>f:T-&gt;U</code>， T 和 U 可以是任意的数据类型。将分区中的数据通过用户自定义函数 f 转换为新的数据。外部大方框可以认为是一个 RDD 分区，小方框代表一个集合。 V1、 V2、 V3 在一个集合作为 RDD 的一个数据项，可能存储为数组或其他容器，转换为 V&#39;1、 V&#39;2、 V&#39;3 后，将原来的数组或容器结合拆散，拆散的数据形成为 RDD 中的数据项。</p><p><img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="/images/post/spark_rdd/flat_map.png" alt></p></li><li><p><strong>用法：</strong></p><p><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala"><span class="token keyword">def</span> flatMap<span class="token punctuation">[</span>U<span class="token punctuation">]</span><span class="token punctuation">(</span>f<span class="token operator">:</span> <span class="token punctuation">(</span>T<span class="token punctuation">)</span> ⇒ TraversableOnce<span class="token punctuation">[</span>U<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">implicit</span> arg0<span class="token operator">:</span> ClassTag<span class="token punctuation">[</span>U<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> RDD<span class="token punctuation">[</span>U<span class="token punctuation">]</span>Return a <span class="token keyword">new</span> RDD by first applying a function to <span class="token namespace">all</span> elements of <span class="token keyword">this</span> RDD<span class="token punctuation">,</span> and then flattening the results<span class="token punctuation">.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></p></li><li><p><strong>示例：</strong></p><p><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala"><span class="token keyword">val</span> data <span class="token operator">=</span> sc<span class="token punctuation">.</span>parallelize<span class="token punctuation">(</span><span class="token number">1</span> to <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>data<span class="token punctuation">.</span>flatMap<span class="token punctuation">(</span>item <span class="token keyword">=></span> item to <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">.</span>collectdata<span class="token punctuation">.</span>flatMap<span class="token punctuation">(</span>_ to <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">.</span>collect<span class="token comment">// 输出结果</span>data<span class="token operator">:</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>spark<span class="token punctuation">.</span>rdd<span class="token punctuation">.</span>RDD<span class="token punctuation">[</span><span class="token builtin">Int</span><span class="token punctuation">]</span> <span class="token operator">=</span> ParallelCollectionRDD<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> at parallelize at <span class="token generics"><span class="token punctuation">&lt;</span>console<span class="token punctuation">></span></span><span class="token operator">:</span><span class="token number">25</span>res0<span class="token operator">:</span> Array<span class="token punctuation">[</span><span class="token builtin">Int</span><span class="token punctuation">]</span> <span class="token operator">=</span> Array<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span>res1<span class="token operator">:</span> Array<span class="token punctuation">[</span><span class="token builtin">Int</span><span class="token punctuation">]</span> <span class="token operator">=</span> Array<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p></li></ul><h3 id="mapPartitions-算子"><a href="#mapPartitions-算子" class="headerlink" title="mapPartitions 算子"></a>mapPartitions 算子</h3><ul><li><p><strong>说明：</strong>通过将函数应用于此 RDD 的每个分区来返回新的 RDD。</p><p> mapPartitions 函数获取到每个分区的迭代器，在函数中通过这个分区整体的迭代器对整个分区的元素进行操作。内部实现是生成 MapPartitionsRDD。图中的方框代表一个 RDD 分区，用户通过函数 <code>f(iter)=&gt;iter.filter(_&gt;=3)</code> 对分区中所有数据进行过滤，大于和等于 3 的数据保留。一个方块代表一个 RDD 分区，含有 1、2、3 的分区过滤只剩下元素 3。</p><p><img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="/images/post/spark_rdd/map_partitions.png" alt></p></li><li><p><strong>用法：</strong></p><p><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala"><span class="token keyword">def</span> mapPartitions<span class="token punctuation">[</span>U<span class="token punctuation">]</span><span class="token punctuation">(</span>f<span class="token operator">:</span> <span class="token punctuation">(</span>Iterator<span class="token punctuation">[</span>T<span class="token punctuation">]</span><span class="token punctuation">)</span> ⇒ Iterator<span class="token punctuation">[</span>U<span class="token punctuation">]</span><span class="token punctuation">,</span> preservesPartitioning<span class="token operator">:</span> <span class="token builtin">Boolean</span> <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">implicit</span> arg0<span class="token operator">:</span> ClassTag<span class="token punctuation">[</span>U<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> RDD<span class="token punctuation">[</span>U<span class="token punctuation">]</span>Return a <span class="token keyword">new</span> RDD by applying a function to <span class="token namespace">each</span> partition of <span class="token keyword">this</span> RDD<span class="token punctuation">.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></p></li><li><p><strong>示例：</strong></p><p><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala"><span class="token keyword">val</span> data <span class="token operator">=</span> sc<span class="token punctuation">.</span>parallelize<span class="token punctuation">(</span><span class="token number">1</span> to <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token keyword">def</span> func<span class="token punctuation">(</span>it<span class="token operator">:</span> Iterator<span class="token punctuation">[</span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> Iterator<span class="token punctuation">[</span><span class="token builtin">Int</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span>  it<span class="token punctuation">.</span>filter<span class="token punctuation">(</span>_ <span class="token operator">>=</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span>data<span class="token punctuation">.</span>mapPartitions<span class="token punctuation">(</span>func<span class="token punctuation">)</span><span class="token punctuation">.</span>collectdata<span class="token punctuation">.</span>mapPartitions<span class="token punctuation">(</span>_<span class="token punctuation">.</span>filter<span class="token punctuation">(</span>_ <span class="token operator">>=</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>collect<span class="token comment">// 输出结果</span>data<span class="token operator">:</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>spark<span class="token punctuation">.</span>rdd<span class="token punctuation">.</span>RDD<span class="token punctuation">[</span><span class="token builtin">Int</span><span class="token punctuation">]</span> <span class="token operator">=</span> ParallelCollectionRDD<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> at parallelize at <span class="token generics"><span class="token punctuation">&lt;</span>console<span class="token punctuation">></span></span><span class="token operator">:</span><span class="token number">25</span>func<span class="token operator">:</span> <span class="token punctuation">(</span>it<span class="token operator">:</span> Iterator<span class="token punctuation">[</span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token punctuation">)</span>Iterator<span class="token punctuation">[</span><span class="token builtin">Int</span><span class="token punctuation">]</span>res0<span class="token operator">:</span> Array<span class="token punctuation">[</span><span class="token builtin">Int</span><span class="token punctuation">]</span> <span class="token operator">=</span> Array<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span>res1<span class="token operator">:</span> Array<span class="token punctuation">[</span><span class="token builtin">Int</span><span class="token punctuation">]</span> <span class="token operator">=</span> Array<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p></li></ul><h3 id="glom-算子"><a href="#glom-算子" class="headerlink" title="glom 算子"></a>glom 算子</h3><ul><li><p><strong>说明：</strong>返回通过将每个分区内的所有元素合并到数组中而创建的 RDD。</p><p>glom 函数将每个分区形成一个数组，内部实现是返回的 GlommedRDD。 图中的每个方框代表一个 RDD 分区。该图表示含有 V1、 V2、 V3 的分区通过函数 glom 形成一数组 Array[(V1),(V2),(V3)]。</p><p><img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="/images/post/spark_rdd/glom.png" alt></p></li><li><p><strong>用法：</strong></p><p><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala"><span class="token keyword">def</span> glom<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> RDD<span class="token punctuation">[</span>Array<span class="token punctuation">[</span>T<span class="token punctuation">]</span><span class="token punctuation">]</span>Return an RDD created by coalescing all elements within each partition into an array<span class="token punctuation">.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></p></li><li><p><strong>示例：</strong></p><p><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala"><span class="token keyword">val</span> data <span class="token operator">=</span> sc<span class="token punctuation">.</span>parallelize<span class="token punctuation">(</span><span class="token number">1</span> to <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>data<span class="token punctuation">.</span>glom<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>collect<span class="token comment">// 输出结果</span>data<span class="token operator">:</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>spark<span class="token punctuation">.</span>rdd<span class="token punctuation">.</span>RDD<span class="token punctuation">[</span><span class="token builtin">Int</span><span class="token punctuation">]</span> <span class="token operator">=</span> ParallelCollectionRDD<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> at parallelize at <span class="token generics"><span class="token punctuation">&lt;</span>console<span class="token punctuation">></span></span><span class="token operator">:</span><span class="token number">25</span>res0<span class="token operator">:</span> Array<span class="token punctuation">[</span>Array<span class="token punctuation">[</span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> Array<span class="token punctuation">(</span>Array<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> Array<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">,</span> Array<span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p></li></ul><h2 id="输入分区与输出分区多对一型"><a href="#输入分区与输出分区多对一型" class="headerlink" title="输入分区与输出分区多对一型"></a>输入分区与输出分区多对一型</h2><h3 id="union-算子"><a href="#union-算子" class="headerlink" title="union 算子"></a>union 算子</h3><ul><li><p><strong>说明：</strong>返回此 RDD 和另一个 RDD 的联合。</p><p>使用 union 函数时需要保证两个 RDD 元素的数据类型相同，返回的 RDD 数据类型和被合并的 RDD 元素数据类型相同，并不进行去重操作，保存所有元素。如果想去重可以使用 <code>distinct()</code>。同时 Spark 还提供更为简洁的使用 union 的 API，通过 ++ 符号相当于 union 函数操作。</p><p>图中左侧大方框代表两个 RDD，大方框内的小方框代表 RDD 的分区。右侧大方框代表合并后的 RDD，大方框内的小方框代表分区。含有 V1、V2、U1、U2、U3、U4 的 RDD 和含有 V1、V8、U5、U6、U7、U8 的 RDD 合并所有元素形成一个 RDD。V1、V1、V2、V8 形成一个分区，U1、U2、U3、U4、U5、U6、U7、U8 形成一个分区。</p><p><img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="/images/post/spark_rdd/union.png" alt></p></li><li><p><strong>用法：</strong></p><p><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala"><span class="token keyword">def</span> union<span class="token punctuation">(</span>other<span class="token operator">:</span> RDD<span class="token punctuation">[</span>T<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> RDD<span class="token punctuation">[</span>T<span class="token punctuation">]</span>Return the union of <span class="token keyword">this</span> RDD and another one<span class="token punctuation">.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></p></li><li><p><strong>示例：</strong></p><p><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala"><span class="token keyword">val</span> data1 <span class="token operator">=</span> sc<span class="token punctuation">.</span>parallelize<span class="token punctuation">(</span><span class="token number">1</span> to <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token keyword">val</span> data2 <span class="token operator">=</span> sc<span class="token punctuation">.</span>parallelize<span class="token punctuation">(</span><span class="token number">5</span> to <span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>data1<span class="token punctuation">.</span>union<span class="token punctuation">(</span>data2<span class="token punctuation">)</span><span class="token punctuation">.</span>collect<span class="token comment">// 输出结果</span>data1<span class="token operator">:</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>spark<span class="token punctuation">.</span>rdd<span class="token punctuation">.</span>RDD<span class="token punctuation">[</span><span class="token builtin">Int</span><span class="token punctuation">]</span> <span class="token operator">=</span> ParallelCollectionRDD<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> at parallelize at <span class="token generics"><span class="token punctuation">&lt;</span>console<span class="token punctuation">></span></span><span class="token operator">:</span><span class="token number">25</span>data2<span class="token operator">:</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>spark<span class="token punctuation">.</span>rdd<span class="token punctuation">.</span>RDD<span class="token punctuation">[</span><span class="token builtin">Int</span><span class="token punctuation">]</span> <span class="token operator">=</span> ParallelCollectionRDD<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> at parallelize at <span class="token generics"><span class="token punctuation">&lt;</span>console<span class="token punctuation">></span></span><span class="token operator">:</span><span class="token number">25</span>res0<span class="token operator">:</span> Array<span class="token punctuation">[</span><span class="token builtin">Int</span><span class="token punctuation">]</span> <span class="token operator">=</span> Array<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p></li></ul><h3 id="cartesian-算子"><a href="#cartesian-算子" class="headerlink" title="cartesian 算子"></a>cartesian 算子</h3><ul><li><p><strong>说明：</strong>返回此 RDD 和另一个 RDD 的进行笛卡尔积运算，即返回 a 和 b 的所有元素对 (a,b) 的 RDD。</p><p>对两个 RDD 内的所有元素进行笛卡尔积操作，该操作不会执行 shuffle 操作。操作后，内部实现返回 CartesianRDD。图中左侧大方框代表两个 RDD，大方框内的小方框代表 RDD 的分区。右侧大方框代表合并后的 RDD，大方框内的小方框代表分区。图中的大方框代表 RDD，大方框中的小方框代表 RDD 分区。例如：V1 和另一个 RDD 中的 W1、W2、Q5 进行笛卡尔积运算形成 (V1,W1)、(V1,W2)、(V1,Q5)。</p><p><img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="/images/post/spark_rdd/cartesian.png" alt></p></li><li><p><strong>用法：</strong></p><p><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala"><span class="token keyword">def</span> cartesian<span class="token punctuation">[</span>U<span class="token punctuation">]</span><span class="token punctuation">(</span>other<span class="token operator">:</span> RDD<span class="token punctuation">[</span>U<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">implicit</span> arg0<span class="token operator">:</span> ClassTag<span class="token punctuation">[</span>U<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> RDD<span class="token punctuation">[</span><span class="token punctuation">(</span>T<span class="token punctuation">,</span> U<span class="token punctuation">)</span><span class="token punctuation">]</span>Return the Cartesian product of <span class="token keyword">this</span> RDD and another one<span class="token punctuation">,</span> that is<span class="token punctuation">,</span> the RDD of all pairs of elements <span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span> where a is in <span class="token keyword">this</span> and b is in other<span class="token punctuation">.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></p></li><li><p><strong>示例：</strong></p><p><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala"><span class="token keyword">val</span> data1 <span class="token operator">=</span> sc<span class="token punctuation">.</span>parallelize<span class="token punctuation">(</span><span class="token number">1</span> to <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token keyword">val</span> data2 <span class="token operator">=</span> sc<span class="token punctuation">.</span>parallelize<span class="token punctuation">(</span><span class="token number">5</span> to <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>data1<span class="token punctuation">.</span>cartesian<span class="token punctuation">(</span>data2<span class="token punctuation">)</span><span class="token punctuation">.</span>collect<span class="token comment">// 输出结果</span>data1<span class="token operator">:</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>spark<span class="token punctuation">.</span>rdd<span class="token punctuation">.</span>RDD<span class="token punctuation">[</span><span class="token builtin">Int</span><span class="token punctuation">]</span> <span class="token operator">=</span> ParallelCollectionRDD<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> at parallelize at <span class="token generics"><span class="token punctuation">&lt;</span>console<span class="token punctuation">></span></span><span class="token operator">:</span><span class="token number">25</span>data2<span class="token operator">:</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>spark<span class="token punctuation">.</span>rdd<span class="token punctuation">.</span>RDD<span class="token punctuation">[</span><span class="token builtin">Int</span><span class="token punctuation">]</span> <span class="token operator">=</span> ParallelCollectionRDD<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> at parallelize at <span class="token generics"><span class="token punctuation">&lt;</span>console<span class="token punctuation">></span></span><span class="token operator">:</span><span class="token number">25</span>res0<span class="token operator">:</span> Array<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token builtin">Int</span><span class="token punctuation">,</span> <span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> Array<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p></li></ul><h2 id="输入分区与输出分区多对多型"><a href="#输入分区与输出分区多对多型" class="headerlink" title="输入分区与输出分区多对多型"></a>输入分区与输出分区多对多型</h2><h3 id="groupBy-算子"><a href="#groupBy-算子" class="headerlink" title="groupBy 算子"></a>groupBy 算子</h3><ul><li><p><strong>说明：</strong>返回分组元素的 RDD。每个组由一个键和映射到该键的一系列元素组成。不能保证每个组中元素的顺序，并且每次生成的 RDD 时甚至可能会有所不同。</p><p>将元素通过函数生成相应的 Key，数据就转化为 Key-Value 格式，之后将 Key 相同的元素分为一组。函数实现如下：将用户函数预处理，对数据 map 进行函数操作，最后再进行 groupByKey 分组操作。<code>this.map(t =&gt; (cleanF(t), t)).groupByKey(p)</code>，其中， p 确定了分区个数和分区函数，也就决定了并行化的程度。</p><p>图中方框代表一个 RDD 分区，相同 key 的元素合并到一个组。例如 V1 和 V2 合并为 V，Value 为 V1,V2。形成 V,Seq(V1,V2)。</p><p><img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="/images/post/spark_rdd/group_by.png" alt></p></li><li><p><strong>用法：</strong></p><p><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala"><span class="token keyword">def</span> groupBy<span class="token punctuation">[</span>K<span class="token punctuation">]</span><span class="token punctuation">(</span>f<span class="token operator">:</span> <span class="token punctuation">(</span>T<span class="token punctuation">)</span> ⇒ K<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">implicit</span> kt<span class="token operator">:</span> ClassTag<span class="token punctuation">[</span>K<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> RDD<span class="token punctuation">[</span><span class="token punctuation">(</span>K<span class="token punctuation">,</span> Iterable<span class="token punctuation">[</span>T<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token keyword">def</span> groupBy<span class="token punctuation">[</span>K<span class="token punctuation">]</span><span class="token punctuation">(</span>f<span class="token operator">:</span> <span class="token punctuation">(</span>T<span class="token punctuation">)</span> ⇒ K<span class="token punctuation">,</span> numPartitions<span class="token operator">:</span> <span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">implicit</span> kt<span class="token operator">:</span> ClassTag<span class="token punctuation">[</span>K<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> RDD<span class="token punctuation">[</span><span class="token punctuation">(</span>K<span class="token punctuation">,</span> Iterable<span class="token punctuation">[</span>T<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token keyword">def</span> groupBy<span class="token punctuation">[</span>K<span class="token punctuation">]</span><span class="token punctuation">(</span>f<span class="token operator">:</span> <span class="token punctuation">(</span>T<span class="token punctuation">)</span> ⇒ K<span class="token punctuation">,</span> p<span class="token operator">:</span> Partitioner<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">implicit</span> kt<span class="token operator">:</span> ClassTag<span class="token punctuation">[</span>K<span class="token punctuation">]</span><span class="token punctuation">,</span> ord<span class="token operator">:</span> Ordering<span class="token punctuation">[</span>K<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token operator">:</span> RDD<span class="token punctuation">[</span><span class="token punctuation">(</span>K<span class="token punctuation">,</span> Iterable<span class="token punctuation">[</span>T<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span>Return an RDD of grouped elements<span class="token punctuation">.</span> Each group consists of a key and a sequence of elements mapping to <span class="token namespace">that</span> key<span class="token punctuation">.</span> The ordering of elements within each group is not guaranteed<span class="token punctuation">,</span> and may even differ each time the resulting RDD is evaluated<span class="token punctuation">.</span><span class="token keyword">def</span> groupByKey<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> RDD<span class="token punctuation">[</span><span class="token punctuation">(</span>K<span class="token punctuation">,</span> Iterable<span class="token punctuation">[</span>V<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token keyword">def</span> groupByKey<span class="token punctuation">(</span>numPartitions<span class="token operator">:</span> <span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token operator">:</span> RDD<span class="token punctuation">[</span><span class="token punctuation">(</span>K<span class="token punctuation">,</span> Iterable<span class="token punctuation">[</span>V<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token keyword">def</span> groupByKey<span class="token punctuation">(</span>partitioner<span class="token operator">:</span> Partitioner<span class="token punctuation">)</span><span class="token operator">:</span> RDD<span class="token punctuation">[</span><span class="token punctuation">(</span>K<span class="token punctuation">,</span> Iterable<span class="token punctuation">[</span>V<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span>Group the values <span class="token keyword">for</span> each key in the RDD into a single sequence<span class="token punctuation">.</span> Hash<span class="token operator">-</span>partitions the resulting RDD <span class="token keyword">with</span> <span class="token namespace">the</span> existing partitioner<span class="token operator">/</span>parallelism level<span class="token punctuation">.</span> The ordering of elements within each group is not guaranteed<span class="token punctuation">,</span> and may even differ each time the resulting RDD is evaluated<span class="token punctuation">.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p></li><li><p><strong>示例：</strong></p><p><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala"><span class="token keyword">val</span> data1 <span class="token operator">=</span> sc<span class="token punctuation">.</span>parallelize<span class="token punctuation">(</span><span class="token number">1</span> to <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>data1<span class="token punctuation">.</span>groupBy<span class="token punctuation">(</span>_ <span class="token operator">%</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span>collect  <span class="token comment">// 分成两组</span><span class="token keyword">val</span> data2 <span class="token operator">=</span> sc<span class="token punctuation">.</span>parallelize<span class="token punctuation">(</span>Array<span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">,</span> <span class="token string">"b"</span><span class="token punctuation">,</span> <span class="token string">"c"</span><span class="token punctuation">,</span> <span class="token string">"aa"</span><span class="token punctuation">,</span> <span class="token string">"bb"</span><span class="token punctuation">,</span> <span class="token string">"cc"</span><span class="token punctuation">,</span> <span class="token string">"aaa"</span><span class="token punctuation">,</span> <span class="token string">"bbb"</span><span class="token punctuation">,</span> <span class="token string">"ccc"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token keyword">val</span> data3 <span class="token operator">=</span> data2<span class="token punctuation">.</span>keyBy<span class="token punctuation">(</span>_<span class="token punctuation">.</span>length<span class="token punctuation">)</span>  <span class="token comment">// 给 value 加上 key，key 为对应 string 的长度</span>data3<span class="token punctuation">.</span>groupByKey<span class="token punctuation">.</span>collect<span class="token comment">// 输出结果</span>data1<span class="token operator">:</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>spark<span class="token punctuation">.</span>rdd<span class="token punctuation">.</span>RDD<span class="token punctuation">[</span><span class="token builtin">Int</span><span class="token punctuation">]</span> <span class="token operator">=</span> ParallelCollectionRDD<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> at parallelize at <span class="token generics"><span class="token punctuation">&lt;</span>console<span class="token punctuation">></span></span><span class="token operator">:</span><span class="token number">25</span>res0<span class="token operator">:</span> Array<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token builtin">Int</span><span class="token punctuation">,</span> Iterable<span class="token punctuation">[</span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> Array<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>CompactBuffer<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>CompactBuffer<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>data2<span class="token operator">:</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>spark<span class="token punctuation">.</span>rdd<span class="token punctuation">.</span>RDD<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span> <span class="token operator">=</span> ParallelCollectionRDD<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> at parallelize at <span class="token generics"><span class="token punctuation">&lt;</span>console<span class="token punctuation">></span></span><span class="token operator">:</span><span class="token number">25</span>data3<span class="token operator">:</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>spark<span class="token punctuation">.</span>rdd<span class="token punctuation">.</span>RDD<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token builtin">Int</span><span class="token punctuation">,</span> <span class="token builtin">String</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> MapPartitionsRDD<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> at keyBy at <span class="token generics"><span class="token punctuation">&lt;</span>console<span class="token punctuation">></span></span><span class="token operator">:</span><span class="token number">25</span>res1<span class="token operator">:</span> Array<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token builtin">Int</span><span class="token punctuation">,</span> Iterable<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> Array<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>CompactBuffer<span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span>CompactBuffer<span class="token punctuation">(</span>aaa<span class="token punctuation">,</span> bbb<span class="token punctuation">,</span> ccc<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span>CompactBuffer<span class="token punctuation">(</span>aa<span class="token punctuation">,</span> bb<span class="token punctuation">,</span> cc<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p></li></ul><h2 id="输出分区为输入分区子集型"><a href="#输出分区为输入分区子集型" class="headerlink" title="输出分区为输入分区子集型"></a>输出分区为输入分区子集型</h2><h3 id="filter-算子"><a href="#filter-算子" class="headerlink" title="filter 算子"></a>filter 算子</h3><ul><li><p><strong>说明：</strong>返回仅包含满足条件的元素的新 RDD。</p><p>filter 函数功能是对元素进行过滤，对每个元素应用 f 函 数，返回值为 true 的元素在 RDD 中保留，返回值为 false 的元素将被过滤掉。内部实现相当于生成 <code>FilteredRDD(this，sc.clean(f))</code>。图中每个方框代表一个 RDD 分区， T 可以是任意的类型。通过用户自定义的过滤函数 f，对每个数据项操作，将满足条件、返回结果为 true 的数据项保留。例如，过滤掉 V2 和 V3 保留了 V1，为区分命名为 V&#39;1。</p><p>下面代码为函数的本质实现：<code>def filter(f:T=&gt;Boolean):RDD[T]=newFilteredRDD(this,sc.clean(f))</code></p><p><img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="/images/post/spark_rdd/filter.png" alt></p></li><li><p><strong>用法：</strong></p><p><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala"><span class="token keyword">def</span> filter<span class="token punctuation">(</span>f<span class="token operator">:</span> <span class="token punctuation">(</span>T<span class="token punctuation">)</span> ⇒ <span class="token builtin">Boolean</span><span class="token punctuation">)</span><span class="token operator">:</span> RDD<span class="token punctuation">[</span>T<span class="token punctuation">]</span>Return a <span class="token keyword">new</span> RDD containing only the elements that satisfy a predicate<span class="token punctuation">.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></p></li><li><p><strong>示例：</strong></p><p><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala"><span class="token keyword">val</span> data <span class="token operator">=</span> sc<span class="token punctuation">.</span>parallelize<span class="token punctuation">(</span><span class="token number">1</span> to <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>data<span class="token punctuation">.</span>filter<span class="token punctuation">(</span>_ <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span>collect<span class="token comment">// 输出结果</span>data<span class="token operator">:</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>spark<span class="token punctuation">.</span>rdd<span class="token punctuation">.</span>RDD<span class="token punctuation">[</span><span class="token builtin">Int</span><span class="token punctuation">]</span> <span class="token operator">=</span> ParallelCollectionRDD<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> at parallelize at <span class="token generics"><span class="token punctuation">&lt;</span>console<span class="token punctuation">></span></span><span class="token operator">:</span><span class="token number">25</span>res0<span class="token operator">:</span> Array<span class="token punctuation">[</span><span class="token builtin">Int</span><span class="token punctuation">]</span> <span class="token operator">=</span> Array<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p></li></ul><h3 id="distinct-算子"><a href="#distinct-算子" class="headerlink" title="distinct 算子"></a>distinct 算子</h3><ul><li><p><strong>说明：</strong>返回一个包含该 RDD 中不同元素的新 RDD。</p><p>distinct 将 RDD 中的元素进行去重操作。图中的每个方框代表一个 RDD 分区，通过 distinct 函数，将数据去重。例如，重复数据 V1、V1 去重后只保留一份 V1。</p><p><img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="/images/post/spark_rdd/distinct.png" alt></p></li><li><p><strong>用法：</strong></p><p><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala"><span class="token keyword">def</span> distinct<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> RDD<span class="token punctuation">[</span>T<span class="token punctuation">]</span><span class="token keyword">def</span> distinct<span class="token punctuation">(</span>numPartitions<span class="token operator">:</span> <span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">implicit</span> ord<span class="token operator">:</span> Ordering<span class="token punctuation">[</span>T<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token operator">:</span> RDD<span class="token punctuation">[</span>T<span class="token punctuation">]</span>Return a <span class="token keyword">new</span> RDD containing the distinct elements in <span class="token keyword">this</span> RDD<span class="token punctuation">.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></p></li><li><p><strong>示例：</strong></p><p><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala"><span class="token keyword">val</span> data <span class="token operator">=</span> sc<span class="token punctuation">.</span>parallelize<span class="token punctuation">(</span>Array<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>data<span class="token punctuation">.</span>distinct<span class="token punctuation">.</span>collect<span class="token comment">// 输出结果</span>data<span class="token operator">:</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>spark<span class="token punctuation">.</span>rdd<span class="token punctuation">.</span>RDD<span class="token punctuation">[</span><span class="token builtin">Int</span><span class="token punctuation">]</span> <span class="token operator">=</span> ParallelCollectionRDD<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> at parallelize at <span class="token generics"><span class="token punctuation">&lt;</span>console<span class="token punctuation">></span></span><span class="token operator">:</span><span class="token number">25</span>res0<span class="token operator">:</span> Array<span class="token punctuation">[</span><span class="token builtin">Int</span><span class="token punctuation">]</span> <span class="token operator">=</span> Array<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p></li></ul><h3 id="subtract-算子"><a href="#subtract-算子" class="headerlink" title="subtract 算子"></a>subtract 算子</h3><ul><li><p><strong>说明：</strong>返回一个新 RDD，其中的元素在第一个 RDD 有，第二个 RDD 没有。</p><p>subtract 相当于进行集合的差操作，RDD1 去除 RDD1 和 RDD2 交集中的所有元素。图中左侧的大方框代表两个 RDD，大方框内的小方框代表 RDD 的分区。右侧大方框代表合并后的RDD，大方框内的小方框代表分区。V1 在两个 RDD 中均有，根据差集运算规则，新 RDD 不保留，V2 在第一个 RDD 有，第二个 RDD 没有，则在新 RDD 元素中包含 V2。</p><p><img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="/images/post/spark_rdd/subtract.png" alt></p></li><li><p><strong>用法：</strong></p><p><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala"><span class="token keyword">def</span> subtract<span class="token punctuation">(</span>other<span class="token operator">:</span> RDD<span class="token punctuation">[</span>T<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> RDD<span class="token punctuation">[</span>T<span class="token punctuation">]</span><span class="token keyword">def</span> subtract<span class="token punctuation">(</span>other<span class="token operator">:</span> RDD<span class="token punctuation">[</span>T<span class="token punctuation">]</span><span class="token punctuation">,</span> numPartitions<span class="token operator">:</span> <span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token operator">:</span> RDD<span class="token punctuation">[</span>T<span class="token punctuation">]</span><span class="token keyword">def</span> subtract<span class="token punctuation">(</span>other<span class="token operator">:</span> RDD<span class="token punctuation">[</span>T<span class="token punctuation">]</span><span class="token punctuation">,</span> p<span class="token operator">:</span> Partitioner<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">implicit</span> ord<span class="token operator">:</span> Ordering<span class="token punctuation">[</span>T<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token operator">:</span> RDD<span class="token punctuation">[</span>T<span class="token punctuation">]</span>Return an RDD <span class="token keyword">with</span> <span class="token namespace">the</span> elements from <span class="token keyword">this</span> that are not in other<span class="token punctuation">.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></p></li><li><p><strong>示例：</strong></p><p><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala"><span class="token keyword">val</span> data1 <span class="token operator">=</span> sc<span class="token punctuation">.</span>parallelize<span class="token punctuation">(</span><span class="token number">1</span> to <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token keyword">val</span> data2 <span class="token operator">=</span> sc<span class="token punctuation">.</span>parallelize<span class="token punctuation">(</span><span class="token number">1</span> to <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>data1<span class="token punctuation">.</span>subtract<span class="token punctuation">(</span>data2<span class="token punctuation">)</span><span class="token punctuation">.</span>collect<span class="token comment">// 输出结果</span>data1<span class="token operator">:</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>spark<span class="token punctuation">.</span>rdd<span class="token punctuation">.</span>RDD<span class="token punctuation">[</span><span class="token builtin">Int</span><span class="token punctuation">]</span> <span class="token operator">=</span> ParallelCollectionRDD<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> at parallelize at <span class="token generics"><span class="token punctuation">&lt;</span>console<span class="token punctuation">></span></span><span class="token operator">:</span><span class="token number">25</span>data2<span class="token operator">:</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>spark<span class="token punctuation">.</span>rdd<span class="token punctuation">.</span>RDD<span class="token punctuation">[</span><span class="token builtin">Int</span><span class="token punctuation">]</span> <span class="token operator">=</span> ParallelCollectionRDD<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> at parallelize at <span class="token generics"><span class="token punctuation">&lt;</span>console<span class="token punctuation">></span></span><span class="token operator">:</span><span class="token number">25</span>res0<span class="token operator">:</span> Array<span class="token punctuation">[</span><span class="token builtin">Int</span><span class="token punctuation">]</span> <span class="token operator">=</span> Array<span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p></li></ul><h3 id="sample-算子"><a href="#sample-算子" class="headerlink" title="sample 算子"></a>sample 算子</h3><ul><li><p><strong>说明：</strong>返回此 RDD 的采样子集。</p><p> sample 将 RDD 这个集合内的元素进行采样，获取所有元素的子集。用户可以设定是否有放回的抽样、百分比、随机种子，进而决定采样方式。内部实现是生成 SampledRDD(withReplacement, fraction, seed)。图中的每个方框是一个 RDD 分区。通过 sample 函数， 采样 50% 的数据。V1、V2、U1、U2、U3、U4 采样出数据 V1 和 U1、U2 形成新的 RDD。</p><p><img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="/images/post/spark_rdd/sample.png" alt></p></li><li><p><strong>用法：</strong></p><p><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala"><span class="token keyword">def</span> sample<span class="token punctuation">(</span>withReplacement<span class="token operator">:</span> <span class="token builtin">Boolean</span><span class="token punctuation">,</span> fraction<span class="token operator">:</span> <span class="token builtin">Double</span><span class="token punctuation">,</span> seed<span class="token operator">:</span> <span class="token builtin">Long</span> <span class="token operator">=</span> Utils<span class="token punctuation">.</span>random<span class="token punctuation">.</span>nextLong<span class="token punctuation">)</span><span class="token operator">:</span> RDD<span class="token punctuation">[</span>T<span class="token punctuation">]</span>Return a sampled subset of <span class="token keyword">this</span> RDD<span class="token punctuation">.</span>withReplacement：can elements be sampled multiple times <span class="token punctuation">(</span>replaced when sampled out<span class="token punctuation">)</span>可以多次采样元素（采样时替换），<span class="token boolean">true</span> 表示有放回抽样，<span class="token boolean">false</span> 表示无放回抽样，fraction：expected size of the sample as a fraction of <span class="token keyword">this</span> RDD<span class="token symbol">'s</span> size without replacement<span class="token operator">:</span> probability that each element is chosen<span class="token punctuation">;</span> fraction must be <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token keyword">with</span> <span class="token namespace">replacement</span><span class="token operator">:</span> expected number of times each element is chosen<span class="token punctuation">;</span> fraction must be greater than or equal to <span class="token number">0</span>样本的预期大小，占该 RDD 大小的一部分，无需替换：选择每个元素的概率；分数必须为 <span class="token punctuation">[</span><span class="token number">0</span>，<span class="token number">1</span><span class="token punctuation">]</span>，并带有替换：选择每个元素的预期次数；小数必须大于或等于 <span class="token number">0</span>seed：seed <span class="token keyword">for</span> the random number generator随机数生成器的种子<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p></li><li><p><strong>示例：</strong></p><p><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala"><span class="token keyword">val</span> data <span class="token operator">=</span> sc<span class="token punctuation">.</span>parallelize<span class="token punctuation">(</span><span class="token number">1</span> to <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>data<span class="token punctuation">.</span>sample<span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">.</span>collectdata<span class="token punctuation">.</span>sample<span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">.</span>collect<span class="token comment">// 输出结果</span>data<span class="token operator">:</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>spark<span class="token punctuation">.</span>rdd<span class="token punctuation">.</span>RDD<span class="token punctuation">[</span><span class="token builtin">Int</span><span class="token punctuation">]</span> <span class="token operator">=</span> ParallelCollectionRDD<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> at parallelize at <span class="token generics"><span class="token punctuation">&lt;</span>console<span class="token punctuation">></span></span><span class="token operator">:</span><span class="token number">25</span>res0<span class="token operator">:</span> Array<span class="token punctuation">[</span><span class="token builtin">Int</span><span class="token punctuation">]</span> <span class="token operator">=</span> Array<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">)</span>res1<span class="token operator">:</span> Array<span class="token punctuation">[</span><span class="token builtin">Int</span><span class="token punctuation">]</span> <span class="token operator">=</span> Array<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p></li></ul><h2 id="Cache-型"><a href="#Cache-型" class="headerlink" title="Cache 型"></a>Cache 型</h2><h3 id="cache-算子"><a href="#cache-算子" class="headerlink" title="cache 算子"></a>cache 算子</h3><ul><li><p><strong>说明：</strong>使用默认存储级别（MEMORY_ONLY）缓存该 RDD。</p><p>cache 将 RDD 元素从磁盘缓存到内存。相当于 persist(MEMORY_ONLY) 函数的功能。图中每个方框代表一个 RDD 分区，左侧相当于数据分区都存储在磁盘，通过 cache 算子将数据缓存在内存。</p><p><img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="/images/post/spark_rdd/cache.png" alt></p></li><li><p><strong>用法：</strong></p><p><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala"><span class="token keyword">def</span> cache<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> RDD<span class="token punctuation">.</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token keyword">type</span>Persist <span class="token keyword">this</span> RDD <span class="token keyword">with</span> <span class="token namespace">the</span> default storage level <span class="token punctuation">(</span>MEMORY_ONLY<span class="token punctuation">)</span><span class="token punctuation">.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></p></li><li><p><strong>示例：</strong></p><p><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala"><span class="token keyword">val</span> data <span class="token operator">=</span> sc<span class="token punctuation">.</span>parallelize<span class="token punctuation">(</span><span class="token number">1</span> to <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>data<span class="token punctuation">.</span>cache<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">// 输出结果</span>data<span class="token operator">:</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>spark<span class="token punctuation">.</span>rdd<span class="token punctuation">.</span>RDD<span class="token punctuation">[</span><span class="token builtin">Int</span><span class="token punctuation">]</span> <span class="token operator">=</span> ParallelCollectionRDD<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> at parallelize at <span class="token generics"><span class="token punctuation">&lt;</span>console<span class="token punctuation">></span></span><span class="token operator">:</span><span class="token number">25</span>res0<span class="token operator">:</span> data<span class="token punctuation">.</span><span class="token keyword">type</span> <span class="token operator">=</span> ParallelCollectionRDD<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> at parallelize at <span class="token generics"><span class="token punctuation">&lt;</span>console<span class="token punctuation">></span></span><span class="token operator">:</span><span class="token number">25</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p></li></ul><h3 id="persist-算子"><a href="#persist-算子" class="headerlink" title="persist 算子"></a>persist 算子</h3><ul><li><p><strong>说明：</strong>设置此 RDD 的存储级别，以在第一次计算它之后将其值持久化到各个操作中。如果 RDD 尚未设置存储级别，则只能用于分配新的存储级别。本地检查点是一个例外。</p><p>persist 函数对 RDD 进行缓存操作。数据缓存在哪里依据 <code>StorageLevel</code> 这个枚举类型进行确定。有以下几种类型的组合，<code>DISK</code> 代表磁盘，<code>MEMORY</code> 代表内存，<code>SER</code> 代表数据是否进行序列化存储。</p><p>下面为函数定义，<code>StorageLevel</code> 是枚举类型，代表存储模式，用户可以按需进行选择。<code>persist(newLevel:StorageLevel)</code>，下面列出 persist 函数可以进行缓存的模式。例如，<code>MEMORY_AND_DISK_SER</code> 代表数据可以存储在内存和磁盘，并且以序列化的方式存储，其他同理。</p><p><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala"><span class="token keyword">class</span> StorageLevel <span class="token keyword">private</span><span class="token punctuation">(</span>    <span class="token keyword">private</span> <span class="token keyword">var</span> _useDisk<span class="token operator">:</span> <span class="token builtin">Boolean</span><span class="token punctuation">,</span> <span class="token comment">//是否使用磁盘</span>    <span class="token keyword">private</span> <span class="token keyword">var</span> _useMemory<span class="token operator">:</span> <span class="token builtin">Boolean</span><span class="token punctuation">,</span> <span class="token comment">//是否使用内存</span>    <span class="token keyword">private</span> <span class="token keyword">var</span> _useOffHeap<span class="token operator">:</span> <span class="token builtin">Boolean</span><span class="token punctuation">,</span> <span class="token comment">//是否使用堆外内存</span>    <span class="token keyword">private</span> <span class="token keyword">var</span> _deserialized<span class="token operator">:</span> <span class="token builtin">Boolean</span><span class="token punctuation">,</span> <span class="token comment">//是否反序列化</span>    <span class="token keyword">private</span> <span class="token keyword">var</span> _replication<span class="token operator">:</span> <span class="token builtin">Int</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment">//备份因子，默认为1</span>  <span class="token keyword">extends</span> Externalizable <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token keyword">object</span> StorageLevel <span class="token punctuation">&#123;</span>  <span class="token keyword">val</span> NONE <span class="token operator">=</span> <span class="token keyword">new</span> StorageLevel<span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span>  <span class="token keyword">val</span> DISK_ONLY <span class="token operator">=</span> <span class="token keyword">new</span> StorageLevel<span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span>  <span class="token keyword">val</span> DISK_ONLY_2 <span class="token operator">=</span> <span class="token keyword">new</span> StorageLevel<span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>  <span class="token keyword">val</span> MEMORY_ONLY <span class="token operator">=</span> <span class="token keyword">new</span> StorageLevel<span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span>  <span class="token keyword">val</span> MEMORY_ONLY_2 <span class="token operator">=</span> <span class="token keyword">new</span> StorageLevel<span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>  <span class="token keyword">val</span> MEMORY_ONLY_SER <span class="token operator">=</span> <span class="token keyword">new</span> StorageLevel<span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span>  <span class="token keyword">val</span> MEMORY_ONLY_SER_2 <span class="token operator">=</span> <span class="token keyword">new</span> StorageLevel<span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>  <span class="token keyword">val</span> MEMORY_AND_DISK <span class="token operator">=</span> <span class="token keyword">new</span> StorageLevel<span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span>  <span class="token keyword">val</span> MEMORY_AND_DISK_2 <span class="token operator">=</span> <span class="token keyword">new</span> StorageLevel<span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>  <span class="token keyword">val</span> MEMORY_AND_DISK_SER <span class="token operator">=</span> <span class="token keyword">new</span> StorageLevel<span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span>  <span class="token keyword">val</span> MEMORY_AND_DISK_SER_2 <span class="token operator">=</span> <span class="token keyword">new</span> StorageLevel<span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>  <span class="token keyword">val</span> OFF_HEAP <span class="token operator">=</span> <span class="token keyword">new</span> StorageLevel<span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p>下图中方框代表 RDD 分区。<code>disk</code> 代表存储在磁盘，<code>mem</code> 代表存储在内存。数据最初全部存储在磁盘，通过 <code>persist(MEMORY_AND_DISK)</code> 将数据缓存到内存，但是有的分区无法容纳在内存，将含有 V1、 V2、 V3 的 RDD 存储到磁盘，将含有 U1，U2 的 RDD 仍旧存储在内存。</p><p><img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="/images/post/spark_rdd/persist.png" alt></p></li><li><p><strong>用法：</strong></p><p><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala"><span class="token keyword">def</span> persist<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> RDD<span class="token punctuation">.</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token keyword">type</span>Persist <span class="token keyword">this</span> RDD <span class="token keyword">with</span> <span class="token namespace">the</span> default storage level <span class="token punctuation">(</span>MEMORY_ONLY<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">def</span> persist<span class="token punctuation">(</span>newLevel<span class="token operator">:</span> StorageLevel<span class="token punctuation">)</span><span class="token operator">:</span> RDD<span class="token punctuation">.</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token keyword">type</span>Set <span class="token keyword">this</span> RDD<span class="token symbol">'s</span> storage level to <span class="token namespace">persist</span> its values across operations after the first time it is computed<span class="token punctuation">.</span> This can only be used to <span class="token namespace">assign</span> a <span class="token keyword">new</span> storage level <span class="token keyword">if</span> the RDD does not have a storage level set yet<span class="token punctuation">.</span> Local checkpointing is an exception<span class="token punctuation">.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></p></li><li><p><strong>示例：</strong></p><p><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala"><span class="token keyword">val</span> data <span class="token operator">=</span> sc<span class="token punctuation">.</span>parallelize<span class="token punctuation">(</span><span class="token number">1</span> to <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>data<span class="token punctuation">.</span>persist<span class="token punctuation">(</span>StorageLevel<span class="token punctuation">.</span>MEMORY_AND_DISK<span class="token punctuation">)</span><span class="token comment">// 输出结果</span>data<span class="token operator">:</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>spark<span class="token punctuation">.</span>rdd<span class="token punctuation">.</span>RDD<span class="token punctuation">[</span><span class="token builtin">Int</span><span class="token punctuation">]</span> <span class="token operator">=</span> ParallelCollectionRDD<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> at parallelize at <span class="token generics"><span class="token punctuation">&lt;</span>console<span class="token punctuation">></span></span><span class="token operator">:</span><span class="token number">25</span>res0<span class="token operator">:</span> data<span class="token punctuation">.</span><span class="token keyword">type</span> <span class="token operator">=</span> ParallelCollectionRDD<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> at parallelize at <span class="token generics"><span class="token punctuation">&lt;</span>console<span class="token punctuation">></span></span><span class="token operator">:</span><span class="token number">25</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p></li></ul><h1 id="Key-Value-数据类型的-Transformation-算子"><a href="#Key-Value-数据类型的-Transformation-算子" class="headerlink" title="Key-Value 数据类型的 Transformation 算子"></a>Key-Value 数据类型的 Transformation 算子</h1><h2 id="输入分区与输出分区一对一"><a href="#输入分区与输出分区一对一" class="headerlink" title="输入分区与输出分区一对一"></a>输入分区与输出分区一对一</h2><h3 id="mapValues-算子"><a href="#mapValues-算子" class="headerlink" title="mapValues 算子"></a>mapValues 算子</h3><ul><li><p><strong>说明：</strong>在不更改键的情况下，通过映射函数传递键值对 RDD 中的每个值；这也保留了原始 RDD 的分区。</p><p>针对 (Key, Value) 型数据中的 Value 进行 Map 操作，而不对 Key 进行处理。图中的方框代表 RDD 分区。 <code>a=&gt;a+2</code> 代表对 (V1, 1) 这样的 Key-Value 数据对，数据只对 Value 中的 1 进行加 2 操作，返回结果为 3。</p><p><img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="/images/post/spark_rdd/map_values.png" alt></p></li><li><p><strong>用法：</strong></p><p><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala"><span class="token keyword">def</span> mapValues<span class="token punctuation">[</span>U<span class="token punctuation">]</span><span class="token punctuation">(</span>f<span class="token operator">:</span> <span class="token punctuation">(</span>V<span class="token punctuation">)</span> ⇒ U<span class="token punctuation">)</span><span class="token operator">:</span> RDD<span class="token punctuation">[</span><span class="token punctuation">(</span>K<span class="token punctuation">,</span> U<span class="token punctuation">)</span><span class="token punctuation">]</span>Pass each value in the key<span class="token operator">-</span>value pair RDD through a map function without changing the keys<span class="token punctuation">;</span> <span class="token keyword">this</span> also retains the original RDD<span class="token symbol">'s</span> partitioning<span class="token punctuation">.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></p></li><li><p><strong>示例：</strong></p><p><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala"><span class="token keyword">val</span> data <span class="token operator">=</span> sc<span class="token punctuation">.</span>parallelize<span class="token punctuation">(</span>Array<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>data<span class="token punctuation">.</span>map<span class="token punctuation">(</span>x <span class="token keyword">=></span> <span class="token punctuation">(</span>x<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>mapValues<span class="token punctuation">(</span>a <span class="token keyword">=></span> <span class="token punctuation">(</span>a <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>collect<span class="token comment">// 输出结果</span>data<span class="token operator">:</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>spark<span class="token punctuation">.</span>rdd<span class="token punctuation">.</span>RDD<span class="token punctuation">[</span><span class="token builtin">Int</span><span class="token punctuation">]</span> <span class="token operator">=</span> ParallelCollectionRDD<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> at parallelize at <span class="token generics"><span class="token punctuation">&lt;</span>console<span class="token punctuation">></span></span><span class="token operator">:</span><span class="token number">25</span>res0<span class="token operator">:</span> Array<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token builtin">Int</span><span class="token punctuation">,</span> <span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> Array<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p></li></ul><h2 id="对单个-RDD-或两个-RDD-聚合"><a href="#对单个-RDD-或两个-RDD-聚合" class="headerlink" title="对单个 RDD 或两个 RDD 聚合"></a>对单个 RDD 或两个 RDD 聚合</h2><p><strong>单个 RDD 聚合</strong></p><h3 id="combineByKey-算子"><a href="#combineByKey-算子" class="headerlink" title="combineByKey 算子"></a>combineByKey 算子</h3><ul><li><p><strong>说明：</strong>CombineByKeyWithClassTag 的简化版本，它使用现有的分区程序/并行度级别对生成的 RDD 进行哈希分区。此方法是为了向后兼容。它不向混洗提供组合器类标签信息。</p><p>例如，相当于将元素为 (Int， Int) 的 RDD 转变为了 (Int, Seq[Int]) 类型元素的 RDD。图中的方框代表 RDD 分区。如图，通过 combineByKey，将 (V1,2)， (V1,1) 数据合并为 (V1, Seq(2, 1))。</p><p><img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="/images/post/spark_rdd/combine_by_key.png" alt></p></li><li><p><strong>用法：</strong></p><p><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala"><span class="token keyword">def</span> combineByKey<span class="token punctuation">[</span>C<span class="token punctuation">]</span><span class="token punctuation">(</span>createCombiner<span class="token operator">:</span> <span class="token punctuation">(</span>V<span class="token punctuation">)</span> ⇒ C<span class="token punctuation">,</span> mergeValue<span class="token operator">:</span> <span class="token punctuation">(</span>C<span class="token punctuation">,</span> V<span class="token punctuation">)</span> ⇒ C<span class="token punctuation">,</span> mergeCombiners<span class="token operator">:</span> <span class="token punctuation">(</span>C<span class="token punctuation">,</span> C<span class="token punctuation">)</span> ⇒ C<span class="token punctuation">)</span><span class="token operator">:</span> RDD<span class="token punctuation">[</span><span class="token punctuation">(</span>K<span class="token punctuation">,</span> C<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token keyword">def</span> combineByKey<span class="token punctuation">[</span>C<span class="token punctuation">]</span><span class="token punctuation">(</span>createCombiner<span class="token operator">:</span> <span class="token punctuation">(</span>V<span class="token punctuation">)</span> ⇒ C<span class="token punctuation">,</span> mergeValue<span class="token operator">:</span> <span class="token punctuation">(</span>C<span class="token punctuation">,</span> V<span class="token punctuation">)</span> ⇒ C<span class="token punctuation">,</span> mergeCombiners<span class="token operator">:</span> <span class="token punctuation">(</span>C<span class="token punctuation">,</span> C<span class="token punctuation">)</span> ⇒ C<span class="token punctuation">,</span> numPartitions<span class="token operator">:</span> <span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token operator">:</span> RDD<span class="token punctuation">[</span><span class="token punctuation">(</span>K<span class="token punctuation">,</span> C<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token keyword">def</span> combineByKey<span class="token punctuation">[</span>C<span class="token punctuation">]</span><span class="token punctuation">(</span>createCombiner<span class="token operator">:</span> <span class="token punctuation">(</span>V<span class="token punctuation">)</span> ⇒ C<span class="token punctuation">,</span> mergeValue<span class="token operator">:</span> <span class="token punctuation">(</span>C<span class="token punctuation">,</span> V<span class="token punctuation">)</span> ⇒ C<span class="token punctuation">,</span> mergeCombiners<span class="token operator">:</span> <span class="token punctuation">(</span>C<span class="token punctuation">,</span> C<span class="token punctuation">)</span> ⇒ C<span class="token punctuation">,</span> partitioner<span class="token operator">:</span> Partitioner<span class="token punctuation">,</span> mapSideCombine<span class="token operator">:</span> <span class="token builtin">Boolean</span> <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">,</span> serializer<span class="token operator">:</span> Serializer <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token operator">:</span> RDD<span class="token punctuation">[</span><span class="token punctuation">(</span>K<span class="token punctuation">,</span> C<span class="token punctuation">)</span><span class="token punctuation">]</span>createCombiner，createCombiner<span class="token punctuation">,</span> which turns a V into a C <span class="token punctuation">(</span>e<span class="token punctuation">.</span>g<span class="token punctuation">.</span><span class="token punctuation">,</span> creates a one<span class="token operator">-</span>element Array<span class="token punctuation">)</span>将 V 变成 C（例如，创建一个元素列表），C 不存在的情况下，比如通过 V 创建 seq C。mergeValue<span class="token punctuation">,</span> to <span class="token namespace">merge</span> a V into a C <span class="token punctuation">(</span>e<span class="token punctuation">.</span>g<span class="token punctuation">.</span><span class="token punctuation">,</span> adds it to <span class="token namespace">the</span> end of a Array<span class="token punctuation">)</span>将 V 合并为 C（例如，将其添加到列表的末尾），当 C 已经存在的情况下，需要 merge，比如把 item V 加到 seq C 中，或者叠加。mergeCombiners<span class="token punctuation">,</span> to <span class="token namespace">combine</span> two C<span class="token symbol">'s</span> into a single one<span class="token punctuation">.</span>将两个 C 合并为一个。mapSideCombine <span class="token builtin">Boolean</span> <span class="token operator">=</span> <span class="token boolean">true</span>为了减小传输量，很多 combine 可以在 map 端先做，比如叠加，可以先在一个 partition 中把所有相同的 key 的 value 叠加，再 shuffle。serializerClass： <span class="token builtin">String</span> <span class="token operator">=</span> <span class="token keyword">null</span>传输需要序列化，用户可以自定义序列化类。<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p></li><li><p><strong>示例：</strong></p><p><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala"><span class="token keyword">val</span> data <span class="token operator">=</span> sc<span class="token punctuation">.</span>parallelize<span class="token punctuation">(</span>Array<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">,</span> <span class="token number">88</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">,</span> <span class="token number">95</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">,</span> <span class="token number">91</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">"b"</span><span class="token punctuation">,</span> <span class="token number">93</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">"b"</span><span class="token punctuation">,</span> <span class="token number">95</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">"b"</span><span class="token punctuation">,</span> <span class="token number">98</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>data<span class="token punctuation">.</span>combineByKey<span class="token punctuation">(</span>    <span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token keyword">=></span> <span class="token punctuation">(</span>v<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token punctuation">(</span>c<span class="token operator">:</span> <span class="token punctuation">(</span><span class="token builtin">Int</span><span class="token punctuation">,</span> <span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token punctuation">,</span> v<span class="token punctuation">)</span> <span class="token keyword">=></span> <span class="token punctuation">(</span>c<span class="token punctuation">.</span>_1 <span class="token operator">+</span> v<span class="token punctuation">,</span> c<span class="token punctuation">.</span>_2 <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token punctuation">(</span>c1<span class="token operator">:</span> <span class="token punctuation">(</span><span class="token builtin">Int</span><span class="token punctuation">,</span> <span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token punctuation">,</span> c2<span class="token operator">:</span> <span class="token punctuation">(</span><span class="token builtin">Int</span><span class="token punctuation">,</span> <span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">=></span> <span class="token punctuation">(</span>c1<span class="token punctuation">.</span>_1 <span class="token operator">+</span> c2<span class="token punctuation">.</span>_1<span class="token punctuation">,</span> c1<span class="token punctuation">.</span>_2 <span class="token operator">+</span> c2<span class="token punctuation">.</span>_2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>collect<span class="token comment">// 输出结果</span>data<span class="token operator">:</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>spark<span class="token punctuation">.</span>rdd<span class="token punctuation">.</span>RDD<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token builtin">String</span><span class="token punctuation">,</span> <span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> ParallelCollectionRDD<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> at parallelize at <span class="token generics"><span class="token punctuation">&lt;</span>console<span class="token punctuation">></span></span><span class="token operator">:</span><span class="token number">25</span>res0<span class="token operator">:</span> Array<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token builtin">String</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token builtin">Int</span><span class="token punctuation">,</span> <span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> Array<span class="token punctuation">(</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">274</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>b<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">286</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p></li></ul><h3 id="reduceByKey-算子"><a href="#reduceByKey-算子" class="headerlink" title="reduceByKey 算子"></a>reduceByKey 算子</h3><ul><li><p><strong>说明：</strong>使用关联和可交换的归约函数合并每个键的值。在将结果发送给 reducer 之前，这还将在每个 Mapper 上本地执行合并，这与 MapReduce 中的 combiner 类似。输出将使用现有分区/并行级别进行哈希分区。</p><p>reduceByKey 是比 combineByKey 更简单的一种情况，只是两个值合并成一个值，(Int, Int V) to (Int, Int C)，比如叠加。所以 createCombiner reduceByKey 很简单，就是直接返回 v，而 mergeValue 和 mergeCombiners 逻辑是相同的，没有区别。图中的方框代表 RDD 分区。通过用户自定义函数 (A,B) =&gt; (A + B) 函数，将相同 key 的数据 (V1,2) 和 (V1,1) 的 value 相加运算，结果为 (V1,3)。</p><p><img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="/images/post/spark_rdd/reduce_by_key.png" alt></p></li><li><p><strong>用法：</strong></p><p><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala"><span class="token keyword">def</span> reduceByKey<span class="token punctuation">(</span>func<span class="token operator">:</span> <span class="token punctuation">(</span>V<span class="token punctuation">,</span> V<span class="token punctuation">)</span> ⇒ V<span class="token punctuation">)</span><span class="token operator">:</span> RDD<span class="token punctuation">[</span><span class="token punctuation">(</span>K<span class="token punctuation">,</span> V<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token keyword">def</span> reduceByKey<span class="token punctuation">(</span>func<span class="token operator">:</span> <span class="token punctuation">(</span>V<span class="token punctuation">,</span> V<span class="token punctuation">)</span> ⇒ V<span class="token punctuation">,</span> numPartitions<span class="token operator">:</span> <span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token operator">:</span> RDD<span class="token punctuation">[</span><span class="token punctuation">(</span>K<span class="token punctuation">,</span> V<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token keyword">def</span> reduceByKey<span class="token punctuation">(</span>partitioner<span class="token operator">:</span> Partitioner<span class="token punctuation">,</span> func<span class="token operator">:</span> <span class="token punctuation">(</span>V<span class="token punctuation">,</span> V<span class="token punctuation">)</span> ⇒ V<span class="token punctuation">)</span><span class="token operator">:</span> RDD<span class="token punctuation">[</span><span class="token punctuation">(</span>K<span class="token punctuation">,</span> V<span class="token punctuation">)</span><span class="token punctuation">]</span>Merge the values <span class="token keyword">for</span> each key using an associative and commutative reduce function<span class="token punctuation">.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></p></li><li><p><strong>示例：</strong></p><p><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala"><span class="token keyword">val</span> data <span class="token operator">=</span> sc<span class="token punctuation">.</span>parallelize<span class="token punctuation">(</span>Array<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">"b"</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">"b"</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>data<span class="token punctuation">.</span>reduceByKey<span class="token punctuation">(</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span> <span class="token keyword">=></span> x <span class="token operator">+</span> y<span class="token punctuation">)</span><span class="token punctuation">.</span>collectdata<span class="token punctuation">.</span>reduceByKey<span class="token punctuation">(</span>_ <span class="token operator">+</span> _<span class="token punctuation">)</span><span class="token punctuation">.</span>collect<span class="token comment">// 输出结果</span>data<span class="token operator">:</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>spark<span class="token punctuation">.</span>rdd<span class="token punctuation">.</span>RDD<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token builtin">Int</span><span class="token punctuation">,</span> <span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> ParallelCollectionRDD<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> at parallelize at <span class="token generics"><span class="token punctuation">&lt;</span>console<span class="token punctuation">></span></span><span class="token operator">:</span><span class="token number">25</span>res0<span class="token operator">:</span> Array<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token builtin">String</span><span class="token punctuation">,</span> <span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> Array<span class="token punctuation">(</span><span class="token punctuation">(</span>b<span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>a<span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>res1<span class="token operator">:</span> Array<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token builtin">String</span><span class="token punctuation">,</span> <span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> Array<span class="token punctuation">(</span><span class="token punctuation">(</span>b<span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>a<span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p></li></ul><h3 id="partitionBy-算子"><a href="#partitionBy-算子" class="headerlink" title="partitionBy 算子"></a>partitionBy 算子</h3><ul><li><p><strong>说明：</strong>返回使用指定分区程序分区的 RDD 的副本。</p><p>如果原有 RDD 的分区器和现有分区器（partitioner）一致，则不重分区，如果不一致，则相当于根据分区器生成一个新的 ShuffledRDD。图中的方框代表 RDD 分区。通过新的分区策略将原来在不同分区的 V1、 V2 数据都合并到了一个分区。</p><p><img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="/images/post/spark_rdd/partition_by.png" alt></p></li><li><p><strong>用法：</strong></p><p><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala"><span class="token keyword">def</span> partitionBy<span class="token punctuation">(</span>partitioner<span class="token operator">:</span> Partitioner<span class="token punctuation">)</span><span class="token operator">:</span> RDD<span class="token punctuation">[</span><span class="token punctuation">(</span>K<span class="token punctuation">,</span> V<span class="token punctuation">)</span><span class="token punctuation">]</span>Return a copy of the RDD partitioned using the specified partitioner<span class="token punctuation">.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></p></li><li><p><strong>示例：</strong></p><p><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala"><span class="token keyword">val</span> data <span class="token operator">=</span> sc<span class="token punctuation">.</span>parallelize<span class="token punctuation">(</span>Array<span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">"b"</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">"b"</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">"c"</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">"e"</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>data<span class="token punctuation">.</span>partitionBy<span class="token punctuation">(</span><span class="token keyword">new</span> HashPartitioner<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>glom<span class="token punctuation">.</span>collect<span class="token comment">// 输出结果</span>data<span class="token operator">:</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>spark<span class="token punctuation">.</span>rdd<span class="token punctuation">.</span>RDD<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token builtin">Int</span><span class="token punctuation">,</span> <span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> ParallelCollectionRDD<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> at parallelize at <span class="token generics"><span class="token punctuation">&lt;</span>console<span class="token punctuation">></span></span><span class="token operator">:</span><span class="token number">25</span>res0<span class="token operator">:</span> Array<span class="token punctuation">[</span>Array<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token builtin">String</span><span class="token punctuation">,</span> <span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> Array<span class="token punctuation">(</span>Array<span class="token punctuation">(</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>c<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> Array<span class="token punctuation">(</span><span class="token punctuation">(</span>b<span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>e<span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> Array<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> Array<span class="token punctuation">(</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>b<span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p></li></ul><p><strong>两个 RDD 聚合</strong></p><h3 id="cogroup-算子"><a href="#cogroup-算子" class="headerlink" title="cogroup 算子"></a>cogroup 算子</h3><ul><li><p><strong>说明：</strong>对在两个 RDD 中的 Key-Value 类型的元素，每个 RDD 相同 Key 的元素分别聚合为一个集合，并且返回两个 RDD 中对应 Key 的元素集合的迭代器。</p><p>其中，Key 和 Value，Value 是两个 RDD 下相同 Key 的两个数据集合的迭代器所构成的元组。图中的大方框代表 RDD，大方框内的小方框代表 RDD 中的分区。将 RDD1 中的数据 (U,1)、(U1,2) 和 RDD2 中的数据 (U1，2) 合并为 (U1,((1,2),(2)))。</p><p><img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="/images/post/spark_rdd/cogroup.png" alt></p></li><li><p><strong>用法：</strong></p><p><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala"><span class="token keyword">def</span> cogroup<span class="token punctuation">[</span>W1<span class="token punctuation">,</span> W2<span class="token punctuation">]</span><span class="token punctuation">(</span>other1<span class="token operator">:</span> RDD<span class="token punctuation">[</span><span class="token punctuation">(</span>K<span class="token punctuation">,</span> W1<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span> other2<span class="token operator">:</span> RDD<span class="token punctuation">[</span><span class="token punctuation">(</span>K<span class="token punctuation">,</span> W2<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span> numPartitions<span class="token operator">:</span> <span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token operator">:</span> RDD<span class="token punctuation">[</span><span class="token punctuation">(</span>K<span class="token punctuation">,</span> <span class="token punctuation">(</span>Iterable<span class="token punctuation">[</span>V<span class="token punctuation">]</span><span class="token punctuation">,</span> Iterable<span class="token punctuation">[</span>W1<span class="token punctuation">]</span><span class="token punctuation">,</span> Iterable<span class="token punctuation">[</span>W2<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span>For each key k in <span class="token keyword">this</span> or other1 or other2<span class="token punctuation">,</span> <span class="token keyword">return</span> a resulting RDD that contains a tuple <span class="token keyword">with</span> <span class="token namespace">the</span> list of values <span class="token keyword">for</span> that key in <span class="token keyword">this</span><span class="token punctuation">,</span> other1 and other2<span class="token punctuation">.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></p></li><li><p><strong>示例：</strong></p><p><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala"><span class="token keyword">val</span> data1 <span class="token operator">=</span> sc<span class="token punctuation">.</span>parallelize<span class="token punctuation">(</span>Array<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">val</span> data2 <span class="token operator">=</span> sc<span class="token punctuation">.</span>parallelize<span class="token punctuation">(</span>Array<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>data1<span class="token punctuation">.</span>cogroup<span class="token punctuation">(</span>data2<span class="token punctuation">)</span><span class="token punctuation">.</span>collect<span class="token comment">// 输出结果</span>data1<span class="token operator">:</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>spark<span class="token punctuation">.</span>rdd<span class="token punctuation">.</span>RDD<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token builtin">String</span><span class="token punctuation">,</span> <span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> ParallelCollectionRDD<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> at parallelize at <span class="token generics"><span class="token punctuation">&lt;</span>console<span class="token punctuation">></span></span><span class="token operator">:</span><span class="token number">25</span>data2<span class="token operator">:</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>spark<span class="token punctuation">.</span>rdd<span class="token punctuation">.</span>RDD<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token builtin">String</span><span class="token punctuation">,</span> <span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> ParallelCollectionRDD<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> at parallelize at <span class="token generics"><span class="token punctuation">&lt;</span>console<span class="token punctuation">></span></span><span class="token operator">:</span><span class="token number">25</span>res0<span class="token operator">:</span> Array<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token builtin">String</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>Iterable<span class="token punctuation">[</span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token punctuation">,</span> Iterable<span class="token punctuation">[</span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> Array<span class="token punctuation">(</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span><span class="token punctuation">(</span>CompactBuffer<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>CompactBuffer<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p></li></ul><h2 id="连接"><a href="#连接" class="headerlink" title="连接"></a>连接</h2><h3 id="join-算子"><a href="#join-算子" class="headerlink" title="join 算子"></a>join 算子</h3><ul><li><p><strong>说明：</strong>返回一个RDD，其中包含所有成对的元素。</p><p>join 对两个需要连接的 RDD 进行 cogroup 函数操作，将相同 key 的数据能够放到一个分区，在 cogroup 操作之后形成的新 RDD 对每个 key 下的元素进行笛卡尔积的操作，返回的结果再展平，对应 key 下的所有元组形成一个集合。最后返回 RDD[(K， (V， W))]。</p><p>下面代码为 join 的函数实现，本质是通过 cogroup 算子先进行协同划分，再通过 flatMapValues 将合并的数据打散。</p><p><code>this.cogroup(other, partitioner).flatMapValues&#123;case(vs, ws) =&gt; for(v&lt;-vs; w&lt;-ws) yield(v, w) &#125;</code></p><p>下图是对两个 RDD 的 join 操作示意图。大方框代表 RDD，小方框代表 RDD 中的分区。函数对相同 key 的元素，如 V1 为 key 做连接后结果为 (V1,(1,1)) 和 (V1,(1,2))。</p><p><img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="/images/post/spark_rdd/join.png" alt></p></li><li><p><strong>用法：</strong></p><p><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala"><span class="token keyword">def</span> join<span class="token punctuation">[</span>W<span class="token punctuation">]</span><span class="token punctuation">(</span>other<span class="token operator">:</span> RDD<span class="token punctuation">[</span><span class="token punctuation">(</span>K<span class="token punctuation">,</span> W<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> RDD<span class="token punctuation">[</span><span class="token punctuation">(</span>K<span class="token punctuation">,</span> <span class="token punctuation">(</span>V<span class="token punctuation">,</span> W<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token keyword">def</span> join<span class="token punctuation">[</span>W<span class="token punctuation">]</span><span class="token punctuation">(</span>other<span class="token operator">:</span> RDD<span class="token punctuation">[</span><span class="token punctuation">(</span>K<span class="token punctuation">,</span> W<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span> numPartitions<span class="token operator">:</span> <span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token operator">:</span> RDD<span class="token punctuation">[</span><span class="token punctuation">(</span>K<span class="token punctuation">,</span> <span class="token punctuation">(</span>V<span class="token punctuation">,</span> W<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token keyword">def</span> join<span class="token punctuation">[</span>W<span class="token punctuation">]</span><span class="token punctuation">(</span>other<span class="token operator">:</span> RDD<span class="token punctuation">[</span><span class="token punctuation">(</span>K<span class="token punctuation">,</span> W<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span> partitioner<span class="token operator">:</span> Partitioner<span class="token punctuation">)</span><span class="token operator">:</span> RDD<span class="token punctuation">[</span><span class="token punctuation">(</span>K<span class="token punctuation">,</span> <span class="token punctuation">(</span>V<span class="token punctuation">,</span> W<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span>Return an RDD containing all pairs of elements <span class="token keyword">with</span> <span class="token namespace">matching</span> keys in <span class="token keyword">this</span> and other<span class="token punctuation">.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></p></li><li><p><strong>示例：</strong></p><p><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala"><span class="token keyword">val</span> data1 <span class="token operator">=</span> sc<span class="token punctuation">.</span>parallelize<span class="token punctuation">(</span>Array<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">val</span> data2 <span class="token operator">=</span> sc<span class="token punctuation">.</span>parallelize<span class="token punctuation">(</span>Array<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>data1<span class="token punctuation">.</span>join<span class="token punctuation">(</span>data2<span class="token punctuation">)</span><span class="token punctuation">.</span>collect<span class="token comment">// 输出结果</span>data1<span class="token operator">:</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>spark<span class="token punctuation">.</span>rdd<span class="token punctuation">.</span>RDD<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token builtin">String</span><span class="token punctuation">,</span> <span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> ParallelCollectionRDD<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> at parallelize at <span class="token generics"><span class="token punctuation">&lt;</span>console<span class="token punctuation">></span></span><span class="token operator">:</span><span class="token number">25</span>data2<span class="token operator">:</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>spark<span class="token punctuation">.</span>rdd<span class="token punctuation">.</span>RDD<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token builtin">String</span><span class="token punctuation">,</span> <span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> ParallelCollectionRDD<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> at parallelize at <span class="token generics"><span class="token punctuation">&lt;</span>console<span class="token punctuation">></span></span><span class="token operator">:</span><span class="token number">25</span>res0<span class="token operator">:</span> Array<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token builtin">String</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token builtin">Int</span><span class="token punctuation">,</span> <span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> Array<span class="token punctuation">(</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>a<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>a<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>a<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p></li></ul><h3 id="leftOuterJoin-和-rightOuterJoin-算子"><a href="#leftOuterJoin-和-rightOuterJoin-算子" class="headerlink" title="leftOuterJoin 和 rightOuterJoin 算子"></a>leftOuterJoin 和 rightOuterJoin 算子</h3><ul><li><p><strong>说明：</strong>leftOuterJoin（左外连接）和 rightOuterJoin（右外连接）相当于在 join 的基础上先判断一侧的 RDD 元素是否为空，如果为空，则填充为空。如果不为空，则将数据进行连接运算，并返回结果。</p></li><li><p><strong>用法：</strong></p><p><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala"><span class="token keyword">def</span> leftOuterJoin<span class="token punctuation">[</span>W<span class="token punctuation">]</span><span class="token punctuation">(</span>other<span class="token operator">:</span> RDD<span class="token punctuation">[</span><span class="token punctuation">(</span>K<span class="token punctuation">,</span> W<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> RDD<span class="token punctuation">[</span><span class="token punctuation">(</span>K<span class="token punctuation">,</span> <span class="token punctuation">(</span>V<span class="token punctuation">,</span> Option<span class="token punctuation">[</span>W<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token keyword">def</span> leftOuterJoin<span class="token punctuation">[</span>W<span class="token punctuation">]</span><span class="token punctuation">(</span>other<span class="token operator">:</span> RDD<span class="token punctuation">[</span><span class="token punctuation">(</span>K<span class="token punctuation">,</span> W<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span> numPartitions<span class="token operator">:</span> <span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token operator">:</span> RDD<span class="token punctuation">[</span><span class="token punctuation">(</span>K<span class="token punctuation">,</span> <span class="token punctuation">(</span>V<span class="token punctuation">,</span> Option<span class="token punctuation">[</span>W<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token keyword">def</span> leftOuterJoin<span class="token punctuation">[</span>W<span class="token punctuation">]</span><span class="token punctuation">(</span>other<span class="token operator">:</span> RDD<span class="token punctuation">[</span><span class="token punctuation">(</span>K<span class="token punctuation">,</span> W<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span> partitioner<span class="token operator">:</span> Partitioner<span class="token punctuation">)</span><span class="token operator">:</span> RDD<span class="token punctuation">[</span><span class="token punctuation">(</span>K<span class="token punctuation">,</span> <span class="token punctuation">(</span>V<span class="token punctuation">,</span> Option<span class="token punctuation">[</span>W<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span>Perform a left outer join of <span class="token keyword">this</span> and other<span class="token punctuation">.</span> For each element <span class="token punctuation">(</span>k<span class="token punctuation">,</span> v<span class="token punctuation">)</span> in <span class="token keyword">this</span><span class="token punctuation">,</span> the resulting RDD will either contain all pairs <span class="token punctuation">(</span>k<span class="token punctuation">,</span> <span class="token punctuation">(</span>v<span class="token punctuation">,</span> Some<span class="token punctuation">(</span>w<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">for</span> w in other<span class="token punctuation">,</span> or the pair <span class="token punctuation">(</span>k<span class="token punctuation">,</span> <span class="token punctuation">(</span>v<span class="token punctuation">,</span> None<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">if</span> no elements in other have key k<span class="token punctuation">.</span> Hash<span class="token operator">-</span>partitions the output using the existing partitioner<span class="token operator">/</span>parallelism level<span class="token punctuation">.</span><span class="token keyword">def</span> rightOuterJoin<span class="token punctuation">[</span>W<span class="token punctuation">]</span><span class="token punctuation">(</span>other<span class="token operator">:</span> RDD<span class="token punctuation">[</span><span class="token punctuation">(</span>K<span class="token punctuation">,</span> W<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> RDD<span class="token punctuation">[</span><span class="token punctuation">(</span>K<span class="token punctuation">,</span> <span class="token punctuation">(</span>Option<span class="token punctuation">[</span>V<span class="token punctuation">]</span><span class="token punctuation">,</span> W<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token keyword">def</span> rightOuterJoin<span class="token punctuation">[</span>W<span class="token punctuation">]</span><span class="token punctuation">(</span>other<span class="token operator">:</span> RDD<span class="token punctuation">[</span><span class="token punctuation">(</span>K<span class="token punctuation">,</span> W<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span> numPartitions<span class="token operator">:</span> <span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token operator">:</span> RDD<span class="token punctuation">[</span><span class="token punctuation">(</span>K<span class="token punctuation">,</span> <span class="token punctuation">(</span>Option<span class="token punctuation">[</span>V<span class="token punctuation">]</span><span class="token punctuation">,</span> W<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token keyword">def</span> rightOuterJoin<span class="token punctuation">[</span>W<span class="token punctuation">]</span><span class="token punctuation">(</span>other<span class="token operator">:</span> RDD<span class="token punctuation">[</span><span class="token punctuation">(</span>K<span class="token punctuation">,</span> W<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span> partitioner<span class="token operator">:</span> Partitioner<span class="token punctuation">)</span><span class="token operator">:</span> RDD<span class="token punctuation">[</span><span class="token punctuation">(</span>K<span class="token punctuation">,</span> <span class="token punctuation">(</span>Option<span class="token punctuation">[</span>V<span class="token punctuation">]</span><span class="token punctuation">,</span> W<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span>Perform a right outer join of <span class="token keyword">this</span> and other<span class="token punctuation">.</span> For each element <span class="token punctuation">(</span>k<span class="token punctuation">,</span> w<span class="token punctuation">)</span> in other<span class="token punctuation">,</span> the resulting RDD will either contain all pairs <span class="token punctuation">(</span>k<span class="token punctuation">,</span> <span class="token punctuation">(</span>Some<span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">,</span> w<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">for</span> v in <span class="token keyword">this</span><span class="token punctuation">,</span> or the pair <span class="token punctuation">(</span>k<span class="token punctuation">,</span> <span class="token punctuation">(</span>None<span class="token punctuation">,</span> w<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">if</span> no elements in <span class="token keyword">this</span> have key k<span class="token punctuation">.</span> Hash<span class="token operator">-</span>partitions the resulting RDD using the existing partitioner<span class="token operator">/</span>parallelism level<span class="token punctuation">.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p></li><li><p><strong>示例：</strong></p><p><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala"><span class="token keyword">val</span> data1 <span class="token operator">=</span> sc<span class="token punctuation">.</span>parallelize<span class="token punctuation">(</span>Array<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">val</span> data2 <span class="token operator">=</span> sc<span class="token punctuation">.</span>parallelize<span class="token punctuation">(</span>Array<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">"b"</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>data1<span class="token punctuation">.</span>leftOuterJoin<span class="token punctuation">(</span>data2<span class="token punctuation">)</span><span class="token punctuation">.</span>collectdata2<span class="token punctuation">.</span>leftOuterJoin<span class="token punctuation">(</span>data1<span class="token punctuation">)</span><span class="token punctuation">.</span>collectdata1<span class="token punctuation">.</span>rightOuterJoin<span class="token punctuation">(</span>data2<span class="token punctuation">)</span><span class="token punctuation">.</span>collectdata2<span class="token punctuation">.</span>rightOuterJoin<span class="token punctuation">(</span>data1<span class="token punctuation">)</span><span class="token punctuation">.</span>collect<span class="token comment">// 输出结果</span>data1<span class="token operator">:</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>spark<span class="token punctuation">.</span>rdd<span class="token punctuation">.</span>RDD<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token builtin">String</span><span class="token punctuation">,</span> <span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> ParallelCollectionRDD<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> at parallelize at <span class="token generics"><span class="token punctuation">&lt;</span>console<span class="token punctuation">></span></span><span class="token operator">:</span><span class="token number">25</span>data2<span class="token operator">:</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>spark<span class="token punctuation">.</span>rdd<span class="token punctuation">.</span>RDD<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token builtin">String</span><span class="token punctuation">,</span> <span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> ParallelCollectionRDD<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> at parallelize at <span class="token generics"><span class="token punctuation">&lt;</span>console<span class="token punctuation">></span></span><span class="token operator">:</span><span class="token number">25</span>res0<span class="token operator">:</span> Array<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token builtin">String</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token builtin">Int</span><span class="token punctuation">,</span> Option<span class="token punctuation">[</span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> Array<span class="token punctuation">(</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span>Some<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>a<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>Some<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>res1<span class="token operator">:</span> Array<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token builtin">String</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token builtin">Int</span><span class="token punctuation">,</span> Option<span class="token punctuation">[</span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> Array<span class="token punctuation">(</span><span class="token punctuation">(</span>b<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span>None<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>a<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span>Some<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>a<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span>Some<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>res2<span class="token operator">:</span> Array<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token builtin">String</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>Option<span class="token punctuation">[</span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> Array<span class="token punctuation">(</span><span class="token punctuation">(</span>b<span class="token punctuation">,</span><span class="token punctuation">(</span>None<span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>a<span class="token punctuation">,</span><span class="token punctuation">(</span>Some<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>a<span class="token punctuation">,</span><span class="token punctuation">(</span>Some<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>res3<span class="token operator">:</span> Array<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token builtin">String</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>Option<span class="token punctuation">[</span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> Array<span class="token punctuation">(</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span><span class="token punctuation">(</span>Some<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>a<span class="token punctuation">,</span><span class="token punctuation">(</span>Some<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p></li></ul><h1 id="Action-算子"><a href="#Action-算子" class="headerlink" title="Action 算子"></a>Action 算子</h1><p>本质上在 Action 算子中通过 SparkContext 进行了提交作业的 runJob 操作，触发了RDD DAG 的执行。</p><h2 id="无输出"><a href="#无输出" class="headerlink" title="无输出"></a>无输出</h2><h3 id="foreach-算子"><a href="#foreach-算子" class="headerlink" title="foreach 算子"></a>foreach 算子</h3><ul><li><p><strong>说明：</strong>foreach 对 RDD 中的每个元素都应用 f 函数操作，不返回 RDD 和 Array， 而是返回 Uint。下图表示 foreach 算子通过用户自定义函数对每个数据项进行操作。本例中自定义函数为 println()，控制台打印所有数据项。</p><p><img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="/images/post/spark_rdd/foreach.png" alt></p></li><li><p><strong>用法：</strong></p><p><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala"><span class="token keyword">def</span> foreach<span class="token punctuation">[</span>U<span class="token punctuation">]</span><span class="token punctuation">(</span>f<span class="token operator">:</span> <span class="token punctuation">(</span>T<span class="token punctuation">)</span> ⇒ U<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">implicit</span> executor<span class="token operator">:</span> ExecutionContext<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p></li><li><p><strong>示例：</strong></p><p><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala"><span class="token keyword">val</span> data <span class="token operator">=</span> sc<span class="token punctuation">.</span>parallelize<span class="token punctuation">(</span><span class="token number">1</span> to <span class="token number">5</span><span class="token punctuation">)</span><span class="token keyword">var</span> sum <span class="token operator">=</span> sc<span class="token punctuation">.</span>accumulator<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>data<span class="token punctuation">.</span>foreach<span class="token punctuation">(</span>sum <span class="token operator">+=</span> _<span class="token punctuation">)</span>sum<span class="token punctuation">.</span>valuedata<span class="token punctuation">.</span>collect<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>foreach<span class="token punctuation">(</span>println<span class="token punctuation">)</span><span class="token comment">// 输出结果</span>data<span class="token operator">:</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>spark<span class="token punctuation">.</span>rdd<span class="token punctuation">.</span>RDD<span class="token punctuation">[</span><span class="token builtin">Int</span><span class="token punctuation">]</span> <span class="token operator">=</span> ParallelCollectionRDD<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> at parallelize at <span class="token generics"><span class="token punctuation">&lt;</span>console<span class="token punctuation">></span></span><span class="token operator">:</span><span class="token number">25</span>sum<span class="token operator">:</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>spark<span class="token punctuation">.</span>Accumulator<span class="token punctuation">[</span><span class="token builtin">Int</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span>res0<span class="token operator">:</span> <span class="token builtin">Int</span> <span class="token operator">=</span> <span class="token number">15</span><span class="token number">1</span><span class="token number">2</span><span class="token number">3</span><span class="token number">4</span><span class="token number">5</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p></li></ul><h2 id="HDFS"><a href="#HDFS" class="headerlink" title="HDFS"></a>HDFS</h2><h3 id="saveAsTextFile-算子"><a href="#saveAsTextFile-算子" class="headerlink" title="saveAsTextFile 算子"></a>saveAsTextFile 算子</h3><ul><li><p><strong>说明：</strong>使用元素的字符串表示形式将此 RDD 保存为文本文件。将数据输出，存储到 HDFS 的指定目录。</p><p>下面为 saveAsTextFile 函数的内部实现，其内部通过调用 saveAsHadoopFile 进行实现：</p><p><code>this.map(x =&gt; (NullWritable.get(), new Text(x.toString))).saveAsHadoopFile[TextOutputFormat[NullWritable, Text]](path)</code></p><p>将 RDD 中的每个元素映射转变为 (null, x.toString)，然后再将其写入 HDFS。下图中左侧方框代表 RDD 分区，右侧方框代表 HDFS 的 Block。通过函数将 RDD 的每个分区存储为 HDFS 中的一个 Block。</p><p><img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="/images/post/spark_rdd/save_as_text_file.png" alt></p></li><li><p><strong>用法：</strong></p><p><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala"><span class="token keyword">def</span> saveAsTextFile<span class="token punctuation">(</span>path<span class="token operator">:</span> <span class="token builtin">String</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span>Save <span class="token keyword">this</span> RDD as a text file<span class="token punctuation">,</span> using string representations of elements<span class="token punctuation">.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></p></li><li><p><strong>示例：</strong></p><p><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala"><span class="token keyword">val</span> data <span class="token operator">=</span> sc<span class="token punctuation">.</span>parallelize<span class="token punctuation">(</span><span class="token number">1</span> to <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>data<span class="token punctuation">.</span>partitions<span class="token punctuation">.</span>sizedata<span class="token punctuation">.</span>saveAsTextFile<span class="token punctuation">(</span><span class="token string">"/test/rdd"</span><span class="token punctuation">)</span><span class="token comment">// 输出结果</span>data<span class="token operator">:</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>spark<span class="token punctuation">.</span>rdd<span class="token punctuation">.</span>RDD<span class="token punctuation">[</span>scala<span class="token punctuation">.</span>collection<span class="token punctuation">.</span>immutable<span class="token punctuation">.</span>Range<span class="token punctuation">.</span>Inclusive<span class="token punctuation">]</span> <span class="token operator">=</span> ParallelCollectionRDD<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> at parallelize at <span class="token generics"><span class="token punctuation">&lt;</span>console<span class="token punctuation">></span></span><span class="token operator">:</span><span class="token number">25</span>res0<span class="token operator">:</span> <span class="token builtin">Int</span> <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">[</span>root<span class="token annotation punctuation">@master</span><span class="token punctuation">]</span># hdfs dfs <span class="token operator">-</span>ls <span class="token operator">/</span>test<span class="token operator">/</span>rddFound <span class="token number">4</span> items<span class="token operator">-</span>rw<span class="token operator">-</span>r<span class="token operator">--</span>r<span class="token operator">--</span>   <span class="token number">3</span> root supergroup          <span class="token number">0</span> <span class="token number">2021</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">07</span> <span class="token number">16</span><span class="token operator">:</span><span class="token number">57</span> <span class="token operator">/</span>test<span class="token operator">/</span>rdd<span class="token operator">/</span>_SUCCESS<span class="token operator">-</span>rw<span class="token operator">-</span>r<span class="token operator">--</span>r<span class="token operator">--</span>   <span class="token number">3</span> root supergroup          <span class="token number">0</span> <span class="token number">2021</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">07</span> <span class="token number">16</span><span class="token operator">:</span><span class="token number">57</span> <span class="token operator">/</span>test<span class="token operator">/</span>rdd<span class="token operator">/</span>part<span class="token operator">-</span><span class="token number">00000</span><span class="token operator">-</span>rw<span class="token operator">-</span>r<span class="token operator">--</span>r<span class="token operator">--</span>   <span class="token number">3</span> root supergroup          <span class="token number">0</span> <span class="token number">2021</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">07</span> <span class="token number">16</span><span class="token operator">:</span><span class="token number">57</span> <span class="token operator">/</span>test<span class="token operator">/</span>rdd<span class="token operator">/</span>part<span class="token operator">-</span><span class="token number">00001</span><span class="token operator">-</span>rw<span class="token operator">-</span>r<span class="token operator">--</span>r<span class="token operator">--</span>   <span class="token number">3</span> root supergroup          <span class="token number">0</span> <span class="token number">2021</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">07</span> <span class="token number">16</span><span class="token operator">:</span><span class="token number">57</span> <span class="token operator">/</span>test<span class="token operator">/</span>rdd<span class="token operator">/</span>part<span class="token operator">-</span><span class="token number">00002</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p></li></ul><h3 id="saveAsObjectFile-算子"><a href="#saveAsObjectFile-算子" class="headerlink" title="saveAsObjectFile 算子"></a>saveAsObjectFile 算子</h3><ul><li><p><strong>说明：</strong>将此 RDD 保存为序列化对象的 SequenceFile。</p><p>saveAsObjectFile 将分区中的每 10 个元素组成一个 Array，然后将这个 Array 序列化，映射为 (Null, BytesWritable(Y)) 的元素，写入 HDFS 为 SequenceFile 的格式。下面代码为函数内部实现。</p><p><code>map(x=&gt;(NullWritable.get()，new BytesWritable(Utils.serialize(x))))</code></p><p>下图中的左侧方框代表 RDD 分区，右侧方框代表 HDFS 的 Block。通过函数将 RDD 的每个分区存储为 HDFS 上的一个 Block。</p><p><img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="/images/post/spark_rdd/save_as_object_file.png" alt></p></li><li><p><strong>用法：</strong></p><p><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala"><span class="token keyword">def</span> saveAsObjectFile<span class="token punctuation">(</span>path<span class="token operator">:</span> <span class="token builtin">String</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span>Save <span class="token keyword">this</span> RDD as a SequenceFile of serialized objects<span class="token punctuation">.</span><span class="token keyword">def</span> saveAsTextFile<span class="token punctuation">(</span>path<span class="token operator">:</span> <span class="token builtin">String</span><span class="token punctuation">,</span> codec<span class="token operator">:</span> Class<span class="token punctuation">[</span>_ <span class="token operator">&lt;</span><span class="token operator">:</span> CompressionCodec<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span>Save <span class="token keyword">this</span> RDD as a compressed text file<span class="token punctuation">,</span> using string representations of elements<span class="token punctuation">.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></p></li><li><p><strong>示例：</strong></p><p><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala"><span class="token keyword">val</span> data <span class="token operator">=</span> sc<span class="token punctuation">.</span>parallelize<span class="token punctuation">(</span><span class="token number">1</span> to <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>data<span class="token punctuation">.</span>partitions<span class="token punctuation">.</span>sizedata<span class="token punctuation">.</span>saveAsObjectFile<span class="token punctuation">(</span><span class="token string">"/test/rdd"</span><span class="token punctuation">)</span><span class="token comment">// 输出结果</span>data<span class="token operator">:</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>spark<span class="token punctuation">.</span>rdd<span class="token punctuation">.</span>RDD<span class="token punctuation">[</span>scala<span class="token punctuation">.</span>collection<span class="token punctuation">.</span>immutable<span class="token punctuation">.</span>Range<span class="token punctuation">.</span>Inclusive<span class="token punctuation">]</span> <span class="token operator">=</span> ParallelCollectionRDD<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> at parallelize at <span class="token generics"><span class="token punctuation">&lt;</span>console<span class="token punctuation">></span></span><span class="token operator">:</span><span class="token number">25</span>res0<span class="token operator">:</span> <span class="token builtin">Int</span> <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">[</span>root<span class="token annotation punctuation">@master</span><span class="token punctuation">]</span># hdfs dfs <span class="token operator">-</span>ls <span class="token operator">/</span>test<span class="token operator">/</span>rddFound <span class="token number">4</span> items<span class="token operator">-</span>rw<span class="token operator">-</span>r<span class="token operator">--</span>r<span class="token operator">--</span>   <span class="token number">3</span> root supergroup          <span class="token number">0</span> <span class="token number">2021</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">07</span> <span class="token number">16</span><span class="token operator">:</span><span class="token number">57</span> <span class="token operator">/</span>test<span class="token operator">/</span>rdd<span class="token operator">/</span>_SUCCESS<span class="token operator">-</span>rw<span class="token operator">-</span>r<span class="token operator">--</span>r<span class="token operator">--</span>   <span class="token number">3</span> root supergroup          <span class="token number">0</span> <span class="token number">2021</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">07</span> <span class="token number">16</span><span class="token operator">:</span><span class="token number">57</span> <span class="token operator">/</span>test<span class="token operator">/</span>rdd<span class="token operator">/</span>part<span class="token operator">-</span><span class="token number">00000</span><span class="token operator">-</span>rw<span class="token operator">-</span>r<span class="token operator">--</span>r<span class="token operator">--</span>   <span class="token number">3</span> root supergroup          <span class="token number">0</span> <span class="token number">2021</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">07</span> <span class="token number">16</span><span class="token operator">:</span><span class="token number">57</span> <span class="token operator">/</span>test<span class="token operator">/</span>rdd<span class="token operator">/</span>part<span class="token operator">-</span><span class="token number">00001</span><span class="token operator">-</span>rw<span class="token operator">-</span>r<span class="token operator">--</span>r<span class="token operator">--</span>   <span class="token number">3</span> root supergroup          <span class="token number">0</span> <span class="token number">2021</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">07</span> <span class="token number">16</span><span class="token operator">:</span><span class="token number">57</span> <span class="token operator">/</span>test<span class="token operator">/</span>rdd<span class="token operator">/</span>part<span class="token operator">-</span><span class="token number">00002</span><span class="token punctuation">[</span>root<span class="token annotation punctuation">@master</span><span class="token punctuation">]</span># hadoop fs <span class="token operator">-</span>cat <span class="token operator">/</span>test<span class="token operator">/</span>rdd<span class="token operator">/</span>part<span class="token operator">-</span><span class="token number">00000</span>SEQ <span class="token operator">!</span>org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>io<span class="token punctuation">.</span>NullWritable"org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>io<span class="token punctuation">.</span>BytesWritableT<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p></li></ul><h2 id="Scala-集合和数据类型"><a href="#Scala-集合和数据类型" class="headerlink" title="Scala 集合和数据类型"></a>Scala 集合和数据类型</h2><h3 id="collect-算子"><a href="#collect-算子" class="headerlink" title="collect 算子"></a>collect 算子</h3><ul><li><p><strong>说明：</strong>返回一个包含此 RDD 中所有元素的数组。</p><p>collect 相当于 toArray，toArray 已经过时不推荐使用，collect 将分布式的 RDD 返回为一个单机的 scala Array 数组。在这个数组上运用 scala 的函数式操作。下图中左侧方框代表 RDD 分区，右侧方框代表单机内存中的数组。通过函数操作，将结果返回到 Driver 程序所在的节点，以数组形式存储。</p><p><img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="/images/post/spark_rdd/collect.png" alt></p></li><li><p><strong>用法：</strong></p><p><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala"><span class="token keyword">def</span> collect<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> List<span class="token punctuation">[</span>T<span class="token punctuation">]</span>Return an array that contains all of the elements in <span class="token keyword">this</span> RDD<span class="token punctuation">.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></p></li><li><p><strong>示例：</strong></p><p><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala"><span class="token keyword">val</span> data <span class="token operator">=</span> sc<span class="token punctuation">.</span>parallelize<span class="token punctuation">(</span><span class="token number">1</span> to <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>data<span class="token punctuation">.</span>collect<span class="token comment">// 输出结果</span>data<span class="token operator">:</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>spark<span class="token punctuation">.</span>rdd<span class="token punctuation">.</span>RDD<span class="token punctuation">[</span><span class="token builtin">Int</span><span class="token punctuation">]</span> <span class="token operator">=</span> ParallelCollectionRDD<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> at parallelize at <span class="token generics"><span class="token punctuation">&lt;</span>console<span class="token punctuation">></span></span><span class="token operator">:</span><span class="token number">25</span>res0<span class="token operator">:</span> Array<span class="token punctuation">[</span><span class="token builtin">Int</span><span class="token punctuation">]</span> <span class="token operator">=</span> Array<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p></li></ul><h3 id="collectAsMap-算子"><a href="#collectAsMap-算子" class="headerlink" title="collectAsMap 算子"></a>collectAsMap 算子</h3><ul><li><p><strong>说明：</strong>collectAsMap 对 (K，V) 型的 RDD 数据返回一个单机 HashMap。对于重复 K 的 RDD 元素，后面的元素覆盖前面的元素。</p><p>下图中的左侧方框代表 RDD 分区，右侧方框代表单机数组。数据通过 collectAsMap 函数返回给 Driver 程序计算结果，结果以 HashMap 形式存储。</p><p><img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="/images/post/spark_rdd/collect_as_map.png" alt></p></li><li><p><strong>用法：</strong></p><p><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala"><span class="token keyword">def</span> collectAsMap<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> Map<span class="token punctuation">[</span>K<span class="token punctuation">,</span> V<span class="token punctuation">]</span>Return the key<span class="token operator">-</span>value pairs in <span class="token keyword">this</span> RDD to <span class="token namespace">the</span> master as a Map<span class="token punctuation">.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></p></li><li><p><strong>示例：</strong></p><p><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala"><span class="token keyword">val</span> data <span class="token operator">=</span> sc<span class="token punctuation">.</span>parallelize<span class="token punctuation">(</span>Array<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">"b,2"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>data<span class="token punctuation">.</span>collectAsMap<span class="token comment">// 输出结果</span>data<span class="token operator">:</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>spark<span class="token punctuation">.</span>rdd<span class="token punctuation">.</span>RDD<span class="token punctuation">[</span><span class="token builtin">Int</span><span class="token punctuation">]</span> <span class="token operator">=</span> ParallelCollectionRDD<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> at parallelize at <span class="token generics"><span class="token punctuation">&lt;</span>console<span class="token punctuation">></span></span><span class="token operator">:</span><span class="token number">25</span>res0<span class="token operator">:</span> scala<span class="token punctuation">.</span>collection<span class="token punctuation">.</span>Map<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token builtin">Int</span><span class="token punctuation">]</span> <span class="token operator">=</span> Map<span class="token punctuation">(</span>a <span class="token operator">-></span> <span class="token number">3</span><span class="token punctuation">,</span> b <span class="token operator">-></span> <span class="token number">2</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p></li></ul><h3 id="reduceByKeyLocally-算子"><a href="#reduceByKeyLocally-算子" class="headerlink" title="reduceByKeyLocally 算子"></a>reduceByKeyLocally 算子</h3><ul><li><p><strong>说明：</strong>使用关联和可交换的 reduce 函数合并每个键的值，但是将结果作为 Map 返回。</p><p>实现的是先 reduce 再 collectAsMap 的功能，先对 RDD 的整体进行 reduce 操作，然后再收集所有结果返回为一个 HashMap。</p></li><li><p><strong>用法：</strong></p><p><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala"><span class="token keyword">def</span> reduceByKeyLocally<span class="token punctuation">(</span>func<span class="token operator">:</span> Function2<span class="token punctuation">[</span>V<span class="token punctuation">,</span> V<span class="token punctuation">,</span> V<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> Map<span class="token punctuation">[</span>K<span class="token punctuation">,</span> V<span class="token punctuation">]</span>Merge the values <span class="token keyword">for</span> each key using an associative and commutative reduce function<span class="token punctuation">,</span> but <span class="token keyword">return</span> the result immediately to <span class="token namespace">the</span> master as a Map<span class="token punctuation">.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></p></li><li><p><strong>示例：</strong></p><p><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala"><span class="token keyword">var</span> data <span class="token operator">=</span> sc<span class="token punctuation">.</span>parallelize<span class="token punctuation">(</span>Array<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">"b"</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">"b"</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">"c"</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>data<span class="token punctuation">.</span>reduceByKeyLocally<span class="token punctuation">(</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span> <span class="token keyword">=></span> x <span class="token operator">+</span> y<span class="token punctuation">)</span><span class="token comment">// 输出结果</span>data<span class="token operator">:</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>spark<span class="token punctuation">.</span>rdd<span class="token punctuation">.</span>RDD<span class="token punctuation">[</span><span class="token builtin">Int</span><span class="token punctuation">]</span> <span class="token operator">=</span> ParallelCollectionRDD<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> at parallelize at <span class="token generics"><span class="token punctuation">&lt;</span>console<span class="token punctuation">></span></span><span class="token operator">:</span><span class="token number">25</span>res0<span class="token operator">:</span> scala<span class="token punctuation">.</span>collection<span class="token punctuation">.</span>Map<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token builtin">Int</span><span class="token punctuation">]</span> <span class="token operator">=</span> Map<span class="token punctuation">(</span>a <span class="token operator">-></span> <span class="token number">2</span><span class="token punctuation">,</span> b <span class="token operator">-></span> <span class="token number">3</span><span class="token punctuation">,</span> c <span class="token operator">-></span> <span class="token number">1</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p></li></ul><h3 id="lookup-算子"><a href="#lookup-算子" class="headerlink" title="lookup 算子"></a>lookup 算子</h3><ul><li><p><strong>说明：</strong>返回 RDD 中 key 的值列表。lookup 函数对 (Key, Value) 型的 RDD 操作，返回指定 Key 对应的元素形成的Seq。这个函数处理优化的部分在于，如果这个 RDD 包含分区器，则只会对应处理 K 所在的分区，然后返回由 (K,V) 形成的 Seq。如果 RDD 不包含分区器，则需要对全 RDD 元素进行暴力扫描处理，搜索指定 K 对应的元素。</p><p>下图中的左侧方框代表 RDD 分区，右侧方框代表 Seq，最后结果返回到 Driver 所在节点的应用中。</p><p><img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="/images/post/spark_rdd/lookup.png" alt></p></li><li><p><strong>用法：</strong></p><p><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala"><span class="token keyword">def</span> lookup<span class="token punctuation">(</span>key<span class="token operator">:</span> K<span class="token punctuation">)</span><span class="token operator">:</span> List<span class="token punctuation">[</span>V<span class="token punctuation">]</span>Return the list of values in the RDD <span class="token keyword">for</span> key<span class="token punctuation">.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></p></li><li><p><strong>示例：</strong></p><p><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala"><span class="token keyword">var</span> data <span class="token operator">=</span> sc<span class="token punctuation">.</span>parallelize<span class="token punctuation">(</span>Array<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">"b"</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>data<span class="token punctuation">.</span>lookup<span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">)</span>data<span class="token punctuation">.</span>lookup<span class="token punctuation">(</span><span class="token string">"b"</span><span class="token punctuation">)</span><span class="token comment">// 输出结果</span>data<span class="token operator">:</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>spark<span class="token punctuation">.</span>rdd<span class="token punctuation">.</span>RDD<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token builtin">String</span><span class="token punctuation">,</span> <span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> ParallelCollectionRDD<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> at parallelize at <span class="token generics"><span class="token punctuation">&lt;</span>console<span class="token punctuation">></span></span><span class="token operator">:</span><span class="token number">25</span>res0<span class="token operator">:</span> Seq<span class="token punctuation">[</span><span class="token builtin">Int</span><span class="token punctuation">]</span> <span class="token operator">=</span> WrappedArray<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>res1<span class="token operator">:</span> Seq<span class="token punctuation">[</span><span class="token builtin">Int</span><span class="token punctuation">]</span> <span class="token operator">=</span> WrappedArray<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p></li></ul><h3 id="count-算子"><a href="#count-算子" class="headerlink" title="count 算子"></a>count 算子</h3><ul><li><p><strong>说明：</strong> 返回整个 RDD 的元素个数。</p><p>下图中，返回数据的个数为 5。一个方块代表一个 RDD 分区。</p><p><img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="/images/post/spark_rdd/count.png" alt></p></li><li><p><strong>用法：</strong></p><p><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala"><span class="token keyword">def</span> count<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Long</span>Return the number of elements in the RDD<span class="token punctuation">.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></p></li><li><p><strong>示例：</strong></p><p><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala"><span class="token keyword">val</span> data <span class="token operator">=</span> sc<span class="token punctuation">.</span>parallelize<span class="token punctuation">(</span><span class="token number">1</span> to <span class="token number">5</span><span class="token punctuation">)</span>data<span class="token punctuation">.</span>count<span class="token comment">// 输出结果</span>data<span class="token operator">:</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>spark<span class="token punctuation">.</span>rdd<span class="token punctuation">.</span>RDD<span class="token punctuation">[</span><span class="token builtin">Int</span><span class="token punctuation">]</span> <span class="token operator">=</span> ParallelCollectionRDD<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> at parallelize at <span class="token generics"><span class="token punctuation">&lt;</span>console<span class="token punctuation">></span></span><span class="token operator">:</span><span class="token number">25</span>res0<span class="token operator">:</span> <span class="token builtin">Long</span> <span class="token operator">=</span> <span class="token number">5</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p></li></ul><h3 id="top-算子"><a href="#top-算子" class="headerlink" title="top 算子"></a>top 算子</h3><ul><li><p><strong>说明：</strong>返回此 RDD 中的前 k 个（最大）元素，并保持顺序。</p><p>相近函数:</p><ul><li>top 返回最大的 k 个元素。</li><li>take 返回最小的 k 个元素。</li><li>takeOrdered 返回前 k 个（最小）元素，并且在返回的数组中保持元素的顺序。</li><li>first 相当于 top(1) 返回整个 RDD 中的前 k 个元素。</li></ul></li></ul><ul><li><p><strong>用法：</strong></p><p><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala"><span class="token keyword">def</span> top<span class="token punctuation">(</span>num<span class="token operator">:</span> <span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token operator">:</span> List<span class="token punctuation">[</span><span class="token punctuation">(</span>K<span class="token punctuation">,</span> V<span class="token punctuation">)</span><span class="token punctuation">]</span>Returns the top k <span class="token punctuation">(</span>largest<span class="token punctuation">)</span> elements from <span class="token keyword">this</span> RDD using the natural ordering <span class="token keyword">for</span> T and maintains the order<span class="token punctuation">.</span><span class="token keyword">def</span> top<span class="token punctuation">(</span>num<span class="token operator">:</span> <span class="token builtin">Int</span><span class="token punctuation">,</span> comp<span class="token operator">:</span> Comparator<span class="token punctuation">[</span><span class="token punctuation">(</span>K<span class="token punctuation">,</span> V<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> List<span class="token punctuation">[</span><span class="token punctuation">(</span>K<span class="token punctuation">,</span> V<span class="token punctuation">)</span><span class="token punctuation">]</span>Returns the top k <span class="token punctuation">(</span>largest<span class="token punctuation">)</span> elements from <span class="token keyword">this</span> RDD as defined by the specified Comparator<span class="token punctuation">[</span>T<span class="token punctuation">]</span> and maintains the order<span class="token punctuation">.</span><span class="token keyword">def</span> take<span class="token punctuation">(</span>num<span class="token operator">:</span> <span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token operator">:</span> List<span class="token punctuation">[</span><span class="token punctuation">(</span>K<span class="token punctuation">,</span> V<span class="token punctuation">)</span><span class="token punctuation">]</span>Take the first num elements of the RDD<span class="token punctuation">.</span><span class="token keyword">def</span> takeOrdered<span class="token punctuation">(</span>num<span class="token operator">:</span> <span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token operator">:</span> List<span class="token punctuation">[</span><span class="token punctuation">(</span>K<span class="token punctuation">,</span> V<span class="token punctuation">)</span><span class="token punctuation">]</span>Returns the first k <span class="token punctuation">(</span>smallest<span class="token punctuation">)</span> elements from <span class="token keyword">this</span> RDD using the natural ordering <span class="token keyword">for</span> T <span class="token keyword">while</span> maintain the order<span class="token punctuation">.</span><span class="token keyword">def</span> takeOrdered<span class="token punctuation">(</span>num<span class="token operator">:</span> <span class="token builtin">Int</span><span class="token punctuation">,</span> comp<span class="token operator">:</span> Comparator<span class="token punctuation">[</span><span class="token punctuation">(</span>K<span class="token punctuation">,</span> V<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> List<span class="token punctuation">[</span><span class="token punctuation">(</span>K<span class="token punctuation">,</span> V<span class="token punctuation">)</span><span class="token punctuation">]</span>Returns the first k <span class="token punctuation">(</span>smallest<span class="token punctuation">)</span> elements from <span class="token keyword">this</span> RDD as defined by the specified Comparator<span class="token punctuation">[</span>T<span class="token punctuation">]</span> and maintains the order<span class="token punctuation">.</span><span class="token keyword">def</span> first<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token punctuation">(</span>K<span class="token punctuation">,</span> V<span class="token punctuation">)</span>Return the first element in <span class="token keyword">this</span> RDD<span class="token punctuation">.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p></li><li><p><strong>示例：</strong></p><p><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala"><span class="token keyword">val</span> data <span class="token operator">=</span> sc<span class="token punctuation">.</span>parallelize<span class="token punctuation">(</span><span class="token number">1</span> to <span class="token number">10</span><span class="token punctuation">)</span>data<span class="token punctuation">.</span>top<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>data<span class="token punctuation">.</span>take<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>data<span class="token punctuation">.</span>takeOrdered<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>data<span class="token punctuation">.</span>first<span class="token comment">// 输出结果</span>data<span class="token operator">:</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>spark<span class="token punctuation">.</span>rdd<span class="token punctuation">.</span>RDD<span class="token punctuation">[</span><span class="token builtin">Int</span><span class="token punctuation">]</span> <span class="token operator">=</span> ParallelCollectionRDD<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> at parallelize at <span class="token generics"><span class="token punctuation">&lt;</span>console<span class="token punctuation">></span></span><span class="token operator">:</span><span class="token number">25</span>res0<span class="token operator">:</span> Array<span class="token punctuation">[</span><span class="token builtin">Int</span><span class="token punctuation">]</span> <span class="token operator">=</span> Array<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span>res1<span class="token operator">:</span> Array<span class="token punctuation">[</span><span class="token builtin">Int</span><span class="token punctuation">]</span> <span class="token operator">=</span> Array<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>res2<span class="token operator">:</span> Array<span class="token punctuation">[</span><span class="token builtin">Int</span><span class="token punctuation">]</span> <span class="token operator">=</span> Array<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>res3<span class="token operator">:</span> <span class="token builtin">Int</span> <span class="token operator">=</span> <span class="token number">1</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p></li></ul><h3 id="reduce-算子"><a href="#reduce-算子" class="headerlink" title="reduce 算子"></a>reduce 算子</h3><ul><li><p><strong>说明：</strong>使用指定的可交换和关联的二进制运算符对 RDD 的元素进行运算。</p><p>reduce 函数相当于对 RDD 中的元素进行 reduceLeft 函数的操作。</p><p>reduceLeft 先对两个元素 (K, V) 进行 reduce 函数操作，然后将结果和迭代器取出的下一个元素 (K, V) 进行 reduce 函数操作，直到迭代器遍历完所有元素，得到最后结果。在RDD中，先对每个分区中的所有元素 (K, V) 的集合分别进行 reduceLeft。每个分区形成的结果相当于一个元素 (K, V)，再对这个结果集合进行 reduceLeft 操作。</p><p>下图中的方框代表一个 RDD 分区，通过用户自定函数 f 将数据进行 reduce 运算。</p><p><img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="/images/post/spark_rdd/reduce.png" alt></p></li><li><p><strong>用法：</strong></p><p><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala"><span class="token keyword">def</span> reduce<span class="token punctuation">(</span>f<span class="token operator">:</span> Function2<span class="token punctuation">[</span><span class="token punctuation">(</span>K<span class="token punctuation">,</span> V<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>K<span class="token punctuation">,</span> V<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>K<span class="token punctuation">,</span> V<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token punctuation">(</span>K<span class="token punctuation">,</span> V<span class="token punctuation">)</span>Reduces the elements of <span class="token keyword">this</span> RDD using the specified commutative and associative binary operator<span class="token punctuation">.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></p></li><li><p><strong>示例：</strong></p><p><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala"><span class="token keyword">var</span> data <span class="token operator">=</span> sc<span class="token punctuation">.</span>parallelize<span class="token punctuation">(</span>Array<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">"b"</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">"c"</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">"d"</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>data<span class="token punctuation">.</span>reduce<span class="token punctuation">(</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span> <span class="token keyword">=></span> <span class="token punctuation">(</span>x<span class="token punctuation">.</span>_1 <span class="token operator">+</span> <span class="token string">"@"</span> <span class="token operator">+</span> y<span class="token punctuation">.</span>_1<span class="token punctuation">,</span> x<span class="token punctuation">.</span>_2 <span class="token operator">+</span> y<span class="token punctuation">.</span>_2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">// 输出结果</span>data<span class="token operator">:</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>spark<span class="token punctuation">.</span>rdd<span class="token punctuation">.</span>RDD<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token builtin">String</span><span class="token punctuation">,</span> <span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> ParallelCollectionRDD<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> at parallelize at <span class="token generics"><span class="token punctuation">&lt;</span>console<span class="token punctuation">></span></span><span class="token operator">:</span><span class="token number">25</span>res0<span class="token operator">:</span> <span class="token punctuation">(</span><span class="token builtin">String</span><span class="token punctuation">,</span> <span class="token builtin">Int</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">(</span>c<span class="token annotation punctuation">@d</span><span class="token annotation punctuation">@a</span><span class="token annotation punctuation">@b</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p></li></ul><h3 id="fold-算子"><a href="#fold-算子" class="headerlink" title="fold 算子"></a>fold 算子</h3><ul><li><p><strong>说明：</strong>使用给定的关联函数和中性的“零值”，汇总每个分区的元素，然后汇总所有分区的结果。</p><p>fold 和 reduce的原理相同，但是与 reduce 不同，相当于每个 reduce 时，迭代器取的第一个元素是 zeroValue。</p><p>下图中通过下面的用户自定义函数进行 fold 运算，图中的一个方框代表一个 RDD 分区。读者可以参照 reduce 函数理解。</p><p><img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="/images/post/spark_rdd/fold.png" alt></p></li><li><p><strong>用法：</strong></p><p><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala"><span class="token keyword">def</span> fold<span class="token punctuation">(</span>zeroValue<span class="token operator">:</span> <span class="token punctuation">(</span>K<span class="token punctuation">,</span> V<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">(</span>f<span class="token operator">:</span> Function2<span class="token punctuation">[</span><span class="token punctuation">(</span>K<span class="token punctuation">,</span> V<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>K<span class="token punctuation">,</span> V<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>K<span class="token punctuation">,</span> V<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token punctuation">(</span>K<span class="token punctuation">,</span> V<span class="token punctuation">)</span>Aggregate the elements of each partition<span class="token punctuation">,</span> and then the results <span class="token keyword">for</span> all the partitions<span class="token punctuation">,</span> using a given associative function and a neutral <span class="token string">"zero value"</span><span class="token punctuation">.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></p></li><li><p><strong>示例：</strong></p><p><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala"><span class="token keyword">var</span> data <span class="token operator">=</span> sc<span class="token punctuation">.</span>parallelize<span class="token punctuation">(</span>Array<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">"b"</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">"b"</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>data<span class="token punctuation">.</span>fold<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">"A"</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span> <span class="token keyword">=></span> <span class="token punctuation">(</span>x<span class="token punctuation">.</span>_1 <span class="token operator">+</span> <span class="token string">"@"</span> <span class="token operator">+</span> y<span class="token punctuation">.</span>_1<span class="token punctuation">,</span> x<span class="token punctuation">.</span>_2 <span class="token operator">+</span> y<span class="token punctuation">.</span>_2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">// 输出结果</span>data<span class="token operator">:</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>spark<span class="token punctuation">.</span>rdd<span class="token punctuation">.</span>RDD<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token builtin">String</span><span class="token punctuation">,</span> <span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> ParallelCollectionRDD<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> at parallelize at <span class="token generics"><span class="token punctuation">&lt;</span>console<span class="token punctuation">></span></span><span class="token operator">:</span><span class="token number">25</span>res0<span class="token operator">:</span> <span class="token punctuation">(</span><span class="token builtin">String</span><span class="token punctuation">,</span> <span class="token builtin">Int</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">(</span>A<span class="token annotation punctuation">@A</span><span class="token annotation punctuation">@a</span><span class="token annotation punctuation">@b</span><span class="token annotation punctuation">@A</span><span class="token annotation punctuation">@c</span><span class="token annotation punctuation">@d</span><span class="token punctuation">,</span><span class="token number">36</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p></li></ul><h3 id="aggregate-算子"><a href="#aggregate-算子" class="headerlink" title="aggregate 算子"></a>aggregate 算子</h3><ul><li><p><strong>说明：</strong>使用给定的合并功能和中性的“零值”，汇总每个分区的元素，然后汇总所有分区的结果。此函数可以返回与该 RDD 的类型 T 不同的结果类型U。因此，我们需要一个将 T 合并为 U 的操作，以及一个将两个 U 合并的操作。</p><p>aggregate 先对每个分区的所有元素进行 aggregate 操作，再对分区的结果进行 fold 操作。</p><p>aggregate 与 fold 和 reduce 的不同之处在于，aggregate 相当于采用归并的方式进行数据聚合，这种聚合是并行化的。而在 fold 和 reduce 函数的运算过程中，每个分区中需要进行串行处理，每个分区串行计算完结果，结果再按之前的方式进行聚合，并返回最终聚合结果。</p><p>下图图通过用户自定义函数对 RDD 进行 aggregate 的聚合操作，图中的每个方框代表一个 RDD 分区。</p><p><img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="/images/post/spark_rdd/aggregate.png" alt></p></li><li><p><strong>用法：</strong></p><p><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala"><span class="token keyword">def</span> aggregate<span class="token punctuation">[</span>U<span class="token punctuation">]</span><span class="token punctuation">(</span>zeroValue<span class="token operator">:</span> U<span class="token punctuation">)</span><span class="token punctuation">(</span>seqOp<span class="token operator">:</span> Function2<span class="token punctuation">[</span>U<span class="token punctuation">,</span> <span class="token punctuation">(</span>K<span class="token punctuation">,</span> V<span class="token punctuation">)</span><span class="token punctuation">,</span> U<span class="token punctuation">]</span><span class="token punctuation">,</span> combOp<span class="token operator">:</span> Function2<span class="token punctuation">[</span>U<span class="token punctuation">,</span> U<span class="token punctuation">,</span> U<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> UAggregate the elements of each partition<span class="token punctuation">,</span> and then the results <span class="token keyword">for</span> all the partitions<span class="token punctuation">,</span> using given combine functions and a neutral <span class="token string">"zero value"</span><span class="token punctuation">.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></p></li><li><p><strong>示例：</strong></p><p><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala"><span class="token keyword">var</span> data <span class="token operator">=</span> sc<span class="token punctuation">.</span>parallelize<span class="token punctuation">(</span>Array<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">"b"</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">"b"</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>data<span class="token punctuation">.</span>aggregate<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">"A"</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span> <span class="token keyword">=></span> <span class="token punctuation">(</span>x<span class="token punctuation">.</span>_1 <span class="token operator">+</span> <span class="token string">"@"</span> <span class="token operator">+</span> y<span class="token punctuation">.</span>_1<span class="token punctuation">,</span> x<span class="token punctuation">.</span>_2 <span class="token operator">+</span> y<span class="token punctuation">.</span>_2<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span> <span class="token keyword">=></span> <span class="token punctuation">(</span>x<span class="token punctuation">.</span>_1 <span class="token operator">+</span> <span class="token string">"@"</span> <span class="token operator">+</span> y<span class="token punctuation">.</span>_1<span class="token punctuation">,</span> x<span class="token punctuation">.</span>_2 <span class="token operator">+</span> y<span class="token punctuation">.</span>_2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">// 输出结果</span>data<span class="token operator">:</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>spark<span class="token punctuation">.</span>rdd<span class="token punctuation">.</span>RDD<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token builtin">String</span><span class="token punctuation">,</span> <span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> ParallelCollectionRDD<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> at parallelize at <span class="token generics"><span class="token punctuation">&lt;</span>console<span class="token punctuation">></span></span><span class="token operator">:</span><span class="token number">25</span>res0<span class="token operator">:</span> <span class="token punctuation">(</span><span class="token builtin">String</span><span class="token punctuation">,</span> <span class="token builtin">Int</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">(</span>A<span class="token annotation punctuation">@A</span><span class="token annotation punctuation">@a</span><span class="token annotation punctuation">@b</span><span class="token annotation punctuation">@A</span><span class="token annotation punctuation">@c</span><span class="token annotation punctuation">@d</span><span class="token punctuation">,</span><span class="token number">36</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p></li></ul><h3 id="takeSample-算子"><a href="#takeSample-算子" class="headerlink" title="takeSample 算子"></a>takeSample 算子</h3><ul><li><p><strong>说明：</strong>在数组中返回此 RDD 的固定大小的采样子集</p><p>takeSample 函数和上面的 sample 函数是一个原理，但是不使用相对比例采样，而是按设定的采样个数进行采样，同时返回结果不再是 RDD，而是相当于对采样后的数据进行 collect，返回结果的集合为单机的数组。图中左侧的方框代表分布式的各个节点上的分区，右侧方框代表单机上返回的结果数组。通过 takeSample 对数据采样，设置为采样一份数据，返回结果为 V1。</p><p><img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="/images/post/spark_rdd/take_sample.png" alt></p></li><li><p><strong>用法：</strong></p><p><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala"><span class="token keyword">def</span> takeSample<span class="token punctuation">(</span>withReplacement<span class="token operator">:</span> <span class="token builtin">Boolean</span><span class="token punctuation">,</span> num<span class="token operator">:</span> <span class="token builtin">Int</span><span class="token punctuation">,</span> seed<span class="token operator">:</span> <span class="token builtin">Long</span> <span class="token operator">=</span> Utils<span class="token punctuation">.</span>random<span class="token punctuation">.</span>nextLong<span class="token punctuation">)</span><span class="token operator">:</span> Array<span class="token punctuation">[</span>T<span class="token punctuation">]</span>Return a fixed<span class="token operator">-</span>size sampled subset of <span class="token keyword">this</span> RDD in an arraywithReplacementwhether sampling is done <span class="token keyword">with</span> <span class="token namespace">replacement</span>是否通过更换进行采样numsize of the returned sample返回样本的大小seedseed <span class="token keyword">for</span> the random number generator随机数生成器的种子<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p></li><li><p><strong>示例：</strong></p><p><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala"><span class="token keyword">val</span> data <span class="token operator">=</span> sc<span class="token punctuation">.</span>parallelize<span class="token punctuation">(</span><span class="token number">1</span> to <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>data<span class="token punctuation">.</span>takeSample<span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">)</span>data<span class="token punctuation">.</span>takeSample<span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">)</span><span class="token comment">// 输出结果</span>data<span class="token operator">:</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>spark<span class="token punctuation">.</span>rdd<span class="token punctuation">.</span>RDD<span class="token punctuation">[</span><span class="token builtin">Int</span><span class="token punctuation">]</span> <span class="token operator">=</span> ParallelCollectionRDD<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> at parallelize at <span class="token generics"><span class="token punctuation">&lt;</span>console<span class="token punctuation">></span></span><span class="token operator">:</span><span class="token number">25</span>res0<span class="token operator">:</span> Array<span class="token punctuation">[</span><span class="token builtin">Int</span><span class="token punctuation">]</span> <span class="token operator">=</span> Array<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>res1<span class="token operator">:</span> Array<span class="token punctuation">[</span><span class="token builtin">Int</span><span class="token punctuation">]</span> <span class="token operator">=</span> Array<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p></li></ul>]]></content>
      
      
      <categories>
          
          <category> 教程笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 大数据 </tag>
            
            <tag> Spark </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linux 常用命令</title>
      <link href="post/817c7d82.html"/>
      <url>post/817c7d82.html</url>
      
        <content type="html"><![CDATA[<h1 id="系统信息"><a href="#系统信息" class="headerlink" title="系统信息"></a>系统信息</h1><div class="table-container"><table><thead><tr><th>命令</th><th>描述</th></tr></thead><tbody><tr><td>arch</td><td>显示机器的处理器架构</td></tr><tr><td>uname -m</td><td>显示机器的处理器架构</td></tr><tr><td>uname -r</td><td>显示正在使用的内核版本</td></tr><tr><td>dmidecode -q</td><td>显示硬件系统部件 -（SMBIOS/DMI）</td></tr><tr><td>hdparm -i /dev/hda</td><td>罗列一个磁盘的架构特性</td></tr><tr><td>hdparm -tT /dev/sda</td><td>在磁盘上执行测试性读取操作</td></tr><tr><td>cat /proc/cpuinfo</td><td>显示 CPU info 的信息</td></tr><tr><td>cat /proc/interrupts</td><td>显示中断</td></tr><tr><td>cat /proc/meminfo</td><td>校验内存使用</td></tr><tr><td>cat /proc/swaps</td><td>显示哪些swap被使用</td></tr><tr><td>cat /proc/version</td><td>显示内核的版本</td></tr><tr><td>cat /proc/net/dev</td><td>显示网络适配器及统计</td></tr><tr><td>cat /proc/mounts</td><td>显示已加载的文件系统</td></tr><tr><td>lspci -tv</td><td>罗列 PCI 设备</td></tr><tr><td>lsusb -tv</td><td>显示 USB 设备</td></tr><tr><td>date</td><td>显示系统日期</td></tr><tr><td>cal 2007</td><td>显示2007年的日历表</td></tr><tr><td>date 041217002007.00</td><td>设置日期和时间 - 月日时分年.秒</td></tr><tr><td>clock -w</td><td>将时间修改保存到 BIOS</td></tr></tbody></table></div><h1 id="系统关机、重启以及登出"><a href="#系统关机、重启以及登出" class="headerlink" title="系统关机、重启以及登出"></a>系统关机、重启以及登出</h1><div class="table-container"><table><thead><tr><th>命令</th><th>描述</th></tr></thead><tbody><tr><td>shutdown -h now</td><td>关闭系统</td></tr><tr><td>init 0</td><td>关闭系统</td></tr><tr><td>telinit 0</td><td>关闭系统</td></tr><tr><td>shutdown -h hours:minutes &amp;</td><td>按预定时间关闭系统</td></tr><tr><td>shutdown -c</td><td>取消按预定时间关闭系统</td></tr><tr><td>shutdown -r now</td><td>重启</td></tr><tr><td>reboot</td><td>重启</td></tr><tr><td>logout</td><td>注销</td></tr></tbody></table></div><h1 id="文件和目录"><a href="#文件和目录" class="headerlink" title="文件和目录"></a>文件和目录</h1><div class="table-container"><table><thead><tr><th>命令</th><th>描述</th></tr></thead><tbody><tr><td>cd /home</td><td>进入 &#39;/home&#39; 目录&#39;</td></tr><tr><td>cd ..</td><td>返回上一级目录</td></tr><tr><td>cd ../..</td><td>返回上两级目录</td></tr><tr><td>cd</td><td>进入个人的主目录</td></tr><tr><td>cd ~user1</td><td>进入个人的主目录</td></tr><tr><td>cd -</td><td>返回上次所在的目录</td></tr><tr><td>pwd</td><td>显示工作路径</td></tr><tr><td>ls</td><td>查看目录中的文件</td></tr><tr><td>ls -F</td><td>查看目录中的文件</td></tr><tr><td>ls -l</td><td>显示文件和目录的详细资料</td></tr><tr><td>ls -a</td><td>显示隐藏文件</td></tr><tr><td>ls <em>[0-9]</em></td><td>显示包含数字的文件名和目录名</td></tr><tr><td>tree</td><td>显示文件和目录由根目录开始的树形结构</td></tr><tr><td>lstree</td><td>显示文件和目录由根目录开始的树形结构</td></tr><tr><td>mkdir dir1</td><td>创建一个叫做 &#39;dir1&#39; 的目录</td></tr><tr><td>mkdir dir1</td><td>dir2 同时创建两个目录</td></tr><tr><td>mkdir -p /tmp/dir1/dir2</td><td>创建一个目录树</td></tr><tr><td>rm -f file1</td><td>删除一个叫做 &#39;file1&#39; 的文件</td></tr><tr><td>rmdir dir1</td><td>删除一个叫做 &#39;dir1&#39; 的目录</td></tr><tr><td>rm -rf dir1</td><td>删除一个叫做 &#39;dir1&#39; 的目录并同时删除其内容</td></tr><tr><td>rm -rf dir1 dir2</td><td>同时删除两个目录及它们的内容</td></tr><tr><td>mv dir1 new_dir</td><td>重命名/移动 一个目录</td></tr><tr><td>cp file1 file2</td><td>复制一个文件</td></tr><tr><td>cp dir/* .</td><td>复制一个目录下的所有文件到当前工作目录</td></tr><tr><td>cp -a /tmp/dir1 .</td><td>复制一个目录到当前工作目录</td></tr><tr><td>cp -a dir1 dir2</td><td>复制一个目录</td></tr><tr><td>ln -s file1 lnk1</td><td>创建一个指向文件或目录的软链接</td></tr><tr><td>ln file1 lnk1</td><td>创建一个指向文件或目录的物理链接</td></tr><tr><td>touch -t 0712250000 file1</td><td>修改一个文件或目录的时间戳 - YYMMDDhhmm</td></tr><tr><td>file file1</td><td>将文件的类型输出为文本</td></tr><tr><td>iconv -l</td><td>列出已知的编码</td></tr><tr><td>iconv -f fromEncoding -t toEncoding inputFile &gt; outputFile</td><td>转换文件编码类型并创建新文件</td></tr><tr><td>find . -maxdepth 1 -name *.jpg -print -exec convert &quot;{}&quot; -resize 80x60 &quot;thumbs/{}&quot;</td><td>批量调整 &#39;.jpg&#39; 结尾的文件尺寸大小</td></tr></tbody></table></div><h1 id="文件搜索"><a href="#文件搜索" class="headerlink" title="文件搜索"></a>文件搜索</h1><div class="table-container"><table><thead><tr><th>命令</th><th>描述</th></tr></thead><tbody><tr><td>find / -name file1</td><td>从 &#39;/&#39; 开始进入根文件系统搜索文件和目录</td></tr><tr><td>find / -user user1</td><td>搜索属于用户 &#39;user1&#39; 的文件和目录</td></tr><tr><td>find /home/user1 -name *.bin</td><td>在目录 &#39;/home/user1&#39; 中搜索带有&#39;.bin&#39; 结尾的文件</td></tr><tr><td>find /usr/bin -type f -atime +100</td><td>搜索在过去 100 天内未被使用过的执行文件</td></tr><tr><td>find /usr/bin -type f -mtime -10</td><td>搜索在 10 天内被创建或者修改过的文件</td></tr><tr><td>find / -name *.rpm -exec chmod 755 &#39;{}&#39;</td><td>搜索以 &#39;.rpm&#39; 结尾的文件并定义其权限</td></tr><tr><td>find / -xdev -name *.rpm</td><td>搜索以 &#39;.rpm&#39; 结尾的文件，忽略光驱、捷盘等可移动设备</td></tr><tr><td>locate *.ps</td><td>寻找以 &#39;.ps&#39; 结尾的文件 - 先运行 &#39;updatedb&#39; 命令</td></tr><tr><td>whereis halt</td><td>显示一个二进制文件、源码或可执行文件的位置</td></tr><tr><td>which halt</td><td>显示一个二进制文件或可执行文件的完整路径</td></tr></tbody></table></div><h1 id="挂载一个文件系统"><a href="#挂载一个文件系统" class="headerlink" title="挂载一个文件系统"></a>挂载一个文件系统</h1><div class="table-container"><table><thead><tr><th>命令</th><th>描述</th></tr></thead><tbody><tr><td>mount /dev/hda2 /mnt/hda2</td><td>挂载一个叫做 hda2 的盘 - 确定目录 &#39;/mnt/hda2&#39; 已经存在</td></tr><tr><td>umount /dev/hda2</td><td>卸载一个叫做 hda2 的盘 - 先从挂载点 &#39;/mnt/hda2&#39; 退出</td></tr><tr><td>fuser -km /mnt/hda2</td><td>当设备繁忙时强制卸载</td></tr><tr><td>umount -n /mnt/hda2</td><td>运行卸载操作而不写入 &#39;/etc/mtab&#39; 文件- 当文件为只读或当磁盘写满时非常有用</td></tr><tr><td>mount /dev/fd0 /mnt/floppy</td><td>挂载一个软盘</td></tr><tr><td>mount /dev/cdrom /mnt/cdrom</td><td>挂载一个 cdrom 或 dvdrom</td></tr><tr><td>mount /dev/hdc /mnt/cdrecorder</td><td>挂载一个 cdrw 或 dvdrom</td></tr><tr><td>mount /dev/hdb /mnt/cdrecorder</td><td>挂载一个 cdrw 或 dvdrom</td></tr><tr><td>mount -o loop file.iso /mnt/cdrom</td><td>挂载一个文件或 ISO 镜像文件</td></tr><tr><td>mount -t vfat /dev/hda5 /mnt/hda5</td><td>挂载一个 Windows FAT32 文件系统</td></tr><tr><td>mount /dev/sda1 /mnt/usbdisk</td><td>挂载一个 usb 捷盘或闪存设备</td></tr><tr><td>mount -t smbfs -o username=user,password=pass //WinClient/share /mnt/share</td><td>挂载一个 windows 网络共享</td></tr></tbody></table></div><h1 id="磁盘空间"><a href="#磁盘空间" class="headerlink" title="磁盘空间"></a>磁盘空间</h1><div class="table-container"><table><thead><tr><th>命令</th><th>描述</th></tr></thead><tbody><tr><td>df -h</td><td>显示已经挂载的分区列表</td></tr><tr><td>ls -lSr &vert; more</td><td>以尺寸大小排列文件和目录</td></tr><tr><td>du -sh dir1</td><td>估算目录 &#39;dir1&#39; 已经使用的磁盘空间&#39;</td></tr><tr><td>du -sk * &vert; sort -rn</td><td>以容量大小为依据依次显示文件和目录的大小</td></tr><tr><td>rpm -q -a --qf &#39;%10{SIZE}t%{NAME}n&#39; &vert; sort -k1,1n</td><td>以大小为依据依次显示已安装的 rpm 包所使用的空间（fedora，RedHat 类系统）</td></tr><tr><td>dpkg-query -W -f=&#39;${Installed-Size10}t${Package}n&#39; &vert; sort -k1,1n</td><td>以大小为依据显示已安装的 deb 包所使用的空间（ubuntu，debian 类系统）</td></tr></tbody></table></div><h1 id="用户和群组"><a href="#用户和群组" class="headerlink" title="用户和群组"></a>用户和群组</h1><div class="table-container"><table><thead><tr><th>命令</th><th>描述</th></tr></thead><tbody><tr><td>groupadd group_name</td><td>创建一个新用户组</td></tr><tr><td>groupdel group_name</td><td>删除一个用户组</td></tr><tr><td>groupmod -n new_group_name old_group_name</td><td>重命名一个用户组</td></tr><tr><td>useradd -c &quot;Name Surname&quot; -g admin -d /home/user1 -s /bin/bash user1</td><td>创建一个属于 &quot;admin&quot; 用户组的用户</td></tr><tr><td>useradd user1</td><td>创建一个新用户</td></tr><tr><td>userdel -r user1</td><td>删除一个用户（&#39;-r&#39; 排除主目录）</td></tr><tr><td>usermod -c &quot;User FTP&quot; -g system -d /ftp/user1 -s /bin/nologin user1</td><td>修改用户属性</td></tr><tr><td>passwd</td><td>修改密码</td></tr><tr><td>passwd user1</td><td>修改一个用户的密码（只允许root执行）</td></tr><tr><td>chage -E 2005-12-31 user1</td><td>设置用户密码的失效期限</td></tr><tr><td>pwck</td><td>检查 &#39;/etc/passwd&#39; 的文件格式和语法修正以及存在的用户</td></tr><tr><td>grpck</td><td>检查 &#39;/etc/passwd&#39; 的文件格式和语法修正以及存在的群组</td></tr><tr><td>newgrp group_name</td><td>登陆进一个新的群组以改变新创建文件的预设群组</td></tr></tbody></table></div><h1 id="文件的权限"><a href="#文件的权限" class="headerlink" title="文件的权限"></a>文件的权限</h1><p><strong>使用 &quot;+&quot; 设置权限，使用 &quot;-&quot; 用于取消</strong></p><div class="table-container"><table><thead><tr><th>命令</th><th>描述</th></tr></thead><tbody><tr><td>ls -lh</td><td>显示权限</td></tr><tr><td>ls /tmp &vert; pr -T5 -W$COLUMNS</td><td>将终端划分成5栏显示</td></tr><tr><td>chmod ugo+rwx directory1</td><td>设置目录的所有人（u）、群组（g）以及其他人（o）以读（r）、写（w）和执行（x）的权限</td></tr><tr><td>chmod go-rwx directory1</td><td>删除群组（g）与其他人（o）对目录的读写执行权限</td></tr><tr><td>chown user1 file1</td><td>改变一个文件的所有人属性</td></tr><tr><td>chown -R user1 directory1</td><td>改变一个目录的所有人属性并同时改变改目录下所有文件的属性</td></tr><tr><td>chgrp group1 file1</td><td>改变文件的群组</td></tr><tr><td>chown user1:group1 file1</td><td>改变一个文件的所有人和群组属性</td></tr><tr><td>find / -perm -u+s</td><td>罗列一个系统中所有使用了 SUID 控制的文件</td></tr><tr><td>chmod u+s /bin/file1</td><td>设置一个二进制文件的 SUID 位 - 运行该文件的用户也被赋予和所有者同样的权限</td></tr><tr><td>chmod u-s /bin/file1</td><td>禁用一个二进制文件的 SUID 位</td></tr><tr><td>chmod g+s /home/public</td><td>设置一个目录的 SGID 位 - 类似 SUID，不过这是针对目录的</td></tr><tr><td>chmod g-s /home/public</td><td>禁用一个目录的 SGID 位</td></tr><tr><td>chmod o+t /home/public</td><td>设置一个文件的 STIKY 位 - 只允许合法所有人删除文件</td></tr><tr><td>chmod o-t /home/public</td><td>禁用一个目录的 STIKY 位</td></tr></tbody></table></div><h1 id="文件的特殊属性"><a href="#文件的特殊属性" class="headerlink" title="文件的特殊属性"></a>文件的特殊属性</h1><p><strong>使用 &quot;+&quot; 设置权限，使用 &quot;-&quot; 用于取消</strong></p><div class="table-container"><table><thead><tr><th>命令</th><th>描述</th></tr></thead><tbody><tr><td>chattr +a file1</td><td>只允许以追加方式读写文件</td></tr><tr><td>chattr +c file1</td><td>允许这个文件能被内核自动压缩/解压</td></tr><tr><td>chattr +d file1</td><td>在进行文件系统备份时，dump 程序将忽略这个文件</td></tr><tr><td>chattr +i file1</td><td>设置成不可变的文件，不能被删除、修改、重命名或者链接</td></tr><tr><td>chattr +s file1</td><td>允许一个文件被安全地删除</td></tr><tr><td>chattr +S file1</td><td>一旦应用程序对这个文件执行了写操作，使系统立刻把修改的结果写到磁盘</td></tr><tr><td>chattr +u file1</td><td>若文件被删除，系统会允许你在以后恢复这个被删除的文件</td></tr><tr><td>lsattr</td><td>显示特殊的属性</td></tr></tbody></table></div><h1 id="打包和解压缩文件"><a href="#打包和解压缩文件" class="headerlink" title="打包和解压缩文件"></a>打包和解压缩文件</h1><h2 id="解压缩"><a href="#解压缩" class="headerlink" title="解压缩"></a>解压缩</h2><div class="table-container"><table><thead><tr><th>命令</th><th>描述</th></tr></thead><tbody><tr><td>bunzip2 file1.bz2</td><td>解压一个叫做 &#39;file1.bz2&#39;的文件</td></tr><tr><td>bzip2 file1</td><td>压缩一个叫做 &#39;file1&#39; 的文件</td></tr><tr><td>gunzip file1.gz</td><td>解压一个叫做 &#39;file1.gz&#39;的文件</td></tr><tr><td>gzip file1</td><td>压缩一个叫做 &#39;file1&#39;的文件</td></tr><tr><td>gzip -9 file1</td><td>最大程度压缩</td></tr><tr><td>rar a file1.rar test_file</td><td>创建一个叫做 &#39;file1.rar&#39; 的包</td></tr><tr><td>rar a file1.rar file1 file2 dir1</td><td>同时压缩 &#39;file1&#39;, &#39;file2&#39; 以及目录 &#39;dir1&#39;</td></tr><tr><td>unrar x file1.rar</td><td>解压rar包</td></tr><tr><td>tar -cvf archive.tar file1</td><td>创建一个非压缩的 tarball</td></tr><tr><td>tar -cvf archive.tar file1 file2 dir1</td><td>创建一个包含了 &#39;file1&#39;, &#39;file2&#39; 以及 &#39;dir1&#39; 的包</td></tr><tr><td>tar -tf archive.tar</td><td>显示一个包中的内容</td></tr><tr><td>tar -xvf archive.tar</td><td>释放一个包</td></tr><tr><td>tar -xvf archive.tar -C /tmp</td><td>将压缩包释放到 /tmp目录下</td></tr><tr><td>tar -cvfj archive.tar.bz2 dir1</td><td>创建一个 bzip2 格式的压缩包</td></tr><tr><td>tar -jxvf archive.tar.bz2</td><td>解压一个 bzip2 格式的压缩包</td></tr><tr><td>tar -cvfz archive.tar.gz dir1</td><td>创建一个 gzip 格式的压缩包</td></tr><tr><td>tar -zxvf archive.tar.gz</td><td>解压一个 gzip 格式的压缩包</td></tr><tr><td>zip file1.zip file1</td><td>创建一个 zip 格式的压缩包</td></tr><tr><td>zip -r file1.zip file1 file2 dir1</td><td>将几个文件和目录同时压缩成一个 zip 格式的压缩包</td></tr><tr><td>unzip file1.zip</td><td>解压一个 zip 格式压缩包</td></tr></tbody></table></div><h2 id="RPM-包"><a href="#RPM-包" class="headerlink" title="RPM 包"></a>RPM 包</h2><p><strong>Fedora，RedHat 及类似系统</strong></p><div class="table-container"><table><thead><tr><th>命令</th><th>描述</th></tr></thead><tbody><tr><td>rpm -ivh package.rpm</td><td>安装一个 rpm 包</td></tr><tr><td>rpm -ivh --nodeeps package.rpm</td><td>安装一个 rpm 包而忽略依赖关系警告</td></tr><tr><td>rpm -U package.rpm</td><td>更新一个 rpm 包但不改变其配置文件</td></tr><tr><td>rpm -F package.rpm</td><td>更新一个确定已经安装的 rpm 包</td></tr><tr><td>rpm -e package_name.rpm</td><td>删除一个 rpm 包</td></tr><tr><td>rpm -qa</td><td>显示系统中所有已经安装的 rpm 包</td></tr><tr><td>rpm -qa &vert; grep httpd</td><td>显示所有名称中包含 &quot;httpd&quot; 字样的 rpm 包</td></tr><tr><td>rpm -qi package_name</td><td>获取一个已安装包的特殊信息</td></tr><tr><td>rpm -qg &quot;System Environment/Daemons&quot;</td><td>显示一个组件的 rpm 包</td></tr><tr><td>rpm -ql package_name</td><td>显示一个已经安装的 rpm 包提供的文件列表</td></tr><tr><td>rpm -qc package_name</td><td>显示一个已经安装的 rpm 包提供的配置文件列表</td></tr><tr><td>rpm -q package_name --whatrequires</td><td>显示与一个 rpm 包存在依赖关系的列表</td></tr><tr><td>rpm -q package_name --whatprovides</td><td>显示一个 rpm 包所占的体积</td></tr><tr><td>rpm -q package_name --scripts</td><td>显示在安装/删除期间所执行的脚本</td></tr><tr><td>rpm -q package_name --changelog</td><td>显示一个 rpm 包的修改历史</td></tr><tr><td>rpm -qf /etc/httpd/conf/httpd.conf</td><td>确认所给的文件由哪个 rpm 包所提供</td></tr><tr><td>rpm -qp package.rpm -l</td><td>显示由一个尚未安装的 rpm 包提供的文件列表</td></tr><tr><td>rpm --import /media/cdrom/RPM-GPG-KEY</td><td>导入公钥数字证书</td></tr><tr><td>rpm --checksig package.rpm</td><td>确认一个 rpm 包的完整性</td></tr><tr><td>rpm -qa gpg-pubkey</td><td>确认已安装的所有 rpm 包的完整性</td></tr><tr><td>rpm -V package_name</td><td>检查文件尺寸、许可、类型、所有者、群组、MD5 检查以及最后修改时间</td></tr><tr><td>rpm -Va</td><td>检查系统中所有已安装的 rpm 包- 小心使用</td></tr><tr><td>rpm -Vp package.rpm</td><td>确认一个 rpm 包还未安装</td></tr><tr><td>rpm2cpio package.rpm &vert; cpio --extract --make-directories <em>bin</em></td><td>从一个 rpm 包运行可执行文件</td></tr><tr><td>rpm -ivh /usr/src/RedHat/RPMS/arch/package.rpm</td><td>从一个 rpm 源码安装一个构建好的包</td></tr><tr><td>rpmbuild --rebuild package_name.src.rpm</td><td>从一个 rpm 源码构建一个 rpm 包</td></tr></tbody></table></div><h2 id="YUM-软件包升级器"><a href="#YUM-软件包升级器" class="headerlink" title="YUM 软件包升级器"></a>YUM 软件包升级器</h2><p><strong>Fedora，RedHat 及类似系统</strong></p><div class="table-container"><table><thead><tr><th>命令</th><th>描述</th></tr></thead><tbody><tr><td>yum install package_name</td><td>下载并安装一个 rpm 包</td></tr><tr><td>yum localinstall package_name.rpm</td><td>将安装一个 rpm 包，使用你自己的软件仓库为你解决所有依赖关系</td></tr><tr><td>yum update package_name.rpm</td><td>更新当前系统中所有安装的rpm包</td></tr><tr><td>yum update package_name</td><td>更新一个 rpm 包</td></tr><tr><td>yum remove package_name</td><td>删除一个 rpm 包</td></tr><tr><td>yum list</td><td>列出当前系统中安装的所有包</td></tr><tr><td>yum search package_name</td><td>在 rpm 仓库中搜寻软件包</td></tr><tr><td>yum clean packages</td><td>清理 rpm 缓存删除下载的包</td></tr><tr><td>yum clean headers</td><td>删除所有头文件</td></tr><tr><td>yum clean all</td><td>删除所有缓存的包和头文件</td></tr></tbody></table></div><h2 id="DEB-包"><a href="#DEB-包" class="headerlink" title="DEB 包"></a>DEB 包</h2><p><strong>Debian，Ubuntu 以及类似系统</strong></p><div class="table-container"><table><thead><tr><th>命令</th><th>描述</th></tr></thead><tbody><tr><td>dpkg -i package.deb</td><td>安装/更新一个 deb 包</td></tr><tr><td>dpkg -r package_name</td><td>从系统删除一个 deb 包</td></tr><tr><td>dpkg -l</td><td>显示系统中所有已经安装的 deb 包</td></tr><tr><td>dpkg -l &vert; grep httpd</td><td>显示所有名称中包含 &quot;httpd&quot; 字样的deb包</td></tr><tr><td>dpkg -s package_name</td><td>获得已经安装在系统中一个特殊包的信息</td></tr><tr><td>dpkg -L package_name</td><td>显示系统中已经安装的一个 deb 包所提供的文件列表</td></tr><tr><td>dpkg --contents package.deb</td><td>显示尚未安装的一个包所提供的文件列表</td></tr><tr><td>dpkg -S /bin/ping</td><td>确认所给的文件由哪个 deb 包提供</td></tr></tbody></table></div><h2 id="APT-软件工具（Debian-Ubuntu-以及类似系统）"><a href="#APT-软件工具（Debian-Ubuntu-以及类似系统）" class="headerlink" title="APT 软件工具（Debian, Ubuntu 以及类似系统）"></a>APT 软件工具（Debian, Ubuntu 以及类似系统）</h2><div class="table-container"><table><thead><tr><th>命令</th><th>描述</th></tr></thead><tbody><tr><td>apt-get install package_name</td><td>安装/更新一个 deb 包</td></tr><tr><td>apt-cdrom install package_name</td><td>从光盘安装/更新一个 deb 包</td></tr><tr><td>apt-get update</td><td>升级列表中的软件包</td></tr><tr><td>apt-get upgrade</td><td>升级所有已安装的软件</td></tr><tr><td>apt-get remove package_name</td><td>从系统删除一个 deb 包</td></tr><tr><td>apt-get check</td><td>确认依赖的软件仓库正确</td></tr><tr><td>apt-get clean</td><td>从下载的软件包中清理缓存</td></tr><tr><td>apt-cache search searched-package</td><td>返回包含所要搜索字符串的软件包名称</td></tr></tbody></table></div><h1 id="查看文件内容"><a href="#查看文件内容" class="headerlink" title="查看文件内容"></a>查看文件内容</h1><div class="table-container"><table><thead><tr><th>命令</th><th>描述</th></tr></thead><tbody><tr><td>cat file1</td><td>从第一个字节开始正向查看文件的内容</td></tr><tr><td>tac file1</td><td>从最后一行开始反向查看一个文件的内容</td></tr><tr><td>more file1</td><td>查看一个长文件的内容</td></tr><tr><td>less file1</td><td>类似于 &#39;more&#39; 命令，但是它允许在文件中和正向操作一样的反向操作</td></tr><tr><td>head -2 file1</td><td>查看一个文件的前两行</td></tr><tr><td>tail -2 file1</td><td>查看一个文件的最后两行</td></tr><tr><td>tail -f /var/log/messages</td><td>实时查看被添加到一个文件中的内容</td></tr></tbody></table></div><h1 id="文本处理"><a href="#文本处理" class="headerlink" title="文本处理"></a>文本处理</h1><div class="table-container"><table><thead><tr><th>命令</th><th>描述</th></tr></thead><tbody><tr><td>cat file1 file2 ... &vert; command &lt;&gt; file1_in.txt_or_file1_out.txt</td><td>合并一个文件的详细说明文本，并将简介写出新文件中</td></tr><tr><td>cat file1 &vert; command( sed, grep, awk, grep, etc...) &gt; result.txt</td><td>合并一个文件的详细说明文本，并将简介写入一个新文件中</td></tr><tr><td>cat file1 &vert; command( sed, grep, awk, grep, etc...) &gt;&gt; result.txt</td><td>合并一个文件的详细说明文本，并将简介写入一个已有的文件中</td></tr><tr><td>grep Aug /var/log/messages</td><td>在文件 &#39;/var/log/messages&#39; 中查找关键词 &quot;Aug&quot;</td></tr><tr><td>grep ^Aug /var/log/messages</td><td>在文件 &#39;/var/log/messages&#39; 中查找以 &quot;Aug&quot; 开始的词汇</td></tr><tr><td>grep [0-9] /var/log/messages</td><td>选择 &#39;/var/log/messages&#39; 文件中所有包含数字的行</td></tr><tr><td>grep Aug -R /var/log/*</td><td>在目录 &#39;/var/log&#39; 及随后的目录中搜索字符串 &quot;Aug&quot;</td></tr><tr><td>sed &#39;s/stringa1/stringa2/g&#39; example.txt</td><td>将 example.txt 文件中的 &quot;string1&quot; 替换成 &quot;string2&quot;</td></tr><tr><td>sed &#39;/^$/d&#39; example.txt</td><td>从 example.txt 文件中删除所有空白行</td></tr><tr><td>sed &#39;/ *#/d /^$/d&#39; example.txt</td><td>从 example.txt 文件中删除所有注释和空白行</td></tr><tr><td>echo &#39;esempio&#39; &vert; tr &#39;[:lower:]&#39; &#39;[:upper:]&#39;</td><td>合并上下单元格内容</td></tr><tr><td>sed -e &#39;1d&#39; result.txt</td><td>从文件 example.txt 中排除第一行</td></tr><tr><td>sed -n &#39;/stringa1/p&#39;</td><td>查看只包含词汇 &quot;string1&quot; 的行</td></tr><tr><td>sed -e &#39;s/ *$//&#39; example.txt</td><td>删除每一行最后的空白字符</td></tr><tr><td>sed -e &#39;s/stringa1//g&#39; example.txt</td><td>从文档中只删除词汇 &quot;string1&quot; 并保留剩余全部</td></tr><tr><td>sed -n &#39;1,5p5q&#39; example.txt</td><td>查看从第一行到第5行内容</td></tr><tr><td>sed -n &#39;5p5q&#39; example.txt</td><td>查看第 5 行</td></tr><tr><td>sed -e &#39;s/00*/0/g&#39; example.txt</td><td>用单个零替换多个零</td></tr><tr><td>cat -n file1</td><td>标示文件的行数</td></tr><tr><td>cat example.txt &vert; awk &#39;NR%2==1&#39;</td><td>删除 example.txt 文件中的所有偶数行</td></tr><tr><td>echo a b c &vert; awk &#39;{print $1}&#39;</td><td>查看一行第一栏</td></tr><tr><td>echo a b c &vert; awk &#39;{print $1,$3}&#39;</td><td>查看一行的第一和第三栏</td></tr><tr><td>paste file1 file2</td><td>合并两个文件或两栏的内容</td></tr><tr><td>paste -d &#39;+&#39; file1 file2</td><td>合并两个文件或两栏的内容，中间用 &quot;+&quot; 区分</td></tr><tr><td>sort file1 file2</td><td>排序两个文件的内容</td></tr><tr><td>sort file1 file2 &vert; uniq</td><td>取出两个文件的并集（重复的行只保留一份）</td></tr><tr><td>sort file1 file2 &vert; uniq -u</td><td>删除交集，留下其他的行</td></tr><tr><td>sort file1 file2 &vert; uniq -d</td><td>取出两个文件的交集（只留下同时存在于两个文件中的文件）</td></tr><tr><td>comm -1 file1 file2</td><td>比较两个文件的内容只删除 &#39;file1&#39; 所包含的内容</td></tr><tr><td>comm -2 file1 file2</td><td>比较两个文件的内容只删除 &#39;file2&#39; 所包含的内容</td></tr><tr><td>comm -3 file1 file2</td><td>比较两个文件的内容只删除两个文件共有的部分</td></tr></tbody></table></div><h1 id="字符设置和文件格式转换"><a href="#字符设置和文件格式转换" class="headerlink" title="字符设置和文件格式转换"></a>字符设置和文件格式转换</h1><div class="table-container"><table><thead><tr><th>命令</th><th>描述</th></tr></thead><tbody><tr><td>dos2unix filedos.txt fileunix.txt</td><td>将一个文本文件的格式从 MSDOS 转换成 UNIX</td></tr><tr><td>unix2dos fileunix.txt filedos.txt</td><td>将一个文本文件的格式从 UNIX 转换成 MSDOS</td></tr><tr><td>recode ..HTML &lt; page.txt &gt; page.html</td><td>将一个文本文件转换成 html 文件</td></tr><tr><td>recode -l &vert; more</td><td>显示所有允许的转换格式</td></tr></tbody></table></div><h1 id="文件系统分析"><a href="#文件系统分析" class="headerlink" title="文件系统分析"></a>文件系统分析</h1><h2 id="检查-修复磁盘"><a href="#检查-修复磁盘" class="headerlink" title="检查/修复磁盘"></a>检查/修复磁盘</h2><div class="table-container"><table><thead><tr><th>命令</th><th>描述</th></tr></thead><tbody><tr><td>badblocks -v /dev/hda1</td><td>检查磁盘 hda1 上的坏磁块</td></tr><tr><td>fsck /dev/hda1</td><td>修复/检查 hda1 磁盘上 linux 文件系统的完整性</td></tr><tr><td>fsck.ext2 /dev/hda1</td><td>修复/检查 hda1 磁盘上 ext2 文件系统的完整性</td></tr><tr><td>e2fsck /dev/hda1</td><td>修复/检查 hda1 磁盘上 ext2 文件系统的完整性</td></tr><tr><td>e2fsck -j /dev/hda1</td><td>修复/检查 hda1 磁盘上 ext3 文件系统的完整性</td></tr><tr><td>fsck.ext3 /dev/hda1</td><td>修复/检查 hda1 磁盘上 ext3 文件系统的完整性</td></tr><tr><td>fsck.vfat /dev/hda1</td><td>修复/检查 hda1 磁盘上 fat 文件系统的完整性</td></tr><tr><td>fsck.msdos /dev/hda1</td><td>修复/检查 hda1 磁盘上 dos 文件系统的完整性</td></tr><tr><td>dosfsck /dev/hda1</td><td>修复/检查 hda1 磁盘上 dos 文件系统的完整性</td></tr></tbody></table></div><h2 id="初始化一个文件系统"><a href="#初始化一个文件系统" class="headerlink" title="初始化一个文件系统"></a>初始化一个文件系统</h2><div class="table-container"><table><thead><tr><th>命令</th><th>描述</th></tr></thead><tbody><tr><td>mkfs /dev/hda1</td><td>在 hda1 分区创建一个文件系统</td></tr><tr><td>mke2fs /dev/hda1</td><td>在 hda1 分区创建一个 linux ext2 的文件系统</td></tr><tr><td>mke2fs -j /dev/hda1</td><td>在 hda1 分区创建一个 linux ext3（日志型）的文件系统</td></tr><tr><td>mkfs -t vfat 32 -F /dev/hda1</td><td>创建一个 FAT32 文件系统</td></tr><tr><td>fdformat -n /dev/fd0</td><td>格式化一个软盘</td></tr><tr><td>mkswap /dev/hda3</td><td>创建一个 swap 文件系统</td></tr></tbody></table></div><h2 id="SWAP文件系统"><a href="#SWAP文件系统" class="headerlink" title="SWAP文件系统"></a>SWAP文件系统</h2><div class="table-container"><table><thead><tr><th>命令</th><th>描述</th></tr></thead><tbody><tr><td>mkswap /dev/hda3</td><td>创建一个 swap 文件系统</td></tr><tr><td>swapon /dev/hda3</td><td>启用一个新的 swap 文件系统</td></tr><tr><td>swapon /dev/hda2 /dev/hdb3</td><td>启用两个 swap 分区</td></tr></tbody></table></div><h1 id="备份"><a href="#备份" class="headerlink" title="备份"></a>备份</h1><div class="table-container"><table><thead><tr><th>命令</th><th>描述</th></tr></thead><tbody><tr><td>dump -0aj -f /tmp/home0.bak /home</td><td>制作一个 &#39;/home&#39; 目录的完整备份</td></tr><tr><td>dump -1aj -f /tmp/home0.bak /home</td><td>制作一个 &#39;/home&#39; 目录的交互式备份</td></tr><tr><td>restore -if /tmp/home0.bak</td><td>还原一个交互式备份</td></tr><tr><td>rsync -rogpav --delete /home /tmp</td><td>同步两边的目录</td></tr><tr><td>rsync -rogpav -e ssh --delete /home ip_address:/tmp</td><td>通过 ssh 通道 rsync</td></tr><tr><td>rsync -az -e ssh --delete ip_addr:/home/public /home/local</td><td>通过 ssh 和压缩将一个远程目录同步到本地目录</td></tr><tr><td>rsync -az -e ssh --delete /home/local ip_addr:/home/public</td><td>通过 ssh 和压缩将本地目录同步到远程目录</td></tr><tr><td>dd bs=1M if=/dev/hda &vert; gzip &vert; ssh user@ip_addr &#39;dd of=hda.gz&#39;</td><td>通过 ssh 在远程主机上执行一次备份本地磁盘的操作</td></tr><tr><td>dd if=/dev/sda of=/tmp/file1</td><td>备份磁盘内容到一个文件</td></tr><tr><td>tar -Puf backup.tar /home/user</td><td>执行一次对 &#39;/home/user&#39; 目录的交互式备份操作</td></tr><tr><td>( cd /tmp/local/ &amp;&amp; tar c . ) &vert; ssh -C user@ip_addr &#39;cd /home/share/ &amp;&amp; tar x -p&#39;</td><td>通过 ssh 在远程目录中复制一个目录内容</td></tr><tr><td>( tar c /home ) &vert; ssh -C user@ip_addr &#39;cd /home/backup-home &amp;&amp; tar x -p&#39;</td><td>通过 ssh 在远程目录中复制一个本地目录</td></tr><tr><td>tar cf - . &vert; (cd /tmp/backup tar xf - )</td><td>本地将一个目录复制到另一个地方，保留原有权限及链接</td></tr><tr><td>find /home/user1 -name &#39;*.txt&#39; &vert; xargs cp -av --target-directory=/home/backup/ --parents</td><td>从一个目录查找并复制所有以 &#39;.txt&#39; 结尾的文件到另一个目录</td></tr><tr><td>find /var/log -name &#39;*.log&#39; &vert; tar cv --files-from=- &vert; bzip2 &gt; log.tar.bz2</td><td>查找所有以 &#39;.log&#39; 结尾的文件并做成一个bzip包</td></tr><tr><td>dd if=/dev/hda of=/dev/fd0 bs=512 count=1</td><td>做一个将 MBR（Master Boot Record）内容复制到软盘的动作</td></tr><tr><td>dd if=/dev/fd0 of=/dev/hda bs=512 count=1</td><td>从已经保存到软盘的备份中恢复 MBR 内容</td></tr></tbody></table></div><h1 id="光盘"><a href="#光盘" class="headerlink" title="光盘"></a>光盘</h1><div class="table-container"><table><thead><tr><th>命令</th><th>描述</th></tr></thead><tbody><tr><td>cdrecord -v gracetime=2 dev=/dev/cdrom -eject blank=fast -force</td><td>清空一个可复写的光盘内容</td></tr><tr><td>mkisofs /dev/cdrom &gt; cd.iso</td><td>在磁盘上创建一个光盘的 ISO 镜像文件</td></tr><tr><td>mkisofs /dev/cdrom &vert; gzip &gt; cd_iso.gz</td><td>在磁盘上创建一个压缩了的光盘 ISO 镜像文件</td></tr><tr><td>mkisofs -J -allow-leading-dots -R -V &quot;Label CD&quot; -iso-level 4 -o ./cd.iso data_cd</td><td>创建一个目录的 ISO 镜像文件</td></tr><tr><td>cdrecord -v dev=/dev/cdrom cd.iso</td><td>刻录一个 ISO 镜像文件</td></tr><tr><td>gzip -dc cd_iso.gz &vert; cdrecord dev=/dev/cdrom</td><td>刻录一个压缩了的 ISO 镜像文件</td></tr><tr><td>mount -o loop cd.iso /mnt/iso</td><td>挂载一个 ISO 镜像文件</td></tr><tr><td>cd-paranoia -B</td><td>从一个CD光盘转录音轨到 wav 文件中</td></tr><tr><td>cd-paranoia -- &quot;-3&quot;</td><td>从一个 CD 光盘转录音轨到 wav 文件中（参数-3）</td></tr><tr><td>cdrecord --scanbus</td><td>扫描总线以识别 scsi 通道</td></tr><tr><td>dd if=/dev/hdc &vert; md5sum</td><td>校验一个设备的 md5sum 编码，例如一张 CD</td></tr></tbody></table></div><h1 id="网络-（以太网和WIFI无线）"><a href="#网络-（以太网和WIFI无线）" class="headerlink" title="网络 - （以太网和WIFI无线）"></a>网络 - （以太网和WIFI无线）</h1><div class="table-container"><table><thead><tr><th>命令</th><th>描述</th></tr></thead><tbody><tr><td>ifconfig eth0</td><td>显示一个以太网卡的配置</td></tr><tr><td>ifup eth0</td><td>启用一个 &#39;eth0&#39; 网络设备</td></tr><tr><td>ifdown eth0</td><td>禁用一个 &#39;eth0&#39; 网络设备</td></tr><tr><td>ifconfig eth0 192.168.1.1 netmask 255.255.255.0</td><td>控制 IP 地址</td></tr><tr><td>ifconfig eth0 promisc</td><td>设置 &#39;eth0&#39; 成混杂模式以嗅探数据包（sniffing）</td></tr><tr><td>dhclient eth0</td><td>以 dhcp 模式启用 &#39;eth0&#39;</td></tr><tr><td>route -n show</td><td>显示路由</td></tr><tr><td>route add -net 0/0 gw 192.168.1.1</td><td>配置默认网关</td></tr><tr><td>route add -net 192.168.0.0 netmask 255.255.0.0 gw 192.168.1.1</td><td>配置静态路由为 &#39;192.168.0.0/16&#39;</td></tr><tr><td>route del 0/0 gw 192.168.1.1</td><td>删除静态路由</td></tr><tr><td>echo &quot;1&quot; &gt; /proc/sys/net/ipv4/ip_forward</td><td>激活 IP 路由</td></tr><tr><td>hostname</td><td>显示系统主机名</td></tr><tr><td>host www.example.com</td><td>查找主机名以将名称解析为 IP 地址，反之亦然</td></tr><tr><td>nslookup www.example.com</td><td>查找主机名以将名称解析为 IP 地址，反之亦然</td></tr><tr><td>ip link show</td><td>显示所有接口的链接状态</td></tr><tr><td>mii-tool eth0</td><td>显示 &#39;eth0&#39; 的链接状态</td></tr><tr><td>ethtool eth0</td><td>显示网卡 &#39;eth0&#39; 的统计信息</td></tr><tr><td>netstat -tup</td><td>显示所有活动的网络连接及其 PID</td></tr><tr><td>netstat -tupl</td><td>显示所有正在侦听系统的网络服务及其PID</td></tr><tr><td>tcpdump tcp port 80</td><td>显示所有 HTTP 流量</td></tr><tr><td>iwlist scan</td><td>显示无线网络</td></tr><tr><td>iwconfig eth1</td><td>显示无线网卡的配置</td></tr><tr><td>whois www.example.com</td><td>在 Whois 数据库上查找</td></tr></tbody></table></div>]]></content>
      
      
      <categories>
          
          <category> 教程笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MySQL 面试题解析</title>
      <link href="post/54dbb40b.html"/>
      <url>post/54dbb40b.html</url>
      
        <content type="html"><![CDATA[<blockquote><h3 id="CHAR、VARCHAR-的区别是什么？"><a href="#CHAR、VARCHAR-的区别是什么？" class="headerlink" title="CHAR、VARCHAR 的区别是什么？"></a>CHAR、VARCHAR 的区别是什么？</h3></blockquote><ul><li>CHAR 的特点<ul><li>CHAR 表示定长字符串，长度是固定的；</li><li>如果插入数据的长度小于 CHAR 的固定长度时，则用空格填充；</li><li>因为长度固定，所以存取速度要比 VARCHAR 快很多，甚至能快 50%，但正因为其长度固定，所以会占据多余的空间，是空间换时间的做法；</li><li>对于 CHAR 来说，最多能存放的字符个数为 255，和编码无关。</li></ul></li><li>VARCHAR 的特点<ul><li>VARCHAR 表示可变长字符串，长度是可变的；</li><li>插入的数据是多长，就按照多长来存储；</li><li>VARCHAR 在存取方面与 CHAR 相反，它存取慢，因为长度不固定，但正因如此，不占据多余的空间，是时间换空间的做法；</li><li>对于 VARCHAR 来说，最多能存放的字符个数为 65532。</li></ul></li></ul><p>总之，结合性能角度（CHAR 更快）和节省磁盘空间角度（VARCHAR 更小），具体情况还需具体来设计数据库才是妥当的做法。</p><blockquote><h3 id="DELETE、TRUNCATE-与-DROP-的区别是什么？"><a href="#DELETE、TRUNCATE-与-DROP-的区别是什么？" class="headerlink" title="DELETE、TRUNCATE 与 DROP 的区别是什么？"></a>DELETE、TRUNCATE 与 DROP 的区别是什么？</h3></blockquote><ul><li>DELETE 命令从一个表中删除某一行，或多行；</li><li>TRUNCATE 命令永久地从表中删除每一行。</li><li>DROP 命令是删除表和表中所有数据；</li></ul><div class="table-container"><table><thead><tr><th>&nbsp;</th><th>DELETE</th><th>TRUNCATE</th><th>DROP</th></tr></thead><tbody><tr><td>类型</td><td>属于 DML</td><td>属于 DDL</td><td>属于 DDL</td></tr><tr><td>回滚</td><td>可回滚</td><td>不可回滚</td><td>不可回滚</td></tr><tr><td>删除内容</td><td>表结构还在，删除表的全部或者一部分数据</td><td>表结构还在，删除表中的所有数据</td><td>从数据库中删除表、所有的数据行、索引和权限也会被删除</td></tr><tr><td>删除速度</td><td>删除速度慢，需要逐行删除</td><td>删除速度快</td><td>删除速度最快</td></tr></tbody></table></div><blockquote><h3 id="什么是触发器，MySQL-中都有哪些触发器？"><a href="#什么是触发器，MySQL-中都有哪些触发器？" class="headerlink" title="什么是触发器，MySQL 中都有哪些触发器？"></a>什么是触发器，MySQL 中都有哪些触发器？</h3></blockquote><p>触发器是用户定义在关系表上的一类由事件驱动的特殊的存储过程。触发器是指一段代码，当触发某个事件时，自动执行这些代码。</p><p><strong>使用场景</strong></p><ul><li>可以通过数据库中的相关表实现级联更改。</li><li>实时监控某张表中的某个字段的更改而需要做出相应的处理。</li><li>例如可以生成某些业务的编号。</li><li>注意不要滥用，否则会造成数据库及应用程序的维护困难。</li></ul><p><strong>在 MySQL 数据库中有如下六种触发器：</strong></p><ul><li>Before Insert</li><li>After Insert</li><li>Before Update</li><li>After Update</li><li>Before Delete</li><li>After Delete</li></ul><blockquote><h3 id="FLOAT-和-DOUBLE-的区别是什么？"><a href="#FLOAT-和-DOUBLE-的区别是什么？" class="headerlink" title="FLOAT 和 DOUBLE 的区别是什么？"></a>FLOAT 和 DOUBLE 的区别是什么？</h3></blockquote><ul><li>FLOAT 类型数据可以存储至多 8 位十进制数，并在内存中占 4 字节。</li><li>DOUBLE 类型数据可以存储至多 18 位十进制数，并在内存中占 8 字节。</li></ul><blockquote><h3 id="如何在-MySQL-中获取当前日期？"><a href="#如何在-MySQL-中获取当前日期？" class="headerlink" title="如何在 MySQL 中获取当前日期？"></a>如何在 MySQL 中获取当前日期？</h3></blockquote><p><code>SELECT CURRENT_DATE();</code></p><blockquote><h3 id="如何查询第-n-高的工资？"><a href="#如何查询第-n-高的工资？" class="headerlink" title="如何查询第 n 高的工资？"></a>如何查询第 n 高的工资？</h3></blockquote><p><code>SELECT DISTINCT(salary) FROM employee ORDER BY salary DESC LIMIT n-1, 1</code></p><blockquote><h3 id="请写出下面-MySQL-数据类型表达的意义（INT-0-、CHAR-16-、VARCHAR-16-、DATETIME、TEXT）"><a href="#请写出下面-MySQL-数据类型表达的意义（INT-0-、CHAR-16-、VARCHAR-16-、DATETIME、TEXT）" class="headerlink" title="请写出下面 MySQL 数据类型表达的意义（INT(0)、CHAR(16)、VARCHAR(16)、DATETIME、TEXT）"></a>请写出下面 MySQL 数据类型表达的意义（INT(0)、CHAR(16)、VARCHAR(16)、DATETIME、TEXT）</h3></blockquote><p><strong>知识点分析</strong></p><p>此题考察的是 MySQL 数据类型。MySQL 数据类型属于 MySQL 数据库基础，由此延伸出的知识点还包括如下内容：</p><ul><li>MySQL基础操作</li><li>MySQL存储引擎</li><li>MySQL锁机制</li><li>MySQL事务处理、存储过程、触发器</li></ul><p><strong>数据类型考点：</strong></p><ol><li><p>整数类型，包括 TINYINT、SMALLINT、MEDIUMINT、INT、BIGINT，分别表示 1 字节、2 字节、3 字节、4 字节、8 字节整数。任何整数类型都可以加上 <code>UNSIGNED</code> 属性，表示数据是无符号的，即非负整数。</p><p> 长度：整数类型可以被指定长度，例如：INT(11) 表示长度为 11 的 INT 类型。长度在大多数场景是没有意义的，它不会限制值的合法范围，只会影响显示字符的个数，而且需要和<code>UNSIGNED ZEROFILL</code> 属性配合使用才有意义。</p><p> 例子，假定类型设定为 INT(5)，属性为 <code>UNSIGNED ZEROFILL</code>，如果用户插入的数据为 12 的话，那么数据库实际存储数据为 00012。</p></li><li><p>实数类型，包括 FLOAT、DOUBLE、DECIMAL。</p><p> DECIMAL 可以用于存储比 BIGINT 还大的整型，能存储精确的小数。</p><p> 而 FLOAT 和 DOUBLE 是有取值范围的，并支持使用标准的浮点进行近似计算。</p><p> 计算时 FLOAT 和 DOUBLE 相比 DECIMAL 效率更高一些，DECIMAL 你可以理解成是用字符串进行处理。</p></li><li><p>字符串类型，包括 VARCHAR、CHAR、TEXT、BLOB。</p><p> VARCHAR 用于存储可变长字符串，它比定长类型更节省空间。</p><p> VARCHAR 使用额外 1 或 2 个字节存储字符串长度。列长度小于 255 字节时，使用 1 字节表示，否则使用 2 字节表示。</p><p> VARCHAR 存储的内容超出设置的长度时，内容会被截断。</p><p> CHAR 是定长的，根据定义的字符串长度分配足够的空间。</p><p> CHAR 会根据需要使用空格进行填充方便比较。</p><p> CHAR 适合存储很短的字符串，或者所有值都接近同一个长度。</p><p> CHAR 存储的内容超出设置的长度时，内容同样会被截断。</p><p> <strong>使用策略：</strong></p><p> 对于经常变更的数据来说，CHAR 比 VARCHAR 更好，因为 CHAR 不容易产生碎片。 对于非常短的列，CHAR 比 VARCHAR 在存储空间上更有效率。 使用时要注意只分配需要的空间，更长的列排序时会消耗更多内存。 尽量避免使用 TEXT/BLOB 类型，查询时会使用临时表，导致严重的性能开销。</p></li><li><p>枚举类型（ENUM），把不重复的数据存储为一个预定义的集合。</p><p> 有时可以使用 ENUM 代替常用的字符串类型。 ENUM 存储非常紧凑，会把列表值压缩到一个或两个字节。 ENUM 在内部存储时，其实存的是整数。 尽量避免使用数字作为 ENUM 枚举的常量，因为容易混乱。 排序是按照内部存储的整数</p></li><li><p>日期和时间类型，尽量使用 TIMESTAMP，空间效率高于 DATETIME，</p><p> 用整数保存时间戳通常不方便处理。</p><p> 如果需要存储微秒，可以使用 BIGINT 存储。</p></li></ol><p>看到这里，这道真题是不是就比较容易回答了。</p><p>答：INT(0) 表示数据是 INT 类型，长度是 0；CHAR(16) 表示固定长度字符串，长度为 16；VARCHAR(16) 表示可变长度字符串，长度为 16；DATETIME 表示时间类型；TEXT 表示字符串类型，能存储大字符串，最多存储 65535 字节数据。</p><blockquote><h3 id="MySQL-基础操作"><a href="#MySQL-基础操作" class="headerlink" title="MySQL 基础操作"></a>MySQL 基础操作</h3></blockquote><p>MySQL 的连接和关闭：<code>mysql -u -p -h -P</code></p><ul><li>-u：指定用户名</li><li>-p：指定密码</li><li>-h：主机</li><li>-P：端口</li></ul><p>进入 MySQL 命令行后：<code>G</code>、<code>c</code>、<code>q</code>、<code>s</code>、<code>h</code>、<code>d</code></p><ul><li>G：打印结果垂直显示</li><li>c：取消当前MySQL命令</li><li>q：退出MySQL连接</li><li>s：显示服务器状态</li><li>h：帮助信息</li><li>d：改变执行符</li></ul><blockquote><h3 id="MySQL-存储引擎"><a href="#MySQL-存储引擎" class="headerlink" title="MySQL 存储引擎"></a>MySQL 存储引擎</h3></blockquote><ul><li><p>InnoDB 存储引擎：</p><ul><li>默认事务型引擎，最重要最广泛的存储引擎，性能非常优秀。</li><li>数据存储在共享表空间，可以通过配置分开。也就是多个表和索引都存储在一个表空间中，可以通过配置文件改变此配置。</li><li>对主键查询的性能高于其他类型的存储引擎。</li><li>内部做了很多优化，从磁盘读取数据时会自动构建 hash 索引，插入数据时自动构建插入缓冲区。</li><li>通过一些机制和工具支持真正的热备份。</li><li>支持崩溃后的安全恢复。</li><li>支持行级锁。</li><li>支持外键。</li></ul></li><li><p>MyISAM 存储引擎：</p><ul><li>拥有全文索引、压缩、空间函数。</li><li>不支持事务和行级锁、不支持崩溃后的安全恢复。</li><li>表存储在两个文件，MYD 和 MYI。</li><li>设计简单，某些场景下性能很好，例如获取整个表有多少条数据，性能很高。</li><li>全文索引不是很常用，不如使用外部的 ElasticSearch 或 Lucene。</li></ul></li><li><p>其他表引擎：</p><ul><li>Archive、Blackhole、CSV、Memory</li></ul></li></ul><p><strong>使用策略：</strong>在大多数场景下建议使用 InnoDB 存储引擎。</p><blockquote><h3 id="MySQL-锁机制"><a href="#MySQL-锁机制" class="headerlink" title="MySQL 锁机制"></a>MySQL 锁机制</h3></blockquote><p>表锁是日常开发中的常见问题，因此也是面试当中最常见的考察点，当多个查询同一时刻进行数据修改时，就会产生并发控制的问题。共享锁和排他锁，就是读锁和写锁。</p><ul><li>共享锁，不堵塞，多个用户可以同时读一个资源，互不干扰。</li><li>排他锁，一个写锁会阻塞其他的读锁和写锁，这样可以只允许一个用户进行写入，防止其他用户读取正在写入的资源。</li></ul><p><strong>锁的粒度</strong></p><ul><li>表锁，系统开销最小，会锁定整张表，MyISAM 使用表锁。</li><li>行锁，最大程度的支持并发处理，但是也带来了最大的锁开销，InnoDB 使用行锁。</li></ul><blockquote><h3 id="MySQL-事务处理"><a href="#MySQL-事务处理" class="headerlink" title="MySQL 事务处理"></a>MySQL 事务处理</h3></blockquote><ul><li>MySQL 提供事务处理的表引擎，也就是 InnoDB。</li><li>服务器层不管理事务，由下层的引擎实现，所以同一个事务中，使用多种引擎是不靠谱的。</li><li>需要注意，在非事务表上执行事务操作，MySQL 不会发出提醒，也不会报错。</li></ul><blockquote><h3 id="MySQL-存储过程"><a href="#MySQL-存储过程" class="headerlink" title="MySQL 存储过程"></a>MySQL 存储过程</h3></blockquote><ul><li>为以后的使用保存的一条或多条 MySQL 语句的集合，因此也可以在存储过程中加入业务逻辑和流程。</li><li>可以在存储过程中创建表，更新数据，删除数据等等。</li></ul><p><strong>使用策略</strong></p><ul><li>可以通过把 SQL 语句封装在容易使用的单元中，简化复杂的操作；</li><li>可以保证数据的一致性；</li><li>可以简化对变动的管理。</li></ul><blockquote><h3 id="MySQL-触发器"><a href="#MySQL-触发器" class="headerlink" title="MySQL 触发器"></a>MySQL 触发器</h3></blockquote><p>提供给程序员和数据分析员来保证数据完整性的一种方法，它是与表事件相关的特殊的存储过程。</p><p><strong>使用场景</strong></p><ul><li>可以通过数据库中的相关表实现级联更改。</li><li>实时监控某张表中的某个字段的更改而需要做出相应的处理。</li><li>例如可以生成某些业务的编号。</li><li>注意不要滥用，否则会造成数据库及应用程序的维护困难。</li></ul><blockquote><h3 id="请说明-InnoDB-和-MyISAM-的区别"><a href="#请说明-InnoDB-和-MyISAM-的区别" class="headerlink" title="请说明 InnoDB 和 MyISAM 的区别"></a>请说明 InnoDB 和 MyISAM 的区别</h3></blockquote><ul><li>InnoDB 支持事务，MyISAM 不支持；</li><li>InnoDB 数据存储在共享表空间，MyISAM 数据存储在文件中；</li><li>InnoDB 支持行级锁，MyISAM 只支持表锁；</li><li>InnoDB 支持崩溃后的恢复，MyISAM 不支持；</li><li>InnoDB 支持外键，MyISAM 不支持；</li><li>InnoDB 不支持全文索引，MyISAM 支持全文索引；</li></ul><blockquote><h3 id="InnoDB-引擎的特性"><a href="#InnoDB-引擎的特性" class="headerlink" title="InnoDB 引擎的特性"></a>InnoDB 引擎的特性</h3></blockquote><ul><li>插入缓冲（insert buffer）</li><li>二次写（double write）</li><li>自适应哈希索引（ahi）</li><li>预读（read ahead）</li></ul><blockquote><h3 id="请说明-VARCHAR-和-TEXT-的区别"><a href="#请说明-VARCHAR-和-TEXT-的区别" class="headerlink" title="请说明 VARCHAR 和 TEXT 的区别"></a>请说明 VARCHAR 和 TEXT 的区别</h3></blockquote><ul><li>VARCHAR 可指定字符数，TEXT 不能指定，内部存储 VARCHAR 是存入的实际字符数 + 1 个字节（n&lt;=255）或 2 个字节(n&gt;255)，TEXT 是实际字符数 + 2 个字节。</li><li>TEXT 类型不能有默认值。</li><li>VARCHAR 可直接创建索引，TEXT 创建索引要指定前多少个字符。VARCHAR 查询速度快于 TEXT，在都创建索引的情况下，TEXT 的索引几乎不起作用。</li><li>查询 TEXT 需要创建临时表。</li></ul><blockquote><h3 id="VARCHAR-50-中-50-的含义"><a href="#VARCHAR-50-中-50-的含义" class="headerlink" title="VARCHAR(50) 中 50 的含义"></a>VARCHAR(50) 中 50 的含义</h3><p>最多存放 50 个字符，VARCHAR(50) 和 VARCHAR(200)存储 <code>hello</code> 所占空间一样，但后者在排序时会消耗更多内存，因为 <code>ORDER BY col</code> 采用 <code>fixed_length</code> 计算 <code>col</code> 长度（Memory 引擎也一样）。</p><h3 id="INT-20-中-20-的含义"><a href="#INT-20-中-20-的含义" class="headerlink" title="INT(20) 中 20 的含义"></a>INT(20) 中 20 的含义</h3></blockquote><p>是指显示字符的长度，不影响内部存储，只是当定义了 <code>ZEROFILL</code> 时，前面补多少个 0。</p><blockquote><h3 id="简单描述-MySQL-中，索引，主键，唯一索引，联合索引的区别，对数据库的性能有什么影响？"><a href="#简单描述-MySQL-中，索引，主键，唯一索引，联合索引的区别，对数据库的性能有什么影响？" class="headerlink" title="简单描述 MySQL 中，索引，主键，唯一索引，联合索引的区别，对数据库的性能有什么影响？"></a>简单描述 MySQL 中，索引，主键，唯一索引，联合索引的区别，对数据库的性能有什么影响？</h3></blockquote><p><strong>知识点分析</strong></p><p>此题主要考察的是 MySQL 索引的基础和类型，由此延伸出的知识点还包括如下内容：</p><ul><li>MySQL 索引的创建原则</li><li>MySQL 索引的注意事项</li><li>MySQL 索引的原理</li></ul><p><strong>索引的基础</strong></p><ul><li>索引类似于书籍的目录，要想找到一本数的某个特定主题，需要先查找书的目录，定位对应的页码。</li><li>存储引擎使用类似的方式进行数据查询，先去索引当中找到对应的值，然后根据匹配的索引找到对应的数据行。</li></ul><p><strong>索引的使用场景</strong></p><ul><li>对于非常小的表，大部分情况下全表扫描效率更高。</li><li>中到大型表，索引非常有效。</li><li>特大型的表，建立和使用索引的代价会随之增大，可以使用分区技术来解决。</li></ul><p><strong>索引的类型</strong></p><p>索引很多种类型，是在 MySQL 的存储引擎实现的。</p><ul><li>普通索引：最基本的索引，没有任何约束限制。</li><li>唯一索引：和普通索引类似，但是具有唯一性约束。</li><li>主键索引：特殊的唯一索引，不允许有空值。</li></ul><p><strong>索引的区别</strong></p><ul><li>一个表只能有一个主键索引，但是可以有多个唯一索引。</li><li>主键索引一定是唯一索引，唯一索引不是主键索引。</li><li>主键可以与外键构成参照完整性约束，防止数据不一致。</li><li>联合索引：将多个列组合在一起创建索引，可以覆盖多个列。（也叫复合索引，组合索引）</li><li>外键索引：只有 InnoDB 类型的表才可以使用外键索引，保证数据的一致性、完整性、和实现级联操作（基本不用）。</li><li>全文索引：MySQL 自带的全文索引只能用于 MyISAM，并且只能对英文进行全文检索（基本不用）。</li></ul><p><strong>索引对性能的影响</strong></p><ul><li>大大减少服务器需要扫描的数据量。</li><li>帮助服务器避免排序和临时表。</li><li>将随机 I/O 变顺序 I/O。</li><li>大大提高查询速度。</li><li>降低写的速度（不良影响）。</li><li>磁盘占用（不良影响）。</li></ul><p><strong>创建索引的语法</strong></p><ol><li>首先创建一个表：<code>CREATE TABLE t1 (id INT PRIMARY KEY, username VARCHAR(20), password VARCHAR(20));</code></li><li>创建单个索引的语法：<code>CREATE INDEX 索引名 ON 表名(字段名)</code></li><li>索引名一般是：<code>表名_字段名</code></li><li>给 id 创建索引：<code>CREATE INDEX t1_id ON t1(id);</code></li><li>创建联合索引的语法：<code>CREATE INDEX 索引名 ON 表名(字段名1，字段名2)</code></li><li>给 username 和 password 创建联合索引：<code>CREATE INDEX t1_username_password ON t1(username, password)</code>，其中 INDEX 还可以替换成 UNIQUE，PRIMARY KEY，分别代表唯一索引和主键索引。</li><li>删除索引：<code>DROP INDEX t1_username_password ON t1</code></li></ol><p><strong>MySQL 索引的创建原则</strong></p><ul><li>最适合创建索引的列是出现在 <code>WHERE</code> 或 <code>ON</code> 子句中的列，或连接子句中的列而不是出现在 <code>SELECT</code> 关键字后的列。</li><li>索引列的基数越大，数据区分度越高，索引的效果越好。</li><li>对于字符串进行索引，应该制定一个前缀长度，可以节省大量的索引空间。</li><li>根据情况创建联合索引，联合索引可以提高查询效率。</li><li>避免创建过多的索引，索引会额外占用磁盘空间，降低写操作效率。</li><li>主键尽可能选择较短的数据类型，可以有效减少索引的磁盘占用提高查询效率。</li></ul><p><strong>MySQL 索引的注意事项</strong></p><ul><li>联合索引遵循前缀原则<p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">KEY</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c<span class="token punctuation">)</span><span class="token keyword">WHERE</span> a <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">AND</span> b <span class="token operator">=</span> <span class="token number">2</span> <span class="token operator">AND</span> c <span class="token operator">=</span> <span class="token number">3</span><span class="token keyword">WHERE</span> a <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">AND</span> b <span class="token operator">=</span> <span class="token number">2</span><span class="token keyword">WHERE</span> a <span class="token operator">=</span> <span class="token number">1</span><span class="token comment"># 以上SQL语句可以用到索引</span><span class="token keyword">WHERE</span> b <span class="token operator">=</span> <span class="token number">2</span> <span class="token operator">AND</span> c <span class="token operator">=</span> <span class="token number">3</span><span class="token keyword">WHERE</span> a <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">AND</span> c <span class="token operator">=</span> <span class="token number">3</span><span class="token comment"># 以上SQL语句用不到索引</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p></li><li>LIKE查询，<code>%</code> 不能在前<p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">WHERE</span> name <span class="token operator">LIKE</span> <span class="token string">"%wang%"</span><span class="token comment"># 以上语句用不到索引，可以用外部的 ElasticSearch、Lucene 等全文搜索引擎替代。</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></p></li><li><p>列值为空（NULL）时是可以使用索引的，但 MySQL 难以优化引用了可空列的查询，它会使索引、索引统计和值更加复杂。可空列需要更多的储存空间，还需要在 MySQL 内部进行特殊处理。</p></li><li><p>如果 MySQL 估计使用索引比全表扫描更慢，会放弃使用索引。</p><p>例如：表中只有 100 条数据左右。对于 SQL 语句 <code>WHERE id &gt; 1 AND id &lt; 100</code>，MySQL 会优先考虑全表扫描。</p></li><li><p>如果关键词 <code>OR</code> 前面的条件中的列有索引，后面的没有，所有列的索引都不会被用到。</p></li><li><p>列类型是字符串，查询时一定要给值加引号，否则索引失效。</p><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token comment"># 列 name VARCHAR(16)，存储了字符串 "100"。</span><span class="token keyword">WHERE</span> name <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span><span class="token comment"># 以上SQL语句能搜到，但无法用到索引。</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></p></li></ul><p><strong>MySQL索引的原理</strong></p><p>MySQL 索引是用一种叫做聚簇索引的数据结构实现的，下面我们就来看一下什么是聚簇索引。</p><p>聚簇索引是一种数据存储方式，它实际上是在同一个结构中保存了 B+ 树索引和数据行，InnoDB 表是按照聚簇索引组织的（类似于 Oracle 的索引组织表）。</p><p>InnoDB 通过主键聚簇数据，如果没有定义主键，会选择一个唯一的非空索引代替，如果没有这样的索引，会隐式定义个主键作为聚簇索引。</p><p><strong>注：</strong></p><ul><li>B+ 树是一种树数据结构，是一个 n 叉排序树，每个节点通常有多个孩子，一棵 B+ 树包含根节点、内部节点和叶子节点。根节点可能是一个叶子节点，也可能是一个包含两个或两个以上孩子节点的节点。</li><li>B+ 树通常用于数据库和操作系统的文件系统中。NTFS、ReiserFS、NSS、XFS、JFS、ReFS 和 BFS 等文件系统都在使用 B+ 树作为元数据索引。B+ 树的特点是能够保持数据稳定有序，其插入与修改拥有较稳定的对数时间复杂度。B+ 树元素自底向上插入。</li></ul><blockquote><h3 id="列值为-NULL-时，查询是否会用到索引？"><a href="#列值为-NULL-时，查询是否会用到索引？" class="headerlink" title="列值为 NULL 时，查询是否会用到索引？"></a>列值为 NULL 时，查询是否会用到索引？</h3></blockquote><p>在 MySQL 里 NULL 值的列也是走索引的。当然，如果计划对列进行索引，就要尽量避免把它设置为可空，MySQL 难以优化引用了可空列的查询，它会使索引、索引统计和值更加复杂。</p><blockquote><h3 id="以下语句是否会应用索引：SELECT-FROM-users-WHERE-YEAR-adddate-lt-2007"><a href="#以下语句是否会应用索引：SELECT-FROM-users-WHERE-YEAR-adddate-lt-2007" class="headerlink" title="以下语句是否会应用索引：SELECT FROM users WHERE YEAR(adddate) &lt; 2007;"></a>以下语句是否会应用索引：SELECT FROM users WHERE YEAR(adddate) &lt; 2007;</h3></blockquote><p>不会，因为只要列涉及到运算，MySQL 就不会使用索引。</p><blockquote><h3 id="MyISAM索引实现？"><a href="#MyISAM索引实现？" class="headerlink" title="MyISAM索引实现？"></a>MyISAM索引实现？</h3></blockquote><p>MyISAM 存储引擎使用 B+Tree 作为索引结构，叶节点的 data 域存放的是数据记录的地址。MyISAM 的索引方式也叫做非聚簇索引的，之所以这么称呼是为了与 InnoDB 的聚簇索引区分。</p><blockquote><h3 id="MyISAM索引与InnoDB索引的区别？"><a href="#MyISAM索引与InnoDB索引的区别？" class="headerlink" title="MyISAM索引与InnoDB索引的区别？"></a>MyISAM索引与InnoDB索引的区别？</h3></blockquote><ul><li>InnoDB 索引是聚簇索引，MyISAM 索引是非聚簇索引。</li><li>InnoDB 的主键索引的叶子节点存储着行数据，因此主键索引非常高效。</li><li>MyISAM 索引的叶子节点存储的是行数据地址，需要再寻址一次才能得到数据。</li><li>InnoDB 非主键索引的叶子节点存储的是主键和其他带索引的列数据，因此查询时做到覆盖索引会非常高效。</li></ul><blockquote><h3 id="有-A-id-sex-par-c1-c2-、B-id-age-c1-c2-两张表，其中-A-id-与-B-id-关联，现在要求写出一条-SQL-语句，将-B-中-age-gt-50-的记录的-c1，c2-更新到-A-表中同一记录中的-c1，c2-字段中"><a href="#有-A-id-sex-par-c1-c2-、B-id-age-c1-c2-两张表，其中-A-id-与-B-id-关联，现在要求写出一条-SQL-语句，将-B-中-age-gt-50-的记录的-c1，c2-更新到-A-表中同一记录中的-c1，c2-字段中" class="headerlink" title="有 A(id, sex, par, c1, c2)、B(id, age, c1, c2) 两张表，其中 A.id 与 B.id 关联，现在要求写出一条 SQL 语句，将 B 中 age&gt;50 的记录的 c1，c2 更新到 A 表中同一记录中的 c1，c2 字段中"></a>有 A(id, sex, par, c1, c2)、B(id, age, c1, c2) 两张表，其中 A.id 与 B.id 关联，现在要求写出一条 SQL 语句，将 B 中 age&gt;50 的记录的 c1，c2 更新到 A 表中同一记录中的 c1，c2 字段中</h3></blockquote><p><strong>考点分析</strong></p><p>这道题主要考察的是MySQL的关联UPDATE语句</p><p><strong>延伸考点</strong></p><ul><li>MySQL 的关联查询语句</li><li>MySQL 的关联UPDATE语句</li></ul><p>针对刚才这道题，答案可以是如下两种形式的写法：</p><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">UPDATE</span> A<span class="token punctuation">,</span> B <span class="token keyword">SET</span> A<span class="token punctuation">.</span>c1 <span class="token operator">=</span> B<span class="token punctuation">.</span>c1<span class="token punctuation">,</span> A<span class="token punctuation">.</span>c2 <span class="token operator">=</span> B<span class="token punctuation">.</span>c2 <span class="token keyword">WHERE</span> A<span class="token punctuation">.</span>id <span class="token operator">=</span> B<span class="token punctuation">.</span>id<span class="token punctuation">;</span><span class="token keyword">UPDATE</span> A <span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> B <span class="token keyword">ON</span> A<span class="token punctuation">.</span>id <span class="token operator">=</span> B<span class="token punctuation">.</span>id <span class="token keyword">SET</span> A<span class="token punctuation">.</span>c1 <span class="token operator">=</span> B<span class="token punctuation">.</span>c1<span class="token punctuation">,</span> A<span class="token punctuation">.</span>c2 <span class="token operator">=</span> B<span class="token punctuation">.</span>c2<span class="token punctuation">;</span><span class="token comment"># 再加上 B 中 age > 50的条件：</span><span class="token keyword">UPDATE</span> A<span class="token punctuation">,</span> B <span class="token keyword">set</span> A<span class="token punctuation">.</span>c1 <span class="token operator">=</span> B<span class="token punctuation">.</span>c1<span class="token punctuation">,</span> A<span class="token punctuation">.</span>c2 <span class="token operator">=</span> B<span class="token punctuation">.</span>c2 <span class="token keyword">WHERE</span> A<span class="token punctuation">.</span>id <span class="token operator">=</span> B<span class="token punctuation">.</span>id <span class="token operator">and</span> B<span class="token punctuation">.</span>age <span class="token operator">></span> <span class="token number">50</span><span class="token punctuation">;</span><span class="token keyword">UPDATE</span> A <span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> B <span class="token keyword">ON</span> A<span class="token punctuation">.</span>id <span class="token operator">=</span> B<span class="token punctuation">.</span>id <span class="token keyword">set</span> A<span class="token punctuation">.</span>c1 <span class="token operator">=</span> B<span class="token punctuation">.</span>c1<span class="token punctuation">,</span> A<span class="token punctuation">.</span>c2 <span class="token operator">=</span> B<span class="token punctuation">.</span>c2 <span class="token keyword">WHERE</span> B<span class="token punctuation">.</span>age <span class="token operator">></span> <span class="token number">50</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><blockquote><h3 id="MySQL-的关联查询语句"><a href="#MySQL-的关联查询语句" class="headerlink" title="MySQL 的关联查询语句"></a>MySQL 的关联查询语句</h3></blockquote><ul><li>交叉连接（CROSS JOIN）</li><li>内连接（INNER JOIN）</li><li>外连接（LEFT JOIN 或 RIGHT JOIN）</li><li>联合查询（UNION 与 UNION ALL）</li><li>全连接（FULL JOIN）</li><li>嵌套查询</li></ul><p><strong>交叉连接（CROSS JOIN）</strong><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> A<span class="token punctuation">,</span> B<span class="token punctuation">(</span><span class="token punctuation">,</span>C<span class="token punctuation">)</span><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> A <span class="token keyword">CROSS</span> <span class="token keyword">JOIN</span> B <span class="token punctuation">(</span><span class="token keyword">CROSS</span> <span class="token keyword">JOIN</span> C<span class="token punctuation">)</span><span class="token comment"># 没有任何关联条件，结果是笛卡尔积，结果集会很大，没有意义，很少使用</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><strong>内连接（INNER JOIN）</strong><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> A<span class="token punctuation">,</span> B <span class="token keyword">WHERE</span> A<span class="token punctuation">.</span>id <span class="token operator">=</span> B<span class="token punctuation">.</span>id<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> A <span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> B <span class="token keyword">ON</span> A<span class="token punctuation">.</span>id <span class="token operator">=</span> B<span class="token punctuation">.</span>id<span class="token comment"># 多表中同时符合某种条件的数据记录的集合，INNER JOIN 可以缩写为 JOIN</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>内连接分为三类</p><ul><li>等值连接：<code>ON A.id = B.id</code></li><li>不等值连接：<code>ON A.id &gt; B.id</code></li><li>自连接：<code>SELECT * FROM A T1 INNER JOIN A T2 ON T1.id=T2.pid</code></li></ul><p><strong>外连接（LEFT JOIN 或 RIGHT JOIN）</strong></p><ul><li>左外连接：<code>LEFT OUTER JOIN</code>，以左表为主，先查询出左表，按照 <code>ON</code> 后的关联条件匹配右表，没有匹配到的用 NULL 填充，可以简写成 <code>LEFT JOIN</code>。</li><li>右外连接：<code>RIGHT OUTER JOIN</code>，以右表为主，先查询出右表，按照 <code>ON</code> 后的关联条件匹配左表，没有匹配到的用 NULL 填充，可以简写成 <code>RIGHT JOIN</code>。</li></ul><p><strong>联合查询（UNION 与 UNION ALL）</strong></p><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> A <span class="token keyword">UNION</span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> B <span class="token keyword">UNION</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><ul><li>就是把多个结果集集中在一起，<code>UNION</code> 前的结果为基准，需要注意的是联合查询的列数要相等，相同的记录行会合并</li><li>如果使用 <code>UNION ALL</code>，不会合并重复的记录行</li><li>效率 <code>UNION</code> 高于 <code>UNION ALL</code></li></ul><p><strong>全连接（FULL JOIN）</strong></p><p>MySQL 不支持全连接</p><p>可以使用 <code>LEFT JOIN</code> 和 <code>UNION</code> 和 <code>RIGHT JOIN</code> 联合使用</p><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> A <span class="token keyword">LEFT</span> <span class="token keyword">JOIN</span> B <span class="token keyword">ON</span> A<span class="token punctuation">.</span>id<span class="token operator">=</span>B<span class="token punctuation">.</span>id <span class="token keyword">UNION</span><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> A <span class="token keyword">RIGHT</span> <span class="token keyword">JOIN</span> B <span class="token keyword">ON</span> A<span class="token punctuation">.</span>id<span class="token operator">=</span>B<span class="token punctuation">.</span>id<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></p><p><strong>嵌套查询</strong></p><p>用一条 SQL 语句的结果作为另外一条 SQL 语句的条件，效率不好把握。</p><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> A <span class="token keyword">WHERE</span> id <span class="token operator">IN</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> id <span class="token keyword">FROM</span> B<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><p><strong>解题方法</strong></p><p>根据考题要搞清楚表的结果和多表之间的关系，根据想要的结果思考使用那种关联方式，通常把要查询的列先写出来，然后分析这些列都属于哪些表，才考虑使用关联查询</p><blockquote><h3 id="MySQL-中-IN-和-EXISTS-区别"><a href="#MySQL-中-IN-和-EXISTS-区别" class="headerlink" title="MySQL 中 IN 和 EXISTS 区别"></a>MySQL 中 IN 和 EXISTS 区别</h3></blockquote><p>MySQL 中的 IN 语句是把外表和内表作 hash 连接，而 EXISTS 语句是对外表作 loop 循环，每次 loop 循环再对内表进行查询。一直大家都认为 EXISTS 比 IN 语句的效率要高，这种说法其实是不准确的。这个是要区分环境的。</p><ul><li>如果查询的两个表大小相当，那么用 IN 和 EXISTS 差别不大。</li><li>如果两个表中一个较小，一个是大表，则子查询表大的用 EXISTS ，子查询表小的用 IN。</li><li>NOT IN 和 NOT EXISTS：如果查询语句使用了 NOT IN，那么内外表都进行全表扫描，没有用到索引；而 NOT EXISTS 的子查询依然能用到表上的索引。所以无论那个表大，用 NOT EXISTS 都比 NOT IN 要快。</li></ul><blockquote><h3 id="一个-6-亿的表-A，一个-3-亿的表-B，通过外键-tid-关联，你如何最快的查询出满足条件的第-50000-到第-50200-中的这-200-条数据记录。"><a href="#一个-6-亿的表-A，一个-3-亿的表-B，通过外键-tid-关联，你如何最快的查询出满足条件的第-50000-到第-50200-中的这-200-条数据记录。" class="headerlink" title="一个 6 亿的表 A，一个 3 亿的表 B，通过外键 tid 关联，你如何最快的查询出满足条件的第 50000 到第 50200 中的这 200 条数据记录。"></a>一个 6 亿的表 A，一个 3 亿的表 B，通过外键 tid 关联，你如何最快的查询出满足条件的第 50000 到第 50200 中的这 200 条数据记录。</h3></blockquote><ul><li>如果 A 表 TID 是自增长，并且是连续的，B 表的 ID 为索引<p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> a<span class="token punctuation">,</span> b <span class="token keyword">WHERE</span> a<span class="token punctuation">.</span>tid <span class="token operator">=</span> b<span class="token punctuation">.</span>id <span class="token operator">AND</span> a<span class="token punctuation">.</span>tid <span class="token operator">></span> <span class="token number">50000</span> <span class="token keyword">LIMIT</span> <span class="token number">200</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p></li><li>如果 A 表的 TID 不是连续的，那么就需要使用覆盖索引，tid 要么是主键，要么是辅助索引，B 表 id 也需要有索引。<p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> b<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> tid <span class="token keyword">FROM</span> a <span class="token keyword">LIMIT</span> <span class="token number">50000</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">)</span> a <span class="token keyword">WHERE</span> b<span class="token punctuation">.</span>id <span class="token operator">=</span> a <span class="token punctuation">.</span>tid<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p></li></ul><blockquote><h3 id="拷贝表（拷贝数据，源表名：a-，目标表名：b）"><a href="#拷贝表（拷贝数据，源表名：a-，目标表名：b）" class="headerlink" title="拷贝表（拷贝数据，源表名：a ，目标表名：b）"></a>拷贝表（拷贝数据，源表名：a ，目标表名：b）</h3></blockquote><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> b<span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c<span class="token punctuation">)</span> <span class="token keyword">SELECT</span> d<span class="token punctuation">,</span> e<span class="token punctuation">,</span> f <span class="token keyword">FROM</span> a<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><blockquote><h3 id="Student-S-Sname-Sage-Ssex-学生表-Course-C-Cname-T-课程表-SC-S-C-score-成绩表-Teacher-T-Tname-教师表，查询没学过“叶平”老师课的同学的学号、姓名"><a href="#Student-S-Sname-Sage-Ssex-学生表-Course-C-Cname-T-课程表-SC-S-C-score-成绩表-Teacher-T-Tname-教师表，查询没学过“叶平”老师课的同学的学号、姓名" class="headerlink" title="Student(S#, Sname, Sage, Ssex) 学生表 Course(C#, Cname, T#) 课程表 SC(S#, C#, score) 成绩表 Teacher(T#, Tname) 教师表，查询没学过“叶平”老师课的同学的学号、姓名"></a>Student(S#, Sname, Sage, Ssex) 学生表 Course(C#, Cname, T#) 课程表 SC(S#, C#, score) 成绩表 Teacher(T#, Tname) 教师表，查询没学过“叶平”老师课的同学的学号、姓名</h3></blockquote><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> Student<span class="token punctuation">.</span>S<span class="token comment">#, Student.Sname</span>  <span class="token keyword">FROM</span> Student <span class="token keyword">WHERE</span> S<span class="token comment"># NOT IN (SELECT DISTINCT (SC.S#)</span>                    <span class="token keyword">FROM</span> SC<span class="token punctuation">,</span> Course<span class="token punctuation">,</span> Teacher                   <span class="token keyword">WHERE</span> SC<span class="token punctuation">.</span>C<span class="token comment"># = Course.C#</span>                     <span class="token operator">AND</span> Teacher<span class="token punctuation">.</span>T<span class="token comment"># = Course.T#</span>                     <span class="token operator">AND</span> Teacher<span class="token punctuation">.</span>Tname <span class="token operator">=</span> <span class="token string">'叶平'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><blockquote><h3 id="随机取出-10-条数据"><a href="#随机取出-10-条数据" class="headerlink" title="随机取出 10 条数据"></a>随机取出 10 条数据</h3></blockquote><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token operator">*</span>  <span class="token keyword">FROM</span> users <span class="token keyword">WHERE</span> id <span class="token operator">>=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">SELECT</span> <span class="token function">MAX</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span> <span class="token keyword">FROM</span> users<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> <span class="token function">MIN</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span> <span class="token keyword">FROM</span> users<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">*</span>       RAND<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> <span class="token function">MIN</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span> <span class="token keyword">FROM</span> users<span class="token punctuation">)</span> <span class="token keyword">LIMIT</span> <span class="token number">10</span><span class="token comment"># 此方法效率比直接用 SELECT * FROM users ORDER BY RAND() LIMIT 10 高很多</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><blockquote><h3 id="请简述项目中优化-SQL-语句执行效率的方法，从哪些方面，SQL-语句性能如何分析？"><a href="#请简述项目中优化-SQL-语句执行效率的方法，从哪些方面，SQL-语句性能如何分析？" class="headerlink" title="请简述项目中优化 SQL 语句执行效率的方法，从哪些方面，SQL 语句性能如何分析？"></a>请简述项目中优化 SQL 语句执行效率的方法，从哪些方面，SQL 语句性能如何分析？</h3></blockquote><p><strong>考点分析</strong></p><p>这道题主要考察的是查找分析 SQL 语句查询速度慢的方法</p><p><strong>延伸考点</strong></p><ul><li>优化查询过程中的数据访问</li><li>优化长难的查询语句</li><li>优化特定类型的查询语句</li></ul><p><strong>如何查找查询速度慢的原因</strong></p><p>记录慢查询日志，分析查询日志，不要直接打开慢查询日志进行分析，这样比较浪费时间和精力，可以使用 pt-query-digest 工具进行分析。</p><ul><li>使用 <code>show profile</code><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">set</span> profiling<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token comment"># 开启，服务器上所有执行语句会记录执行时间，存到临时表中</span><span class="token keyword">show</span> profiles<span class="token keyword">show</span> profile <span class="token keyword">for</span> query 临时表ID<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></p></li><li>使用 <code>show status</code><code>show status</code> 会返回一些计数器，<code>show global status</code> 会查看所有服务器级别的所有计数，有时根据这些计数，可以推测出哪些操作代价较高或者消耗时间多。</li><li><code>show processlist</code>观察是否有大量线程处于不正常的状态或特征</li></ul><p><img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="/images/post/bigdata_interview/mysql_precesslist.png" alt></p><ul><li>使用 <code>explain</code> 分析单条 SQL 语句</li></ul><p><img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="/images/post/bigdata_interview/mysql_explain.png" alt></p><p><strong>id</strong> 由一组数字组成。表示一个查询中各个子查询的执行顺序。</p><ul><li>id 相同执行顺序由上至下。</li><li>id 不同，id 值越大优先级越高，越先被执行。</li><li>id 为 NULL 时表示一个结果集，不需要使用它查询，常出现在包含 UNION 等查询语句中。</li></ul><p><strong>select_type</strong> 每个子查询的查询类型，一些常见的查询类型。</p><div class="table-container"><table><thead><tr><th>id</th><th>select_type</th><th>description</th></tr></thead><tbody><tr><td>1</td><td>SIMPLE</td><td>不包含任何子查询或 UNION 等查询</td></tr><tr><td>2</td><td>PRIMARY</td><td>包含子查询最外层查询就显示为 PRIMARY</td></tr><tr><td>3</td><td>SUBQUERY</td><td>在 SELECT 或 WHERE 子句中包含的查询</td></tr><tr><td>4</td><td>DERIVED</td><td>FROM 子句中包含的查询</td></tr><tr><td>5</td><td>UNION</td><td>出现在 UNION 后的查询语句中</td></tr><tr><td>6</td><td>UNION RESULT</td><td>从 UNION 中获取结果集</td></tr></tbody></table></div><p><strong>type</strong> 访问类型（非常重要，可以看到有没有走索引）</p><ul><li>ALL：扫描全表数据</li><li>index：遍历索引</li><li>range：索引范围查找</li><li>index_subquery：在子查询中使用 ref</li><li>unique_subquery：在子查询中使用 eq_ref</li><li>ref_or_null：对 NULL 进行索引的优化的 ref</li><li>fulltext：使用全文索引</li><li>ref：使用非唯一索引查找数据</li><li>eq_ref：在 JOIN 查询中使用 PRIMARY KEY 或 UNIQUE NOT NULL 索引关联。</li></ul><p><strong>possible_keys</strong> 可能使用的索引，注意不一定会使用。查询涉及到的字段上若存在索引，则该索引将被列出来。当该列为 NULL 时就要考虑当前的SQL是否需要优化了。</p><p><strong>key</strong> 显示 MySQL 在查询中实际使用的索引，若没有使用索引，显示为 NULL。查询中若使用了覆盖索引（索引的数据覆盖了需要查询的所有数据），则该索引仅出现在 key 列表中。</p><p><strong>key_length</strong> 索引长度</p><ul><li>ref 表示上述表的连接匹配条件，即哪些列或常量被用于查找索引列上的值</li><li>rows 返回估算的结果集数目，并不是一个准确的值。</li><li>extra 的信息非常丰富，常见的有：<ul><li>Using index 使用覆盖索引</li><li>Using where 使用了用where子句来过滤结果集</li><li>Using filesort 使用文件排序，使用非索引列进行排序时出现，非常消耗性能，尽量优化。</li><li>Using temporary 使用了临时表 sql优化的目标可以参考阿里开发手册</li></ul></li></ul><p><strong>推荐：</strong>SQL 性能优化的目标至少要达到 range 级别，要求是 ref 级别，如果可以是 consts 最好。</p><ul><li>consts：单表中最多只有一个匹配行（主键或者唯一索引），在优化阶段即可读取到数据。</li><li>ref：指的是使用普通的索引（normal index）。</li><li>range：对索引进行范围检索。</li></ul><p>反例：explain 表的结果，<code>type=index</code>，索引物理文件全扫描，速度非常慢，这个 index 级别比较 range 还低，与全表扫描是小巫见大巫。</p><p><strong>优化查询过程中的数据访问</strong></p><ul><li>访问数据太多导致查询性能下降</li><li>确定应用程序是否在检索大量超过需要的数据，可能是太多行或列</li><li>确认 MySQL 服务器是否在分析大量不必要的数据行</li><li>避免犯如下 SQL 语句错误<ul><li>查询不需要的数据。解决办法：使用 LIMIT 解决。</li><li>多表关联返回全部列。解决办法：指定列名。</li><li>总是返回全部列。解决办法：避免使用 SELECT *。</li></ul></li><li>重复查询相同的数据。解决办法：可以缓存数据，下次直接读取缓存。</li><li>是否在扫描额外的记录。解决办法：使用explain进行分析，如果发现查询需要扫描大量的数据，但只返回少数的行。</li><li>使用索引覆盖扫描，把所有的列都放到索引中，这样存储引擎不需要回表获取对应行就可以返回结果。</li><li>改变数据库和表的结构，修改数据表范式。</li><li>重写SQL语句，让优化器可以以更优的方式执行查询。</li></ul><p><strong>优化长难的查询语句</strong></p><ul><li>一个复杂查询还是多个简单查询。</li><li>MySQL 内部每秒能扫描内存中上百万行数据，相比之下，响应数据给客户端就要慢得多。</li><li>使用尽可能小的查询是好的，但是有时将一个大的查询分解为多个小的查询是很有必要的。</li><li>切分查询，将一个大的查询分为多个小的相同的查询。</li><li>一次性删除 1000 万的数据要比一次删除 1 万快，暂停一会的方案更加损耗服务器开销。</li><li>分解关联查询，让缓存的效率更高。</li><li>执行单个查询可以减少锁的竞争。</li><li>在应用层做关联更容易对数据库进行拆分。</li><li>查询效率会有大幅提升。</li><li>较少冗余记录的查询。</li></ul><p><strong>优化特定类型的查询语句</strong></p><ul><li>COUNT(*) 会忽略所有的列，直接统计所有列数，不要使用 COUNT(列名)。</li><li>MyISAM 中，没有任何 WHERE 条件的 COUNT(*) 非常快。</li><li>当有 WHERE 条件时，MyISAM 的 COUNT 统计不一定比其它引擎快。</li><li>可以使用 <code>explain</code> 查询近似值，用近似值替代 COUNT(*)。</li><li>增加汇总表。</li><li>使用缓存。</li></ul><p><strong>优化关联查询</strong></p><ul><li>确定 ON 或者 USING 子句中是否有索引。</li><li>确保 GROUP BY 和 ORDER BY 只有一个表中的列，这样 MySQL 才有可能使用索引。</li></ul><p><strong>优化子查询</strong></p><ul><li>用关联查询替代。</li><li>优化 GROUP BY 和 DISTINCT。</li><li>这两种查询可以使用索引来优化，是最有效的优化方法。</li><li>关联查询中，使用标识列分组的效率更高。</li><li>如果不需要 ORDER BY，进行 GROUP BY 时加 ORDER BY NULL，MySQL 不会再进行文件排序。</li><li>WITH ROLLUP 超级聚合，可以挪到应用程序处理。</li></ul><p><strong>优化 LIMIT 分页</strong></p><ul><li>LIMIT 偏移量大的时候，查询效率较低</li><li>可以记录上次查询的最大 ID，下次查询时直接根据该 ID 来查询</li></ul><p><strong>优化 UNION 查询</strong></p><ul><li>UNION ALL 的效率高于 UNION</li></ul><p><strong>解题方法</strong></p><p>对于此类考题，先说明如何定位低效 SQL 语句，然后根据 SQL 语句可能低效的原因做排查，先从索引着手，如果索引没有问题，考虑以上几个方面，数据访问的问题，长难查询句的问题还是一些特定类型优化的问题，逐一回答。</p><blockquote><h3 id="SQL-语句优化的一些方法？"><a href="#SQL-语句优化的一些方法？" class="headerlink" title="SQL 语句优化的一些方法？"></a>SQL 语句优化的一些方法？</h3></blockquote><ul><li>对查询进行优化，应尽量避免全表扫描，首先应考虑在 WHERE 及 ORDER BY 涉及的列上建立索引。</li><li><p>应尽量避免在 WHERE 子句中对字段进行 NULL 值判断，否则将导致引擎放弃使用索引而进行全表扫描，如：</p><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> id <span class="token keyword">FROM</span> t <span class="token keyword">WHERE</span> num <span class="token operator">is</span> <span class="token boolean">NULL</span><span class="token comment"># 可以在 num 上设置默认值 0，确保表中 num 列没有 NULL值，然后这样查询：</span><span class="token keyword">SELECT</span> id <span class="token keyword">FROM</span> t <span class="token keyword">WHERE</span> num <span class="token operator">=</span> <span class="token number">0</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></p></li><li><p>应尽量避免在 WHERE 子句中使用 <code>!=</code> 或 <code>&lt;&gt;</code> 操作符，否则引擎将放弃使用索引而进行全表扫描。</p></li><li><p>应尽量避免在 WHERE 子句中使用 OR 来连接条件，否则将导致引擎放弃使用索引而进行全表扫描，如：</p><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> id <span class="token keyword">FROM</span> t <span class="token keyword">WHERE</span> num <span class="token operator">=</span> <span class="token number">10</span> <span class="token operator">OR</span> num <span class="token operator">=</span> <span class="token number">20</span><span class="token comment"># 可以这样查询：</span><span class="token keyword">SELECT</span> id <span class="token keyword">FROM</span> t <span class="token keyword">WHERE</span> num <span class="token operator">=</span> <span class="token number">10</span> <span class="token keyword">UNION</span> <span class="token keyword">ALL</span> <span class="token keyword">SELECT</span> id <span class="token keyword">FROM</span> t <span class="token keyword">WHERE</span> num <span class="token operator">=</span> <span class="token number">20</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></p></li><li><p>IN 和 NOT IN 也要慎用，否则会导致全表扫描，如：</p><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> id <span class="token keyword">FROM</span> t <span class="token keyword">WHERE</span> num <span class="token operator">IN</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span> 对于连续的数值，能用 <span class="token operator">BETWEEN</span> 就不要用 <span class="token operator">IN</span> 了：<span class="token keyword">SELECT</span> id <span class="token keyword">FROM</span> t <span class="token keyword">WHERE</span> num <span class="token operator">BETWEEN</span> <span class="token number">1</span> <span class="token operator">AND</span> <span class="token number">3</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></p></li><li><p>下面的查询也将导致全表扫描：<code>SELECT id FROM t WHERE name LIKE &#39;%李%&#39;</code> 若要提高效率，可以考虑全文检索。</p></li><li><p>如果在 WHERE 子句中使用参数，也会导致全表扫描。因为 SQL 只有在运行时才会解析局部变量，但优化程序不能将访问计划的选择推迟到运行时；它必须在编译时进行选择。然而，如果在编译时建立访问计划，变量的值还是未知的，因而无法作为索引选择的输入项。如下面语句将进行全表扫描：</p><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> id <span class="token keyword">FROM</span> t <span class="token keyword">WHERE</span> num<span class="token operator">=</span><span class="token variable">@num</span>可以改为强制查询使用索引：<span class="token keyword">SELECT</span> id <span class="token keyword">FROM</span> t <span class="token keyword">WITH</span><span class="token punctuation">(</span><span class="token keyword">INDEX</span><span class="token punctuation">(</span>索引名<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">WHERE</span> num<span class="token operator">=</span><span class="token variable">@num</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></p></li><li>应尽量避免在 WHERE 子句中对字段进行表达式操作，这将导致引擎放弃使用索引而进行全表扫描。如：<p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> id <span class="token keyword">FROM</span> t <span class="token keyword">WHERE</span> num<span class="token operator">/</span><span class="token number">2</span><span class="token operator">=</span><span class="token number">100</span><span class="token comment"># 应改为:</span><span class="token keyword">SELECT</span> id <span class="token keyword">FROM</span> t <span class="token keyword">WHERE</span> num<span class="token operator">=</span><span class="token number">100</span><span class="token operator">*</span><span class="token number">2</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></p></li><li>应尽量避免在 WHERE 子句中对字段进行函数操作，这将导致引擎放弃使用索引而进行全表扫描。如：<p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> id <span class="token keyword">FROM</span> t <span class="token keyword">WHERE</span> substring<span class="token punctuation">(</span>name<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token string">'abc'</span>以 abc 开头的 id 应改为:<span class="token keyword">SELECT</span> id <span class="token keyword">FROM</span> t <span class="token keyword">WHERE</span> name <span class="token operator">LIKE</span> <span class="token string">'abc%'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></p></li><li>不要在 WHERE 子句中的 <code>=</code> 左边进行函数、算术运算或其他表达式运算，否则系统将可能无法正确使用索引。</li></ul>]]></content>
      
      
      <categories>
          
          <category> 教程笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 大数据 </tag>
            
            <tag> 面试题 </tag>
            
            <tag> MySQL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Sqoop 面试题解析</title>
      <link href="post/420614eb.html"/>
      <url>post/420614eb.html</url>
      
        <content type="html"><![CDATA[<blockquote><h3 id="Sqoop-参数"><a href="#Sqoop-参数" class="headerlink" title="Sqoop 参数"></a>Sqoop 参数</h3></blockquote><p><strong>Sqoop 导入数据到 HDFS 中的参数</strong></p><p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">&#x2F;opt&#x2F;module&#x2F;sqoop&#x2F;bin&#x2F;sqoop import \--connect jdbc的url字符串\--username 账号\--password 密码\# HDFS 目标的目录--target-dir \# 导入的目标目录如果存在则删除那个目录--delete-target-dir \# 相当于 -m，并行导入时 MapTask 的个数--num-mappers \--fields-terminated-by \# 指定满足 sql 和条件的数据导入# --query：增加检索条件部分数据抽取# $CONDITIONS：数据分割条件的占位符--query &quot;$2&quot; &#39;and $CONDITIONS;&#39;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p><strong>Sqoop 导入数据到 Hive 中的参数</strong></p><p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"># 一步将表结构和数据都导入到 hive 中bin&#x2F;sqoop import \--connect jdbc的url字符串\--table mysql中的表名\--username 账号\--password 密码\--hive-import \--m MapTask的个数 \--hive-database hive中的数据库名 \<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p><strong>RDBMS 中的增量数据如何导入</strong></p><p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"># 指定判断检查的依据字段--check-column 字段名 \# 用来指定增量当如的模式（Mode），append 和 lastmodified--incremental 导入模式 \--last-value 上一次导入结束的时间 \--m MapTask的个数 \--merge-key 主键<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p><strong>补充：</strong>使用 <code>--merge-key</code> 合并模式，如果是新增的数据则增加，因为 <code>incremental</code> 是 <code>lastmodified</code> 模式，那么当有数据更新了，而主键没有变，则会进行合并。</p><p><code>--check-column</code> 字段名：当数据更新和修改，这个字段的时间也要随之变化，MySQL 中建表时，该字段修饰符、字段名 <code>timeatamp default current_timestamp on update current_timestamp</code></p><blockquote><h3 id="Sqoop-导入导出-NULL-存储一致性问题"><a href="#Sqoop-导入导出-NULL-存储一致性问题" class="headerlink" title="Sqoop 导入导出 NULL 存储一致性问题"></a>Sqoop 导入导出 NULL 存储一致性问题</h3></blockquote><p>Hive 中的 NULL 在底层是以 <code>\N</code> 来存储的，而 MySQL 中的 NULL 在底层就是 NULL</p><p>为了保证数据两端的一致性</p><ul><li>在导出数据时采用 <code>--input-null-string</code> 和 <code>--input-null-non-string</code> 两个参数</li><li>在导入数据时采用 <code>--null-string</code> 和 <code>--null-non-string</code></li></ul><blockquote><h3 id="Sqoop数据导出一致性问题"><a href="#Sqoop数据导出一致性问题" class="headerlink" title="Sqoop数据导出一致性问题"></a>Sqoop数据导出一致性问题</h3></blockquote><p><strong>场景：</strong></p><p>如果 Sqoop 在导出数据到 MySQL 时，使用 4 个 Map 任务，过程中有 2 个任务失败，此时 MySQL 中存储了另外两个 Map 任务导入的数据，但是此时老板正好看到了这个报表数据。而开发工程师发现任务失败后，会调试问题并最终将全部数据正确的导入到 MySQL，那在后面老板再次看报表数据时，发现本次看到的数据与之前的不一致，这在生产环境中式不允许的。</p><p><strong>解决方案一：</strong></p><p>因为 Sqoop 将导出过程分解为多个事务，所以一个失败的导出作业可能会导致部分数据被提交到数据库。在某些情况下，这可能进一步导致后续作业由于插入冲突而失败，或者在其他情况下导致重复数据。您可以通过 <code>--stage-table</code> 选项指定一个暂存表（staging）来解决这个问题，这个表充当一个辅助表，用于暂存导出的数据。阶段数据最终在一个事务中移动到目标表。</p><blockquote><p>官网：<a href="http://sqoop.apache.org/docs/1.4.6/SqoopUserGuide.html">http://sqoop.apache.org/docs/1.4.6/SqoopUserGuide.html</a><br>Since Sqoop breaks down export process into multiple transactions, it is possible that a failed export job may result in partial data being committed to the database. This can further lead to subsequent jobs failing due to insert collisions in some cases, or lead to duplicated data in others. You can overcome this problem by specifying a staging table via the --staging-table option which acts as an auxiliary table that is used to stage exported data. The staged data is finally moved to the destination table in a single transaction.</p></blockquote><p>使用 <code>--stage-table</code> 选项，将 HDFS 中的数据先导入到辅助表中，当 HDFS 中的数据导出成功后，辅助表中的数据在一个事务中导出到目标表中（也就是说，这个过程要么完全成功，要么完全失败）</p><p>为了能够使用 staging 这个选项，staging 表在运行任务前可能是空的，如果不为空就使用 <code>--clear-staging-table</code> 配置</p><p>如果 staging 表中有数据，并且使用了 <code>--clear-staging-table</code> 选项，Sqoop 执行导出任务前会删除 staging 表中所有的数据</p><p><strong>注意：</strong><code>--direct</code> 导入时 staging 方式是不可用的，使用了 <code>--update-key</code> 选项时 staging 方式也不可用</p><p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">sqoop export \--connect url \--username root \--password 123456 \--table app_cource_study_report \--columns watch_video_cnt,complete_video_cnt,dt \--fields-terminated-by &quot;\t&quot; \--export-dir &quot;&#x2F;user&#x2F;hive&#x2F;warehouse&#x2F;tmp.db&#x2F;app_cource_study_analysis_$&#123;day&#125;&quot; \--staging-table app_cource_study_report_tmp \--clear-staging-table \--input-null-string &#39;\\N&#39; \--null-non-string &#39;\\N&#39;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p><strong>解决方案二：</strong></p><p>设置 map 数量为 1 个（不推荐，面试官想要的答案不是这个）。</p><p>多个 Map 任务时，采用 <code>--staging-table</code> 方式，仍然可以解决数据一致性问题。</p><blockquote><h3 id="Sqoop底层运行的任务是什么？"><a href="#Sqoop底层运行的任务是什么？" class="headerlink" title="Sqoop底层运行的任务是什么？"></a>Sqoop底层运行的任务是什么？</h3></blockquote><p>只有 Map 阶段，没有 Reduce 阶段的任务。默认是 4 个 MapTask。</p><blockquote><h3 id="MapTask-并行度设置大于-1-的问题？"><a href="#MapTask-并行度设置大于-1-的问题？" class="headerlink" title="MapTask 并行度设置大于 1 的问题？"></a>MapTask 并行度设置大于 1 的问题？</h3></blockquote><p>并行度导入数据的时候需要指定根据哪个字段进行切分，该字段通常是主键或者是自增长不重复的数值类型字段，否则会报下面的错误：</p><p><code>Import failed: No primary key could be found for table. Please specify one with --split-by or perform a sequential import with &#39;-m 1&#39;.</code></p><p>那么就是说当 MapTask 并行度大于 1 时，下面两个参数要同时使用：</p><ul><li><code>--split-by id</code>：指定根据 id 字段进行切分；</li><li><code>--m n</code>：指定 map 并行度 n 个。</li></ul><blockquote><h3 id="Sqoop-一天导入多少数据？"><a href="#Sqoop-一天导入多少数据？" class="headerlink" title="Sqoop 一天导入多少数据？"></a>Sqoop 一天导入多少数据？</h3></blockquote><p>每天 100 万活跃 --&gt; 10 万订单，1 人 10 条，每天 1g 左右业务数据</p><p>Sqoop 每天将 1G 的数据量导入到数仓</p><blockquote><h3 id="Sqoop数据导出的时候一次执行多长时间？"><a href="#Sqoop数据导出的时候一次执行多长时间？" class="headerlink" title="Sqoop数据导出的时候一次执行多长时间？"></a>Sqoop数据导出的时候一次执行多长时间？</h3></blockquote><p>每天晚上 00：30 开始执行，Sqoop 任务一般情况 40-50 分钟的都有，取决于数据量（11.11，6.18 等活动在 1 个小时左右）。</p><p>Sqoop 任务 5 分钟 ~ 2 小时的都有，取决于数据量。</p><blockquote><h3 id="Sqoop-在导入数据的时候数据倾斜？"><a href="#Sqoop-在导入数据的时候数据倾斜？" class="headerlink" title="Sqoop 在导入数据的时候数据倾斜？"></a>Sqoop 在导入数据的时候数据倾斜？</h3></blockquote><p>在说数据倾斜之前，我们设想数据并行抽数最理想的情况就是所有的并行实例同时完成，木桶原理，数据抽数时间的长短取决于耗时最长的那个实例。</p><p>由于各个实例被分配的数据量不均而导致分配到数据量较少的实例早早完成，而被分配大量数据的实例迟迟无法完成，导致整个作业运行时间很长的现象就是数据倾斜造成的。</p><p>数据倾斜概括为一句话：<strong>数据分配不均</strong>。</p><p>在数据表没有符合要求的字段的情况下，我们需要自己临时简单创建理想的字段：</p><p>Sqoop 抽数的并行化主要设计到两个参数：</p><ul><li><code>--num-mappers</code>：启动 n 个 map 来并行导入数据，默认 4 个；</li><li><code>--split-by</code>：按照某一列来切分表的工作单元。</li></ul><p>具体原理是通过 <code>ROWNUM()</code> 生成一个严格均匀分布的字段，然后指定为分割字段。</p><blockquote><h3 id="Sqoop-数据导出-Parquet（项目中遇到的问题）"><a href="#Sqoop-数据导出-Parquet（项目中遇到的问题）" class="headerlink" title="Sqoop 数据导出 Parquet（项目中遇到的问题）"></a>Sqoop 数据导出 Parquet（项目中遇到的问题）</h3></blockquote><p>ADS 层数据用 Sqoop 往 MySQL 中导入数据的时候，如果用了 ORC（Parquet）不能导入，需转化成 text 格式。</p><ol><li>创建临时表，把 Parquet 中表数据导入到临时表，把临时表导出到目标表用于可视化；</li><li>Sqoop 里面有参数，可以直接把 Parquet 转换为 text；</li><li>ADS 层建表的时候就不要建 Parquet 表。</li></ol>]]></content>
      
      
      <categories>
          
          <category> 教程笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 大数据 </tag>
            
            <tag> 面试题 </tag>
            
            <tag> Sqoop </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hive SQL 大全</title>
      <link href="post/7891b2e6.html"/>
      <url>post/7891b2e6.html</url>
      
        <content type="html"><![CDATA[<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>本文基本涵盖了 Hive 日常使用的所有 SQL，因为 SQL 太多，所以将 SQL 进行了如下分类：</p><ol><li><p><a href="#Hive-的-DDL-语法">DDL 语句</a>（数据定义语句）：</p><ol><li><a href="#对数据库的操作">对数据库的操作</a>：包含创建、修改数据库。</li><li><a href="#对数据表的操作">对数据表的操作</a>：分为内部表及外部表，分区表和分桶表。</li></ol></li><li><p><a href="#Hive-的-DQL-语法">DQL 语句</a>（数据查询语句）：</p><ol><li><a href="#单表查询、关联查询">单表查询、关联查询</a>。</li><li><a href="#Hive-函数">Hive 函数</a>：包含聚合函数，条件函数，日期函数，字符串函数等。</li><li><a href="#行转列及列转行">行转列及列转行</a>：lateral view 与 explode 以及 reflect。</li><li><a href="#窗口函数与分析函数">窗口函数与分析函数</a>。</li><li><a href="#其他一些窗口函数">其他一些窗口函数</a>。</li></ol></li></ol><h1 id="Hive-的-DDL-语法"><a href="#Hive-的-DDL-语法" class="headerlink" title="Hive 的 DDL 语法"></a>Hive 的 DDL 语法</h1><h2 id="对数据库的操作"><a href="#对数据库的操作" class="headerlink" title="对数据库的操作"></a>对数据库的操作</h2><h3 id="创建数据库"><a href="#创建数据库" class="headerlink" title="创建数据库"></a>创建数据库</h3><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">create</span> <span class="token keyword">database</span> <span class="token keyword">if</span> <span class="token operator">not</span> <span class="token keyword">exists</span> myhive<span class="token punctuation">;</span><span class="token comment"># 说明：hive 的表存放位置模式是由 hive-site.xml 当中的一个属性指定的：hive.metastore.warehouse.dir</span><span class="token comment"># 创建数据库并指定 HDFS 存储位置 :</span><span class="token keyword">create</span> <span class="token keyword">database</span> myhive2 location <span class="token string">'/myhive2'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h3 id="修改数据库"><a href="#修改数据库" class="headerlink" title="修改数据库"></a>修改数据库</h3><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">alter</span> <span class="token keyword">database</span> myhive2 <span class="token keyword">set</span> dbproperties<span class="token punctuation">(</span><span class="token string">'createtime'</span><span class="token operator">=</span><span class="token string">'20210329'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><p><strong>说明：</strong>可以使用 <code>alter database</code> 命令来修改数据库的一些属性。但是数据库的元数据信息是不可更改的，包括数据库的名称以及数据库所在的位置</p><h3 id="查看数据库信息"><a href="#查看数据库信息" class="headerlink" title="查看数据库信息"></a>查看数据库信息</h3><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token comment"># 查看数据库基本信息</span>hive <span class="token punctuation">(</span>myhive<span class="token punctuation">)</span><span class="token operator">></span> <span class="token keyword">desc</span> <span class="token keyword">database</span> myhive2<span class="token punctuation">;</span><span class="token comment"># 查看数据库更多详细信息</span>hive <span class="token punctuation">(</span>myhive<span class="token punctuation">)</span><span class="token operator">></span> <span class="token keyword">desc</span> <span class="token keyword">database</span> <span class="token keyword">extended</span> myhive2<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h3 id="删除数据库"><a href="#删除数据库" class="headerlink" title="删除数据库"></a>删除数据库</h3><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token comment"># 删除一个空数据库，如果数据库下面有数据表，那么就会报错</span><span class="token keyword">drop</span> <span class="token keyword">database</span> myhive2<span class="token punctuation">;</span><span class="token comment"># 强制删除数据库，包含数据库下面的表一起删除</span><span class="token keyword">drop</span> <span class="token keyword">database</span> myhive <span class="token keyword">cascade</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h2 id="对数据表的操作"><a href="#对数据表的操作" class="headerlink" title="对数据表的操作"></a>对数据表的操作</h2><h3 id="对管理表（内部表）的操作"><a href="#对管理表（内部表）的操作" class="headerlink" title="对管理表（内部表）的操作"></a>对管理表（内部表）的操作</h3><h4 id="建内部表"><a href="#建内部表" class="headerlink" title="建内部表"></a>建内部表</h4><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">hive <span class="token punctuation">(</span>myhive<span class="token punctuation">)</span><span class="token operator">></span> <span class="token keyword">use</span> myhive<span class="token punctuation">;</span> <span class="token comment">-- 使用myhive数据库</span>hive <span class="token punctuation">(</span>myhive<span class="token punctuation">)</span><span class="token operator">></span> <span class="token keyword">create</span> <span class="token keyword">table</span> stu<span class="token punctuation">(</span>id <span class="token keyword">int</span><span class="token punctuation">,</span>name string<span class="token punctuation">)</span><span class="token punctuation">;</span>hive <span class="token punctuation">(</span>myhive<span class="token punctuation">)</span><span class="token operator">></span> <span class="token keyword">insert</span> <span class="token keyword">into</span> stu <span class="token keyword">values</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"zhangsan"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>hive <span class="token punctuation">(</span>myhive<span class="token punctuation">)</span><span class="token operator">></span> <span class="token keyword">insert</span> <span class="token keyword">into</span> stu <span class="token keyword">values</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"zhangsan"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">"lisi"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">-- 一次插入多条数据</span>hive <span class="token punctuation">(</span>myhive<span class="token punctuation">)</span><span class="token operator">></span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> stu<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h4 id="Hive-建表时候的字段类型"><a href="#Hive-建表时候的字段类型" class="headerlink" title="Hive 建表时候的字段类型:"></a>Hive 建表时候的字段类型:</h4><p><strong>原始类型</strong></p><div class="table-container"><table><thead><tr><th>类型</th><th>描述</th><th>字面量示例</th></tr></thead><tbody><tr><td>BOOLEAN</td><td>true/false</td><td>TRUE</td></tr><tr><td>TINYINT</td><td>1 字节的有符号整数，-128~127</td><td>1Y</td></tr><tr><td>SMALLINT</td><td>2 个字节的有符号整数，-32768~32767</td><td>1S</td></tr><tr><td>INT</td><td>4 个字节的带符号整数</td><td>1</td></tr><tr><td>BIGINT</td><td>8 字节带符号整数</td><td>1L</td></tr><tr><td>FLOAT</td><td>4 字节单精度浮点数</td><td>1.0</td></tr><tr><td>DOUBLE</td><td>8 字节双精度浮点数</td><td>1.0</td></tr><tr><td>DEICIMAL</td><td>任意精度的带符号小数</td><td>1.0</td></tr><tr><td>STRING</td><td>字符串，变长</td><td>&quot;a&quot;, &#39;b&#39;</td></tr><tr><td>VARCHAR</td><td>变长字符串</td><td>&quot;a&quot;, &#39;b&#39;</td></tr><tr><td>CHAR</td><td>固定长度字符串</td><td>&quot;a&quot;, &#39;b&#39;</td></tr><tr><td>BINARY</td><td>字节数组</td><td>无法表示</td></tr><tr><td>TIMESTAMP</td><td>时间戳，毫秒值精度</td><td>162327493795</td></tr><tr><td>DATE</td><td>日期</td><td>‘2021-03-29&#39;</td></tr><tr><td>INTERVAL</td><td>时间频率间隔</td><td>&nbsp;</td></tr></tbody></table></div><p><strong>复杂类型</strong></p><div class="table-container"><table><thead><tr><th>类型</th><th>描述</th><th>字面量示例</th></tr></thead><tbody><tr><td>ARRAY</td><td>有序的同类型的集合</td><td>array(1, 2)</td></tr><tr><td>MAP</td><td>key-value，key 必须为原始类型，value 可以任意类型</td><td>map(&#39;a&#39;, 1, &#39;b&#39;, 2)</td></tr><tr><td>STRUCT</td><td>字段集合，类型可以不同</td><td>struct(&#39;1&#39;, 1, 1.0), named_struct(&#39;col1&#39;, &#39;1&#39;, &#39;col2&#39;, 1, &#39;clo3&#39;, 1.0)</td></tr><tr><td>UNION</td><td>在有限取值范围内的一个值</td><td>create_union(1, &#39;a&#39;, 63)</td></tr></tbody></table></div><p>对 decimal 类型简单解释下：</p><p>用法：<code>decimal(11, 2)</code> 代表最多有 11 位数字，其中后 2 位是小数，整数部分是 9 位；如果整数部分超过 9 位，则这个字段就会变成 <code>NULL</code>；如果小数部分不足 2 位，则后面用 0 补齐两位，如果小数部分超过两位，则超出部分四舍五入。</p><p>也可直接写 <code>decimal</code>，后面不指定位数，默认是 <code>decimal(10, 0)</code>，整数 10 位，没有小数。</p><h4 id="创建表并指定字段之间的分隔符"><a href="#创建表并指定字段之间的分隔符" class="headerlink" title="创建表并指定字段之间的分隔符"></a>创建表并指定字段之间的分隔符</h4><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">create</span> <span class="token keyword">table</span> <span class="token keyword">if</span> <span class="token operator">not</span> <span class="token keyword">exists</span> stu2<span class="token punctuation">(</span>id <span class="token keyword">int</span> <span class="token punctuation">,</span>name string<span class="token punctuation">)</span> <span class="token keyword">row</span> format delimited <span class="token keyword">fields</span> <span class="token keyword">terminated</span> <span class="token keyword">by</span> <span class="token string">'\t'</span> stored <span class="token keyword">as</span> textfile location <span class="token string">'/user/stu2'</span><span class="token punctuation">;</span><span class="token comment"># row format delimited fields terminated by '\t' 指定字段分隔符，默认分隔符为 '\001'</span><span class="token comment"># stored as 指定存储格式</span><span class="token comment"># location 指定存储位置</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h4 id="根据查询结果创建表"><a href="#根据查询结果创建表" class="headerlink" title="根据查询结果创建表"></a>根据查询结果创建表</h4><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">create</span> <span class="token keyword">table</span> stu3 <span class="token keyword">as</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> stu2<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><h4 id="根据已经存在的表结构创建表"><a href="#根据已经存在的表结构创建表" class="headerlink" title="根据已经存在的表结构创建表"></a>根据已经存在的表结构创建表</h4><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">create</span> <span class="token keyword">table</span> stu4 <span class="token operator">like</span> stu2<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><h4 id="查询表的结构"><a href="#查询表的结构" class="headerlink" title="查询表的结构"></a>查询表的结构</h4><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token comment"># 只查询表内字段及属性</span><span class="token keyword">desc</span> stu2<span class="token punctuation">;</span><span class="token comment"># 详细查询</span><span class="token keyword">desc</span> formatted stu2<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h4 id="查询创建表的语句"><a href="#查询创建表的语句" class="headerlink" title="查询创建表的语句"></a>查询创建表的语句</h4><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">show</span> <span class="token keyword">create</span> <span class="token keyword">table</span> stu2<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><h3 id="对外部表操作"><a href="#对外部表操作" class="headerlink" title="对外部表操作"></a>对外部表操作</h3><p>外部表因为是指定其他的 HDFS 路径的数据加载到表当中来，所以 Hive 表会认为自己不完全独占这份数据，所以删除 Hive 表的时候，数据仍然存放在 HDFS 当中，不会删掉，只会删除表的元数据。</p><h4 id="构建外部表"><a href="#构建外部表" class="headerlink" title="构建外部表"></a>构建外部表</h4><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">create</span> external <span class="token keyword">table</span> student <span class="token punctuation">(</span>s_id string<span class="token punctuation">,</span>s_name string<span class="token punctuation">)</span> <span class="token keyword">row</span> format delimited <span class="token keyword">fields</span> <span class="token keyword">terminated</span> <span class="token keyword">by</span> <span class="token string">'\t'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><h4 id="从本地文件系统向表中加载数据"><a href="#从本地文件系统向表中加载数据" class="headerlink" title="从本地文件系统向表中加载数据"></a>从本地文件系统向表中加载数据</h4><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token comment"># 追加操作</span><span class="token keyword">load</span> <span class="token keyword">data</span> <span class="token keyword">local</span> inpath <span class="token string">'/export/servers/hivedatas/student.csv'</span> <span class="token keyword">into</span> <span class="token keyword">table</span> student<span class="token punctuation">;</span><span class="token comment"># 覆盖操作</span><span class="token keyword">load</span> <span class="token keyword">data</span> <span class="token keyword">local</span> inpath <span class="token string">'/export/servers/hivedatas/student.csv'</span> overwrite <span class="token keyword">into</span> <span class="token keyword">table</span> student<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h4 id="从-HDFS-文件系统向表中加载数据"><a href="#从-HDFS-文件系统向表中加载数据" class="headerlink" title="从 HDFS 文件系统向表中加载数据"></a>从 HDFS 文件系统向表中加载数据</h4><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">load</span> <span class="token keyword">data</span> inpath <span class="token string">'/hivedatas/techer.csv'</span> <span class="token keyword">into</span> <span class="token keyword">table</span> techer<span class="token punctuation">;</span><span class="token comment"># 加载数据到指定分区</span><span class="token keyword">load</span> <span class="token keyword">data</span> inpath <span class="token string">'/hivedatas/techer.csv'</span> <span class="token keyword">into</span> <span class="token keyword">table</span> techer <span class="token keyword">partition</span><span class="token punctuation">(</span>cur_date<span class="token operator">=</span><span class="token number">20201210</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></p><p><strong>注意：</strong>、</p><ol><li>使用 <code>load data local</code> 表示从本地文件系统加载，文件会拷贝到 HDFS 上。</li><li>使用 <code>load data</code> 表示从 HDFS 文件系统加载，文件会直接移动到 Hive 相关目录下，注意不是拷贝过去，因为 Hive 认为 HDFS 文件已经有 3 副本了，没必要再次拷贝了。</li><li>如果表是分区表，<code>load</code> 时不指定分区会报错。</li><li>如果加载相同文件名的文件，会被自动重命名。</li></ol><h3 id="对分区表的操作"><a href="#对分区表的操作" class="headerlink" title="对分区表的操作"></a>对分区表的操作</h3><h4 id="创建分区表的语法"><a href="#创建分区表的语法" class="headerlink" title="创建分区表的语法"></a>创建分区表的语法</h4><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">create</span> <span class="token keyword">table</span> score<span class="token punctuation">(</span>s_id string<span class="token punctuation">,</span> s_score <span class="token keyword">int</span><span class="token punctuation">)</span> partitioned <span class="token keyword">by</span> <span class="token punctuation">(</span><span class="token keyword">month</span> string<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><h4 id="创建一个表带多个分区"><a href="#创建一个表带多个分区" class="headerlink" title="创建一个表带多个分区"></a>创建一个表带多个分区</h4><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">create</span> <span class="token keyword">table</span> score2 <span class="token punctuation">(</span>s_id string<span class="token punctuation">,</span> s_score <span class="token keyword">int</span><span class="token punctuation">)</span> partitioned <span class="token keyword">by</span> <span class="token punctuation">(</span><span class="token keyword">year</span> string<span class="token punctuation">,</span><span class="token keyword">month</span> string<span class="token punctuation">,</span><span class="token keyword">day</span> string<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><p><strong>注意：</strong>Hive 表创建的时候可以用 <code>location</code> 指定一个文件或者文件夹，当指定文件夹时，Hive 会加载文件夹下的所有文件，当表中无分区时，这个文件夹下不能再有文件夹，否则报错。</p><p>当表是分区表时，比如 <code>partitioned by (day string)</code>，则这个文件夹下的每一个文件夹就是一个分区，且文件夹名为 <code>day=20201123</code> 这种格式，然后使用：<code>msck repair table score;</code> 修复表结构，成功之后即可看到数据已经全部加载到表当中去了</p><h4 id="加载数据到一个分区的表中"><a href="#加载数据到一个分区的表中" class="headerlink" title="加载数据到一个分区的表中"></a>加载数据到一个分区的表中</h4><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">load</span> <span class="token keyword">data</span> <span class="token keyword">local</span> inpath <span class="token string">'/export/servers/hivedatas/score.csv'</span> <span class="token keyword">into</span> <span class="token keyword">table</span> score <span class="token keyword">partition</span> <span class="token punctuation">(</span><span class="token keyword">month</span><span class="token operator">=</span><span class="token string">'201806'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><h4 id="加载数据到一个多分区的表中去"><a href="#加载数据到一个多分区的表中去" class="headerlink" title="加载数据到一个多分区的表中去"></a>加载数据到一个多分区的表中去</h4><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">load</span> <span class="token keyword">data</span> <span class="token keyword">local</span> inpath <span class="token string">'/export/servers/hivedatas/score.csv'</span> <span class="token keyword">into</span> <span class="token keyword">table</span> score2 <span class="token keyword">partition</span><span class="token punctuation">(</span><span class="token keyword">year</span><span class="token operator">=</span><span class="token string">'2018'</span><span class="token punctuation">,</span><span class="token keyword">month</span><span class="token operator">=</span><span class="token string">'06'</span><span class="token punctuation">,</span><span class="token keyword">day</span><span class="token operator">=</span><span class="token string">'01'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><h4 id="查看分区"><a href="#查看分区" class="headerlink" title="查看分区"></a>查看分区</h4><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">show</span> partitions score<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><h4 id="添加一个分区"><a href="#添加一个分区" class="headerlink" title="添加一个分区"></a>添加一个分区</h4><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">alter</span> <span class="token keyword">table</span> score <span class="token keyword">add</span> <span class="token keyword">partition</span><span class="token punctuation">(</span><span class="token keyword">month</span><span class="token operator">=</span><span class="token string">'201805'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><h4 id="同时添加多个分区"><a href="#同时添加多个分区" class="headerlink" title="同时添加多个分区"></a>同时添加多个分区</h4><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">alter</span> <span class="token keyword">table</span> score <span class="token keyword">add</span> <span class="token keyword">partition</span><span class="token punctuation">(</span><span class="token keyword">month</span><span class="token operator">=</span><span class="token string">'201804'</span><span class="token punctuation">)</span> <span class="token keyword">partition</span><span class="token punctuation">(</span><span class="token keyword">month</span> <span class="token operator">=</span> <span class="token string">'201803'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><p><strong>注意：</strong>添加分区之后就可以在 HDFS 文件系统当中看到表下面多了一个文件夹。</p><h4 id="删除分区"><a href="#删除分区" class="headerlink" title="删除分区"></a>删除分区</h4><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">alter</span> <span class="token keyword">table</span> score <span class="token keyword">drop</span> <span class="token keyword">partition</span><span class="token punctuation">(</span><span class="token keyword">month</span> <span class="token operator">=</span> <span class="token string">'201806'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><h3 id="对分桶表操作"><a href="#对分桶表操作" class="headerlink" title="对分桶表操作"></a>对分桶表操作</h3><p>将数据按照指定的字段进行分成多个桶中去，就是按照分桶字段进行哈希划分到多个文件当中去分区就是分文件夹，分桶就是分文件。</p><p>分桶优点：</p><ul><li>提高 join 查询效率</li><li>提高抽样效率</li></ul><h4 id="开启-Hive-的捅表功能"><a href="#开启-Hive-的捅表功能" class="headerlink" title="开启 Hive 的捅表功能"></a>开启 Hive 的捅表功能</h4><p><code>set hive.enforce.bucketing=true;</code></p><h4 id="设置-Reduce-的个数"><a href="#设置-Reduce-的个数" class="headerlink" title="设置 Reduce 的个数"></a>设置 Reduce 的个数</h4><p><code>set mapreduce.job.reduces=3;</code></p><h4 id="创建桶表"><a href="#创建桶表" class="headerlink" title="创建桶表"></a>创建桶表</h4><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">create</span> <span class="token keyword">table</span> course <span class="token punctuation">(</span>c_id string<span class="token punctuation">,</span>c_name string<span class="token punctuation">)</span> <span class="token keyword">clustered</span> <span class="token keyword">by</span><span class="token punctuation">(</span>c_id<span class="token punctuation">)</span> <span class="token keyword">into</span> <span class="token number">3</span> buckets<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><p>桶表的数据加载：由于桶表的数据加载通过 <code>hdfs dfs -put</code> 文件或者通过 <code>load data</code> 均不可以，只能通过 <code>insert overwrite</code> 进行加载。</p><p>所以把文件加载到桶表中，需要先创建普通表，并通过 <code>insert overwrite</code> 的方式将普通表的数据通过查询的方式加载到桶表当中去。</p><h4 id="通过-insert-overwrite-给桶表中加载数据"><a href="#通过-insert-overwrite-给桶表中加载数据" class="headerlink" title="通过 insert overwrite 给桶表中加载数据"></a>通过 insert overwrite 给桶表中加载数据</h4><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">insert</span> overwrite <span class="token keyword">table</span> course <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> course_common cluster <span class="token keyword">by</span><span class="token punctuation">(</span>c_id<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">-- 最后指定桶字段</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><h3 id="修改表和删除表"><a href="#修改表和删除表" class="headerlink" title="修改表和删除表"></a>修改表和删除表</h3><h4 id="修改表名称"><a href="#修改表名称" class="headerlink" title="修改表名称"></a>修改表名称</h4><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">alter</span> <span class="token keyword">table</span> old_table_name <span class="token keyword">rename</span> <span class="token keyword">to</span> new_table_name<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><h4 id="增加-修改列信息"><a href="#增加-修改列信息" class="headerlink" title="增加/修改列信息"></a>增加/修改列信息</h4><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token comment"># 查询表结构</span><span class="token keyword">desc</span> score5<span class="token punctuation">;</span><span class="token comment"># 添加列</span><span class="token keyword">alter</span> <span class="token keyword">table</span> score5 <span class="token keyword">add</span> <span class="token keyword">columns</span> <span class="token punctuation">(</span>mycol string<span class="token punctuation">,</span> mysco string<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment"># 更新列</span><span class="token keyword">alter</span> <span class="token keyword">table</span> score5 change <span class="token keyword">column</span> mysco mysconew <span class="token keyword">int</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h4 id="删除表操作"><a href="#删除表操作" class="headerlink" title="删除表操作"></a>删除表操作</h4><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">drop</span> <span class="token keyword">table</span> score5<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><h4 id="清空表操作"><a href="#清空表操作" class="headerlink" title="清空表操作"></a>清空表操作</h4><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">truncate</span> <span class="token keyword">table</span> score6<span class="token punctuation">;</span><span class="token comment"># 只能清空管理表，也就是内部表；清空外部表，会产生错误</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></p><p><strong>注意：truncate 和 drop：</strong></p><p>如果 HDFS 开启了回收站，<code>drop</code> 删除的表数据是可以从回收站恢复的，表结构恢复不了，需要自己重新创建；<code>truncate</code> 清空的表是不进回收站的，所以无法恢复 <code>truncate</code> 清空的表所以 <code>truncate</code> 一定慎用，一旦清空将无力回天。</p><h3 id="向-Hive-表中加载数据"><a href="#向-Hive-表中加载数据" class="headerlink" title="向 Hive 表中加载数据"></a>向 Hive 表中加载数据</h3><h4 id="直接向分区表中插入数据"><a href="#直接向分区表中插入数据" class="headerlink" title="直接向分区表中插入数据"></a>直接向分区表中插入数据</h4><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">insert</span> <span class="token keyword">into</span> <span class="token keyword">table</span> score <span class="token keyword">partition</span><span class="token punctuation">(</span><span class="token keyword">month</span> <span class="token operator">=</span><span class="token string">'201807'</span><span class="token punctuation">)</span> <span class="token keyword">values</span> <span class="token punctuation">(</span><span class="token string">'001'</span><span class="token punctuation">,</span><span class="token string">'002'</span><span class="token punctuation">,</span><span class="token string">'100'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><h4 id="通过load方式加载数据"><a href="#通过load方式加载数据" class="headerlink" title="通过load方式加载数据"></a>通过load方式加载数据</h4><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">load</span> <span class="token keyword">data</span> <span class="token keyword">local</span> inpath <span class="token string">'/export/servers/hivedatas/score.csv'</span> overwrite <span class="token keyword">into</span> <span class="token keyword">table</span> score <span class="token keyword">partition</span><span class="token punctuation">(</span><span class="token keyword">month</span><span class="token operator">=</span><span class="token string">'201806'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><h4 id="通过查询方式加载数据"><a href="#通过查询方式加载数据" class="headerlink" title="通过查询方式加载数据"></a>通过查询方式加载数据</h4><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">insert</span> overwrite <span class="token keyword">table</span> score2 <span class="token keyword">partition</span><span class="token punctuation">(</span><span class="token keyword">month</span> <span class="token operator">=</span> <span class="token string">'201806'</span><span class="token punctuation">)</span> <span class="token keyword">select</span> s_id<span class="token punctuation">,</span>c_id<span class="token punctuation">,</span>s_score <span class="token keyword">from</span> score1<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><h4 id="查询语句中创建表并加载数据"><a href="#查询语句中创建表并加载数据" class="headerlink" title="查询语句中创建表并加载数据"></a>查询语句中创建表并加载数据</h4><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">create</span> <span class="token keyword">table</span> score2 <span class="token keyword">as</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> score1<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><h4 id="在创建表是通过-location-指定加载数据的路径"><a href="#在创建表是通过-location-指定加载数据的路径" class="headerlink" title="在创建表是通过 location 指定加载数据的路径"></a>在创建表是通过 location 指定加载数据的路径</h4><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">create</span> external <span class="token keyword">table</span> score6 <span class="token punctuation">(</span>s_id string<span class="token punctuation">,</span>c_id string<span class="token punctuation">,</span>s_score <span class="token keyword">int</span><span class="token punctuation">)</span> <span class="token keyword">row</span> format delimited <span class="token keyword">fields</span> <span class="token keyword">terminated</span> <span class="token keyword">by</span> <span class="token string">','</span> location <span class="token string">'/myscore'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><h4 id="export-导出与-import-导入-Hive-表数据（内部表操作）"><a href="#export-导出与-import-导入-Hive-表数据（内部表操作）" class="headerlink" title="export 导出与 import 导入 Hive 表数据（内部表操作）"></a>export 导出与 import 导入 Hive 表数据（内部表操作）</h4><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">create</span> <span class="token keyword">table</span> techer2 <span class="token operator">like</span> techer<span class="token punctuation">;</span> <span class="token comment">--依据已有表结构创建表</span>export <span class="token keyword">table</span> techer <span class="token keyword">to</span> <span class="token string">'/export/techer'</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token keyword">table</span> techer2 <span class="token keyword">from</span> <span class="token string">'/export/techer'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h3 id="Hive-表中数据导出"><a href="#Hive-表中数据导出" class="headerlink" title="Hive 表中数据导出"></a>Hive 表中数据导出</h3><h4 id="insert-导出"><a href="#insert-导出" class="headerlink" title="insert 导出"></a>insert 导出</h4><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token comment"># 将查询的结果导出到本地</span><span class="token keyword">insert</span> overwrite <span class="token keyword">local</span> directory <span class="token string">'/export/servers/exporthive'</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> score<span class="token punctuation">;</span><span class="token comment"># 将查询的结果格式化导出到本地</span><span class="token keyword">insert</span> overwrite <span class="token keyword">local</span> directory <span class="token string">'/export/servers/exporthive'</span> <span class="token keyword">row</span> format delimited <span class="token keyword">fields</span> <span class="token keyword">terminated</span> <span class="token keyword">by</span> <span class="token string">'\t'</span> collection items <span class="token keyword">terminated</span> <span class="token keyword">by</span> <span class="token string">'#'</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> student<span class="token punctuation">;</span><span class="token comment"># 将查询的结果导出到 HDFS 上（没有 local）</span><span class="token keyword">insert</span> overwrite directory <span class="token string">'/export/servers/exporthive'</span> <span class="token keyword">row</span> format delimited <span class="token keyword">fields</span> <span class="token keyword">terminated</span> <span class="token keyword">by</span> <span class="token string">'\t'</span> collection items <span class="token keyword">terminated</span> <span class="token keyword">by</span> <span class="token string">'#'</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> score<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h4 id="Hadoop-命令导出到本地"><a href="#Hadoop-命令导出到本地" class="headerlink" title="Hadoop 命令导出到本地"></a>Hadoop 命令导出到本地</h4><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">dfs <span class="token operator">-</span>get <span class="token operator">/</span>export<span class="token operator">/</span>servers<span class="token operator">/</span>exporthive<span class="token operator">/</span><span class="token number">000000</span>_0 <span class="token operator">/</span>export<span class="token operator">/</span>servers<span class="token operator">/</span>exporthive<span class="token operator">/</span><span class="token keyword">local</span><span class="token punctuation">.</span>txt<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><h4 id="hive-shell-命令导出"><a href="#hive-shell-命令导出" class="headerlink" title="hive shell 命令导出"></a>hive shell 命令导出</h4><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token comment"># 基本语法：hive -f/-e 执行语句或者脚本 > file</span>hive <span class="token operator">-</span>e <span class="token string">"select * from myhive.score;"</span> <span class="token operator">></span> <span class="token operator">/</span>export<span class="token operator">/</span>servers<span class="token operator">/</span>exporthive<span class="token operator">/</span>score<span class="token punctuation">.</span>txthive <span class="token operator">-</span>f export<span class="token punctuation">.</span>sh <span class="token operator">></span> <span class="token operator">/</span>export<span class="token operator">/</span>servers<span class="token operator">/</span>exporthive<span class="token operator">/</span>score<span class="token punctuation">.</span>txt<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h4 id="export-导出到-HDFS-上"><a href="#export-导出到-HDFS-上" class="headerlink" title="export 导出到 HDFS 上"></a>export 导出到 HDFS 上</h4><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">export <span class="token keyword">table</span> score <span class="token keyword">to</span> <span class="token string">'/export/exporthive/score'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><h1 id="Hive-的-DQL-语法"><a href="#Hive-的-DQL-语法" class="headerlink" title="Hive 的 DQL 语法"></a>Hive 的 DQL 语法</h1><h2 id="单表查询、关联查询"><a href="#单表查询、关联查询" class="headerlink" title="单表查询、关联查询"></a>单表查询、关联查询</h2><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token punctuation">[</span><span class="token keyword">ALL</span> <span class="token operator">|</span> <span class="token keyword">DISTINCT</span><span class="token punctuation">]</span> select_expr<span class="token punctuation">,</span> select_expr<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token keyword">FROM</span> table_reference<span class="token punctuation">[</span><span class="token keyword">WHERE</span> where_condition<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token keyword">GROUP</span> <span class="token keyword">BY</span> col_list <span class="token punctuation">[</span><span class="token keyword">HAVING</span> condition<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token punctuation">[</span>CLUSTER <span class="token keyword">BY</span> col_list <span class="token operator">|</span> <span class="token punctuation">[</span>DISTRIBUTE <span class="token keyword">BY</span> col_list<span class="token punctuation">]</span> <span class="token punctuation">[</span>SORT <span class="token keyword">BY</span><span class="token operator">|</span> <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> col_list<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token keyword">LIMIT</span> number<span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p><strong>注意：</strong></p><ol><li><code>order by</code> 会对输入做全局排序，因此只有一个 reducer，会导致当输入规模较大时，需要较长的计算时间。</li><li><code>sort by</code> 不是全局排序，其在数据进入 reducer 前完成排序。因此，如果用 <code>sort by</code> 进行排序，并且设置 <code>mapred.reduce.tasks&gt;1</code>，则 <code>sort by</code> 只保证每个 reducer 的输出有序，不保证全局有序。</li><li><code>distribute by(字段)</code> 根据指定的字段将数据分到不同的 reducer，且分发算法是 hash 散列。</li><li><code>cluster by(字段)</code> 除了具有 <code>distribute by</code> 的功能外，还会对该字段进行排序。</li></ol><p>因此，如果分桶和 <code>sort</code> 字段是同一个时，此时，<code>cluster by = distribute by + sort by</code>。</p><h3 id="WHERE-语句"><a href="#WHERE-语句" class="headerlink" title="WHERE 语句"></a>WHERE 语句</h3><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> score <span class="token keyword">where</span> s_score <span class="token operator">&lt;</span> <span class="token number">60</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><p><strong>注意：</strong>小于某个值是不包含 NULL 的，如上查询结果是把 s_score 为 NULL 的行剔除的。</p><h3 id="GROUP-BY-分组"><a href="#GROUP-BY-分组" class="headerlink" title="GROUP BY 分组"></a>GROUP BY 分组</h3><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> s_id <span class="token punctuation">,</span><span class="token function">avg</span><span class="token punctuation">(</span>s_score<span class="token punctuation">)</span> <span class="token keyword">from</span> score <span class="token keyword">group</span> <span class="token keyword">by</span> s_id<span class="token punctuation">;</span><span class="token comment"># 分组后对数据进行筛选，使用having</span><span class="token keyword">select</span> s_id <span class="token punctuation">,</span><span class="token function">avg</span><span class="token punctuation">(</span>s_score<span class="token punctuation">)</span> avgscore <span class="token keyword">from</span> score <span class="token keyword">group</span> <span class="token keyword">by</span> s_id <span class="token keyword">having</span> avgscore <span class="token operator">></span> <span class="token number">85</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></p><p><strong>注意：</strong></p><p>如果使用 <code>group by</code> 分组，则 <code>select</code> 后面只能写分组的字段或者聚合函数。<code>where</code> 和 <code>having</code> 区别：</p><ul><li><code>having</code> 是在 <code>group by</code> 分完组之后再对数据进行筛选，所以 <code>having</code> 要筛选的字段只能是分组字段或者聚合函数</li><li><code>where</code> 是从数据表中的字段直接进行的筛选的，所以不能跟在 <code>group by</code> 后面，也不能使用聚合函数</li></ul><h3 id="JOIN-连接"><a href="#JOIN-连接" class="headerlink" title="JOIN 连接"></a>JOIN 连接</h3><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token comment"># INNER JOIN 内连接：只有进行连接的两个表中都存在与连接条件相匹配的数据才会被保留下来</span><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> techer t <span class="token punctuation">[</span><span class="token keyword">inner</span><span class="token punctuation">]</span> <span class="token keyword">join</span> course c <span class="token keyword">on</span> t<span class="token punctuation">.</span>t_id <span class="token operator">=</span> c<span class="token punctuation">.</span>t_id<span class="token punctuation">;</span> <span class="token comment">-- inner 可省略</span><span class="token comment"># LEFT OUTER JOIN 左外连接：左边所有数据会被返回，右边符合条件的被返回</span><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> techer t <span class="token keyword">left</span> <span class="token keyword">join</span> course c <span class="token keyword">on</span> t<span class="token punctuation">.</span>t_id <span class="token operator">=</span> c<span class="token punctuation">.</span>t_id<span class="token punctuation">;</span> <span class="token comment">-- outer可省略</span><span class="token comment"># RIGHT OUTER JOIN 右外连接：右边所有数据会被返回，左边符合条件的被返回</span><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> techer t <span class="token keyword">right</span> <span class="token keyword">join</span> course c <span class="token keyword">on</span> t<span class="token punctuation">.</span>t_id <span class="token operator">=</span> c<span class="token punctuation">.</span>t_id<span class="token punctuation">;</span><span class="token comment"># FULL OUTER JOIN 满外(全外)连接: 将会返回所有表中符合条件的所有记录。如果任一表的指定字段没有符合条件的值的话，那么就使用 NULL 值替代。</span><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> techer t <span class="token keyword">FULL</span> <span class="token keyword">JOIN</span> course c <span class="token keyword">ON</span> t<span class="token punctuation">.</span>t_id <span class="token operator">=</span> c<span class="token punctuation">.</span>t_id<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p><strong>注意：</strong></p><ol><li>Hive2 版本已经支持不等值连接，就是 <code>join on</code> 条件后面可以使用大于小于符号了；并且也支持 <code>join on</code> 条件后跟 <code>or</code>（早前版本 <code>on</code> 后只支持 <code>=</code> 和 <code>and</code>，不支持 <code>&gt;</code>、<code>&lt;</code> 和 <code>or</code>）；</li><li>如 Hive 执行引擎使用 MapReduce，一个 <code>join</code> 就会启动一个 job，一条 sql 语句中如有多个 <code>join</code>，则会启动多个 job。</li></ol><p><strong>注意：</strong>表之间用 <code>逗号(,)</code> 连接和 <code>inner join</code> 是一样的。</p><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> table_a<span class="token punctuation">,</span>table_b <span class="token keyword">where</span> table_a<span class="token punctuation">.</span>id <span class="token operator">=</span> table_b<span class="token punctuation">.</span>id<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><p>它们的执行效率没有区别，只是书写方式不同，用 <code>逗号(,)</code> 是 sql 89 标准，<code>join</code> 是 sql 92 标准。用 <code>逗号(,)</code> 连接后面过滤条件用 <code>where</code> ，用 <code>join</code> 连接后面过滤条件是 <code>on</code>。</p><h3 id="ORDER-BY-排序"><a href="#ORDER-BY-排序" class="headerlink" title="ORDER BY 排序"></a>ORDER BY 排序</h3><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token comment"># 全局排序，只会有一个reduce</span><span class="token comment"># ASC（ascend）: 升序（默认） DESC（descend）: 降序</span><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> student s <span class="token keyword">LEFT</span> <span class="token keyword">JOIN</span> score sco <span class="token keyword">ON</span> s<span class="token punctuation">.</span>s_id <span class="token operator">=</span> sco<span class="token punctuation">.</span>s_id <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> sco<span class="token punctuation">.</span>s_score <span class="token keyword">DESC</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></p><p><strong>注意：</strong><code>order by</code> 是全局排序，所以最后只有一个 reduce，也就是在一个节点执行，如果数据量太大，就会耗费较长时间。</p><h3 id="SORT-BY-局部排序"><a href="#SORT-BY-局部排序" class="headerlink" title="SORT BY 局部排序"></a>SORT BY 局部排序</h3><p>每个 MapReduce 内部进行排序，对全局结果集来说不是排序。</p><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token comment"># 设置 reduce 个数</span><span class="token keyword">set</span> mapreduce<span class="token punctuation">.</span>job<span class="token punctuation">.</span>reduces<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">;</span><span class="token comment"># 查看设置 reduce 个数</span><span class="token keyword">set</span> mapreduce<span class="token punctuation">.</span>job<span class="token punctuation">.</span>reduces<span class="token punctuation">;</span><span class="token comment"># 查询成绩按照成绩降序排列</span><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> score sort <span class="token keyword">by</span> s_score<span class="token punctuation">;</span><span class="token comment"># 将查询结果导入到文件中（按照成绩降序排列）</span><span class="token keyword">insert</span> overwrite <span class="token keyword">local</span> directory <span class="token string">'/export/servers/hivedatas/sort'</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> score sort <span class="token keyword">by</span> s_score<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h3 id="DISTRIBUTE-BY-分区排序"><a href="#DISTRIBUTE-BY-分区排序" class="headerlink" title="DISTRIBUTE BY 分区排序"></a>DISTRIBUTE BY 分区排序</h3><p><code>distribute by</code> 类似 MR 中 partition，进行分区，结合 <code>sort by</code> 使用。</p><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token comment"># 设置 reduce 的个数，将我们对应的 s_id 划分到对应的 reduce 当中去</span><span class="token keyword">set</span> mapreduce<span class="token punctuation">.</span>job<span class="token punctuation">.</span>reduces<span class="token operator">=</span><span class="token number">7</span><span class="token punctuation">;</span><span class="token comment"># 通过 distribute by 进行数据的分区</span><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> score distribute <span class="token keyword">by</span> s_id sort <span class="token keyword">by</span> s_score<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p><strong>注意：</strong>Hive 要求 <code>distribute by</code> 语句要写在 <code>sort by</code> 语句之前。</p><h3 id="CLUSTER-BY-排序"><a href="#CLUSTER-BY-排序" class="headerlink" title="CLUSTER BY 排序"></a>CLUSTER BY 排序</h3><p>当 <code>distribute by</code> 和 <code>sort by</code> 字段相同时，可以使用 <code>cluster by</code> 方式。<code>cluster by</code> 除了具有 <code>distribute by</code> 的功能外还兼具 <code>sort by</code> 的功能。但是排序只能是正序排序，不能指定排序规则为 <code>ASC</code> 或者 <code>DESC</code>。</p><p>以下两种写法等价：</p><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> score cluster <span class="token keyword">by</span> s_id<span class="token punctuation">;</span><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> score distribute <span class="token keyword">by</span> s_id sort <span class="token keyword">by</span> s_id<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></p><h2 id="Hive-函数"><a href="#Hive-函数" class="headerlink" title="Hive 函数"></a>Hive 函数</h2><h3 id="聚合函数"><a href="#聚合函数" class="headerlink" title="聚合函数"></a>聚合函数</h3><p>Hive 支持 <code>count()</code>，<code>max()</code>，<code>min()</code>，<code>sum()</code>，<code>avg()</code> 等常用的聚合函数。</p><p><strong>注意：</strong></p><ul><li>聚合操作时要注意 NULL 值；</li><li><code>count(*)</code> 包含 NULL 值，统计所有行数；</li><li><code>count(id)</code> 不包含 NULL值；</li><li><code>min</code> 求最小值是不包含 NULL，除非所有值都是 NULL；</li><li><code>avg</code> 求平均值也是不包含 NULL。</li></ul><h4 id="非空集合总体变量函数"><a href="#非空集合总体变量函数" class="headerlink" title="非空集合总体变量函数"></a>非空集合总体变量函数</h4><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">语法：var_pop<span class="token punctuation">(</span>col<span class="token punctuation">)</span>返回值：<span class="token keyword">double</span>说明：统计结果集中 col 非空集合的总体变量（忽略 <span class="token boolean">NULL</span>）<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></p><h4 id="非空集合样本变量函数"><a href="#非空集合样本变量函数" class="headerlink" title="非空集合样本变量函数"></a>非空集合样本变量函数</h4><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">语法：var_samp<span class="token punctuation">(</span>col<span class="token punctuation">)</span>返回值：<span class="token keyword">double</span>说明：统计结果集中 col 非空集合的样本变量（忽略 <span class="token boolean">NULL</span>）<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></p><h4 id="总体标准偏离函数"><a href="#总体标准偏离函数" class="headerlink" title="总体标准偏离函数"></a>总体标准偏离函数</h4><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">语法：stddev_pop<span class="token punctuation">(</span>col<span class="token punctuation">)</span>返回值：<span class="token keyword">double</span>说明：该函数计算总体标准偏离，并返回总体变量的平方根，其返回值与 VAR_POP 函数的平方根相同<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></p><h4 id="中位数函数"><a href="#中位数函数" class="headerlink" title="中位数函数"></a>中位数函数</h4><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">语法：percentile<span class="token punctuation">(</span><span class="token keyword">bigint</span> col<span class="token punctuation">,</span> p<span class="token punctuation">)</span>返回值：<span class="token keyword">double</span>说明：求准确的第 p 个百分位数，p 必须介于 <span class="token number">0</span> 和 <span class="token number">1</span> 之间，但是 col 字段目前只支持整数，不支持浮点数类型<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></p><h3 id="关系运算"><a href="#关系运算" class="headerlink" title="关系运算"></a>关系运算</h3><p>支持：等值(=)、不等值(!= 或 &lt;&gt;)、小于(&lt;)、小于等于(&lt;=)、大于(&gt;)、大于等于(&gt;=)、空值判断(IS NULL)、非空判断(IS NOT NULL)。</p><h4 id="LIKE-比较"><a href="#LIKE-比较" class="headerlink" title="LIKE 比较"></a>LIKE 比较</h4><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">语法：A <span class="token operator">LIKE</span> B操作类型: string说明：如果字符串 A 或者字符串 B 为 <span class="token boolean">NULL</span>，则返回 <span class="token boolean">NULL</span>；如果字符串 A 符合表达式 B 的正则语法，则为 <span class="token boolean">TRUE</span>；否则为 <span class="token boolean">FALSE</span>。B 中字符<span class="token punctuation">(</span>_<span class="token punctuation">)</span> 表示任意单个字符，而字符<span class="token punctuation">(</span><span class="token operator">%</span><span class="token punctuation">)</span> 表示任意数量的字符。<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></p><h4 id="RLIKE-操作"><a href="#RLIKE-操作" class="headerlink" title="RLIKE 操作"></a>RLIKE 操作</h4><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">语法：A <span class="token operator">RLIKE</span> B操作类型: string说明：如果字符串 A 或者字符串 B 为 <span class="token boolean">NULL</span>，则返回 <span class="token boolean">NULL</span>；如果字符串 A 符合 Java 正则表达式 B 的正则语法，则为 <span class="token boolean">TRUE</span>；否则为 <span class="token boolean">FALSE</span>。<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></p><h4 id="REGEXP-操作"><a href="#REGEXP-操作" class="headerlink" title="REGEXP 操作"></a>REGEXP 操作</h4><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">语法：A <span class="token operator">REGEXP</span> B操作类型: string说明：功能与 <span class="token operator">RLIKE</span> 相同示例：<span class="token keyword">select</span> <span class="token number">1</span> <span class="token keyword">from</span> tableName <span class="token keyword">where</span> <span class="token string">'footbar'</span> <span class="token operator">REGEXP</span> <span class="token string">'^f.*r$'</span><span class="token punctuation">;</span>结果：<span class="token number">1</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h3 id="数学运算"><a href="#数学运算" class="headerlink" title="数学运算"></a>数学运算</h3><p>支持所有数值类型：加(+)、减(-)、乘(*)、除(/)、取余(%)、位与(&amp;)、位或(|)、位异或(^)、位取反(~)。</p><h3 id="逻辑运算"><a href="#逻辑运算" class="headerlink" title="逻辑运算"></a>逻辑运算</h3><p>支持：逻辑与(and)、逻辑或(or)、逻辑非(not)。</p><h3 id="数值运算"><a href="#数值运算" class="headerlink" title="数值运算"></a>数值运算</h3><h4 id="取整函数-round"><a href="#取整函数-round" class="headerlink" title="取整函数 round"></a>取整函数 round</h4><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">语法：<span class="token function">round</span><span class="token punctuation">(</span><span class="token keyword">double</span> a<span class="token punctuation">)</span>返回值：<span class="token keyword">bigint</span>说明：返回 <span class="token keyword">double</span> 类型的整数值部分（遵循四舍五入）示例：<span class="token keyword">select</span> <span class="token function">round</span><span class="token punctuation">(</span><span class="token number">3.1415926</span><span class="token punctuation">)</span> <span class="token keyword">from</span> tableName<span class="token punctuation">;</span>结果：<span class="token number">3</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h4 id="指定精度取整函数-round"><a href="#指定精度取整函数-round" class="headerlink" title="指定精度取整函数 round"></a>指定精度取整函数 round</h4><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">语法：<span class="token function">round</span><span class="token punctuation">(</span><span class="token keyword">double</span> a<span class="token punctuation">,</span> <span class="token keyword">int</span> d<span class="token punctuation">)</span>返回值：<span class="token keyword">double</span>说明：返回指定精度 d 的 <span class="token keyword">double</span> 类型示例：<span class="token keyword">select</span> <span class="token function">round</span><span class="token punctuation">(</span><span class="token number">3.1415926</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span> <span class="token keyword">from</span> tableName<span class="token punctuation">;</span>结果：<span class="token number">3.1416</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h4 id="向下取整函数-floor"><a href="#向下取整函数-floor" class="headerlink" title="向下取整函数 floor"></a>向下取整函数 floor</h4><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">语法：floor<span class="token punctuation">(</span><span class="token keyword">double</span> a<span class="token punctuation">)</span>返回值：<span class="token keyword">bigint</span>说明：返回等于或者小于该 <span class="token keyword">double</span> 变量的最大的整数示例：<span class="token keyword">select</span> floor<span class="token punctuation">(</span><span class="token number">3.641</span><span class="token punctuation">)</span> <span class="token keyword">from</span> tableName<span class="token punctuation">;</span>结果：<span class="token number">3</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h4 id="向上取整函数-ceil"><a href="#向上取整函数-ceil" class="headerlink" title="向上取整函数 ceil"></a>向上取整函数 ceil</h4><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">语法：ceil<span class="token punctuation">(</span><span class="token keyword">double</span> a<span class="token punctuation">)</span>返回值：<span class="token keyword">bigint</span>说明：返回等于或者大于该 <span class="token keyword">double</span> 变量的最小的整数示例：<span class="token keyword">select</span> ceil<span class="token punctuation">(</span><span class="token number">3.1415926</span><span class="token punctuation">)</span> <span class="token keyword">from</span> tableName<span class="token punctuation">;</span>结果：<span class="token number">4</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h4 id="取随机数函数-rand"><a href="#取随机数函数-rand" class="headerlink" title="取随机数函数 rand"></a>取随机数函数 rand</h4><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">语法：rand<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> rand<span class="token punctuation">(</span><span class="token keyword">int</span> seed<span class="token punctuation">)</span>返回值：<span class="token keyword">double</span>说明：返回一个 <span class="token number">0</span> 到 <span class="token number">1</span> 范围内的随机数。如果指定种子 seed，则会等到一个稳定的随机数序列示例：<span class="token keyword">select</span> rand<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">from</span> tableName<span class="token punctuation">;</span> <span class="token comment">-- 每次执行此语句得到的结果都不同</span>结果：<span class="token number">0.5577432776034763</span>示例：<span class="token keyword">select</span> rand<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">-- 只要指定种子，每次执行此语句得到的结果一样的</span>结果：<span class="token number">0.7220096548596434</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h4 id="自然指数函数-exp"><a href="#自然指数函数-exp" class="headerlink" title="自然指数函数 exp"></a>自然指数函数 exp</h4><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">语法：exp<span class="token punctuation">(</span><span class="token keyword">double</span> a<span class="token punctuation">)</span>返回值：<span class="token keyword">double</span>说明：返回自然对数 e 的 a 次方示例：<span class="token keyword">select</span> exp<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>结果：<span class="token number">7.38905609893065</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h4 id="以-10-为底对数函数-log10"><a href="#以-10-为底对数函数-log10" class="headerlink" title="以 10 为底对数函数 log10"></a>以 10 为底对数函数 log10</h4><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">语法：log10<span class="token punctuation">(</span><span class="token keyword">double</span> a<span class="token punctuation">)</span>返回值：<span class="token keyword">double</span>说明：返回以 <span class="token number">10</span> 为底的 a 的对数示例：<span class="token keyword">select</span> log10<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>结果：<span class="token number">2.0</span>此外还有：以 <span class="token number">2</span> 为底对数函数：log2<span class="token punctuation">(</span><span class="token punctuation">)</span>、对数函数：log<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h4 id="幂运算函数-pow"><a href="#幂运算函数-pow" class="headerlink" title="幂运算函数 pow"></a>幂运算函数 pow</h4><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">语法：pow<span class="token punctuation">(</span><span class="token keyword">double</span> a<span class="token punctuation">,</span> <span class="token keyword">double</span> p<span class="token punctuation">)</span>返回值：<span class="token keyword">double</span>说明：返回 a 的 p 次幂示例：<span class="token keyword">select</span> pow<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>结果：<span class="token number">16.0</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h4 id="开平方函数-sqrt"><a href="#开平方函数-sqrt" class="headerlink" title="开平方函数 sqrt"></a>开平方函数 sqrt</h4><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">语法：sqrt<span class="token punctuation">(</span><span class="token keyword">double</span> a<span class="token punctuation">)</span>返回值：<span class="token keyword">double</span>说明：返回 a 的平方根示例：<span class="token keyword">select</span> sqrt<span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span>结果：<span class="token number">4.0</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h4 id="二进制函数-bin"><a href="#二进制函数-bin" class="headerlink" title="二进制函数 bin"></a>二进制函数 bin</h4><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">语法：bin<span class="token punctuation">(</span><span class="token keyword">bigint</span> a<span class="token punctuation">)</span>返回值：string说明：返回a的二进制代码表示示例：<span class="token keyword">select</span> bin<span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">;</span>结果：<span class="token number">111</span>十六进制函数：hex<span class="token punctuation">(</span><span class="token punctuation">)</span>、将十六进制转化为字符串函数：unhex<span class="token punctuation">(</span><span class="token punctuation">)</span>进制转换函数：conv<span class="token punctuation">(</span><span class="token keyword">bigint</span> num<span class="token punctuation">,</span> <span class="token keyword">int</span> from_base<span class="token punctuation">,</span> <span class="token keyword">int</span> to_base<span class="token punctuation">)</span> 说明：将数值 num 从 from_base 进制转化到 to_base 进制<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p>此外还有很多数学函数：绝对值函数：<code>abs()</code>、正取余函数：<code>pmod()</code>、正弦函数：<code>sin()</code>、反正弦函数：<code>asin()</code>、余弦函数：<code>cos()</code>、反余弦函数：<code>acos()</code>、positive 函数：<code>positive()</code>、negative 函数：<code>negative()</code>。</p><h3 id="条件函数"><a href="#条件函数" class="headerlink" title="条件函数"></a>条件函数</h3><h4 id="IF-函数"><a href="#IF-函数" class="headerlink" title="IF 函数"></a>IF 函数</h4><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">语法：<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">boolean</span> testCondition<span class="token punctuation">,</span> T valueTrue<span class="token punctuation">,</span> T valueFalseOrNULL<span class="token punctuation">)</span>返回值：T说明：当条件 testCondition 为 <span class="token boolean">TRUE</span> 时，返回 valueTrue；否则返回 valueFalseOrNULL示例：<span class="token keyword">select</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>结果：<span class="token number">200</span>示例：<span class="token keyword">select</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>结果：<span class="token number">100</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h4 id="非空查找函数-coalesce"><a href="#非空查找函数-coalesce" class="headerlink" title="非空查找函数 coalesce"></a>非空查找函数 coalesce</h4><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">语法：<span class="token keyword">coalesce</span><span class="token punctuation">(</span>T v1<span class="token punctuation">,</span> T v2<span class="token punctuation">,</span> …<span class="token punctuation">)</span>返回值：T说明：返回参数中的第一个非空值；如果所有值都为 <span class="token boolean">NULL</span>，那么返回 <span class="token boolean">NULL</span>示例：<span class="token keyword">select</span> <span class="token keyword">coalesce</span><span class="token punctuation">(</span><span class="token boolean">NULL</span><span class="token punctuation">,</span> <span class="token string">'100'</span><span class="token punctuation">,</span> <span class="token string">'50'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>结果：<span class="token number">100</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h4 id="条件判断函数-case-when"><a href="#条件判断函数-case-when" class="headerlink" title="条件判断函数 case when"></a>条件判断函数 case when</h4><p><strong>用法一</strong></p><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">语法：<span class="token keyword">case</span> <span class="token keyword">when</span> a <span class="token keyword">then</span> b <span class="token punctuation">[</span><span class="token keyword">when</span> c <span class="token keyword">then</span> d<span class="token punctuation">]</span><span class="token operator">*</span> <span class="token punctuation">[</span><span class="token keyword">else</span> e<span class="token punctuation">]</span> <span class="token keyword">end</span>返回值：T说明：如果 a 为 <span class="token boolean">TRUE</span>，则返回 b；如果 c 为 <span class="token boolean">TRUE</span>，则返回 d；否则返回 e。示例：<span class="token keyword">select</span> <span class="token keyword">case</span> <span class="token keyword">when</span> <span class="token number">1</span><span class="token operator">=</span><span class="token number">2</span> <span class="token keyword">then</span> <span class="token string">'tom'</span> <span class="token keyword">when</span> <span class="token number">2</span><span class="token operator">=</span><span class="token number">2</span> <span class="token keyword">then</span> <span class="token string">'mary'</span> <span class="token keyword">else</span> <span class="token string">'tim'</span> <span class="token keyword">end</span> <span class="token keyword">from</span> tableName<span class="token punctuation">;</span>结果：mary<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p><strong>用法二</strong></p><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">语法：<span class="token keyword">case</span> a <span class="token keyword">when</span> b <span class="token keyword">then</span> c <span class="token punctuation">[</span><span class="token keyword">when</span> d <span class="token keyword">then</span> e<span class="token punctuation">]</span><span class="token operator">*</span> <span class="token punctuation">[</span><span class="token keyword">else</span> f<span class="token punctuation">]</span> <span class="token keyword">end</span>返回值：T说明：如果 a 等于 b，那么返回 c；如果 a 等于 d，那么返回 e；否则返回 f。示例：<span class="token keyword">select</span> <span class="token keyword">case</span> <span class="token number">100</span> <span class="token keyword">when</span> <span class="token number">50</span> <span class="token keyword">then</span> <span class="token string">'tom'</span> <span class="token keyword">when</span> <span class="token number">100</span> <span class="token keyword">then</span> <span class="token string">'mary'</span> <span class="token keyword">else</span> <span class="token string">'tim'</span> <span class="token keyword">end</span> <span class="token keyword">from</span> tableName<span class="token punctuation">;</span>结果：mary<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h3 id="日期函数"><a href="#日期函数" class="headerlink" title="日期函数"></a>日期函数</h3><p><strong>注意：</strong>以下 SQL 语句中的 <code>from tableName</code> 可去掉，不影响查询结果</p><h4 id="获取当前UNIX时间戳函数-unix-timestamp"><a href="#获取当前UNIX时间戳函数-unix-timestamp" class="headerlink" title="获取当前UNIX时间戳函数 unix_timestamp"></a>获取当前UNIX时间戳函数 unix_timestamp</h4><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">语法：unix_timestamp<span class="token punctuation">(</span><span class="token punctuation">)</span>返回值：<span class="token keyword">bigint</span>说明：获得当前时区的 UNIX 时间戳示例：<span class="token keyword">select</span> unix_timestamp<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">from</span> tableName<span class="token punctuation">;</span>结果：<span class="token number">1616906976</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h4 id="UNIX时间戳转日期函数-from-unixtime"><a href="#UNIX时间戳转日期函数-from-unixtime" class="headerlink" title="UNIX时间戳转日期函数 from_unixtime"></a>UNIX时间戳转日期函数 from_unixtime</h4><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">语法：from_unixtime<span class="token punctuation">(</span><span class="token keyword">bigint</span> unixtime<span class="token punctuation">[</span><span class="token punctuation">,</span> string format<span class="token punctuation">]</span><span class="token punctuation">)</span>返回值：string说明：转化 UNIX 时间戳（从 <span class="token number">1970</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">01</span> <span class="token number">00</span>:<span class="token number">00</span>:<span class="token number">00</span> UTC 到指定时间的秒数）到当前时区的时间格式示例：<span class="token keyword">select</span> from_unixtime<span class="token punctuation">(</span><span class="token number">1616906976</span><span class="token punctuation">,</span> <span class="token string">'yyyyMMdd'</span><span class="token punctuation">)</span> <span class="token keyword">from</span> tableName<span class="token punctuation">;</span>结果：<span class="token number">20210328</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h4 id="日期转UNIX时间戳函数-unix-timestamp"><a href="#日期转UNIX时间戳函数-unix-timestamp" class="headerlink" title="日期转UNIX时间戳函数 unix_timestamp"></a>日期转UNIX时间戳函数 unix_timestamp</h4><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">语法：unix_timestamp<span class="token punctuation">(</span>string <span class="token keyword">date</span><span class="token punctuation">)</span>返回值：<span class="token keyword">bigint</span>说明：转换格式为 <span class="token string">"yyyy-MM-dd HH:mm:ss"</span> 的日期到 UNIX 时间戳。如果转化失败，则返回 <span class="token boolean">NULL</span>。示例：<span class="token keyword">select</span> unix_timestamp<span class="token punctuation">(</span><span class="token string">'2021-03-08 14:21:15'</span><span class="token punctuation">)</span> <span class="token keyword">from</span> tableName<span class="token punctuation">;</span>结果：<span class="token number">1615184475</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h4 id="指定格式日期转-UNIX-时间戳函数-unix-timestamp"><a href="#指定格式日期转-UNIX-时间戳函数-unix-timestamp" class="headerlink" title="指定格式日期转 UNIX 时间戳函数 unix_timestamp"></a>指定格式日期转 UNIX 时间戳函数 unix_timestamp</h4><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">语法：unix_timestamp<span class="token punctuation">(</span>string <span class="token keyword">date</span><span class="token punctuation">,</span> string pattern<span class="token punctuation">)</span>返回值：<span class="token keyword">bigint</span>说明：转换 pattern 格式的日期到 UNIX 时间戳。如果转化失败，则返回 <span class="token boolean">NULL</span>。示例：<span class="token keyword">select</span> unix_timestamp<span class="token punctuation">(</span><span class="token string">'2021-03-08 14:21:15'</span><span class="token punctuation">,</span> <span class="token string">'yyyy-MM-dd HH:mm:ss'</span><span class="token punctuation">)</span> <span class="token keyword">from</span> tableName<span class="token punctuation">;</span>结果：<span class="token number">1615184475</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h4 id="日期时间转日期函数-to-date"><a href="#日期时间转日期函数-to-date" class="headerlink" title="日期时间转日期函数 to_date"></a>日期时间转日期函数 to_date</h4><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">语法：to_date<span class="token punctuation">(</span>string <span class="token keyword">timestamp</span><span class="token punctuation">)</span>返回值：string说明：返回日期时间字段中的日期部分。示例：<span class="token keyword">select</span> to_date<span class="token punctuation">(</span><span class="token string">'2021-03-28 14:03:01'</span><span class="token punctuation">)</span> <span class="token keyword">from</span> tableName<span class="token punctuation">;</span>结果：<span class="token number">2021</span><span class="token operator">-</span><span class="token number">03</span><span class="token operator">-</span><span class="token number">28</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h4 id="日期转年函数-year"><a href="#日期转年函数-year" class="headerlink" title="日期转年函数 year"></a>日期转年函数 year</h4><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">语法：<span class="token keyword">year</span><span class="token punctuation">(</span>string <span class="token keyword">date</span><span class="token punctuation">)</span>返回值：<span class="token keyword">int</span>说明：返回日期中的年。示例：<span class="token keyword">select</span> <span class="token keyword">year</span><span class="token punctuation">(</span><span class="token string">'2021-03-28 10:03:01'</span><span class="token punctuation">)</span> <span class="token keyword">from</span> tableName<span class="token punctuation">;</span>结果：<span class="token number">2021</span>示例：<span class="token keyword">select</span> <span class="token keyword">year</span><span class="token punctuation">(</span><span class="token string">'2021-03-28'</span><span class="token punctuation">)</span> <span class="token keyword">from</span> tableName<span class="token punctuation">;</span>结果：<span class="token number">2021</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h4 id="日期转月函数-month"><a href="#日期转月函数-month" class="headerlink" title="日期转月函数 month"></a>日期转月函数 month</h4><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">语法：<span class="token keyword">month</span> <span class="token punctuation">(</span>string <span class="token keyword">date</span><span class="token punctuation">)</span>返回值：<span class="token keyword">int</span>说明：返回日期中的月份。示例：<span class="token keyword">select</span> <span class="token keyword">month</span><span class="token punctuation">(</span><span class="token string">'2020-12-28 12:03:01'</span><span class="token punctuation">)</span> <span class="token keyword">from</span> tableName<span class="token punctuation">;</span>结果：<span class="token number">12</span>示例：<span class="token keyword">select</span> <span class="token keyword">month</span><span class="token punctuation">(</span><span class="token string">'2021-03-08'</span><span class="token punctuation">)</span> <span class="token keyword">from</span> tableName<span class="token punctuation">;</span>结果：<span class="token number">8</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h4 id="日期转天函数-day"><a href="#日期转天函数-day" class="headerlink" title="日期转天函数 day"></a>日期转天函数 day</h4><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">语法：<span class="token keyword">day</span> <span class="token punctuation">(</span>string <span class="token keyword">date</span><span class="token punctuation">)</span>返回值：<span class="token keyword">int</span>说明：返回日期中的天。示例：<span class="token keyword">select</span> <span class="token keyword">day</span><span class="token punctuation">(</span><span class="token string">'2020-12-08 10:03:01'</span><span class="token punctuation">)</span> <span class="token keyword">from</span> tableName<span class="token punctuation">;</span>结果：<span class="token number">8</span>示例：<span class="token keyword">select</span> <span class="token keyword">day</span><span class="token punctuation">(</span><span class="token string">'2020-12-24'</span><span class="token punctuation">)</span> <span class="token keyword">from</span> tableName<span class="token punctuation">;</span>结果：<span class="token number">24</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h4 id="日期转小时函数-hour"><a href="#日期转小时函数-hour" class="headerlink" title="日期转小时函数 hour"></a>日期转小时函数 hour</h4><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">语法：<span class="token keyword">hour</span> <span class="token punctuation">(</span>string <span class="token keyword">date</span><span class="token punctuation">)</span>返回值：<span class="token keyword">int</span>说明：返回日期中的小时。示例：<span class="token keyword">select</span> <span class="token keyword">hour</span><span class="token punctuation">(</span><span class="token string">'2020-12-08 10:03:01'</span><span class="token punctuation">)</span> <span class="token keyword">from</span> tableName<span class="token punctuation">;</span>结果：<span class="token number">10</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h4 id="日期转分钟函数-minute"><a href="#日期转分钟函数-minute" class="headerlink" title="日期转分钟函数 minute"></a>日期转分钟函数 minute</h4><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">语法：<span class="token keyword">minute</span> <span class="token punctuation">(</span>string <span class="token keyword">date</span><span class="token punctuation">)</span>返回值：<span class="token keyword">int</span>说明：返回日期中的分钟。示例：<span class="token keyword">select</span> <span class="token keyword">minute</span><span class="token punctuation">(</span><span class="token string">'2020-12-08 10:03:01'</span><span class="token punctuation">)</span> <span class="token keyword">from</span> tableName<span class="token punctuation">;</span>结果：<span class="token number">3</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h4 id="日期转秒函数-second"><a href="#日期转秒函数-second" class="headerlink" title="日期转秒函数 second"></a>日期转秒函数 second</h4><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">语法：<span class="token keyword">second</span> <span class="token punctuation">(</span>string <span class="token keyword">date</span><span class="token punctuation">)</span>返回值：<span class="token keyword">int</span>说明：返回日期中的秒。示例：<span class="token keyword">select</span> <span class="token keyword">second</span><span class="token punctuation">(</span><span class="token string">'2020-12-08 10:03:01'</span><span class="token punctuation">)</span> <span class="token keyword">from</span> tableName<span class="token punctuation">;</span>结果：<span class="token number">1</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h4 id="日期转周函数-weekofyear"><a href="#日期转周函数-weekofyear" class="headerlink" title="日期转周函数 weekofyear"></a>日期转周函数 weekofyear</h4><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">语法：weekofyear <span class="token punctuation">(</span>string <span class="token keyword">date</span><span class="token punctuation">)</span>返回值：<span class="token keyword">int</span>说明：返回日期在当前的周数。示例：<span class="token keyword">select</span> weekofyear<span class="token punctuation">(</span><span class="token string">'2020-12-08 10:03:01'</span><span class="token punctuation">)</span> <span class="token keyword">from</span> tableName<span class="token punctuation">;</span>结果：<span class="token number">49</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h4 id="日期比较函数-datediff"><a href="#日期比较函数-datediff" class="headerlink" title="日期比较函数 datediff"></a>日期比较函数 datediff</h4><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">语法：datediff<span class="token punctuation">(</span>string enddate<span class="token punctuation">,</span> string startdate<span class="token punctuation">)</span>返回值：<span class="token keyword">int</span>说明：返回结束日期减去开始日期的天数。示例：<span class="token keyword">select</span> datediff<span class="token punctuation">(</span><span class="token string">'2020-12-08'</span><span class="token punctuation">,</span> <span class="token string">'2012-05-09'</span><span class="token punctuation">)</span> <span class="token keyword">from</span> tableName<span class="token punctuation">;</span>结果：<span class="token number">213</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h4 id="日期增加函数-date-add"><a href="#日期增加函数-date-add" class="headerlink" title="日期增加函数 date_add"></a>日期增加函数 date_add</h4><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">语法：date_add<span class="token punctuation">(</span>string startdate<span class="token punctuation">,</span> <span class="token keyword">int</span> days<span class="token punctuation">)</span>返回值：string说明：返回开始日期 startdate 增加 days 天后的日期。示例：<span class="token keyword">select</span> date_add<span class="token punctuation">(</span><span class="token string">'2020-12-08'</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token keyword">from</span> tableName<span class="token punctuation">;</span>结果：<span class="token number">2020</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">18</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h4 id="日期减少函数-date-sub"><a href="#日期减少函数-date-sub" class="headerlink" title="日期减少函数 date_sub"></a>日期减少函数 date_sub</h4><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">语法：date_sub <span class="token punctuation">(</span>string startdate<span class="token punctuation">,</span> <span class="token keyword">int</span> days<span class="token punctuation">)</span>返回值：string说明：返回开始日期 startdate 减少 days 天后的日期。示例：<span class="token keyword">select</span> date_sub<span class="token punctuation">(</span><span class="token string">'2020-12-08'</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token keyword">from</span> tableName<span class="token punctuation">;</span>结果：<span class="token number">2020</span><span class="token operator">-</span><span class="token number">11</span><span class="token operator">-</span><span class="token number">28</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h3 id="字符串函数"><a href="#字符串函数" class="headerlink" title="字符串函数"></a>字符串函数</h3><h4 id="字符串长度函数-length"><a href="#字符串长度函数-length" class="headerlink" title="字符串长度函数 length"></a>字符串长度函数 length</h4><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">语法：length<span class="token punctuation">(</span>string A<span class="token punctuation">)</span>返回值：<span class="token keyword">int</span>说明：返回字符串A的长度示例：<span class="token keyword">select</span> length<span class="token punctuation">(</span><span class="token string">'abcdefg'</span><span class="token punctuation">)</span> <span class="token keyword">from</span> tableName<span class="token punctuation">;</span>结果：<span class="token number">7</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h4 id="字符串反转函数-reverse"><a href="#字符串反转函数-reverse" class="headerlink" title="字符串反转函数 reverse"></a>字符串反转函数 reverse</h4><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">语法：reverse<span class="token punctuation">(</span>string A<span class="token punctuation">)</span>返回值：string说明：返回字符串A的反转结果示例：<span class="token keyword">select</span> reverse<span class="token punctuation">(</span><span class="token string">'abcdefg'</span><span class="token punctuation">)</span> <span class="token keyword">from</span> tableName<span class="token punctuation">;</span>结果：gfedcba<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h4 id="字符串连接函数-concat"><a href="#字符串连接函数-concat" class="headerlink" title="字符串连接函数 concat"></a>字符串连接函数 concat</h4><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">语法：concat<span class="token punctuation">(</span>string A<span class="token punctuation">,</span> string B…<span class="token punctuation">)</span>返回值：string说明：返回输入字符串连接后的结果，支持任意个输入字符串示例：<span class="token keyword">select</span> concat<span class="token punctuation">(</span><span class="token string">'abc'</span><span class="token punctuation">,</span> <span class="token string">'def'</span><span class="token punctuation">,</span> <span class="token string">'gh'</span><span class="token punctuation">)</span> <span class="token keyword">from</span> tableName<span class="token punctuation">;</span>结果：abcdefgh<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h4 id="带分隔符字符串连接函数-concat-ws"><a href="#带分隔符字符串连接函数-concat-ws" class="headerlink" title="带分隔符字符串连接函数 concat_ws"></a>带分隔符字符串连接函数 concat_ws</h4><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">语法：concat_ws<span class="token punctuation">(</span>string SEP<span class="token punctuation">,</span> string A<span class="token punctuation">,</span> string B…<span class="token punctuation">)</span>返回值：string说明：返回输入字符串连接后的结果，SEP 表示各个字符串间的分隔符示例：<span class="token keyword">select</span> concat_ws<span class="token punctuation">(</span><span class="token string">','</span><span class="token punctuation">,</span> <span class="token string">'abc'</span><span class="token punctuation">,</span> <span class="token string">'def'</span><span class="token punctuation">,</span> <span class="token string">'gh'</span><span class="token punctuation">)</span> <span class="token keyword">from</span> tableName<span class="token punctuation">;</span>结果：abc<span class="token punctuation">,</span>def<span class="token punctuation">,</span>gh<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h4 id="字符串截取函数-substr-substring"><a href="#字符串截取函数-substr-substring" class="headerlink" title="字符串截取函数 substr, substring"></a>字符串截取函数 substr, substring</h4><p><strong>用法一</strong></p><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">语法：substr<span class="token punctuation">(</span>string A<span class="token punctuation">,</span> <span class="token keyword">int</span> <span class="token keyword">start</span><span class="token punctuation">)</span><span class="token punctuation">,</span> substring<span class="token punctuation">(</span>string A<span class="token punctuation">,</span> <span class="token keyword">int</span> <span class="token keyword">start</span><span class="token punctuation">)</span>返回值：string说明：返回字符串 A 从 <span class="token keyword">start</span> 位置到结尾的字符串示例：<span class="token keyword">select</span> substr<span class="token punctuation">(</span><span class="token string">'abcde'</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token keyword">from</span> tableName<span class="token punctuation">;</span>结果：cde示例：<span class="token keyword">select</span> substring<span class="token punctuation">(</span><span class="token string">'abcde'</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token keyword">from</span> tableName<span class="token punctuation">;</span>结果：cde示例：<span class="token keyword">select</span> substr<span class="token punctuation">(</span><span class="token string">'abcde'</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">from</span> tableName<span class="token punctuation">;</span>结果：e<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p><strong>用法二</strong></p><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">语法：substr<span class="token punctuation">(</span>string A<span class="token punctuation">,</span> <span class="token keyword">int</span> <span class="token keyword">start</span><span class="token punctuation">,</span> <span class="token keyword">int</span> len<span class="token punctuation">)</span><span class="token punctuation">,</span> substring<span class="token punctuation">(</span>string A<span class="token punctuation">,</span> <span class="token keyword">int</span> <span class="token keyword">start</span><span class="token punctuation">,</span> <span class="token keyword">int</span> len<span class="token punctuation">)</span>返回值：string说明：返回字符串 A 从 <span class="token keyword">start</span> 位置开始，长度为 len 的字符串示例：<span class="token keyword">select</span> substr<span class="token punctuation">(</span><span class="token string">'abcde'</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token keyword">from</span> tableName<span class="token punctuation">;</span>结果：cd示例：<span class="token keyword">select</span> substring<span class="token punctuation">(</span><span class="token string">'abcde'</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token keyword">from</span> tableName<span class="token punctuation">;</span>结果：cd示例：<span class="token keyword">select</span> substring<span class="token punctuation">(</span><span class="token string">'abcde'</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token keyword">from</span> tableName<span class="token punctuation">;</span>结果：de<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h4 id="字符串转大写函数-upper-ucase"><a href="#字符串转大写函数-upper-ucase" class="headerlink" title="字符串转大写函数 upper, ucase"></a>字符串转大写函数 upper, ucase</h4><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">语法：upper<span class="token punctuation">(</span>string A<span class="token punctuation">)</span> <span class="token function">ucase</span><span class="token punctuation">(</span>string A<span class="token punctuation">)</span>返回值：string说明：返回字符串 A 的大写格式示例：<span class="token keyword">select</span> upper<span class="token punctuation">(</span><span class="token string">'abSEd'</span><span class="token punctuation">)</span> <span class="token keyword">from</span> tableName<span class="token punctuation">;</span>结果：ABSED示例：<span class="token keyword">select</span> <span class="token function">ucase</span><span class="token punctuation">(</span><span class="token string">'abSEd'</span><span class="token punctuation">)</span> <span class="token keyword">from</span> tableName<span class="token punctuation">;</span>结果：ABSED<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h4 id="字符串转小写函数-lower-lcase"><a href="#字符串转小写函数-lower-lcase" class="headerlink" title="字符串转小写函数 lower, lcase"></a>字符串转小写函数 lower, lcase</h4><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">语法：lower<span class="token punctuation">(</span>string A<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">lcase</span><span class="token punctuation">(</span>string A<span class="token punctuation">)</span>返回值：string说明：返回字符串 A 的小写格式示例：<span class="token keyword">select</span> lower<span class="token punctuation">(</span><span class="token string">'abSEd'</span><span class="token punctuation">)</span> <span class="token keyword">from</span> tableName<span class="token punctuation">;</span>结果：absed示例：<span class="token keyword">select</span> <span class="token function">lcase</span><span class="token punctuation">(</span><span class="token string">'abSEd'</span><span class="token punctuation">)</span> <span class="token keyword">from</span> tableName<span class="token punctuation">;</span>结果：absed<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h4 id="去空格函数-trim"><a href="#去空格函数-trim" class="headerlink" title="去空格函数 trim"></a>去空格函数 trim</h4><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">语法：trim<span class="token punctuation">(</span>string A<span class="token punctuation">)</span>返回值：string说明：去除字符串两边的空格示例：<span class="token keyword">select</span> trim<span class="token punctuation">(</span><span class="token string">' abc '</span><span class="token punctuation">)</span> <span class="token keyword">from</span> tableName<span class="token punctuation">;</span>结果：abc<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h4 id="左边去空格函数-ltrim"><a href="#左边去空格函数-ltrim" class="headerlink" title="左边去空格函数 ltrim"></a>左边去空格函数 ltrim</h4><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">语法：ltrim<span class="token punctuation">(</span>string A<span class="token punctuation">)</span>返回值：string说明：去除字符串左边的空格示例：<span class="token keyword">select</span> ltrim<span class="token punctuation">(</span><span class="token string">' abc '</span><span class="token punctuation">)</span> <span class="token keyword">from</span> tableName<span class="token punctuation">;</span>结果：abc<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h4 id="右边去空格函数-rtrim"><a href="#右边去空格函数-rtrim" class="headerlink" title="右边去空格函数 rtrim"></a>右边去空格函数 rtrim</h4><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">语法：rtrim<span class="token punctuation">(</span>string A<span class="token punctuation">)</span>返回值：string说明：去除字符串右边的空格示例：<span class="token keyword">select</span> rtrim<span class="token punctuation">(</span><span class="token string">' abc '</span><span class="token punctuation">)</span> <span class="token keyword">from</span> tableName<span class="token punctuation">;</span>结果：abc<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h4 id="正则表达式替换函数-regexp-replace"><a href="#正则表达式替换函数-regexp-replace" class="headerlink" title="正则表达式替换函数 regexp_replace"></a>正则表达式替换函数 regexp_replace</h4><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">语法：regexp_replace<span class="token punctuation">(</span>string A<span class="token punctuation">,</span> string B<span class="token punctuation">,</span> string C<span class="token punctuation">)</span>返回值：string说明：将字符串 A 中的符合 Java 正则表达式 B 的部分替换为 C。注意，在有些情况下要使用转义字符，类似 oracle 中的 regexp_replace 函数。示例：<span class="token keyword">select</span> regexp_replace<span class="token punctuation">(</span><span class="token string">'foobar'</span><span class="token punctuation">,</span> <span class="token string">'oo|ar'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span> <span class="token keyword">from</span> tableName<span class="token punctuation">;</span>结果：fb<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h4 id="正则表达式解析函数-regexp-extract"><a href="#正则表达式解析函数-regexp-extract" class="headerlink" title="正则表达式解析函数 regexp_extract"></a>正则表达式解析函数 regexp_extract</h4><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">语法：regexp_extract<span class="token punctuation">(</span>string subject<span class="token punctuation">,</span> string pattern<span class="token punctuation">,</span> <span class="token keyword">int</span> <span class="token keyword">index</span><span class="token punctuation">)</span>返回值：string说明：将字符串 subject 按照 pattern 正则表达式的规则拆分，返回 <span class="token keyword">index</span> 指定的字符。示例：<span class="token keyword">select</span> regexp_extract<span class="token punctuation">(</span><span class="token string">'foothebar'</span><span class="token punctuation">,</span> <span class="token string">'foo(.*?)(bar)'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">from</span> tableName<span class="token punctuation">;</span>结果：the示例：<span class="token keyword">select</span> regexp_extract<span class="token punctuation">(</span><span class="token string">'foothebar'</span><span class="token punctuation">,</span> <span class="token string">'foo(.*?)(bar)'</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token keyword">from</span> tableName<span class="token punctuation">;</span>结果：bar示例：<span class="token keyword">select</span> regexp_extract<span class="token punctuation">(</span><span class="token string">'foothebar'</span><span class="token punctuation">,</span> <span class="token string">'foo(.*?)(bar)'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">from</span> tableName<span class="token punctuation">;</span>结果：foothebar<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p><strong>注意：</strong>在有些情况下要使用转义字符，下面的等号要用双竖线转义，这是 Java 正则表达式的规则。</p><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> data_field<span class="token punctuation">,</span>regexp_extract<span class="token punctuation">(</span>data_field<span class="token punctuation">,</span> <span class="token string">'.*?bgStart\\=([^&amp;]+)'</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">as</span> aaa<span class="token punctuation">,</span>regexp_extract<span class="token punctuation">(</span>data_field<span class="token punctuation">,</span> <span class="token string">'.*?contentLoaded_headStart\\=([^&amp;]+)'</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">as</span> bbb<span class="token punctuation">,</span>regexp_extract<span class="token punctuation">(</span>data_field<span class="token punctuation">,</span> <span class="token string">'.*?AppLoad2Req\\=([^&amp;]+)'</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">as</span> ccc <span class="token keyword">from</span> pt_nginx_loginlog_st <span class="token keyword">where</span> pt <span class="token operator">=</span> <span class="token string">'2021-03-28'</span> <span class="token keyword">limit</span> <span class="token number">2</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h4 id="URL解析函数-parse-url"><a href="#URL解析函数-parse-url" class="headerlink" title="URL解析函数 parse_url"></a>URL解析函数 parse_url</h4><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">语法：parse_url<span class="token punctuation">(</span>string urlString<span class="token punctuation">,</span> string partToExtract <span class="token punctuation">[</span><span class="token punctuation">,</span> string keyToExtract<span class="token punctuation">]</span><span class="token punctuation">)</span>返回值：string说明：返回 URL 中指定的部分。partToExtract 的有效值为：HOST，PATH，QUERY，REF，PROTOCOL，AUTHORITY，<span class="token keyword">FILE</span>，USERINFO。示例：<span class="token keyword">select</span> parse_url<span class="token punctuation">(</span><span class="token string">'https://www.tableName.com/path1/p.php?k1=v1&amp;k2=v2#Ref1'</span><span class="token punctuation">,</span> <span class="token string">'HOST'</span><span class="token punctuation">)</span> <span class="token keyword">from</span> tableName<span class="token punctuation">;</span>结果：www<span class="token punctuation">.</span>tableName<span class="token punctuation">.</span>com 示例：<span class="token keyword">select</span> parse_url<span class="token punctuation">(</span><span class="token string">'https://www.tableName.com/path1/p.php?k1=v1&amp;k2=v2#Ref1'</span><span class="token punctuation">,</span> <span class="token string">'QUERY'</span><span class="token punctuation">,</span> <span class="token string">'k1'</span><span class="token punctuation">)</span> <span class="token keyword">from</span> tableName<span class="token punctuation">;</span>结果：v1<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h4 id="JSON-解析函数-get-json-object"><a href="#JSON-解析函数-get-json-object" class="headerlink" title="JSON 解析函数 get_json_object"></a>JSON 解析函数 get_json_object</h4><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">语法：get_json_object<span class="token punctuation">(</span>string json_string<span class="token punctuation">,</span> string path<span class="token punctuation">)</span>返回值：string说明：解析 JSON 的字符串 json_string，返回 path 指定的内容。如果输入的 JSON 字符串无效，那么返回 <span class="token boolean">NULL</span>。示例：<span class="token keyword">select</span> get_json_object<span class="token punctuation">(</span><span class="token string">'&#123;"store":&#123;"fruit":\[&#123;"weight":8,"type":"apple"&#125;,&#123;"weight":9,"type":"pear"&#125;], "bicycle":&#123;"price":19.95,"color":"red"&#125; &#125;,"email":"amy@only_for_json_udf_test.net","owner":"amy"&#125;'</span><span class="token punctuation">,</span> <span class="token string">'$.owner'</span><span class="token punctuation">)</span> <span class="token keyword">from</span> tableName<span class="token punctuation">;</span>结果：amy<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h4 id="空格字符串函数-space"><a href="#空格字符串函数-space" class="headerlink" title="空格字符串函数 space"></a>空格字符串函数 space</h4><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">语法：space<span class="token punctuation">(</span><span class="token keyword">int</span> n<span class="token punctuation">)</span>返回值：string说明：返回长度为 n 的字符串示例：<span class="token keyword">select</span> space<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token keyword">from</span> tableName<span class="token punctuation">;</span>示例：<span class="token keyword">select</span> length<span class="token punctuation">(</span>space<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">from</span> tableName<span class="token punctuation">;</span>结果：<span class="token number">10</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h4 id="重复字符串函数-repeat"><a href="#重复字符串函数-repeat" class="headerlink" title="重复字符串函数 repeat"></a>重复字符串函数 repeat</h4><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">语法：<span class="token keyword">repeat</span><span class="token punctuation">(</span>string str<span class="token punctuation">,</span> <span class="token keyword">int</span> n<span class="token punctuation">)</span>返回值：string说明：返回重复 n 次后的 str 字符串示例：<span class="token keyword">select</span> <span class="token keyword">repeat</span><span class="token punctuation">(</span><span class="token string">'abc'</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span> <span class="token keyword">from</span> tableName<span class="token punctuation">;</span>结果：abcabcabcabcabc<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h4 id="首字符-ascii-函数"><a href="#首字符-ascii-函数" class="headerlink" title="首字符 ascii 函数"></a>首字符 ascii 函数</h4><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">语法：ascii<span class="token punctuation">(</span>string str<span class="token punctuation">)</span>返回值：<span class="token keyword">int</span>说明：返回字符串 str 第一个字符的 ascii 码示例：<span class="token keyword">select</span> ascii<span class="token punctuation">(</span><span class="token string">'abcde'</span><span class="token punctuation">)</span> <span class="token keyword">from</span> tableName<span class="token punctuation">;</span>结果：<span class="token number">97</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h4 id="左补足函数-lpad"><a href="#左补足函数-lpad" class="headerlink" title="左补足函数 lpad"></a>左补足函数 lpad</h4><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">语法：lpad<span class="token punctuation">(</span>string str<span class="token punctuation">,</span> <span class="token keyword">int</span> len<span class="token punctuation">,</span> string pad<span class="token punctuation">)</span>返回值：string说明：将 str 进行用 pad 进行左补足到 len 位示例：<span class="token keyword">select</span> lpad<span class="token punctuation">(</span><span class="token string">'abc'</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token string">'td'</span><span class="token punctuation">)</span> <span class="token keyword">from</span> tableName<span class="token punctuation">;</span>结果：tdtdtdtabc注意：与 GP，ORACLE 不同，pad 不能默认<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h4 id="右补足函数-rpad"><a href="#右补足函数-rpad" class="headerlink" title="右补足函数 rpad"></a>右补足函数 rpad</h4><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">语法：rpad<span class="token punctuation">(</span>string str<span class="token punctuation">,</span> <span class="token keyword">int</span> len<span class="token punctuation">,</span> string pad<span class="token punctuation">)</span>返回值：string说明：将 str 进行用 pad 进行右补足到 len 位示例：<span class="token keyword">select</span> rpad<span class="token punctuation">(</span><span class="token string">'abc'</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token string">'td'</span><span class="token punctuation">)</span> <span class="token keyword">from</span> tableName<span class="token punctuation">;</span>结果：abctdtdtdt<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h4 id="分割字符串函数-split"><a href="#分割字符串函数-split" class="headerlink" title="分割字符串函数 split"></a>分割字符串函数 split</h4><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">语法：split<span class="token punctuation">(</span>string str<span class="token punctuation">,</span> string pat<span class="token punctuation">)</span>返回值：array说明：按照 pat 字符串分割 str，会返回分割后的字符串数组示例：<span class="token keyword">select</span> split<span class="token punctuation">(</span><span class="token string">'abtcdtef'</span><span class="token punctuation">,</span> <span class="token string">'t'</span><span class="token punctuation">)</span> <span class="token keyword">from</span> tableName<span class="token punctuation">;</span>结果：<span class="token punctuation">[</span><span class="token string">"ab"</span><span class="token punctuation">,</span><span class="token string">"cd"</span><span class="token punctuation">,</span><span class="token string">"ef"</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h4 id="集合查找函数-find-in-set"><a href="#集合查找函数-find-in-set" class="headerlink" title="集合查找函数 find_in_set"></a>集合查找函数 find_in_set</h4><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">语法：find_in_set<span class="token punctuation">(</span>string str<span class="token punctuation">,</span> string strList<span class="token punctuation">)</span>返回值：<span class="token keyword">int</span>说明：返回 str 在 strlist 第一次出现的位置，strlist 是用逗号分割的字符串。如果没有找该 str 字符，则返回 <span class="token number">0</span>示例：<span class="token keyword">select</span> find_in_set<span class="token punctuation">(</span><span class="token string">'ab'</span><span class="token punctuation">,</span> <span class="token string">'ef,ab,de'</span><span class="token punctuation">)</span> <span class="token keyword">from</span> tableName<span class="token punctuation">;</span>结果：<span class="token number">2</span>示例：<span class="token keyword">select</span> find_in_set<span class="token punctuation">(</span><span class="token string">'at'</span><span class="token punctuation">,</span> <span class="token string">'ef,ab,de'</span><span class="token punctuation">)</span> <span class="token keyword">from</span> tableName<span class="token punctuation">;</span>结果：<span class="token number">0</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h3 id="复合类型构建操作"><a href="#复合类型构建操作" class="headerlink" title="复合类型构建操作"></a>复合类型构建操作</h3><h4 id="Map类型构建"><a href="#Map类型构建" class="headerlink" title="Map类型构建"></a>Map类型构建</h4><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">语法：map <span class="token punctuation">(</span>key1<span class="token punctuation">,</span> value1<span class="token punctuation">,</span> key2<span class="token punctuation">,</span> value2<span class="token punctuation">,</span> …<span class="token punctuation">)</span>说明：根据输入的 <span class="token keyword">key</span> 和 <span class="token keyword">value</span> 对构建 Map 类型示例：<span class="token keyword">Create</span> <span class="token keyword">table</span> mapTable <span class="token keyword">as</span> <span class="token keyword">select</span> map<span class="token punctuation">(</span><span class="token string">'100'</span><span class="token punctuation">,</span> <span class="token string">'tom'</span><span class="token punctuation">,</span> <span class="token string">'200'</span><span class="token punctuation">,</span> <span class="token string">'mary'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> t <span class="token keyword">from</span> tableName<span class="token punctuation">;</span>示例：<span class="token keyword">describe</span> mapTable<span class="token punctuation">;</span>结果：t    map<span class="token operator">&lt;</span>string <span class="token punctuation">,</span>string<span class="token operator">></span>示例：<span class="token keyword">select</span> t <span class="token keyword">from</span> tableName<span class="token punctuation">;</span>结果：&#123;<span class="token string">"100"</span>:<span class="token string">"tom"</span><span class="token punctuation">,</span><span class="token string">"200"</span>:<span class="token string">"mary"</span>&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h4 id="Struct类型构建"><a href="#Struct类型构建" class="headerlink" title="Struct类型构建"></a>Struct类型构建</h4><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">语法：struct<span class="token punctuation">(</span>val1<span class="token punctuation">,</span> val2<span class="token punctuation">,</span> val3<span class="token punctuation">,</span> …<span class="token punctuation">)</span>说明：根据输入的参数构建结构体 Struct 类型示例：<span class="token keyword">create</span> <span class="token keyword">table</span> struct_table <span class="token keyword">as</span> <span class="token keyword">select</span> struct<span class="token punctuation">(</span><span class="token string">'tom'</span><span class="token punctuation">,</span> <span class="token string">'mary'</span><span class="token punctuation">,</span> <span class="token string">'tim'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> t <span class="token keyword">from</span> tableName<span class="token punctuation">;</span>示例：<span class="token keyword">describe</span> struct_table<span class="token punctuation">;</span>结果：t    struct<span class="token operator">&lt;</span>col1:string<span class="token punctuation">,</span>col2:string<span class="token punctuation">,</span>col3:string<span class="token operator">></span>示例：<span class="token keyword">select</span> t <span class="token keyword">from</span> tableName<span class="token punctuation">;</span>结果：&#123;<span class="token string">"col1"</span>:<span class="token string">"tom"</span><span class="token punctuation">,</span><span class="token string">"col2"</span>:<span class="token string">"mary"</span><span class="token punctuation">,</span><span class="token string">"col3"</span>:<span class="token string">"tim"</span>&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h4 id="Array类型构建"><a href="#Array类型构建" class="headerlink" title="Array类型构建"></a>Array类型构建</h4><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">语法：array<span class="token punctuation">(</span>val1<span class="token punctuation">,</span> val2<span class="token punctuation">,</span> …<span class="token punctuation">)</span>说明：根据输入的参数构建数组 Array 类型示例：<span class="token keyword">create</span> <span class="token keyword">table</span> arr_table <span class="token keyword">as</span> <span class="token keyword">select</span> array<span class="token punctuation">(</span><span class="token string">'tom'</span><span class="token punctuation">,</span> <span class="token string">'mary'</span><span class="token punctuation">,</span> <span class="token string">'tim'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> t <span class="token keyword">from</span> tableName<span class="token punctuation">;</span>示例：<span class="token keyword">describe</span> tableName<span class="token punctuation">;</span>结果：t    array<span class="token operator">&lt;</span>string<span class="token operator">></span>示例：<span class="token keyword">select</span> t <span class="token keyword">from</span> tableName<span class="token punctuation">;</span>结果：<span class="token punctuation">[</span><span class="token string">"tom"</span><span class="token punctuation">,</span><span class="token string">"mary"</span><span class="token punctuation">,</span><span class="token string">"tim"</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h3 id="复杂类型访问操作"><a href="#复杂类型访问操作" class="headerlink" title="复杂类型访问操作"></a>复杂类型访问操作</h3><h4 id="Array-类型访问-A-n"><a href="#Array-类型访问-A-n" class="headerlink" title="Array 类型访问: A[n]"></a>Array 类型访问: A[n]</h4><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">语法：A<span class="token punctuation">[</span>n<span class="token punctuation">]</span>操作类型: A 为 array 类型，n 为 <span class="token keyword">int</span> 类型说明：返回数组 A 中的第 n 个变量值。数组的起始下标为 <span class="token number">0</span>。比如，A 是个值为 <span class="token punctuation">[</span><span class="token string">'foo'</span><span class="token punctuation">,</span> <span class="token string">'bar'</span><span class="token punctuation">]</span> 的数组类型，那么 A<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> 将返回 <span class="token string">'foo'</span>，而 A<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> 将返回 <span class="token string">'bar'</span>示例：<span class="token keyword">create</span> <span class="token keyword">table</span> arr_table2 <span class="token keyword">as</span> <span class="token keyword">select</span> array<span class="token punctuation">(</span><span class="token string">"tom"</span><span class="token punctuation">,</span><span class="token string">"mary"</span><span class="token punctuation">,</span><span class="token string">"tim"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> t <span class="token keyword">from</span> tableName<span class="token punctuation">;</span>示例：<span class="token keyword">select</span> t<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> t<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token keyword">from</span> arr_table2<span class="token punctuation">;</span>结果：tom    mary    tim<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h4 id="Map-类型访问-M-key"><a href="#Map-类型访问-M-key" class="headerlink" title="Map 类型访问: M[key]"></a>Map 类型访问: M[key]</h4><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">语法：M<span class="token punctuation">[</span><span class="token keyword">key</span><span class="token punctuation">]</span>操作类型: M 为 map 类型，<span class="token keyword">key</span> 为 map 中的 <span class="token keyword">key</span> 值说明：返回 map 类型 M 中，<span class="token keyword">key</span> 值为指定值的 <span class="token keyword">value</span> 值。比如，M 是值为 &#123;<span class="token string">'f'</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token string">'foo'</span><span class="token punctuation">,</span> <span class="token string">'b'</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token string">'bar'</span><span class="token punctuation">,</span> <span class="token string">'all'</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token string">'foobar'</span>&#125; 的 map 类型，那么 M<span class="token punctuation">[</span><span class="token string">'all'</span><span class="token punctuation">]</span> 将会返回 <span class="token string">'foobar'</span>示例：<span class="token keyword">Create</span> <span class="token keyword">table</span> map_table2 <span class="token keyword">as</span> <span class="token keyword">select</span> map<span class="token punctuation">(</span><span class="token string">'100'</span><span class="token punctuation">,</span> <span class="token string">'tom'</span><span class="token punctuation">,</span> <span class="token string">'200'</span><span class="token punctuation">,</span> <span class="token string">'mary'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> t <span class="token keyword">from</span> tableName<span class="token punctuation">;</span>示例：<span class="token keyword">select</span> t<span class="token punctuation">[</span><span class="token string">'200'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> t<span class="token punctuation">[</span><span class="token string">'100'</span><span class="token punctuation">]</span> <span class="token keyword">from</span> map_table2<span class="token punctuation">;</span>结果：mary    tom<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h4 id="Struct类型访问-S-x"><a href="#Struct类型访问-S-x" class="headerlink" title="Struct类型访问 S.x"></a>Struct类型访问 S.x</h4><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">语法：S<span class="token punctuation">.</span>x操作类型: S 为 struct 类型说明：返回结构体 S 中的 x 字段。比如，对于结构体 struct foobar &#123;<span class="token keyword">int</span> foo<span class="token punctuation">,</span> <span class="token keyword">int</span> bar&#125;，foobar<span class="token punctuation">.</span>foo 返回结构体中的 foo 字段示例：<span class="token keyword">create</span> <span class="token keyword">table</span> str_table2 <span class="token keyword">as</span> <span class="token keyword">select</span> struct<span class="token punctuation">(</span><span class="token string">'tom'</span><span class="token punctuation">,</span> <span class="token string">'mary'</span><span class="token punctuation">,</span> <span class="token string">'tim'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> t <span class="token keyword">from</span> tableName<span class="token punctuation">;</span>示例：<span class="token keyword">describe</span> tableName<span class="token punctuation">;</span>结果：t    struct<span class="token operator">&lt;</span>col1:string<span class="token punctuation">,</span>col2:string<span class="token punctuation">,</span>col3:string<span class="token operator">></span>示例：<span class="token keyword">select</span> t<span class="token punctuation">.</span>col1<span class="token punctuation">,</span> t<span class="token punctuation">.</span>col3 <span class="token keyword">from</span> str_table2<span class="token punctuation">;</span>结果：tom    tim<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h3 id="复杂类型长度统计函数"><a href="#复杂类型长度统计函数" class="headerlink" title="复杂类型长度统计函数"></a>复杂类型长度统计函数</h3><h4 id="Map-类型长度函数-size-Map"><a href="#Map-类型长度函数-size-Map" class="headerlink" title="Map 类型长度函数 size(Map)"></a>Map 类型长度函数 size(Map<k .v>)</k></h4><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">语法：size<span class="token punctuation">(</span>Map<span class="token operator">&lt;</span>k <span class="token punctuation">.</span>V<span class="token operator">></span><span class="token punctuation">)</span>返回值：<span class="token keyword">int</span>说明：返回 map 类型的长度示例：<span class="token keyword">select</span> size<span class="token punctuation">(</span>t<span class="token punctuation">)</span> <span class="token keyword">from</span> map_table2<span class="token punctuation">;</span>结果：<span class="token number">2</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h4 id="Array-类型长度函数-size-Array"><a href="#Array-类型长度函数-size-Array" class="headerlink" title="Array 类型长度函数 size(Array)"></a>Array 类型长度函数 size(Array)</h4><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">语法：size<span class="token punctuation">(</span>Array<span class="token operator">&lt;</span>T<span class="token operator">></span><span class="token punctuation">)</span>返回值：<span class="token keyword">int</span>说明：返回 array 类型的长度示例：<span class="token keyword">select</span> size<span class="token punctuation">(</span>t<span class="token punctuation">)</span> <span class="token keyword">from</span> arr_table2<span class="token punctuation">;</span>结果：<span class="token number">4</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h4 id="类型转换函数：cast"><a href="#类型转换函数：cast" class="headerlink" title="类型转换函数：cast"></a>类型转换函数：cast</h4><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">语法：cast<span class="token punctuation">(</span>expr <span class="token keyword">as</span> <span class="token operator">&lt;</span><span class="token keyword">type</span><span class="token operator">></span><span class="token punctuation">)</span>返回值：Expected <span class="token string">"="</span> <span class="token keyword">to</span> follow <span class="token string">"type"</span>说明：返回转换后的数据类型示例：<span class="token keyword">select</span> cast<span class="token punctuation">(</span><span class="token string">'1'</span> <span class="token keyword">as</span> <span class="token keyword">bigint</span><span class="token punctuation">)</span> <span class="token keyword">from</span> tableName<span class="token punctuation">;</span>结果：<span class="token number">1</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h2 id="行转列及列转行"><a href="#行转列及列转行" class="headerlink" title="行转列及列转行"></a>行转列及列转行</h2><h3 id="使用-explode-函数将-Hive-表中的-Map-和-Array-字段数据进行拆分"><a href="#使用-explode-函数将-Hive-表中的-Map-和-Array-字段数据进行拆分" class="headerlink" title="使用 explode 函数将 Hive 表中的 Map 和 Array 字段数据进行拆分"></a>使用 <code>explode</code> 函数将 Hive 表中的 Map 和 Array 字段数据进行拆分</h3><p><code>lateral view</code> 用于和 <code>split</code>、<code>explode</code> 等 UDTF 一起使用的，能将一行数据拆分成多行数据，在此基础上可以对拆分的数据进行聚合，<code>lateral view</code> 首先为原始表的每行调用 UDTF，UDTF 会把一行拆分成一行或者多行，<code>lateral view</code> 在把结果组合，产生一个支持别名表的虚拟表。</p><p>其中 <code>explode</code> 还可以用于将 Hive 一列中复杂的 array 或者 map 结构拆分成多行。</p><p><strong>需求：</strong></p><p>现在有数据格式如下</p><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">zhangsan    child1<span class="token punctuation">,</span>child2<span class="token punctuation">,</span>child3<span class="token punctuation">,</span>child4    k1:v1<span class="token punctuation">,</span>k2:v2lisi    child5<span class="token punctuation">,</span>child6<span class="token punctuation">,</span>child7<span class="token punctuation">,</span>child8    k3:v3<span class="token punctuation">,</span>k4:v4<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></p><p>字段之间使用 <code>\t</code> 分割，需求将所有的 child 进行拆开成为一列</p><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token operator">+</span><span class="token comment">----------+--+</span><span class="token operator">|</span> mychild <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">----------+--+</span><span class="token operator">|</span> child1  <span class="token operator">|</span><span class="token operator">|</span> child2  <span class="token operator">|</span><span class="token operator">|</span> child3  <span class="token operator">|</span><span class="token operator">|</span> child4  <span class="token operator">|</span><span class="token operator">|</span> child5  <span class="token operator">|</span><span class="token operator">|</span> child6  <span class="token operator">|</span><span class="token operator">|</span> child7  <span class="token operator">|</span><span class="token operator">|</span> child8  <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">----------+--+</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p>将 map 的 key 和 value 也进行拆开，成为如下结果</p><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token operator">+</span><span class="token comment">-----------+-------------+--+</span><span class="token operator">|</span> mymapkey <span class="token operator">|</span> mymapvalue <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">-----------+-------------+--+</span><span class="token operator">|</span> k1    <span class="token operator">|</span> v1     <span class="token operator">|</span><span class="token operator">|</span> k2    <span class="token operator">|</span> v2     <span class="token operator">|</span><span class="token operator">|</span> k3    <span class="token operator">|</span> v3     <span class="token operator">|</span><span class="token operator">|</span> k4    <span class="token operator">|</span> v4     <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">-----------+-------------+--+</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><ol><li><p>创建hive数据库</p><p> <pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">hive <span class="token punctuation">(</span><span class="token keyword">default</span><span class="token punctuation">)</span><span class="token operator">></span> <span class="token keyword">create</span> <span class="token keyword">database</span> hive_explode<span class="token punctuation">;</span>hive <span class="token punctuation">(</span><span class="token keyword">default</span><span class="token punctuation">)</span><span class="token operator">></span> <span class="token keyword">use</span> hive_explode<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></p></li><li><p>创建 Hive 表，然后使用 <code>explode</code> 拆分 map 和 array</p><p> <pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">hive <span class="token punctuation">(</span>hive_explode<span class="token punctuation">)</span><span class="token operator">></span> <span class="token keyword">create</span> <span class="token keyword">table</span> t3<span class="token punctuation">(</span>name string<span class="token punctuation">,</span>children array<span class="token operator">&lt;</span>string<span class="token operator">></span><span class="token punctuation">,</span>address Map<span class="token operator">&lt;</span>string<span class="token punctuation">,</span>string<span class="token operator">></span><span class="token punctuation">)</span> <span class="token keyword">row</span> format delimited <span class="token keyword">fields</span> <span class="token keyword">terminated</span> <span class="token keyword">by</span> <span class="token string">'\t'</span> collection items <span class="token keyword">terminated</span> <span class="token keyword">by</span> <span class="token string">','</span> map <span class="token keyword">keys</span> <span class="token keyword">terminated</span> <span class="token keyword">by</span> <span class="token string">':'</span> stored <span class="token keyword">as</span> textFile<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p></li><li>加载数据 node03 执行以下命令创建表数据文件<p> <pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">mkdir -p &#x2F;export&#x2F;servers&#x2F;hivedatas&#x2F;cd &#x2F;export&#x2F;servers&#x2F;hivedatas&#x2F;vim maparray<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></p> 内容如下:<p> <pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">zhangsan child1<span class="token punctuation">,</span>child2<span class="token punctuation">,</span>child3<span class="token punctuation">,</span>child4 k1:v1<span class="token punctuation">,</span>k2:v2lisi child5<span class="token punctuation">,</span>child6<span class="token punctuation">,</span>child7<span class="token punctuation">,</span>child8 k3:v3<span class="token punctuation">,</span>k4:v4<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></p> Hive 表当中加载数据<p> <pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">hive <span class="token punctuation">(</span>hive_explode<span class="token punctuation">)</span><span class="token operator">></span> <span class="token keyword">load</span> <span class="token keyword">data</span> <span class="token keyword">local</span> inpath <span class="token string">'/export/servers/hivedatas/maparray'</span> <span class="token keyword">into</span> <span class="token keyword">table</span> t3<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p></li><li><p>使用 <code>explode</code> 将 Hive 当中数据拆开</p><p> <pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token comment"># 将 array 当中的数据拆分开</span>hive <span class="token punctuation">(</span>hive_explode<span class="token punctuation">)</span><span class="token operator">></span> <span class="token keyword">SELECT</span> explode<span class="token punctuation">(</span>children<span class="token punctuation">)</span> <span class="token keyword">AS</span> myChild <span class="token keyword">FROM</span> t3<span class="token punctuation">;</span><span class="token comment"># 将 map 当中的数据拆分开</span>hive <span class="token punctuation">(</span>hive_explode<span class="token punctuation">)</span><span class="token operator">></span> <span class="token keyword">SELECT</span> explode<span class="token punctuation">(</span>address<span class="token punctuation">)</span> <span class="token keyword">AS</span> <span class="token punctuation">(</span>myMapKey<span class="token punctuation">,</span> myMapValue<span class="token punctuation">)</span> <span class="token keyword">FROM</span> t3<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></p></li></ol><h3 id="使用-explode-拆分-json-字符串"><a href="#使用-explode-拆分-json-字符串" class="headerlink" title="使用 explode 拆分 json 字符串"></a>使用 explode 拆分 json 字符串</h3><p><strong>需求：</strong></p><p>现在有一些数据格式如下：</p><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">a:shandong<span class="token punctuation">,</span>b:beijing<span class="token punctuation">,</span>c:hebei<span class="token operator">|</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token operator">|</span><span class="token punctuation">[</span>&#123;<span class="token string">"source"</span>:<span class="token string">"7fresh"</span><span class="token punctuation">,</span><span class="token string">"monthSales"</span>:<span class="token number">4900</span><span class="token punctuation">,</span><span class="token string">"userCount"</span>:<span class="token number">1900</span><span class="token punctuation">,</span><span class="token string">"score"</span>:<span class="token string">"9.9"</span>&#125;<span class="token punctuation">,</span>&#123;<span class="token string">"source"</span>:<span class="token string">"jd"</span><span class="token punctuation">,</span><span class="token string">"monthSales"</span>:<span class="token number">2090</span><span class="token punctuation">,</span><span class="token string">"userCount"</span>:<span class="token number">78981</span><span class="token punctuation">,</span><span class="token string">"score"</span>:<span class="token string">"9.8"</span>&#125;<span class="token punctuation">,</span>&#123;<span class="token string">"source"</span>:<span class="token string">"jdmart"</span><span class="token punctuation">,</span><span class="token string">"monthSales"</span>:<span class="token number">6987</span><span class="token punctuation">,</span><span class="token string">"userCount"</span>:<span class="token number">1600</span><span class="token punctuation">,</span><span class="token string">"score"</span>:<span class="token string">"9.0"</span>&#125;<span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><p>其中字段与字段之间的分隔符是 <code>|</code>。</p><p>我们要解析得到所有的 monthSales 对应的值为以下这一列（行转列）</p><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token number">4900</span><span class="token number">2090</span><span class="token number">6987</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></p><ol><li>创建 Hive 表<p> <pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">create</span> <span class="token keyword">table</span> explode_lateral_view<span class="token punctuation">(</span><span class="token punctuation">`</span>area<span class="token punctuation">`</span> string<span class="token punctuation">,</span><span class="token punctuation">`</span>goods_id<span class="token punctuation">`</span> string<span class="token punctuation">,</span><span class="token punctuation">`</span>sale_info<span class="token punctuation">`</span> string<span class="token punctuation">)</span><span class="token keyword">ROW</span> FORMAT DELIMITED<span class="token keyword">FIELDS</span> <span class="token keyword">TERMINATED</span> <span class="token keyword">BY</span> <span class="token string">'|'</span>STORED <span class="token keyword">AS</span> textfile<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p></li><li><p>准备数据并加载数据</p><p> 准备数据如下</p><p> <pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">cd &#x2F;export&#x2F;servers&#x2F;hivedatasvim explode_jsona:shandong,b:beijing,c:hebei|1,2,3,4,5,6,7,8,9|[&#123;&quot;source&quot;:&quot;7fresh&quot;,&quot;monthSales&quot;:4900,&quot;userCount&quot;:1900,&quot;score&quot;:&quot;9.9&quot;&#125;,&#123;&quot;source&quot;:&quot;jd&quot;,&quot;monthSales&quot;:2090,&quot;userCount&quot;:78981,&quot;score&quot;:&quot;9.8&quot;&#125;,&#123;&quot;source&quot;:&quot;jdmart&quot;,&quot;monthSales&quot;:6987,&quot;userCount&quot;:1600,&quot;score&quot;:&quot;9.0&quot;&#125;]<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></p><p> 加载数据到 Hive 表当中去</p><p> <pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">hive <span class="token punctuation">(</span>hive_explode<span class="token punctuation">)</span><span class="token operator">></span> <span class="token keyword">load</span> <span class="token keyword">data</span> <span class="token keyword">local</span> inpath <span class="token string">'/export/servers/hivedatas/explode_json'</span> overwrite <span class="token keyword">into</span> <span class="token keyword">table</span> explode_lateral_view<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p></li><li>使用 <code>explode</code> 拆分 Array<p> <pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">hive <span class="token punctuation">(</span>hive_explode<span class="token punctuation">)</span><span class="token operator">></span> <span class="token keyword">select</span> explode<span class="token punctuation">(</span>split<span class="token punctuation">(</span>goods_id<span class="token punctuation">,</span> <span class="token string">','</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">as</span> goods_id <span class="token keyword">from</span> explode_lateral_view<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p></li><li>使用 <code>explode</code> 拆解 Map<p> <pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">hive <span class="token punctuation">(</span>hive_explode<span class="token punctuation">)</span><span class="token operator">></span> <span class="token keyword">select</span> explode<span class="token punctuation">(</span>split<span class="token punctuation">(</span>area<span class="token punctuation">,</span> <span class="token string">','</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">as</span> area <span class="token keyword">from</span> explode_lateral_view<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p></li><li><p>拆解 JSON 字段</p><p> <pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">hive <span class="token punctuation">(</span>hive_explode<span class="token punctuation">)</span><span class="token operator">></span> <span class="token keyword">select</span> explode<span class="token punctuation">(</span>split<span class="token punctuation">(</span>regexp_replace<span class="token punctuation">(</span>regexp_replace<span class="token punctuation">(</span>sale_info<span class="token punctuation">,</span> <span class="token string">'\\[\\&#123;'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'&#125;]'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'&#125;,\\&#123;'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">as</span> sale_info <span class="token keyword">from</span> explode_lateral_view<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><p> 然后我们想用 <code>get_json_object</code> 来获取 key 为 monthSales 的数据：</p><p> <pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">hive <span class="token punctuation">(</span>hive_explode<span class="token punctuation">)</span><span class="token operator">></span> <span class="token keyword">select</span> get_json_object<span class="token punctuation">(</span>explode<span class="token punctuation">(</span>split<span class="token punctuation">(</span>regexp_replace<span class="token punctuation">(</span>regexp_replace<span class="token punctuation">(</span>sale_info<span class="token punctuation">,</span> <span class="token string">'\\[\\&#123;'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'&#125;]'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'&#125;,\\&#123;'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'$.monthSales'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> sale_info <span class="token keyword">from</span> explode_lateral_view<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><p> 然后挂了 <code>FAILED: SemanticException [Error 10081]: UDTF&#39;s are not supported outside the SELECT clause, nor nested in expressions</code></p><p> UDTF <code>explode</code> 不能写在别的函数内</p><p> 如果你这么写，想查两个字段，<code>select explode(split(area, &#39;,&#39;)) as area, good_id from explode_lateral_view;</code></p><p> 会报错 <code>FAILED: SemanticException 1:40 Only a single expression in the SELECT clause is supported with UDTF&#39;s. Error encountered near token &#39;good_id&#39;</code></p><p> 使用 UDTF 的时候，只支持一个字段，这时候就需要 LATERAL VIEW 出场了</p></li></ol><h3 id="配合-LATERAL-VIEW-使用"><a href="#配合-LATERAL-VIEW-使用" class="headerlink" title="配合 LATERAL VIEW 使用"></a>配合 LATERAL VIEW 使用</h3><p>配合 <code>lateral view</code> 查询多个字段</p><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">hive <span class="token punctuation">(</span>hive_explode<span class="token punctuation">)</span><span class="token operator">></span> <span class="token keyword">select</span> goods_id2<span class="token punctuation">,</span> sale_info <span class="token keyword">from</span> explode_lateral_view LATERAL <span class="token keyword">VIEW</span> explode<span class="token punctuation">(</span>split<span class="token punctuation">(</span>goods_id<span class="token punctuation">,</span> <span class="token string">','</span><span class="token punctuation">)</span><span class="token punctuation">)</span> goods <span class="token keyword">as</span> goods_id2<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><p>其中 <code>LATERAL VIEW explode(split(goods_id,&#39;,&#39;)) goods</code>相当于一个虚拟表，与原表 <code>explode_lateral_view</code> 笛卡尔积关联</p><p>也可以多重使用</p><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">hive <span class="token punctuation">(</span>hive_explode<span class="token punctuation">)</span><span class="token operator">></span> <span class="token keyword">select</span> goods_id2<span class="token punctuation">,</span> sale_info<span class="token punctuation">,</span> area2          <span class="token keyword">from</span> explode_lateral_view           LATERAL <span class="token keyword">VIEW</span> explode<span class="token punctuation">(</span>split<span class="token punctuation">(</span>goods_id<span class="token punctuation">,</span> <span class="token string">','</span><span class="token punctuation">)</span><span class="token punctuation">)</span> goods <span class="token keyword">as</span> goods_id2           LATERAL <span class="token keyword">VIEW</span> explode<span class="token punctuation">(</span>split<span class="token punctuation">(</span>area<span class="token punctuation">,</span> <span class="token string">','</span><span class="token punctuation">)</span><span class="token punctuation">)</span> area <span class="token keyword">as</span> area2<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></p><p>也是三个表笛卡尔积的结果。</p><p>最终，我们可以通过下面的句子，把这个 JSON 格式的一行数据，完全转换成二维表的方式展现</p><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">hive <span class="token punctuation">(</span>hive_explode<span class="token punctuation">)</span><span class="token operator">></span> <span class="token keyword">select</span> get_json_object<span class="token punctuation">(</span>concat<span class="token punctuation">(</span><span class="token string">'&#123;'</span><span class="token punctuation">,</span> sale_info_1 <span class="token punctuation">,</span> <span class="token string">'&#125;'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'$.source'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> source<span class="token punctuation">,</span>              get_json_object<span class="token punctuation">(</span>concat<span class="token punctuation">(</span><span class="token string">'&#123;'</span><span class="token punctuation">,</span> sale_info_1<span class="token punctuation">,</span> <span class="token string">'&#125;'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'$.monthSales'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> monthSales<span class="token punctuation">,</span>              get_json_object<span class="token punctuation">(</span>concat<span class="token punctuation">(</span><span class="token string">'&#123;'</span><span class="token punctuation">,</span> sale_info_1<span class="token punctuation">,</span> <span class="token string">'&#125;'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'$.userCount'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> monthSales<span class="token punctuation">,</span>              get_json_object<span class="token punctuation">(</span>concat<span class="token punctuation">(</span><span class="token string">'&#123;'</span><span class="token punctuation">,</span> sale_info_1<span class="token punctuation">,</span> <span class="token string">'&#125;'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'$.score'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> monthSales          <span class="token keyword">from</span> explode_lateral_view          LATERAL <span class="token keyword">VIEW</span> explode<span class="token punctuation">(</span>split<span class="token punctuation">(</span>regexp_replace<span class="token punctuation">(</span>regexp_replace<span class="token punctuation">(</span>sale_info<span class="token punctuation">,</span> <span class="token string">'\\[\\&#123;'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'&#125;]'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'&#125;,\\&#123;'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> sale_info <span class="token keyword">as</span> sale_info_1<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p><strong>总结：</strong></p><p><code>Lateral View</code> 通常和 UDTF 一起出现，为了解决 UDTF 不允许在 <code>select</code> 字段的问题。<code>Multiple Lateral View</code> 可以实现类似笛卡尔乘积。<code>Outer</code> 关键字可以把不输出的 UDTF 的空结果，输出成 NULL，防止丢失数据。</p><h3 id="行转列"><a href="#行转列" class="headerlink" title="行转列"></a>行转列</h3><p><strong>相关参数说明:</strong></p><ul><li><p><code>CONCAT(string A/col, string B/col…)</code>：返回输入字符串连接后的结果，支持任意个输入字符串;</p></li><li><p><code>CONCAT_WS(separator, str1, str2,...)</code>：它是一个特殊形式的 <code>CONCAT()</code>。第一个参数是剩余参数间的分隔符。分隔符可以是与剩余参数一样的字符串。如果分隔符是 NULL，返回值也将为 NULL。这个函数会跳过分隔符参数后的任何 NULL 和空字符串。分隔符将被加到被连接的字符串之间;</p></li><li><p><code>COLLECT_SET(col)</code>：函数只接受基本数据类型，它的主要作用是将某字段的值进行去重汇总，产生 Array 类型字段。</p></li></ul><p><strong>数据准备:</strong></p><div class="table-container"><table><thead><tr><th>name</th><th>constellation</th><th>blood_type</th></tr></thead><tbody><tr><td>孙悟空</td><td>白羊座</td><td>A</td></tr><tr><td>老王</td><td>射手座</td><td>A</td></tr><tr><td>宋宋</td><td>白羊座</td><td>B</td></tr><tr><td>猪八戒</td><td>白羊座</td><td>A</td></tr><tr><td>凤姐</td><td>射手座</td><td>A</td></tr></tbody></table></div><p><strong>需求: </strong></p><p>把星座和血型一样的人归类到一起。结果如下：</p><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">射手座<span class="token punctuation">,</span>A      老王<span class="token operator">|</span>凤姐白羊座<span class="token punctuation">,</span>A      孙悟空<span class="token operator">|</span>猪八戒白羊座<span class="token punctuation">,</span>B      宋宋<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></p><p><strong>实现步骤:</strong></p><ol><li>创建本地 <code>constellation.txt</code>，导入数据 node03 服务器执行以下命令创建文件，注意数据使用 <code>\t</code> 进行分割<p> <pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">cd &#x2F;export&#x2F;servers&#x2F;hivedatasvim constellation.txt数据如下：孙悟空 白羊座 A老王 射手座 A宋宋 白羊座 B猪八戒 白羊座 A凤姐 射手座 A<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p></li><li><p>创建 Hive 表并导入数据</p><p> <pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token comment"># 创建 Hive 表并加载数据</span>hive <span class="token punctuation">(</span>hive_explode<span class="token punctuation">)</span><span class="token operator">></span> <span class="token keyword">create</span> <span class="token keyword">table</span> person_info<span class="token punctuation">(</span>          name string<span class="token punctuation">,</span>           constellation string<span class="token punctuation">,</span>           blood_type string<span class="token punctuation">)</span>           <span class="token keyword">row</span> format delimited <span class="token keyword">fields</span> <span class="token keyword">terminated</span> <span class="token keyword">by</span> <span class="token string">"\t"</span><span class="token punctuation">;</span><span class="token comment"># 加载数据</span>hive <span class="token punctuation">(</span>hive_explode<span class="token punctuation">)</span><span class="token operator">></span> <span class="token keyword">load</span> <span class="token keyword">data</span> <span class="token keyword">local</span> inpath <span class="token string">'/export/servers/hivedatas/constellation.txt'</span> <span class="token keyword">into</span> <span class="token keyword">table</span> person_info<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p></li><li>按需求查询数据<p> <pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">hive <span class="token punctuation">(</span>hive_explode<span class="token punctuation">)</span><span class="token operator">></span> <span class="token keyword">select</span> t1<span class="token punctuation">.</span>base<span class="token punctuation">,</span> concat_ws<span class="token punctuation">(</span><span class="token string">'|'</span><span class="token punctuation">,</span> collect_set<span class="token punctuation">(</span>t1<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">)</span> name          <span class="token keyword">from</span> <span class="token punctuation">(</span><span class="token keyword">select</span> name<span class="token punctuation">,</span> concat<span class="token punctuation">(</span>constellation<span class="token punctuation">,</span> <span class="token string">","</span> <span class="token punctuation">,</span> blood_type<span class="token punctuation">)</span> base                  <span class="token keyword">from</span> person_info<span class="token punctuation">)</span> t1          <span class="token keyword">group</span> <span class="token keyword">by</span> t1<span class="token punctuation">.</span>base<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></p></li></ol><h3 id="列转行"><a href="#列转行" class="headerlink" title="列转行"></a>列转行</h3><p><strong>所需函数:</strong></p><p><code>EXPLODE(col)</code>：将 Hive 一列中复杂的 array 或者 map 结构拆分成多行。</p><p><code>LATERAL VIEW</code>：用于和 split, explode 等 UDTF 一起使用，它能够将一列数据拆成多行数据，在此基础上可以对拆分后的数据进行聚合。</p><p><strong>数据准备:</strong></p><p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">cd &#x2F;export&#x2F;servers&#x2F;hivedatasvim movie.txt<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></p><p>文件内容如下: 数据字段之间使用 <code>\t</code> 进行分割</p><p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">《疑犯追踪》 悬疑,动作,科幻,剧情《Lie to me》 悬疑,警匪,动作,心理,剧情《战狼2》 战争,动作,灾难<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></p><p><strong>需求: </strong></p><p>将电影分类中的数组数据展开。结果如下：</p><p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">《疑犯追踪》 悬疑《疑犯追踪》 动作《疑犯追踪》 科幻《疑犯追踪》 剧情《Lie to me》 悬疑《Lie to me》 警匪《Lie to me》 动作《Lie to me》 心理《Lie to me》 剧情《战狼2》 战争《战狼2》 动作《战狼2》 灾难<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p><strong>实现步骤:</strong></p><ol><li>创建 Hive 表<p> <pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">create</span> <span class="token keyword">table</span> movie_info<span class="token punctuation">(</span>  movie string<span class="token punctuation">,</span>   category array<span class="token operator">&lt;</span>string<span class="token operator">></span><span class="token punctuation">)</span> <span class="token keyword">row</span> format delimited <span class="token keyword">fields</span> <span class="token keyword">terminated</span> <span class="token keyword">by</span> <span class="token string">"\t"</span> collection items <span class="token keyword">terminated</span> <span class="token keyword">by</span> <span class="token string">","</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></p></li><li>加载数据<p> <pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">load</span> <span class="token keyword">data</span> <span class="token keyword">local</span> inpath <span class="token string">"/export/servers/hivedatas/movie.txt"</span> <span class="token keyword">into</span> <span class="token keyword">table</span> movie_info<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p></li><li>按需求查询数据<p> <pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> movie<span class="token punctuation">,</span> category_name  <span class="token keyword">from</span> movie_info lateral <span class="token keyword">view</span> explode<span class="token punctuation">(</span>category<span class="token punctuation">)</span> table_tmp <span class="token keyword">as</span> category_name<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></p></li></ol><h3 id="REFLECT-函数"><a href="#REFLECT-函数" class="headerlink" title="REFLECT 函数"></a>REFLECT 函数</h3><p><code>reflect</code> 函数可以支持在 SQL 中调用 <code>Java</code> 中的自带函数，秒杀一切 UDF 函数。</p><p><strong>需求1: 使用 java.lang.Math 当中的 Max 求两列中最大值</strong></p><p><strong>实现步骤:</strong></p><ol><li>创建 Hive 表<p> <pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">create</span> <span class="token keyword">table</span> test_udf<span class="token punctuation">(</span>col1 <span class="token keyword">int</span><span class="token punctuation">,</span> col2 <span class="token keyword">int</span><span class="token punctuation">)</span> <span class="token keyword">row</span> format delimited <span class="token keyword">fields</span> <span class="token keyword">terminated</span> <span class="token keyword">by</span> <span class="token string">','</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p></li><li>准备数据并加载数据<p> <pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">cd &#x2F;export&#x2F;servers&#x2F;hivedatasvim test_udf <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></p> 文件内容如下:<p> <pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">1,24,36,47,55,6<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></p></li><li>加载数据<p> <pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">hive <span class="token punctuation">(</span>hive_explode<span class="token punctuation">)</span><span class="token operator">></span> <span class="token keyword">load</span> <span class="token keyword">data</span> <span class="token keyword">local</span> inpath <span class="token string">'/export/servers/hivedatas/test_udf'</span> overwrite <span class="token keyword">into</span> <span class="token keyword">table</span> test_udf<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p></li><li>使用 <code>java.lang.Math</code> 当中的 <code>Max</code> 求两列当中的最大值<p> <pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">hive <span class="token punctuation">(</span>hive_explode<span class="token punctuation">)</span><span class="token operator">></span> <span class="token keyword">select</span> reflect<span class="token punctuation">(</span><span class="token string">"java.lang.Math"</span><span class="token punctuation">,</span> <span class="token string">"max"</span><span class="token punctuation">,</span> col1<span class="token punctuation">,</span> col2<span class="token punctuation">)</span> <span class="token keyword">from</span> test_udf<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p></li></ol><p><strong>需求2: 文件中不同的记录来执行不同的 Java 的内置函数</strong></p><p><strong>实现步骤:</strong></p><ol><li>创建 Hive 表<p> <pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">hive <span class="token punctuation">(</span>hive_explode<span class="token punctuation">)</span><span class="token operator">></span> <span class="token keyword">create</span> <span class="token keyword">table</span> test_udf2<span class="token punctuation">(</span>class_name string<span class="token punctuation">,</span> method_name string<span class="token punctuation">,</span> col1 <span class="token keyword">int</span> <span class="token punctuation">,</span> col2 <span class="token keyword">int</span><span class="token punctuation">)</span> <span class="token keyword">row</span> format delimited <span class="token keyword">fields</span> <span class="token keyword">terminated</span> <span class="token keyword">by</span> <span class="token string">','</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p></li><li>准备数据<p> <pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">cd &#x2F;export&#x2F;servers&#x2F;hivedatasvim test_udf2<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></p> 文件内容如下:<p> <pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">java.lang.Math,min,1,2java.lang.Math,max,2,3<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></p></li><li>加载数据<p> <pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">hive <span class="token punctuation">(</span>hive_explode<span class="token punctuation">)</span><span class="token operator">></span> <span class="token keyword">load</span> <span class="token keyword">data</span> <span class="token keyword">local</span> inpath <span class="token string">'/export/servers/hivedatas/test_udf2'</span> overwrite <span class="token keyword">into</span> <span class="token keyword">table</span> test_udf2<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p></li><li>执行查询<p> <pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">hive <span class="token punctuation">(</span>hive_explode<span class="token punctuation">)</span><span class="token operator">></span> <span class="token keyword">select</span> reflect<span class="token punctuation">(</span>class_name<span class="token punctuation">,</span>method_name<span class="token punctuation">,</span>col1<span class="token punctuation">,</span>col2<span class="token punctuation">)</span> <span class="token keyword">from</span> test_udf2<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p></li></ol><p><strong>需求3: 判断是否为数字</strong></p><p><strong>实现方式:</strong></p><p>使用 <code>apache.commons</code> 中的函数，commons 下的 jar 已经包含在 hadoop 的 classpath 中，所以可以直接使用。</p><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> reflect<span class="token punctuation">(</span><span class="token string">"org.apache.commons.lang.math.NumberUtils"</span><span class="token punctuation">,</span> <span class="token string">"isNumber"</span><span class="token punctuation">,</span> <span class="token string">"123"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><h2 id="窗口函数与分析函数"><a href="#窗口函数与分析函数" class="headerlink" title="窗口函数与分析函数"></a>窗口函数与分析函数</h2><p>在 SQL 中有一类函数叫做聚合函数，例如 <code>sum()</code>、<code>avg()</code>、<code>max()</code> 等等，这类函数可以将多行数据按照规则聚集为一行，一般来讲聚集后的行数是要少于聚集前的行数的。但是有时我们想要既显示聚集前的数据，又要显示聚集后的数据，这时我们便引入了窗口函数。窗口函数又叫 OLAP 函数/分析函数，窗口函数兼具分组和排序功能。</p><p>窗口函数最重要的关键字是 <code>partition by</code> 和 <code>order by</code>。</p><p>具体语法如下：<code>over (partition by xxx order by xxx)</code></p><h3 id="sum、avg、min、max"><a href="#sum、avg、min、max" class="headerlink" title="sum、avg、min、max"></a>sum、avg、min、max</h3><p><strong>准备数据</strong></p><p>建表语句:<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">create</span> <span class="token keyword">table</span> test_t1<span class="token punctuation">(</span>cookieid string<span class="token punctuation">,</span>createtime string<span class="token punctuation">,</span>  <span class="token comment">--day </span>pv <span class="token keyword">int</span><span class="token punctuation">)</span> <span class="token keyword">row</span> format delimited <span class="token keyword">fields</span> <span class="token keyword">terminated</span> <span class="token keyword">by</span> <span class="token string">','</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>加载数据：<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">load</span> <span class="token keyword">data</span> <span class="token keyword">local</span> inpath <span class="token string">'/root/hivedata/test_t1.dat'</span> <span class="token keyword">into</span> <span class="token keyword">table</span> test_t1<span class="token punctuation">;</span>cookie1<span class="token punctuation">,</span><span class="token number">2020</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">1</span>cookie1<span class="token punctuation">,</span><span class="token number">2020</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">11</span><span class="token punctuation">,</span><span class="token number">5</span>cookie1<span class="token punctuation">,</span><span class="token number">2020</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">12</span><span class="token punctuation">,</span><span class="token number">7</span>cookie1<span class="token punctuation">,</span><span class="token number">2020</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">13</span><span class="token punctuation">,</span><span class="token number">3</span>cookie1<span class="token punctuation">,</span><span class="token number">2020</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">14</span><span class="token punctuation">,</span><span class="token number">2</span>cookie1<span class="token punctuation">,</span><span class="token number">2020</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">15</span><span class="token punctuation">,</span><span class="token number">4</span>cookie1<span class="token punctuation">,</span><span class="token number">2020</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">16</span><span class="token punctuation">,</span><span class="token number">4</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>开启智能本地模式<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SET</span> hive<span class="token punctuation">.</span><span class="token keyword">exec</span><span class="token punctuation">.</span><span class="token keyword">mode</span><span class="token punctuation">.</span><span class="token keyword">local</span><span class="token punctuation">.</span>auto<span class="token operator">=</span><span class="token boolean">true</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><h4 id="SUM"><a href="#SUM" class="headerlink" title="SUM"></a>SUM</h4><p><code>SUM</code> 函数和窗口函数的配合使用：结果和 <code>ORDER BY</code> 相关，默认为升序。</p><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> cookieid<span class="token punctuation">,</span> createtime<span class="token punctuation">,</span> pv<span class="token punctuation">,</span><span class="token function">SUM</span><span class="token punctuation">(</span>pv<span class="token punctuation">)</span> <span class="token keyword">OVER</span><span class="token punctuation">(</span><span class="token keyword">PARTITION</span> <span class="token keyword">BY</span> cookieid <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> createtime<span class="token punctuation">)</span> <span class="token keyword">AS</span> pv1<span class="token punctuation">,</span> <span class="token comment">--默认为从起点到当前行</span><span class="token function">SUM</span><span class="token punctuation">(</span>pv<span class="token punctuation">)</span> <span class="token keyword">OVER</span><span class="token punctuation">(</span><span class="token keyword">PARTITION</span> <span class="token keyword">BY</span> cookieid <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> createtime <span class="token keyword">ROWS</span> <span class="token operator">BETWEEN</span> <span class="token keyword">UNBOUNDED</span> <span class="token keyword">PRECEDING</span> <span class="token operator">AND</span> <span class="token keyword">CURRENT</span> <span class="token keyword">ROW</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> pv2<span class="token punctuation">,</span> <span class="token comment">--从起点到当前行，结果同pv1</span><span class="token function">SUM</span><span class="token punctuation">(</span>pv<span class="token punctuation">)</span> <span class="token keyword">OVER</span><span class="token punctuation">(</span><span class="token keyword">PARTITION</span> <span class="token keyword">BY</span> cookieid<span class="token punctuation">)</span> <span class="token keyword">AS</span> pv3<span class="token punctuation">,</span> <span class="token comment">--分组内所有行</span><span class="token function">SUM</span><span class="token punctuation">(</span>pv<span class="token punctuation">)</span> <span class="token keyword">OVER</span><span class="token punctuation">(</span><span class="token keyword">PARTITION</span> <span class="token keyword">BY</span> cookieid <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> createtime <span class="token keyword">ROWS</span> <span class="token operator">BETWEEN</span> <span class="token number">3</span> <span class="token keyword">PRECEDING</span> <span class="token operator">AND</span> <span class="token keyword">CURRENT</span> <span class="token keyword">ROW</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> pv4<span class="token punctuation">,</span> <span class="token comment">--当前行+往前3行</span><span class="token function">SUM</span><span class="token punctuation">(</span>pv<span class="token punctuation">)</span> <span class="token keyword">OVER</span><span class="token punctuation">(</span><span class="token keyword">PARTITION</span> <span class="token keyword">BY</span> cookieid <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> createtime <span class="token keyword">ROWS</span> <span class="token operator">BETWEEN</span> <span class="token number">3</span> <span class="token keyword">PRECEDING</span> <span class="token operator">AND</span> <span class="token number">1</span> <span class="token keyword">FOLLOWING</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> pv5<span class="token punctuation">,</span> <span class="token comment">--当前行+往前3行+往后1行</span><span class="token function">SUM</span><span class="token punctuation">(</span>pv<span class="token punctuation">)</span> <span class="token keyword">OVER</span><span class="token punctuation">(</span><span class="token keyword">PARTITION</span> <span class="token keyword">BY</span> cookieid <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> createtime <span class="token keyword">ROWS</span> <span class="token operator">BETWEEN</span> <span class="token keyword">CURRENT</span> <span class="token keyword">ROW</span> <span class="token operator">AND</span> <span class="token keyword">UNBOUNDED</span> <span class="token keyword">FOLLOWING</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> pv6 <span class="token comment">--当前行+往后所有行</span><span class="token keyword">FROM</span> test_t1<span class="token punctuation">;</span>cookieid createtime     pv      pv1     pv2     pv3     pv4     pv5      pv6 <span class="token comment">-----------------------------------------------------------------------------</span>cookie1  <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">10</span>      <span class="token number">1</span>       <span class="token number">1</span>       <span class="token number">1</span>       <span class="token number">26</span>      <span class="token number">1</span>       <span class="token number">6</span>       <span class="token number">26</span>cookie1  <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">11</span>      <span class="token number">5</span>       <span class="token number">6</span>       <span class="token number">6</span>       <span class="token number">26</span>      <span class="token number">6</span>       <span class="token number">13</span>      <span class="token number">25</span>cookie1  <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">12</span>      <span class="token number">7</span>       <span class="token number">13</span>      <span class="token number">13</span>      <span class="token number">26</span>      <span class="token number">13</span>      <span class="token number">16</span>      <span class="token number">20</span>cookie1  <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">13</span>      <span class="token number">3</span>       <span class="token number">16</span>      <span class="token number">16</span>      <span class="token number">26</span>      <span class="token number">16</span>      <span class="token number">18</span>      <span class="token number">13</span>cookie1  <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">14</span>      <span class="token number">2</span>       <span class="token number">18</span>      <span class="token number">18</span>      <span class="token number">26</span>      <span class="token number">17</span>      <span class="token number">21</span>      <span class="token number">10</span>cookie1  <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">15</span>      <span class="token number">4</span>       <span class="token number">22</span>      <span class="token number">22</span>      <span class="token number">26</span>      <span class="token number">16</span>      <span class="token number">20</span>      <span class="token number">8</span>cookie1  <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">16</span>      <span class="token number">4</span>       <span class="token number">26</span>      <span class="token number">26</span>      <span class="token number">26</span>      <span class="token number">13</span>      <span class="token number">13</span>      <span class="token number">4</span>pv1: 分组内从起点到当前行的 pv 累积，如，<span class="token number">11</span>号的pv1 <span class="token operator">=</span> <span class="token number">10</span>号的pv <span class="token operator">+</span> <span class="token number">11</span>号的pv<span class="token punctuation">,</span> <span class="token number">12</span>号 <span class="token operator">=</span> <span class="token number">10</span>号 <span class="token operator">+</span> <span class="token number">11</span>号 <span class="token operator">+</span> <span class="token number">12</span>号pv2: 同 pv1pv3: 分组内<span class="token punctuation">(</span>cookie1<span class="token punctuation">)</span>所有的pv累加pv4: 分组内当前行 <span class="token operator">+</span> 往前 <span class="token number">3</span> 行，如，<span class="token number">11</span>号 <span class="token operator">=</span> <span class="token number">10</span>号 <span class="token operator">+</span> <span class="token number">11</span>号，<span class="token number">12</span>号 <span class="token operator">=</span> <span class="token number">10</span>号 <span class="token operator">+</span> <span class="token number">11</span>号 <span class="token operator">+</span> <span class="token number">12</span>号，<span class="token number">13</span>号 <span class="token operator">=</span> <span class="token number">10</span>号 <span class="token operator">+</span> <span class="token number">11</span>号 <span class="token operator">+</span> <span class="token number">12</span>号 <span class="token operator">+</span> <span class="token number">13</span>号，<span class="token number">14</span>号 <span class="token operator">=</span> <span class="token number">11</span>号 <span class="token operator">+</span> <span class="token number">12</span>号 <span class="token operator">+</span> <span class="token number">13</span>号 <span class="token operator">+</span> <span class="token number">14</span>号pv5: 分组内当前行 <span class="token operator">+</span> 往前 <span class="token number">3</span> 行 <span class="token operator">+</span> 往后 <span class="token number">1</span> 行，如，<span class="token number">14</span>号 <span class="token operator">=</span> <span class="token number">11</span>号 <span class="token operator">+</span> <span class="token number">12</span>号 <span class="token operator">+</span> <span class="token number">13</span>号 <span class="token operator">+</span> <span class="token number">14</span>号 <span class="token operator">+</span> <span class="token number">15</span>号 <span class="token operator">=</span> <span class="token number">5</span> <span class="token operator">+</span> <span class="token number">7</span> <span class="token operator">+</span> <span class="token number">3</span> <span class="token operator">+</span> <span class="token number">2</span> <span class="token operator">+</span> <span class="token number">4</span> <span class="token operator">=</span> <span class="token number">21</span>pv6: 分组内当前行 <span class="token operator">+</span> 往后所有行，如，<span class="token number">13</span>号 <span class="token operator">=</span> <span class="token number">13</span>号 <span class="token operator">+</span> <span class="token number">14</span>号 <span class="token operator">+</span> <span class="token number">15</span>号 <span class="token operator">+</span> <span class="token number">16</span>号 <span class="token operator">=</span> <span class="token number">3</span> <span class="token operator">+</span> <span class="token number">2</span> <span class="token operator">+</span> <span class="token number">4</span> <span class="token operator">+</span> <span class="token number">4</span> <span class="token operator">=</span> <span class="token number">13</span>， <span class="token number">14</span>号 <span class="token operator">=</span> <span class="token number">14</span>号 <span class="token operator">+</span> <span class="token number">15</span>号 <span class="token operator">+</span> <span class="token number">16</span>号 <span class="token operator">=</span> <span class="token number">2</span> <span class="token operator">+</span> <span class="token number">4</span> <span class="token operator">+</span> <span class="token number">4</span> <span class="token operator">=</span> <span class="token number">10</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p>如果不指定 <code>rows between</code>，默认为从起点到当前行;</p><p>如果不指定 <code>order by</code>，则将分组内所有值累加;</p><p>关键是理解 <code>rows between</code> 含义，也叫做 <code>window</code> 子句：</p><ul><li><code>preceding</code>：往前</li><li><code>following</code>：往后</li><li><code>current row</code>：当前行</li><li><code>unbounded</code>：起点</li><li><code>unbounded preceding</code>： 表示从前面的起点</li><li><code>unbounded following</code>：表示到后面的终点</li></ul><p>AVG，MIN，MAX 和 SUM 用法一样。</p><h4 id="AVG"><a href="#AVG" class="headerlink" title="AVG"></a>AVG</h4><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> cookieid<span class="token punctuation">,</span> createtime<span class="token punctuation">,</span> pv<span class="token punctuation">,</span><span class="token function">AVG</span><span class="token punctuation">(</span>pv<span class="token punctuation">)</span> <span class="token keyword">OVER</span><span class="token punctuation">(</span><span class="token keyword">PARTITION</span> <span class="token keyword">BY</span> cookieid <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> createtime<span class="token punctuation">)</span> <span class="token keyword">AS</span> pv1<span class="token punctuation">,</span> <span class="token comment">--默认为从起点到当前行</span><span class="token function">AVG</span><span class="token punctuation">(</span>pv<span class="token punctuation">)</span> <span class="token keyword">OVER</span><span class="token punctuation">(</span><span class="token keyword">PARTITION</span> <span class="token keyword">BY</span> cookieid <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> createtime <span class="token keyword">ROWS</span> <span class="token operator">BETWEEN</span> <span class="token keyword">UNBOUNDED</span> <span class="token keyword">PRECEDING</span> <span class="token operator">AND</span> <span class="token keyword">CURRENT</span> <span class="token keyword">ROW</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> pv2<span class="token punctuation">,</span> <span class="token comment">--从起点到当前行，结果同pv1</span><span class="token function">AVG</span><span class="token punctuation">(</span>pv<span class="token punctuation">)</span> <span class="token keyword">OVER</span><span class="token punctuation">(</span><span class="token keyword">PARTITION</span> <span class="token keyword">BY</span> cookieid<span class="token punctuation">)</span> <span class="token keyword">AS</span> pv3<span class="token punctuation">,</span> <span class="token comment">--分组内所有行</span><span class="token function">AVG</span><span class="token punctuation">(</span>pv<span class="token punctuation">)</span> <span class="token keyword">OVER</span><span class="token punctuation">(</span><span class="token keyword">PARTITION</span> <span class="token keyword">BY</span> cookieid <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> createtime <span class="token keyword">ROWS</span> <span class="token operator">BETWEEN</span> <span class="token number">3</span> <span class="token keyword">PRECEDING</span> <span class="token operator">AND</span> <span class="token keyword">CURRENT</span> <span class="token keyword">ROW</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> pv4<span class="token punctuation">,</span> <span class="token comment">--当前行+往前3行</span><span class="token function">AVG</span><span class="token punctuation">(</span>pv<span class="token punctuation">)</span> <span class="token keyword">OVER</span><span class="token punctuation">(</span><span class="token keyword">PARTITION</span> <span class="token keyword">BY</span> cookieid <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> createtime <span class="token keyword">ROWS</span> <span class="token operator">BETWEEN</span> <span class="token number">3</span> <span class="token keyword">PRECEDING</span> <span class="token operator">AND</span> <span class="token number">1</span> <span class="token keyword">FOLLOWING</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> pv5<span class="token punctuation">,</span> <span class="token comment">--当前行+往前3行+往后1行</span><span class="token function">AVG</span><span class="token punctuation">(</span>pv<span class="token punctuation">)</span> <span class="token keyword">OVER</span><span class="token punctuation">(</span><span class="token keyword">PARTITION</span> <span class="token keyword">BY</span> cookieid <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> createtime <span class="token keyword">ROWS</span> <span class="token operator">BETWEEN</span> <span class="token keyword">CURRENT</span> <span class="token keyword">ROW</span> <span class="token operator">AND</span> <span class="token keyword">UNBOUNDED</span> <span class="token keyword">FOLLOWING</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> pv6 <span class="token comment">--当前行+往后所有行</span><span class="token keyword">FROM</span> test_t1<span class="token punctuation">;</span>cookieid createtime     pv      pv1     pv2     pv3     pv4     pv5      pv6 <span class="token comment">-----------------------------------------------------------------------------</span>cookie1 <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">10</span>      <span class="token number">1</span>       <span class="token number">1.0</span>     <span class="token number">1.0</span>     <span class="token number">3.7142857142857144</span>      <span class="token number">1.0</span>     <span class="token number">3.0</span>     <span class="token number">3.7142857142857144</span>cookie1 <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">11</span>      <span class="token number">5</span>       <span class="token number">3.0</span>     <span class="token number">3.0</span>     <span class="token number">3.7142857142857144</span>      <span class="token number">3.0</span>     <span class="token number">4.333333333333333</span>       <span class="token number">4.166666666666667</span>cookie1 <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">12</span>      <span class="token number">7</span>       <span class="token number">4.333333333333333</span>       <span class="token number">4.333333333333333</span>       <span class="token number">3.7142857142857144</span>      <span class="token number">4.333333333333333</span>       <span class="token number">4.0</span>     <span class="token number">4.0</span>cookie1 <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">13</span>      <span class="token number">3</span>       <span class="token number">4.0</span>     <span class="token number">4.0</span>     <span class="token number">3.7142857142857144</span>      <span class="token number">4.0</span>     <span class="token number">3.6</span>     <span class="token number">3.25</span>cookie1 <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">14</span>      <span class="token number">2</span>       <span class="token number">3.6</span>     <span class="token number">3.6</span>     <span class="token number">3.7142857142857144</span>      <span class="token number">4.25</span>    <span class="token number">4.2</span>     <span class="token number">3.3333333333333335</span>cookie1 <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">15</span>      <span class="token number">4</span>       <span class="token number">3.6666666666666665</span>      <span class="token number">3.6666666666666665</span>      <span class="token number">3.7142857142857144</span>      <span class="token number">4.0</span>     <span class="token number">4.0</span>     <span class="token number">4.0</span>cookie1 <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">16</span>      <span class="token number">4</span>       <span class="token number">3.7142857142857144</span>      <span class="token number">3.7142857142857144</span>      <span class="token number">3.7142857142857144</span>      <span class="token number">3.25</span>    <span class="token number">3.25</span>    <span class="token number">4.0</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h4 id="MIN"><a href="#MIN" class="headerlink" title="MIN"></a>MIN</h4><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> cookieid<span class="token punctuation">,</span> createtime<span class="token punctuation">,</span> pv<span class="token punctuation">,</span><span class="token function">MIN</span><span class="token punctuation">(</span>pv<span class="token punctuation">)</span> <span class="token keyword">OVER</span><span class="token punctuation">(</span><span class="token keyword">PARTITION</span> <span class="token keyword">BY</span> cookieid <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> createtime<span class="token punctuation">)</span> <span class="token keyword">AS</span> pv1<span class="token punctuation">,</span> <span class="token comment">--默认为从起点到当前行</span><span class="token function">MIN</span><span class="token punctuation">(</span>pv<span class="token punctuation">)</span> <span class="token keyword">OVER</span><span class="token punctuation">(</span><span class="token keyword">PARTITION</span> <span class="token keyword">BY</span> cookieid <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> createtime <span class="token keyword">ROWS</span> <span class="token operator">BETWEEN</span> <span class="token keyword">UNBOUNDED</span> <span class="token keyword">PRECEDING</span> <span class="token operator">AND</span> <span class="token keyword">CURRENT</span> <span class="token keyword">ROW</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> pv2<span class="token punctuation">,</span> <span class="token comment">--从起点到当前行，结果同pv1</span><span class="token function">MIN</span><span class="token punctuation">(</span>pv<span class="token punctuation">)</span> <span class="token keyword">OVER</span><span class="token punctuation">(</span><span class="token keyword">PARTITION</span> <span class="token keyword">BY</span> cookieid<span class="token punctuation">)</span> <span class="token keyword">AS</span> pv3<span class="token punctuation">,</span> <span class="token comment">--分组内所有行</span><span class="token function">MIN</span><span class="token punctuation">(</span>pv<span class="token punctuation">)</span> <span class="token keyword">OVER</span><span class="token punctuation">(</span><span class="token keyword">PARTITION</span> <span class="token keyword">BY</span> cookieid <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> createtime <span class="token keyword">ROWS</span> <span class="token operator">BETWEEN</span> <span class="token number">3</span> <span class="token keyword">PRECEDING</span> <span class="token operator">AND</span> <span class="token keyword">CURRENT</span> <span class="token keyword">ROW</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> pv4<span class="token punctuation">,</span> <span class="token comment">--当前行+往前3行</span><span class="token function">MIN</span><span class="token punctuation">(</span>pv<span class="token punctuation">)</span> <span class="token keyword">OVER</span><span class="token punctuation">(</span><span class="token keyword">PARTITION</span> <span class="token keyword">BY</span> cookieid <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> createtime <span class="token keyword">ROWS</span> <span class="token operator">BETWEEN</span> <span class="token number">3</span> <span class="token keyword">PRECEDING</span> <span class="token operator">AND</span> <span class="token number">1</span> <span class="token keyword">FOLLOWING</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> pv5<span class="token punctuation">,</span> <span class="token comment">--当前行+往前3行+往后1行</span><span class="token function">MIN</span><span class="token punctuation">(</span>pv<span class="token punctuation">)</span> <span class="token keyword">OVER</span><span class="token punctuation">(</span><span class="token keyword">PARTITION</span> <span class="token keyword">BY</span> cookieid <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> createtime <span class="token keyword">ROWS</span> <span class="token operator">BETWEEN</span> <span class="token keyword">CURRENT</span> <span class="token keyword">ROW</span> <span class="token operator">AND</span> <span class="token keyword">UNBOUNDED</span> <span class="token keyword">FOLLOWING</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> pv6 <span class="token comment">--当前行+往后所有行</span><span class="token keyword">FROM</span> test_t1<span class="token punctuation">;</span>cookieid createtime     pv      pv1     pv2     pv3     pv4     pv5      pv6 <span class="token comment">-----------------------------------------------------------------------------</span>cookie1 <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">10</span>      <span class="token number">1</span>       <span class="token number">1</span>       <span class="token number">1</span>       <span class="token number">1</span>       <span class="token number">1</span>       <span class="token number">1</span>       <span class="token number">1</span>cookie1 <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">11</span>      <span class="token number">5</span>       <span class="token number">1</span>       <span class="token number">1</span>       <span class="token number">1</span>       <span class="token number">1</span>       <span class="token number">1</span>       <span class="token number">2</span>cookie1 <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">12</span>      <span class="token number">7</span>       <span class="token number">1</span>       <span class="token number">1</span>       <span class="token number">1</span>       <span class="token number">1</span>       <span class="token number">1</span>       <span class="token number">2</span>cookie1 <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">13</span>      <span class="token number">3</span>       <span class="token number">1</span>       <span class="token number">1</span>       <span class="token number">1</span>       <span class="token number">1</span>       <span class="token number">1</span>       <span class="token number">2</span>cookie1 <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">14</span>      <span class="token number">2</span>       <span class="token number">1</span>       <span class="token number">1</span>       <span class="token number">1</span>       <span class="token number">2</span>       <span class="token number">2</span>       <span class="token number">2</span>cookie1 <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">15</span>      <span class="token number">4</span>       <span class="token number">1</span>       <span class="token number">1</span>       <span class="token number">1</span>       <span class="token number">2</span>       <span class="token number">2</span>       <span class="token number">4</span>cookie1 <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">16</span>      <span class="token number">4</span>       <span class="token number">1</span>       <span class="token number">1</span>       <span class="token number">1</span>       <span class="token number">2</span>       <span class="token number">2</span>       <span class="token number">4</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h4 id="MAX"><a href="#MAX" class="headerlink" title="MAX"></a>MAX</h4><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> cookieid<span class="token punctuation">,</span> createtime<span class="token punctuation">,</span> pv<span class="token punctuation">,</span><span class="token function">MAX</span><span class="token punctuation">(</span>pv<span class="token punctuation">)</span> <span class="token keyword">OVER</span><span class="token punctuation">(</span><span class="token keyword">PARTITION</span> <span class="token keyword">BY</span> cookieid <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> createtime<span class="token punctuation">)</span> <span class="token keyword">AS</span> pv1<span class="token punctuation">,</span> <span class="token comment">--默认为从起点到当前行</span><span class="token function">MAX</span><span class="token punctuation">(</span>pv<span class="token punctuation">)</span> <span class="token keyword">OVER</span><span class="token punctuation">(</span><span class="token keyword">PARTITION</span> <span class="token keyword">BY</span> cookieid <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> createtime <span class="token keyword">ROWS</span> <span class="token operator">BETWEEN</span> <span class="token keyword">UNBOUNDED</span> <span class="token keyword">PRECEDING</span> <span class="token operator">AND</span> <span class="token keyword">CURRENT</span> <span class="token keyword">ROW</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> pv2<span class="token punctuation">,</span> <span class="token comment">--从起点到当前行，结果同pv1</span><span class="token function">MAX</span><span class="token punctuation">(</span>pv<span class="token punctuation">)</span> <span class="token keyword">OVER</span><span class="token punctuation">(</span><span class="token keyword">PARTITION</span> <span class="token keyword">BY</span> cookieid<span class="token punctuation">)</span> <span class="token keyword">AS</span> pv3<span class="token punctuation">,</span> <span class="token comment">--分组内所有行</span><span class="token function">MAX</span><span class="token punctuation">(</span>pv<span class="token punctuation">)</span> <span class="token keyword">OVER</span><span class="token punctuation">(</span><span class="token keyword">PARTITION</span> <span class="token keyword">BY</span> cookieid <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> createtime <span class="token keyword">ROWS</span> <span class="token operator">BETWEEN</span> <span class="token number">3</span> <span class="token keyword">PRECEDING</span> <span class="token operator">AND</span> <span class="token keyword">CURRENT</span> <span class="token keyword">ROW</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> pv4<span class="token punctuation">,</span> <span class="token comment">--当前行+往前3行</span><span class="token function">MAX</span><span class="token punctuation">(</span>pv<span class="token punctuation">)</span> <span class="token keyword">OVER</span><span class="token punctuation">(</span><span class="token keyword">PARTITION</span> <span class="token keyword">BY</span> cookieid <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> createtime <span class="token keyword">ROWS</span> <span class="token operator">BETWEEN</span> <span class="token number">3</span> <span class="token keyword">PRECEDING</span> <span class="token operator">AND</span> <span class="token number">1</span> <span class="token keyword">FOLLOWING</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> pv5<span class="token punctuation">,</span> <span class="token comment">--当前行+往前3行+往后1行</span><span class="token function">MAX</span><span class="token punctuation">(</span>pv<span class="token punctuation">)</span> <span class="token keyword">OVER</span><span class="token punctuation">(</span><span class="token keyword">PARTITION</span> <span class="token keyword">BY</span> cookieid <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> createtime <span class="token keyword">ROWS</span> <span class="token operator">BETWEEN</span> <span class="token keyword">CURRENT</span> <span class="token keyword">ROW</span> <span class="token operator">AND</span> <span class="token keyword">UNBOUNDED</span> <span class="token keyword">FOLLOWING</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> pv6 <span class="token comment">--当前行+往后所有行</span><span class="token keyword">FROM</span> test_t1<span class="token punctuation">;</span>cookieid createtime     pv      pv1     pv2     pv3     pv4     pv5      pv6 <span class="token comment">-----------------------------------------------------------------------------</span>cookie1 <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">10</span>      <span class="token number">1</span>       <span class="token number">1</span>       <span class="token number">1</span>       <span class="token number">7</span>       <span class="token number">1</span>       <span class="token number">5</span>       <span class="token number">7</span>cookie1 <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">11</span>      <span class="token number">5</span>       <span class="token number">5</span>       <span class="token number">5</span>       <span class="token number">7</span>       <span class="token number">5</span>       <span class="token number">7</span>       <span class="token number">7</span>cookie1 <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">12</span>      <span class="token number">7</span>       <span class="token number">7</span>       <span class="token number">7</span>       <span class="token number">7</span>       <span class="token number">7</span>       <span class="token number">7</span>       <span class="token number">7</span>cookie1 <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">13</span>      <span class="token number">3</span>       <span class="token number">7</span>       <span class="token number">7</span>       <span class="token number">7</span>       <span class="token number">7</span>       <span class="token number">7</span>       <span class="token number">4</span>cookie1 <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">14</span>      <span class="token number">2</span>       <span class="token number">7</span>       <span class="token number">7</span>       <span class="token number">7</span>       <span class="token number">7</span>       <span class="token number">7</span>       <span class="token number">4</span>cookie1 <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">15</span>      <span class="token number">4</span>       <span class="token number">7</span>       <span class="token number">7</span>       <span class="token number">7</span>       <span class="token number">7</span>       <span class="token number">7</span>       <span class="token number">4</span>cookie1 <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">16</span>      <span class="token number">4</span>       <span class="token number">7</span>       <span class="token number">7</span>       <span class="token number">7</span>       <span class="token number">4</span>       <span class="token number">4</span>       <span class="token number">4</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h3 id="row-number、rank、dense-rank、ntile"><a href="#row-number、rank、dense-rank、ntile" class="headerlink" title="row_number、rank、dense_rank、ntile"></a>row_number、rank、dense_rank、ntile</h3><p><strong>准备数据：</strong></p><p>建表语句:</p><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> test_t2 <span class="token punctuation">(</span>  cookieid string<span class="token punctuation">,</span>  createtime string<span class="token punctuation">,</span>  <span class="token comment">--day </span>  pv <span class="token keyword">INT</span><span class="token punctuation">)</span> <span class="token keyword">ROW</span> FORMAT DELIMITED <span class="token keyword">FIELDS</span> <span class="token keyword">TERMINATED</span> <span class="token keyword">BY</span> <span class="token string">','</span> stored <span class="token keyword">as</span> textfile<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p><strong>加载数据：</strong></p><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">load</span> <span class="token keyword">data</span> <span class="token keyword">local</span> inpath <span class="token string">'/root/hivedata/test_t2.dat'</span> <span class="token keyword">into</span> <span class="token keyword">table</span> test_t2<span class="token punctuation">;</span>cookie1<span class="token punctuation">,</span><span class="token number">2020</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">1</span>cookie1<span class="token punctuation">,</span><span class="token number">2020</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">11</span><span class="token punctuation">,</span><span class="token number">5</span>cookie1<span class="token punctuation">,</span><span class="token number">2020</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">12</span><span class="token punctuation">,</span><span class="token number">7</span>cookie1<span class="token punctuation">,</span><span class="token number">2020</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">13</span><span class="token punctuation">,</span><span class="token number">3</span>cookie1<span class="token punctuation">,</span><span class="token number">2020</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">14</span><span class="token punctuation">,</span><span class="token number">2</span>cookie1<span class="token punctuation">,</span><span class="token number">2020</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">15</span><span class="token punctuation">,</span><span class="token number">4</span>cookie1<span class="token punctuation">,</span><span class="token number">2020</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">16</span><span class="token punctuation">,</span><span class="token number">4</span>cookie2<span class="token punctuation">,</span><span class="token number">2020</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">2</span>cookie2<span class="token punctuation">,</span><span class="token number">2020</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">11</span><span class="token punctuation">,</span><span class="token number">3</span>cookie2<span class="token punctuation">,</span><span class="token number">2020</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">12</span><span class="token punctuation">,</span><span class="token number">5</span>cookie2<span class="token punctuation">,</span><span class="token number">2020</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">13</span><span class="token punctuation">,</span><span class="token number">6</span>cookie2<span class="token punctuation">,</span><span class="token number">2020</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">14</span><span class="token punctuation">,</span><span class="token number">3</span>cookie2<span class="token punctuation">,</span><span class="token number">2020</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">15</span><span class="token punctuation">,</span><span class="token number">9</span>cookie2<span class="token punctuation">,</span><span class="token number">2020</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">16</span><span class="token punctuation">,</span><span class="token number">7</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h4 id="ROW-NUMBER-使用"><a href="#ROW-NUMBER-使用" class="headerlink" title="ROW_NUMBER() 使用"></a>ROW_NUMBER() 使用</h4><p><code>ROW_NUMBER()</code> 从 1 开始，按照顺序，生成分组内记录的序列。</p><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> cookieid<span class="token punctuation">,</span> createtime<span class="token punctuation">,</span> pv<span class="token punctuation">,</span>ROW_NUMBER<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">OVER</span><span class="token punctuation">(</span><span class="token keyword">PARTITION</span> <span class="token keyword">BY</span> cookieid <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> pv <span class="token keyword">desc</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> rn <span class="token keyword">FROM</span> test_t2<span class="token punctuation">;</span>cookieid <span class="token keyword">day</span>           pv       rn<span class="token comment">------------------------------------------- </span>cookie1 <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">12</span>      <span class="token number">7</span>       <span class="token number">1</span>cookie1 <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">11</span>      <span class="token number">5</span>       <span class="token number">2</span>cookie1 <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">15</span>      <span class="token number">4</span>       <span class="token number">3</span>cookie1 <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">16</span>      <span class="token number">4</span>       <span class="token number">4</span>cookie1 <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">13</span>      <span class="token number">3</span>       <span class="token number">5</span>cookie1 <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">14</span>      <span class="token number">2</span>       <span class="token number">6</span>cookie1 <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">10</span>      <span class="token number">1</span>       <span class="token number">7</span>cookie2 <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">15</span>      <span class="token number">9</span>       <span class="token number">1</span>cookie2 <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">16</span>      <span class="token number">7</span>       <span class="token number">2</span>cookie2 <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">13</span>      <span class="token number">6</span>       <span class="token number">3</span>cookie2 <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">12</span>      <span class="token number">5</span>       <span class="token number">4</span>cookie2 <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">14</span>      <span class="token number">3</span>       <span class="token number">5</span>cookie2 <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">11</span>      <span class="token number">3</span>       <span class="token number">6</span>cookie2 <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">10</span>      <span class="token number">2</span>       <span class="token number">7</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h4 id="RANK-和-DENSE-RANK-使用"><a href="#RANK-和-DENSE-RANK-使用" class="headerlink" title="RANK 和 DENSE_RANK 使用"></a>RANK 和 DENSE_RANK 使用</h4><ul><li><code>RANK()</code> 生成数据项在分组中的排名，排名相等会在名次中留下空位。</li><li><code>DENSE_RANK()</code> 生成数据项在分组中的排名，排名相等会在名次中不会留下空位。</li></ul><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> cookieid<span class="token punctuation">,</span> createtime<span class="token punctuation">,</span> pv<span class="token punctuation">,</span>RANK<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">OVER</span><span class="token punctuation">(</span><span class="token keyword">PARTITION</span> <span class="token keyword">BY</span> cookieid <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> pv <span class="token keyword">desc</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> rn1<span class="token punctuation">,</span>DENSE_RANK<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">OVER</span><span class="token punctuation">(</span><span class="token keyword">PARTITION</span> <span class="token keyword">BY</span> cookieid <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> pv <span class="token keyword">desc</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> rn2<span class="token punctuation">,</span>ROW_NUMBER<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">OVER</span><span class="token punctuation">(</span><span class="token keyword">PARTITION</span> <span class="token keyword">BY</span> cookieid <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> pv <span class="token keyword">DESC</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> rn3 <span class="token keyword">FROM</span> test_t2 <span class="token keyword">WHERE</span> cookieid <span class="token operator">=</span> <span class="token string">'cookie1'</span><span class="token punctuation">;</span>cookieid <span class="token keyword">day</span>           pv       rn1     rn2     rn3 <span class="token comment">-------------------------------------------------- </span>cookie1 <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">12</span>      <span class="token number">7</span>       <span class="token number">1</span>       <span class="token number">1</span>       <span class="token number">1</span>cookie1 <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">11</span>      <span class="token number">5</span>       <span class="token number">2</span>       <span class="token number">2</span>       <span class="token number">2</span>cookie1 <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">15</span>      <span class="token number">4</span>       <span class="token number">3</span>       <span class="token number">3</span>       <span class="token number">3</span>cookie1 <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">16</span>      <span class="token number">4</span>       <span class="token number">3</span>       <span class="token number">3</span>       <span class="token number">4</span>cookie1 <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">13</span>      <span class="token number">3</span>       <span class="token number">5</span>       <span class="token number">4</span>       <span class="token number">5</span>cookie1 <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">14</span>      <span class="token number">2</span>       <span class="token number">6</span>       <span class="token number">5</span>       <span class="token number">6</span>cookie1 <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">10</span>      <span class="token number">1</span>       <span class="token number">7</span>       <span class="token number">6</span>       <span class="token number">7</span>rn1: <span class="token number">15</span>号和<span class="token number">16</span>号并列第<span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">13</span>号排第<span class="token number">5</span>rn2: <span class="token number">15</span>号和<span class="token number">16</span>号并列第<span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">13</span>号排第<span class="token number">4</span>rn3: 如果相等，则按记录值排序，生成唯一的次序，如果所有记录值都相等，或许会随机排吧。<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h4 id="NTILE"><a href="#NTILE" class="headerlink" title="NTILE"></a>NTILE</h4><p>有时会有这样的需求：如果数据排序后分为三部分，业务人员只关心其中的一部分，如何将这中间的三分之一数据拿出来呢? <code>NTILE</code> 函数即可以满足。</p><p><code>NTILE</code> 可以看成是：把有序的数据集合平均分配到指定的数量（num）个桶中, 将桶号分配给每一行。如果不能平均分配，则优先分配较小编号的桶，并且各个桶中能放的行数最多相差 1。</p><p>然后可以根据桶号，选取前或后 n 分之几的数据。数据会完整展示出来，只是给相应的数据打标签；具体要取几分之几的数据，需要再嵌套一层根据标签取出。</p><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> cookieid<span class="token punctuation">,</span> createtime<span class="token punctuation">,</span> pv<span class="token punctuation">,</span>NTILE<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token keyword">OVER</span><span class="token punctuation">(</span><span class="token keyword">PARTITION</span> <span class="token keyword">BY</span> cookieid <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> createtime<span class="token punctuation">)</span> <span class="token keyword">AS</span> rn1<span class="token punctuation">,</span> <span class="token comment">--分组内将数据分成2片</span>NTILE<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span> <span class="token keyword">OVER</span><span class="token punctuation">(</span><span class="token keyword">PARTITION</span> <span class="token keyword">BY</span> cookieid <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> createtime<span class="token punctuation">)</span> <span class="token keyword">AS</span> rn2<span class="token punctuation">,</span> <span class="token comment">--分组内将数据分成3片</span>NTILE<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span> <span class="token keyword">OVER</span><span class="token punctuation">(</span><span class="token keyword">ORDER</span> <span class="token keyword">BY</span> createtime<span class="token punctuation">)</span> <span class="token keyword">AS</span> rn3 <span class="token comment">--将所有数据分成4片</span><span class="token keyword">FROM</span> test_t2 <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> cookieid<span class="token punctuation">,</span> createtime<span class="token punctuation">;</span>cookieid <span class="token keyword">day</span>           pv       rn1     rn2     rn3<span class="token comment">-------------------------------------------------</span>cookie1 <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">10</span>      <span class="token number">1</span>       <span class="token number">1</span>       <span class="token number">1</span>       <span class="token number">1</span>cookie1 <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">11</span>      <span class="token number">5</span>       <span class="token number">1</span>       <span class="token number">1</span>       <span class="token number">1</span>cookie1 <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">12</span>      <span class="token number">7</span>       <span class="token number">1</span>       <span class="token number">1</span>       <span class="token number">2</span>cookie1 <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">13</span>      <span class="token number">3</span>       <span class="token number">1</span>       <span class="token number">2</span>       <span class="token number">2</span>cookie1 <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">14</span>      <span class="token number">2</span>       <span class="token number">2</span>       <span class="token number">2</span>       <span class="token number">3</span>cookie1 <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">15</span>      <span class="token number">4</span>       <span class="token number">2</span>       <span class="token number">3</span>       <span class="token number">3</span>cookie1 <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">16</span>      <span class="token number">4</span>       <span class="token number">2</span>       <span class="token number">3</span>       <span class="token number">4</span>cookie2 <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">10</span>      <span class="token number">2</span>       <span class="token number">1</span>       <span class="token number">1</span>       <span class="token number">1</span>cookie2 <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">11</span>      <span class="token number">3</span>       <span class="token number">1</span>       <span class="token number">1</span>       <span class="token number">1</span>cookie2 <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">12</span>      <span class="token number">5</span>       <span class="token number">1</span>       <span class="token number">1</span>       <span class="token number">2</span>cookie2 <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">13</span>      <span class="token number">6</span>       <span class="token number">1</span>       <span class="token number">2</span>       <span class="token number">2</span>cookie2 <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">14</span>      <span class="token number">3</span>       <span class="token number">2</span>       <span class="token number">2</span>       <span class="token number">3</span>cookie2 <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">15</span>      <span class="token number">9</span>       <span class="token number">2</span>       <span class="token number">3</span>       <span class="token number">4</span>cookie2 <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">16</span>      <span class="token number">7</span>       <span class="token number">2</span>       <span class="token number">3</span>       <span class="token number">4</span>比如，统计一个 cookie，pv 数最多的前 <span class="token number">1</span><span class="token operator">/</span><span class="token number">3</span> 的天rn2 <span class="token operator">=</span> <span class="token number">1</span> 的记录，就是我们想要的结果<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h2 id="其他一些窗口函数"><a href="#其他一些窗口函数" class="headerlink" title="其他一些窗口函数"></a>其他一些窗口函数</h2><h3 id="lag-lead-first-value-last-value"><a href="#lag-lead-first-value-last-value" class="headerlink" title="lag, lead, first_value, last_value"></a>lag, lead, first_value, last_value</h3><p><strong>准备数据</strong></p><p>建表语句:<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">create</span> <span class="token keyword">table</span> test_t3<span class="token punctuation">(</span>cookieid string<span class="token punctuation">,</span>createtime string<span class="token punctuation">,</span>url string<span class="token punctuation">)</span> <span class="token keyword">row</span> format delimited <span class="token keyword">fields</span> <span class="token keyword">terminated</span> <span class="token keyword">by</span> <span class="token string">','</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>加载数据：<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">load</span> <span class="token keyword">data</span> <span class="token keyword">local</span> inpath <span class="token string">'/root/hivedata/test_t3.dat'</span> <span class="token keyword">into</span> <span class="token keyword">table</span> test_t3<span class="token punctuation">;</span>cookie1<span class="token punctuation">,</span><span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">10</span>:<span class="token number">00</span>:<span class="token number">02</span><span class="token punctuation">,</span>url2cookie1<span class="token punctuation">,</span><span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">10</span>:<span class="token number">00</span>:<span class="token number">00</span><span class="token punctuation">,</span>url1cookie1<span class="token punctuation">,</span><span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">10</span>:<span class="token number">03</span>:<span class="token number">04</span><span class="token punctuation">,</span>url3cookie1<span class="token punctuation">,</span><span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">10</span>:<span class="token number">50</span>:<span class="token number">05</span><span class="token punctuation">,</span>url6cookie1<span class="token punctuation">,</span><span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">11</span>:<span class="token number">00</span>:<span class="token number">00</span><span class="token punctuation">,</span>url7cookie1<span class="token punctuation">,</span><span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">10</span>:<span class="token number">10</span>:<span class="token number">00</span><span class="token punctuation">,</span>url4cookie1<span class="token punctuation">,</span><span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">10</span>:<span class="token number">50</span>:<span class="token number">01</span><span class="token punctuation">,</span>url5cookie2<span class="token punctuation">,</span><span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">10</span>:<span class="token number">00</span>:<span class="token number">02</span><span class="token punctuation">,</span>url22cookie2<span class="token punctuation">,</span><span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">10</span>:<span class="token number">00</span>:<span class="token number">00</span><span class="token punctuation">,</span>url11cookie2<span class="token punctuation">,</span><span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">10</span>:<span class="token number">03</span>:<span class="token number">04</span><span class="token punctuation">,</span>url33cookie2<span class="token punctuation">,</span><span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">10</span>:<span class="token number">50</span>:<span class="token number">05</span><span class="token punctuation">,</span>url66cookie2<span class="token punctuation">,</span><span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">11</span>:<span class="token number">00</span>:<span class="token number">00</span><span class="token punctuation">,</span>url77cookie2<span class="token punctuation">,</span><span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">10</span>:<span class="token number">10</span>:<span class="token number">00</span><span class="token punctuation">,</span>url44cookie2<span class="token punctuation">,</span><span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">10</span>:<span class="token number">50</span>:<span class="token number">01</span><span class="token punctuation">,</span>url55<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h4 id="LAG"><a href="#LAG" class="headerlink" title="LAG"></a>LAG</h4><p><code>LAG(col, n, DEFAULT)</code> 用于统计窗口内往上第 n 行值第一个参数为列名，第二个参数为往上第 n 行（可选，默认为 1），第三个参数为默认值（当往上第 n 行为 NULL 时候，取默认值，如不指定，则为 NULL）<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> cookieid<span class="token punctuation">,</span> createtime<span class="token punctuation">,</span> url<span class="token punctuation">,</span>  ROW_NUMBER<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">OVER</span><span class="token punctuation">(</span><span class="token keyword">PARTITION</span> <span class="token keyword">BY</span> cookieid <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> createtime<span class="token punctuation">)</span> <span class="token keyword">AS</span> rn<span class="token punctuation">,</span>  LAG<span class="token punctuation">(</span>createtime<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'1970-01-01 00:00:00'</span><span class="token punctuation">)</span> <span class="token keyword">OVER</span><span class="token punctuation">(</span><span class="token keyword">PARTITION</span> <span class="token keyword">BY</span> cookieid <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> createtime<span class="token punctuation">)</span> <span class="token keyword">AS</span> last_1_time<span class="token punctuation">,</span>  LAG<span class="token punctuation">(</span>createtime<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token keyword">OVER</span><span class="token punctuation">(</span><span class="token keyword">PARTITION</span> <span class="token keyword">BY</span> cookieid <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> createtime<span class="token punctuation">)</span> <span class="token keyword">AS</span> last_2_time <span class="token keyword">FROM</span> test_t3<span class="token punctuation">;</span>cookieid createtime             url    rn       last_1_time             last_2_time<span class="token comment">-------------------------------------------------------------------------------------------</span>cookie1 <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">10</span>:<span class="token number">00</span>:<span class="token number">00</span>     url1    <span class="token number">1</span>       <span class="token number">1970</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">01</span> <span class="token number">00</span>:<span class="token number">00</span>:<span class="token number">00</span>     <span class="token boolean">NULL</span>cookie1 <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">10</span>:<span class="token number">00</span>:<span class="token number">02</span>     url2    <span class="token number">2</span>       <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">10</span>:<span class="token number">00</span>:<span class="token number">00</span>     <span class="token boolean">NULL</span>cookie1 <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">10</span>:<span class="token number">03</span>:<span class="token number">04</span>     url3    <span class="token number">3</span>       <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">10</span>:<span class="token number">00</span>:<span class="token number">02</span>     <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">10</span>:<span class="token number">00</span>:<span class="token number">00</span>cookie1 <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">10</span>:<span class="token number">10</span>:<span class="token number">00</span>     url4    <span class="token number">4</span>       <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">10</span>:<span class="token number">03</span>:<span class="token number">04</span>     <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">10</span>:<span class="token number">00</span>:<span class="token number">02</span>cookie1 <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">10</span>:<span class="token number">50</span>:<span class="token number">01</span>     url5    <span class="token number">5</span>       <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">10</span>:<span class="token number">10</span>:<span class="token number">00</span>     <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">10</span>:<span class="token number">03</span>:<span class="token number">04</span>cookie1 <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">10</span>:<span class="token number">50</span>:<span class="token number">05</span>     url6    <span class="token number">6</span>       <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">10</span>:<span class="token number">50</span>:<span class="token number">01</span>     <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">10</span>:<span class="token number">10</span>:<span class="token number">00</span>cookie1 <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">11</span>:<span class="token number">00</span>:<span class="token number">00</span>     url7    <span class="token number">7</span>       <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">10</span>:<span class="token number">50</span>:<span class="token number">05</span>     <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">10</span>:<span class="token number">50</span>:<span class="token number">01</span>cookie2 <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">10</span>:<span class="token number">00</span>:<span class="token number">00</span>     url11   <span class="token number">1</span>       <span class="token number">1970</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">01</span> <span class="token number">00</span>:<span class="token number">00</span>:<span class="token number">00</span>     <span class="token boolean">NULL</span>cookie2 <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">10</span>:<span class="token number">00</span>:<span class="token number">02</span>     url22   <span class="token number">2</span>       <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">10</span>:<span class="token number">00</span>:<span class="token number">00</span>     <span class="token boolean">NULL</span>cookie2 <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">10</span>:<span class="token number">03</span>:<span class="token number">04</span>     url33   <span class="token number">3</span>       <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">10</span>:<span class="token number">00</span>:<span class="token number">02</span>     <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">10</span>:<span class="token number">00</span>:<span class="token number">00</span>cookie2 <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">10</span>:<span class="token number">10</span>:<span class="token number">00</span>     url44   <span class="token number">4</span>       <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">10</span>:<span class="token number">03</span>:<span class="token number">04</span>     <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">10</span>:<span class="token number">00</span>:<span class="token number">02</span>cookie2 <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">10</span>:<span class="token number">50</span>:<span class="token number">01</span>     url55   <span class="token number">5</span>       <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">10</span>:<span class="token number">10</span>:<span class="token number">00</span>     <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">10</span>:<span class="token number">03</span>:<span class="token number">04</span>cookie2 <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">10</span>:<span class="token number">50</span>:<span class="token number">05</span>     url66   <span class="token number">6</span>       <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">10</span>:<span class="token number">50</span>:<span class="token number">01</span>     <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">10</span>:<span class="token number">10</span>:<span class="token number">00</span>cookie2 <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">11</span>:<span class="token number">00</span>:<span class="token number">00</span>     url77   <span class="token number">7</span>       <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">10</span>:<span class="token number">50</span>:<span class="token number">05</span>     <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">10</span>:<span class="token number">50</span>:<span class="token number">01</span>last_1_time:  指定了往上第 <span class="token number">1</span> 行的值，<span class="token keyword">default</span> 为 <span class="token string">'1970-01-01 00:00:00'</span>  cookie1 第一行，往上 <span class="token number">1</span> 行为 <span class="token boolean">NULL</span>，因此取默认值 <span class="token number">1970</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">01</span> <span class="token number">00</span>:<span class="token number">00</span>:<span class="token number">00</span>  cookie1 第三行，往上 <span class="token number">1</span> 行值为第二行值，<span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">10</span>:<span class="token number">00</span>:<span class="token number">02</span>  cookie1 第六行，往上 <span class="token number">1</span> 行值为第五行值，<span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">10</span>:<span class="token number">50</span>:<span class="token number">01</span>last_2_time:   指定了往上第 <span class="token number">2</span> 行的值，为指定默认值  cookie1 第一行，往上 <span class="token number">2</span> 行为 <span class="token boolean">NULL</span>  cookie1 第二行，往上 <span class="token number">2</span> 行为 <span class="token boolean">NULL</span>  cookie1 第四行，往上 <span class="token number">2</span> 行为第二行值，<span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">10</span>:<span class="token number">00</span>:<span class="token number">02</span>  cookie1 第七行，往上 <span class="token number">2</span> 行为第五行值，<span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">10</span>:<span class="token number">50</span>:<span class="token number">01</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h4 id="LEAD"><a href="#LEAD" class="headerlink" title="LEAD"></a>LEAD</h4><p>与 LAG 相反 <code>LEAD(col, n, DEFAULT)</code> 用于统计窗口内往下第 n 行值第一个参数为列名，第二个参数为往下第 n 行（可选，默认为 1），第三个参数为默认值（当往下第 n 行为 NULL 时候，取默认值，如不指定，则为 NULL）</p><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> cookieid<span class="token punctuation">,</span> createtime<span class="token punctuation">,</span> url<span class="token punctuation">,</span>  ROW_NUMBER<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">OVER</span><span class="token punctuation">(</span><span class="token keyword">PARTITION</span> <span class="token keyword">BY</span> cookieid <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> createtime<span class="token punctuation">)</span> <span class="token keyword">AS</span> rn<span class="token punctuation">,</span>  LEAD<span class="token punctuation">(</span>createtime<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'1970-01-01 00:00:00'</span><span class="token punctuation">)</span> <span class="token keyword">OVER</span><span class="token punctuation">(</span><span class="token keyword">PARTITION</span> <span class="token keyword">BY</span> cookieid <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> createtime<span class="token punctuation">)</span> <span class="token keyword">AS</span> next_1_time<span class="token punctuation">,</span>  LEAD<span class="token punctuation">(</span>createtime<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token keyword">OVER</span><span class="token punctuation">(</span><span class="token keyword">PARTITION</span> <span class="token keyword">BY</span> cookieid <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> createtime<span class="token punctuation">)</span> <span class="token keyword">AS</span> next_2_time <span class="token keyword">FROM</span> test_t3<span class="token punctuation">;</span>cookieid createtime             url    rn       next_1_time             next_2_time <span class="token comment">-------------------------------------------------------------------------------------------</span>cookie1 <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">10</span>:<span class="token number">00</span>:<span class="token number">00</span>     url1    <span class="token number">1</span>       <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">10</span>:<span class="token number">00</span>:<span class="token number">02</span>     <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">10</span>:<span class="token number">03</span>:<span class="token number">04</span>cookie1 <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">10</span>:<span class="token number">00</span>:<span class="token number">02</span>     url2    <span class="token number">2</span>       <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">10</span>:<span class="token number">03</span>:<span class="token number">04</span>     <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">10</span>:<span class="token number">10</span>:<span class="token number">00</span>cookie1 <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">10</span>:<span class="token number">03</span>:<span class="token number">04</span>     url3    <span class="token number">3</span>       <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">10</span>:<span class="token number">10</span>:<span class="token number">00</span>     <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">10</span>:<span class="token number">50</span>:<span class="token number">01</span>cookie1 <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">10</span>:<span class="token number">10</span>:<span class="token number">00</span>     url4    <span class="token number">4</span>       <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">10</span>:<span class="token number">50</span>:<span class="token number">01</span>     <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">10</span>:<span class="token number">50</span>:<span class="token number">05</span>cookie1 <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">10</span>:<span class="token number">50</span>:<span class="token number">01</span>     url5    <span class="token number">5</span>       <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">10</span>:<span class="token number">50</span>:<span class="token number">05</span>     <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">11</span>:<span class="token number">00</span>:<span class="token number">00</span>cookie1 <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">10</span>:<span class="token number">50</span>:<span class="token number">05</span>     url6    <span class="token number">6</span>       <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">11</span>:<span class="token number">00</span>:<span class="token number">00</span>     <span class="token boolean">NULL</span>cookie1 <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">11</span>:<span class="token number">00</span>:<span class="token number">00</span>     url7    <span class="token number">7</span>       <span class="token number">1970</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">01</span> <span class="token number">00</span>:<span class="token number">00</span>:<span class="token number">00</span>     <span class="token boolean">NULL</span>cookie2 <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">10</span>:<span class="token number">00</span>:<span class="token number">00</span>     url11   <span class="token number">1</span>       <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">10</span>:<span class="token number">00</span>:<span class="token number">02</span>     <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">10</span>:<span class="token number">03</span>:<span class="token number">04</span>cookie2 <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">10</span>:<span class="token number">00</span>:<span class="token number">02</span>     url22   <span class="token number">2</span>       <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">10</span>:<span class="token number">03</span>:<span class="token number">04</span>     <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">10</span>:<span class="token number">10</span>:<span class="token number">00</span>cookie2 <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">10</span>:<span class="token number">03</span>:<span class="token number">04</span>     url33   <span class="token number">3</span>       <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">10</span>:<span class="token number">10</span>:<span class="token number">00</span>     <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">10</span>:<span class="token number">50</span>:<span class="token number">01</span>cookie2 <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">10</span>:<span class="token number">10</span>:<span class="token number">00</span>     url44   <span class="token number">4</span>       <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">10</span>:<span class="token number">50</span>:<span class="token number">01</span>     <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">10</span>:<span class="token number">50</span>:<span class="token number">05</span>cookie2 <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">10</span>:<span class="token number">50</span>:<span class="token number">01</span>     url55   <span class="token number">5</span>       <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">10</span>:<span class="token number">50</span>:<span class="token number">05</span>     <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">11</span>:<span class="token number">00</span>:<span class="token number">00</span>cookie2 <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">10</span>:<span class="token number">50</span>:<span class="token number">05</span>     url66   <span class="token number">6</span>       <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">11</span>:<span class="token number">00</span>:<span class="token number">00</span>     <span class="token boolean">NULL</span>cookie2 <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">11</span>:<span class="token number">00</span>:<span class="token number">00</span>     url77   <span class="token number">7</span>       <span class="token number">1970</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">01</span> <span class="token number">00</span>:<span class="token number">00</span>:<span class="token number">00</span>     <span class="token boolean">NULL</span>逻辑与LAG一样，只不过 LAG 是往上，LEAD 是往下。<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h4 id="FIRST-VALUE"><a href="#FIRST-VALUE" class="headerlink" title="FIRST_VALUE"></a>FIRST_VALUE</h4><p>取分组内排序后，截止到当前行，第一个值</p><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> cookieid<span class="token punctuation">,</span> createtime<span class="token punctuation">,</span> url<span class="token punctuation">,</span>  ROW_NUMBER<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">OVER</span><span class="token punctuation">(</span><span class="token keyword">PARTITION</span> <span class="token keyword">BY</span> cookieid <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> createtime<span class="token punctuation">)</span> <span class="token keyword">AS</span> rn<span class="token punctuation">,</span>  FIRST_VALUE<span class="token punctuation">(</span>url<span class="token punctuation">)</span> <span class="token keyword">OVER</span><span class="token punctuation">(</span><span class="token keyword">PARTITION</span> <span class="token keyword">BY</span> cookieid <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> createtime<span class="token punctuation">)</span> <span class="token keyword">AS</span> first1 <span class="token keyword">FROM</span> test_t3<span class="token punctuation">;</span>cookieid  createtime            url     rn      first1<span class="token comment">---------------------------------------------------------</span>cookie1 <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">10</span>:<span class="token number">00</span>:<span class="token number">00</span>     url1    <span class="token number">1</span>       url1cookie1 <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">10</span>:<span class="token number">00</span>:<span class="token number">02</span>     url2    <span class="token number">2</span>       url1cookie1 <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">10</span>:<span class="token number">03</span>:<span class="token number">04</span>     url3    <span class="token number">3</span>       url1cookie1 <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">10</span>:<span class="token number">10</span>:<span class="token number">00</span>     url4    <span class="token number">4</span>       url1cookie1 <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">10</span>:<span class="token number">50</span>:<span class="token number">01</span>     url5    <span class="token number">5</span>       url1cookie1 <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">10</span>:<span class="token number">50</span>:<span class="token number">05</span>     url6    <span class="token number">6</span>       url1cookie1 <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">11</span>:<span class="token number">00</span>:<span class="token number">00</span>     url7    <span class="token number">7</span>       url1cookie2 <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">10</span>:<span class="token number">00</span>:<span class="token number">00</span>     url11   <span class="token number">1</span>       url11cookie2 <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">10</span>:<span class="token number">00</span>:<span class="token number">02</span>     url22   <span class="token number">2</span>       url11cookie2 <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">10</span>:<span class="token number">03</span>:<span class="token number">04</span>     url33   <span class="token number">3</span>       url11cookie2 <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">10</span>:<span class="token number">10</span>:<span class="token number">00</span>     url44   <span class="token number">4</span>       url11cookie2 <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">10</span>:<span class="token number">50</span>:<span class="token number">01</span>     url55   <span class="token number">5</span>       url11cookie2 <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">10</span>:<span class="token number">50</span>:<span class="token number">05</span>     url66   <span class="token number">6</span>       url11cookie2 <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">11</span>:<span class="token number">00</span>:<span class="token number">00</span>     url77   <span class="token number">7</span>       url11<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h4 id="LAST-VALUE"><a href="#LAST-VALUE" class="headerlink" title="LAST_VALUE"></a>LAST_VALUE</h4><p>取分组内排序后，截止到当前行，最后一个值</p><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> cookieid<span class="token punctuation">,</span> createtime<span class="token punctuation">,</span> url<span class="token punctuation">,</span>  ROW_NUMBER<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">OVER</span><span class="token punctuation">(</span><span class="token keyword">PARTITION</span> <span class="token keyword">BY</span> cookieid <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> createtime<span class="token punctuation">)</span> <span class="token keyword">AS</span> rn<span class="token punctuation">,</span>  LAST_VALUE<span class="token punctuation">(</span>url<span class="token punctuation">)</span> <span class="token keyword">OVER</span><span class="token punctuation">(</span><span class="token keyword">PARTITION</span> <span class="token keyword">BY</span> cookieid <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> createtime<span class="token punctuation">)</span> <span class="token keyword">AS</span> last1 <span class="token keyword">FROM</span> test_t3<span class="token punctuation">;</span>cookieid  createtime            url    rn       last1<span class="token comment">-----------------------------------------------------------------</span>cookie1 <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">10</span>:<span class="token number">00</span>:<span class="token number">00</span>     url1    <span class="token number">1</span>       url1cookie1 <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">10</span>:<span class="token number">00</span>:<span class="token number">02</span>     url2    <span class="token number">2</span>       url2cookie1 <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">10</span>:<span class="token number">03</span>:<span class="token number">04</span>     url3    <span class="token number">3</span>       url3cookie1 <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">10</span>:<span class="token number">10</span>:<span class="token number">00</span>     url4    <span class="token number">4</span>       url4cookie1 <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">10</span>:<span class="token number">50</span>:<span class="token number">01</span>     url5    <span class="token number">5</span>       url5cookie1 <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">10</span>:<span class="token number">50</span>:<span class="token number">05</span>     url6    <span class="token number">6</span>       url6cookie1 <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">11</span>:<span class="token number">00</span>:<span class="token number">00</span>     url7    <span class="token number">7</span>       url7cookie2 <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">10</span>:<span class="token number">00</span>:<span class="token number">00</span>     url11   <span class="token number">1</span>       url11cookie2 <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">10</span>:<span class="token number">00</span>:<span class="token number">02</span>     url22   <span class="token number">2</span>       url22cookie2 <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">10</span>:<span class="token number">03</span>:<span class="token number">04</span>     url33   <span class="token number">3</span>       url33cookie2 <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">10</span>:<span class="token number">10</span>:<span class="token number">00</span>     url44   <span class="token number">4</span>       url44cookie2 <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">10</span>:<span class="token number">50</span>:<span class="token number">01</span>     url55   <span class="token number">5</span>       url55cookie2 <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">10</span>:<span class="token number">50</span>:<span class="token number">05</span>     url66   <span class="token number">6</span>       url66cookie2 <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">11</span>:<span class="token number">00</span>:<span class="token number">00</span>     url77   <span class="token number">7</span>       url77<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p>如果想要取分组内排序后最后一个值，则需要变通一下：</p><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> cookieid<span class="token punctuation">,</span> createtime<span class="token punctuation">,</span> url<span class="token punctuation">,</span>  ROW_NUMBER<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">OVER</span><span class="token punctuation">(</span><span class="token keyword">PARTITION</span> <span class="token keyword">BY</span> cookieid <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> createtime<span class="token punctuation">)</span> <span class="token keyword">AS</span> rn<span class="token punctuation">,</span>  LAST_VALUE<span class="token punctuation">(</span>url<span class="token punctuation">)</span> <span class="token keyword">OVER</span><span class="token punctuation">(</span><span class="token keyword">PARTITION</span> <span class="token keyword">BY</span> cookieid <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> createtime<span class="token punctuation">)</span> <span class="token keyword">AS</span> last1<span class="token punctuation">,</span>  FIRST_VALUE<span class="token punctuation">(</span>url<span class="token punctuation">)</span> <span class="token keyword">OVER</span><span class="token punctuation">(</span><span class="token keyword">PARTITION</span> <span class="token keyword">BY</span> cookieid <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> createtime <span class="token keyword">DESC</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> last2 <span class="token keyword">FROM</span> test_t3 <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> cookieid<span class="token punctuation">,</span> createtime<span class="token punctuation">;</span>cookieid  createtime            url     rn     last1    last2<span class="token comment">-------------------------------------------------------------</span>cookie1 <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">10</span>:<span class="token number">00</span>:<span class="token number">00</span>     url1    <span class="token number">1</span>       url1    url7cookie1 <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">10</span>:<span class="token number">00</span>:<span class="token number">02</span>     url2    <span class="token number">2</span>       url2    url7cookie1 <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">10</span>:<span class="token number">03</span>:<span class="token number">04</span>     url3    <span class="token number">3</span>       url3   url7cookie1 <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">10</span>:<span class="token number">10</span>:<span class="token number">00</span>     url4    <span class="token number">4</span>       url4    url7cookie1 <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">10</span>:<span class="token number">50</span>:<span class="token number">01</span>     url5    <span class="token number">5</span>       url5    url7cookie1 <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">10</span>:<span class="token number">50</span>:<span class="token number">05</span>     url6    <span class="token number">6</span>       url6    url7cookie1 <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">11</span>:<span class="token number">00</span>:<span class="token number">00</span>     url7    <span class="token number">7</span>       url7    url7cookie2 <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">10</span>:<span class="token number">00</span>:<span class="token number">00</span>     url11   <span class="token number">1</span>       url11   url77cookie2 <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">10</span>:<span class="token number">00</span>:<span class="token number">02</span>     url22   <span class="token number">2</span>       url22   url77cookie2 <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">10</span>:<span class="token number">03</span>:<span class="token number">04</span>     url33   <span class="token number">3</span>       url33   url77cookie2 <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">10</span>:<span class="token number">10</span>:<span class="token number">00</span>     url44   <span class="token number">4</span>       url44   url77cookie2 <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">10</span>:<span class="token number">50</span>:<span class="token number">01</span>     url55   <span class="token number">5</span>       url55   url77cookie2 <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">10</span>:<span class="token number">50</span>:<span class="token number">05</span>     url66   <span class="token number">6</span>       url66   url77cookie2 <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">11</span>:<span class="token number">00</span>:<span class="token number">00</span>     url77   <span class="token number">7</span>       url77   url77<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p><strong>注意：</strong>在使用分析函数的过程中特别注意 <code>ORDER BY</code>， 如果不指定 <code>ORDER BY</code>，则默认按照记录在文件中的偏移量进行排序，会出现错误的结果</p><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> cookieid<span class="token punctuation">,</span> createtime<span class="token punctuation">,</span> url<span class="token punctuation">,</span>  FIRST_VALUE<span class="token punctuation">(</span>url<span class="token punctuation">)</span> <span class="token keyword">OVER</span><span class="token punctuation">(</span><span class="token keyword">PARTITION</span> <span class="token keyword">BY</span> cookieid<span class="token punctuation">)</span> <span class="token keyword">AS</span> first2<span class="token keyword">FROM</span> test_t3<span class="token punctuation">;</span>cookieid  createtime            url     first2<span class="token comment">----------------------------------------------</span>cookie1 <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">10</span>:<span class="token number">00</span>:<span class="token number">02</span>     url2    url2cookie1 <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">10</span>:<span class="token number">00</span>:<span class="token number">00</span>     url1    url2cookie1 <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">10</span>:<span class="token number">03</span>:<span class="token number">04</span>     url3    url2cookie1 <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">10</span>:<span class="token number">50</span>:<span class="token number">05</span>     url6    url2cookie1 <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">11</span>:<span class="token number">00</span>:<span class="token number">00</span>     url7    url2cookie1 <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">10</span>:<span class="token number">10</span>:<span class="token number">00</span>     url4    url2cookie1 <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">10</span>:<span class="token number">50</span>:<span class="token number">01</span>     url5    url2cookie2 <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">10</span>:<span class="token number">00</span>:<span class="token number">02</span>     url22   url22cookie2 <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">10</span>:<span class="token number">00</span>:<span class="token number">00</span>     url11   url22cookie2 <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">10</span>:<span class="token number">03</span>:<span class="token number">04</span>     url33   url22cookie2 <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">10</span>:<span class="token number">50</span>:<span class="token number">05</span>     url66   url22cookie2 <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">11</span>:<span class="token number">00</span>:<span class="token number">00</span>     url77   url22cookie2 <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">10</span>:<span class="token number">10</span>:<span class="token number">00</span>     url44   url22cookie2 <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">10</span>:<span class="token number">50</span>:<span class="token number">01</span>     url55   url22<span class="token keyword">SELECT</span> cookieid<span class="token punctuation">,</span> createtime<span class="token punctuation">,</span> url<span class="token punctuation">,</span>  LAST_VALUE<span class="token punctuation">(</span>url<span class="token punctuation">)</span> <span class="token keyword">OVER</span><span class="token punctuation">(</span><span class="token keyword">PARTITION</span> <span class="token keyword">BY</span> cookieid<span class="token punctuation">)</span> <span class="token keyword">AS</span> last2<span class="token keyword">FROM</span> test_t3<span class="token punctuation">;</span>cookieid  createtime            url     last2<span class="token comment">----------------------------------------------</span>cookie1 <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">10</span>:<span class="token number">00</span>:<span class="token number">02</span>     url2    url5cookie1 <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">10</span>:<span class="token number">00</span>:<span class="token number">00</span>     url1    url5cookie1 <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">10</span>:<span class="token number">03</span>:<span class="token number">04</span>     url3    url5cookie1 <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">10</span>:<span class="token number">50</span>:<span class="token number">05</span>     url6    url5cookie1 <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">11</span>:<span class="token number">00</span>:<span class="token number">00</span>     url7    url5cookie1 <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">10</span>:<span class="token number">10</span>:<span class="token number">00</span>     url4    url5cookie1 <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">10</span>:<span class="token number">50</span>:<span class="token number">01</span>     url5    url5cookie2 <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">10</span>:<span class="token number">00</span>:<span class="token number">02</span>     url22   url55cookie2 <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">10</span>:<span class="token number">00</span>:<span class="token number">00</span>     url11   url55cookie2 <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">10</span>:<span class="token number">03</span>:<span class="token number">04</span>     url33   url55cookie2 <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">10</span>:<span class="token number">50</span>:<span class="token number">05</span>     url66   url55cookie2 <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">11</span>:<span class="token number">00</span>:<span class="token number">00</span>     url77   url55cookie2 <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">10</span>:<span class="token number">10</span>:<span class="token number">00</span>     url44   url55cookie2 <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">10</span>:<span class="token number">50</span>:<span class="token number">01</span>     url55   url55<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h3 id="cume-dist-percent-rank"><a href="#cume-dist-percent-rank" class="headerlink" title="cume_dist, percent_rank"></a>cume_dist, percent_rank</h3><p>这两个序列分析函数不是很常用，<strong>注意：</strong>序列函数不支持 WINDOW 子句</p><p><strong>数据准备</strong></p><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">d1<span class="token punctuation">,</span>user1<span class="token punctuation">,</span><span class="token number">1000</span>d1<span class="token punctuation">,</span>user2<span class="token punctuation">,</span><span class="token number">2000</span>d1<span class="token punctuation">,</span>user3<span class="token punctuation">,</span><span class="token number">3000</span>d2<span class="token punctuation">,</span>user4<span class="token punctuation">,</span><span class="token number">4000</span>d2<span class="token punctuation">,</span>user5<span class="token punctuation">,</span><span class="token number">5000</span><span class="token keyword">CREATE</span> EXTERNAL <span class="token keyword">TABLE</span> test_t4 <span class="token punctuation">(</span>  dept STRING<span class="token punctuation">,</span>  userid string<span class="token punctuation">,</span>  sal <span class="token keyword">INT</span><span class="token punctuation">)</span> <span class="token keyword">ROW</span> FORMAT DELIMITED <span class="token keyword">FIELDS</span> <span class="token keyword">TERMINATED</span> <span class="token keyword">BY</span> <span class="token string">','</span> stored <span class="token keyword">as</span> textfile<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p><strong>加载数据：</strong></p><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">load</span> <span class="token keyword">data</span> <span class="token keyword">local</span> inpath <span class="token string">'/root/hivedata/test_t4.dat'</span> <span class="token keyword">into</span> <span class="token keyword">table</span> test_t4<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><h4 id="CUME-DIST"><a href="#CUME-DIST" class="headerlink" title="CUME_DIST"></a>CUME_DIST</h4><p><code>CUME_DIST</code> 和 <code>order by</code> 的排序顺序有关系</p><p><code>CUME_DIST</code> 小于等于当前值的行数/分组内总行数 <code>order</code> 默认顺序（正序 升序）比如，统计小于等于当前薪水的人数，所占总人数的比例</p><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> dept<span class="token punctuation">,</span> userid<span class="token punctuation">,</span> sal<span class="token punctuation">,</span>  CUME_DIST<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">OVER</span><span class="token punctuation">(</span><span class="token keyword">ORDER</span> <span class="token keyword">BY</span> sal<span class="token punctuation">)</span> <span class="token keyword">AS</span> rn1<span class="token punctuation">,</span>  CUME_DIST<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">OVER</span><span class="token punctuation">(</span><span class="token keyword">PARTITION</span> <span class="token keyword">BY</span> dept <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> sal<span class="token punctuation">)</span> <span class="token keyword">AS</span> rn2<span class="token keyword">FROM</span> test_t4<span class="token punctuation">;</span>dept    userid   sal   rn1       rn2 <span class="token comment">-------------------------------------------</span>d1      user1   <span class="token number">1000</span>    <span class="token number">0.2</span>     <span class="token number">0.3333333333333333</span>d1      user2   <span class="token number">2000</span>    <span class="token number">0.4</span>     <span class="token number">0.6666666666666666</span>d1      user3   <span class="token number">3000</span>    <span class="token number">0.6</span>     <span class="token number">1.0</span>d2      user4   <span class="token number">4000</span>    <span class="token number">0.8</span>     <span class="token number">0.5</span>d2      user5   <span class="token number">5000</span>    <span class="token number">1.0</span>     <span class="token number">1.0</span> rn1: 没有 <span class="token keyword">partition</span>，所有数据均为 <span class="token number">1</span> 组，总行数为 <span class="token number">5</span>，     第一行：小于等于 <span class="token number">1000</span> 的行数为 <span class="token number">1</span>，因此，<span class="token number">1</span><span class="token operator">/</span><span class="token number">5</span><span class="token operator">=</span><span class="token number">0.2</span>     第三行：小于等于 <span class="token number">3000</span> 的行数为 <span class="token number">3</span>，因此，<span class="token number">3</span><span class="token operator">/</span><span class="token number">5</span><span class="token operator">=</span><span class="token number">0.6</span>rn2: 按照部门分组，dpet<span class="token operator">=</span>d1 的行数为 <span class="token number">3</span>，     第二行：小于等于 <span class="token number">2000</span> 的行数为 <span class="token number">2</span>，因此，<span class="token number">2</span><span class="token operator">/</span><span class="token number">3</span><span class="token operator">=</span><span class="token number">0.6666666666666666</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h4 id="PERCENT-RANK"><a href="#PERCENT-RANK" class="headerlink" title="PERCENT_RANK"></a>PERCENT_RANK</h4><p><code>PERCENT_RANK</code> 分组内当前行的 (RANK 值 - 1)/(分组内总行数 - 1)</p><p>经调研，该函数显示现实意义不明朗，有待于继续考证</p><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> dept<span class="token punctuation">,</span> userid<span class="token punctuation">,</span> sal<span class="token punctuation">,</span>  PERCENT_RANK<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">OVER</span><span class="token punctuation">(</span><span class="token keyword">ORDER</span> <span class="token keyword">BY</span> sal<span class="token punctuation">)</span> <span class="token keyword">AS</span> rn1<span class="token punctuation">,</span>   <span class="token comment">--分组内</span>  RANK<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">OVER</span><span class="token punctuation">(</span><span class="token keyword">ORDER</span> <span class="token keyword">BY</span> sal<span class="token punctuation">)</span> <span class="token keyword">AS</span> rn11<span class="token punctuation">,</span>          <span class="token comment">--分组内RANK值</span>  <span class="token function">SUM</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">OVER</span><span class="token punctuation">(</span><span class="token keyword">PARTITION</span> <span class="token keyword">BY</span> <span class="token boolean">NULL</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> rn12<span class="token punctuation">,</span>     <span class="token comment">--分组内总行数</span>  PERCENT_RANK<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">OVER</span><span class="token punctuation">(</span><span class="token keyword">PARTITION</span> <span class="token keyword">BY</span> dept <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> sal<span class="token punctuation">)</span> <span class="token keyword">AS</span> rn2 <span class="token keyword">FROM</span> test_t4<span class="token punctuation">;</span>dept    userid   sal    rn1    rn11     rn12    rn2<span class="token comment">---------------------------------------------------</span>d1      user1   <span class="token number">1000</span>    <span class="token number">0.0</span>     <span class="token number">1</span>       <span class="token number">5</span>       <span class="token number">0.0</span>d1      user2   <span class="token number">2000</span>    <span class="token number">0.25</span>    <span class="token number">2</span>       <span class="token number">5</span>       <span class="token number">0.5</span>d1      user3   <span class="token number">3000</span>    <span class="token number">0.5</span>     <span class="token number">3</span>       <span class="token number">5</span>       <span class="token number">1.0</span>d2      user4   <span class="token number">4000</span>    <span class="token number">0.75</span>    <span class="token number">4</span>       <span class="token number">5</span>       <span class="token number">0.0</span>d2      user5   <span class="token number">5000</span>    <span class="token number">1.0</span>     <span class="token number">5</span>       <span class="token number">5</span>       <span class="token number">1.0</span>rn1: rn1 <span class="token operator">=</span> <span class="token punctuation">(</span>rn11<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span>rn12<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>   第一行，<span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token operator">/</span><span class="token number">4</span> <span class="token operator">=</span> <span class="token number">0</span>  第二行，<span class="token punctuation">(</span><span class="token number">2</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token operator">/</span><span class="token number">4</span> <span class="token operator">=</span> <span class="token number">0.25</span>  第四行，<span class="token punctuation">(</span><span class="token number">4</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">3</span><span class="token operator">/</span><span class="token number">4</span> <span class="token operator">=</span> <span class="token number">0.75</span>rn2: 按照 dept 分组，  dept<span class="token operator">=</span>d1 的总行数为 <span class="token number">3</span>  第一行，<span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span>  第三行，<span class="token punctuation">(</span><span class="token number">3</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">1</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h3 id="grouping-sets-cube-rollup"><a href="#grouping-sets-cube-rollup" class="headerlink" title="grouping sets, cube, rollup"></a>grouping sets, cube, rollup</h3><p>这几个分析函数通常用于 OLAP 中，不能累加，而且需要根据不同维度上钻和下钻的指标统计，比如，分小时、天、月的 UV 数。</p><p><strong>数据准备：</strong></p><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> test_t5 <span class="token punctuation">(</span>  <span class="token keyword">month</span> STRING<span class="token punctuation">,</span>  <span class="token keyword">day</span> STRING<span class="token punctuation">,</span>   cookieid STRING <span class="token punctuation">)</span> <span class="token keyword">ROW</span> FORMAT DELIMITED <span class="token keyword">FIELDS</span> <span class="token keyword">TERMINATED</span> <span class="token keyword">BY</span> <span class="token string">','</span> stored <span class="token keyword">as</span> textfile<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p><strong>加载数据：</strong></p><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">load</span> <span class="token keyword">data</span> <span class="token keyword">local</span> inpath <span class="token string">'/root/hivedata/test_t5.dat'</span> <span class="token keyword">into</span> <span class="token keyword">table</span> test_t5<span class="token punctuation">;</span><span class="token number">2020</span><span class="token operator">-</span><span class="token number">03</span><span class="token punctuation">,</span><span class="token number">2020</span><span class="token operator">-</span><span class="token number">03</span><span class="token operator">-</span><span class="token number">10</span><span class="token punctuation">,</span>cookie1<span class="token number">2020</span><span class="token operator">-</span><span class="token number">03</span><span class="token punctuation">,</span><span class="token number">2020</span><span class="token operator">-</span><span class="token number">03</span><span class="token operator">-</span><span class="token number">10</span><span class="token punctuation">,</span>cookie5<span class="token number">2020</span><span class="token operator">-</span><span class="token number">03</span><span class="token punctuation">,</span><span class="token number">2020</span><span class="token operator">-</span><span class="token number">03</span><span class="token operator">-</span><span class="token number">12</span><span class="token punctuation">,</span>cookie7<span class="token number">2020</span><span class="token operator">-</span><span class="token number">04</span><span class="token punctuation">,</span><span class="token number">2020</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">12</span><span class="token punctuation">,</span>cookie3<span class="token number">2020</span><span class="token operator">-</span><span class="token number">04</span><span class="token punctuation">,</span><span class="token number">2020</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">13</span><span class="token punctuation">,</span>cookie2<span class="token number">2020</span><span class="token operator">-</span><span class="token number">04</span><span class="token punctuation">,</span><span class="token number">2020</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">13</span><span class="token punctuation">,</span>cookie4<span class="token number">2020</span><span class="token operator">-</span><span class="token number">04</span><span class="token punctuation">,</span><span class="token number">2020</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">16</span><span class="token punctuation">,</span>cookie4<span class="token number">2020</span><span class="token operator">-</span><span class="token number">03</span><span class="token punctuation">,</span><span class="token number">2020</span><span class="token operator">-</span><span class="token number">03</span><span class="token operator">-</span><span class="token number">10</span><span class="token punctuation">,</span>cookie2<span class="token number">2020</span><span class="token operator">-</span><span class="token number">03</span><span class="token punctuation">,</span><span class="token number">2020</span><span class="token operator">-</span><span class="token number">03</span><span class="token operator">-</span><span class="token number">10</span><span class="token punctuation">,</span>cookie3<span class="token number">2020</span><span class="token operator">-</span><span class="token number">04</span><span class="token punctuation">,</span><span class="token number">2020</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">12</span><span class="token punctuation">,</span>cookie5<span class="token number">2020</span><span class="token operator">-</span><span class="token number">04</span><span class="token punctuation">,</span><span class="token number">2020</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">13</span><span class="token punctuation">,</span>cookie6<span class="token number">2020</span><span class="token operator">-</span><span class="token number">04</span><span class="token punctuation">,</span><span class="token number">2020</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">15</span><span class="token punctuation">,</span>cookie3<span class="token number">2020</span><span class="token operator">-</span><span class="token number">04</span><span class="token punctuation">,</span><span class="token number">2020</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">15</span><span class="token punctuation">,</span>cookie2<span class="token number">2020</span><span class="token operator">-</span><span class="token number">04</span><span class="token punctuation">,</span><span class="token number">2020</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">16</span><span class="token punctuation">,</span>cookie1<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h4 id="GROUPING-SETS"><a href="#GROUPING-SETS" class="headerlink" title="GROUPING SETS"></a>GROUPING SETS</h4><p><code>grouping sets</code> 是一种将多个 <code>group by</code> 逻辑写在一个 SQL 语句中的便利写法。</p><p>等价于将不同维度的 <code>GROUP BY</code> 结果集进行 <code>UNION ALL</code>。</p><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token keyword">month</span><span class="token punctuation">,</span> <span class="token keyword">day</span><span class="token punctuation">,</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token keyword">DISTINCT</span> cookieid<span class="token punctuation">)</span> <span class="token keyword">AS</span> uv<span class="token punctuation">,</span> GROUPING__ID <span class="token keyword">FROM</span> test_t5 <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> <span class="token keyword">month</span><span class="token punctuation">,</span> <span class="token keyword">day</span> GROUPING SETS <span class="token punctuation">(</span><span class="token keyword">month</span><span class="token punctuation">,</span> <span class="token keyword">day</span><span class="token punctuation">)</span> <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> GROUPING__ID<span class="token punctuation">;</span><span class="token keyword">month</span>      <span class="token keyword">day</span>            uv      GROUPING__ID<span class="token comment">------------------------------------------------</span><span class="token number">2015</span><span class="token operator">-</span><span class="token number">03</span>    <span class="token boolean">NULL</span>            <span class="token number">5</span>       <span class="token number">1</span><span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span>    <span class="token boolean">NULL</span>            <span class="token number">6</span>       <span class="token number">1</span><span class="token boolean">NULL</span>       <span class="token number">2015</span><span class="token operator">-</span><span class="token number">03</span><span class="token operator">-</span><span class="token number">10</span>      <span class="token number">4</span>       <span class="token number">2</span><span class="token boolean">NULL</span>       <span class="token number">2015</span><span class="token operator">-</span><span class="token number">03</span><span class="token operator">-</span><span class="token number">12</span>      <span class="token number">1</span>       <span class="token number">2</span><span class="token boolean">NULL</span>       <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">12</span>      <span class="token number">2</span>       <span class="token number">2</span><span class="token boolean">NULL</span>       <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">13</span>      <span class="token number">3</span>       <span class="token number">2</span><span class="token boolean">NULL</span>       <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">15</span>      <span class="token number">2</span>       <span class="token number">2</span><span class="token boolean">NULL</span>       <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">16</span>      <span class="token number">2</span>       <span class="token number">2</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p><code>grouping_id</code> 表示这一组结果属于哪个分组集合，根据 <code>grouping sets</code> 中的分组条件 month，day，1 是代表 month，2 是代表 day</p><p>等价于</p><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token keyword">month</span><span class="token punctuation">,</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token keyword">DISTINCT</span> cookieid<span class="token punctuation">)</span> <span class="token keyword">AS</span> uv<span class="token punctuation">,</span> <span class="token number">1</span> <span class="token keyword">AS</span> GROUPING__ID <span class="token keyword">FROM</span> test_t5 <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> <span class="token keyword">month</span> <span class="token keyword">UNION</span> <span class="token keyword">ALL</span> <span class="token keyword">SELECT</span> <span class="token boolean">NULL</span> <span class="token keyword">as</span> <span class="token keyword">month</span><span class="token punctuation">,</span> <span class="token keyword">day</span><span class="token punctuation">,</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token keyword">DISTINCT</span> cookieid<span class="token punctuation">)</span> <span class="token keyword">AS</span> uv<span class="token punctuation">,</span> <span class="token number">2</span> <span class="token keyword">AS</span> GROUPING__ID <span class="token keyword">FROM</span> test_t5 <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> <span class="token keyword">day</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></p><p>再如：</p><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token keyword">month</span><span class="token punctuation">,</span> <span class="token keyword">day</span><span class="token punctuation">,</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token keyword">DISTINCT</span> cookieid<span class="token punctuation">)</span> <span class="token keyword">AS</span> uv<span class="token punctuation">,</span> GROUPING__ID <span class="token keyword">FROM</span> test_t5 <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> <span class="token keyword">month</span><span class="token punctuation">,</span><span class="token keyword">day</span> GROUPING SETS <span class="token punctuation">(</span><span class="token keyword">month</span><span class="token punctuation">,</span> <span class="token keyword">day</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">month</span><span class="token punctuation">,</span> <span class="token keyword">day</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> GROUPING__ID<span class="token punctuation">;</span><span class="token keyword">month</span>         <span class="token keyword">day</span>             uv      GROUPING__ID<span class="token comment">------------------------------------------------</span><span class="token number">2015</span><span class="token operator">-</span><span class="token number">03</span>       <span class="token boolean">NULL</span>            <span class="token number">5</span>       <span class="token number">1</span><span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span>       <span class="token boolean">NULL</span>            <span class="token number">6</span>       <span class="token number">1</span><span class="token boolean">NULL</span>          <span class="token number">2015</span><span class="token operator">-</span><span class="token number">03</span><span class="token operator">-</span><span class="token number">10</span>      <span class="token number">4</span>       <span class="token number">2</span><span class="token boolean">NULL</span>          <span class="token number">2015</span><span class="token operator">-</span><span class="token number">03</span><span class="token operator">-</span><span class="token number">12</span>      <span class="token number">1</span>       <span class="token number">2</span><span class="token boolean">NULL</span>          <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">12</span>      <span class="token number">2</span>       <span class="token number">2</span><span class="token boolean">NULL</span>          <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">13</span>      <span class="token number">3</span>       <span class="token number">2</span><span class="token boolean">NULL</span>          <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">15</span>      <span class="token number">2</span>       <span class="token number">2</span><span class="token boolean">NULL</span>          <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">16</span>      <span class="token number">2</span>       <span class="token number">2</span><span class="token number">2015</span><span class="token operator">-</span><span class="token number">03</span>       <span class="token number">2015</span><span class="token operator">-</span><span class="token number">03</span><span class="token operator">-</span><span class="token number">10</span>      <span class="token number">4</span>       <span class="token number">3</span><span class="token number">2015</span><span class="token operator">-</span><span class="token number">03</span>       <span class="token number">2015</span><span class="token operator">-</span><span class="token number">03</span><span class="token operator">-</span><span class="token number">12</span>      <span class="token number">1</span>       <span class="token number">3</span><span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span>       <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">12</span>      <span class="token number">2</span>       <span class="token number">3</span><span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span>       <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">13</span>      <span class="token number">3</span>       <span class="token number">3</span><span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span>       <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">15</span>      <span class="token number">2</span>       <span class="token number">3</span><span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span>       <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">16</span>      <span class="token number">2</span>       <span class="token number">3</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p>等价于</p><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token keyword">month</span><span class="token punctuation">,</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token keyword">DISTINCT</span> cookieid<span class="token punctuation">)</span> <span class="token keyword">AS</span> uv<span class="token punctuation">,</span> <span class="token number">1</span> <span class="token keyword">AS</span> GROUPING__ID <span class="token keyword">FROM</span> test_t5 <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> <span class="token keyword">month</span> <span class="token keyword">UNION</span> <span class="token keyword">ALL</span> <span class="token keyword">SELECT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span> <span class="token keyword">day</span><span class="token punctuation">,</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token keyword">DISTINCT</span> cookieid<span class="token punctuation">)</span> <span class="token keyword">AS</span> uv<span class="token punctuation">,</span> <span class="token number">2</span> <span class="token keyword">AS</span> GROUPING__ID <span class="token keyword">FROM</span> test_t5 <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> <span class="token keyword">day</span><span class="token keyword">UNION</span> <span class="token keyword">ALL</span> <span class="token keyword">SELECT</span> <span class="token keyword">month</span><span class="token punctuation">,</span> <span class="token keyword">day</span><span class="token punctuation">,</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token keyword">DISTINCT</span> cookieid<span class="token punctuation">)</span> <span class="token keyword">AS</span> uv<span class="token punctuation">,</span> <span class="token number">3</span> <span class="token keyword">AS</span> GROUPING__ID <span class="token keyword">FROM</span> test_t5 <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> <span class="token keyword">month</span><span class="token punctuation">,</span> <span class="token keyword">day</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h4 id="CUBE"><a href="#CUBE" class="headerlink" title="CUBE"></a>CUBE</h4><p>根据 <code>GROUP BY</code> 的维度的所有组合进行聚合。</p><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token keyword">month</span><span class="token punctuation">,</span> <span class="token keyword">day</span><span class="token punctuation">,</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token keyword">DISTINCT</span> cookieid<span class="token punctuation">)</span> <span class="token keyword">AS</span> uv<span class="token punctuation">,</span> GROUPING__ID <span class="token keyword">FROM</span> test_t5 <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> <span class="token keyword">month</span><span class="token punctuation">,</span> <span class="token keyword">day</span> <span class="token keyword">WITH</span> CUBE <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> GROUPING__ID<span class="token punctuation">;</span><span class="token keyword">month</span>           <span class="token keyword">day</span>             uv     GROUPING__ID<span class="token comment">--------------------------------------------</span><span class="token boolean">NULL</span>            <span class="token boolean">NULL</span>            <span class="token number">7</span>       <span class="token number">0</span><span class="token number">2015</span><span class="token operator">-</span><span class="token number">03</span>         <span class="token boolean">NULL</span>            <span class="token number">5</span>       <span class="token number">1</span><span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span>         <span class="token boolean">NULL</span>            <span class="token number">6</span>       <span class="token number">1</span><span class="token boolean">NULL</span>            <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">12</span>      <span class="token number">2</span>       <span class="token number">2</span><span class="token boolean">NULL</span>            <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">13</span>      <span class="token number">3</span>       <span class="token number">2</span><span class="token boolean">NULL</span>            <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">15</span>      <span class="token number">2</span>       <span class="token number">2</span><span class="token boolean">NULL</span>            <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">16</span>      <span class="token number">2</span>       <span class="token number">2</span><span class="token boolean">NULL</span>            <span class="token number">2015</span><span class="token operator">-</span><span class="token number">03</span><span class="token operator">-</span><span class="token number">10</span>      <span class="token number">4</span>       <span class="token number">2</span><span class="token boolean">NULL</span>            <span class="token number">2015</span><span class="token operator">-</span><span class="token number">03</span><span class="token operator">-</span><span class="token number">12</span>      <span class="token number">1</span>       <span class="token number">2</span><span class="token number">2015</span><span class="token operator">-</span><span class="token number">03</span>         <span class="token number">2015</span><span class="token operator">-</span><span class="token number">03</span><span class="token operator">-</span><span class="token number">10</span>      <span class="token number">4</span>       <span class="token number">3</span><span class="token number">2015</span><span class="token operator">-</span><span class="token number">03</span>         <span class="token number">2015</span><span class="token operator">-</span><span class="token number">03</span><span class="token operator">-</span><span class="token number">12</span>      <span class="token number">1</span>       <span class="token number">3</span><span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span>         <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">16</span>      <span class="token number">2</span>       <span class="token number">3</span><span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span>         <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">12</span>      <span class="token number">2</span>       <span class="token number">3</span><span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span>         <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">13</span>      <span class="token number">3</span>       <span class="token number">3</span><span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span>         <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">15</span>      <span class="token number">2</span>       <span class="token number">3</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p>等价于</p><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token keyword">DISTINCT</span> cookieid<span class="token punctuation">)</span> <span class="token keyword">AS</span> uv<span class="token punctuation">,</span> <span class="token number">0</span> <span class="token keyword">AS</span> GROUPING__ID <span class="token keyword">FROM</span> test_t5<span class="token keyword">UNION</span> <span class="token keyword">ALL</span> <span class="token keyword">SELECT</span> <span class="token keyword">month</span><span class="token punctuation">,</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token keyword">DISTINCT</span> cookieid<span class="token punctuation">)</span> <span class="token keyword">AS</span> uv<span class="token punctuation">,</span> <span class="token number">1</span> <span class="token keyword">AS</span> GROUPING__ID <span class="token keyword">FROM</span> test_t5 <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> <span class="token keyword">month</span> <span class="token keyword">UNION</span> <span class="token keyword">ALL</span> <span class="token keyword">SELECT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span> <span class="token keyword">day</span><span class="token punctuation">,</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token keyword">DISTINCT</span> cookieid<span class="token punctuation">)</span> <span class="token keyword">AS</span> uv<span class="token punctuation">,</span> <span class="token number">2</span> <span class="token keyword">AS</span> GROUPING__ID <span class="token keyword">FROM</span> test_t5 <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> <span class="token keyword">day</span><span class="token keyword">UNION</span> <span class="token keyword">ALL</span> <span class="token keyword">SELECT</span> <span class="token keyword">month</span><span class="token punctuation">,</span> <span class="token keyword">day</span><span class="token punctuation">,</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token keyword">DISTINCT</span> cookieid<span class="token punctuation">)</span> <span class="token keyword">AS</span> uv<span class="token punctuation">,</span> <span class="token number">3</span> <span class="token keyword">AS</span> GROUPING__ID <span class="token keyword">FROM</span> test_t5 <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> <span class="token keyword">month</span><span class="token punctuation">,</span> <span class="token keyword">day</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h4 id="ROLLUP"><a href="#ROLLUP" class="headerlink" title="ROLLUP"></a>ROLLUP</h4><p>是 <code>CUBE</code> 的子集，以最左侧的维度为主，从该维度进行层级聚合。</p><p>比如，以 <code>month</code> 维度进行层级聚合：</p><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token keyword">month</span><span class="token punctuation">,</span> <span class="token keyword">day</span><span class="token punctuation">,</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token keyword">DISTINCT</span> cookieid<span class="token punctuation">)</span> <span class="token keyword">AS</span> uv<span class="token punctuation">,</span> GROUPING__ID <span class="token keyword">FROM</span> test_t5 <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> <span class="token keyword">month</span><span class="token punctuation">,</span> <span class="token keyword">day</span><span class="token keyword">WITH ROLLUP</span> <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> GROUPING__ID<span class="token punctuation">;</span><span class="token keyword">month</span>            <span class="token keyword">day</span>             uv     GROUPING__ID<span class="token comment">---------------------------------------------------</span><span class="token boolean">NULL</span>             <span class="token boolean">NULL</span>            <span class="token number">7</span>       <span class="token number">0</span><span class="token number">2015</span><span class="token operator">-</span><span class="token number">03</span>          <span class="token boolean">NULL</span>            <span class="token number">5</span>       <span class="token number">1</span><span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span>          <span class="token boolean">NULL</span>            <span class="token number">6</span>       <span class="token number">1</span><span class="token number">2015</span><span class="token operator">-</span><span class="token number">03</span>          <span class="token number">2015</span><span class="token operator">-</span><span class="token number">03</span><span class="token operator">-</span><span class="token number">10</span>      <span class="token number">4</span>       <span class="token number">3</span><span class="token number">2015</span><span class="token operator">-</span><span class="token number">03</span>          <span class="token number">2015</span><span class="token operator">-</span><span class="token number">03</span><span class="token operator">-</span><span class="token number">12</span>      <span class="token number">1</span>       <span class="token number">3</span><span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span>          <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">12</span>      <span class="token number">2</span>       <span class="token number">3</span><span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span>          <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">13</span>      <span class="token number">3</span>       <span class="token number">3</span><span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span>          <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">15</span>      <span class="token number">2</span>       <span class="token number">3</span><span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span>          <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">16</span>      <span class="token number">2</span>       <span class="token number">3</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p>把 <code>month</code> 和 <code>day</code> 调换顺序，则以 <code>day</code> 维度进行层级聚合：</p><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token keyword">day</span><span class="token punctuation">,</span> <span class="token keyword">month</span><span class="token punctuation">,</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token keyword">DISTINCT</span> cookieid<span class="token punctuation">)</span> <span class="token keyword">AS</span> uv<span class="token punctuation">,</span> GROUPING__ID <span class="token keyword">FROM</span> test_t5 <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> <span class="token keyword">day</span><span class="token punctuation">,</span> <span class="token keyword">month</span> <span class="token keyword">WITH ROLLUP</span> <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> GROUPING__ID<span class="token punctuation">;</span><span class="token keyword">day</span>             <span class="token keyword">month</span>              uv     GROUPING__ID<span class="token comment">-------------------------------------------------------</span><span class="token boolean">NULL</span>            <span class="token boolean">NULL</span>               <span class="token number">7</span>       <span class="token number">0</span><span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">13</span>      <span class="token boolean">NULL</span>               <span class="token number">3</span>       <span class="token number">1</span><span class="token number">2015</span><span class="token operator">-</span><span class="token number">03</span><span class="token operator">-</span><span class="token number">12</span>      <span class="token boolean">NULL</span>               <span class="token number">1</span>       <span class="token number">1</span><span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">15</span>      <span class="token boolean">NULL</span>               <span class="token number">2</span>       <span class="token number">1</span><span class="token number">2015</span><span class="token operator">-</span><span class="token number">03</span><span class="token operator">-</span><span class="token number">10</span>      <span class="token boolean">NULL</span>               <span class="token number">4</span>       <span class="token number">1</span><span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">16</span>      <span class="token boolean">NULL</span>               <span class="token number">2</span>       <span class="token number">1</span><span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">12</span>      <span class="token boolean">NULL</span>               <span class="token number">2</span>       <span class="token number">1</span><span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">12</span>      <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span>            <span class="token number">2</span>       <span class="token number">3</span><span class="token number">2015</span><span class="token operator">-</span><span class="token number">03</span><span class="token operator">-</span><span class="token number">10</span>      <span class="token number">2015</span><span class="token operator">-</span><span class="token number">03</span>            <span class="token number">4</span>       <span class="token number">3</span><span class="token number">2015</span><span class="token operator">-</span><span class="token number">03</span><span class="token operator">-</span><span class="token number">12</span>      <span class="token number">2015</span><span class="token operator">-</span><span class="token number">03</span>            <span class="token number">1</span>       <span class="token number">3</span><span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">13</span>      <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span>            <span class="token number">3</span>       <span class="token number">3</span><span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">15</span>      <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span>            <span class="token number">2</span>       <span class="token number">3</span><span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">16</span>      <span class="token number">2015</span><span class="token operator">-</span><span class="token number">04</span>            <span class="token number">2</span>       <span class="token number">3</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p>这里，根据天和月进行聚合，和根据天聚合结果一样，因为有父子关系，如果是其他维度组合的话，就会不一样。</p>]]></content>
      
      
      <categories>
          
          <category> 教程笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 大数据 </tag>
            
            <tag> Hive </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>HBase 面试题解析</title>
      <link href="post/47457d03.html"/>
      <url>post/47457d03.html</url>
      
        <content type="html"><![CDATA[<blockquote><h3 id="HBase-的特点是什么？"><a href="#HBase-的特点是什么？" class="headerlink" title="HBase 的特点是什么？"></a>HBase 的特点是什么？</h3></blockquote><ul><li>大：一个表可以有数十亿行，上百万列；</li><li>无模式：每行都有一个可排序的主键和任意多的列，列可以根据需要动态的增加，同一张表中不同的行可以有截然不同的列；</li><li>面向列：面向列（族）的存储和权限控制，列（族）独立检索；</li><li>稀疏：空（null）列并不占用存储空间，表可以设计的非常稀疏；</li><li>数据多版本：每个单元中的数据可以有多个版本，默认情况下版本号自动分配，是单元格插入时的时间戳；</li><li>数据类型单一：HBase 中的数据都是字符串，没有类型。</li></ul><blockquote><h3 id="HBase-和-Hive-的区别？"><a href="#HBase-和-Hive-的区别？" class="headerlink" title="HBase 和 Hive 的区别？"></a>HBase 和 Hive 的区别？</h3></blockquote><div class="table-container"><table><thead><tr><th></th><th>HBase</th><th>Hive</th></tr></thead><tbody><tr><td>类型</td><td>列式数据库</td><td>数据仓库</td></tr><tr><td>内部机制</td><td>数据库引擎</td><td>MapReduce</td></tr><tr><td>增删改查</td><td>都支持</td><td>只支持导入和查询</td></tr><tr><td>Schema</td><td>只需要预先定义列族，不需要具体到列，列可以动态修改</td><td>需要预先定义表格</td></tr><tr><td>应用场景</td><td>实时</td><td>离线处理</td></tr><tr><td>特点</td><td>以 K-V 形式存储</td><td>类 SQL</td></tr></tbody></table></div><p>Hive 和 HBase 是两种基于 Hadoop 的不同技术，Hive 是一种类 SQL 的引擎，并且运行 MapReduce 任务，HBase 是一种在 Hadoop 之上的 NoSQL 的 key/value 数据库。 当然，这两种工具是可以同时使用的。就像用 Google 来搜索，用 FaceBook 进行社交一样，Hive 可以用来进行统计查询，HBase 可以用来进行实时查询，数据可以从 Hive 写到 HBase，也可以从 HBase 写回 Hive。</p><blockquote><h3 id="HBase-适用于怎样的情景？"><a href="#HBase-适用于怎样的情景？" class="headerlink" title="HBase 适用于怎样的情景？"></a>HBase 适用于怎样的情景？</h3></blockquote><ul><li><p>半结构化或非结构化数据：</p><p>对于数据结构字段不够确定或杂乱无章很难按一个概念去进行抽取的数据适合用 HBase。以上面的例子为例，当业务发展需要存储 author 的 email，phone，address 信息时 RDBMS 需要停机维护，而 HBase 支持动态增加。</p></li><li><p>记录非常稀疏：</p><p>RDBMS 的行有多少列是固定的，为 null 的列浪费了存储空间。而如上文提到的，HBase为null的Column不会被存储，这样既节省了空间又提高了读性能。</p></li><li><p>多版本数据</p><p>根据 Row key 和 Column key 定位到的 value 可以有任意数量的版本值，因此对于需要存储变动历史记录的数据，用 HBase 就非常方便了。比如上例中的author 的 address 是会变动的，业务上一般只需要最新的值，但有时可能需要查询到历史值。</p></li><li><p>超大数据量</p><p>当数据量越来越大，RDBMS 数据库撑不住了，就出现了读写分离策略，通过一个 Master 专门负责写操作，多个 Slave 负责读操作，服务器成本倍增。随着压力增加，Master 撑不住了，这时就要分库了，把关联不大的数据分开部署，一些 join 查询不能用了，需要借助中间层。随着数据量的进一步增加，一个表的记录越来越大，查询就变得很慢，于是又得搞分表，比如按 ID 取模分成多个表以减少单个表的记录数。经历过这些事的人都知道过程是多么的折腾。采用 HBase 就简单了，只需要加机器即可，HBase 会自动水平切分扩展，跟 Hadoop 的无缝集成保障了其数据可靠性（HDFS）和海量数据分析的高性能（MapReduce）。</p></li></ul><blockquote><h3 id="HBase-的架构体系？"><a href="#HBase-的架构体系？" class="headerlink" title="HBase 的架构体系？"></a>HBase 的架构体系？</h3></blockquote><p><strong>架构体系</strong></p><p><img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="/images/post/bigdata_interview/hbase_architecture.png" alt></p><ul><li>Zookeeper：作为分布式的协调。RegionServer 也会把自己的信息写到 Zookeeper 中。</li><li>HDFS 是 HBase运行的底层文件系统。</li><li>RegionServer：理解为数据节点，存储数据的。</li><li>Master RegionServer：要实时的向 Master 报告信息。Master 知道全局的 RegionServer 运行情况，可以控制 RegionServer 的故障转移和 Region 的切分。</li></ul><p><strong>架构细化</strong></p><p><img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="/images/post/bigdata_interview/hbase_deep_architecture.png" alt></p><ul><li>HMaster 是 Master Server的实现，负责监控集群中的 RegionServer 实例，同时是所有 metadata 改变的接口，在集群中，通常运行在 NameNode 上面。<ul><li>HMasterInterface 暴露的接口：Table(createTable，modifyTable，removeTable，enable，disable)，ColumnFamily (addColumn，modifyColumn，removeColumn)，Region (move，assign，unassign)。</li><li>Master 运行的后台线程：<ul><li>LoadBalancer 线程，控制 region 来平衡集群的负载。</li><li>CatalogJanitor 线程，周期性的检查 hbase:meta 表。</li></ul></li></ul></li><li>HRegionServer 是 RegionServer 的实现，服务和管理 Regions，集群中 RegionServer 运行在 DataNode。<ul><li>HRegionRegionInterface 暴露接口：Data(get，put，delete，next，etc.)，Region(splitRegion，compactRegion，etc.)。</li><li>RegionServer 后台线程：CompactSplitThread，MajorCompactionChecker，MemStoreFlusher，LogRoller。</li></ul></li><li>Regions：代表 table，Region 有多个 Store（列簇），Store 有一个 MemStore 和多个 StoreFiles（HFile），StoreFiles 的底层是 Block。</li></ul><blockquote><h3 id="描述-HBase-的-RowKey-的设计原则？"><a href="#描述-HBase-的-RowKey-的设计原则？" class="headerlink" title="描述 HBase 的 RowKey 的设计原则？"></a>描述 HBase 的 RowKey 的设计原则？</h3></blockquote><ul><li><p>RowKey 长度原则  RowKey 是一个二进制码流，RowKey 的长度被很多开发者建议说设计在 10~100 个字节，不过建议是越短越好，不要超过 16 个字节。</p><p>原因如下：</p><ul><li>数据的持久化文件 HFile 中是按照 KeyValue 存储的，如果 RowKey 过长比如 100 个字节，1000 万列数据光 RowKey 就要占用 100*1000 万 = 10 亿个字节， 将近 1GB 数据，这会极大影响 HFile 的存储效率；</li><li>MemStore 将缓存部分数据到内存，如果 RowKey 字段过长内存的有效利用率会降低，系统将无法缓存更多的数据，这会降低检索效率。因此 RowKey 的字节长度越短越好。</li><li>目前操作系统是都是 64 位系统，内存 8 字节对齐。控制在 16 个字节，8 字节的整数倍利用操作系统的最佳特性。</li></ul></li><li><p>RowKey 散列原则</p><p>如果 RowKey 是按时间戳的方式递增，不要将时间放在二进制码的前面，建议将 RowKey 的高位作为散列字段，由程序循环生成，低位放时间字段，这样将提高数据均衡分布在每个RegionServer 实现负载均衡的几率。如果没有散列字段，首字段直接是时间信息将产生所有新数据都在一个 RegionServer 上堆积的热点现象，这样在做数据检索的时候负载将会集中在个别 RegionServer，降低查询效率。</p></li><li><p>RowKey唯一原则</p><p>必须在设计上保证其唯一性。</p></li></ul><blockquote><h3 id="描述-HBase-中-scan-和-get-的功能以及实现的异同？"><a href="#描述-HBase-中-scan-和-get-的功能以及实现的异同？" class="headerlink" title="描述 HBase 中 scan 和 get 的功能以及实现的异同？"></a>描述 HBase 中 <code>scan</code> 和 <code>get</code> 的功能以及实现的异同？</h3></blockquote><p>HBase 的查询实现只提供两种方式：</p><ul><li><p>按指定 RowKey 获取唯一一条记录，<code>get</code> 方法（org.apache.hadoop.HBase.client.Get）处理分两种：设置了 <code>ClosestRowBefore</code> 和 没有设置 <code>ClosestRowBefore</code> 的 rowlock。主要是用来保证行的事务性，即每个 <code>get</code> 是以一个 row 来标记的。一个 row 中可以有很多 family 和column。</p></li><li><p>按指定的条件获取一批记录，<code>scan</code> 方法（org.apache.Hadoop.HBase.client.Scan）实现条件查询功能使用的就是 <code>scan</code> 方式。</p><ul><li>scan 可以通过 <code>setCaching</code> 与 <code>setBatch</code> 方法提高速度（以空间换时间）；</li><li>scan 可以通过 <code>setStartRow</code> 与 <code>setEndRow</code> 来限定范围（<code>[start，end]</code>）start 是闭区间，end 是开区间）。范围越小，性能越高。</li><li>scan 可以通过 <code>setFilter</code> 方法添加过滤器，这也是分页、多条件查询的基础。</li></ul></li></ul><blockquote><h3 id="请描述-HBase-中-scan-对象的-setCache-和-setBatch-方法的使用？"><a href="#请描述-HBase-中-scan-对象的-setCache-和-setBatch-方法的使用？" class="headerlink" title="请描述 HBase 中 scan 对象的 setCache 和 setBatch 方法的使用？"></a>请描述 HBase 中 scan 对象的 <code>setCache</code> 和 <code>setBatch</code> 方法的使用？</h3></blockquote><ul><li><p><code>setCache</code> 用于设置缓存，即设置一次 RPC 请求可以获取多行数据。对于缓存操作，如果行的数据量非常大，多行数据有可能超过客户端进程的内存容量，由此引入批量处理这一解决方案。</p></li><li><p><code>setBatch</code> 用于设置批量处理，批量可以让用户选择每一次 <code>ResultScanner</code> 实例的 <code>next</code> 操作要取回多少列，例如，在扫描中设置 <code>setBatch(5)</code>，则一次 <code>next()</code> 返回的 Result 实例会包括 5 列。如果一行包括的列数超过了批量中设置的值，则可以将这一行分片，每次 <code>next</code> 操作返回一片，当一行的列数不能被批量中 设置的值整除时，最后一次返回的 Result 实例会包含比较少的列，如，一行 17 列，batch 设置为 5，则一共返回 4 个 Result 实例，这 4 个实例中包括的列数分别为 5、5、5、2。</p></li></ul><p>组合使用扫描器缓存和批量大小，可以让用户方便地控制扫描一个范围内的行键所需要的 RPC 调用次数。Cache 设置了服务器一次返回的行数， 而 Batch 设置了服务器一次返回的列数。</p><p>假如我们建立了一张有两个列族的表，添加了 10 行数据，每个行的每个列族下有 10 列，这意味着整个表一共有 200 列（或单元格，因为每个列只有一个版本），其中每行有 20 列。</p><div class="table-container"><table><thead><tr><th>缓存</th><th>批量处理</th><th>Result 个数</th><th>RPC次数</th><th>说明</th></tr></thead><tbody><tr><td>1</td><td>1</td><td>200</td><td>201</td><td>每个列都作为一个 Result 实例返回， <br> 最后还多一个 RPC 确认扫描完成</td></tr><tr><td>200</td><td>1</td><td>200</td><td>2</td><td>每个 Result 实例都只包含一列的值， <br> 不过它们都被一次 RPC 请求取回（加一次完成检查）</td></tr><tr><td>2</td><td>10</td><td>20</td><td>11</td><td>批量参数是一行所包含的列数的一半， <br> 所以 200 列除以 10，需要 20 个 Result 实例。 <br> 同时需要 10 次 RPC 请求取回（加一次完成检查）</td></tr><tr><td>5</td><td>100</td><td>10</td><td>3</td><td>对于一行来讲，这个批量参数太大了， <br> 所以一行的 20 列都被放入了一个 Result 实例中。 <br> 同时缓存为 5，所以 10 个 Result 实例被两次 RPC 请求取回 <br> （加一次完成检查）</td></tr><tr><td>5</td><td>20</td><td>10</td><td>3</td><td>同上，不过这次的批量值与一行的列数正好相同， <br> 所以输出与上面一种情况相同</td></tr><tr><td>10</td><td>10</td><td>20</td><td>3</td><td>这次把表分成了较小的 Result 实例， <br> 但使用了较大的缓存值， <br> 所以也是只用了两次 RPC 请求就取回了数据</td></tr></tbody></table></div><ol><li><p>Batch 参数决定了一行数据分为几个 Result，它只针对一行数据，Batch 再大，也只能将一行的数据放入一个 Result 中。所以当一行数据有 10 列，而 Batch 为 100 时，也只能将一行的所有列都放入一个 Result，不会混合其他行；</p></li><li><p>缓存值决定一次 RPC 返回几个 Result，根据 Batch 划分的 Result 个数除以缓存个数可以得到 RPC 消息个数（之前定义缓存值决定一次返回的行数，这是不准确的，准确来说是决定一次 RPC 返回的 Result 个数，由于在引入 Batch 之前，一行封装为一个 Result，因此定义缓存值决定一次返回的行数，但引入 Batch 后，更准确的说法是缓存值决定了一次 RPC 返回的 Result 个数）；</p><p> RPC 请求次数 = (行数 * 每行列数) / Min(每行的列数，批量大小) / 扫描器缓存</p></li></ol><p>下图展示了缓存和批量两个参数如何联动，下图中有一个包含 9 行数据的表，每行都包含一些列。使用了一个缓存为 6，批量大小为 3 的扫描器，需要三次 RPC 请求来传送数据：</p><p><img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="/images/post/bigdata_interview/HBase_rpc.png" alt></p><blockquote><h3 id="请详细描述-HBase-中一个-cell-的结构？"><a href="#请详细描述-HBase-中一个-cell-的结构？" class="headerlink" title="请详细描述 HBase 中一个 cell 的结构？"></a>请详细描述 HBase 中一个 cell 的结构？</h3></blockquote><p>HBase 中通过 row 和 columns 确定的为一个存贮单元称为 cell。</p><p>Cell：由 <code>&#123;row key, column(= + ), version&#125;</code> 唯一确定的单元。cell 中的数据是没有类型的，全部是字节码形式存储。</p><blockquote><h3 id="简述-HBase-中-compact-用途是什么，什么时候触发，分为哪两种，有什么区别，有哪些相关配置参数？"><a href="#简述-HBase-中-compact-用途是什么，什么时候触发，分为哪两种，有什么区别，有哪些相关配置参数？" class="headerlink" title="简述 HBase 中 compact 用途是什么，什么时候触发，分为哪两种，有什么区别，有哪些相关配置参数？"></a>简述 HBase 中 compact 用途是什么，什么时候触发，分为哪两种，有什么区别，有哪些相关配置参数？</h3></blockquote><p>在 HBase 中每当有 MemStore 数据 flush 到磁盘之后，就形成一个 StoreFile，当 StoreFile 的数量达到一定程度后，就需要将 StoreFile 文件来 进行 compaction 操作。</p><p>compact 的作用：</p><ul><li>合并文件</li><li>清除过期，多余版本的数据</li><li>提高读写数据的效率</li></ul><p>HBase 中实现了两种 compaction 的方式：Minor 和 Major，这两种 compaction 方式的区别是：</p><ul><li>Minor 操作只用来做部分文件的合并操作以及包括 <code>minVersion=0</code> 并且设置 ttl 的过期版本清理，不做任何删除数据、多版本数据的清理工作。</li><li>Major 操作是对 Region 下的 HStore 下的所有 StoreFile 执行合并操作，最终的结果是整理合并出一个文件。</li></ul><blockquote><h3 id="每天百亿数据存入-HBase，如何保证数据的存储正确和在规定的时间里全部录入完毕，不残留数据？"><a href="#每天百亿数据存入-HBase，如何保证数据的存储正确和在规定的时间里全部录入完毕，不残留数据？" class="headerlink" title="每天百亿数据存入 HBase，如何保证数据的存储正确和在规定的时间里全部录入完毕，不残留数据？"></a>每天百亿数据存入 HBase，如何保证数据的存储正确和在规定的时间里全部录入完毕，不残留数据？</h3></blockquote><p>需求分析：</p><ul><li>百亿数据：证明数据量非常大；</li><li>存入 HBase：证明是跟 HBase 的写入数据有关；</li><li>保证数据的正确：要设计正确的数据结构保证正确性；</li><li>在规定时间内完成：对存入速度是有要求的。</li></ul><p>解决思路：</p><ul><li>数据量百亿条，什么概念呢？假设一整天 60x60x24 = 86400 秒都在写入数据，那么每秒的写入条数高达 100 万条，HBase 当然是支持不了每秒百万条数据的，所以这百亿条数据可能不是通过实时地写入，而是批量地导入。批量导入推荐使用 BulkLoad 方式（推荐阅读：Spark 之读写 HBase），性能是普通写入方式几倍以上；</li><li>存入 HBase：普通写入是用 JavaAPI put 来实现，批量导入推荐使用 BulkLoad；</li><li>保证数据的正确：这里需要考虑 RowKey 的设计、预建分区和列族设计等问题；</li><li>在规定时间内完成也就是存入速度不能过慢，并且当然是越快越好，使用 BulkLoad。</li></ul><h3 id="gt-请列举几个-HBase-优化方法？"><a href="#gt-请列举几个-HBase-优化方法？" class="headerlink" title="&gt; 请列举几个 HBase 优化方法？"></a>&gt; 请列举几个 HBase 优化方法？</h3><ol><li><p>减少调整</p><p> 减少调整这个`如何理解呢？HBase 中有几个内容会动态调整，如 region（分区）、HFile，所以通过一些方法来减少这些会带来 I/O 开销的调整。</p><ul><li>Region：如果没有预建分区的话，那么随着 region 中条数的增加，region 会进行分裂，这将增加 I/O 开销，所以解决方法就是根据你的 RowKey 设计来进行预建分区，减少region的动态分裂。</li><li>HFile：HFile 是数据底层存储文件，在每个 MemStore 进行刷新时会生成一个 HFile，当 HFile 增加到一定程度时，会将属于一个 region 的 HFile 进行合并，这个步骤会带来开销但不可避免，但是合并后 HFile 大小如果大于设定的值，那么 HFile 会重新分裂。为了减少这样的无谓的 I/O 开销，建议估计项目数据量大小，给 HFile 设定一个合适的值。</li></ul></li><li><p>减少启停</p><p> 数据库事务机制就是为了更好地实现批量写入，较少数据库的开启关闭带来的开销，那么 HBase 中也存在频繁开启关闭带来的问题。</p><ul><li><p>关闭 Compaction，在闲时进行手动 Compaction。</p><p>因为 HBase 中存在 Minor Compaction 和 Major Compaction，也就是对 HFile 进行合并，所谓合并就是 I/O 读写，大量的 HFile 进行肯定会带来 I/O 开销，甚至是 I/O 风暴，所以为了避免这种不受控制的意外发生，建议关闭自动 Compaction，在闲时进行 Compaction。</p></li><li><p>批量数据写入时采用 BulkLoad。</p><p>如果通过 HBase-Shell 或者 JavaAPI 的 put 来实现大量数据的写入，那么性能差是肯定并且还可能带来一些意想不到的问题，所以当需要写入大量离线数据时建议使用 BulkLoad。</p></li></ul></li><li><p>减少数据量</p><p> 虽然我们是在进行大数据开发，但是如果可以通过某些方式在保证数据准确性同时减少数据量，何乐而不为呢？</p><ul><li><p>开启过滤，提高查询速度：开启 BloomFilter，BloomFilter 是列族级别的过滤，在生成一个 StoreFile 同时会生成一个 MetaBlock，用于查询时过滤数据。</p></li><li><p>使用压缩：一般推荐使用 Snappy 和 LZO 压缩。</p></li></ul></li><li><p>合理设计</p></li></ol><p>在一张 HBase 表格中 RowKey 和 ColumnFamily 的设计是非常重要，好的设计能够提高性能和保证数据的准确性。</p><ul><li><p>RowKey 设计：应该具备以下几个属性</p><ul><li>散列性：散列性能够保证相同相似的 RowKey 聚合，相异的 RowKey 分散，有利于查询。</li><li>简短性：RowKey 作为 key 的一部分存储在 HFile 中，如果为了可读性将 RowKey 设计得过长，那么将会增加存储压力。</li><li>唯一性：RowKey 必须具备明显的区别性。</li><li><p>业务性：举例来说：  假如我的查询条件比较多，而且不是针对列的条件，那么 RowKey 的设计就应该支持多条件查询。</p><p>  如果我的查询要求是最近插入的数据优先，那么 RowKey 则可以采用加上 <code>Long.Max-时间戳</code> 的方式，这样 RowKey 就是递减排列。</p></li></ul></li><li><p>列族的设计：列族的设计需要看应用场景</p><ul><li>优势：HBase 中数据时按列进行存储的，那么查询某一列族的某一列时就不需要全盘扫描，只需要扫描某一列族，减少了读 I/O；其实多列族设计对减少的作用不是很明显，适用于读多写少的场景</li><li>劣势：降低了写的 I/O 性能。原因如下：数据写到 store 以后是先缓存在 MemStore 中，同一个 region 中存在多个列族则存在多个 store，每个 store 都一个 MemStore，当其实 MemStore 进行 flush 时，属于同一个 region 的 store 中的 MemStore 都会进行 flush，增加 I/O 开销。</li></ul></li></ul><blockquote><h3 id="Region-如何预建分区？"><a href="#Region-如何预建分区？" class="headerlink" title="Region 如何预建分区？"></a>Region 如何预建分区？</h3></blockquote><p>预分区的目的主要是在创建表的时候指定分区数，提前规划表有多个分区，以及每个分区的区间范围，这样在存储的时候 RowKey 按照分区的区间存储，可以避免 region 热点问题。</p><p>通常有两种方案：</p><ul><li><p>shell 方法</p><p><code>create &#39;tb_splits&#39;, &#123;NAME =&gt; &#39;cf&#39;,VERSIONS=&gt; 3&#125;,&#123;SPLITS =&gt; [&#39;10&#39;,&#39;20&#39;,&#39;30&#39;]&#125;</code></p></li><li><p>JAVA 程序控制</p><ol><li>取样，先随机生成一定数量的 RowKey，将取样数据按升序排序放到一个集合里；</li><li>根据预分区的 region 个数，对整个集合平均分割，即是相关的 splitKeys；</li><li><code>HBaseAdmin.createTable(HTableDescriptor tableDescriptor, byte[] splitKeys)</code> 可以指定预分区的 splitKeys， 即是指定 region 间的 RowKey 临界值。</li></ol></li></ul><blockquote><h3 id="HRegionServer-宕机如何处理？"><a href="#HRegionServer-宕机如何处理？" class="headerlink" title="HRegionServer 宕机如何处理？"></a>HRegionServer 宕机如何处理？</h3></blockquote><ol><li>Zookeeper 会监控 HRegionServer 的上下线情况，当 ZK 发现某个 HRegionServer 宕机之后会通知 HMaster 进行失效备援；</li><li>该 HRegionServer 会停止对外提供服务，就是它所负责的 region 暂时停止对外提供服务；</li><li>HMaster 会将该 HRegionServer 所负责的 region 转移到其他 HRegionServer 上，并且会对 HRegionServer 上存在 MemStore 中还未持久化到磁盘中的数据进行恢复；</li><li>这个恢复的工作是由 WAL 重播来完成，这个过程如下：<ol><li>wal 实际上就是一个文件，存在 <code>/HBase/WAL/</code> 对应 RegionServer 路径下。</li><li>宕机发生时，读取该 RegionServer 所对应的路径下的 wal 文件，然后根据不同的 region 切分成不同的临时文件 recover.edits。</li><li>当 region 被分配到新的 RegionServer 中，RegionServer 读取 region 时会进行是否存在 recover.edits，如果有则进行恢复。</li></ol></li></ol><blockquote><h3 id="HBase读写流程？"><a href="#HBase读写流程？" class="headerlink" title="HBase读写流程？"></a>HBase读写流程？</h3></blockquote><p><strong>读：</strong></p><ol><li>HRegionServer 保存着 Meta 表以及表数据，要访问表数据，首先 Client 先去访问 Zookeeper，从 Zookeeper 里面获取 Meta 表所在的位置信息，即找到这个 Meta 表在哪个 HRegionServer 上保存着。</li><li>接着 Client 通过刚才获取到的 HRegionServer 的 IP 来访问 Meta 表所在的 HRegionServer，从而读取到 Meta，进而获取到 Meta 表中存放的元数据。</li><li>Client 通过元数据中存储的信息，访问对应的 HRegionServer，然后扫描所在 HRegionServer 的 MemStore 和 StoreFile 来查询数据。</li><li>最后 HRegionServer 把查询到的数据响应给 Client。</li></ol><p><strong>写：</strong></p><ol><li>Client 先访问 Zookeeper，找到 Meta 表，并获取 Meta 表元数据。</li><li>确定当前将要写入的数据所对应的 HRegion 和 HRegionServer 服务器。</li><li>Client 向该 HRegionServer 服务器发起写入数据请求，然后 HRegionServer 收到请求并响应。</li><li>Client 先把数据写入到 HLog，以防止数据丢失。</li><li>然后将数据写入到 MemStore。</li><li>如果 HLog 和 MemStore 均写入成功，则这条数据写入成功。</li><li>如果 MemStore 达到阈值，会把 MemStore 中的数据 flush 到 StoreFile 中。</li><li>当 StoreFile 越来越多，会触发 Compact 合并操作，把过多的 StoreFile 合并成一个大的 StoreFile。</li><li>当 StoreFile 越来越大，Region 也会越来越大，达到阈值后，会触发 Split 操作，将 Region 一分为二。</li></ol><blockquote><h3 id="HBase-内部机制是什么？"><a href="#HBase-内部机制是什么？" class="headerlink" title="HBase 内部机制是什么？"></a>HBase 内部机制是什么？</h3></blockquote><p>HBase 是一个能适应联机业务的数据库系统。</p><ul><li>物理存储：HBase 的持久化数据是将数据存储在 HDFS 上。</li><li>存储管理：一个表是划分为很多 region 的，这些 region 分布式地存放在很多 RegionServer 上 Region 内部还可以划分为 store，store 内部有 MemStore 和 StoreFile。</li><li>版本管理：HBase 中的数据更新本质上是不断追加新的版本，通过 compact 操作来做版本间的文件合并 Region 的 split。</li><li>集群管理：Zookeeper + HMaster + HRegionServer。</li></ul><blockquote><h3 id="HBase-中的-MemStore-是用来做什么的？"><a href="#HBase-中的-MemStore-是用来做什么的？" class="headerlink" title="HBase 中的 MemStore 是用来做什么的？"></a>HBase 中的 MemStore 是用来做什么的？</h3></blockquote><p>HBase 为了保证随机读取的性能，所以 HFile 里面的 RowKey 是有序的。当客户端的请求在到达 RegionServer 之后，为了保证写入 RowKey 的有序性，所以不能将数据立刻写入到 HFile 中，而是将每个变更操作保存在内存中，也就是 MemStore 中。MemStore 能够很方便的支持操作的随机插入，并保证所有的操作在内存中是有序的。当 MemStore 达到一定的量之后，会将 MemStore 里面的数据 flush 到 HFile 中，这样能充分利用 hadoop 写入大文件的性能优势，提高写入性能。</p><p>由于 MemStore 是存放在内存中，如果 RegionServer 因为某种原因死了，会导致内存中数据丢失。所有为了保证数据不丢失，HBase 将更新操作在写入 MemStore 之前会写入到一个 write ahead log(WAL) 中。WAL 文件是追加、顺序写入的，WAL 每个 RegionServer 只有一个，同一个 RegionServer 上所有 region 写入同一个的 WAL 文件。这样当某个 RegionServer 失败时，可以通过 WAL 文件，将所有的操作顺序重新加载到 MemStore 中。</p><blockquote><h3 id="HBase-在进行模型设计时重点在什么地方？一张表中定义多少个-Column-Family-最合适？为什么？"><a href="#HBase-在进行模型设计时重点在什么地方？一张表中定义多少个-Column-Family-最合适？为什么？" class="headerlink" title="HBase 在进行模型设计时重点在什么地方？一张表中定义多少个 Column Family 最合适？为什么？"></a>HBase 在进行模型设计时重点在什么地方？一张表中定义多少个 Column Family 最合适？为什么？</h3></blockquote><p>Column Family 的个数具体看表的数据，一般来说划分标准是根据数据访问频度，如一张表里有些列访问相对频繁，而另一些列访问很少，这时可以把这张表划分成两个列族，分开存储，提高访问效率。</p><blockquote><h3 id="如何提高-HBase-客户端的读写性能？请举例说明。"><a href="#如何提高-HBase-客户端的读写性能？请举例说明。" class="headerlink" title="如何提高 HBase 客户端的读写性能？请举例说明。"></a>如何提高 HBase 客户端的读写性能？请举例说明。</h3></blockquote><ol><li>开启 bloomfilter 过滤器，开启 bloomfilter 比没开启要快 3、4 倍；</li><li>HBase 对于内存有特别的需求，在硬件允许的情况下配足够多的内存给它；</li><li>通过修改 <code>hbase-env.sh</code> 中的 <code>export HBASE_HEAPSIZE=3000</code>，这里默认为 1000m；</li><li>增大 RPC 数量，通过修改 <code>hbase-site.xml</code> 中的 <code>hbase.regionserver.handler.count</code>属性，可以适当的放大 RPC 数量，默认值为 10 有点小。</li></ol><blockquote><h3 id="HBase-集群安装注意事项？"><a href="#HBase-集群安装注意事项？" class="headerlink" title="HBase 集群安装注意事项？"></a>HBase 集群安装注意事项？</h3></blockquote><ol><li>HBase 需要 HDFS 的支持，因此安装 HBase 前确保 Hadoop 集群安装完成；</li><li>HBase 需要 Zookeeper 集群的支持，因此安装 HBase 前确保 Zookeeper 集群安装完成；</li><li>注意 HBase 与 Hadoop 的版本兼容性；</li><li>注意 <code>hbase-env.sh</code> 配置文件和 <code>hbase-site.xml</code> 配置文件的正确配置；</li><li>注意 RegionServers 配置文件的修改；</li><li>注意集群中的各个节点的时间必须同步，否则启动 HBase 集群将会报错。</li></ol><blockquote><h3 id="直接将时间戳作为行健，在写入单个-region-时候会发生热点问题，为什么呢？"><a href="#直接将时间戳作为行健，在写入单个-region-时候会发生热点问题，为什么呢？" class="headerlink" title="直接将时间戳作为行健，在写入单个 region 时候会发生热点问题，为什么呢？"></a>直接将时间戳作为行健，在写入单个 region 时候会发生热点问题，为什么呢？</h3></blockquote><p>region 中的 RowKey 是有序存储，若时间比较集中。就会存储到一个 region 中，这样一个 region 的数据变多，其它的 region 数据很少，加载数据就会很慢，直到 region 分裂，此问题才会得到缓解。</p><blockquote><h3 id="请描述如何解决-HBase-中-region-太小和-region-太大带来的冲突？"><a href="#请描述如何解决-HBase-中-region-太小和-region-太大带来的冲突？" class="headerlink" title="请描述如何解决 HBase 中 region 太小和 region 太大带来的冲突？"></a>请描述如何解决 HBase 中 region 太小和 region 太大带来的冲突？</h3></blockquote><p>Region 过大会发生多次 compaction，将数据读一遍并重写一遍到 HDFS 上，占用 I/O，region 过小会造成多次 split，region 会下线，影响访问服务，最佳的解决方法是调整 <code>hbase.hregion.max.filesize</code> 为 256m。</p>]]></content>
      
      
      <categories>
          
          <category> 教程笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 大数据 </tag>
            
            <tag> 面试题 </tag>
            
            <tag> HBase </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hexo 博客访问统计图</title>
      <link href="post/ef1da941.html"/>
      <url>post/ef1da941.html</url>
      
        <content type="html"><![CDATA[<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>本文教程主要针对 Hexo 博客，对博客站点的的访问地图、每月访问量、访问来源的维度绘制统计图，使用的是 <a href="https://echarts.apache.org/examples/zh/index.html">ECharts</a> 开源可视化库。具体效果可以点击本站的 <a href="/census/">实验室--博客统计</a> 页面查看。</p><p><div class="note info simple"><ul><li>本文数据来源均为百度统计，请确保博客站点已加入百度统计，以 butterfly 主题为例，可参照 <a href="https://butterfly.js.org/posts/ceeb73f/#%E5%88%86%E6%9E%90%E7%B5%B1%E8%A8%88">Butterfly 安装文档(四) 主题配置-2</a> 的分析统计段落实现。</li><li>本地主机访问（localhost）也会记录到百度统计，推荐在 <strong>【百度统计】--【管理】--【统计规则设置】--【过滤规则设置】--【受访域名统计规则】--【勾选排除 localhost（本地主机）】</strong> 排除本地主机访问（貌似在勾选后生效，但是以前的访问记录仍会统计）。</li><li>绘制统计图的数据在生成后不会变化。</li><li><code>2021-05-14</code> 新增访客数的统计，统计指标 <code>metrics</code> 可以选择统计访问次数（PV）还是访客数（UV）。</li><li><code>2021-05-17</code> 新增主题“明暗模式”下统计图的颜色切换。</li><li><code>2021-05-17</code> 针对访问数据的实时性问题，发表了新教程 <a href="/post/61763977.html">Hexo 博客实时访问统计图</a>。</li></ul></div></p><p>如果想绘制博客文章发布统计图的可以参考文章 <a href="/post/1213ef82.html">Hexo 博客文章统计图</a></p><h1 id="新建-census-页面"><a href="#新建-census-页面" class="headerlink" title="新建 census 页面"></a>新建 census 页面</h1><p><div class="tabs" id="tab"><ul class="nav-tabs"><li class="tab"><button type="button" data-href="#tab-1">使用命令创建</button></li><li class="tab"><button type="button" data-href="#tab-2">手动创建</button></li></ul><div class="tab-contents"><div class="tab-item-content" id="tab-1"><p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">hexo new page census<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="tab-2"><p>在 <code>[Blogroot]\source\</code> 目录下新建 <code>census</code> 文件夹，并在新建的 <code>census</code> 文件夹下新建 <code>index.md</code> 文件，添加以下内容：</p><p><pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown"><span class="token hr punctuation">---</span>title: 博客统计<span class="token title important">date: 2020-03-01 08:00:00<span class="token punctuation">---</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div></p><h1 id="引入-ECharts-js"><a href="#引入-ECharts-js" class="headerlink" title="引入 ECharts.js"></a>引入 ECharts.js</h1><p><div class="note info simple"><p>echarts.js 必须在渲染 echarts 实例的 JavaScript 前引入。</p></div></p><p><div class="tabs" id="tab"><ul class="nav-tabs"><li class="tab"><button type="button" data-href="#tab-1">全局引入</button></li><li class="tab"><button type="button" data-href="#tab-2">页面引入</button></li></ul><div class="tab-contents"><div class="tab-item-content" id="tab-1"><p>以 butterfly 主题为例，可以在 <code>[Blogroot]\_config.butterfly.yml</code> 的 <code>inject</code> 配置项中引入 <code>echart.js</code> 文件。</p><p><pre class="line-numbers language-yml" data-language="yml"><code class="language-yml">inject:  head:    - &lt;script src&#x3D;&quot;https:&#x2F;&#x2F;cdn.jsdelivr.net&#x2F;npm&#x2F;echarts@4.7.0&#x2F;dist&#x2F;echarts.min.js&quot;&gt;&lt;&#x2F;script&gt;    - &lt;script src&#x3D;&quot;https:&#x2F;&#x2F;cdn.jsdelivr.net&#x2F;npm&#x2F;echarts@4.7.0&#x2F;map&#x2F;js&#x2F;china.js&quot;&gt;&lt;&#x2F;script&gt; # 绘制地图需要另外添加 china.js<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="tab-2"><p>可以在 <code>index.md</code> 添加以下内容：</p><p><pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://cdn.jsdelivr.net/npm/echarts@4.7.0/dist/echarts.min.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://cdn.jsdelivr.net/npm/echarts@4.7.0/map/js/china.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span> <span class="token comment">&lt;!-- 绘制地图需要另外添加 china.js --></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div></p><h1 id="博客访问统计"><a href="#博客访问统计" class="headerlink" title="博客访问统计"></a>博客访问统计</h1><h2 id="获取网站统计数据"><a href="#获取网站统计数据" class="headerlink" title="获取网站统计数据"></a>获取网站统计数据</h2><ol><li><p>已经添加百度统计分析的小伙伴可以登录<a href="https://tongji.baidu.com/web/welcome/login">百度统计</a>的官网网站，此处博主使用的是百度账号登录。</p><p> <img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="/images/post/hexo_census/login.png" alt></p></li><li><p>登录进入首页后可以点击<strong>基础报告</strong>查看网站访问统计数据（若无绑定网站，需要先在 <strong>管理</strong>页面--<strong>账户管理</strong>--<strong>网站列表</strong> 添加博客网址）。</p><p> <img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="/images/post/hexo_census/index.png" alt></p></li><li><p>此时我们想要获取这些数据可以调用<strong>百度统计 API</strong>，点击<strong>管理</strong>，进入管理页面后在左边侧边栏找到<strong>数据导出服务</strong>。</p><p> <img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="/images/post/hexo_census/data_export.png" alt></p></li><li><p>登录<a href="http://developer.baidu.com/console#app/project">百度开发者中心控制台</a>，创建工程，应用名称任意。</p><p> <img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="/images/post/hexo_census/project.png" alt></p></li><li><p>点击刚刚创建的工程，记录下 API Key，Secret Key。</p><p> <img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="/images/post/hexo_census/project_info.png" alt></p></li><li><p>填写下面链接参数后打开链接获取授权码，具体步骤可以参考 <a href="https://tongji.baidu.com/api/manual/">Tongji API用户手册</a>。</p><p> <code>http://openapi.baidu.com/oauth/2.0/authorize?response_type=code&amp;client_id=&#123;CLIENT_ID&#125;&amp;redirect_uri=&#123;REDIRECT_URI&#125;&amp;scope=basic&amp;display=popup</code></p><ul><li>API Key：{CLIENT_ID}</li><li><p>回调 URI：{REDIRECT_URI}，可以填写 <code>oob</code>。</p><p><img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="/images/post/hexo_census/auth_code.png" alt></p></li></ul></li><li><p>复制第 6 步获取的授权码，填写下面链接参数后打开链接获取 <code>ACCESS_TOKEN</code> ：。</p><p> <code>http://openapi.baidu.com/oauth/2.0/token?grant_type=authorization_code&amp;code=&#123;CODE&#125;&amp;client_id=&#123;CLIENT_ID&#125;&amp;client_secret=&#123;CLIENT_SECRET&#125;&amp;redirect_uri=&#123;REDIRECT_URI&#125;</code></p><ul><li>Auth Code：{CODE}，第 6 步获取的授权码。</li><li>API Key：{CLIENT_ID}</li><li>Secret Key：{CLIENT_SECRET}</li><li><p>回调 URI：{REDIRECT_URI}，可以填写 <code>oob</code>。</p><p><img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="/images/post/hexo_census/access_token.png" alt></p></li></ul><p><strong>注意：</strong>从上述步骤得到的数据中包含 <code>ACCESS_TOKEN</code> 和 <code>REFRESH_TOKEN</code> 两个值，其中 <code>ACCESS_TOKEN</code> 的有效期为一个月，<code>REFRESH_TOKEN</code> 的有效期为十年。<code>REFRESH_TOKEN</code> 的作用就是刷新获取新的 <code>ACCESS_TOKEN</code> 和 <code>REFRESH_TOKEN</code> ， 如此反复操作来实现 <code>ACCESS_TOKEN</code> 有效期永久的机制。</p><p>一旦 <code>ACCESS_TOKEN</code> 过期，可根据以下请求更换新的 <code>ACCESS_TOKEN</code> 和 <code>REFRESH_TOKEN</code>：</p><p><code>http://openapi.baidu.com/oauth/2.0/token?grant_type=refresh_token&amp;refresh_token=&#123;REFRESH_TOKEN&#125;&amp;client_id=&#123;CLIENT_ID&#125;&amp;client_secret=&#123;CLIENT_SECRET&#125;</code></p><ul><li>API Key：{CLIENT_ID}</li><li>Secret Key：{CLIENT_SECRET}</li><li>Refresh Token：{REFRESH_TOKEN}</li></ul></li><li><p>调用百度统计API</p><p> 第 7 步获取的 <code>ACCESS_TOKEN</code> 是所调用 API 的用户级参数，结合各 API 的应用级参数即可正常调用 API 获取数据，填写下面链接参数后打开链接获取网站 ID：</p><p> <code>https://openapi.baidu.com/rest/2.0/tongji/config/getSiteList?access_token=&#123;ACCESS_TOKEN&#125;</code></p><ul><li><p>Access Token：{ACCESS_TOKEN}</p><p><img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="/images/post/hexo_census/site_id.png" alt></p></li></ul><p>也可以在 <a href="https://tongji.baidu.com/api/debug/#">Tongji API调试工具</a> 输入 <code>ACCESS_TOKEN</code> 获取网址 ID：</p><p> <img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="/images/post/hexo_census/site_id_debug.png" alt></p></li><li><p>在 <a href="https://tongji.baidu.com/api/debug/#">Tongji API调试工具</a> 选择需要获取的报告数据，填写 <code>ACCESS_TOKEN</code> 、必填参数、选填参数获取百度统计数据。</p></li></ol><p><img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="/images/post/hexo_census/site_data.png" alt></p><h2 id="网站统计代码"><a href="#网站统计代码" class="headerlink" title="网站统计代码"></a>网站统计代码</h2><p>以 butterfly 主题为例，可以在 <code>[Blogroot]\themes\butterfly\scripts\helpers\</code> 目录下新建 <code>census.js</code> 文件，然后添加以下内容：</p><p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> cheerio <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'cheerio'</span><span class="token punctuation">)</span><span class="token keyword">const</span> moment <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'moment'</span><span class="token punctuation">)</span><span class="token keyword">const</span> fetch <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'node-fetch'</span><span class="token punctuation">)</span>hexo<span class="token punctuation">.</span>extend<span class="token punctuation">.</span>filter<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span><span class="token string">'after_render:html'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">locals</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">const</span> $ <span class="token operator">=</span> cheerio<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span>locals<span class="token punctuation">)</span>  <span class="token keyword">const</span> map <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'#map-chart'</span><span class="token punctuation">)</span>  <span class="token keyword">const</span> trend <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'#trends-chart'</span><span class="token punctuation">)</span>  <span class="token keyword">const</span> source <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'#sources-chart'</span><span class="token punctuation">)</span>  <span class="token keyword">let</span> htmlEncode <span class="token operator">=</span> <span class="token boolean">false</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>map<span class="token punctuation">.</span>length <span class="token operator">></span> <span class="token number">0</span> <span class="token operator">||</span> trend<span class="token punctuation">.</span>length <span class="token operator">></span> <span class="token number">0</span> <span class="token operator">||</span> source<span class="token punctuation">.</span>length <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>map<span class="token punctuation">.</span>length <span class="token operator">></span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'#mapChart'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      map<span class="token punctuation">.</span><span class="token function">after</span><span class="token punctuation">(</span><span class="token keyword">await</span> <span class="token function">mapChart</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>trend<span class="token punctuation">.</span>length <span class="token operator">></span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'#trendsChart'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      trend<span class="token punctuation">.</span><span class="token function">after</span><span class="token punctuation">(</span><span class="token keyword">await</span> <span class="token function">trendsChart</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>source<span class="token punctuation">.</span>length <span class="token operator">></span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'#sourcesChart'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      source<span class="token punctuation">.</span><span class="token function">after</span><span class="token punctuation">(</span><span class="token keyword">await</span> <span class="token function">sourcesChart</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>htmlEncode<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token keyword">return</span> $<span class="token punctuation">.</span><span class="token function">root</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">&amp;amp;#</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">'&amp;#'</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>      <span class="token keyword">return</span> $<span class="token punctuation">.</span><span class="token function">root</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> locals  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">)</span><span class="token keyword">const</span> startDate <span class="token operator">=</span> <span class="token string">'20210101'</span> <span class="token comment">// 开始日期</span><span class="token keyword">const</span> endDate <span class="token operator">=</span> <span class="token function">moment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">'YYYYMMDD'</span><span class="token punctuation">)</span> <span class="token comment">// 结束日期</span><span class="token keyword">const</span> accessToken <span class="token operator">=</span> <span class="token string">'121.c644d8c4*****'</span> <span class="token comment">// accessToken</span><span class="token keyword">const</span> siteId <span class="token operator">=</span> <span class="token string">'16****'</span> <span class="token comment">// 网址id</span><span class="token keyword">const</span> dataUrl <span class="token operator">=</span> <span class="token string">'https://openapi.baidu.com/rest/2.0/tongji/report/getData?access_token='</span> <span class="token operator">+</span> accessToken <span class="token operator">+</span> <span class="token string">'&amp;site_id='</span> <span class="token operator">+</span> siteId<span class="token punctuation">;</span><span class="token keyword">const</span> metrics <span class="token operator">=</span> <span class="token string">'pv_count'</span> <span class="token comment">// 统计访问次数 PV 填写 'pv_count'，统计访客数 UV 填写 'visitor_count'，二选一</span><span class="token keyword">const</span> metricsName <span class="token operator">=</span> <span class="token punctuation">(</span>metrics <span class="token operator">===</span> <span class="token string">'pv_count'</span> <span class="token operator">?</span> <span class="token string">'访问次数'</span> <span class="token operator">:</span> <span class="token punctuation">(</span>metrics <span class="token operator">===</span> <span class="token string">'visitor_count'</span> <span class="token operator">?</span> <span class="token string">'访客数'</span> <span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">// 访问地图</span><span class="token keyword">function</span> <span class="token function">mapChart</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token parameter">resolve</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">const</span> paramUrl <span class="token operator">=</span> <span class="token string">'&amp;start_date='</span> <span class="token operator">+</span> startDate <span class="token operator">+</span> <span class="token string">'&amp;end_date='</span> <span class="token operator">+</span> endDate <span class="token operator">+</span> <span class="token string">'&amp;metrics='</span> <span class="token operator">+</span> metrics <span class="token operator">+</span> <span class="token string">'&amp;method=visit/district/a'</span><span class="token punctuation">;</span>    <span class="token function">fetch</span><span class="token punctuation">(</span>dataUrl <span class="token operator">+</span> paramUrl<span class="token punctuation">)</span>      <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">data</span> <span class="token operator">=></span> data<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>      <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">data</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>        monthArr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token keyword">let</span> mapName <span class="token operator">=</span> data<span class="token punctuation">.</span>result<span class="token punctuation">.</span>items<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>        <span class="token keyword">let</span> mapValue <span class="token operator">=</span> data<span class="token punctuation">.</span>result<span class="token punctuation">.</span>items<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>        <span class="token keyword">let</span> mapArr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>        <span class="token keyword">let</span> max <span class="token operator">=</span> mapValue<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> mapName<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>          mapArr<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> name<span class="token operator">:</span> mapName<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>name<span class="token punctuation">,</span> value<span class="token operator">:</span> mapValue<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">const</span> mapArrJson <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>mapArr<span class="token punctuation">)</span>        <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">          &lt;script id="mapChart">            var color = document.documentElement.getAttribute('data-theme') === 'light' ? '#4c4948' : 'rgba(255,255,255,0.7)'            var mapChart = echarts.init(document.getElementById('map-chart'), 'light');            var mapOption = &#123;              title: &#123;                text: '博客访问来源地图',                x: 'center',                textStyle: &#123;                  color: color                &#125;              &#125;,              tooltip: &#123;                trigger: 'item'              &#125;,              visualMap: &#123;                min: 0,                max: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>max<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">,                left: 'left',                top: 'bottom',                text: ['高','低'],                color: ['#1E90FF', '#AAFAFA'],                textStyle: &#123;                  color: color                &#125;,                calculable: true              &#125;,              series: [&#123;                name: '</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>metricsName<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">',                type: 'map',                mapType: 'china',                showLegendSymbol: false,                label: &#123;                  emphasis: &#123;                    show: false                  &#125;                &#125;,                itemStyle: &#123;                  normal: &#123;                    areaColor: 'rgba(255, 255, 255, 0.1)',                    borderColor: '#20232a'                  &#125;,                  emphasis: &#123;                    areaColor: 'gold'                  &#125;                &#125;,                data: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>mapArrJson<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">                &#125;]            &#125;;            mapChart.setOption(mapOption);            window.addEventListener("resize", () => &#123;               mapChart.resize();            &#125;);          &lt;/script></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token comment">// 访问趋势</span><span class="token keyword">function</span> <span class="token function">trendsChart</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token parameter">resolve</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">const</span> paramUrl <span class="token operator">=</span> <span class="token string">'&amp;start_date='</span> <span class="token operator">+</span> startDate <span class="token operator">+</span> <span class="token string">'&amp;end_date='</span> <span class="token operator">+</span> endDate <span class="token operator">+</span> <span class="token string">'&amp;metrics='</span> <span class="token operator">+</span> metrics <span class="token operator">+</span> <span class="token string">'&amp;method=trend/time/a&amp;gran=month'</span>    <span class="token function">fetch</span><span class="token punctuation">(</span>dataUrl <span class="token operator">+</span> paramUrl<span class="token punctuation">)</span>      <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">data</span> <span class="token operator">=></span> data<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>      <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">data</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>        <span class="token keyword">const</span> monthArr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>        <span class="token keyword">const</span> monthValueArr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>        <span class="token keyword">const</span> monthName <span class="token operator">=</span> data<span class="token punctuation">.</span>result<span class="token punctuation">.</span>items<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>        <span class="token keyword">const</span> monthValue <span class="token operator">=</span> data<span class="token punctuation">.</span>result<span class="token punctuation">.</span>items<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span>monthName<span class="token punctuation">.</span>length<span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">>=</span> <span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>          monthArr<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>monthName<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token string">'-'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>          <span class="token keyword">if</span> <span class="token punctuation">(</span>monthValue<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">!==</span> <span class="token string">'--'</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            monthValueArr<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>monthValue<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>          <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>            monthValueArr<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span>          <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">const</span> monthArrJson <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>monthArr<span class="token punctuation">)</span>        <span class="token keyword">const</span> monthValueArrJson <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>monthValueArr<span class="token punctuation">)</span>        <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">          &lt;script id="trendsChart">            var color = document.documentElement.getAttribute('data-theme') === 'light' ? '#4c4948' : 'rgba(255,255,255,0.7)'            var trendsChart = echarts.init(document.getElementById('trends-chart'), 'light');            var trendsOption = &#123;              textStyle: &#123;                color: color              &#125;,              title: &#123;                text: '博客访问统计图',                x: 'center',                textStyle: &#123;                  color: color                &#125;              &#125;,              tooltip: &#123;                trigger: 'axis'              &#125;,              xAxis: &#123;                name: '日期',                type: 'category',                axisTick: &#123;                  show: false                &#125;,                axisLine: &#123;                  show: true,                  lineStyle: &#123;                    color: color                  &#125;                &#125;,                data: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>monthArrJson<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">              &#125;,              yAxis: &#123;                name: '</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>metricsName<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">',                type: 'value',                splitLine: &#123;                  show: false                &#125;,                axisTick: &#123;                  show: false                &#125;,                axisLine: &#123;                  show: true,                  lineStyle: &#123;                    color: color                  &#125;                &#125;              &#125;,              series: [&#123;                name: '</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>metricsName<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">',                type: 'line',                smooth: true,                lineStyle: &#123;                    width: 0                &#125;,                showSymbol: false,                itemStyle: &#123;                  opacity: 1,                  color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [&#123;                    offset: 0,                    color: 'rgba(128, 255, 165)'                  &#125;,                  &#123;                    offset: 1,                    color: 'rgba(1, 191, 236)'                  &#125;])                &#125;,                areaStyle: &#123;                  opacity: 1,                  color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [&#123;                    offset: 0,                    color: 'rgba(128, 255, 165)'                  &#125;, &#123;                    offset: 1,                    color: 'rgba(1, 191, 236)'                  &#125;])                &#125;,                data: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>monthValueArrJson<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">,                markLine: &#123;                  data: [&#123;                    name: '平均值',                    type: 'average'                  &#125;]                &#125;              &#125;]            &#125;;            trendsChart.setOption(trendsOption);            window.addEventListener("resize", () => &#123;               trendsChart.resize();            &#125;);          &lt;/script></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>      <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token comment">// 访问来源</span><span class="token keyword">function</span> <span class="token function">sourcesChart</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token parameter">resolve</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">const</span> paramUrl <span class="token operator">=</span> <span class="token string">'&amp;start_date='</span> <span class="token operator">+</span> startDate <span class="token operator">+</span> <span class="token string">'&amp;end_date='</span> <span class="token operator">+</span> endDate <span class="token operator">+</span> <span class="token string">'&amp;metrics='</span> <span class="token operator">+</span> metrics <span class="token operator">+</span> <span class="token string">'&amp;method=source/all/a'</span><span class="token punctuation">;</span>    <span class="token function">fetch</span><span class="token punctuation">(</span>dataUrl <span class="token operator">+</span> paramUrl<span class="token punctuation">)</span>      <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">data</span> <span class="token operator">=></span> data<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>      <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">data</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>        monthArr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token keyword">let</span> sourcesName <span class="token operator">=</span> data<span class="token punctuation">.</span>result<span class="token punctuation">.</span>items<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>        <span class="token keyword">let</span> sourcesValue <span class="token operator">=</span> data<span class="token punctuation">.</span>result<span class="token punctuation">.</span>items<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>        <span class="token keyword">let</span> sourcesArr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> sourcesName<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>          sourcesArr<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> name<span class="token operator">:</span> sourcesName<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>name<span class="token punctuation">,</span> value<span class="token operator">:</span> sourcesValue<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">const</span> sourcesArrJson <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>sourcesArr<span class="token punctuation">)</span>        <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">          &lt;script id="sourcesChart">            var color = document.documentElement.getAttribute('data-theme') === 'light' ? '#4c4948' : 'rgba(255,255,255,0.7)'            var sourcesChart = echarts.init(document.getElementById('sources-chart'), 'light');            var sourcesOption = &#123;              textStyle: &#123;                color: color              &#125;,              title: &#123;                text: '博客访问来源统计图',                x: 'center',                textStyle: &#123;                  color: color                &#125;              &#125;,              legend: &#123;                top: 'bottom',                textStyle: &#123;                  color: color                &#125;              &#125;,              tooltip: &#123;                trigger: 'item',                formatter: "&#123;a&#125; &lt;br/>&#123;b&#125; : &#123;c&#125; (&#123;d&#125;%)"              &#125;,              series: [&#123;                name: '</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>metricsName<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">',                type: 'pie',                radius: [30, 80],                center: ['50%', '50%'],                roseType: 'area',                label: &#123;                  formatter: "&#123;b&#125; : &#123;c&#125; (&#123;d&#125;%)"                &#125;,                data: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>sourcesArrJson<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">,                itemStyle: &#123;                  emphasis: &#123;                    shadowBlur: 10,                    shadowOffsetX: 0,                    shadowColor: 'rgba(255, 255, 255, 0.5)'                  &#125;                &#125;              &#125;]            &#125;;            sourcesChart.setOption(sourcesOption);            window.addEventListener("resize", () => &#123;               sourcesChart.resize();            &#125;);          &lt;/script></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p>上面是博主自己三个统计图的代码，小伙伴们可以用以参考，根据自己的需求绘制百度分析统计图。</p><p>更多统计图的自定义属性可以查看 <a href="https://echarts.apache.org/zh/option.html#title">ECharts 配置项文档</a>，根据自行喜好对 ECharts 统计图进行修改。</p><h1 id="使用统计图"><a href="#使用统计图" class="headerlink" title="使用统计图"></a>使用统计图</h1><p>在上文新建的 <code>[Blogroot]\source\census\index.md</code> 文件中添加以下内容：</p><p><pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown"><span class="token comment">&lt;!-- 访问地图 --></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>map-chart<span class="token punctuation">"</span></span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">="</span><span class="token attr-value"><span class="token property">border-radius</span><span class="token punctuation">:</span> 8px<span class="token punctuation">;</span> <span class="token property">height</span><span class="token punctuation">:</span> 600px<span class="token punctuation">;</span> <span class="token property">padding</span><span class="token punctuation">:</span> 10px<span class="token punctuation">;</span></span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token comment">&lt;!-- 访问趋势 --></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>trends-chart<span class="token punctuation">"</span></span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">="</span><span class="token attr-value"><span class="token property">border-radius</span><span class="token punctuation">:</span> 8px<span class="token punctuation">;</span> <span class="token property">height</span><span class="token punctuation">:</span> 300px<span class="token punctuation">;</span> <span class="token property">padding</span><span class="token punctuation">:</span> 10px<span class="token punctuation">;</span></span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token comment">&lt;!-- 访问来源 --></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>sources-chart<span class="token punctuation">"</span></span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">="</span><span class="token attr-value"><span class="token property">border-radius</span><span class="token punctuation">:</span> 8px<span class="token punctuation">;</span> <span class="token property">height</span><span class="token punctuation">:</span> 300px<span class="token punctuation">;</span> <span class="token property">padding</span><span class="token punctuation">:</span> 10px<span class="token punctuation">;</span></span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p>当然也可以在其他页面引入博客访问统计图。</p><h1 id="适配明暗模式"><a href="#适配明暗模式" class="headerlink" title="适配明暗模式"></a>适配明暗模式</h1><p>统计图内部文字的颜色通过 <code>census.js</code> 文件中的 <code>var color = &#39;#000&#39;</code> 设置，如果需要适配博客明暗模式更改统计图文字颜色，以 butterfly 主题为例，可以修改三处的 <code>color</code>:</p><p><pre class="line-numbers language-DIFF" data-language="DIFF"><code class="language-DIFF">- var color &#x3D; &#39;#000&#39;+ var color &#x3D; document.documentElement.getAttribute(&#39;data-theme&#39;) &#x3D;&#x3D;&#x3D; &#39;light&#39; ? &#39;#4c4948&#39; : &#39;rgba(255,255,255,0.7)&#39;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></p><p>同时引入自定义 js 文件并添加以下代码：</p><p><pre class="line-numbers language-JAVASCRIPT" data-language="JAVASCRIPT"><code class="language-JAVASCRIPT">function switchVisitChart () &#123;  &#x2F;&#x2F; 这里为了统一颜色选取的是“明暗模式”下的两种字体颜色，也可以自己定义  let color &#x3D; document.documentElement.getAttribute(&#39;data-theme&#39;) &#x3D;&#x3D;&#x3D; &#39;light&#39; ? &#39;#4c4948&#39; : &#39;rgba(255,255,255,0.7)&#39;  if (document.getElementById(&#39;map-chart&#39;)) &#123;    let mapOptionNew &#x3D; mapOption    mapOptionNew.title.textStyle.color &#x3D; color    mapOptionNew.visualMap.textStyle.color &#x3D; color    mapChart.setOption(mapOptionNew)  &#125;  if (document.getElementById(&#39;trends-chart&#39;)) &#123;    let trendsOptionNew &#x3D; trendsOption    trendsOptionNew.title.textStyle.color &#x3D; color    trendsOptionNew.xAxis.axisLine.lineStyle.color &#x3D; color    trendsOptionNew.yAxis.axisLine.lineStyle.color &#x3D; color    trendsOptionNew.textStyle.color &#x3D; color    trendsChart.setOption(trendsOptionNew)  &#125;  if (document.getElementById(&#39;sources-chart&#39;)) &#123;    let sourcesOptionNew &#x3D; sourcesOption    sourcesOptionNew.title.textStyle.color &#x3D; color    sourcesOptionNew.legend.textStyle.color &#x3D; color    sourcesOptionNew.textStyle.color &#x3D; color    sourcesChart.setOption(sourcesOptionNew)  &#125;&#125;document.getElementById(&quot;mode-button&quot;).addEventListener(&quot;click&quot;, function () &#123; setTimeout(switchVisitChart, 100) &#125;)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h1 id="Hexo-三连"><a href="#Hexo-三连" class="headerlink" title="Hexo 三连"></a>Hexo 三连</h1><p>执行 Hexo 三连</p><p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">hexo clean &amp;&amp; hexo g &amp;&amp; hexo s<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><h1 id="可能遇到的问题"><a href="#可能遇到的问题" class="headerlink" title="可能遇到的问题"></a>可能遇到的问题</h1><ul><li><p>控制台报错 <code>Uncaught ReferenceError: require is not defined</code></p><p><strong>解决方案：</strong></p><p>不能直接在页面引用 <code>charts.js</code>，是放在主题文件夹 <code>[Blogroot]\themes\butterfly\scripts\helpers\</code> 里面，<code>hexo g</code> 的时候会在 <code>div</code> 后面追加 echarts 图的 js。页面不需要引入 <code>charts.js</code>。</p></li><li><p>控制台报错 <code>Uncaught ReferenceError: echarts is not defined</code>。</p><p><strong>解决方案：</strong></p><p>需要在统计图的前引入 <code>echarts.js</code> 文件，最好是在页面的头部引入。</p></li></ul>]]></content>
      
      
      <categories>
          
          <category> 教程笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Hexo </tag>
            
            <tag> ECharts </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hexo 博客文章统计图</title>
      <link href="post/1213ef82.html"/>
      <url>post/1213ef82.html</url>
      
        <content type="html"><![CDATA[<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>本文教程主要针对 Hexo 博客，对博客的文章发布时间、文章分类、文章标签的维度绘制统计图，使用的是 <a href="https://echarts.apache.org/examples/zh/index.html">ECharts</a> 开源可视化库。具体效果可以点击本站的 <a href="/charts/">实验室--文章统计</a> 页面查看。</p><p><div class="note info simple"><ul><li><code>2021-05-17</code> 新增主题“明暗模式”下统计图的颜色切换。</li></ul></div></p><p>如果想绘制博客站点访问统计图的可以参考文章 <a href="/post/ef1da941.html">Hexo 博客访问统计图</a></p><h1 id="新建-charts-页面"><a href="#新建-charts-页面" class="headerlink" title="新建 charts 页面"></a>新建 charts 页面</h1><p><div class="tabs" id="tab"><ul class="nav-tabs"><li class="tab"><button type="button" data-href="#tab-1">使用命令创建</button></li><li class="tab"><button type="button" data-href="#tab-2">手动创建</button></li></ul><div class="tab-contents"><div class="tab-item-content" id="tab-1"><p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">hexo new page charts<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="tab-2"><p>在 <code>[Blogroot]\source\</code> 目录下新建 <code>charts</code> 文件夹，并在新建的 <code>charts</code> 文件夹下新建 <code>index.md</code> 文件，添加以下内容：</p><p><pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown"><span class="token hr punctuation">---</span>title: 文章统计<span class="token title important">date: 2020-03-01 08:00:00<span class="token punctuation">---</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div></p><h1 id="引入-ECharts-js"><a href="#引入-ECharts-js" class="headerlink" title="引入 ECharts.js"></a>引入 ECharts.js</h1><p><div class="note info simple"><p>echarts.js 必须在渲染 echarts 实例的 JavaScript 前引入。</p></div></p><p><div class="tabs" id="tab"><ul class="nav-tabs"><li class="tab"><button type="button" data-href="#tab-1">全局引入</button></li><li class="tab"><button type="button" data-href="#tab-2">页面引入</button></li></ul><div class="tab-contents"><div class="tab-item-content" id="tab-1"><p>以 butterfly 主题为例，可以在 <code>[Blogroot]\_config.butterfly.yml</code> 的 <code>inject</code> 配置项中引入 <code>echart.js</code> 文件。</p><p><pre class="line-numbers language-yml" data-language="yml"><code class="language-yml">inject:  head:    - &lt;script src&#x3D;&quot;https:&#x2F;&#x2F;cdn.jsdelivr.net&#x2F;npm&#x2F;echarts@4.7.0&#x2F;dist&#x2F;echarts.min.js&quot;&gt;&lt;&#x2F;script&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="tab-2"><p>可以在 <code>index.md</code> 添加以下内容：</p><p><pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://cdn.jsdelivr.net/npm/echarts@4.7.0/dist/echarts.min.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div></p><h1 id="文章统计代码"><a href="#文章统计代码" class="headerlink" title="文章统计代码"></a>文章统计代码</h1><p>以 butterfly 主题为例，可以在 <code>[Blogroot]\themes\butterfly\scripts\helpers\</code> 目录下新建 <code>charts.js</code> 文件，然后添加以下内容：</p><p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> cheerio <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'cheerio'</span><span class="token punctuation">)</span><span class="token keyword">const</span> moment <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'moment'</span><span class="token punctuation">)</span>hexo<span class="token punctuation">.</span>extend<span class="token punctuation">.</span>filter<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span><span class="token string">'after_render:html'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">locals</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">const</span> $ <span class="token operator">=</span> cheerio<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span>locals<span class="token punctuation">)</span>  <span class="token keyword">const</span> post <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'#posts-chart'</span><span class="token punctuation">)</span>  <span class="token keyword">const</span> tag <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'#tags-chart'</span><span class="token punctuation">)</span>  <span class="token keyword">const</span> category <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'#categories-chart'</span><span class="token punctuation">)</span>  <span class="token keyword">let</span> htmlEncode <span class="token operator">=</span> <span class="token boolean">false</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>post<span class="token punctuation">.</span>length <span class="token operator">></span> <span class="token number">0</span> <span class="token operator">||</span> tag<span class="token punctuation">.</span>length <span class="token operator">></span> <span class="token number">0</span> <span class="token operator">||</span> category<span class="token punctuation">.</span>length <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>post<span class="token punctuation">.</span>length <span class="token operator">></span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'#postsChart'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>post<span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'data-encode'</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string">'true'</span><span class="token punctuation">)</span> htmlEncode <span class="token operator">=</span> <span class="token boolean">true</span>      post<span class="token punctuation">.</span><span class="token function">after</span><span class="token punctuation">(</span><span class="token function">postsChart</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>tag<span class="token punctuation">.</span>length <span class="token operator">></span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'#tagsChart'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>tag<span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'data-encode'</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string">'true'</span><span class="token punctuation">)</span> htmlEncode <span class="token operator">=</span> <span class="token boolean">true</span>      tag<span class="token punctuation">.</span><span class="token function">after</span><span class="token punctuation">(</span><span class="token function">tagsChart</span><span class="token punctuation">(</span>tag<span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'data-length'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>category<span class="token punctuation">.</span>length <span class="token operator">></span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'#categoriesChart'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>category<span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'data-encode'</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string">'true'</span><span class="token punctuation">)</span> htmlEncode <span class="token operator">=</span> <span class="token boolean">true</span>      category<span class="token punctuation">.</span><span class="token function">after</span><span class="token punctuation">(</span><span class="token function">categoriesChart</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>htmlEncode<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token keyword">return</span> $<span class="token punctuation">.</span><span class="token function">root</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">&amp;amp;#</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">'&amp;#'</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>      <span class="token keyword">return</span> $<span class="token punctuation">.</span><span class="token function">root</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> locals  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">)</span><span class="token keyword">function</span> <span class="token function">postsChart</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">const</span> startDate <span class="token operator">=</span> <span class="token function">moment</span><span class="token punctuation">(</span><span class="token string">'2021-01'</span><span class="token punctuation">)</span>  <span class="token keyword">const</span> endDate <span class="token operator">=</span> <span class="token function">moment</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token keyword">const</span> monthMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token keyword">const</span> dayTime <span class="token operator">=</span> <span class="token number">3600</span> <span class="token operator">*</span> <span class="token number">24</span> <span class="token operator">*</span> <span class="token number">1000</span>  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> time <span class="token operator">=</span> startDate<span class="token punctuation">;</span> time <span class="token operator">&lt;=</span> endDate<span class="token punctuation">;</span> time <span class="token operator">+=</span> dayTime<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">const</span> month <span class="token operator">=</span> <span class="token function">moment</span><span class="token punctuation">(</span>time<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">'YYYY-MM'</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>monthMap<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span>month<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      monthMap<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>month<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span>  hexo<span class="token punctuation">.</span>locals<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'posts'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">post</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">const</span> month <span class="token operator">=</span> post<span class="token punctuation">.</span>date<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">'YYYY-MM'</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>monthMap<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span>month<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      monthMap<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>month<span class="token punctuation">,</span> monthMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>month<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>  <span class="token keyword">const</span> monthArr <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token operator">...</span>monthMap<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token keyword">const</span> monthValueArr <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token operator">...</span>monthMap<span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">  &lt;script id="postsChart">    var color = '#000'    var postsChart = echarts.init(document.getElementById('posts-chart'), 'light');    var postsOption = &#123;      textStyle: &#123;        color: color      &#125;,      title: &#123;        text: '文章发布统计图',        x: 'center',        textStyle: &#123;          color: color        &#125;      &#125;,      tooltip: &#123;        trigger: 'axis'      &#125;,      xAxis: &#123;        name: '日期',        type: 'category',        axisTick: &#123;          show: false        &#125;,        axisLine: &#123;          show: true,          lineStyle: &#123;            color: color          &#125;        &#125;,        data: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>monthArr<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">      &#125;,      yAxis: &#123;        name: '文章篇数',        type: 'value',        splitLine: &#123;          show: false        &#125;,        axisTick: &#123;          show: false        &#125;,        axisLine: &#123;          show: true,          lineStyle: &#123;            color: color          &#125;        &#125;      &#125;,      series: [&#123;        name: '文章篇数',        type: 'line',        smooth: true,        lineStyle: &#123;            width: 0        &#125;,        showSymbol: false,        itemStyle: &#123;          opacity: 1,          color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [&#123;            offset: 0,            color: 'rgba(128, 255, 165)'          &#125;,          &#123;            offset: 1,            color: 'rgba(1, 191, 236)'          &#125;])        &#125;,        areaStyle: &#123;          opacity: 1,          color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [&#123;            offset: 0,            color: 'rgba(128, 255, 165)'          &#125;, &#123;            offset: 1,            color: 'rgba(1, 191, 236)'          &#125;])        &#125;,        data: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>monthValueArr<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">,        markLine: &#123;          data: [&#123;            name: '平均值',            type: 'average'          &#125;]        &#125;      &#125;]    &#125;;    postsChart.setOption(postsOption);    window.addEventListener("resize", () => &#123;       postsChart.resize();    &#125;);    &lt;/script></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function">tagsChart</span> <span class="token punctuation">(</span><span class="token parameter">len</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">const</span> tagArr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>  hexo<span class="token punctuation">.</span>locals<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'tags'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">tag</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    tagArr<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> name<span class="token operator">:</span> tag<span class="token punctuation">.</span>name<span class="token punctuation">,</span> value<span class="token operator">:</span> tag<span class="token punctuation">.</span>length <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>  tagArr<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span> <span class="token keyword">return</span> b<span class="token punctuation">.</span>value <span class="token operator">-</span> a<span class="token punctuation">.</span>value <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>  <span class="token keyword">let</span> dataLength <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span>tagArr<span class="token punctuation">.</span>length<span class="token punctuation">,</span> len<span class="token punctuation">)</span> <span class="token operator">||</span> tagArr<span class="token punctuation">.</span>length  <span class="token keyword">const</span> tagNameArr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>  <span class="token keyword">const</span> tagCountArr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> dataLength<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    tagNameArr<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>tagArr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span>    tagCountArr<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>tagArr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>value<span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">const</span> tagNameArrJson <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>tagNameArr<span class="token punctuation">)</span>  <span class="token keyword">const</span> tagCountArrJson <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>tagCountArr<span class="token punctuation">)</span>  <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">  &lt;script id="tagsChart">    var color = '#000'    var tagsChart = echarts.init(document.getElementById('tags-chart'), 'light');    var tagsOption = &#123;      textStyle: &#123;        color: color      &#125;,      title: &#123;        text: 'Top </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>dataLength<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string"> 标签统计图',        x: 'center',        textStyle: &#123;          color: color        &#125;      &#125;,      tooltip: &#123;&#125;,      xAxis: &#123;        name: '标签',        type: 'category',        axisTick: &#123;          show: false        &#125;,        axisLine: &#123;          show: true,          lineStyle: &#123;            color: color          &#125;        &#125;,        data: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>tagNameArrJson<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">      &#125;,      yAxis: &#123;        name: '文章篇数',        type: 'value',        splitLine: &#123;          show: false        &#125;,        axisTick: &#123;          show: false        &#125;,        axisLine: &#123;          show: true,          lineStyle: &#123;            color: color          &#125;        &#125;      &#125;,      series: [&#123;        name: '文章篇数',        type: 'bar',        data: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>tagCountArrJson<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">,        itemStyle: &#123;          opacity: 1,          color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [&#123;            offset: 0,            color: 'rgba(128, 255, 165)'          &#125;,          &#123;            offset: 1,            color: 'rgba(1, 191, 236)'          &#125;])        &#125;,        emphasis: &#123;          itemStyle: &#123;            opacity: 1,            color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [&#123;              offset: 0,              color: 'rgba(128, 255, 195)'            &#125;,            &#123;              offset: 1,              color: 'rgba(1, 211, 255)'            &#125;])          &#125;        &#125;,        markLine: &#123;          data: [&#123;            name: '平均值',            type: 'average'          &#125;]        &#125;      &#125;]    &#125;;    tagsChart.setOption(tagsOption);    window.addEventListener("resize", () => &#123;       tagsChart.resize();    &#125;);    &lt;/script></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function">categoriesChart</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">const</span> categoryArr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>  hexo<span class="token punctuation">.</span>locals<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'categories'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">category</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    categoryArr<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> name<span class="token operator">:</span> category<span class="token punctuation">.</span>name<span class="token punctuation">,</span> value<span class="token operator">:</span> category<span class="token punctuation">.</span>length <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>  categoryArr<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span> <span class="token keyword">return</span> b<span class="token punctuation">.</span>value <span class="token operator">-</span> a<span class="token punctuation">.</span>value <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">const</span> categoryArrJson <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>categoryArr<span class="token punctuation">)</span>  <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">  &lt;script id="categoriesChart">    var color = '#000'    var categoriesChart = echarts.init(document.getElementById('categories-chart'), 'light');    var categoriesOption = &#123;      textStyle: &#123;        color: color      &#125;,      title: &#123;        text: '文章分类统计图',        x: 'center',        textStyle: &#123;          color: color        &#125;      &#125;,      legend: &#123;        top: 'bottom',        textStyle: &#123;          color: color        &#125;      &#125;,      tooltip: &#123;        trigger: 'item',        formatter: "&#123;a&#125; &lt;br/>&#123;b&#125; : &#123;c&#125; (&#123;d&#125;%)"      &#125;,      series: [&#123;        name: '文章篇数',        type: 'pie',        radius: [30, 80],        center: ['50%', '50%'],        roseType: 'area',        label: &#123;          formatter: "&#123;b&#125; : &#123;c&#125; (&#123;d&#125;%)"        &#125;,        data: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>categoryArrJson<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">,        itemStyle: &#123;          emphasis: &#123;            shadowBlur: 10,            shadowOffsetX: 0,            shadowColor: 'rgba(255, 255, 255, 0.5)'          &#125;        &#125;      &#125;]    &#125;;    categoriesChart.setOption(categoriesOption);    window.addEventListener("resize", () => &#123;       categoriesChart.resize();    &#125;);    &lt;/script></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p>更多统计图的自定义属性可以查看 <a href="https://echarts.apache.org/zh/option.html#title">ECharts 配置项文档</a>，根据自行喜好对 ECharts 统计图进行修改。</p><h1 id="使用统计图"><a href="#使用统计图" class="headerlink" title="使用统计图"></a>使用统计图</h1><p>在上文新建的 <code>[Blogroot]\source\charts\index.md</code> 文件中添加以下内容：</p><p><pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown"><span class="token comment">&lt;!-- 文章发布时间统计图 --></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>posts-chart<span class="token punctuation">"</span></span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">="</span><span class="token attr-value"><span class="token property">border-radius</span><span class="token punctuation">:</span> 8px<span class="token punctuation">;</span> <span class="token property">height</span><span class="token punctuation">:</span> 300px<span class="token punctuation">;</span> <span class="token property">padding</span><span class="token punctuation">:</span> 10px<span class="token punctuation">;</span></span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token comment">&lt;!-- 文章标签统计图 --></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>tags-chart<span class="token punctuation">"</span></span> <span class="token attr-name">data-length</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>10<span class="token punctuation">"</span></span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">="</span><span class="token attr-value"><span class="token property">border-radius</span><span class="token punctuation">:</span> 8px<span class="token punctuation">;</span> <span class="token property">height</span><span class="token punctuation">:</span> 300px<span class="token punctuation">;</span> <span class="token property">padding</span><span class="token punctuation">:</span> 10px<span class="token punctuation">;</span></span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token comment">&lt;!-- 文章分类统计图 --></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>categories-chart<span class="token punctuation">"</span></span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">="</span><span class="token attr-value"><span class="token property">border-radius</span><span class="token punctuation">:</span> 8px<span class="token punctuation">;</span> <span class="token property">height</span><span class="token punctuation">:</span> 300px<span class="token punctuation">;</span> <span class="token property">padding</span><span class="token punctuation">:</span> 10px<span class="token punctuation">;</span></span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p>当然也可以在其他页面引入文章统计图。</p><p>其中 <code>tags-chart</code> 的 <code>data-length=&quot;10&quot;</code> 属性表示仅显示排名前 10 的标签。</p><h1 id="适配明暗模式"><a href="#适配明暗模式" class="headerlink" title="适配明暗模式"></a>适配明暗模式</h1><p>统计图内部文字的颜色通过 <code>charts.js</code> 文件中的 <code>var color = &#39;#000&#39;</code> 设置，如果需要适配博客明暗模式更改统计图文字颜色，以 butterfly 主题为例，可以修改三处的 <code>color</code>:</p><p><pre class="line-numbers language-DIFF" data-language="DIFF"><code class="language-DIFF">- var color &#x3D; &#39;#000&#39;+ var color &#x3D; document.documentElement.getAttribute(&#39;data-theme&#39;) &#x3D;&#x3D;&#x3D; &#39;light&#39; ? &#39;#4c4948&#39; : &#39;rgba(255,255,255,0.7)&#39;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></p><p>同时引入自定义 js 文件并添加以下代码：</p><p><pre class="line-numbers language-JAVASCRIPT" data-language="JAVASCRIPT"><code class="language-JAVASCRIPT">function switchPostChart () &#123;  &#x2F;&#x2F; 这里为了统一颜色选取的是“明暗模式”下的两种字体颜色，也可以自己定义  let color &#x3D; document.documentElement.getAttribute(&#39;data-theme&#39;) &#x3D;&#x3D;&#x3D; &#39;light&#39; ? &#39;#4c4948&#39; : &#39;rgba(255,255,255,0.7)&#39;  if (document.getElementById(&#39;posts-chart&#39;)) &#123;    let postsOptionNew &#x3D; postsOption    postsOptionNew.textStyle.color &#x3D; color    postsOptionNew.title.textStyle.color &#x3D; color    postsOptionNew.xAxis.axisLine.lineStyle.color &#x3D; color    postsOptionNew.yAxis.axisLine.lineStyle.color &#x3D; color    postsChart.setOption(postsOptionNew)  &#125;  if (document.getElementById(&#39;tags-chart&#39;)) &#123;    let tagsOptionNew &#x3D; tagsOption    tagsOptionNew.textStyle.color &#x3D; color    tagsOptionNew.title.textStyle.color &#x3D; color    tagsOptionNew.xAxis.axisLine.lineStyle.color &#x3D; color    tagsOptionNew.yAxis.axisLine.lineStyle.color &#x3D; color    tagsChart.setOption(tagsOptionNew)  &#125;  if (document.getElementById(&#39;categories-chart&#39;)) &#123;    let categoriesOptionNew &#x3D; categoriesOption    categoriesOptionNew.textStyle.color &#x3D; color    categoriesOptionNew.title.textStyle.color &#x3D; color    categoriesOptionNew.legend.textStyle.color &#x3D; color    categoriesChart.setOption(categoriesOptionNew)  &#125;&#125;document.getElementById(&quot;mode-button&quot;).addEventListener(&quot;click&quot;, function () &#123; setTimeout(switchPostChart, 100) &#125;)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h1 id="Hexo-三连"><a href="#Hexo-三连" class="headerlink" title="Hexo 三连"></a>Hexo 三连</h1><p>执行 Hexo 三连</p><p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">hexo clean &amp;&amp; hexo g &amp;&amp; hexo s<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><h1 id="可能遇到的问题"><a href="#可能遇到的问题" class="headerlink" title="可能遇到的问题"></a>可能遇到的问题</h1><ul><li><p>控制台报错 <code>Uncaught ReferenceError: require is not defined</code></p><p><strong>解决方案：</strong></p><p>不能直接在页面引用 <code>charts.js</code>，是放在主题文件夹 <code>[Blogroot]\themes\butterfly\scripts\helpers\</code> 里面，<code>hexo g</code> 的时候会在 <code>div</code> 后面追加 echarts 图的 js。页面不需要引入 <code>charts.js</code>。</p></li></ul><ul><li><p>控制台报错 <code>Uncaught ReferenceError: echarts is not defined</code>。</p><p><strong>解决方案：</strong></p><p>需要在统计图的前引入 <code>echarts.js</code> 文件，最好是在页面的头部引入。</p></li></ul>]]></content>
      
      
      <categories>
          
          <category> 教程笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Hexo </tag>
            
            <tag> ECharts </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hive 面试题解析</title>
      <link href="post/62c9bbde.html"/>
      <url>post/62c9bbde.html</url>
      
        <content type="html"><![CDATA[<h2 id="Hive-基础"><a href="#Hive-基础" class="headerlink" title="Hive 基础"></a>Hive 基础</h2><blockquote><h3 id="请谈一下-Hive-的特点，Hive-和-RDBMS-有什么异同？"><a href="#请谈一下-Hive-的特点，Hive-和-RDBMS-有什么异同？" class="headerlink" title="请谈一下 Hive 的特点，Hive 和 RDBMS 有什么异同？"></a>请谈一下 Hive 的特点，Hive 和 RDBMS 有什么异同？</h3></blockquote><p>Hive 是基于 Hadoop 的一个数据仓库工具，可以将结构化的数据文件映射为一张数据库表，并提供完整的 SQL 查询功能，可以将 SQL 语句转换为 MapReduce 任务进行运行。其优点是学习成本低，可以通过类 SQL 语句快速实现简单的 MapReduce 统计，不必开发专门的 MapReduce 应用，十分适合数据仓库的统计分析，但是 Hive 不支持实时查询。</p><p>Hive 与关系型数据库的区别：</p><div class="table-container"><table><thead><tr><th>比较项</th><th>SQL</th><th>HiveQL</th></tr></thead><tbody><tr><td>ANSI SQL</td><td>支持</td><td>不完全支持</td></tr><tr><td>更新</td><td>UPDATE\INSERT\DELETE</td><td>INSERT OVERWRITE\INTO TABLE</td></tr><tr><td>事务</td><td>支持</td><td>不支持</td></tr><tr><td>模式</td><td>写模式</td><td>读模式</td></tr><tr><td>数据保存</td><td>块设备、本地文件系统</td><td>HDFS</td></tr><tr><td>延时</td><td>低</td><td>高</td></tr><tr><td>多表插入</td><td>不支持</td><td>支持</td></tr><tr><td>子查询</td><td>完全支持</td><td>只能用在 From 子句中</td></tr><tr><td>视图</td><td>Updatable</td><td>Read-only</td></tr><tr><td>可扩展性</td><td>低</td><td>高</td></tr><tr><td>数据规模</td><td>小</td><td>大</td></tr><tr><td>...</td><td>......</td><td>......</td></tr></tbody></table></div><blockquote><h3 id="Hive-的架构原理？"><a href="#Hive-的架构原理？" class="headerlink" title="Hive 的架构原理？"></a>Hive 的架构原理？</h3></blockquote><p><img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="/images/post/bigdata_interview/hive_architecture.png" alt></p><ol><li><p>两种客户端</p><ul><li>CLI（command-line interface）：命令行客户端（可以在 shell 中操作）；</li><li>JDBC 客户端</li></ul></li><li><p>四种驱动 Driver</p><ul><li>SQL Parser 解析器：检查 SQL 语法是否有错误；</li><li>Physical Plan 编译器：把 SQL 语句转化成 MR 程序；</li><li>Query Optimizer 优化器：优化 SQL 语句；</li><li>Execution 执行器：执行 MR 程序。</li></ul></li><li><p>元数据库 Meta store</p><ul><li>Meta store 是 Hive 数据库中的一个库，用于存储处理数据的元数据，包括：表名、表所属的数据库（默认是 default）、表的拥有者、列/分区字段、表的类型（是否是外部表）、表的数据所在目录等。</li><li>Meta store 默认存储在 Hive 自带的 Derby 数据库中，但因为 Hive 的元数据可能要面临不断地更新、修改和读取操作，Derby 无法实现并发，实际工作中一般将 Derby 替换为 MySQL。</li><li>Hive 中处理的数据分两部分存放：<ul><li>处理的结构化数据，存储在 HDFS 中；</li><li>表的元数据存储在元数据库 MySQL 中。</li></ul></li></ul></li></ol><p>这样，有了表的元数据信息，就能找到对应的字段；然后把字段映射到结构化数据中，这样就可以通过映射形成一张虚表；</p><p>也就是说，表的元数据和 MySQL 中的结构化数据，通过映射，构成一张虚表，用于 Hive 查询数据分析。</p><blockquote><h3 id="Hive-的存储过程："><a href="#Hive-的存储过程：" class="headerlink" title="Hive 的存储过程："></a>Hive 的存储过程：</h3></blockquote><p>启动 Hive 时，会初始化 Hive，这时会在 MySQL 中生成大约 36 张表（后续随着业务的复杂会增加），然后创建表，会在 MySQL 中存放这个表的信息（不是以表的形式存在的，而是把表的属性以数据的形式放在 MySQL 中，这样在 Hive 中使用 SQL 命令一样是能够查到这张表的）。然后把本地的文本文件使用 Hive 命令格式化导入到表中，这样这些数据就存放到 HDFS 中，而不是在 MySQL 或 Hive 中。</p><blockquote><h3 id="Hive-有哪些方式保存元数据，各有哪些特点？"><a href="#Hive-有哪些方式保存元数据，各有哪些特点？" class="headerlink" title="Hive 有哪些方式保存元数据，各有哪些特点？"></a>Hive 有哪些方式保存元数据，各有哪些特点？</h3></blockquote><p>Hive 支持三种不同的元存储服务器，分别为：内嵌式元存储服务器、本地元存储服务器、远程元存储服务器，每种存储方式使用不同的配置参数。</p><ul><li>内嵌式元存储主要用于单元测试，在该模式下每次只有一个进程可以连接到元存储，Derby 是内嵌式元存储的默认数据库。</li><li>在本地模式下，每个 Hive 客户端都会打开到数据存储的连接并在该连接上请求 SQL 查询。</li><li>在远程模式下，所有的 Hive 客户端都将打开一个到元数据服务器的连接，该服务器依次查询元数据，元数据服务器和客户端之间使用 Thrift 协议通信。</li></ul><blockquote><h3 id="Hive-内部表和外部表的区别？"><a href="#Hive-内部表和外部表的区别？" class="headerlink" title="Hive 内部表和外部表的区别？"></a>Hive 内部表和外部表的区别？</h3></blockquote><ul><li>创建表时：创建内部表时，会将数据移动到数据仓库指向的路径；若创建外部表，仅记录数据所在的路径，不对数据的位置做任何改变。</li><li>删除表时：在删除表的时候，内部表的元数据和数据会被一起删除，而外部表只删除元数据，不删除数据。这样外部表相对来说更加安全些，数据组织也更加灵活，方便共享源数据。</li></ul><blockquote><h3 id="Hive-中的压缩格式-TextFile、SequenceFile、RCFile-、ORCFile-各有什么区别？"><a href="#Hive-中的压缩格式-TextFile、SequenceFile、RCFile-、ORCFile-各有什么区别？" class="headerlink" title="Hive 中的压缩格式 TextFile、SequenceFile、RCFile 、ORCFile 各有什么区别？"></a>Hive 中的压缩格式 TextFile、SequenceFile、RCFile 、ORCFile 各有什么区别？</h3></blockquote><ul><li><p>TextFile</p><p>默认格式，存储方式为行存储，数据不做压缩，磁盘开销大，数据解析开销大。可结合 Gzip、Bzip2 使用（系统自动检查，执行查询时自动解压），但使用这种方式，压缩后的文件不支持 split，Hive 不会对数据进行切分，从而无法对数据进行并行操作。并且在反序列化过程中，必须逐个字符判断是不是分隔符和行结束符，因此反序列化开销会比 SequenceFile 高几十倍。</p></li><li><p>SequenceFile</p><p>SequenceFile 是 Hadoop API 提供的一种二进制文件支持，存储方式为行存储，其具有使用方便、可分割、可压缩的特点。</p><p>SequenceFile 支持三种压缩选择：NONE，RECORD，BLOCK。Record 压缩率低，一般建议使用 BLOCK 压缩。</p><p>优势是文件和 Hadoop API 中的 MapFile 是相互兼容的。</p></li><li><p>RCFile</p><p>存储方式：数据按行分块，每块按列存储。结合了行存储和列存储的优点：</p><p>首先，RCFile 保证同一行的数据位于同一节点，因此元组重构的开销很低；</p><p>其次，像列存储一样，RCFile 能够利用列维度的数据压缩，并且能跳过不必要的列读取；</p></li><li><p>ORCFile</p><p>存储方式：数据按行分块 每块按照列存储。</p><p>压缩快、快速列存取。</p><p>效率比 RCFile 高，是 RCFile 的改良版本。</p></li></ul><p><strong>总结：</strong>相比 TextFile 和 SequenceFile，RCFile 由于列式存储方式，数据加载时性能消耗较大，但是具有较好的压缩比和查询响应。数据仓库的特点是一次写入、多次读取，因此，整体来看，RCFile 相比其余两种格式具有较明显的优势。</p><blockquote><h3 id="说说对-Hive-桶表的理解？"><a href="#说说对-Hive-桶表的理解？" class="headerlink" title="说说对 Hive 桶表的理解？"></a>说说对 Hive 桶表的理解？</h3></blockquote><p>桶表是对数据进行哈希取值，然后放到不同文件中存储。</p><p>数据加载到桶表时，会对字段取 hash 值，然后与桶的数量取模。把数据放到对应的文件中。物理上，每个桶就是表（或分区）目录里的一个文件，一个作业产生的桶（输出文件）和 reduce 任务个数相同。</p><p>桶表专门用于抽样查询，是很专业性的，不是日常用来存储数据的表，需要抽样查询时，才创建和使用桶表。</p><blockquote><h3 id="Hive-的-HiveSQL-转换为-MapReduce-的过程？"><a href="#Hive-的-HiveSQL-转换为-MapReduce-的过程？" class="headerlink" title="Hive 的 HiveSQL 转换为 MapReduce 的过程？"></a>Hive 的 HiveSQL 转换为 MapReduce 的过程？</h3></blockquote><p><img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="/images/post/bigdata_interview/hive_sqlparsemr.png" alt></p><ol><li>SQL Parser：Antlr 定义 SQL 的语法规则，完成 SQL 词法，语法解析，将 SQL 转化为抽象语法树 AST Tree；</li><li>Semantic Analyzer：遍历 AST Tree，抽象出查询的基本组成单元 QueryBlock；</li><li>Logical plan：遍历 QueryBlock，翻译为执行操作树 OperatorTree；</li><li>Logical plan optimizer: 逻辑层优化器进行 OperatorTree 变换，合并不必要的 ReduceSinkOperator，减少 shuffle 数据量；</li><li>Physical plan：遍历 OperatorTree，翻译为 MapReduce 任务；</li><li>Logical plan optimizer：物理层优化器进行 MapReduce 任务的变换，生成最终的执行计划。</li></ol><blockquote><h3 id="所有的-Hive-任务都会有-MapReduce-的执行吗？"><a href="#所有的-Hive-任务都会有-MapReduce-的执行吗？" class="headerlink" title="所有的 Hive 任务都会有 MapReduce 的执行吗？"></a>所有的 Hive 任务都会有 MapReduce 的执行吗？</h3></blockquote><p>不是，从 Hive0.10.0 版本开始，对于简单的不需要聚合的类似 <code>SELECT * FROM LIMIT n</code> 语句，不需要起 MapReduce job，直接通过 Fetch task 获取数据。</p><blockquote><h3 id="什么是-Fetch-抓取"><a href="#什么是-Fetch-抓取" class="headerlink" title="什么是 Fetch 抓取"></a>什么是 Fetch 抓取</h3></blockquote><p>Fetch 抓取是指，Hive 中对某些情况的查询可以不必使用 MapReduce 计算。例如：<code>SELECT * FROM employees</code>，在这种情况下，Hive 可以简单地读取 employee 对应的存储目录下的文件，然后输出查询结果到控制台。</p><p>在 <code>hive-default.xml.template</code> 文件中 <code>hive.fetch.task.conversion</code> 默认是 <code>more</code>，老版本 Hive 默认是 <code>minimal</code>，该属性修改为 <code>more</code> 以后，在全局查找、字段查找、limit 查找等都不走 MapReduce。</p><blockquote><h3 id="什么是本地模式"><a href="#什么是本地模式" class="headerlink" title="什么是本地模式"></a>什么是本地模式</h3></blockquote><p>大多数的 Hadoop Job 是需要 Hadoop 提供的完整的可扩展性来处理大数据集的。不过，有时 Hive 的输入数据量是非常小的。在这种情况下，为查询触发执行任务时消耗可能会比实际 job 的执行时间要多的多。对于大多数这种情况，Hive 可以通过本地模式在单台机器上处理所有的任务。对于小数据集，执行时间可以明显被缩短。</p><p>用户可以通过设置 <code>hive.exec.mode.local.auto</code> 的值为 <code>true</code>，来让 Hive 在适当的时候自动启动这个优化。</p><blockquote><h3 id="Hive-的函数：UDF、UDAF、UDTF-的区别？"><a href="#Hive-的函数：UDF、UDAF、UDTF-的区别？" class="headerlink" title="Hive 的函数：UDF、UDAF、UDTF 的区别？"></a>Hive 的函数：UDF、UDAF、UDTF 的区别？</h3></blockquote><ul><li>UDF：User-Defined Function，用户定义（普通）函数，只对单行数值产生作用；单行进入，单行输出。</li><li>UDAF：User-Defined Aggregation Function，用户定义聚合函数，可对多行数据产生作用；等同与 SQL 中常用的 <code>SUM()</code>，<code>AVG()</code>，也是聚合函数；多行进入，单行输出。</li><li>UDTF：User-Defined Table-Generating Functions，用户定义表生成函数，用来解决输入一行输出多行，如 <code>lateral view explore()</code>；单行输入，多行输出。</li></ul><blockquote><h3 id="请说明-Hive-中-Order-By，Sort-By，Distribute-By，Cluster-By-各代表什么意思？"><a href="#请说明-Hive-中-Order-By，Sort-By，Distribute-By，Cluster-By-各代表什么意思？" class="headerlink" title="请说明 Hive 中 Order By，Sort By，Distribute By，Cluster By 各代表什么意思？"></a>请说明 Hive 中 Order By，Sort By，Distribute By，Cluster By 各代表什么意思？</h3></blockquote><ul><li>order by：会对输入做全局排序，因此只有一个 reducer（多个 reducer 无法保证全局有序）。只有一个 reducer，会导致当输入规模较大时，需要较长的计算时间。</li><li>sort by：不是全局排序，其在数据进入 reducer 前完成排序。</li><li>distribute by：按照指定的字段对数据进行划分输出到不同的 reduce 中。</li><li>cluster by：除了具有 distribute by 的功能外还兼具 sort by 的功能。</li></ul><blockquote><h3 id="写出-Hive-中-split、coalesce-及-collect-list-函数的用法（可举例）？"><a href="#写出-Hive-中-split、coalesce-及-collect-list-函数的用法（可举例）？" class="headerlink" title="写出 Hive 中 split、coalesce 及 collect_list 函数的用法（可举例）？"></a>写出 Hive 中 split、coalesce 及 collect_list 函数的用法（可举例）？</h3></blockquote><ul><li><code>split</code> 将字符串转化为数组，即：<code>split(&#39;a,b,c,d&#39;, &#39;,&#39;) ==&gt; [&quot;a&quot;,&quot;b&quot;,&quot;c&quot;,&quot;d&quot;]</code>。</li><li><code>coalesce(T v1, T v2, …)</code> 返回参数中的第一个非空值；如果所有值都为 <code>NULL</code>，那么返回 <code>NULL</code>。</li><li><code>collect_list</code> 列出该字段所有的值，不去重 =&gt; <code>select collect_list(id) from table</code>。</li></ul><blockquote><h3 id="Hive-的两张表关联，使用-MapReduce-怎么实现？"><a href="#Hive-的两张表关联，使用-MapReduce-怎么实现？" class="headerlink" title="Hive 的两张表关联，使用 MapReduce 怎么实现？"></a>Hive 的两张表关联，使用 MapReduce 怎么实现？</h3></blockquote><ul><li><p>如果其中有一张表为小表，直接使用 map 端 join 的方式（map 端加载小表）进行聚合。</p></li><li><p>如果两张都是大表，那么采用联合 key，联合 key 的第一个组成部分是 join on 中的公共字段，第二部分是一个 flag，0 代表表 A，1 代表表 B，由此让 Reduce 区分客户信息和订单信息；在 Mapper 中同时处理两张表的信息，将 join on 公共字段相同的数据划分到同一个分区中，进而传递到一个 Reduce 中，然后在 Reduce 中实现聚合。</p></li></ul><h2 id="Hive-优化"><a href="#Hive-优化" class="headerlink" title="Hive 优化"></a>Hive 优化</h2><blockquote><h3 id="小表、大表-JOIN-优化"><a href="#小表、大表-JOIN-优化" class="headerlink" title="小表、大表 JOIN 优化"></a>小表、大表 JOIN 优化</h3></blockquote><p>将 key 相对分散，并且数据量小的表放在 JOIN 的左边，这样可以有效减少内存溢出错误发生的几率；再进一步，可以使用 Group 让小的维度表（1000 条以下的记录条数）先进内存。在 map 端完成 reduce。</p><p>实际测试发现：新版的 Hive 已经对小表 JOIN 大表和大表 JOIN 小表进行了优化。小表放在左边和右边已经没有明显区别。</p><blockquote><h3 id="大表-JOIN-大表优化"><a href="#大表-JOIN-大表优化" class="headerlink" title="大表 JOIN 大表优化"></a>大表 JOIN 大表优化</h3></blockquote><ul><li><p>空 KEY 过滤</p><p>有时 JOIN 超时是因为某些 key 对应的数据太多，而相同 key 对应的数据都会发送到相同的 reducer 上，从而导致内存不够。此时我们应该仔细分析这些异常的 key，很多情况下，这些 key 对应的数据是异常数据，我们需要在 SQL 语句中进行过滤。例如 key 对应的字段为空。</p></li><li><p>空 key 转换</p><p>有时虽然某个 key 为空对应的数据很多，但是相应的数据不是异常数据，必须要包含在 JOIN 的结果中，此时我们可以表 A 中 key 为空的字段赋一个随机的值，使得数据随机均匀地分不到不同的 reducer 上。</p></li></ul><blockquote><h3 id="Group-By-优化"><a href="#Group-By-优化" class="headerlink" title="Group By 优化"></a>Group By 优化</h3></blockquote><p>默认情况下，Map 阶段同一 Key 数据分发给一个 reduce，当一个 key 数据过大时就倾斜了。</p><p>并不是所有的聚合操作都需要在 Reduce 端完成，很多聚合操作都可以先在 Map 端进行部分聚合，最后在 Reduce 端得出最终结果。</p><p>开启 Map 端聚合参数设置</p><ul><li>是否在 Map 端进行聚合，默认为 true：<code>hive.map.aggr = true</code></li><li>在 Map 端进行聚合操作的条目数目：<code>hive.groupby.mapaggr.checkinterval = 100000</code></li><li>有数据倾斜的时候进行负载均衡（默认是 false）：<code>hive.groupby.skewindata = true</code></li></ul><p>当选项设定为 true，生成的查询计划会有两个 MR Job。第一个 MR Job 中，Map 的输出结果会随机分布到 Reduce 中，每个 Reduce 做部分聚合操作，并输出结果，这样处理的结果是相同的 Group By Key 有可能被分发到不同的 Reduce 中，从而达到负载均衡的目的；第二个 MR Job 再根据预处理的数据结果按照 Group By Key 分布到 Reduce 中（这个过程可以保证相同的 Group By Key 被分布到同一个 Reduce 中），最后完成最终的聚合操作。</p><blockquote><h3 id="替换-COUNT-Distinct-去重统计"><a href="#替换-COUNT-Distinct-去重统计" class="headerlink" title="替换 COUNT(Distinct) 去重统计"></a>替换 COUNT(Distinct) 去重统计</h3></blockquote><p>数据量小的时候无所谓，数据量大的情况下，由于 COUNT DISTINCT 操作需要用一个 Reduce Task 来完成，这一个 Reduce 需要处理的数据量太大，就会导致整个 Job 很难完成，一般 COUNT DISTINCT 使用先 GROUP BY 再 COUNT 的方式替换。</p><blockquote><h3 id="避免笛卡尔积"><a href="#避免笛卡尔积" class="headerlink" title="避免笛卡尔积"></a>避免笛卡尔积</h3></blockquote><p>尽量避免笛卡尔积，join 的时候不加 on 条件，或者无效的 on 条件，Hive 只能使用 1 个 reducer 来完成笛卡尔积。</p><blockquote><h3 id="行列过滤"><a href="#行列过滤" class="headerlink" title="行列过滤"></a>行列过滤</h3></blockquote><ul><li>列处理：在 SELECT 中，只拿需要的列，如果有，尽量使用分区过滤，少用 <code>SELECT *</code>。</li><li>行处理：在分区剪裁中，当使用外关联时，如果将副表的过滤条件写在 where 后面，那么就会先全表关联，之后再过滤。</li></ul><blockquote><h3 id="Hive-表关联查询，如何解决数据倾斜的问题？"><a href="#Hive-表关联查询，如何解决数据倾斜的问题？" class="headerlink" title="Hive 表关联查询，如何解决数据倾斜的问题？"></a>Hive 表关联查询，如何解决数据倾斜的问题？</h3></blockquote><ol><li>倾斜原因：map 输出数据按 key Hash 的分配到 reduce 中，由于 key 分布不均匀、业务数据本身的特点、建表时考虑不周等原因造成的 reduce 上的数据量差异过大。<ul><li>key 分布不均匀;</li><li>业务数据本身的特性;</li><li>建表时考虑不周;</li><li>某些 SQL 语句本身就有数据倾斜;</li></ul></li></ol><p>如何避免：对于 key 为空产生的数据倾斜，可以对其赋予一个随机值。</p><ol><li><p>解决方案</p><ul><li><p>参数调节：</p><p><code>hive.map.aggr=true</code></p><p><code>hive.groupby.skewindata=true</code></p><p>有数据倾斜的时候进行负载均衡，当选项设定位 true，生成的查询计划会有两个 MR Job。</p><p>第一个 MR Job 中，Map 的输出结果集合会随机分布到 Reduce 中，每个 Reduce 做部分聚合操作，并输出结果，这样处理的结果是相同的 Group By Key 有可能被分发到不同的 Reduce 中，从而达到负载均衡的目的；</p><p>第二个 MR Job 再根据预处理的数据结果按照 Group By Key 分布到 Reduce 中（这个过程可以保证相同的 Group By Key 被分布到同一个 Reduce 中），最后完成最终的聚合操作。</p></li><li><p>SQL 语句调节：</p><ul><li>选用 join key 分布最均匀的表作为驱动表。做好列裁剪和 filter 操作，以达到两表做 join 的时候，数据量相对变小的效果。</li><li>大小表 join：使用 map join 让小的维度表（1000 条以下的记录条数）先进内存。在 map 端完成 reduce。</li><li>大表 join 大表：把空值的 key 变成一个字符串加上随机数，把倾斜的数据分到不同的 reduce 上，由于 null 值关联不上，处理后并不影响最终结果。</li><li>count distinct 大量相同特殊值：count distinct 时，将值为空的情况单独处理，如果是计算 count distinct，可以不用处理，直接过滤，在最后结果中加 1。如果还有其他计算，需要进行 group by，可以先将值为空的记录单独处理，再和其他计算结果进行 union。</li></ul></li></ul></li></ol><blockquote><h3 id="优化-Map-数"><a href="#优化-Map-数" class="headerlink" title="优化 Map 数"></a>优化 Map 数</h3></blockquote><ol><li><p>通常情况下，作业会通过 input 的目录产生一个或者多个 map 任务。</p><p>主要的决定因素有：input 的文件总个数，input 的文件大小，集群设置的文件块大小。</p></li><li><p>是不是 map 数越多越好？</p><p>不一定。如果一个任务有很多小文件（远远小于块大小 128MB），则每个小文件也会被当做一个块，用一个 map 任务来完成，而一个 map 任务启动和初始化的时间远远大于逻辑处理的时间，就会造成很大的资源浪费。而且，同时可执行的 map 数是受限的。</p></li><li><p>是不是保证每个 map 处理接近 128MB 的文件块，就高枕无忧了？</p><p>答案也是不一定。比如有一个 127MB 的文件，正常会用一个 map 去完成，但这个文件只有一个或者两个小字段，却有几千万的记录，如果 map 处理的逻辑比较复杂，用一个 map 任务去做，肯定也比较耗时。</p></li></ol><p><strong>注意：</strong>针对上面的问题 2 和 3，我们需要采取两种方式来解决：即减少 map 数和增加 map 数。</p><blockquote><h3 id="小文件进行合并"><a href="#小文件进行合并" class="headerlink" title="小文件进行合并"></a>小文件进行合并</h3></blockquote><p>在 map 执行前合并小文件，减少 map 数：CombineHiveInputFormat 具有对小文件进行合并的功能（系统默认的格式）。HiveInputFormat 没有对小文件合并功能。</p><p><code>set hive.input.format=org.apache.hadoop.hive.ql.io.CombineHiveInputFormat</code></p><blockquote><h3 id="复杂文件增加-Map-数"><a href="#复杂文件增加-Map-数" class="headerlink" title="复杂文件增加 Map 数"></a>复杂文件增加 Map 数</h3></blockquote><p>当 input 的文件都很大，任务逻辑复杂，map 执行非常慢的时候，可以考虑增加 Map 数，来使得每个 map 处理的数据量减少，从而提高任务的执行效率。</p><p>增加 map 的方法为：根据 <code>computeSliteSize(Math.max(minSize, Math.min(maxSize, blocksize))) = blocksize = 128MB</code> 公式，调整 maxSize 最大值。让 maxSize 最大值低于 blocksize 就可以增加 map 的个数。</p><blockquote><h3 id="优化-Reduce-数"><a href="#优化-Reduce-数" class="headerlink" title="优化 Reduce 数"></a>优化 Reduce 数</h3></blockquote><ol><li><p>调整 reduce 个数方法一</p><ul><li><p>每个 Reduce 处理的数据量默认是 256MB</p><p><code>hive.exec.reducers.bytes.per.reducer=256000000</code></p></li><li><p>每个任务最大的 reduce 数，默认为 1009</p><p><code>hive.exec.reducers.max=1009</code></p></li><li><p>计算 reducer 数的公式</p><p>N = min(参数2, 总输入数据量/参数1)</p></li></ul></li><li><p>调整 reduce 个数方法二</p><p> 在 hadoop 的 <code>mapred-default.xml</code> 文件中修改设置每个 job 的 Reduce 个数</p><p> <code>set mapreduce.job.reduces = 15</code></p></li><li><p>reduce 个数并不是越多越好</p><ul><li>过多的启动和初始化 reduce 也会消耗时间和资源；</li><li><p>另外，有多少个 reduce，就会有多少个输出文件，如果生成了很多个小文件，那么如果这些小文件作为下一个任务的输入，则也会出现小文件过多的问题；</p><p>在设置 reduce 个数的时候也需要考虑这两个原则：处理大数据量利用合适的 reduce 数；使单个 reduce 任务处理数据量大小要合适。</p></li></ul></li></ol><blockquote><h3 id="并行执行"><a href="#并行执行" class="headerlink" title="并行执行"></a>并行执行</h3></blockquote><p>Hive 会将一个查询转化成一个或者多个阶段。这样的阶段可以是 MapReduce 阶段、抽样阶段、合并阶段、limit 阶段。或者 Hive 执行过程中可能需要的其他阶段。默认情况下，Hive 一次只会执行一个阶段。不过，某个特定的 job 可能包含众多的阶段，而这些阶段可能并非完全互相依赖的，也就是说有些阶段是可以并行执行的，这样可能使得整个 job 的执行时间缩短。不过，如果有更多的阶段可以并行执行，那么job可能就越快完成。</p><p>通过设置参数 <code>hive.exec.parallel=true</code>，就可以开启并发执行。不过，在共享集群中，需要注意下，如果 job 中并行阶段增多，那么集群利用率就会增加。</p>]]></content>
      
      
      <categories>
          
          <category> 教程笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 大数据 </tag>
            
            <tag> 面试题 </tag>
            
            <tag> Hive </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Kafka 面试题解析</title>
      <link href="post/89cabcb1.html"/>
      <url>post/89cabcb1.html</url>
      
        <content type="html"><![CDATA[<blockquote><h3 id="请说明什么是-Apache-Kafka？"><a href="#请说明什么是-Apache-Kafka？" class="headerlink" title="请说明什么是 Apache Kafka？"></a>请说明什么是 Apache Kafka？</h3></blockquote><p>Apache Kafka 是由 Apache 开发的一种发布订阅消息系统，它是一个分布式的、分区的和重复的日志服务。</p><blockquote><h3 id="请说明什么是传统的消息传递方法？"><a href="#请说明什么是传统的消息传递方法？" class="headerlink" title="请说明什么是传统的消息传递方法？"></a>请说明什么是传统的消息传递方法？</h3></blockquote><p>传统的消息传递方法包括两种：</p><ul><li>队列：在队列中，一组用户可以从服务器中读取消息，每条消息都发送给其中一个人。</li><li>发布-订阅：在这个模型中，消息被广播给所有的用户。</li></ul><blockquote><h3 id="Kafka-都有哪些特点？"><a href="#Kafka-都有哪些特点？" class="headerlink" title="Kafka 都有哪些特点？"></a>Kafka 都有哪些特点？</h3></blockquote><ul><li>高吞吐量、低延迟：Kafka 每秒可以处理几十万条消息，它的延迟最低只有几毫秒，每个 topic 可以分多个 partition、consumer group 对 partition 进行 consume 操作。</li><li>可扩展性：Kafka 集群支持热扩展。</li><li>持久性、可靠性：消息被持久化到本地磁盘，并且支持数据备份防止数据丢失。</li><li>容错性：允许集群中节点失败（若副本数量为 n，则允许 n-1 个节点失败）。</li><li>高并发：支持数千个客户端同时读写。</li></ul><blockquote><h3 id="请说明-Kafka-相对于传统的消息传递方法有什么优势？"><a href="#请说明-Kafka-相对于传统的消息传递方法有什么优势？" class="headerlink" title="请说明 Kafka 相对于传统的消息传递方法有什么优势？"></a>请说明 Kafka 相对于传统的消息传递方法有什么优势？</h3></blockquote><ul><li>高性能：单一的 Kafka 代理可以处理成千上万的客户端，每秒处理数兆字节的读写操作，Kafka 性能远超过传统的 ActiveMQ、RabbitMQ 等，而且 Kafka 支持 Batch 操作；</li><li>可扩展：Kafka 集群可以透明的扩展，增加新的服务器进集群；</li><li>容错性：Kafka 每个 Partition 数据会复制到几台服务器，当某个 Broker 失效时，Zookeeper 将通知生产者和消费者从而使用其他的 Broker。</li></ul><blockquote><h3 id="请简述下你在哪些场景下会选择-Kafka？"><a href="#请简述下你在哪些场景下会选择-Kafka？" class="headerlink" title="请简述下你在哪些场景下会选择 Kafka？"></a>请简述下你在哪些场景下会选择 Kafka？</h3></blockquote><ul><li>日志收集：一个公司可以用 Kafka 收集各种服务的 log，通过 Kafka 以统一接口服务的方式开放给各种 consumer，例如 Hadoop、HBase、Solr 等。</li><li>消息系统：解耦和生产者和消费者、缓存消息等。</li><li>用户活动跟踪：Kafka 经常被用来记录 web 用户或者 app 用户的各种活动，如浏览网页、搜索、点击等活动，这些活动信息被各个服务器发布到 Kafka 的 topic 中，然后订阅者通过订阅这些 topic 来做实时的监控分析，或者装载到 Hadoop、数据仓库中做离线分析和挖掘。</li><li>运营指标：Kafka 也经常用来记录运营监控数据，包括收集各种分布式应用的数据，生产各种操作的集中反馈，比如报警和报告。</li><li>流式处理：比如 Spark streaming 和 Flink。</li></ul><blockquote><h3 id="Kafka-服务器能接收到的最大信息是多少？"><a href="#Kafka-服务器能接收到的最大信息是多少？" class="headerlink" title="Kafka 服务器能接收到的最大信息是多少？"></a>Kafka 服务器能接收到的最大信息是多少？</h3></blockquote><p>Kafka 服务器可以接收到的消息的最大大小是 1000 000 字节。</p><blockquote><h3 id="Kafka-中的-ZooKeeper-是什么？Kafka-是否可以脱离-ZooKeeper-独立运行？"><a href="#Kafka-中的-ZooKeeper-是什么？Kafka-是否可以脱离-ZooKeeper-独立运行？" class="headerlink" title="Kafka 中的 ZooKeeper 是什么？Kafka 是否可以脱离 ZooKeeper 独立运行？"></a>Kafka 中的 ZooKeeper 是什么？Kafka 是否可以脱离 ZooKeeper 独立运行？</h3></blockquote><p>Zookeeper 是一个开放源码的、高性能的协调服务，它用于 Kafka 的分布式应用。</p><p>不可以，不可能越过 Zookeeper 直接联系 Kafka broker，一旦 Zookeeper 停止工作，它就不能服务客户端请求。</p><p>Zookeeper 主要用于在集群中不同节点之间进行通信，在 Kafka 中，它被用于提交偏移量，因此如果节点在任何情况下都失败了，它都可以从之前提交的偏移量中获取，除此之外，它还执行其他活动，如: <strong>Leader 检测</strong>、<strong>分布式同步</strong>、<strong>配置管理</strong>、<strong>识别新节点何时离开或连接</strong>、<strong>集群</strong>、<strong>节点实时状态</strong>等等。</p><blockquote><h3 id="Kafka-的设计架构？"><a href="#Kafka-的设计架构？" class="headerlink" title="Kafka 的设计架构？"></a>Kafka 的设计架构？</h3></blockquote><ul><li>简单架构</li></ul><p><img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="/images/post/bigdata_interview/kafka_simple.png" alt></p><ul><li>详细架构如下：</li></ul><p><img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="/images/post/bigdata_interview/kafka_architecture.png" alt></p><p>Kafka 架构分为以下几个部分：</p><ul><li>Producer：消息生产者，就是向 Kafka broker 发消息的客户端。</li><li>Consumer：消息消费者，向 Kafka broker 取消息的客户端。</li><li>Topic：可以理解为一个队列，一个 Topic 又分为一个或多个分区。</li><li>Consumer Group：这是 Kafka 用来实现一个 topic 消息的广播（发给所有的 consumer）和单播（发给任意一个 consumer）的手段。一个 topic 可以有多个 Consumer Group。</li><li>Broker：一台 Kafka 服务器就是一个 broker。一个集群由多个 broker 组成。一个 broker 可以容纳多个 topic。</li><li>Partition：为了实现扩展性，一个非常大的 topic 可以分布到多个 broker上，每个 partition 是一个有序的队列。partition 中的每条消息都会被分配一个有序的 id（offset）。将消息发给 consumer，Kafka 只保证按一个 partition 中的消息的顺序，不保证一个 topic 的整体（多个 partition 间）的顺序。</li><li>Offset：Kafka 的存储文件都是按照 <code>offset.kafka</code> 来命名，用 offset 做名字的好处是方便查找。例如你想找位于 2049 的位置，只要找到 <code>2048.kafka</code> 的文件即可。当然 the first offset 就是 <code>00000000000.kafka</code>。</li></ul><blockquote><h3 id="解释-Kafka-的用户如何消费信息？"><a href="#解释-Kafka-的用户如何消费信息？" class="headerlink" title="解释 Kafka 的用户如何消费信息？"></a>解释 Kafka 的用户如何消费信息？</h3></blockquote><p>在 Kafka 中传递消息是通过使用 sendfile API 完成的。它支持将字节 Socket 转移到磁盘，通过内核空间保存副本，并在内核用户之间调用内核。</p><blockquote><h3 id="解释如何提高远程用户的吞吐量？"><a href="#解释如何提高远程用户的吞吐量？" class="headerlink" title="解释如何提高远程用户的吞吐量？"></a>解释如何提高远程用户的吞吐量？</h3></blockquote><p>如果用户位于与 broker 不同的数据中心，则可能需要调优 Socket 缓冲区大小，以对长网络延迟进行摊销。</p><blockquote><h3 id="解释一下，在数据制作过程中，你如何能从-Kafka-得到准确的信息？"><a href="#解释一下，在数据制作过程中，你如何能从-Kafka-得到准确的信息？" class="headerlink" title="解释一下，在数据制作过程中，你如何能从 Kafka 得到准确的信息？"></a>解释一下，在数据制作过程中，你如何能从 Kafka 得到准确的信息？</h3></blockquote><p>在数据中，为了精确地获得 Kafka 的消息，你必须遵循两件事：在数据消耗期间避免重复，在数据生产过程中避免重复。</p><p>这里有两种方法，可以在数据生成时准确地获得一个语义:</p><ul><li>每个分区使用一个单独的写入器，每当你发现一个网络错误，检查该分区中的最后一条消息，以查看您的最后一次写入是否成功。</li><li>在消息中包含一个主键(UUID 或其他)，并在用户中进行反复制。</li></ul><blockquote><h3 id="Kafka-为什么需要复制？"><a href="#Kafka-为什么需要复制？" class="headerlink" title="Kafka 为什么需要复制？"></a>Kafka 为什么需要复制？</h3></blockquote><p>Kafka 的信息复制确保了任何已发布的消息不会丢失，并且可以在机器错误、程序错误或更常见些的软件升级中使用。</p><blockquote><h3 id="Kafka-分区的目的？"><a href="#Kafka-分区的目的？" class="headerlink" title="Kafka 分区的目的？"></a>Kafka 分区的目的？</h3></blockquote><p>分区对于 Kafka 集群的好处是：实现负载均衡。分区对于消费者来说，可以提高并发度，提高效率。</p><blockquote><h3 id="Kafka-是如何做到消息的有序性？"><a href="#Kafka-是如何做到消息的有序性？" class="headerlink" title="Kafka 是如何做到消息的有序性？"></a>Kafka 是如何做到消息的有序性？</h3></blockquote><p>kafka 中的每个 partition 中的消息在写入时都是有序的，而且单独一个 partition 只能由一个消费者去消费，可以在里面保证消息的顺序性。但是分区之间的消息是不保证有序的。</p><blockquote><h3 id="Kafka-的高可靠性是怎么实现的？"><a href="#Kafka-的高可靠性是怎么实现的？" class="headerlink" title="Kafka 的高可靠性是怎么实现的？"></a>Kafka 的高可靠性是怎么实现的？</h3></blockquote><p>可回答：Kafka 在什么情况下会出现消息丢失？</p><blockquote><p><strong>数据可靠性（可回答 怎么尽可能保证 Kafka 的可靠性？）</strong></p></blockquote><p>Kafka 作为一个商业级消息中间件，消息可靠性的重要性可想而知。本文从 Producer 往 Broker 发送消息、Topic 分区副本以及 Leader 选举几个角度介绍数据的可靠性。</p><ul><li><p>Topic 分区副本</p><p>在 Kafka 0.8.0 之前，Kafka 是没有副本的概念的，那时候人们只会用 Kafka 存储一些不重要的数据，因为没有副本，数据很可能会丢失。但是随着业务的发展，支持副本的功能越来越强烈，所以为了保证数据的可靠性，Kafka 从 0.8.0 版本开始引入了分区副本（详情请参见 KAFKA-50）。也就是说每个分区可以人为的配置几个副本（比如创建主题的时候指定 <code>replication-factor</code>，也可以在 Broker 级别进行配置 <code>default.replication.factor</code>），一般会设置为 3。</p><p>Kafka 可以保证单个分区里的事件是有序的，分区可以在线（可用），也可以离线（不可用）。在众多的分区副本里面有一个副本是 Leader，其余的副本是 Follower，所有的读写操作都是经过 Leader 进行的，同时 Follower 会定期地去 Leader 上的复制数据。当 Leader 挂了的时候，其中一个 Follower 会重新成为新的 Leader。通过分区副本，引入了数据冗余，同时也提供了 Kafka 的数据可靠性。</p><p>Kafka 的分区多副本架构是 Kafka 可靠性保证的核心，把消息写入多个副本可以使 Kafka 在发生崩溃时仍能保证消息的持久性。</p></li><li><p>Producer 往 Broker 发送消息</p><p>如果我们要往 Kafka 对应的主题发送消息，我们需要通过 Producer 完成。前面我们讲过 Kafka 主题对应了多个分区，每个分区下面又对应了多个副本；为了让用户设置数据可靠性，Kafka 在 Producer 里面提供了消息确认机制。也就是说我们可以通过配置来决定消息发送到对应分区的几个副本才算消息发送成功。可以在定义 Producer 时通过 <code>acks</code> 参数指定（在 0.8.2.X 版本之前是通过 <code>request.required.acks</code> 参数设置的）。</p><p>这个参数支持以下三种值：</p><ul><li><p><code>acks = 0</code>：意味着如果生产者能够通过网络把消息发送出去，那么就认为消息已成功写入 Kafka。在这种情况下还是有可能发生错误，比如发送的对象无能被序列化或者网卡发生故障，但如果是分区离线或整个集群长时间不可用，那就不会收到任何错误。在 <code>acks = 0</code> 模式下的运行速度是非常快的（这就是为什么很多基准测试都是基于这个模式），你可以得到惊人的吞吐量和带宽利用率，不过如果选择了这种模式，一定会丢失一些消息。</p></li><li><p><code>acks = 1</code>：意味若 Leader 在收到消息并把它写入到分区数据文件（不一定同步到磁盘上）时会返回确认或错误响应。在这个模式下，如果发生正常的 Leader 选举，生产者会在选举时收到一个 <code>LeaderNotAvailableException</code> 异常，如果生产者能恰当地处理这个错误，它会重试发送悄息，最终消息会安全到达新的 Leader 那里。不过在这个模式下仍然有可能丢失数据，比如消息已经成功写入 Leader，但在消息被复制到 Follower 副本之前 Leader 发生崩溃。</p></li><li><p><code>acks = all</code>（这个和 <code>request.required.acks=-1</code> 含义一样）：意味着 Leader 在返回确认或错误响应之前，会等待所有同步副本都收到悄息。如果和 <code>min.insync.replicas</code> 参数结合起来，就可以决定在返回确认前至少有多少个副本能够收到悄息，生产者会一直重试直到消息被成功提交。不过这也是最慢的做法，因为生产者在继续发送其他消息之前需要等待所有副本都收到当前的消息。</p></li></ul><p>根据实际的应用场景，我们设置不同的 <code>acks</code>，以此保证数据的可靠性。</p><p>另外，Producer 发送消息还可以选择同步（默认，通过 <code>producer.type=sync</code> 配置） 或者异步（<code>producer.type=async</code>）模式。如果设置成异步，虽然会极大的提高消息发送的性能，但是这样会增加丢失数据的风险。如果需要确保消息的可靠性，必须将 <code>producer.type</code> 设置为 <code>sync</code>。</p></li><li><p>Leader 选举</p><p>在介绍 Leader 选举之前，让我们先来了解一下 ISR（in-sync replicas）列表。每个分区的 Leader 会维护一个 ISR 列表，ISR 列表里面就是 Follower 副本的 Broker 编号，只有跟得上 Leader 的 Follower 副本才能加入到 ISR 里面，这个是通过 <code>replica.lag.time.max.ms</code> 参数配置的。只有 ISR 里的成员才有被选为 Leader 的可能。</p></li></ul><blockquote><p><strong>数据一致性（可回答 Kafka 数据一致性原理？）</strong></p></blockquote><p>这里介绍的数据一致性主要是说不论是老的 Leader 还是新选举的 Leader，Consumer 都能读到一样的数据。那么 Kafka 是如何实现的呢？</p><p><img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="/images/post/bigdata_interview/kafka_highwatermark.png" alt></p><p>假设分区的副本为 3，其中副本 0 是 Leader，副本 1 和副本 2 是 Follower，并且在 ISR 列表里面。虽然副本 0 已经写入了 Message4，但是 Consumer 只能读取到 Message2。因为所有的 ISR 都同步了 Message2，只有 High Water Mark 以上的消息才支持 Consumer 读取，而 High Water Mark 取决于 ISR 列表里面偏移量最小的分区，对应于上图的副本 2，这个很类似于木桶原理。</p><p>这样做的原因是还没有被足够多副本复制的消息被认为是“不安全”的，如果 Leader 发生崩溃，另一个副本成为新 Leader，那么这些消息很可能丢失了。如果我们允许消费者读取这些消息，可能就会破坏一致性。试想，一个消费者从当前 Leader（副本 0）读取并处理了 Message4，这个时候 Leader 挂掉了，选举了副本 1 为新的 Leader，这时候另一个消费者再去从新的 Leader 读取消息，发现这个消息其实并不存在，这就导致了数据不一致性问题。</p><p>当然，引入了 High Water Mark 机制，会导致 Broker 间的消息复制因为某些原因变慢，那么消息到达消费者的时间也会随之变长（因为我们会先等待消息复制完毕）。延迟时间可以通过参数 <code>replica.lag.time.max.ms</code> 参数配置，它指定了副本在复制消息时可被允许的最大延迟时间。</p><blockquote><h3 id="ISR、OSR、AR-是什么？"><a href="#ISR、OSR、AR-是什么？" class="headerlink" title="ISR、OSR、AR 是什么？"></a>ISR、OSR、AR 是什么？</h3></blockquote><ul><li>ISR：In-Sync Replicas 副本同步队列</li><li>OSR：Out-of-Sync Replicas</li><li>AR：Assigned Replicas 所有副本</li></ul><p><code>AR = ISR + OSR</code></p><p>ISR 是由 Leader 维护，Follower 从 Leader 同步数据有一些延迟（具体可以参见 Kafka 的副本复制机制），超过相应的阈值会把 Follower 剔除出 ISR，存入 OSR（Out-of-Sync Replicas）列表，新加入的 Follower 也会先存放在 OSR 中。</p><blockquote><h3 id="解释如何减少-ISR-中的扰动？broker-什么时候离开-ISR？"><a href="#解释如何减少-ISR-中的扰动？broker-什么时候离开-ISR？" class="headerlink" title="解释如何减少 ISR 中的扰动？broker 什么时候离开 ISR？"></a>解释如何减少 ISR 中的扰动？broker 什么时候离开 ISR？</h3></blockquote><p>ISR 是一组与 Leader 完全同步的消息副本，也就是说 ISR 中包含了所有提交的消息。ISR 应该总是包含所有的副本，直到出现真正的故障。如果一个副本从 Leader 中脱离出来，将会从 ISR 中删除。</p><blockquote><h3 id="如果副本在-ISR-中停留了很长时间表明什么？"><a href="#如果副本在-ISR-中停留了很长时间表明什么？" class="headerlink" title="如果副本在 ISR 中停留了很长时间表明什么？"></a>如果副本在 ISR 中停留了很长时间表明什么？</h3></blockquote><p>如果一个副本在 ISR 中保留了很长一段时间，那么它就表明，跟踪器无法像在 Leader 收集数据那样快速地获取数据。</p><blockquote><h3 id="请说明如果首选的副本不在-ISR-中会发生什么？"><a href="#请说明如果首选的副本不在-ISR-中会发生什么？" class="headerlink" title="请说明如果首选的副本不在 ISR 中会发生什么？"></a>请说明如果首选的副本不在 ISR 中会发生什么？</h3></blockquote><p>如果首选的副本不在 ISR 中，控制器将无法将 leadership 转移到首选的副本。</p><blockquote><h3 id="LEO、HW、LSO、LW-等分别代表什么？"><a href="#LEO、HW、LSO、LW-等分别代表什么？" class="headerlink" title="LEO、HW、LSO、LW 等分别代表什么？"></a>LEO、HW、LSO、LW 等分别代表什么？</h3></blockquote><ul><li>LEO：是 LogEndOffset 的简称，代表当前日志文件中下一条。</li><li>HW：水位或水印（watermark）一词，也可称为高水位（high watermark），通常被用在流式处理领域（比如 Apache Flink、Apache Spark 等），以表征元素或事件在基于时间层面上的进度。在 Kafka 中，水位的概念反而与时间无关，而是与位置信息相关。严格来说，它表示的就是位置信息，即位移（offset）。取 partition 对应的 ISR 中最小的 LEO 作为 HW，consumer 最多只能消费到 HW 所在的位置上一条信息。</li><li>LSO：是 LastStableOffset 的简称，对未完成的事务而言，LSO 的值等于事务中第一条消息的位置（firstUnstableOffset），对已完成的事务而言，它的值同 HW 相同。</li><li>LW：Low Watermark 低水位，代表 AR 集合中最小的 logStartOffset 值。</li></ul><blockquote><h3 id="数据传输的事务有几种？-请说明-Kafka-的消息投递保证（delivery-guarantee）机制以及如何实现？"><a href="#数据传输的事务有几种？-请说明-Kafka-的消息投递保证（delivery-guarantee）机制以及如何实现？" class="headerlink" title="数据传输的事务有几种？ / 请说明 Kafka 的消息投递保证（delivery guarantee）机制以及如何实现？"></a>数据传输的事务有几种？ / 请说明 Kafka 的消息投递保证（delivery guarantee）机制以及如何实现？</h3></blockquote><p>数据传输的事务定义通常有以下三种级别：/ Kafka 支持三种消息投递语义：</p><ul><li>最多一次（At most once）：消息不会被重复发送，最多被传输一次，但也有可能一次不传输；</li><li>最少一次（At least one）：消息不会被漏发送，最少被传输一次，但也有可能被重复传输；</li><li>精确的一次（Exactly once）：不会漏传输也不会重复传输，每个消息都传输被接收。</li></ul><p>consumer 在从 broker 读取消息后，可以选择 commit，该操作会在 Zookeeper 中存下该 consumer 在该 partition 下读取的消息的 offset，该 consumer 下一次再读该 partition 时会从下一条开始读取。如未 commit，下一次读取的开始位置会跟上一次 commit 之后的开始位置相同。</p><p>可以将 consumer 设置为 autocommit，即 consumer 一旦读到数据立即自动 commit。如果只讨论这一读取消息的过程，那 Kafka 是确保了 Exactly once。但实际上实际使用中 consumer 并非读取完数据就结束了，而是要进行进一步处理，而数据处理与 commit 的顺序在很大程度上决定了消息从 broker 和 consumer 的 delivery guarantee semantic。</p><p>读完消息先 commit 再处理消息。这种模式下，如果 consumer 在 commit 后还没来得及处理消息就 crash 了，下次重新开始工作后就无法读到刚刚已提交而未处理的消息，这就对应于At most once。</p><p>读完消息先处理再 commit 消费状态（保存 offset）。这种模式下，如果在处理完消息之后 commit 之前 Consumer crash 了，下次重新开始工作时还会处理刚刚未 commit 的消息，实际上该消息已经被处理过了，这就对应于 At least once。</p><p>如果一定要做到 Exactly once，就需要协调 offset 和实际操作的输出。经典的做法是引入两阶段提交，但由于许多输出系统不支持两阶段提交，更为通用的方式是将 offset 和操作输入存在同一个地方。比如，consumer 拿到数据后可能把数据放到 HDFS，如果把最新的 offset 和数据本身一起写到 HDFS，那就可以保证数据的输出和 offset 的更新要么都完成，要么都不完成，间接实现 Exactly once。（目前就 high level API 而言，offset 是存于 Zookeeper 中的，无法存于 HDFS，而 low level API 的 offset 是由自己去维护的，可以将之存于 HDFS 中）。</p><p>总之，Kafka 默认保证 At least once，并且允许通过设置 producer 异步提交来实现 At most once，而 Exactly once 要求与目标存储系统协作，Kafka 提供的 offset 可以较为容易地实现这种方式。</p><blockquote><h3 id="Kafka-有可能在生产后发生消息偏移吗？"><a href="#Kafka-有可能在生产后发生消息偏移吗？" class="headerlink" title="Kafka 有可能在生产后发生消息偏移吗？"></a>Kafka 有可能在生产后发生消息偏移吗？</h3></blockquote><p>在大多数队列系统中，作为生产者的类无法做到这一点，它的作用是触发并忘记消息。broker 将完成剩下的工作，比如使用 id 进行适当的元数据处理、偏移量等。</p><p>作为消息的用户，你可以从 Kafka broker 中获得补偿。如果你注视 <code>SimpleConsumer</code> 类，你会注意到它会获取包括偏移量作为列表的 <code>MultiFetchResponse</code> 对象。此外，当你对 Kafka 消息进行迭代时，你会拥有包括偏移量和消息发送的 <code>MessageAndOffset</code> 对象。</p><blockquote><h3 id="Kafka-消费者是否可以消费指定分区消息？"><a href="#Kafka-消费者是否可以消费指定分区消息？" class="headerlink" title="Kafka 消费者是否可以消费指定分区消息？"></a>Kafka 消费者是否可以消费指定分区消息？</h3></blockquote><p>Kafka consumer 消费消息时，向 broker 发出 fetch 请求去消费特定分区的消息，consumer 指定消息在日志中的偏移量（offset），就可以消费从这个位置开始的消息，customer 拥有了 offset 的控制权，可以向后回滚去重新消费之前的消息，这是很有意义的。</p><blockquote><h3 id="Kafka-消息是采用-Pull-模式，还是-Push-模式？"><a href="#Kafka-消息是采用-Pull-模式，还是-Push-模式？" class="headerlink" title="Kafka 消息是采用 Pull 模式，还是 Push 模式？"></a>Kafka 消息是采用 Pull 模式，还是 Push 模式？</h3></blockquote><p>Kafka 最初考虑的问题是，customer 应该从 brokers 拉取消息还是 brokers 将消息推送到 consumer，也就是 pull 还是 push。在这方面，Kafka 遵循了一种大部分消息系统共同的传统的设计：producer 将消息推送到 broker，consumer 从 broker 拉取消息。</p><p>一些消息系统比如 Scribe 和 Apache Flume 采用了 push 模式，将消息推送到下游的 consumer。这样做有好处也有坏处：由 broker 决定消息推送的速率，对于不同消费速率的 consumer 就不太好处理了。消息系统都致力于让 consumer 以最大的速率最快速的消费消息，但不幸的是，push 模式下，当 broker 推送的速率远大于 consumer 消费的速率时，consumer 恐怕就要崩溃了。最终 Kafka 还是选取了传统的 pull 模式。</p><p>Pull 模式的另外一个好处是 consumer 可以自主决定是否批量的从 broker 拉取数据。Push 模式必须在不知道下游 consumer 消费能力和消费策略的情况下决定是立即推送每条消息还是缓存之后批量推送。如果为了避免 consumer 崩溃而采用较低的推送速率，将可能导致一次只推送较少的消息而造成浪费。Pull 模式下，consumer 就可以根据自己的消费能力去决定这些策略。 Pull 有个缺点是，如果 broker 没有可供消费的消息，将导致 consumer 不断在循环中轮询，直到新消息到达。为了避免这点，Kafka 有个参数可以让 consumer 阻塞知道新消息到达（当然也可以阻塞知道消息的数量达到某个特定的量这样就可以批量发送）。</p><blockquote><h3 id="Kafka-高效文件存储设计特点？"><a href="#Kafka-高效文件存储设计特点？" class="headerlink" title="Kafka 高效文件存储设计特点？"></a>Kafka 高效文件存储设计特点？</h3></blockquote><ul><li>Kafka 把 topic 中一个 partition 大文件分成多个小文件段，通过多个小文件段，就容易定期清除或删除已经消费完文件，减少磁盘占用。</li><li>通过索引信息可以快速定位 message 和确定 response 的最大大小。</li><li>通过 index 元数据全部映射到 memory，可以避免 segment file 的 IO 磁盘操作。</li><li>通过索引文件稀疏存储，可以大幅降低 index 文件元数据占用空间大小。</li></ul><blockquote><h3 id="Kafka-创建-Topic-时如何将分区放置到不同的-Broker-中？"><a href="#Kafka-创建-Topic-时如何将分区放置到不同的-Broker-中？" class="headerlink" title="Kafka 创建 Topic 时如何将分区放置到不同的 Broker 中？"></a>Kafka 创建 Topic 时如何将分区放置到不同的 Broker 中？</h3></blockquote><ul><li>副本因子不能大于 Broker 的个数。</li><li>第一个分区（编号为 0）的第一个副本放置位置是随机从 brokerList 选择的。</li><li>其他分区的第一个副本放置位置相对于第 0 个分区依次往后移。也就是如果我们有 5 个 Broker，5 个分区，假设第一个分区放在第四个 Broker 上，那么第二个分区将会放在第五个 Broker 上；第三个分区将会放在第一个 Broker 上；第四个分区将会放在第二个 Broker 上，依次类推。</li><li>剩余的副本相对于第一个副本放置位置其实是由 nextReplicaShift 决定的，而这个数也是随机产生的。</li></ul><blockquote><h3 id="Kafka-新建的分区会在哪个目录下创建？"><a href="#Kafka-新建的分区会在哪个目录下创建？" class="headerlink" title="Kafka 新建的分区会在哪个目录下创建？"></a>Kafka 新建的分区会在哪个目录下创建？</h3></blockquote><p>我们知道，在启动 Kafka 集群之前，我们需要配置好 <code>log.dirs</code> 参数，其值是 Kafka 数据的存放目录，这个参数可以配置多个目录，目录之间使用逗号分隔，通常这些目录是分布在不同的磁盘上用于提高读写性能。当然我们也可以配置 <code>log.dir</code> 参数，含义一样。只需要设置其中一个即可。</p><p>如果 <code>log.dirs</code> 参数只配置了一个目录，那么分配到各个 Broker 上的分区肯定只能在这个目录下创建文件夹用于存放数据。</p><p>但是如果 <code>log.dirs</code> 参数配置了多个目录，那么 Kafka 会在哪个文件夹中创建分区目录呢？</p><p>答案是：Kafka 会在含有分区目录最少的文件夹中创建新的分区目录，分区目录名为 “Topic 名 + 分区 ID”。注意，是分区文件夹总数最少的目录，而不是磁盘使用量最少的目录！也就是说，如果你给 <code>log.dirs</code> 参数新增了一个新的磁盘，新的分区目录肯定是先在这个新的磁盘上创建直到这个新的磁盘目录拥有的分区目录不是最少为止。</p><blockquote><h3 id="谈一谈-Kafka-的再均衡？"><a href="#谈一谈-Kafka-的再均衡？" class="headerlink" title="谈一谈 Kafka 的再均衡？"></a>谈一谈 Kafka 的再均衡？</h3></blockquote><p>在 Kafka 中，当有新消费者加入或者订阅的 topic 数发生变化时，会触发 Rebalance（再均衡：在同一个消费者组当中，分区的所有权从一个消费者转移到另外一个消费者）机制，Rebalance 顾名思义就是重新均衡消费者消费。Rebalance 的过程如下：</p><ol><li>第一步：所有成员都向 Coordinator 发送请求，请求入组。一旦所有成员都发送了请求，Coordinator 会从中选择一个 consumer 担任 Leader 的角色，并把组成员信息以及订阅信息发给 Leader。</li><li>第二步：Leader 开始分配消费方案，指明具体哪个 consumer 负责消费哪些 topic 的哪些 partition。一旦完成分配，Leader 会将这个方案发给 Coordinator。Coordinator 接收到分配方案之后会把方案发给各个 consumer，这样组内的所有成员就都知道自己应该消费哪些分区了。</li></ol><p>所以对于 Rebalance 来说，Coordinator 起着至关重要的作用。</p><blockquote><h3 id="Kafka分区分配策略"><a href="#Kafka分区分配策略" class="headerlink" title="Kafka分区分配策略"></a>Kafka分区分配策略</h3></blockquote><p><img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="/images/post/bigdata_interview/kafka_partition.png" alt></p><p>在 Kafka 内部存在两种默认的分区分配策略：Range 和 RoundRobin。当以下事件发生时，Kafka 将会进行一次分区分配：</p><ul><li>同一个 Consumer Group 内新增消费者。</li><li>消费者离开当前所属的 Consumer Group，包括 shuts down 或 crashes。</li><li>订阅的主题新增分区。</li></ul><p>将分区的所有权从一个消费者移到另一个消费者称为重新平衡（Rebalance），如何 Rebalance 就涉及到下面提到的分区分配策略。下面我们将详细介绍 Kafka 内置的两种分区分配策略。本文假设我们有个名为 T1 的主题，其包含了 10 个分区，然后我们有两个消费者（C1，C2）来消费这 10 个分区里面的数据，而且 C1 的 <code>num.streams = 1</code>，C2 的 <code>num.streams = 2</code>。</p><p><strong>Range strategy</strong></p><p>Range 策略是对每个主题而言的，首先对同一个主题里面的分区按照序号进行排序，并对消费者按照字母顺序进行排序。在我们的例子里面，排完序的分区将会是 <code>0, 1, 2, 3, 4, 5, 6, 7, 8, 9</code>；消费者线程排完序将会是 <code>C1-0, C2-0, C2-1</code>。然后将 partitions 的个数除于消费者线程的总数来决定每个消费者线程消费几个分区。如果除不尽，那么前面几个消费者线程将会多消费一个分区。</p><p>在我们的例子里面，我们有 10 个分区，3 个消费者线程，10/3 = 3，而且除不尽，那么消费者线程 C1-0 将会多消费一个分区，所以最后分区分配的结果看起来是这样的：</p><ul><li>C1-0 将消费 0, 1, 2, 3 分区</li><li>C2-0 将消费 4, 5, 6 分区</li><li>C2-1 将消费 7, 8, 9 分区</li></ul><p>假如我们有 11 个分区，那么最后分区分配的结果看起来是这样的：</p><ul><li>C1-0 将消费 0, 1, 2, 3 分区</li><li>C2-0 将消费 4, 5, 6, 7 分区</li><li>C2-1 将消费 8, 9, 10 分区</li></ul><p>假如我们有 2 个主题（T1 和 T2），分别有 10 个分区，那么最后分区分配的结果看起来是这样的：</p><ul><li>C1-0 将消费 T1 主题的 0, 1, 2, 3 分区以及 T2 主题的 0, 1, 2, 3 分区</li><li>C2-0 将消费 T1 主题的 4, 5, 6 分区以及 T2 主题的 4, 5, 6 分区</li><li>C2-1 将消费 T1 主题的 7, 8, 9 分区以及 T2 主题的 7, 8, 9 分区</li></ul><p>可以看出，C1-0 消费者线程比其他消费者线程多消费了 2 个分区，这就是 Range strategy 的一个很明显的弊端。</p><p><strong>RoundRobin strategy</strong></p><p>使用 RoundRobin 策略有两个前提条件必须满足：</p><ul><li>同一个 Consumer Group 里面的所有消费者的 <code>num.streams</code>必须相等；</li><li>每个消费者订阅的主题必须相同。</li></ul><p>所以这里假设前面提到的 2 个消费者的 <code>num.streams = 2</code>。</p><p>RoundRobin 策略的工作原理：将所有主题的分区组成 TopicAndPartition 列表，然后对 TopicAndPartition 列表按照 hashCode 进行排序，这里文字可能说不清，看下面的代码应该会明白：</p><p><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala"><span class="token keyword">val</span> allTopicPartitions <span class="token operator">=</span> ctx<span class="token punctuation">.</span>partitionsForTopic<span class="token punctuation">.</span>flatMap <span class="token punctuation">&#123;</span>    <span class="token keyword">case</span><span class="token punctuation">(</span>topic<span class="token punctuation">,</span> partitions<span class="token punctuation">)</span> <span class="token keyword">=></span> info<span class="token punctuation">(</span><span class="token string">"Consumer %s rebalancing the following partitions for topic %s: %s"</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span>ctx<span class="token punctuation">.</span>consumerId<span class="token punctuation">,</span> topic<span class="token punctuation">,</span> partitions<span class="token punctuation">)</span><span class="token punctuation">)</span>    partitions<span class="token punctuation">.</span>map<span class="token punctuation">(</span>partition <span class="token keyword">=></span> <span class="token punctuation">&#123;</span>        TopicAndPartition<span class="token punctuation">(</span>topic<span class="token punctuation">,</span> partition<span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">.</span>toSeq<span class="token punctuation">.</span>sortWith<span class="token punctuation">(</span><span class="token punctuation">(</span>topicPartition1<span class="token punctuation">,</span> topicPartition2<span class="token punctuation">)</span> <span class="token keyword">=></span> <span class="token punctuation">&#123;</span>    <span class="token comment">/*    * Randomize the order by taking the hashcode to reduce the likelihood of all partitions of a given topic ending    * up on one consumer (if it has a high enough stream count).    */</span>    topicPartition1<span class="token punctuation">.</span>toString<span class="token punctuation">.</span>hashCode <span class="token operator">&lt;</span> topicPartition2<span class="token punctuation">.</span>toString<span class="token punctuation">.</span>hashCode<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p>最后按照 round-robin 风格将分区分别分配给不同的消费者线程。</p><p>在我们的例子里面，假如按照 hashCode 排序完的 topic-partitions 组依次为 T1-5, T1-3, T1-0, T1-8, T1-2, T1-1, T1-4, T1-7, T1-6, T1-9，我们的消费者线程排序为 C1-0, C1-1, C2-0, C2-1，最后分区分配的结果为：</p><ul><li>C1-0 将消费 T1-5, T1-2, T1-6 分区；</li><li>C1-1 将消费 T1-3, T1-1, T1-9 分区；</li><li>C2-0 将消费 T1-0, T1-4 分区；</li><li>C2-1 将消费 T1-8, T1-7 分区。</li></ul><p>多个主题的分区分配和单个主题类似。</p><blockquote><h3 id="Kafka-是如何实现高吞吐率的？"><a href="#Kafka-是如何实现高吞吐率的？" class="headerlink" title="Kafka 是如何实现高吞吐率的？"></a>Kafka 是如何实现高吞吐率的？</h3></blockquote><p>Kafka 是分布式消息系统，需要处理海量的消息，Kafka 的设计是把所有的消息都写入速度低容量大的硬盘，以此来换取更强的存储能力，但实际上，使用硬盘并没有带来过多的性能损失。kafka 主要使用了以下几个方式实现了超高的吞吐率：</p><ul><li>顺序读写</li><li>零拷贝</li><li>文件分段</li><li>批量发送</li><li>数据压缩</li></ul><blockquote><h3 id="Kafka-缺点？"><a href="#Kafka-缺点？" class="headerlink" title="Kafka 缺点？"></a>Kafka 缺点？</h3></blockquote><ul><li>由于是批量发送，数据并非真正的实时；</li><li>对于 mqtt 协议不支持；</li><li>不支持物联网传感数据直接接入；</li><li>仅支持统一分区内消息有序，无法实现全局消息有序；</li><li>监控不完善，需要安装插件；</li><li>依赖 Zookeeper 进行元数据管理。</li></ul><blockquote><h3 id="Kafka-新旧消费者的区别？"><a href="#Kafka-新旧消费者的区别？" class="headerlink" title="Kafka 新旧消费者的区别？"></a>Kafka 新旧消费者的区别？</h3></blockquote><p>旧的 Kafka 消费者 API 主要包括：SimpleConsumer（简单消费者） 和 ZookeeperConsumerConnector（高级消费者）。SimpleConsumer 名字看起来是简单消费者，但是其实用起来很不简单，可以使用它从特定的分区和偏移量开始读取消息。高级消费者和现在新的消费者有点像，有消费者群组，有分区再均衡，不过它使用 ZK 来管理消费者群组，并不具备偏移量和再均衡的可操控性。</p><p>现在的消费者同时支持以上两种行为，所以为啥还用旧消费者 API 呢？</p><blockquote><h3 id="Kafka-分区数可以增加或减少吗？为什么？"><a href="#Kafka-分区数可以增加或减少吗？为什么？" class="headerlink" title="Kafka 分区数可以增加或减少吗？为什么？"></a>Kafka 分区数可以增加或减少吗？为什么？</h3></blockquote><p>我们可以使用 <code>bin/kafka-topics.sh</code> 命令对 Kafka 增加 Kafka 的分区数据，但是 Kafka 不支持减少分区数。Kafka 分区数据不支持减少是由很多原因的，比如减少的分区其数据放到哪里去？是删除，还是保留？删除的话，那么这些没消费的消息不就丢了。如果保留这些消息如何放到其他分区里面？追加到其他分区后面的话那么就破坏了 Kafka 单个分区的有序性。如果要保证删除分区数据插入到其他分区保证有序性，那么实现起来逻辑就会非常复杂。</p>]]></content>
      
      
      <categories>
          
          <category> 教程笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 大数据 </tag>
            
            <tag> 面试题 </tag>
            
            <tag> Kafka </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Flume 面试题解析</title>
      <link href="post/5a2a12a6.html"/>
      <url>post/5a2a12a6.html</url>
      
        <content type="html"><![CDATA[<blockquote><h3 id="Flume-使用场景？"><a href="#Flume-使用场景？" class="headerlink" title="Flume 使用场景？"></a>Flume 使用场景？</h3></blockquote><p>线上数据一般主要是落地（存储到磁盘）或者通过 socket 传输给另外一个系统，这种情况下，你很难推动线上应用或服务去修改接口，实现直接向 Kafka 里写数据，这时候你可能就需要 Flume 这样的系统帮你去做传输。</p><blockquote><h3 id="Flume-丢包问题？"><a href="#Flume-丢包问题？" class="headerlink" title="Flume 丢包问题？"></a>Flume 丢包问题？</h3></blockquote><p>单机 upd 的 Flume source 的配置，100+M/s 数据量，10w qps Flume 就开始大量丢包，因此很多公司在搭建系统时，抛弃了 Flume，自己研发传输系统，但是往往会参考 Flume 的 Source-Channel-Sink 模式。</p><p>一些公司在 Flume 工作过程中，会对业务日志进行监控，例如 Flume agent 中有多少条日志，Flume 到 Kafka 后有多少条日志等等，如果数据丢失保持在 1% 左右是没有问题的，当数据丢失达到 5% 左右时就必须采取相应措施。</p><blockquote><h3 id="Flume-与-Kafka-的选取？"><a href="#Flume-与-Kafka-的选取？" class="headerlink" title="Flume 与 Kafka 的选取？"></a>Flume 与 Kafka 的选取？</h3></blockquote><p>采集层主要可以使用 Flume、Kafka 两种技术。</p><ul><li>Flume：Flume 是管道流方式，提供了很多的默认实现，让用户通过参数部署，及扩展 API。</li><li>Kafka：Kafka 是一个可持久化的分布式的消息队列。</li></ul><p>Kafka 是一个非常通用的系统。你可以有许多生产者和很多的消费者共享多个主题 Topics。相比之下，Flume 是一个专用工具被设计为旨在往 HDFS，HBase 发送数据。它对 HDFS 有特殊的优化，并且集成了 Hadoop 的安全特性。所以，Cloudera 建议如果数据被多个系统消费的话，使用 Kafka；如果数据被设计给 Hadoop 使用，使用 Flume。</p><p>正如你们所知 Flume 内置很多的 source 和 sink 组件。然而，Kafka 明显有一个更小的生产消费者生态系统，并且 Kafka 的社区支持不好。希望将来这种情况会得到改善，但是目前：使用 Kafka 意味着你准备好了编写你自己的生产者和消费者代码。如果已经存在的 Flume Sources 和 Sinks 满足你的需求，并且你更喜欢不需要任何开发的系统，请使用 Flume。</p><p>Flume 可以使用拦截器实时处理数据。这些对数据屏蔽或者过量是很有用的。Kafka 需要外部的流处理系统才能做到。</p><p>Kafka 和 Flume 都是可靠的系统，通过适当的配置能保证零数据丢失。然而，Flume 不支持副本事件。于是，如果 Flume 代理的一个节点奔溃了，即使使用了可靠的文件管道方式，你也将丢失这些事件直到你恢复这些磁盘。如果你需要一个高可靠性的管道，那么使用Kafka是个更好的选择。</p><p>Flume 和 Kafka 可以很好地结合起来使用。如果你的设计需要从 Kafka 到 Hadoop 的流数据，使用 Flume 代理并配置 Kafka 的 Source 读取数据也是可行的：你没有必要实现自己的消费者。你可以直接利用 Flume 与 HDFS 及 HBase 的结合的所有好处。你可以使用 Cloudera Manager 对消费者的监控，并且你甚至可以添加拦截器进行一些流处理。</p><blockquote><h3 id="数据怎么采集到-Kafka，实现方式？"><a href="#数据怎么采集到-Kafka，实现方式？" class="headerlink" title="数据怎么采集到 Kafka，实现方式？"></a>数据怎么采集到 Kafka，实现方式？</h3></blockquote><p>使用官方提供的 FlumeKafka 插件，插件的实现方式是自定义了 Flume 的 sink，将数据从 channel 中取出，通过 Kafka 的 producer 写入到 Kafka 中，可以自定义分区等。</p><blockquote><h3 id="Flume-管道内存，Flume-宕机了数据丢失怎么解决？"><a href="#Flume-管道内存，Flume-宕机了数据丢失怎么解决？" class="headerlink" title="Flume 管道内存，Flume 宕机了数据丢失怎么解决？"></a>Flume 管道内存，Flume 宕机了数据丢失怎么解决？</h3></blockquote><ul><li>Flume 的 channel 分为很多种，可以将数据写入到文件。</li><li>防止非首个 agent 宕机的方法可以做集群或者主备。</li></ul><blockquote><h3 id="Flume-配置方式，Flume-集群？"><a href="#Flume-配置方式，Flume-集群？" class="headerlink" title="Flume 配置方式，Flume 集群？"></a>Flume 配置方式，Flume 集群？</h3></blockquote><p>Flume 的配置围绕着 source、channel、sink 叙述，Flume 的集群是做在 agent 上的，而非机器上。</p><blockquote><h3 id="Flume-不采集-Nginx-日志，通过-Logger4j-采集日志，优缺点是什么？"><a href="#Flume-不采集-Nginx-日志，通过-Logger4j-采集日志，优缺点是什么？" class="headerlink" title="Flume 不采集 Nginx 日志，通过 Logger4j 采集日志，优缺点是什么？"></a>Flume 不采集 Nginx 日志，通过 Logger4j 采集日志，优缺点是什么？</h3></blockquote><ul><li>优点：Nginx 的日志格式是固定的，但是缺少 sessionId，通过 logger4j 采集的日志是带有 sessionId 的，而 session 可以通过 redis 共享，保证了集群日志中的同一 session 落到不同的 tomcat 时，sessionId 还是一样的，而且 logger4j 的方式比较稳定，不会宕机。</li><li>缺点：不够灵活，logger4j 的方式和项目结合过于紧密，而 Flume 的方式比较灵活，拔插式比较好，不会影响项目性能。</li></ul><blockquote><h3 id="Flume-和-Kafka-采集日志区别，采集日志时中间停了，怎么记录之前的日志？"><a href="#Flume-和-Kafka-采集日志区别，采集日志时中间停了，怎么记录之前的日志？" class="headerlink" title="Flume 和 Kafka 采集日志区别，采集日志时中间停了，怎么记录之前的日志？"></a>Flume 和 Kafka 采集日志区别，采集日志时中间停了，怎么记录之前的日志？</h3></blockquote><ul><li>Flume 采集日志是通过流的方式直接将日志收集到存储层，而 Kafka 是将缓存在 Kafka 集群，待后期可以采集到存储层。</li><li>Flume 采集中间停了，可以采用文件的方式记录之前的日志，而 Kafka 是采用 offset 的方式记录之前的日志。</li></ul><blockquote><h3 id="Flume-有哪些组件，Flume-的-source、channel、sink-具体是做什么的？"><a href="#Flume-有哪些组件，Flume-的-source、channel、sink-具体是做什么的？" class="headerlink" title="Flume 有哪些组件，Flume 的 source、channel、sink 具体是做什么的？"></a>Flume 有哪些组件，Flume 的 source、channel、sink 具体是做什么的？</h3></blockquote><ul><li>source：用于采集数据，Source 是产生数据流的地方，同时 Source 会将产生的数据流传输到 Channel，这个有点类似于 Java IO 部分的 Channel。</li><li>channel：用于桥接 Sources 和 Sinks，类似于一个队列。</li><li>sink：从 Channel 收集数据，将数据写到目标源（可以是下一个 Source，也可以是 HDFS 或者 HBase）。</li></ul><p><strong>注意：</strong>要熟悉source、channel、sink的类型</p><p>单一结构：</p><p><img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="/images/post/bigdata_interview/flume_module.png" alt></p><p>复杂架构：</p><p><img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="/images/post/bigdata_interview/flume_multi_module.png" alt></p>]]></content>
      
      
      <categories>
          
          <category> 教程笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 大数据 </tag>
            
            <tag> 面试题 </tag>
            
            <tag> Flume </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Zookeeper 面试题解析</title>
      <link href="post/2f1ea7f2.html"/>
      <url>post/2f1ea7f2.html</url>
      
        <content type="html"><![CDATA[<blockquote><h3 id="请简述-Zookeeper-的选举机制？"><a href="#请简述-Zookeeper-的选举机制？" class="headerlink" title="请简述 Zookeeper 的选举机制？"></a>请简述 Zookeeper 的选举机制？</h3></blockquote><p>假设有五台服务器组成的 Zookeeper 集群，它们的 id 从 1-5，同时它们都是最新启动的，也就是没有历史数据，在存放数据量这一点上，都是一样的。假设这些服务器依序启动，来看看会发生什么。</p><p><img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="/images/post/bigdata_interview/zookeeper_leader.png" alt></p><ol><li>服务器 1 启动，此时只有它一台服务器启动了，它发出去的报没有任何响应，所以它的选举状态一直是 <code>LOOKING</code> 状态；</li><li>服务器 2 启动，它与最开始启动的服务器 1 进行通信，互相交换自己的选举结果，由于两者都没有历史数据，所以 id 值较大的服务器 2 胜出，但是由于没有达到超过半数以上的服务器都同意选举它(这个例子中的半数以上是 3)，所以服务器 1、2 还是继续保持 <code>LOOKING</code> 状态；</li><li>服务器 3 启动，根据前面的理论分析，服务器 3 成为服务器 1、2、3 中的 <code>Leader</code>，而与上面不同的是，此时有三台服务器选举了它，所以它成为了这次选举的 <code>Leader</code>；</li><li>服务器 4 启动，根据前面的分析，理论上服务器 4 应该是服务器 1、2、3、4 中最大的，但是由于前面已经有半数以上的服务器选举了服务器 3，所以它成为 <code>Follower</code>；</li><li>服务器 5 启动，同 4 一样成为 <code>Follower</code>。</li></ol><p><strong>注意：</strong>如果按照 5，4，3，2，1 的顺序启动，那么 5 将成为 <code>Leader</code>，因为在满足半数条件后，ZooKeeper 集群启动，5 的 Id 最大，被选举为 <code>Leader</code>。</p><blockquote><h3 id="客户端如何正确处理-CONNECTIONLOSS-连接断开-和-SESSIONEXPIRED-Session-过期-两类连接异常？"><a href="#客户端如何正确处理-CONNECTIONLOSS-连接断开-和-SESSIONEXPIRED-Session-过期-两类连接异常？" class="headerlink" title="客户端如何正确处理 CONNECTIONLOSS(连接断开) 和 SESSIONEXPIRED(Session 过期) 两类连接异常？"></a>客户端如何正确处理 CONNECTIONLOSS(连接断开) 和 SESSIONEXPIRED(Session 过期) 两类连接异常？</h3></blockquote><p>在 ZooKeeper 中，服务器和客户端之间维持的是一个长连接，在 SESSION_TIMEOUT 时间内，服务器会确定客户端是否正常连接（客户端会定时向服务器发送 heart_beat），服务器重置下次 SESSION_TIMEOUT 时间。因此，在正常情况下，Session 一直有效，并且 ZK 集群所有机器上都保存这个 Session 信息。在出现问题的情况下，客户端与服务器之间连接断了（客户端所连接的那台 ZK 机器挂了，或是其它原因的网络闪断），这个时候客户端会主动在地址列表（初始化的时候传入构造方法的那个参数 connectString）中选择新的地址进行连接。</p><p>以上即为服务器与客户端之间维持长连接的过程，在这个过程中，用户可能会看到两类异常 CONNECTIONLOSS（连接断开） 和 SESSIONEXPIRED（Session 过期）。</p><p>发生 CONNECTIONLOSS 后，此时用户不需要关心我的会话是否可用，应用所要做的就是等待客户端帮我们自动连接上新的 ZK 机器，一旦成功连接上新的 ZK 机器后，确认之前的操作是否执行成功了。</p><blockquote><h3 id="一个客户端修改了某个节点的数据，其他客户端能够马上获取到这个最新数据吗？"><a href="#一个客户端修改了某个节点的数据，其他客户端能够马上获取到这个最新数据吗？" class="headerlink" title="一个客户端修改了某个节点的数据，其他客户端能够马上获取到这个最新数据吗？"></a>一个客户端修改了某个节点的数据，其他客户端能够马上获取到这个最新数据吗？</h3></blockquote><p>ZooKeeper 不能确保任何客户端能够获取（即 Read Request）到一样的数据，除非客户端自己要求，方法是客户端在获取数据之前调用 <code>org.apache.zookeeper.AsyncCallback.VoidCallback, java.lang.Object) sync</code>。</p><ul><li>通常情况下（这里所说的通常情况满足：1. 对获取的数据是否是最新版本不敏感，2. 一个客户端修改了数据，其它客户端是否需要立即能够获取最新数据），可以不关心这点。</li><li>在其它情况下，最清晰的场景是这样：ZK 客户端 A 对 <code>/my_test</code> 的内容从 v1-&gt;v2, 但是 ZK 客户端 B 对 <code>/my_test</code> 的内容获取，依然得到的是 v1。请注意，这个是实际存在的现象，当然延时很短。解决的方法是客户端 B 先调用 <code>sync()</code>, 再调用 <code>getData()</code>。</li></ul><blockquote><h3 id="ZooKeeper-对节点的-watch-监听是永久的吗？为什么？"><a href="#ZooKeeper-对节点的-watch-监听是永久的吗？为什么？" class="headerlink" title="ZooKeeper 对节点的 watch 监听是永久的吗？为什么？"></a>ZooKeeper 对节点的 watch 监听是永久的吗？为什么？</h3></blockquote><p>不是。</p><p>官方声明：一个 Watch 事件是一个一次性的触发器，当被设置了 Watch 的数据发生了改变的时候，则服务器将这个改变发送给设置了 Watch 的客户端，以便通知它们。</p><p>为什么不是永久的，举个例子，如果服务端变动频繁，而监听的客户端很多情况下，每次变动都要通知到所有的客户端，这太消耗性能了。</p><p>一般是客户端执行 <code>getData(&quot;/节点A&quot;,true)</code>，如果节点 A 发生了变更或删除，客户端会得到它的 watch 事件，但是在之后节点 A 又发生了变更，而客户端又没有设置 watch 事件，就不再给客户端发送。</p><p>在实际应用中，很多情况下，我们的客户端不需要知道服务端的每一次变动，我只要最新的数据即可。</p><blockquote><h3 id="ZooKeeper-中使用-watch-的注意事项有哪些？"><a href="#ZooKeeper-中使用-watch-的注意事项有哪些？" class="headerlink" title="ZooKeeper 中使用 watch 的注意事项有哪些？"></a>ZooKeeper 中使用 watch 的注意事项有哪些？</h3></blockquote><p>使用 watch 需要注意的几点：</p><ul><li>Watches 通知是一次性的，必须重复注册。</li><li>发生 CONNECTIONLOSS 之后，只要在 session_timeout 之内再次连接上（即不发生 SESSIONEXPIRED），那么这个连接注册的 watches 依然在。</li><li>节点数据的版本变化会触发 NodeDataChanged，注意，这里特意说明了是版本变化。存在这样的情况，只要成功执行了 <code>setData()</code> 方法，无论内容是否和之前一致，都会触发 NodeDataChanged。</li><li>对某个节点注册了 watch，但是节点被删除了，那么注册在这个节点上的 watches 都会被移除。</li><li>同一个 ZK 客户端对某一个节点注册相同的 watch，只会收到一次通知。</li><li>Watcher 对象只会保存在客户端，不会传递到服务端。</li></ul><blockquote><h3 id="能否收到每次节点变化的通知？"><a href="#能否收到每次节点变化的通知？" class="headerlink" title="能否收到每次节点变化的通知？"></a>能否收到每次节点变化的通知？</h3></blockquote><p>如果节点数据的更新频率很高的话，不能。</p><p>原因在于：当一次数据修改，通知客户端，客户端再次注册 watch，在这个过程中，可能数据已经发生了许多次数据修改，因此，千万不要做这样的测试：“数据被修改了 n 次，一定会收到 n 次通知”来测试 server 是否正常工作。</p><blockquote><h3 id="能否为临时节点创建子节点？"><a href="#能否为临时节点创建子节点？" class="headerlink" title="能否为临时节点创建子节点？"></a>能否为临时节点创建子节点？</h3></blockquote><p>ZooKeeper 中不能为临时节点创建子节点，如果需要创建子节点，应该将要创建子节点的节点创建为永久性节点。</p><blockquote><h3 id="是否可以拒绝单个-IP-对-ZooKeeper-的访问？"><a href="#是否可以拒绝单个-IP-对-ZooKeeper-的访问？" class="headerlink" title="是否可以拒绝单个 IP 对 ZooKeeper 的访问？"></a>是否可以拒绝单个 IP 对 ZooKeeper 的访问？</h3></blockquote><p>如何实现？ZK 本身不提供这样的功能，它仅仅提供了对单个 IP 的连接数的限制。你可以通过修改 iptables 来实现对单个 ip 的限制。</p><blockquote><h3 id="创建的临时节点什么时候会被删除，是连接一断就删除吗？"><a href="#创建的临时节点什么时候会被删除，是连接一断就删除吗？" class="headerlink" title="创建的临时节点什么时候会被删除，是连接一断就删除吗？"></a>创建的临时节点什么时候会被删除，是连接一断就删除吗？</h3></blockquote><p>延时是多少？连接断了之后，ZK 不会马上移除临时数据，只有当 SESSIONEXPIRED 之后，才会把这个会话建立的临时数据移除。因此，用户需要谨慎设置 Session_TimeOut。</p><blockquote><h3 id="ZooKeeper-是否支持动态进行机器扩容？如果目前不支持，那么要如何扩容呢？"><a href="#ZooKeeper-是否支持动态进行机器扩容？如果目前不支持，那么要如何扩容呢？" class="headerlink" title="ZooKeeper 是否支持动态进行机器扩容？如果目前不支持，那么要如何扩容呢？"></a>ZooKeeper 是否支持动态进行机器扩容？如果目前不支持，那么要如何扩容呢？</h3></blockquote><p>ZooKeeper 中的动态扩容其实就是水平扩容，Zookeeper 对这方面的支持不太好，目前有两种方式：</p><ul><li>全部重启：关闭所有 Zookeeper 服务，修改配置之后启动，不影响之前客户端的会话。</li><li>逐个重启：这是比较常用的方式。</li></ul><blockquote><h3 id="ZooKeeper-集群中服务器之间是怎样通信的？"><a href="#ZooKeeper-集群中服务器之间是怎样通信的？" class="headerlink" title="ZooKeeper 集群中服务器之间是怎样通信的？"></a>ZooKeeper 集群中服务器之间是怎样通信的？</h3></blockquote><p>Leader 服务器会和每一个 Follower/Observer 服务器都建立 TCP 连接，同时为每个 F/O 都创建一个叫做 LearnerHandler 的实体。LearnerHandler 主要负责 Leader 和 F/O 之间的网络通讯，包括数据同步，请求转发和 Proposal 提议的投票等。Leader 服务器保存了所有 F/O 的 LearnerHandler。</p><blockquote><h3 id="ZooKeeper-是否会自动进行日志清理？"><a href="#ZooKeeper-是否会自动进行日志清理？" class="headerlink" title="ZooKeeper 是否会自动进行日志清理？"></a>ZooKeeper 是否会自动进行日志清理？</h3></blockquote><p>如何进行日志清理？ZK 自己不会进行日志清理，需要运维人员进行日志清理。</p><blockquote><h3 id="谈谈你对-ZooKeeper-的理解？"><a href="#谈谈你对-ZooKeeper-的理解？" class="headerlink" title="谈谈你对 ZooKeeper 的理解？"></a>谈谈你对 ZooKeeper 的理解？</h3></blockquote><ul><li><p>Zookeeper 作为一个分布式的服务框架，主要用来解决分布式集群中应用系统的一致性问题。ZooKeeper 提供的服务包括：<strong>分布式消息同步和协调机制</strong>、<strong>服务器节点动态上下线</strong>、<strong>统一配置管理</strong>、<strong>负载均衡</strong>、<strong>集群管理</strong>等。</p></li><li><p>ZooKeeper 提供基于类似于 Linux 文件系统的目录节点树方式的数据存储，即分层命名空间。Zookeeper 并不是用来专门存储数据的，它的作用主要是用来维护和监控你存储的数据的状态变化，通过监控这些数据状态的变化，从而可以达到基于数据的集群管理，ZooKeeper 节点的数据上限是 1MB。</p></li><li><p>我们可以认为 Zookeeper = 文件系统 + 通知机制，对于 ZooKeeper 的数据结构，每个子目录项如 NameService 都被称作为 znode，这个 znode 是被它所在的路径唯一标识，如 Server1 这个 znode 的标识为 <code>/NameService/Server1</code>；</p></li><li><p>znode 可以有子节点目录，并且每个 znode 可以存储数据，注意 <code>EPHEMERAL</code> 类型的目录节点不能有子节点目录(因为它是临时节点)；</p></li><li><p>znode 是有版本的，每个 znode 中存储的数据可以有多个版本，也就是一个访问路径中可以存储多份数据；</p></li><li><p>znode 可以是临时节点，一旦创建这个 znode 的客户端与服务器失去联系，这个 znode 也将自动删除，Zookeeper 的客户端和服务器通信采用长连接方式，每个客户端和服务器通过心跳来保持连接，这个连接状态称为 session，如果 znode 是临时节点，这个 session 失效，znode 也就删除了；</p></li><li><p>znode 的目录名可以自动编号，如 App1 已经存在，再创建的话，将会自动命名为 App2；</p></li><li><p>znode 可以被监控，包括这个目录节点中存储的数据的修改，子节点目录的变化等，一旦变化可以通知设置监控的客户端，这个是 Zookeeper 的核心特性，Zookeeper 的很多功能都是基于这个特性实现的，后面在典型的应用场景中会有实例介绍。</p></li></ul><blockquote><h3 id="ZooKeeper-节点类型？"><a href="#ZooKeeper-节点类型？" class="headerlink" title="ZooKeeper 节点类型？"></a>ZooKeeper 节点类型？</h3></blockquote><ol><li>znode 有两种类型：<ul><li>短暂（ephemeral）：客户端和服务器端断开连接后，创建的节点自己删除。</li><li>持久（persistent）：客户端和服务器端断开连接后，创建的节点不删除。</li></ul></li><li>znode 有四种形式的目录节点（默认是 persistent）<ul><li>持久化目录节点（PERSISTENT）客户端与 Zookeeper 断开连接后，该节点依旧存在。<ul><li>持久化顺序编号目录节点（PERSISTENT_SEQUENTIAL） 客户端与 Zookeeper 断开连接后，该节点依旧存在，只是 Zookeeper 给该节点名称进行顺序编号。</li><li>临时目录节点（EPHEMERAL） 客户端与 Zookeeper 断开连接后，该节点被删除。</li><li>临时顺序编号目录节点（EPHEMERAL_SEQUENTIAL）客户端与 Zookeeper 断开连接后，该节点被删除，只是 Zookeeper 给该节点名称进行顺序编号。</li></ul></li></ul></li></ol><blockquote><h3 id="请说明-ZooKeeper-的通知机制？"><a href="#请说明-ZooKeeper-的通知机制？" class="headerlink" title="请说明 ZooKeeper 的通知机制？"></a>请说明 ZooKeeper 的通知机制？</h3></blockquote><p>ZooKeeper 选择了基于通知（notification）的机制，即：客户端向 ZooKeeper 注册需要接受通知的 znode，通过 znode 设置监控点（watch）来接受通知。监视点是一个单次触发的操作，意即监视点会触发一个通知。为了接收多个通知，客户端必须在每次通知后设置一个新的监视点。在下图阐述的情况下，当节点/task 发生变化时，客户端会受到一个通知，并从 ZooKeeper 读取一个新值。</p><p><img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="/images/post/bigdata_interview/zookeeper_notification.png" alt></p><blockquote><h3 id="ZooKeeper-的监听原理是什么？"><a href="#ZooKeeper-的监听原理是什么？" class="headerlink" title="ZooKeeper 的监听原理是什么？"></a>ZooKeeper 的监听原理是什么？</h3></blockquote><p>在应用程序中，<code>main()</code> 方法首先会创建 zkClient，创建 zkClient 的同时就会产生两个进程，即 <code>Listener</code> 进程（监听进程）和 <code>connect</code> 进程（网络连接/传输进程），当 zkClient 调用 <code>getChildren()</code> 等方法注册监视器时，<code>connect</code> 进程向 ZooKeeper 注册监听器，注册后的监听器位于 ZooKeeper 的监听器列表中，监听器列表中记录了 zkClient 的 IP，端口号以及要监控的路径，一旦目标文件发生变化，ZooKeeper 就会把这条消息发送给对应的 zkClient 的 <code>Listener()</code> 进程，<code>Listener</code> 进程接收到后，就会执行 <code>process()</code> 方法，在 <code>process()</code> 方法中针对发生的事件进行处理。</p><p><img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="/images/post/bigdata_interview/zookeeper_listener.png" alt></p><blockquote><h3 id="请说明-ZooKeeper-使用到的各个端口的作用？"><a href="#请说明-ZooKeeper-使用到的各个端口的作用？" class="headerlink" title="请说明 ZooKeeper 使用到的各个端口的作用？"></a>请说明 ZooKeeper 使用到的各个端口的作用？</h3></blockquote><ul><li><code>2888</code>：Follower 与 Leader 交换信息的端口。</li><li><code>3888</code>：万一集群中的 Leader 服务器挂了，需要一个端口来重新进行选举，选出一个新的 Leader，而这个端口就是用来执行选举时服务器相互通信的端口。</li></ul><blockquote><h3 id="ZooKeeper-的部署方式有哪几种？集群中的角色有哪些？集群最少需要几台机器？"><a href="#ZooKeeper-的部署方式有哪几种？集群中的角色有哪些？集群最少需要几台机器？" class="headerlink" title="ZooKeeper 的部署方式有哪几种？集群中的角色有哪些？集群最少需要几台机器？"></a>ZooKeeper 的部署方式有哪几种？集群中的角色有哪些？集群最少需要几台机器？</h3></blockquote><p>ZooKeeper 的部署方式有<strong>单机模式</strong>和<strong>集群模式</strong>，集群中的角色有 Leader 和 Follower，集群最少 3（2N+1）台，根据选举算法，应保证奇数。</p><blockquote><h3 id="ZooKeeper-集群如果有-3-台机器，挂掉一台是否还能工作？挂掉两台呢？"><a href="#ZooKeeper-集群如果有-3-台机器，挂掉一台是否还能工作？挂掉两台呢？" class="headerlink" title="ZooKeeper 集群如果有 3 台机器，挂掉一台是否还能工作？挂掉两台呢？"></a>ZooKeeper 集群如果有 3 台机器，挂掉一台是否还能工作？挂掉两台呢？</h3></blockquote><p>对于ZooKeeper集群，过半存活即可使用。</p><blockquote><h3 id="ZooKeeper-使用的-ZAB-协议与-Paxo-算法的异同？"><a href="#ZooKeeper-使用的-ZAB-协议与-Paxo-算法的异同？" class="headerlink" title="ZooKeeper 使用的 ZAB 协议与 Paxo 算法的异同？"></a>ZooKeeper 使用的 ZAB 协议与 Paxo 算法的异同？</h3></blockquote><p>Paxos 算法是分布式选举算法，Zookeeper 使用的ZAB协议（Zookeeper 原子广播），两者的异同如下：</p><ul><li><p>相同之处：</p><p>比如都有一个 Leader，用来协调 N 个 Follower 的运行；Leader 要等待超半数的 Follower 做出正确反馈之后才进行提案；二者都有一个值来代表 Leader 的周期。</p></li><li><p>不同之处：</p><p>ZAB 用来构建高可用的分布式数据主备系统（Zookeeper），Paxos 是用来构建分布式一致性状态机系统。</p></li></ul><blockquote><h3 id="请谈谈对-ZooKeeper-对事务性的支持？"><a href="#请谈谈对-ZooKeeper-对事务性的支持？" class="headerlink" title="请谈谈对 ZooKeeper 对事务性的支持？"></a>请谈谈对 ZooKeeper 对事务性的支持？</h3></blockquote><p>ZooKeeper 对于事务性的支持主要依赖于四个函数，<code>zoo_create_op_init</code>，<code>zoo_delete_op_init</code>，<code>zoo_set_op_init</code> 以及 <code>zoo_check_op_init</code>。</p><p>每一个函数都会在客户端初始化一个 <code>operation</code>，客户端程序有义务保留这些<code>operations</code>。当准备好一个事务中的所有操作后，可以使用 <code>zoo_multi</code> 来提交所有的操作，由 Zookeeper 服务来保证这一系列操作的原子性。也就是说只要其中有一个操作失败了，相当于此次提交的任何一个操作都没有对服务端的数据造成影响。<code>zoo_multi</code> 的返回值是第一个失败操作的状态信号。</p>]]></content>
      
      
      <categories>
          
          <category> 教程笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 大数据 </tag>
            
            <tag> 面试题 </tag>
            
            <tag> Zookeeper </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hadoop 面试题解析</title>
      <link href="post/2b822834.html"/>
      <url>post/2b822834.html</url>
      
        <content type="html"><![CDATA[<h2 id="Hadoop-基础"><a href="#Hadoop-基础" class="headerlink" title="Hadoop 基础"></a>Hadoop 基础</h2><blockquote><h3 id="集群的最主要瓶颈？"><a href="#集群的最主要瓶颈？" class="headerlink" title="集群的最主要瓶颈？"></a>集群的最主要瓶颈？</h3></blockquote><p>磁盘 IO。</p><blockquote><h3 id="Hadoop-运行模式？"><a href="#Hadoop-运行模式？" class="headerlink" title="Hadoop 运行模式？"></a>Hadoop 运行模式？</h3></blockquote><ul><li>独立（本地）运行模式：无需任何守护进程，所有的程序都运行在同一个 JVM 上执行。在独立模式下调试 MR 程序非常高效方便。所以一般该模式主要是在学习或者开发阶段调试使用。</li><li>伪分布式模式：Hadoop 守护进程运行在本地机器上，模拟一个小规模的集群，换句话说，可以配置一台机器的 Hadoop 集群，伪分布式是完全分布式的一个特例。</li><li>完全分布式模式：Hadoop 守护进程运行在一个集群上。</li></ul><p><strong>注意：</strong>所谓分布式要启动守护进程，即：使用分布式 Hadoop 时，要先启动一些准备程序进程，然后才能使用比如 <code>start-dfs.sh</code>、<code>start-yarn.sh</code>。而本地模式不需要启动这些守护进程。</p><p>三种模式的集群必须配置信息：</p><p>下面详细分析配置三种模式的“集群”所需要的必须配置。可以配置完，体验一把，就可以主观地感受三种之间的区别。</p><div class="table-container"><table><thead><tr><th>组件名称</th><th>属性名称</th><th>本地模式</th><th>伪分布式</th><th>完全分布式</th></tr></thead><tbody><tr><td>Common</td><td>fs.defaultFs</td><td>file:///(默认)</td><td>hdfs://localhost/</td><td>hdfs://namenode</td></tr><tr><td>HDFS</td><td>dfs.replication</td><td>N/A</td><td>1</td><td>3(默认)</td></tr><tr><td>MapReduce</td><td>mapreduce.framework.name</td><td>local(默认)</td><td>yarn</td><td>yarn</td></tr><tr><td>Yarn</td><td>yarn.resoucemanager.hostname <br> yarn.nodemanager.auxservice</td><td>N/A <br> N/A</td><td>localhost <br> mapreduce_shuffle</td><td>resoucemanager <br> maperduce_shuffle</td></tr></tbody></table></div><p><strong>注意：</strong>在本地模式下，将使用本地文件系统和本地 MapReduce 运行器。在分布式模式下，将启动 HDFS 和 YARN 守护进程。</p><blockquote><h3 id="Hadoop-生态圈的组件并做简要描述？"><a href="#Hadoop-生态圈的组件并做简要描述？" class="headerlink" title="Hadoop 生态圈的组件并做简要描述？"></a>Hadoop 生态圈的组件并做简要描述？</h3></blockquote><ul><li>Zookeeper：是一个开源的分布式应用程序协调服务，基于 Zookeeper 可以实现同步服务，配置维护，命名服务。</li><li>Flume：一个高可用的，高可靠的，分布式的海量日志采集、聚合和传输的系统。</li><li>Hbase：是一个分布式的、面向列的开源数据库，利用 Hadoop HDFS 作为其存储系统。</li><li>Hive：基于 Hadoop 的一个数据仓库工具，可以将结构化的数据档映射为一张数据库表，并提供简单的 SQL 查询功能，可以将 SQL 语句转换为 MapReduce 任务进行运行。</li><li>Sqoop：将一个关系型数据库中的数据导进到 Hadoop 的 HDFS 中，也可以将 HDFS 的数据导进到关系型数据库中。</li></ul><blockquote><h3 id="解释“Hadoop”和“Hadoop-生态系统”两个概念？"><a href="#解释“Hadoop”和“Hadoop-生态系统”两个概念？" class="headerlink" title="解释“Hadoop”和“Hadoop 生态系统”两个概念？"></a>解释“Hadoop”和“Hadoop 生态系统”两个概念？</h3></blockquote><p>Hadoop 是指 Hadoop 框架本身；Hadoop 生态系统，不仅包含 Hadoop，还包括保证 Hadoop 框架正常高效运行其他框架，比如 Zookeeper、Flume、Hbase、Hive、Sqoop 等辅助框架。</p><blockquote><h3 id="请列出正常工作的-Hadoop-集群中-Hadoop-都分别需要启动哪些进程，它们的作用分别是什么？"><a href="#请列出正常工作的-Hadoop-集群中-Hadoop-都分别需要启动哪些进程，它们的作用分别是什么？" class="headerlink" title="请列出正常工作的 Hadoop 集群中 Hadoop 都分别需要启动哪些进程，它们的作用分别是什么？"></a>请列出正常工作的 Hadoop 集群中 Hadoop 都分别需要启动哪些进程，它们的作用分别是什么？</h3></blockquote><ul><li>NameNode：它是 Hadoop 中的主服务器，管理文件系统名称空间和对集群中存储的文件的访问，保存有 metadate。</li><li>SecondaryNameNode：它不是 NameNode 的冗余守护进程，而是提供周期检查点和清理任务。帮助 NameNode 合并 editslog，减少 NameNode 启动时间。</li><li>DataNode：它负责管理连接到节点的存储（一个集群中可以有多个节点）。每个存储数据的节点运行一个 DataNode 守护进程。</li><li>ResourceManager（JobTracker）：JobTracker 负责调度 DataNode 上的工作。每个 DataNode 有一个 TaskTracker，它们执行实际工作。</li><li>NodeManager（TaskTracker）：执行任务。</li><li>DFSZKFailoverController：高可用时它负责监控 NameNode 的状态，并及时的把状态信息写入 Zookeeper。它通过一个独立线程周期性的调用 NameNode 上的一个特定接口来获取 NameNode 的健康状态。FC 也有选择谁作为 Active NameNode 的权利，因为最多只有两个节点，目前选择策略还比较简单（先到先得，轮换）。</li><li>JournalNode：高可用情况下存放 NameNode 的 EditLog 文件。</li></ul><blockquote><h3 id="NameNode-在启动的时候会做哪些操作？"><a href="#NameNode-在启动的时候会做哪些操作？" class="headerlink" title="NameNode 在启动的时候会做哪些操作？"></a>NameNode 在启动的时候会做哪些操作？</h3></blockquote><p>NameNode 数据存储在内存和本地磁盘，本地磁盘数据存储在 fsimage 镜像文件和edits 编辑日志文件。</p><ul><li><p>首次启动 NameNode</p><ol><li>格式化文件系统，为了生成 fsimage 镜像文件；</li><li>启动 NameNode；<ol><li>读取 fsimage 文件，将文件内容加载进内存；</li><li>等待 DataNode 注册与发送 block report。</li></ol></li><li>启动 DataNode；<ol><li>向 NameNode 注册；</li><li>发送 block report；</li><li>检查 fsimage 中记录的块的数量和 block report 中的块的总数是否相同。</li></ol></li><li>对文件系统进行操作（创建目录，上传文件，删除文件等）。<ol><li>此时内存中已经有文件系统改变的信息，但是磁盘中没有文件系统改变的信息，此时会将这些改变信息写入 edits 文件中，edits 文件中存储的是文件系统元数据改变的信息。</li></ol></li></ol></li><li><p>第二次启动 NameNode</p><ol><li>读取 fsimage 和 edits 文件；</li><li>将 fsimage 和 edits 文件合并成新的 fsimage 文件；</li><li>创建新的 edits 文件，内容为空；</li><li>启动 DataNode。</li></ol></li></ul><blockquote><h3 id="DataNode-了解吗，它的工作机制是怎样的？"><a href="#DataNode-了解吗，它的工作机制是怎样的？" class="headerlink" title="DataNode 了解吗，它的工作机制是怎样的？"></a>DataNode 了解吗，它的工作机制是怎样的？</h3></blockquote><ol><li>一个数据块在 DataNode 上以文件形式存储在磁盘上，包括两个文件，一个是数据本身，一个是元数据包括数据块的长度，块数据的校验和，时间戳。</li><li>DataNode 启动后向 NameNode 进行注册，通过后，周期性（1 小时）地向NameNode 上报所有的块信息；</li><li>心跳每 3 秒一次，心跳返回结果带有 NameNode 给该 DataNode 的命令，如复制块数据到另一台机器，或删除某个数据块。如果超过 10 分钟没有收到某个 DataNode 的心跳，则认为该节点不可用；</li><li>集群运行中可以安全加入和退出一些机器。</li></ol><p><img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="/images/post/bigdata_interview/datanode.png" alt></p><blockquote><h3 id="Secondary-NameNode-了解吗，它的工作机制是怎样的？"><a href="#Secondary-NameNode-了解吗，它的工作机制是怎样的？" class="headerlink" title="Secondary NameNode 了解吗，它的工作机制是怎样的？"></a>Secondary NameNode 了解吗，它的工作机制是怎样的？</h3></blockquote><p>Secondary NameNode 目的是合并 NameNode 的 edit logs 到 fsimage 文件中，是减少 NameNode 启动时间，它的具体工作机制：</p><ol><li>第一阶段：NameNode启动<ol><li>第一次启动 NameNode 格式化后，创建 fsimage 和 edits 文件。如果不是第一次启动，直接加载编辑日志和镜像文件到内存；</li><li>客户端对元数据进行增删改的请求；</li><li>NameNode 记录操作日志，更新滚动日志；</li><li>NameNode 在内存中对数据进行增删改查。</li></ol></li><li>第二阶段：Secondary NameNode工作<ol><li>Secondary NameNode 询问 NameNode 是否需要 checkpoint。直接带回 NameNode 是否检查结果；</li><li>Secondary NameNode 请求执行 checkpoint；</li><li>NameNode 滚动正在写的 edits 日志</li><li>将滚动前的编辑日志和镜像文件拷贝到 Secondary NameNode；</li><li>Secondary NameNode 加载编辑日志和镜像文件到内存，并合并；</li><li>生成新的镜像文件 fsimage.chkpoint；</li><li>拷贝 fsimage.chkpoint 到 NameNode；</li><li>NameNode 将 fsimage.chkpoint 重新命名成 fsimage 所以如果 NameNode 中的元数据丢失，是可以从 Secondary NameNode 恢复一部分元数据信息的，但不是全部，因为 NameNode 正在写的 edits 日志还没有拷贝到 Secondary NameNode，这部分恢复不了。</li></ol></li></ol><p><img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="/images/post/bigdata_interview/namenode.png" alt></p><blockquote><h3 id="Secondary-NameNode-不能恢复-NameNode-的全部数据，那如何保证-NameNode-数据存储安全？"><a href="#Secondary-NameNode-不能恢复-NameNode-的全部数据，那如何保证-NameNode-数据存储安全？" class="headerlink" title="Secondary NameNode 不能恢复 NameNode 的全部数据，那如何保证 NameNode 数据存储安全？"></a>Secondary NameNode 不能恢复 NameNode 的全部数据，那如何保证 NameNode 数据存储安全？</h3></blockquote><p>这个问题就要说 NameNode 的高可用了，即 <strong>NameNode HA</strong> 一个 NameNode 有单点故障的问题，那就配置双 NameNode，配置有两个关键点，一是必须要保证这两个 NameNode 的元数据信息必须要同步的，二是一个 NameNode 挂掉之后另一个要立马补上。</p><ul><li><p>元数据信息同步在 HA 方案中采用的是“共享存储”。每次写文件时，需要将日志同步写入共享存储，这个步骤成功才能认定写文件成功。然后备份节点定期从共享存储同步日志，以便进行主备切换。</p></li><li><p>监控 NameNode 状态采用 Zookeeper，两个 NameNode 节点的状态存放在 Zookeeper 中，另外两个 NameNode 节点分别有一个进程监控程序，实施读取 Zookeeper 中有 NameNode 的状态，来判断当前的 NameNode 是不是已经 down 机。如果 standby 的 NameNode 节点的 ZKFC 发现主节点已经挂掉，那么就会强制给原本的 active  NameNode 节点发送强制关闭请求，之后将备用的 NameNode 设置为 active。</p></li></ul><p><strong>如果面试官再问 HA 中的共享存储是怎么实现的知道吗？</strong></p><p>可以进行解释下：NameNode 共享存储方案有很多，比如 Linux HA，VMware FT，QJM 等，目前社区已经把由 Cloudera 公司实现的基于 QJM（Quorum Journal Manager）的方案合并到 HDFS 的 trunk 之中并且作为<strong>默认的共享存储</strong>实现基于 QJM 的共享存储系统主要用于保存 EditLog，并不保存 FSImage 文件。FSImage 文件还是在 NameNode 的本地磁盘上。</p><p>QJM 共享存储的基本思想来自于 Paxos 算法，采用多个称为 JournalNode 的节点组成的 JournalNode 集群来存储 EditLog。每个 JournalNode 保存同样的 EditLog 副本。每次 NameNode 写 EditLog 的时候，除了向本地磁盘写入 EditLog 之外，也会并行地向 JournalNode 集群之中的每一个 JournalNode 发送写请求，只要大多数（majority）的 JournalNode 节点返回成功就认为向 JournalNode 集群写入 EditLog 成功。如果有 2N+1 台 JournalNode，那么根据大多数的原则，最多可以容忍有 N 台 JournalNode 节点挂掉。</p><blockquote><h3 id="在-NameNode-HA-中，会出现脑裂问题吗？怎么解决脑裂？"><a href="#在-NameNode-HA-中，会出现脑裂问题吗？怎么解决脑裂？" class="headerlink" title="在 NameNode HA 中，会出现脑裂问题吗？怎么解决脑裂？"></a>在 NameNode HA 中，会出现脑裂问题吗？怎么解决脑裂？</h3></blockquote><p>假设 NameNode1 当前为 Active 状态，NameNode2 当前为 Standby 状态。如果某一时刻 NameNode1 对应的 ZKFailoverController 进程发生了“假死”现象，那么 Zookeeper 服务端会认为 NameNode1 挂掉了，根据前面的主备切换逻辑，NameNode2 会替代 NameNode1 进入 Active 状态。但是此时 NameNode1 可能仍然处于 Active 状态正常运行，这样 NameNode1 和 NameNode2 都处于 Active 状态，都可以对外提供服务。这种情况称为脑裂。</p><p>脑裂对于 NameNode 这类对数据一致性要求非常高的系统来说是灾难性的，数据会发生错乱且无法恢复。Zookeeper 社区对这种问题的解决方法叫做 fencing，中文翻译为隔离，也就是想办法把旧的 Active NameNode 隔离起来，使它不能正常对外提供服务。在进行 fencing 的时候，会执行以下的操作：</p><ol><li>首先尝试调用这个旧 Active NameNode 的 HAServiceProtocol RPC 接口的 transitionToStandby 方法，看能不能把它转换为 Standby 状态。</li><li>如果 transitionToStandby 方法调用失败，那么就执行 Hadoop 配置文件之中预定义的隔离措施，Hadoop 目前主要提供两种隔离措施，通常会选择 sshfence：<ul><li>sshfence：通过 SSH 登录到目标机器上，执行命令 fuser 将对应的进程杀死；</li><li>shellfence：执行一个用户自定义的 shell 脚本来将对应的进程隔离。</li></ul></li></ol><p><img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="/images/post/bigdata_interview/ha_namenode.png" alt></p><p><strong>补充：ZKFailoverController 主要职责</strong></p><ul><li>健康监测：周期性的向它监控的 NameNode 发送健康探测命令，从而来确定某个 NameNode 是否处于健康状态，如果机器宕机，心跳失败，那么 ZKFC 就会标记它处于一个不健康的状态；</li><li>会话管理：如果 NameNode 是健康的，ZKFC 就会在 Zookeeper 中保持一个打开的会话，如果 NameNode 同时还是 Active 状态的，那么 ZKFC 还会在 Zookeeper中占有一个类型为短暂类型的 znode，当这个 NameNode 挂掉时，这个 znode 将会被删除，然后备用的 NameNode ，将会得到这把锁，升级为主 NameNode ，同时标记状态为 Active；</li><li>当宕机的 NameNode 新启动时，它会再次注册 Zookeper，发现已经有 znode 锁了，便会自动变为 Standby 状态，如此往复循环，保证高可靠，需要注意，目前仅仅支持最多配置 2 个 NameNode；</li><li>master 选举：如上所述，通过在 Zookeeper 中维持一个短暂类型的 znode，来实现抢占式的锁机制，从而判断那个 NameNode 为 Active 状态。</li></ul><h2 id="Hadoop-HDFS"><a href="#Hadoop-HDFS" class="headerlink" title="Hadoop HDFS"></a>Hadoop HDFS</h2><blockquote><h3 id="HDFS-中的-block-默认保存几份？"><a href="#HDFS-中的-block-默认保存几份？" class="headerlink" title="HDFS 中的 block 默认保存几份？"></a>HDFS 中的 block 默认保存几份？</h3></blockquote><p>默认保存 3 份。</p><blockquote><h3 id="HDFS-默认-BlockSize-是多大？"><a href="#HDFS-默认-BlockSize-是多大？" class="headerlink" title="HDFS 默认 BlockSize 是多大？"></a>HDFS 默认 BlockSize 是多大？</h3></blockquote><p>Hadoop1.x 是 64MB，hadoop2.x 开始是 128MB。</p><blockquote><h3 id="负责-HDFS-数据存储的是哪一部分？"><a href="#负责-HDFS-数据存储的是哪一部分？" class="headerlink" title="负责 HDFS 数据存储的是哪一部分？"></a>负责 HDFS 数据存储的是哪一部分？</h3></blockquote><p>DataNode 负责数据存储</p><blockquote><h3 id="HDFS-组成架构？"><a href="#HDFS-组成架构？" class="headerlink" title="HDFS 组成架构？"></a>HDFS 组成架构？</h3></blockquote><p>架构主要由四个部分组成，分别为 HDFS Client、NameNode、DataNode 和 Secondary NameNode。</p><p><img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="/images/post/bigdata_interview/hdfs_architecture.png" alt></p><ul><li>Client：就是客户端。<ul><li>文件切分。文件上传 HDFS 的时候，Client 将文件切分成一个一个的 Block，然后进行存储；</li><li>与 NameNode 交互，获取文件的位置信息；</li><li>与 DataNode 交互，读取或者写入数据；</li><li>Client 提供一些命令来管理HDFS，比如启动或者关闭HDFS；</li><li>Client 可以通过一些命令来访问HDFS。</li></ul></li><li>NameNode：就是 Master，它是一个主管、管理者。<ul><li>管理 HDFS 的名称空间；</li><li>管理数据块（Block）映射信息；</li><li>配置副本策略；</li><li>处理客户端读写请求。</li></ul></li><li>DataNode：就是 Slave。NameNode 下达命令，DataNode 执行实际的操作。<ul><li>存储实际的数据块；</li><li>执行数据块的读/写操作。</li></ul></li><li>Secondary NameNode：并非 NameNode 的热备。当 NameNode 挂掉的时候，它并不能马上替换 NameNode 并提供服务。<ul><li>辅助 NameNode，分担其工作量；</li><li>定期合并 fsimage 和 edits，并推送给 NameNode；</li><li>在紧急情况下，可辅助恢复 NameNode。</li></ul></li></ul><blockquote><h3 id="文件大小设置，增大有什么影响？"><a href="#文件大小设置，增大有什么影响？" class="headerlink" title="文件大小设置，增大有什么影响？"></a>文件大小设置，增大有什么影响？</h3></blockquote><p>HDFS 中的文件在物理上是分块存储（block），块的大小可以通过配置参数 <code>dfs.blocksize</code> 来规定，默认大小在 hadoop2.x 版本中是 128MB，老版本中是 64MB。</p><p><strong>思考：为什么块的大小不能设置的太小，也不能设置的太大？</strong></p><p>HDFS 的块比磁盘的块大，其目的是为了最小化寻址开销。如果块设置得足够大，从磁盘传输数据的时间会明显大于定位这个块开始位置所需的时间。因而，传输一个由多个块组成的文件的时间取决于磁盘传输速率。</p><p>如果寻址时间约为 10ms，而传输速率为 100MB/s，为了使寻址时间仅占传输时间的 1%，我们要将块大小设置约为 10ms×100×100M/s = 100MB。如图：</p><p><img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="/images/post/bigdata_interview/blocksize.png" alt></p><p>默认的块大小 128MB，增加文件块大小，需要增加磁盘的传输速率。</p><blockquote><h3 id="HDFS-的压缩算法？"><a href="#HDFS-的压缩算法？" class="headerlink" title="HDFS 的压缩算法？"></a>HDFS 的压缩算法？</h3></blockquote><p>企业开发用的比较多的是 snappy。</p><div class="table-container"><table><thead><tr><th>压缩算法</th><th>优点</th><th>缺点</th><th>应用场景</th></tr></thead><tbody><tr><td>Gzip</td><td>- 压缩比例比较高，而且压缩、解压速度比较快； <br> - hadoop 本身支持，在应用中处理 gzip 格式的文件就和直接处理文本一样； <br> - 大部分 linux 系统都自带 gzip 命令，使用方便。</td><td>不支持 split。</td><td>当每个文件压缩之后在 130M 以内的（1 个块大小内），都可以考虑用 gzip压缩格式。</td></tr><tr><td>Bzip2</td><td>- 支持 split； <br> - 具有很高的压缩率，比 gzip 压缩率都高； <br> - hadoop 本身支持，但不支持 native； <br> - 在 linux 系统下自带 bzip2 命令，使用方便。</td><td>- 压缩/解压速度慢； <br> - 不支持 native。</td><td>- 适合对速度要求不高，但需要较高的压缩率的时候，可以作为 MapReduce 作业的输出格式； <br> - 或者输出之后的数据比较大，处理之后的数据需要压缩存档减少磁盘空间并且以后数据用得比较少的情况； <br> - 或者对单个很大的文本文件想压缩减少存储空间，同时又需要支持 split，而且兼容之前的应用程序（即应用程序不需要修改）的情况。</td></tr><tr><td>Lzo</td><td>- 压缩/解压速度也比较快，合理的压缩率； <br> - 支持 split，是 hadoop 中最流行的压缩格式； <br> - 可以在 linux 系统下安装 lzop 命令，使用方便。</td><td>- 压缩率比 gzip 要低一些； <br> - hadoop 本身不支持，需要安装； <br> - 在应用中对 lzo 格式的文件需要做一些特殊处理（为了支持 split 需要建索引，还需要指定 inputFormat 为 lzo 格式）。</td><td>一个很大的文本文件，压缩之后还大于 200MB 以上的可以考虑，而且单个文件越大，lzo 优点越越明显。</td></tr><tr><td>Snappy</td><td>高速压缩速度和合理的压缩率。</td><td>- 不支持 split； <br> - 压缩率比 gzip 要低； <br> - hadoop 本身不支持，需要安装。</td><td>- 当 MapReduce 作业的 Map 输出的数据比较大的时候，作为 Map 到 Reduce 的中间数据的压缩格式； <br> - 或者作为一个 MapReduce 作业的输出和另外一个 MapReduce 作业的输入。</td></tr></tbody></table></div><blockquote><h3 id="HDFS-的存储机制？"><a href="#HDFS-的存储机制？" class="headerlink" title="HDFS 的存储机制？"></a>HDFS 的存储机制？</h3></blockquote><p>HDFS 存储机制，包括 HDFS 的<strong>写入数据</strong>过程和<strong>读取数据</strong>过程两部分</p><p><strong>HDFS 写数据过程</strong></p><p><img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="/images/post/bigdata_interview/hdfs_write.png" alt></p><ol><li>客户端通过 Distributed FileSystem 模块向 NameNode 请求上传文件，NameNode 检查目标文件是否已存在，父目录是否存在；</li><li>NameNode 返回是否可以上传；</li><li>客户端请求第一个 block 上传到哪几个 DataNode 服务器上；</li><li>NameNode 返回 3 个 DataNode 节点，分别为 dn1、dn2、dn3；</li><li>客户端通过 FSDataOutputStream 模块请求 dn1 上传数据，dn1 收到请求会继续调用 dn2，然后 dn2 调用 dn3，将这个<strong>通信管道</strong>建立完成；</li><li>dn1、dn2、dn3 逐级应答客户端；</li><li>客户端开始往 dn1 上传第一个 block（先从磁盘读取数据放到一个本地内存缓存），以 packet 为单位，dn1 收到一个 packet 就会传给 dn2，dn2 传给 dn3；dn1 每传一个 packet 会放入一个应答队列等待应答；</li><li>当一个 block 传输完成之后，客户端再次请求 NameNode 上传第二个 block 的服务器。（重复执行 3~7 步）。</li></ol><p><strong>HDFS读数据过程</strong></p><p><img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="/images/post/bigdata_interview/hdfs_read.png" alt></p><ol><li>客户端通过 Distributed FileSystem 向 NameNode 请求下载文件，NameNode 通过查询元数据，找到文件块所在的 DataNode 地址；</li><li>挑选一台 DataNode（就近原则，然后随机）服务器，请求读取数据；</li><li>DataNode 开始传输数据给客户端（从磁盘里面读取数据输入流，以 packet 为单位来做校验）；</li><li>客户端以 packet 为单位接收，先在本地缓存，然后写入目标文件。</li></ol><p>可以参考下面的漫画进行理解：</p><ul><li><strong>HDFS 写数据</strong></li></ul><p><img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="/images/post/bigdata_interview/hdfs_write1.png" alt><img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="/images/post/bigdata_interview/hdfs_write2.png" alt><img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="/images/post/bigdata_interview/hdfs_write3.png" alt></p><ul><li><strong>HDFS 读数据</strong></li></ul><p><img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="/images/post/bigdata_interview/hdfs_read1.png" alt></p><ul><li><strong>容错</strong></li></ul><p><img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="/images/post/bigdata_interview/hdfs_error1.png" alt><img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="/images/post/bigdata_interview/hdfs_error2.png" alt><img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="/images/post/bigdata_interview/hdfs_error3.png" alt><img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="/images/post/bigdata_interview/hdfs_error4.png" alt></p><ul><li><strong>副本存放策略</strong></li></ul><p><img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="/images/post/bigdata_interview/hdfs_duplication1.png" alt></p><h2 id="Hadoop-MapReduce"><a href="#Hadoop-MapReduce" class="headerlink" title="Hadoop MapReduce"></a>Hadoop MapReduce</h2><blockquote><h3 id="谈谈-Hadoop-序列化和反序列化及自定义-bean-对象实现序列化？"><a href="#谈谈-Hadoop-序列化和反序列化及自定义-bean-对象实现序列化？" class="headerlink" title="谈谈 Hadoop 序列化和反序列化及自定义 bean 对象实现序列化？"></a>谈谈 Hadoop 序列化和反序列化及自定义 bean 对象实现序列化？</h3></blockquote><ul><li><p>序列化和反序列化</p><ul><li>序列化就是把内存中的对象，转换成字节序列（或其他数据传输协议）以便于存储（持久化）和网络传输。</li><li>反序列化就是将收到字节序列（或其他数据传输协议）或者是硬盘的持久化数据，转换成内存中的对象。</li><li>Java 的序列化是一个重量级序列化框架（Serializable），一个对象被序列化后，会附带很多额外的信息（各种校验信息，header，继承体系等），不便于在网络中高效传输。所以，Hadoop 自己开发了一套序列化机制（Writable），精简、高效。</li></ul></li><li><p>自定义 bean 对象要想序列化传输步骤及注意事项：</p><ol><li>必须实现Writable接口；</li><li>反序列化时，需要反射调用空参构造函数，所以必须有空参构造；</li><li>重写序列化方法；</li><li>重写反序列化方法；</li><li>注意反序列化的顺序和序列化的顺序完全一致；</li><li>要想把结果显示在文件中，需要重写 <code>toString()</code>，且用 <code>\t</code> 分开，方便后续用；</li><li>如果需要将自定义的 bean 放在 key 中传输，则还需要实现 comparable 接口，因为 mapreduce 框中的 shuffle 过程一定会对 key 进行排序。</li></ol></li></ul><blockquote><h3 id="MapTask-和-ReduceTask-工作机制（MapReduce-工作原理）？"><a href="#MapTask-和-ReduceTask-工作机制（MapReduce-工作原理）？" class="headerlink" title="MapTask 和 ReduceTask 工作机制（MapReduce 工作原理）？"></a>MapTask 和 ReduceTask 工作机制（MapReduce 工作原理）？</h3></blockquote><p><strong>MapTask 工作机制</strong></p><p><img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="/images/post/bigdata_interview/map_task.png" alt></p><ol><li>Read 阶段：Map Task 通过用户编写的 RecordReader，从输入 InputSplit 中解析出一个个 key/value；</li><li>Map 阶段：该节点主要是将解析出的 key/value 交给用户编写 <code>map()</code> 函数处理，并产生一系列新的 key/value；</li><li>Collect 收集阶段：在用户编写 <code>map()</code> 函数中，当数据处理完成后，一般会调用 <code>OutputCollector.collect()</code> 输出结果。在该函数内部，它会将生成的 key/value 分区（调用 Partitioner），并写入一个环形内存缓冲区中；</li><li>Spill 阶段：即“溢写”，当环形缓冲区满后，MapReduce 会将数据写到本地磁盘上，生成一个临时文件。需要注意的是，将数据写入本地磁盘之前，先要对数据进行一次本地排序，并在必要时对数据进行合并、压缩等操作；</li><li>Combine 阶段：当所有数据处理完成后，MapTask 对所有临时文件进行一次合并，以确保最终只会生成一个数据文件。</li></ol><p><strong>ReduceTask工作机制</strong></p><p><img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="/images/post/bigdata_interview/reduce_task.png" alt></p><ol><li>Copy 阶段：ReduceTask 从各个 MapTask 上远程拷贝一片数据，并针对某一片数据，如果其大小超过一定阈值，则写到磁盘上，否则直接放到内存中；</li><li>Merge 阶段：在远程拷贝数据的同时，ReduceTask 启动了两个后台线程对内存和磁盘上的文件进行合并，以防止内存使用过多或磁盘上文件过多；</li><li>Sort 阶段：按照 MapReduce 语义，用户编写 <code>reduce()</code> 函数输入数据是按 key 进行聚集的一组数据。为了将 key 相同的数据聚在一起，Hadoop 采用了基于排序的策略。由于各个 MapTask 已经实现对自己的处理结果进行了局部排序，因此， ReduceTask 只需对所有数据进行一次归并排序即可；</li><li>Reduce 阶段：<code>reduce()</code> 函数将计算结果写到 HDFS 上。</li></ol><blockquote><h3 id="如何判定一个-job-的-map-和-reduce-的数量"><a href="#如何判定一个-job-的-map-和-reduce-的数量" class="headerlink" title="如何判定一个 job 的 map 和 reduce 的数量?"></a>如何判定一个 job 的 map 和 reduce 的数量?</h3></blockquote><ul><li><p><strong>map 的数量</strong></p><p>  map 个数的计算公式为：<code>splitSize = max(minSize, min(maxSize, blockSize))</code>，如果没有设置 minSize 和 maxSize，splitSize 的大小默认等于 blockSize，</p><p>  在 map 阶段读取数据前，FileInputFormat 会将输入文件分割成 split。split 的个数决定了 map 的个数。影响 map 个数，即 split 个数的因素主要有：</p><ul><li><p>HDFS 块的大小，即 HDFS 中 <code>dfs.block.size</code> 的值。如果有一个输入文件为1024MB，当块为 256MB 时，会被划分为 4 个 split；当块为 128MB 时，会被划分为 8 个 split。</p></li><li><p>文件的大小。当块为 128MB 时，如果输入文件为 128MB，会被划分为 1 个 split；当块为 256MB，会被划分为 2 个 split。</p></li><li><p>文件的个数。FileInputFormat 按照文件分割 split，并且只会分割大文件，即那些大小超过 HDFS 块的大小的文件。如果 HDFS 中 <code>dfs.block.size</code> 设置为 64MB，而输入的目录中文件有 100 个，则划分后的 split 个数至少为 100 个。</p></li><li><p>splitSize 的大小。分片是按照 splitSize 的大小进行分割的，一个 split 的大小在没有设置的情况下，默认等于 HDFS Block 的大小。但应用程序可以通过两个参数来对 splitSize 进行调节。</p><ul><li>maxSize：split 的最大值，默认是 <code>Long.MAX_VALUE</code>。可以通过<code>mapreduce.input.fileinputformat.split.maxsize</code> 进行设置。</li><li>minSize：split的最小值，该值可由两个途径设置：(1)通过子类重写方法 <code>protected void setMinSplitSize(long minSplitSize)</code> 进行设置。一般情况为 <code>1</code>，特殊情况除外；(2)通过配置文件中的 <code>mapreduce.input.fileinputformat.split.minsize</code> 进行设置。</li></ul></li></ul></li><li><p><strong>reduce数量</strong></p><p>  reduce 的数量 <code>job.setNumReduceTasks(x);</code> x 为 reduce 的数量。不设置的话默认为 1。</p></li></ul><blockquote><h3 id="在一个运行的-Hadoop-任务中，什么是-InputSplit？"><a href="#在一个运行的-Hadoop-任务中，什么是-InputSplit？" class="headerlink" title="在一个运行的 Hadoop 任务中，什么是 InputSplit？"></a>在一个运行的 Hadoop 任务中，什么是 InputSplit？</h3></blockquote><p>FileInputFormat 源码解析 <code>input.getSplits(job)</code></p><ol><li>找到你数据存储的目录；</li><li>开始遍历处理（规划切片）目录下的每一个文件；</li><li>遍历第一个文件 ss.txt；<ol><li>获取文件大小 <code>fs.sizeOf(ss.txt)</code>;</li><li>计算切片大小 <code>computeSliteSize(Math.max(minSize, Math.min(maxSize, blocksize))) = blocksize = 128MB</code>；</li><li>默认情况下，切片大小 = blocksize；</li><li>开始切，形成第 1 个切片：ss.txt—0:128MB，第 2 个切片ss.txt—128:256MB，第 3 个切片 ss.txt—256MB:300MB（每次切片时，都要判断切完剩下的部分是否大于块的 1.1 倍，不大于 1.1 倍就划分为一块切片）；</li><li>将切片信息写到一个切片规划文件中；</li><li>整个切片的核心过程在 <code>getSplit()</code> 方法中完成；</li><li>数据切片只是在逻辑上对输入数据进行分片，并不会再磁盘上将其切分成分片进行存储。InputSplit 只记录了分片的元数据信息，比如起始位置、长度以及所在的节点列表等；</li><li>注意：block 是 HDFS 上物理上存储的存储的数据，切片是对数据逻辑上的划分。</li></ol></li><li>提交切片规划文件到 YARN 上，YARN 上的 MRAppMaster 就可以根据切片规划文件计算开启 MapTask 个数，一个 job 的 map 阶段 MapTask 并行度（个数），也是由客户端提交 job 时的切片（split）个数决定。</li></ol><blockquote><h3 id="描述-MapReduce-有几种排序及排序发生的阶段？"><a href="#描述-MapReduce-有几种排序及排序发生的阶段？" class="headerlink" title="描述 MapReduce 有几种排序及排序发生的阶段？"></a>描述 MapReduce 有几种排序及排序发生的阶段？</h3></blockquote><p><strong>排序的分类：</strong></p><ul><li><p>部分排序：MapReduce 根据输入记录的键对数据集排序。保证输出的每个文件内部排序；</p></li><li><p>全排序：如何用 Hadoop 产生一个全局排序的文件？最简单的方法是使用一个分区。但该方法在处理大型文件时效率极低，因为一台机器必须处理所有输出文件，从而完全丧失了 MapReduce 所提供的并行架构；</p><p>替代方案：首先创建一系列排好序的文件；其次，串联这些文件；最后，生成一个全局排序的文件。主要思路是使用一个分区来描述输出的全局排序。例如：可以为待分析文件创建 3 个分区，在第一分区中，记录的单词首字母 a-g，第二分区记录单词首字母 h-n, 第三分区记录单词首字母 o-z；</p></li><li><p>辅助排序：（GroupingComparator 分组）：MapReduce 框架在记录到达 reducer 之前按键对记录排序，但键所对应的值并没有被排序。甚至在不同的执行轮次中，这些值的排序也不固定，因为它们来自不同的 map 任务且这些 map 任务在不同轮次中完成时间各不相同。一般来说，大多数 MapReduce 程序会避免让 reduce 函数依赖于值的排序。但是，有时也需要通过特定的方法对键进行排序和分组等以实现对值的排序；</p></li><li><p>二次排序：在自定义排序过程中，如果 <code>compareTo</code> 中的判断条件为两个即为二次排序。</p></li></ul><p><strong>自定义排序 WritableComparable：</strong></p><p>bean 对象实现 WritableComparable 接口重写 <code>compareTo</code> 方法，就可以实现排序。<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Override</span><span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">compareTo</span><span class="token punctuation">(</span><span class="token class-name">FlowBean</span> o<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// 倒序排列，从大到小</span>    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>sumFlow <span class="token operator">></span> o<span class="token punctuation">.</span><span class="token function">getSumFlow</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><strong>排序发生的阶段：</strong></p><ul><li>一个是在 map side 发生在 spill 后 partition 前；</li><li>一个是在 reduce side 发生在 copy 后 reduce 前。</li></ul><blockquote><h3 id="MapReduce-的-shuffle-过程？"><a href="#MapReduce-的-shuffle-过程？" class="headerlink" title="MapReduce 的 shuffle 过程？"></a>MapReduce 的 shuffle 过程？</h3></blockquote><p>Shuffle 机制：MapReduce 保证每个 reducer 的输入都是按键有序排列的，系统执行排序的过程（即将 map 输出作为输入传给 reducer）称为 shuffle。</p><p><img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="/images/post/bigdata_interview/mapreduce_shuffle.png" alt></p><p>分区，排序，溢写，拷贝到对应 reduce 机器上，增加 combiner，压缩溢写的文件。</p><blockquote><h3 id="如何优化-shuffle？"><a href="#如何优化-shuffle？" class="headerlink" title="如何优化 shuffle？"></a>如何优化 shuffle？</h3></blockquote><p><strong>Map 端 shuffle</strong></p><ul><li>kvbuffer，默认是 100MB，可以通过参数 <code>mapreduce.task.io.sort.mb</code> 来修改，一般不修改；</li><li>缓冲区阈值，一般是 80%，可以通过 <code>mapreduce.map.sort.spill.percent</code> 来修改；</li><li>合并 spill 文件，<code>mapreduce.task.io.sort.factor</code> 属性配置每次最多合并多少个文件，默认为 10，即一次最多合并 10 个 spill 文件.如果 spill 文件数量大于 <code>mapreduce.map.combiner.minspills</code> 配置的数，则在合并文件写入之前，会再次运行 combiner。如果 spill 文件数量太少，运行 combiner 的收益可能小于调用的代价；</li><li>对 map 输出进行压缩，在数据量大的时候，可以对 map 输出进行压缩,要启用压缩，将 <code>mapreduce.map.output.compress</code> 设为 true，并使用 <code>mapreduce.map.output.compress.codec</code> 设置使用的压缩算法。</li></ul><p><strong>Reduce 端 shuffle</strong></p><ul><li>copy 线程数量：copy 是用来从 map 任务中提取数据的，默认为 5 个 copy 线程，可以通是 <code>mapreduce.reduce.shuffle.parallelcopies</code> 配置。</li><li>内存分配：如果能够让所有数据都保存在内存中，可以达到最佳的性能。通常情况下，内存都保留给 <code>reduce</code> 函数，但是如果 <code>reduce</code> 函数对内存需求不是很高，将 <code>mapreduce.reduce.merge.inmem.threshold</code>（触发合并的 map 输出文件数）设为 0，<code>mapreduce.reduce.input.buffer.percent</code>（用于保存 map 输出文件的堆内存比例）设为1.0。</li></ul><blockquote><h3 id="Partion-分区"><a href="#Partion-分区" class="headerlink" title="Partion 分区"></a>Partion 分区</h3></blockquote><p>Partion 作用主要是对 map 处理的数据进行分区，可以解决数据倾斜的问题。</p><ul><li>分区是根据 MR 的输出 <code>&lt;key，value&gt;</code> 进行分区的。默认情况下，MR 的输出只有一个分区，一个分区就是一个文件。</li><li>自定义分区：继承 Partitioner，重写 <code>getPartition</code> 这个方法。</li><li>如果没有定义 Partitioner，则使用默认的 partition 算法，即根据每一条数据的 key 的 hashcode 值摸运算（%）reduce 的数量，得到的数字就是“分区号”。</li></ul><blockquote><h3 id="描述-MapReduce-中-Combiner-的作用是什么，一般使用情景，哪些情况不需要，以及和-Reduce-的区别？"><a href="#描述-MapReduce-中-Combiner-的作用是什么，一般使用情景，哪些情况不需要，以及和-Reduce-的区别？" class="headerlink" title="描述 MapReduce 中 Combiner 的作用是什么，一般使用情景，哪些情况不需要，以及和 Reduce 的区别？"></a>描述 MapReduce 中 Combiner 的作用是什么，一般使用情景，哪些情况不需要，以及和 Reduce 的区别？</h3></blockquote><ul><li>Combiner 是一种特殊的Reducer，它的意义就是对每一个 MapTask 的输出进行<strong>局部汇总</strong>，以减小网络传输量；</li><li>Combiner 在 Mapper 端执行一次合并，用于减少 Mapper 输出到 Reducer 的数量，可以调高效率；</li><li>Combiner 能够应用的前提是不能影响最终的业务逻辑，而且，Combiner 的输出 kv 应该跟 Reducer 的输入 kv 类型要对应起来；</li><li>Combiner 和 Reducer 的区别在于运行的位置；<ul><li>Combiner 是在每一个 MapTask 所在的节点运行；</li><li>Reducer 是接收全局所有 Mapper 的输出结果。</li></ul></li></ul><p><img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="/images/post/bigdata_interview/mapreduce_combiner.png" alt></p><h2 id="Hadoop-YARN"><a href="#Hadoop-YARN" class="headerlink" title="Hadoop YARN"></a>Hadoop YARN</h2><blockquote><h3 id="简述-hadoop1-x-与-hadoop2-x-的架构异同"><a href="#简述-hadoop1-x-与-hadoop2-x-的架构异同" class="headerlink" title="简述 hadoop1.x 与 hadoop2.x 的架构异同"></a>简述 hadoop1.x 与 hadoop2.x 的架构异同</h3></blockquote><ul><li>加入了 yarn 解决了资源调度的问题;</li><li>加入了对 zookeeper 的支持实现比较可靠的高可用。</li></ul><blockquote><h3 id="为什么会产生-yarn，它解决了什么问题，有什么优势？"><a href="#为什么会产生-yarn，它解决了什么问题，有什么优势？" class="headerlink" title="为什么会产生 yarn，它解决了什么问题，有什么优势？"></a>为什么会产生 yarn，它解决了什么问题，有什么优势？</h3></blockquote><ul><li>Yarn 最主要的功能就是解决运行的用户程序与 yarn 框架完全解耦。</li><li>Yarn 上可以运行各种类型的分布式运算程序（mapreduce 只是其中的一种），比如 mapreduce、storm 程序，spark 程序等等。</li></ul><blockquote><h3 id="yarn-包括什么组件，各自的作用是什么？"><a href="#yarn-包括什么组件，各自的作用是什么？" class="headerlink" title="yarn 包括什么组件，各自的作用是什么？"></a>yarn 包括什么组件，各自的作用是什么？</h3></blockquote><p>yarn 是一个资源管理、任务调度的框架。主要包含三个模块：ResourceManger、NodeManger、ApplicationMater。</p><ul><li>ResourceManger：负责所有资源的监控、分配和管理；</li><li>ApplicationMater：负责每一个具体应用程序的调度和协调，用户提交的每个应用程序均包含一个 ApplicationMater，它可以运行在 ResourceManger 以外的机器上；</li><li>NodeManger：负责每一个节点的维护。</li></ul><blockquote><h3 id="Hadoop-有哪些调度器？"><a href="#Hadoop-有哪些调度器？" class="headerlink" title="Hadoop 有哪些调度器？"></a>Hadoop 有哪些调度器？</h3></blockquote><ul><li>默认的调度器 FIFO：Hadoop 中默认的调度器，它先按照作业的优先级高低，再按照到达时间的先后选择被执行的作业。</li><li>计算能力调度器 Capacity Scheduler：支持多个队列，每个队列可配置一定的资源量，每个队列采用 FIFO 调度策略，为了防止同一个用户的作业独占队列中的资源，该调度器会对同一用户提交的作业所占资源量进行限定。调度时，首先按以下策略选择一个合适队列：计算每个队列中正在运行的任务数与其应该分得的计算资源之间的比值，选择一个该比值最小的队列；然后按以下策略选择该队列中一个作业：按照作业优先级和提交时间顺序选择，同时考虑用户资源量限制和内存限制。</li><li>公平调度器 Fair Scheduler：同计算能力调度器类似，支持多队列多用户，每个队列中的资源量可以配置，同一队列中的作业公平共享队列中所有资源。实际上，Hadoop 的调度器远不止以上三种，最近，出现了很多针对新型应用的 Hadoop 调度器。</li></ul><blockquote><h3 id="什么是-Container？"><a href="#什么是-Container？" class="headerlink" title="什么是 Container？"></a>什么是 Container？</h3></blockquote><p>Container 是一个抽象概念，称之为容器，包含任务运行时所需的资源（包括内存、硬盘、cpu 等）和环境（包含启动命令、环境变量等）。</p><blockquote><h3 id="yarn-的执行流程？"><a href="#yarn-的执行流程？" class="headerlink" title="yarn 的执行流程？"></a>yarn 的执行流程？</h3></blockquote><ol><li>客户端向集群提交一个任务，该任务首先到 RM 中的 AM；</li><li>AM 收到任务后，会在集群中找一个 NodeManger，在该 NodeManger 上启动一个 APPMaster 进程。该进程用于执行任务划分和任务监控；</li><li>AppMaster 启动起来之后，会向 RM 中的 AM 注册信息，APPMaster 向 RM 下的 ResourceSchedule 申请计算任务所需的资源；</li><li>AppMaster 申请到资源之后，会与所有 NodeManger 通信要求他们启动所有计算任务（Map 和 Reduce）；</li><li>各个 NM 启动对应的容器 Container 用来执行 Map 和 Reduce 任务；</li><li>各个任务会向 APPMaster 汇报自己的执行进度和执行状况，以便让 AppMaster 随时掌握各个任务的运行状态，在某个任务出了问题之后重启执行该任务；</li><li>在执行完之后，APPMaster 会向 AM 汇报，以便让 ApplicationManger 注销并关闭自己，使得资源得以回收。</li></ol><p><img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="/images/post/bigdata_interview/yarn.png" alt></p><blockquote><h3 id="MapReduce-容错性？"><a href="#MapReduce-容错性？" class="headerlink" title="MapReduce 容错性？"></a>MapReduce 容错性？</h3></blockquote><p>1）MRAppMaster 容错性  一旦运行失败，由 YARN 的 ResourceManager 负责重新启动，最多重启次数可由用户设置，默认是 2 次。一旦超过最高重启次数，则作业运行失败。2）Map/Reduce Task  Task Task 周期性向 MRAppMaster 汇报心跳；一旦 Task 挂掉，则 MRAppMaster 将为之重新申请资源，并运行之。最多重新运行次数可由用户设置，默认 4 次。</p><blockquote><h3 id="MapReduce-2-x-推测执行算法及原理？"><a href="#MapReduce-2-x-推测执行算法及原理？" class="headerlink" title="MapReduce 2.x 推测执行算法及原理？"></a>MapReduce 2.x 推测执行算法及原理？</h3></blockquote><ul><li>作业完成时间取决于最慢的任务完成时间<ul><li>一个作业由若干个 Map 任务和 Reduce 任务构成。因硬件老化、软件 Bug 等，某些任务可能运行非常慢。</li><li>典型案例：系统中有 99% 的 Map 任务都完成了，只有少数几个 Map 老是进度很慢，完不成，怎么办？</li></ul></li><li>推测执行机制<ul><li>发现拖后腿的任务，比如某个任务运行速度远慢于任务平均速度。为拖后腿任务启动一个备份任务，同时运行。谁先运行完，则采用谁的结果。</li></ul></li><li>不能启用推测执行机制情况<ul><li>任务间存在严重的负载倾斜；</li><li>特殊任务，比如任务向数据库中写数据。</li></ul></li><li><p>算法原理</p><p>假设某一时刻，任务 <code>T</code> 的执行进度为 <code>progress</code>，则可通过一定的算法推测出该任务的最终完成时刻 <code>estimateEndTime</code>。另一方面，如果此刻为该任务启动一个备份任务，则可推断出它可能的完成时刻 <code>estimateEndTime</code>,于是可得出以下几个公式：</p><ul><li><code>estimateEndTime = estimatedRunTime + taskStartTime</code></li><li><code>estimatedRunTime = (currentTimestamp - taskStartTime)/progress</code></li><li><code>estimateEndTime = currentTimestamp + averageRunTime</code></li></ul><p>其中，<code>currentTimestamp</code> 为当前时刻；<code>taskStartTime</code> 为该任务的启动时刻；<code>averageRunTime</code> 为已经成功运行完成的任务的平均运行时间。这样，MRv2 总是选择 <code>estimateEndTime- estimateEndTime</code> 差值最大的任务，并为之启动备份任务。为了防止大量任务同时启动备份任务造成的资源浪费，MRv2为每个作业设置了同时启动的备份任务数目上限。</p><p>推测执行机制实际上采用了经典的算法优化方法：以空间换时间，它同时启动多个相同任务处理相同的数据，并让这些任务竞争以缩短数据处理时间。显然，这种方法需要占用更多的计算资源。在集群资源紧缺的情况下，应合理使用该机制，争取在多用少量资源的情况下，减少作业的计算时间。</p></li></ul><h2 id="Hadoop-调优"><a href="#Hadoop-调优" class="headerlink" title="Hadoop 调优"></a>Hadoop 调优</h2><blockquote><h3 id="MapReduce-跑得慢的原因？"><a href="#MapReduce-跑得慢的原因？" class="headerlink" title="MapReduce 跑得慢的原因？"></a>MapReduce 跑得慢的原因？</h3></blockquote><p>MapReduce 程序效率的瓶颈在于两点：</p><ul><li>计算机性能<ul><li>CPU、内存、磁盘健康、网络</li></ul></li><li>I/O 操作优化<ul><li>数据倾斜</li><li>map 和 reduce 数设置不合理</li><li>reduce 等待过久</li><li>小文件过多</li><li>大量的不可分块的超大文件</li><li>spill 次数过多</li><li>merge 次数过多等</li></ul></li></ul><blockquote><h3 id="MapReduce-优化方法？"><a href="#MapReduce-优化方法？" class="headerlink" title="MapReduce 优化方法？"></a>MapReduce 优化方法？</h3></blockquote><ol><li><p>数据输入</p><ul><li>合并小文件：在执行 mr 任务前将小文件进行合并，大量的小文件会产生大量的 map 任务，增大 map 任务装载次数，而任务的装载比较耗时，从而导致 mr 运行较慢。</li><li>采用 CombineFileInputFormat 来作为输入，解决输入端大量小文件场景。</li></ul></li><li><p>map 阶段</p><ul><li>减少 spill 次数：通过调整 <code>io.sort.mb</code> 及 <code>sort.spill.percent</code>参数值，增大触发 spill 的内存上限，减少 spill 次数，从而减少磁盘 IO。</li><li>减少 merge 次数：通过调整 <code>io.sort.factor</code> 参数，增大 merge 的文件数目，减少 merge 的次数，从而缩短 mr 处理时间。</li><li>在 map 之后先进行 combine 处理，减少 I/O。</li></ul></li><li><p>reduce 阶段</p><ul><li>合理设置 map 和 reduce 数：两个都不能设置太少，也不能设置太多。太少，会导致 task 等待，延长处理时间；太多，会导致 map、reduce 任务间竞争资源，造成处理超时等错误。</li><li>设置 map、reduce 共存：调整 <code>slowstart.completedmaps</code>参数，使 map 运行到一定程度后，reduce 也开始运行，减少 reduce 的等待时间。</li><li>规避使用 reduce，因为 reduce 在用于连接数据集的时候将会产生大量的网络消耗。</li><li>合理设置 reduce 端的 buffer，默认情况下，数据达到一个阈值的时候，buffer 中的数据就会写入磁盘，然后 reduce 会从磁盘中获得所有的数据。也就是说，buffer 和 reduce 是没有直接关联的，中间多个一个写磁盘 -&gt; 读磁盘的过程，既然有这个弊端，那么就可以通过参数来配置，使得 buffer 中的一部分数据可以直接输送到 reduce，从而减少 IO 开销：<code>mapred.job.reduce.input.buffer.percent</code>，默认为 0.0。当值大于 0 的时候，会保留指定比例的内存读 buffer 中的数据直接拿给 reduce 使用。这样一来，设置 buffer 需要内存，读取数据需要内存，reduce 计算也要内存，所以要根据作业的运行情况进行调整。</li></ul></li><li><p>IO传输</p><ul><li>采用数据压缩的方式，减少网络 IO 的时间。安装 Snappy 和 LZOP 压缩编码器。</li><li>使用 SequenceFile 二进制文件</li></ul></li><li><p>数据倾斜问题</p><ol><li>数据倾斜现象：<ul><li>数据频率倾斜：某一个区域的数据量要远远大于其他区域。</li><li>数据大小倾斜：部分记录的大小远远大于平均值。</li></ul></li><li><p>如何收集倾斜数据</p><ul><li>在 reduce 方法中加入记录 map 输出键的详细情况的功能。</li></ul><p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> MAX_VALUES <span class="token operator">=</span> <span class="token string">"skew.maxvalues"</span><span class="token punctuation">;</span><span class="token keyword">private</span> <span class="token keyword">int</span> maxValueThreshold<span class="token punctuation">;</span><span class="token annotation punctuation">@Override</span><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">configure</span><span class="token punctuation">(</span><span class="token class-name">JobConf</span> job<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    maxValueThreshold <span class="token operator">=</span> job<span class="token punctuation">.</span><span class="token function">getInt</span><span class="token punctuation">(</span>MAX_VALUES<span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token annotation punctuation">@Override</span><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">reduce</span><span class="token punctuation">(</span><span class="token class-name">Text</span> key<span class="token punctuation">,</span> <span class="token class-name">Iterator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Text</span><span class="token punctuation">></span></span> values<span class="token punctuation">,</span>                    <span class="token class-name">OutputCollector</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Text</span><span class="token punctuation">,</span> <span class="token class-name">Text</span><span class="token punctuation">></span></span> output<span class="token punctuation">,</span>                    <span class="token class-name">Reporter</span> reporter<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token keyword">while</span> <span class="token punctuation">(</span>values<span class="token punctuation">.</span><span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        values<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        i<span class="token operator">++</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">++</span>i <span class="token operator">></span> maxValueThreshold<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"Received "</span> <span class="token operator">+</span> i <span class="token operator">+</span> <span class="token string">" values for key "</span> <span class="token operator">+</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p></li><li>减少数据倾斜的方法<ul><li>抽样和范围分区：可以通过对原始数据进行抽样得到的结果集来预设分区边界值。</li><li>自定义分区：另一个抽样和范围分区的替代方案是基于输出键的背景知识进行自定义分区。例如，如果 map 输出键的单词来源于一本书。其中大部分必然是省略词（stopword）。那么就可以将自定义分区将这部分省略词发送给固定的一部分 reduce 实例。而将其他的都发送给剩余的 reduce 实例。</li><li>Combine：使用 Combine 可以大量地减小数据频率倾斜和数据大小倾斜。在可能的情况下，Combine 的目的就是聚合并精简数据。</li></ul></li></ol></li></ol><blockquote><h3 id="HDFS小文件优化方法？"><a href="#HDFS小文件优化方法？" class="headerlink" title="HDFS小文件优化方法？"></a>HDFS小文件优化方法？</h3></blockquote><ol><li><p>HDFS 小文件弊端：</p><p> HDFS 上每个文件都要在 NameNode 上建立一个索引，这个索引的大小约为 150byte，这样当小文件比较多的时候，就会产生很多的索引文件，一方面会大量占用 NameNode 的内存空间，另一方面就是索引文件过大是的索引速度变慢。</p></li><li><p>解决的方式：</p><ul><li>Hadoop 本身提供了一些文件压缩的方案。</li><li>从系统层面改变现有 HDFS 存在的问题，其实主要还是小文件的合并，然后建立比较快速的索引。</li></ul></li><li><p>Hadoop 自带小文件解决方案</p><ul><li>Hadoop Archive：是一个高效地将小文件放入 HDFS 块中的文件存档工具，它能够将多个小文件打包成一个 HAR 文件，这样在减少 NameNode 内存使用的同时。</li><li>Sequence file：Sequence file 由一系列的二进制 key/value 组成，如果为 key 小文件名，value 为文件内容，则可以将大批小文件合并成一个大文件。</li><li>CombineFileInputFormat：CombineFileInputFormat 是一种新的 inputFormat，用于将多个文件合并成一个单独的 split，另外，它会考虑数据的存储位置。</li></ul></li></ol>]]></content>
      
      
      <categories>
          
          <category> 教程笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 大数据 </tag>
            
            <tag> 面试题 </tag>
            
            <tag> Hadoop </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>大数据面试题解析</title>
      <link href="post/7e24cf66.html"/>
      <url>post/7e24cf66.html</url>
      
        <content type="html"><![CDATA[<h2 id="Hadoop-面试题解析"><a href="#Hadoop-面试题解析" class="headerlink" title="Hadoop 面试题解析"></a><a href="/post/2b822834.html">Hadoop 面试题解析</a></h2><h2 id="Zookeeper-面试题解析"><a href="#Zookeeper-面试题解析" class="headerlink" title="Zookeeper 面试题解析"></a><a href="/post/2f1ea7f2.html">Zookeeper 面试题解析</a></h2><h2 id="Flume-面试题解析"><a href="#Flume-面试题解析" class="headerlink" title="Flume 面试题解析"></a><a href="/post/5a2a12a6.html">Flume 面试题解析</a></h2><h2 id="Kafka-面试题解析"><a href="#Kafka-面试题解析" class="headerlink" title="Kafka 面试题解析"></a><a href="/post/89cabcb1.html">Kafka 面试题解析</a></h2><h2 id="Hive-面试题解析"><a href="#Hive-面试题解析" class="headerlink" title="Hive 面试题解析"></a><a href="/post/62c9bbde.html">Hive 面试题解析</a></h2><h2 id="HBase-面试题解析"><a href="#HBase-面试题解析" class="headerlink" title="HBase 面试题解析"></a><a href="/post/47457d03.html">HBase 面试题解析</a></h2><h2 id="Sqoop-面试题解析"><a href="#Sqoop-面试题解析" class="headerlink" title="Sqoop 面试题解析"></a><a href="/post/420614eb.html">Sqoop 面试题解析</a></h2><h2 id="MySQL-面试题解析"><a href="#MySQL-面试题解析" class="headerlink" title="MySQL 面试题解析"></a><a href="/post/54dbb40b.html">MySQL 面试题解析</a></h2>]]></content>
      
      
      <categories>
          
          <category> 教程笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 大数据 </tag>
            
            <tag> 面试题 </tag>
            
            <tag> Flume </tag>
            
            <tag> Hadoop </tag>
            
            <tag> Sqoop </tag>
            
            <tag> Zookeeper </tag>
            
            <tag> Kafka </tag>
            
            <tag> Hive </tag>
            
            <tag> HBase </tag>
            
            <tag> MySQL </tag>
            
            <tag> Spark </tag>
            
            <tag> Flink </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Java 面试题解析（Java EE）</title>
      <link href="post/dc04fa32.html"/>
      <url>post/dc04fa32.html</url>
      
        <content type="html"><![CDATA[<blockquote><h3 id="什么是-ORM？"><a href="#什么是-ORM？" class="headerlink" title="什么是 ORM？"></a>什么是 ORM？</h3></blockquote><p>答：对象关系映射（Object-Relational Mapping，简称 ORM）是一种为了解决程序的面向对象模型与数据库的关系模型互不匹配问题的技术；简单的说，ORM 是通过使用描述对象和数据库之间映射的元数据（在 Java 中可以用 XML 或者是注解），将程序中的对象自动持久化到关系数据库中或者将关系数据库表中的行转换成 Java 对象，其本质上就是将数据从一种形式转换到另外一种形式。</p><blockquote><h3 id="持久层设计要考虑的问题有哪些？你用过的持久层框架有哪些？"><a href="#持久层设计要考虑的问题有哪些？你用过的持久层框架有哪些？" class="headerlink" title="持久层设计要考虑的问题有哪些？你用过的持久层框架有哪些？"></a>持久层设计要考虑的问题有哪些？你用过的持久层框架有哪些？</h3></blockquote><p>答：所谓“持久”就是将数据保存到可掉电式存储设备中以便今后使用，简单的说，就是将内存中的数据保存到关系型数据库、文件系统、消息队列等提供持久化支持的设备中。持久层就是系统中专注于实现数据持久化的相对独立的层面。</p><p>持久层设计的目标包括：</p><ul><li>数据存储逻辑的分离，提供抽象化的数据访问接口。</li><li>数据访问底层实现的分离，可以在不修改代码的情况下切换底层实现。</li><li>资源管理和调度的分离，在数据访问层实现统一的资源调度（如缓存机制）。</li><li>数据抽象，提供更面向对象的数据操作。</li></ul><p>持久层框架有：</p><ul><li>Hibernate</li><li>MyBatis</li><li>TopLink</li><li>Guzz</li><li>jOOQ</li><li>Spring Data</li><li>ActiveJDBC</li></ul><blockquote><h3 id="Hibernate-中-SessionFactory-是线程安全的吗？Session-是线程安全的吗（两个线程能够共享同一个-Session-吗）？"><a href="#Hibernate-中-SessionFactory-是线程安全的吗？Session-是线程安全的吗（两个线程能够共享同一个-Session-吗）？" class="headerlink" title="Hibernate 中 SessionFactory 是线程安全的吗？Session 是线程安全的吗（两个线程能够共享同一个 Session 吗）？"></a>Hibernate 中 SessionFactory 是线程安全的吗？Session 是线程安全的吗（两个线程能够共享同一个 Session 吗）？</h3></blockquote><p>答：SessionFactory 对应 Hibernate 的一个数据存储的概念，它是线程安全的，可以被多个线程并发访问。SessionFactory 一般只会在启动的时候构建。对于应用程序，最好将 SessionFactory 通过单例模式进行封装以便于访问。Session 是一个轻量级非线程安全的对象（线程间不能共享 Session），它表示与数据库进行交互的一个工作单元。Session 是由 SessionFactory 创建的，在任务完成之后它会被关闭。Session 是持久层服务对外提供的主要接口。Session 会延迟获取数据库连接（也就是在需要的时候才会获取）。为了避免创建太多的 Session，可以使用 <code>ThreadLocal</code> 将 Session 和当前线程绑定在一起，这样可以让同一个线程获得的总是同一个 Session。Hibernate 3 中 SessionFactory 的 <code>getCurrentSession()</code> 方法就可以做到。</p><blockquote><h3 id="Hibernate-中-Session-的-load-和-get-方法的区别是什么？"><a href="#Hibernate-中-Session-的-load-和-get-方法的区别是什么？" class="headerlink" title="Hibernate 中 Session 的 load 和 get 方法的区别是什么？"></a>Hibernate 中 Session 的 <code>load</code> 和 <code>get</code> 方法的区别是什么？</h3></blockquote><p>答：主要有以下三项区别：</p><ol><li>如果没有找到符合条件的记录，<code>get</code> 方法返回 <code>null</code>，<code>load</code> 方法抛出异常。</li><li><code>get</code> 方法直接返回实体类对象，<code>load</code> 方法返回实体类对象的代理。</li><li>在 Hibernate 3 之前，<code>get</code> 方法只在一级缓存中进行数据查找，如果没有找到对应的数据则越过二级缓存，直接发出 SQL 语句完成数据读取；<code>load</code> 方法则可以从二级缓存中获取数据；从 Hibernate 3 开始，<code>get</code> 方法不再是对二级缓存只写不读，它也是可以访问二级缓存的。</li></ol><p><strong>说明：</strong>对于 <code>load()</code> 方法 Hibernate 认为该数据在数据库中一定存在可以放心的使用代理来实现延迟加载，如果没有数据就抛出异常，而通过 <code>get()</code> 方法获取的数据可以不存在。</p><blockquote><h3 id="Session-的-save-、update-、merge-、lock-、saveOrUpdate-和-persist-方法分别是做什么的？有什么区别？"><a href="#Session-的-save-、update-、merge-、lock-、saveOrUpdate-和-persist-方法分别是做什么的？有什么区别？" class="headerlink" title="Session 的 save()、update()、merge()、lock()、saveOrUpdate()和 persist() 方法分别是做什么的？有什么区别？"></a>Session 的 <code>save()</code>、<code>update()</code>、<code>merge()</code>、<code>lock()</code>、<code>saveOrUpdate()</code>和 <code>persist()</code> 方法分别是做什么的？有什么区别？</h3></blockquote><p>答：Hibernate 的对象有三种状态：瞬时态（transient）、持久态（persistent）和游离态（detached），如第 135 题中的图所示。瞬时态的实例可以通过调用 <code>save()</code>、<code>persist()</code> 或者 <code>saveOrUpdate()</code> 方法变成持久态；游离态的实例可以通过调用 <code>update()</code>、<code>saveOrUpdate()</code>、<code>lock()</code> 或者 <code>replicate()</code> 变成持久态。<code>save()</code> 和 <code>persist()</code> 将会引发 SQL 的 <code>INSERT</code> 语句，而 <code>update()</code> 或 <code>merge()</code> 会引发 <code>UPDATE</code> 语句。<code>save()</code> 和 <code>update()</code> 的区别在于一个是将瞬时态对象变成持久态，一个是将游离态对象变为持久态。<code>merge()</code> 方法可以完成 <code>save()</code> 和 <code>update()</code> 方法的功能，它的意图是将新的状态合并到已有的持久化对象上或创建新的持久化对象。对于 <code>persist()</code> 方法，按照官方文档的说明：(1)<code>persist()</code> 方法把一个瞬时态的实例持久化，但是并不保证标识符被立刻填入到持久化实例中，标识符的填入可能被推迟到 <code>flush</code> 的时间；(2)<code>persist()</code> 方法保证当它在一个事务外部被调用的时候并不触发一个 <code>INSERT</code> 语句，当需要封装一个长会话流程的时候，<code>persist()</code> 方法是很有必要的；(3)<code>save()</code> 方法不保证第(2)条，它要返回标识符，所以它会立即执行 <code>INSERT</code> 语句，不管是在事务内部还是外部。至于 <code>lock()</code> 方法和 <code>update()</code> 方法的区别，<code>update()</code> 方法是把一个已经更改过的脱管状态的对象变成持久状态；<code>lock()</code> 方法是把一个没有更改过的脱管状态的对象变成持久状态。</p><blockquote><h3 id="阐述-Session-加载实体对象的过程。"><a href="#阐述-Session-加载实体对象的过程。" class="headerlink" title="阐述 Session 加载实体对象的过程。"></a>阐述 Session 加载实体对象的过程。</h3></blockquote><p>答：Session 加载实体对象的步骤是：</p><ol><li>Session 在调用数据库查询功能之前，首先会在一级缓存中通过实体类型和主键进行查找，如果一级缓存查找命中且数据状态合法，则直接返回；</li><li>如果一级缓存没有命中，接下来 Session 会在当前 <code>NonExists</code> 记录（相当于一个查询黑名单，如果出现重复的无效查询可以迅速做出判断，从而提升性能）中进行查找，如果 <code>NonExists</code> 中存在同样的查询条件，则返回 <code>null</code>；</li><li>如果一级缓存查询失败则查询二级缓存，如果二级缓存命中则直接返回；</li><li>如果之前的查询都未命中，则发出 SQL 语句，如果查询未发现对应记录则将此次查询添加到 Session 的 <code>NonExists</code> 中加以记录，并返回 <code>null</code>；</li><li>根据映射配置和 SQL 语句得到 <code>ResultSet</code>，并创建对应的实体对象；</li><li>将对象纳入 Session（一级缓存）的管理；</li><li>如果有对应的拦截器，则执行拦截器的 <code>onLoad</code> 方法；</li><li>如果开启并设置了要使用二级缓存，则将数据对象纳入二级缓存；</li><li>返回数据对象。</li></ol><blockquote><h3 id="Query-接口的-list-方法和-iterate-方法有什么区别？"><a href="#Query-接口的-list-方法和-iterate-方法有什么区别？" class="headerlink" title="Query 接口的 list 方法和 iterate 方法有什么区别？"></a><code>Query</code> 接口的 <code>list</code> 方法和 <code>iterate</code> 方法有什么区别？</h3></blockquote><p>答：</p><ul><li><code>list()</code> 方法无法利用一级缓存和二级缓存（对缓存只写不读），它只能在开启查询缓存的前提下使用查询缓存；<code>iterate()</code> 方法可以充分利用缓存，如果目标数据只读或者读取频繁，使用 <code>iterate()</code> 方法可以减少性能开销。</li><li><code>list()</code> 方法不会引起 N+1 查询问题，而 <code>iterate()</code> 方法可能引起 N+1 查询问题</li></ul><p><strong>说明：</strong>关于 N+1 查询问题，可以参考 CSDN 的一篇文章<a href="http://blog.csdn.net/xtayhicbladwin/article/details/4739852">《什么是N+1查询》</a></p><blockquote><h3 id="Hibernate-如何实现分页查询？"><a href="#Hibernate-如何实现分页查询？" class="headerlink" title="Hibernate 如何实现分页查询？"></a>Hibernate 如何实现分页查询？</h3></blockquote><p>答：通过 Hibernate 实现分页查询，开发人员只需要提供 HQL 语句（调用 Session 的 <code>createQuery()</code> 方法）或查询条件（调用 Session 的 <code>createCriteria()</code> 方法）、设置查询起始行数（调用 <code>Query</code> 或 <code>Criteria</code> 接口的 <code>setFirstResult()</code> 方法）和最大查询行数（调用 <code>Query</code> 或 <code>Criteria</code> 接口的 <code>setMaxResults()</code> 方法），并调用 <code>Query</code> 或 <code>Criteria</code> 接口的 <code>list()</code> 方法，Hibernate 会自动生成分页查询的 SQL 语句。</p><blockquote><h3 id="锁机制有什么用？简述-Hibernate-的悲观锁和乐观锁机制。"><a href="#锁机制有什么用？简述-Hibernate-的悲观锁和乐观锁机制。" class="headerlink" title="锁机制有什么用？简述 Hibernate 的悲观锁和乐观锁机制。"></a>锁机制有什么用？简述 Hibernate 的悲观锁和乐观锁机制。</h3></blockquote><p>答：有些业务逻辑在执行过程中要求对数据进行排他性的访问，于是需要通过一些机制保证在此过程中数据被锁住不会被外界修改，这就是所谓的锁机制。</p><p>Hibernate 支持悲观锁和乐观锁两种锁机制。</p><ul><li><p>悲观锁，顾名思义悲观的认为在数据处理过程中极有可能存在修改数据的并发事务（包括本系统的其他事务或来自外部系统的事务），于是将处理的数据设置为锁定状态。悲观锁必须依赖数据库本身的锁机制才能真正保证数据访问的排他性，关于数据库的锁机制和事务隔离级别在前面已经讨论过了。</p></li><li><p>乐观锁，顾名思义，对并发事务持乐观态度（认为对数据的并发操作不会经常性的发生），通过更加宽松的锁机制来解决由于悲观锁排他性的数据访问对系统性能造成的严重影响。最常见的乐观锁是通过数据版本标识来实现的，读取数据时获得数据的版本号，更新数据时将此版本号加 1，然后和数据库表对应记录的当前版本号进行比较，如果提交的数据版本号大于数据库中此记录的当前版本号则更新数据，否则认为是过期数据无法更新。Hibernate 中通过 Session 的 <code>get()</code> 和 <code>load()</code> 方法从数据库中加载对象时可以通过参数指定使用悲观锁；而乐观锁可以通过给实体类加整型的版本字段再通过 XML 或 <code>@Version</code> 注解进行配置。</p></li></ul><p><strong>注意：</strong>使用乐观锁会增加了一个版本字段，很明显这需要额外的空间来存储这个版本字段，浪费了空间，但是乐观锁会让系统具有更好的并发性，这是对时间的节省。因此乐观锁也是典型的空间换时间的策略。</p><blockquote><h3 id="阐述实体对象的三种状态以及转换关系。"><a href="#阐述实体对象的三种状态以及转换关系。" class="headerlink" title="阐述实体对象的三种状态以及转换关系。"></a>阐述实体对象的三种状态以及转换关系。</h3></blockquote><p>答：最新的 Hibernate 文档中为 Hibernate 对象定义了四种状态（原来是三种状态，面试的时候基本上问的也是三种状态），分别是：<strong>瞬时态</strong>（new, or transient）、<strong>持久态</strong>（managed, or persistent）、<strong>游状态</strong>（detached）和<strong>移除态</strong>（removed，以前 Hibernate 文档中定义的三种状态中没有移除态），如下图所示，就以前的Hibernate文档中移除态被视为是瞬时态。</p><p><img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="/images/post/java_interview/135.png" alt></p><ul><li><p>瞬时态：当 new 一个实体对象后，这个对象处于瞬时态，即这个对象只是一个保存临时数据的内存区域，如果没有变量引用这个对象，则会被 JVM 的垃圾回收机制回收。这个对象所保存的数据与数据库没有任何关系，除非通过 Session 的 <code>save()</code>、<code>saveOrUpdate()</code>、<code>persist()</code>、<code>merge()</code> 方法把瞬时态对象与数据库关联，并把数据插入或者更新到数据库，这个对象才转换为持久态对象。</p></li><li><p>持久态：持久态对象的实例在数据库中有对应的记录，并拥有一个持久化标识（ID）。对持久态对象进行 <code>delete</code> 操作后，数据库中对应的记录将被删除，那么持久态对象与数据库记录不再存在对应关系，持久态对象变成移除态（可以视为瞬时态）。持久态对象被修改变更后，不会马上同步到数据库，直到数据库事务提交。</p></li><li><p>游离态：当 Session 进行了 <code>close()</code>、<code>clear()</code>、<code>evict()</code> 或 <code>flush()</code> 后，实体对象从持久态变成游离态，对象虽然拥有持久和与数据库对应记录一致的标识值，但是因为对象已经从会话中清除掉，对象不在持久化管理之内，所以处于游离态（也叫脱管态）。游离态的对象与临时状态对象是十分相似的，只是它还含有持久化标识。</p></li></ul><p><strong>注意：</strong>关于这个问题，在 <a href="https://docs.jboss.org/hibernate/orm/4.3/devguide/en-US/html_single/">Hibernate 的官方文档</a>中有更为详细的解读。</p><blockquote><h3 id="如何理解-Hibernate-的延迟加载机制？在实际应用中，延迟加载与-Session-关闭的矛盾是如何处理的？"><a href="#如何理解-Hibernate-的延迟加载机制？在实际应用中，延迟加载与-Session-关闭的矛盾是如何处理的？" class="headerlink" title="如何理解 Hibernate 的延迟加载机制？在实际应用中，延迟加载与 Session 关闭的矛盾是如何处理的？"></a>如何理解 Hibernate 的延迟加载机制？在实际应用中，延迟加载与 Session 关闭的矛盾是如何处理的？</h3></blockquote><p>答：延迟加载就是并不是在读取的时候就把数据加载进来，而是等到使用时再加载。Hibernate 使用了虚拟代理机制实现延迟加载，我们使用 Session 的 <code>load()</code> 方法加载数据或者一对多关联映射在使用延迟加载的情况下从一的一方加载多的一方，得到的都是虚拟代理，简单的说返回给用户的并不是实体本身，而是实体对象的代理。代理对象在用户调用 <code>getter</code> 方法时才会去数据库加载数据。但加载数据就需要数据库连接。而当我们把会话关闭时，数据库连接就同时关闭了。</p><p>延迟加载与 session 关闭的矛盾一般可以这样处理：</p><ol><li>关闭延迟加载特性。这种方式操作起来比较简单，因为 Hibernate 的延迟加载特性是可以通过映射文件或者注解进行配置的，但这种解决方案存在明显的缺陷。首先，出现 &quot;no session or session was closed&quot; 通常说明系统中已经存在主外键关联，如果去掉延迟加载的话，每次查询的开销都会变得很大。</li><li>在 session 关闭之前先获取需要查询的数据，可以使用工具方法 <code>Hibernate.isInitialized()</code> 判断对象是否被加载，如果没有被加载则可以使用 <code>Hibernate.initialize()</code> 方法加载对象。</li><li>使用拦截器或过滤器延长 Session 的生命周期直到视图获得数据。Spring 整合 Hibernate 提供的 <code>OpenSessionInViewFilter</code> 和 <code>OpenSessionInViewInterceptor</code> 就是这种做法。</li></ol><blockquote><h3 id="举一个多对多关联的例子，并说明如何实现多对多关联映射。"><a href="#举一个多对多关联的例子，并说明如何实现多对多关联映射。" class="headerlink" title="举一个多对多关联的例子，并说明如何实现多对多关联映射。"></a>举一个多对多关联的例子，并说明如何实现多对多关联映射。</h3></blockquote><p>答：例如：商品和订单、学生和课程都是典型的多对多关系。可以在实体类上通过 <code>@ManyToMany</code> 注解配置多对多关联或者通过映射文件中的和标签配置多对多关联，但是实际项目开发中，很多时候都是将多对多关联映射转换成两个多对一关联映射来实现的。</p><blockquote><h3 id="谈一下你对继承映射的理解。"><a href="#谈一下你对继承映射的理解。" class="headerlink" title="谈一下你对继承映射的理解。"></a>谈一下你对继承映射的理解。</h3></blockquote><p>答：继承关系的映射策略有三种：</p><ul><li>每个继承结构一张表（table per class hierarchy），不管多少个子类都用一张表。</li><li>每个子类一张表（table per subclass），公共信息放一张表，特有信息放单独的表。</li><li>每个具体类一张表（table per concrete class），有多少个子类就有多少张表。</li></ul><p>第一种方式属于单表策略，其优点在于查询子类对象的时候无需表连接，查询速度快，适合多态查询；缺点是可能导致表很大。后两种方式属于多表策略，其优点在于数据存储紧凑，其缺点是需要进行连接查询，不适合多态查询。</p><blockquote><h3 id="简述-Hibernate-常见优化策略。"><a href="#简述-Hibernate-常见优化策略。" class="headerlink" title="简述 Hibernate 常见优化策略。"></a>简述 Hibernate 常见优化策略。</h3></blockquote><p>答：这个问题应当挑自己使用过的优化策略回答，常用的有：</p><ul><li>制定合理的缓存策略（二级缓存、查询缓存）。</li><li>采用合理的 Session 管理机制。</li><li>尽量使用延迟加载特性。</li><li>设定合理的批处理参数。</li><li>如果可以，选用 UUID 作为主键生成器。</li><li>如果可以，选用基于版本号的乐观锁替代悲观锁。</li><li>在开发过程中, 开启 <code>hibernate.show_sql</code> 选项查看生成的 SQL，从而了解底层的状况；开发完成后关闭此选项。</li><li>考虑数据库本身的优化，合理的索引、恰当的数据分区策略等都会对持久层的性能带来可观的提升，但这些需要专业的 DBA（数据库管理员）提供支持。</li></ul><blockquote><h3 id="谈一谈-Hibernate-的一级缓存、二级缓存和查询缓存。"><a href="#谈一谈-Hibernate-的一级缓存、二级缓存和查询缓存。" class="headerlink" title="谈一谈 Hibernate 的一级缓存、二级缓存和查询缓存。"></a>谈一谈 Hibernate 的一级缓存、二级缓存和查询缓存。</h3></blockquote><p>答：Hibernate 的 Session 提供了一级缓存的功能，默认总是有效的，当应用程序保存持久化实体、修改持久化实体时，Session 并不会立即把这种改变提交到数据库，而是缓存在当前的 Session 中，除非显示调用了 Session 的 <code>flush()</code> 方法或通过 <code>close()</code> 方法关闭 Session。通过一级缓存，可以减少程序与数据库的交互，从而提高数据库访问性能。</p><p>SessionFactory 级别的二级缓存是全局性的，所有的 Session 可以共享这个二级缓存。不过二级缓存默认是关闭的，需要显示开启并指定需要使用哪种二级缓存实现类（可以使用第三方提供的实现）。一旦开启了二级缓存并设置了需要使用二级缓存的实体类，SessionFactory 就会缓存访问过的该实体类的每个对象，除非缓存的数据超出了指定的缓存空间。</p><p>一级缓存和二级缓存都是对整个实体进行缓存，不会缓存普通属性，如果希望对普通属性进行缓存，可以使用查询缓存。查询缓存是将HQL或SQL语句以及它们的查询结果作为键值对进行缓存，对于同样的查询可以直接从缓存中获取数据。查询缓存默认也是关闭的，需要显示开启。</p><blockquote><h3 id="Hibernate-中-DetachedCriteria-类是做什么的？"><a href="#Hibernate-中-DetachedCriteria-类是做什么的？" class="headerlink" title="Hibernate 中 DetachedCriteria 类是做什么的？"></a>Hibernate 中 DetachedCriteria 类是做什么的？</h3></blockquote><p>答：DetachedCriteria 和 Criteria 的用法基本上是一致的，但 Criteria 是由 Session 的 <code>createCriteria()</code> 方法创建的，也就意味着离开创建它的 Session，Criteria 就无法使用了。DetachedCriteria 不需要 Session 就可以创建（使用 <code>DetachedCriteria.forClass()</code> 方法创建），所以通常也称其为离线的 Criteria，在需要进行查询操作的时候再和 Session 绑定（调用其 <code>getExecutableCriteria(Session)</code> 方法），这也就意味着一个 DetachedCriteria 可以在需要的时候和不同的 Session 进行绑定。</p><blockquote><h3 id="OneToMany-注解的-mappedBy-属性有什么作用？"><a href="#OneToMany-注解的-mappedBy-属性有什么作用？" class="headerlink" title="@OneToMany 注解的 mappedBy 属性有什么作用？"></a><code>@OneToMany</code> 注解的 <code>mappedBy</code> 属性有什么作用？</h3></blockquote><p>答：<code>@OneToMany</code> 用来配置一对多关联映射，但通常情况下，一对多关联映射都由多的一方来维护关联关系，例如学生和班级，应该在学生类中添加班级属性来维持学生和班级的关联关系（在数据库中是由学生表中的外键班级编号来维护学生表和班级表的多对一关系），如果要使用双向关联，在班级类中添加一个容器属性来存放学生，并使用 <code>@OneToMany</code> 注解进行映射，此时 <code>mappedBy</code> 属性就非常重要。如果使用 XML 进行配置，可以用 <code>&lt;set&gt;</code> 标签的 <code>inverse=&quot;true&quot;</code> 设置来达到同样的效果。</p><blockquote><h3 id="MyBatis-中使用-和-书写占位符有什么区别？"><a href="#MyBatis-中使用-和-书写占位符有什么区别？" class="headerlink" title="MyBatis 中使用 # 和 $ 书写占位符有什么区别？"></a><code>MyBatis</code> 中使用 <code>#</code> 和 <code>$</code> 书写占位符有什么区别？</h3></blockquote><p>答：<code>#</code> 将传入的数据都当成一个字符串，会对传入的数据自动加上引号；<code>$</code> 将传入的数据直接显示生成在SQL中。</p><p><strong>注意：</strong>使用 <script type="math/tex">` 占位符可能会导致 SQL 注射攻击，能用 `#` 的地方就不要使用 `</script>，写 <code>order by</code> 子句的时候应该用 <code>$</code> 而不是 <code>#</code>。</p><blockquote><h3 id="解释一下-MyBatis-中命名空间（namespace）的作用。"><a href="#解释一下-MyBatis-中命名空间（namespace）的作用。" class="headerlink" title="解释一下 MyBatis 中命名空间（namespace）的作用。"></a>解释一下 MyBatis 中命名空间（namespace）的作用。</h3></blockquote><p>答：在大型项目中，可能存在大量的 SQL 语句，这时候为每个 SQL 语句起一个唯一的标识（ID）就变得并不容易了。为了解决这个问题，在 MyBatis 中，可以为每个映射文件起一个唯一的命名空间，这样定义在这个映射文件中的每个 SQL 语句就成了定义在这个命名空间中的一个 ID。只要我们能够保证每个命名空间中这个 ID 是唯一的，即使在不同映射文件中的语句 ID 相同，也不会再产生冲突了。</p><blockquote><h3 id="MyBatis-中的动态-SQL-是什么意思？"><a href="#MyBatis-中的动态-SQL-是什么意思？" class="headerlink" title="MyBatis 中的动态 SQL 是什么意思？"></a>MyBatis 中的动态 SQL 是什么意思？</h3></blockquote><p>答：对于一些复杂的查询，我们可能会指定多个查询条件，但是这些条件可能存在也可能不存在，例如在 58 同城上面找房子，我们可能会指定面积、楼层和所在位置来查找房源，也可能会指定面积、价格、户型和所在位置来查找房源，此时就需要根据用户指定的条件动态生成 SQL 语句。如果不使用持久层框架我们可能需要自己拼装 SQL 语句，还好 MyBatis 提供了动态 SQL 的功能来解决这个问题。MyBatis 中用于实现动态 SQL 的元素主要有：</p><ul><li>if</li><li>choose / when / otherwise</li><li>trim</li><li>where</li><li>set</li><li>foreach</li></ul><p>下面是映射文件的片段。</p><p><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>foo<span class="token punctuation">"</span></span> <span class="token attr-name">parameterType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Blog<span class="token punctuation">"</span></span> <span class="token attr-name">resultType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Blog<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>     select * from t_blog where 1 = 1     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>if</span> <span class="token attr-name">test</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>title != null<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>         and title = #&#123;title&#125;     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>if</span><span class="token punctuation">></span></span>     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>if</span> <span class="token attr-name">test</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>content != null<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>         and content = #&#123;content&#125;     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>if</span><span class="token punctuation">></span></span>     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>if</span> <span class="token attr-name">test</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>owner != null<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>         and owner = #&#123;owner&#125;     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>if</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p>当然也可以像下面这些书写。</p><p><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>foo<span class="token punctuation">"</span></span> <span class="token attr-name">parameterType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Blog<span class="token punctuation">"</span></span> <span class="token attr-name">resultType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Blog<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    select * from t_blog where 1 = 1     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>choose</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>when</span> <span class="token attr-name">test</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>title != null<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            and title = #&#123;title&#125;        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>when</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>when</span> <span class="token attr-name">test</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>content != null<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            and content = #&#123;content&#125;        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>when</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>otherwise</span><span class="token punctuation">></span></span>            and owner = "owner1"        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>otherwise</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>choose</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p>再看看下面这个例子。</p><p><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>bar<span class="token punctuation">"</span></span> <span class="token attr-name">resultType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Blog<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    select * from t_blog where id in    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>foreach</span> <span class="token attr-name">collection</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>array<span class="token punctuation">"</span></span> <span class="token attr-name">index</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>index<span class="token punctuation">"</span></span> <span class="token attr-name">item</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>item<span class="token punctuation">"</span></span> <span class="token attr-name">open</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>(<span class="token punctuation">"</span></span> <span class="token attr-name">separator</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>,<span class="token punctuation">"</span></span> <span class="token attr-name">close</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>)<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        #&#123;item&#125;    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>foreach</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><blockquote><h3 id="什么是-IoC-和-DI？DI-是如何实现的？"><a href="#什么是-IoC-和-DI？DI-是如何实现的？" class="headerlink" title="什么是 IoC 和 DI？DI 是如何实现的？"></a>什么是 IoC 和 DI？DI 是如何实现的？</h3></blockquote><p>答：IoC 叫控制反转，是 Inversion of Control 的缩写，DI（Dependency Injection）叫依赖注入，是对 IoC 更简单的诠释。控制反转是把传统上由程序代码直接操控的对象的调用权交给容器，通过容器来实现对象组件的装配和管理。所谓的“控制反转”就是对组件对象控制权的转移，从程序代码本身转移到了外部容器，由容器来创建对象并管理对象之间的依赖关系。 IoC 体现了好莱坞原则 - &quot;Don’t call me, we will call you&quot;。依赖注入的基本原则是应用组件不应该负责查找资源或者其他依赖的协作对象。配置对象的工作应该由容器负责，查找资源的逻辑应该从应用组件的代码中抽取出来，交给容器来完成。DI 是对 IoC 更准确的描述，即组件之间的依赖关系由容器在运行期决定，形象的来说，即由容器动态的将某种依赖关系注入到组件之中。</p><p>举个例子：一个类 A 需要用到接口 B 中的方法，那么就需要为类 A 和接口 B 建立关联或依赖关系，最原始的方法是在类 A 中创建一个接口 B 的实现类 C 的实例，但这种方法需要开发人员自行维护二者的依赖关系，也就是说当依赖关系发生变动的时候需要修改代码并重新构建整个系统。如果通过一个容器来管理这些对象以及对象的依赖关系，则只需要在类 A 中定义好用于关联接口 B 的方法（构造器或 setter 方法），将类 A 和接口 B 的实现类 C 放入容器中，通过对容器的配置来实现二者的关联。</p><p>依赖注入可以通过 setter 方法注入（设值注入）、构造器注入和接口注入三种方式来实现，Spring 支持 setter 注入和构造器注入，通常使用构造器注入来注入必须的依赖关系，对于可选的依赖关系，则 setter 注入是更好的选择，setter 注入需要类提供无参构造器或者无参的静态工厂方法来创建对象。</p><blockquote><h3 id="Spring-中-Bean-的作用域有哪些？"><a href="#Spring-中-Bean-的作用域有哪些？" class="headerlink" title="Spring 中 Bean 的作用域有哪些？"></a>Spring 中 Bean 的作用域有哪些？</h3></blockquote><p>答：在 Spring 的早期版本中，仅有两个作用域：<code>singleton</code> 和 <code>prototype</code>，前者表示 Bean 以单例的方式存在；后者表示每次从容器中调用 Bean 时，都会返回一个新的实例，<code>prototype</code> 通常翻译为原型。</p><p><strong>补充：</strong>设计模式中的创建型模式中也有一个原型模式，原型模式也是一个常用的模式，例如做一个室内设计软件，所有的素材都在工具箱中，而每次从工具箱中取出的都是素材对象的一个原型，可以通过对象克隆来实现原型模式。</p><p>Spring 2.x 中针对 <code>WebApplicationContext</code> 新增了3个作用域，分别是：<code>request</code>（每次HTTP请求都会创建一个新的Bean）、<code>session</code>（同一个 HttpSession 共享同一个 Bean，不同的 HttpSession 使用不同的 Bean）和 <code>globalSession</code>（同一个全局 Session 共享一个 Bean）。</p><p><strong>说明：</strong>单例模式和原型模式都是重要的设计模式。一般情况下，无状态或状态不可变的类适合使用单例模式。在传统开发中，由于 DAO 持有 Connection 这个非线程安全对象因而没有使用单例模式；但在 Spring 环境下，所有 DAO 类对可以采用单例模式，因为 Spring 利用 AOP 和 Java API 中的 ThreadLocal 对非线程安全的对象进行了特殊处理。</p><p>ThreadLocal 为解决多线程程序的并发问题提供了一种新的思路。ThreadLocal，顾名思义是线程的一个本地化对象，当工作于多线程中的对象使用 ThreadLocal 维护变量时，ThreadLocal 为每个使用该变量的线程分配一个独立的变量副本，所以每一个线程都可以独立的改变自己的副本，而不影响其他线程所对应的副本。从线程的角度看，这个变量就像是线程的本地变量。</p><p>ThreadLocal 类非常简单好用，只有四个方法，能用上的也就是下面三个方法：</p><ul><li><code>void set(T value)</code>：设置当前线程的线程局部变量的值。</li><li><code>T get()</code>：获得当前线程所对应的线程局部变量的值。</li><li><code>void remove()</code>：删除当前线程中线程局部变量的值。</li></ul><p>ThreadLocal 是如何做到为每一个线程维护一份独立的变量副本的呢？在 ThreadLocal 类中有一个 <code>Map</code>，键为线程对象，值是其线程对应的变量的副本，自己要模拟实现一个ThreadLocal 类其实并不困难，代码如下所示：</p><p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Collections</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">HashMap</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Map</span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyThreadLocal</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">></span></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Thread</span><span class="token punctuation">,</span> <span class="token class-name">T</span><span class="token punctuation">></span></span> map <span class="token operator">=</span> <span class="token class-name">Collections</span><span class="token punctuation">.</span><span class="token function">synchronizedMap</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Thread</span><span class="token punctuation">,</span> <span class="token class-name">T</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">set</span><span class="token punctuation">(</span><span class="token class-name">T</span> newValue<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> newValue<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token class-name">T</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> map<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        map<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><blockquote><h3 id="解释一下什么叫-AOP（面向切面编程）？"><a href="#解释一下什么叫-AOP（面向切面编程）？" class="headerlink" title="解释一下什么叫 AOP（面向切面编程）？"></a>解释一下什么叫 AOP（面向切面编程）？</h3></blockquote><p>答：AOP（Aspect-Oriented Programming）指一种程序设计范型，该范型以一种称为切面（aspect）的语言构造为基础，切面是一种新的模块化机制，用来描述分散在对象、类或方法中的横切关注点（crosscutting concern）。</p><blockquote><h3 id="你是如何理解“横切关注”这个概念的？"><a href="#你是如何理解“横切关注”这个概念的？" class="headerlink" title="你是如何理解“横切关注”这个概念的？"></a>你是如何理解“横切关注”这个概念的？</h3></blockquote><p>答：“横切关注”是会影响到整个应用程序的关注功能，它跟正常的业务逻辑是正交的，没有必然的联系，但是几乎所有的业务逻辑都会涉及到这些关注功能。通常，事务、日志、安全性等关注就是应用中的横切关注功能。</p><blockquote><h3 id="你如何理解-AOP-中的连接点（Joinpoint）、切点（Pointcut）、增强（Advice）、引介（Introduction）、织入（Weaving）、切面（Aspect）这些概念？"><a href="#你如何理解-AOP-中的连接点（Joinpoint）、切点（Pointcut）、增强（Advice）、引介（Introduction）、织入（Weaving）、切面（Aspect）这些概念？" class="headerlink" title="你如何理解 AOP 中的连接点（Joinpoint）、切点（Pointcut）、增强（Advice）、引介（Introduction）、织入（Weaving）、切面（Aspect）这些概念？"></a>你如何理解 AOP 中的连接点（Joinpoint）、切点（Pointcut）、增强（Advice）、引介（Introduction）、织入（Weaving）、切面（Aspect）这些概念？</h3></blockquote><p>答：</p><ul><li>连接点（Joinpoint）：程序执行的某个特定位置（如：某个方法调用前、调用后，方法抛出异常后）。一个类或一段程序代码拥有一些具有边界性质的特定点，这些代码中的特定点就是连接点。Spring 仅支持方法的连接点。</li><li>切点（Pointcut）：如果连接点相当于数据中的记录，那么切点相当于查询条件，一个切点可以匹配多个连接点。Spring AOP 的规则解析引擎负责解析切点所设定的查询条件，找到对应的连接点。</li><li>增强（Advice）：增强是织入到目标类连接点上的一段程序代码。Spring 提供的增强接口都是带方位名的，如：BeforeAdvice、AfterReturningAdvice、ThrowsAdvice 等。很多资料上将增强译为“通知”，这明显是个词不达意的翻译，让很多程序员困惑了许久。</li></ul><p><strong>说明：</strong> Advice 在国内的很多书面资料中都被翻译成&quot;通知&quot;，但是很显然这个翻译无法表达其本质，有少量的读物上将这个词翻译为&quot;增强&quot;，这个翻译是对 Advice 较为准确的诠释，我们通过 AOP 将横切关注功能加到原有的业务逻辑上，这就是对原有业务逻辑的一种增强，这种增强可以是前置增强、后置增强、返回后增强、抛异常时增强和包围型增强。</p><ul><li>引介（Introduction）：引介是一种特殊的增强，它为类添加一些属性和方法。这样，即使一个业务类原本没有实现某个接口，通过引介功能，可以动态的未该业务类添加接口的实现逻辑，让业务类成为这个接口的实现类。</li><li>织入（Weaving）：织入是将增强添加到目标类具体连接点上的过程，AOP 有三种织入方式：<ul><li>编译期织入：需要特殊的 Java 编译期（例如 AspectJ 的 ajc）；</li><li>装载期织入：要求使用特殊的类加载器，在装载类的时候对类进行增强；</li><li>运行时织入：在运行时为目标类生成代理实现增强。Spring 采用了动态代理的方式实现了运行时织入，而 AspectJ 采用了编译期织入和装载期织入的方式。</li></ul></li><li>切面（Aspect）：切面是由切点和增强（引介）组成的，它包括了对横切关注功能的定义，也包括了对连接点的定义。</li></ul><p><strong>补充：</strong>代理模式是 GoF 提出的 23 种设计模式中最为经典的模式之一，代理模式是对象的结构模式，它给某一个对象提供一个代理对象，并由代理对象控制对原对象的引用。简单的说，代理对象可以完成比原对象更多的职责，当需要为原对象添加横切关注功能时，就可以使用原对象的代理对象。我们在打开 Office 系列的 Word 文档时，如果文档中有插图，当文档刚加载时，文档中的插图都只是一个虚框占位符，等用户真正翻到某页要查看该图片时，才会真正加载这张图，这其实就是对代理模式的使用，代替真正图片的虚框就是一个虚拟代理； Hibernate 的 <code>load</code> 方法也是返回一个虚拟代理对象，等用户真正需要访问对象的属性时，才向数据库发出 SQL 语句获得真实对象。</p><p>下面用一个找枪手代考的例子演示代理模式的使用：</p><p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/** * 参考人员接口 */</span><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Candidate</span> <span class="token punctuation">&#123;</span>    <span class="token comment">/**     * 答题     */</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">answerTheQuestions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/** * 懒学生 */</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LazyStudent</span> <span class="token keyword">implements</span> <span class="token class-name">Candidate</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>        <span class="token comment">// 姓名</span>    <span class="token keyword">public</span> <span class="token class-name">LazyStudent</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">answerTheQuestions</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">// 懒学生只能写出自己的名字不会答题</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"姓名: "</span> <span class="token operator">+</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/** * 枪手 */</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Gunman</span> <span class="token keyword">implements</span> <span class="token class-name">Candidate</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token class-name">Candidate</span> target<span class="token punctuation">;</span>     <span class="token comment">// 被代理对象</span>    <span class="token keyword">public</span> <span class="token class-name">Gunman</span><span class="token punctuation">(</span><span class="token class-name">Candidate</span> target<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>target <span class="token operator">=</span> target<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">answerTheQuestions</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">// 枪手要写上代考的学生的姓名</span>        target<span class="token punctuation">.</span><span class="token function">answerTheQuestions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// 枪手要帮助懒学生答题并交卷</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"奋笔疾书正确答案"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"交卷"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ProxyTest1</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">Candidate</span> c <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Gunman</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">LazyStudent</span><span class="token punctuation">(</span><span class="token string">"王小二"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        c<span class="token punctuation">.</span><span class="token function">answerTheQuestions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p><strong>说明：</strong>从 JDK 1.3 开始，Java 提供了动态代理技术，允许开发者在运行时创建接口的代理实例，主要包括 <code>Proxy</code> 类和 <code>InvocationHandler</code> 接口。下面的例子使用动态代理为 <code>ArrayList</code> 编写一个代理，在添加和删除元素时，在控制台打印添加或删除的元素以及 <code>ArrayList</code> 的大小：</p><p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span><span class="token class-name">InvocationHandler</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span><span class="token class-name">Method</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ListProxy</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">></span></span> <span class="token keyword">implements</span> <span class="token class-name">InvocationHandler</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">></span></span> target<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token class-name">ListProxy</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">></span></span> target<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>target <span class="token operator">=</span> target<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">invoke</span><span class="token punctuation">(</span><span class="token class-name">Object</span> proxy<span class="token punctuation">,</span> <span class="token class-name">Method</span> method<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span>            <span class="token keyword">throws</span> <span class="token class-name">Throwable</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">Object</span> retVal <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"["</span> <span class="token operator">+</span> method<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">": "</span> <span class="token operator">+</span> args<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">"]"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        retVal <span class="token operator">=</span> method<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"[size="</span> <span class="token operator">+</span> target<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"]"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> retVal<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span><span class="token class-name">Proxy</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">ArrayList</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ProxyTest2</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@SuppressWarnings</span><span class="token punctuation">(</span><span class="token string">"unchecked"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">></span></span> clazz <span class="token operator">=</span> list<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">ListProxy</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> myProxy <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ListProxy</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span><span class="token punctuation">(</span>list<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> newList <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span><span class="token punctuation">)</span>                 <span class="token class-name">Proxy</span><span class="token punctuation">.</span><span class="token function">newProxyInstance</span><span class="token punctuation">(</span>clazz<span class="token punctuation">.</span><span class="token function">getClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                 clazz<span class="token punctuation">.</span><span class="token function">getInterfaces</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> myProxy<span class="token punctuation">)</span><span class="token punctuation">;</span>        newList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"apple"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        newList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"banana"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        newList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"orange"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        newList<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token string">"banana"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p><strong>说明：</strong>使用 Java 的动态代理有一个局限性就是代理的类必须要实现接口，虽然面向接口编程是每个优秀的 Java 程序都知道的规则，但现实往往不尽如人意，对于没有实现接口的类如何为其生成代理呢？继承！继承是最经典的扩展已有代码能力的手段，虽然继承常常被初学者滥用，但继承也常常被进阶的程序员忽视。CGLib 采用非常底层的字节码生成技术，通过为一个类创建子类来生成代理，它弥补了 Java 动态代理的不足，因此 Spring 中动态代理和 CGLib 都是创建代理的重要手段，对于实现了接口的类就用动态代理为其生成代理类，而没有实现接口的类就用 CGLib 通过继承的方式为其创建代理。</p><blockquote><h3 id="Spring-中自动装配的方式有哪些？"><a href="#Spring-中自动装配的方式有哪些？" class="headerlink" title="Spring 中自动装配的方式有哪些？"></a>Spring 中自动装配的方式有哪些？</h3></blockquote><p>答：</p><ul><li><code>no</code>：不进行自动装配，手动设置 Bean 的依赖关系。</li><li><code>byName</code>：根据 Bean 的名字进行自动装配。</li><li><code>byType</code>：根据 Bean 的类型进行自动装配。</li><li><code>constructor</code>：类似于 <code>byType</code>，不过是应用于构造器的参数，如果正好有一个 Bean 与构造器的参数类型相同则可以自动装配，否则会导致错误。</li><li><code>autodetect</code>：如果有默认的构造器，则通过 <code>constructor</code> 的方式进行自动装配，否则使用 <code>byType</code> 的方式进行自动装配。</li></ul><p><strong>说明：</strong>自动装配没有自定义装配方式那么精确，而且不能自动装配简单属性（基本类型、字符串等），在使用时应注意。</p><blockquote><h3 id="Spring-中如何使用注解来配置-Bean？有哪些相关的注解？"><a href="#Spring-中如何使用注解来配置-Bean？有哪些相关的注解？" class="headerlink" title="Spring 中如何使用注解来配置 Bean？有哪些相关的注解？"></a>Spring 中如何使用注解来配置 Bean？有哪些相关的注解？</h3></blockquote><p>答：首先需要在 Spring 配置文件中增加如下配置：</p><p><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">context:</span>component-scan</span> <span class="token attr-name">base-package</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>org.example<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><p>然后可以用 <code>@Component</code>、<code>@Controller</code>、<code>@Service</code>、<code>@Repository</code> 注解来标注需要由 Spring IoC 容器进行对象托管的类。这几个注解没有本质区别，只不过 <code>@Controller</code> 通常用于控制器，<code>@Service</code> 通常用于业务逻辑类，<code>@Repository</code> 通常用于仓储类（例如我们的 DAO 实现类），普通的类用 <code>@Component</code> 来标注。</p><blockquote><h3 id="Spring-支持的事务管理类型有哪些？你在项目中使用哪种方式？"><a href="#Spring-支持的事务管理类型有哪些？你在项目中使用哪种方式？" class="headerlink" title="Spring 支持的事务管理类型有哪些？你在项目中使用哪种方式？"></a>Spring 支持的事务管理类型有哪些？你在项目中使用哪种方式？</h3></blockquote><p>答：Spring 支持<strong>编程式</strong>事务管理和<strong>声明式</strong>事务管理。许多 Spring 框架的用户选择声明式事务管理，因为这种方式和应用程序的关联较少，因此更加符合轻量级容器的概念。声明式事务管理要优于编程式事务管理，尽管在灵活性方面它弱于编程式事务管理，因为编程式事务允许你通过代码控制业务。</p><p>事务分为<strong>全局事务</strong>和<strong>局部事务</strong>。全局事务由应用服务器管理，需要底层服务器 JTA 支持（如 WebLogic、WildFly 等）。局部事务和底层采用的持久化方案有关，例如使用 JDBC 进行持久化时，需要使用 Connetion 对象来操作事务；而采用 Hibernate 进行持久化时，需要使用 Session 对象来操作事务。</p><p>Spring 提供了如下所示的事务管理器。</p><div class="table-container"><table><thead><tr><th>事务管理器实现类</th><th>目标对象</th></tr></thead><tbody><tr><td>DataSourceTransactionManager</td><td>注入 DataSource</td></tr><tr><td>HibernateTransactionManager</td><td>注入 SessionFactory</td></tr><tr><td>JdoTransactionManager</td><td>管理 JDO 事务</td></tr><tr><td>JtaTransactionManager</td><td>使用 JTA 管理事务</td></tr><tr><td>PersistenceBrokerTransactionManager</td><td>管理 Apache 的 OJB 事务</td></tr></tbody></table></div><p>这些事务的父接口都是 <code>PlatformTransactionManager</code>。Spring 的事务管理机制是一种典型的策略模式，<code>PlatformTransactionManager</code> 代表事务管理接口，该接口定义了三个方法，该接口并不知道底层如何管理事务，但是它的实现类必须提供 <code>getTransaction()</code> 方法（开启事务）、<code>commit()</code> 方法（提交事务）、<code>rollback()</code> 方法（回滚事务）的多态实现，这样就可以用不同的实现类代表不同的事务管理策略。使用 JTA 全局事务策略时，需要底层应用服务器支持，而不同的应用服务器所提供的 JTA 全局事务可能存在细节上的差异，因此实际配置全局事务管理器是可能需要使用 <code>JtaTransactionManager</code> 的子类，如：<code>WebLogicJtaTransactionManager</code>（Oracle 的 WebLogic 服务器提供）、<code>UowJtaTransactionManager</code>（IBM 的 WebSphere 服务器提供）等。</p><p>编程式事务管理如下所示。</p><p><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8"?></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>beans</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.springframework.org/schema/beans<span class="token punctuation">"</span></span>     <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">"</span></span>  <span class="token attr-name"><span class="token namespace">xmlns:</span>p</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.springframework.org/schema/p<span class="token punctuation">"</span></span>    <span class="token attr-name"><span class="token namespace">xmlns:</span>p</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.springframework.org/schema/context<span class="token punctuation">"</span></span>     <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd     http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">context:</span>component-scan</span> <span class="token attr-name">base-package</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.jackfrued<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>propertyConfig<span class="token punctuation">"</span></span>         <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>org.springframework.beans.factory.config.PropertyPlaceholderConfigurer<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>location<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>             <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">></span></span>jdbc.properties<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">></span></span>         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">></span></span>     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">></span></span>     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>dataSource<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>org.apache.commons.dbcp.BasicDataSource<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>driverClassName<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>             <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">></span></span>$&#123;db.driver&#125;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">></span></span>         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">></span></span>         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>url<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>             <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">></span></span>$&#123;db.url&#125;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">></span></span>         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">></span></span>         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>username<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>             <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">></span></span>$&#123;db.username&#125;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">></span></span>         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">></span></span>         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>password<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>             <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">></span></span>$&#123;db.password&#125;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">></span></span>         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">></span></span>     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">></span></span>     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>jdbcTemplate<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>org.springframework.jdbc.core.JdbcTemplate<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>dataSource<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>             <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ref</span> <span class="token attr-name">bean</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>dataSource<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">></span></span>     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">></span></span>     <span class="token comment">&lt;!-- JDBC事务管理器 --></span>     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>transactionManager<span class="token punctuation">"</span></span>         <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>org.springframework.jdbc.datasource.DataSourceTransactionManager<span class="token punctuation">"</span></span>　<span class="token attr-name">scope</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>singleton<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>dataSource<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>             <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ref</span> <span class="token attr-name">bean</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>dataSource<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">></span></span>     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">></span></span>     <span class="token comment">&lt;!-- 声明事务模板 --></span>     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>transactionTemplate<span class="token punctuation">"</span></span>         <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>org.springframework.transaction.support.TransactionTemplate<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>transactionManager<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>             <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ref</span> <span class="token attr-name">bean</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>transactionManager<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">></span></span>     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>beans</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>jackfrued<span class="token punctuation">.</span>dao<span class="token punctuation">.</span>impl</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>jdbc<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">JdbcTemplate</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>jackfrued<span class="token punctuation">.</span>dao<span class="token punctuation">.</span></span><span class="token class-name">EmpDao</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>jackfrued<span class="token punctuation">.</span>entity<span class="token punctuation">.</span></span><span class="token class-name">Emp</span><span class="token punctuation">;</span><span class="token annotation punctuation">@Repository</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">EmpDaoImpl</span> <span class="token keyword">implements</span> <span class="token class-name">EmpDao</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Autowired</span>    <span class="token keyword">private</span> <span class="token class-name">JdbcTemplate</span> jdbcTemplate<span class="token punctuation">;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">save</span><span class="token punctuation">(</span><span class="token class-name">Emp</span> emp<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">String</span> sql <span class="token operator">=</span> <span class="token string">"insert into emp values (?,?,?)"</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> jdbcTemplate<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>sql<span class="token punctuation">,</span> emp<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> emp<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> emp<span class="token punctuation">.</span><span class="token function">getBirthday</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>jackfrued<span class="token punctuation">.</span>biz<span class="token punctuation">.</span>impl</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Service</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>transaction<span class="token punctuation">.</span></span><span class="token class-name">TransactionStatus</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>transaction<span class="token punctuation">.</span>support<span class="token punctuation">.</span></span><span class="token class-name">TransactionCallbackWithoutResult</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>transaction<span class="token punctuation">.</span>support<span class="token punctuation">.</span></span><span class="token class-name">TransactionTemplate</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>jackfrued<span class="token punctuation">.</span>biz<span class="token punctuation">.</span></span><span class="token class-name">EmpService</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>jackfrued<span class="token punctuation">.</span>dao<span class="token punctuation">.</span></span><span class="token class-name">EmpDao</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>jackfrued<span class="token punctuation">.</span>entity<span class="token punctuation">.</span></span><span class="token class-name">Emp</span><span class="token punctuation">;</span><span class="token annotation punctuation">@Service</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">EmpServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">EmpService</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Autowired</span>    <span class="token keyword">private</span> <span class="token class-name">TransactionTemplate</span> txTemplate<span class="token punctuation">;</span>    <span class="token annotation punctuation">@Autowired</span>    <span class="token keyword">private</span> <span class="token class-name">EmpDao</span> empDao<span class="token punctuation">;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">addEmp</span><span class="token punctuation">(</span><span class="token keyword">final</span> <span class="token class-name">Emp</span> emp<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        txTemplate<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">TransactionCallbackWithoutResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token annotation punctuation">@Override</span>            <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">doInTransactionWithoutResult</span><span class="token punctuation">(</span><span class="token class-name">TransactionStatus</span> txStatus<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                empDao<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>emp<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p>声明式事务如下图所示，以 Spring 整合 Hibernate 3 为例，包括完整的 DAO 和业务逻辑代码。</p><p><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8"?></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>beans</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.springframework.org/schema/beans<span class="token punctuation">"</span></span>    <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">"</span></span>     <span class="token attr-name"><span class="token namespace">xmlns:</span>p</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.springframework.org/schema/p<span class="token punctuation">"</span></span>    <span class="token attr-name"><span class="token namespace">xmlns:</span>context</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.springframework.org/schema/context<span class="token punctuation">"</span></span>    <span class="token attr-name"><span class="token namespace">xmlns:</span>aop</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.springframework.org/schema/aop<span class="token punctuation">"</span></span>     <span class="token attr-name"><span class="token namespace">xmlns:</span>tx</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.springframework.org/schema/tx<span class="token punctuation">"</span></span>    <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.springframework.org/schema/beans           http://www.springframework.org/schema/beans/spring-beans-3.2.xsd           http://www.springframework.org/schema/context           http://www.springframework.org/schema/context/spring-context-3.2.xsd           http://www.springframework.org/schema/aop           http://www.springframework.org/schema/aop/spring-aop-3.2.xsd           http://www.springframework.org/schema/tx           http://www.springframework.org/schema/tx/spring-tx-3.2.xsd<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token comment">&lt;!-- 配置由Spring IoC容器托管的对象对应的被注解的类所在的包 --></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">context:</span>component-scan</span> <span class="token attr-name">base-package</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.jackfrued<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>    <span class="token comment">&lt;!-- 配置通过自动生成代理实现AOP功能 --></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">aop:</span>aspectj-autoproxy</span> <span class="token punctuation">/></span></span>    <span class="token comment">&lt;!-- 配置数据库连接池 (DBCP) --></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>dataSource<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>org.apache.commons.dbcp.BasicDataSource<span class="token punctuation">"</span></span>        <span class="token attr-name">destroy-method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>close<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token comment">&lt;!-- 配置驱动程序类 --></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>driverClassName<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.mysql.jdbc.Driver<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>        <span class="token comment">&lt;!-- 配置连接数据库的URL --></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>url<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>jdbc:mysql://localhost:3306/myweb<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>        <span class="token comment">&lt;!-- 配置访问数据库的用户名 --></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>username<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>root<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>        <span class="token comment">&lt;!-- 配置访问数据库的口令 --></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>password<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>123456<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>        <span class="token comment">&lt;!-- 配置最大连接数 --></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>maxActive<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>150<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>        <span class="token comment">&lt;!-- 配置最小空闲连接数 --></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>minIdle<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>5<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>        <span class="token comment">&lt;!-- 配置最大空闲连接数 --></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>maxIdle<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>20<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>        <span class="token comment">&lt;!-- 配置初始连接数 --></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>initialSize<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>10<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>        <span class="token comment">&lt;!-- 配置连接被泄露时是否生成日志 --></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>logAbandoned<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>        <span class="token comment">&lt;!-- 配置是否删除超时连接 --></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>removeAbandoned<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>        <span class="token comment">&lt;!-- 配置删除超时连接的超时门限值(以秒为单位) --></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>removeAbandonedTimeout<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>120<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>        <span class="token comment">&lt;!-- 配置超时等待时间(以毫秒为单位) --></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>maxWait<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>5000<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>        <span class="token comment">&lt;!-- 配置空闲连接回收器线程运行的时间间隔(以毫秒为单位) --></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>timeBetweenEvictionRunsMillis<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>300000<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>        <span class="token comment">&lt;!-- 配置连接空闲多长时间后(以毫秒为单位)被断开连接 --></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>minEvictableIdleTimeMillis<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>60000<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">></span></span>    <span class="token comment">&lt;!-- 配置Spring提供的支持注解ORM映射的Hibernate会话工厂 --></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>sessionFactory<span class="token punctuation">"</span></span>        <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>org.springframework.orm.hibernate3.annotation.AnnotationSessionFactoryBean<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token comment">&lt;!-- 通过setter注入数据源属性 --></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>dataSource<span class="token punctuation">"</span></span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>dataSource<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>        <span class="token comment">&lt;!-- 配置实体类所在的包 --></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>packagesToScan<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.jackfrued.entity<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>        <span class="token comment">&lt;!-- 配置Hibernate的相关属性 --></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>hibernateProperties<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            <span class="token comment">&lt;!-- 在项目调试完成后要删除show_sql和format_sql属性否则对性能有显著影响 --></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">></span></span>                hibernate.dialect=org.hibernate.dialect.MySQL5Dialect            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">></span></span>    <span class="token comment">&lt;!-- 配置Spring提供的Hibernate事务管理器 --></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>transactionManager<span class="token punctuation">"</span></span>        <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>org.springframework.orm.hibernate3.HibernateTransactionManager<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token comment">&lt;!-- 通过setter注入Hibernate会话工厂 --></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>sessionFactory<span class="token punctuation">"</span></span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>sessionFactory<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">></span></span>    <span class="token comment">&lt;!-- 配置基于注解配置声明式事务 --></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">tx:</span>annotation-driven</span> <span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>beans</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>jackfrued<span class="token punctuation">.</span>dao</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">Serializable</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>jackfrued<span class="token punctuation">.</span>comm<span class="token punctuation">.</span></span><span class="token class-name">QueryBean</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>jackfrued<span class="token punctuation">.</span>comm<span class="token punctuation">.</span></span><span class="token class-name">QueryResult</span><span class="token punctuation">;</span><span class="token comment">/** * 数据访问对象接口(以对象为单位封装CRUD操作) * @param &lt;E> 实体类型 * @param &lt;K> 实体标识字段的类型 */</span><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">BaseDao</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">,</span> <span class="token class-name">K</span> <span class="token keyword">extends</span> <span class="token class-name">Serializable</span><span class="token punctuation">></span></span> <span class="token punctuation">&#123;</span>    <span class="token comment">/**     * 新增     * @param entity 业务实体对象     * @return 增加成功返回实体对象的标识     */</span>    <span class="token keyword">public</span> <span class="token class-name">K</span> <span class="token function">save</span><span class="token punctuation">(</span><span class="token class-name">E</span> entity<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">/**     * 删除     * @param entity 业务实体对象     */</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">delete</span><span class="token punctuation">(</span><span class="token class-name">E</span> entity<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">/**     * 根据ID删除     * @param id 业务实体对象的标识     * @return 删除成功返回true否则返回false     */</span>    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">deleteById</span><span class="token punctuation">(</span><span class="token class-name">K</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">/**     * 修改     * @param entity 业务实体对象     * @return 修改成功返回true否则返回false     */</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token class-name">E</span> entity<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">/**     * 根据ID查找业务实体对象     * @param id 业务实体对象的标识     * @return 业务实体对象对象或null     */</span>    <span class="token keyword">public</span> <span class="token class-name">E</span> <span class="token function">findById</span><span class="token punctuation">(</span><span class="token class-name">K</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">/**     * 根据ID查找业务实体对象     * @param id 业务实体对象的标识     * @param lazy 是否使用延迟加载     * @return 业务实体对象对象     */</span>    <span class="token keyword">public</span> <span class="token class-name">E</span> <span class="token function">findById</span><span class="token punctuation">(</span><span class="token class-name">K</span> id<span class="token punctuation">,</span> <span class="token keyword">boolean</span> lazy<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">/**     * 查找所有业务实体对象     * @return 装所有业务实体对象的列表容器     */</span>    <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">></span></span> <span class="token function">findAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">/**     * 分页查找业务实体对象     * @param page 页码     * @param size 页面大小     * @return 查询结果对象     */</span>    <span class="token keyword">public</span> <span class="token class-name">QueryResult</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">></span></span> <span class="token function">findByPage</span><span class="token punctuation">(</span><span class="token keyword">int</span> page<span class="token punctuation">,</span> <span class="token keyword">int</span> size<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">/**     * 分页查找业务实体对象     * @param queryBean 查询条件对象     * @param page 页码     * @param size 页面大小     * @return 查询结果对象     */</span>    <span class="token keyword">public</span> <span class="token class-name">QueryResult</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">></span></span> <span class="token function">findByPage</span><span class="token punctuation">(</span><span class="token class-name">QueryBean</span> queryBean<span class="token punctuation">,</span> <span class="token keyword">int</span> page<span class="token punctuation">,</span> <span class="token keyword">int</span> size<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>jackfrued<span class="token punctuation">.</span>dao</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">Serializable</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>jackfrued<span class="token punctuation">.</span>comm<span class="token punctuation">.</span></span><span class="token class-name">QueryBean</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>jackfrued<span class="token punctuation">.</span>comm<span class="token punctuation">.</span></span><span class="token class-name">QueryResult</span><span class="token punctuation">;</span><span class="token comment">/** * BaseDao的缺省适配器 * @param &lt;E> 实体类型 * @param &lt;K> 实体标识字段的类型 */</span><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">BaseDaoAdapter</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">,</span> <span class="token class-name">K</span> <span class="token keyword">extends</span> <span class="token class-name">Serializable</span><span class="token punctuation">></span></span> <span class="token keyword">implements</span> <span class="token class-name">BaseDao</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">,</span> <span class="token class-name">K</span><span class="token punctuation">></span></span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token class-name">K</span> <span class="token function">save</span><span class="token punctuation">(</span><span class="token class-name">E</span> entity<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">delete</span><span class="token punctuation">(</span><span class="token class-name">E</span> entity<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">deleteById</span><span class="token punctuation">(</span><span class="token class-name">K</span> id<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">E</span> entity <span class="token operator">=</span> <span class="token function">findById</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>entity <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token function">delete</span><span class="token punctuation">(</span>entity<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token class-name">E</span> entity<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token class-name">E</span> <span class="token function">findById</span><span class="token punctuation">(</span><span class="token class-name">K</span> id<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token class-name">E</span> <span class="token function">findById</span><span class="token punctuation">(</span><span class="token class-name">K</span> id<span class="token punctuation">,</span> <span class="token keyword">boolean</span> lazy<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">></span></span> <span class="token function">findAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token class-name">QueryResult</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">></span></span> <span class="token function">findByPage</span><span class="token punctuation">(</span><span class="token keyword">int</span> page<span class="token punctuation">,</span> <span class="token keyword">int</span> size<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token class-name">QueryResult</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">></span></span> <span class="token function">findByPage</span><span class="token punctuation">(</span><span class="token class-name">QueryBean</span> queryBean<span class="token punctuation">,</span> <span class="token keyword">int</span> page<span class="token punctuation">,</span> <span class="token keyword">int</span> size<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>jackfrued<span class="token punctuation">.</span>dao</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">Serializable</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span><span class="token class-name">ParameterizedType</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">ArrayList</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Collections</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>hibernate<span class="token punctuation">.</span></span><span class="token class-name">Query</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>hibernate<span class="token punctuation">.</span></span><span class="token class-name">Session</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>hibernate<span class="token punctuation">.</span></span><span class="token class-name">SessionFactory</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>jackfrued<span class="token punctuation">.</span>comm<span class="token punctuation">.</span></span><span class="token class-name">HQLQueryBean</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>jackfrued<span class="token punctuation">.</span>comm<span class="token punctuation">.</span></span><span class="token class-name">QueryBean</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>jackfrued<span class="token punctuation">.</span>comm<span class="token punctuation">.</span></span><span class="token class-name">QueryResult</span><span class="token punctuation">;</span><span class="token comment">/** * 基于Hibernate的BaseDao实现类 * @param &lt;E> 实体类型 * @param &lt;K> 主键类型 */</span><span class="token annotation punctuation">@SuppressWarnings</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token string">"unchecked"</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">BaseDaoHibernateImpl</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">,</span> <span class="token class-name">K</span> <span class="token keyword">extends</span> <span class="token class-name">Serializable</span><span class="token punctuation">></span></span> <span class="token keyword">extends</span> <span class="token class-name">BaseDaoAdapter</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">,</span> <span class="token class-name">K</span><span class="token punctuation">></span></span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Autowired</span>    <span class="token keyword">protected</span> <span class="token class-name">SessionFactory</span> sessionFactory<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">></span></span> entityClass<span class="token punctuation">;</span>       <span class="token comment">// 业务实体的类对象</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> entityName<span class="token punctuation">;</span>          <span class="token comment">// 业务实体的名字</span>    <span class="token keyword">public</span> <span class="token class-name">BaseDaoHibernateImpl</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">ParameterizedType</span> pt <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">ParameterizedType</span><span class="token punctuation">)</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getGenericSuperclass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        entityClass <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">></span></span><span class="token punctuation">)</span> pt<span class="token punctuation">.</span><span class="token function">getActualTypeArguments</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        entityName <span class="token operator">=</span> entityClass<span class="token punctuation">.</span><span class="token function">getSimpleName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token class-name">K</span> <span class="token function">save</span><span class="token punctuation">(</span><span class="token class-name">E</span> entity<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token class-name">K</span><span class="token punctuation">)</span> sessionFactory<span class="token punctuation">.</span><span class="token function">getCurrentSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>entity<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">delete</span><span class="token punctuation">(</span><span class="token class-name">E</span> entity<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        sessionFactory<span class="token punctuation">.</span><span class="token function">getCurrentSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>entity<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token class-name">E</span> entity<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        sessionFactory<span class="token punctuation">.</span><span class="token function">getCurrentSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>entity<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token class-name">E</span> <span class="token function">findById</span><span class="token punctuation">(</span><span class="token class-name">K</span> id<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token function">findById</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token class-name">E</span> <span class="token function">findById</span><span class="token punctuation">(</span><span class="token class-name">K</span> id<span class="token punctuation">,</span> <span class="token keyword">boolean</span> lazy<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">Session</span> session <span class="token operator">=</span> sessionFactory<span class="token punctuation">.</span><span class="token function">getCurrentSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token class-name">E</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>lazy<span class="token operator">?</span> session<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span>entityClass<span class="token punctuation">,</span> id<span class="token punctuation">)</span> <span class="token operator">:</span> session<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>entityClass<span class="token punctuation">,</span> id<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">></span></span> <span class="token function">findAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> sessionFactory<span class="token punctuation">.</span><span class="token function">getCurrentSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">createCriteria</span><span class="token punctuation">(</span>entityClass<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token class-name">QueryResult</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">></span></span> <span class="token function">findByPage</span><span class="token punctuation">(</span><span class="token keyword">int</span> page<span class="token punctuation">,</span> <span class="token keyword">int</span> size<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">QueryResult</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">></span></span><span class="token punctuation">(</span>            <span class="token function">findByHQLAndPage</span><span class="token punctuation">(</span><span class="token string">"from "</span> <span class="token operator">+</span> entityName <span class="token punctuation">,</span> page<span class="token punctuation">,</span> size<span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token function">getCountByHQL</span><span class="token punctuation">(</span><span class="token string">"select count(*) from "</span> <span class="token operator">+</span> entityName<span class="token punctuation">)</span>        <span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token class-name">QueryResult</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">></span></span> <span class="token function">findByPage</span><span class="token punctuation">(</span><span class="token class-name">QueryBean</span> queryBean<span class="token punctuation">,</span> <span class="token keyword">int</span> page<span class="token punctuation">,</span> <span class="token keyword">int</span> size<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>queryBean <span class="token keyword">instanceof</span> <span class="token class-name">HQLQueryBean</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token class-name">HQLQueryBean</span> hqlQueryBean <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">HQLQueryBean</span><span class="token punctuation">)</span> queryBean<span class="token punctuation">;</span>            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">QueryResult</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">></span></span><span class="token punctuation">(</span>                <span class="token function">findByHQLAndPage</span><span class="token punctuation">(</span>hqlQueryBean<span class="token punctuation">.</span><span class="token function">getQueryString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> page<span class="token punctuation">,</span> size<span class="token punctuation">,</span> hqlQueryBean<span class="token punctuation">.</span><span class="token function">getParameters</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                <span class="token function">getCountByHQL</span><span class="token punctuation">(</span>hqlQueryBean<span class="token punctuation">.</span><span class="token function">getCountString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> hqlQueryBean<span class="token punctuation">.</span><span class="token function">getParameters</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>            <span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">/**     * 根据HQL和可变参数列表进行查询     * @param hql 基于HQL的查询语句     * @param params 可变参数列表     * @return 持有查询结果的列表容器或空列表容器     */</span>    <span class="token keyword">protected</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">></span></span> <span class="token function">findByHQL</span><span class="token punctuation">(</span><span class="token class-name">String</span> hql<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> params<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">findByHQL</span><span class="token punctuation">(</span>hql<span class="token punctuation">,</span> <span class="token function">getParamList</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">/**     * 根据HQL和参数列表进行查询     * @param hql 基于HQL的查询语句     * @param params 查询参数列表     * @return 持有查询结果的列表容器或空列表容器     */</span>    <span class="token keyword">protected</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">></span></span> <span class="token function">findByHQL</span><span class="token punctuation">(</span><span class="token class-name">String</span> hql<span class="token punctuation">,</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">></span></span> params<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">></span></span> list <span class="token operator">=</span> <span class="token function">createQuery</span><span class="token punctuation">(</span>hql<span class="token punctuation">,</span> params<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> list <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> list<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">0</span> <span class="token operator">?</span> list <span class="token operator">:</span> <span class="token class-name">Collections</span><span class="token punctuation">.</span>EMPTY_LIST<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">/**     * 根据HQL和参数列表进行分页查询     * @param hql 基于HQL的查询语句     * @page 页码     * @size 页面大小     * @param params 可变参数列表     * @return 持有查询结果的列表容器或空列表容器     */</span>    <span class="token keyword">protected</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">></span></span> <span class="token function">findByHQLAndPage</span><span class="token punctuation">(</span><span class="token class-name">String</span> hql<span class="token punctuation">,</span> <span class="token keyword">int</span> page<span class="token punctuation">,</span> <span class="token keyword">int</span> size<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> params<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">findByHQLAndPage</span><span class="token punctuation">(</span>hql<span class="token punctuation">,</span> page<span class="token punctuation">,</span> size<span class="token punctuation">,</span> <span class="token function">getParamList</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">/**     * 根据HQL和参数列表进行分页查询     * @param hql 基于HQL的查询语句     * @page 页码     * @size 页面大小     * @param params 查询参数列表     * @return 持有查询结果的列表容器或空列表容器     */</span>    <span class="token keyword">protected</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">></span></span> <span class="token function">findByHQLAndPage</span><span class="token punctuation">(</span><span class="token class-name">String</span> hql<span class="token punctuation">,</span> <span class="token keyword">int</span> page<span class="token punctuation">,</span> <span class="token keyword">int</span> size<span class="token punctuation">,</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">></span></span> params<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">></span></span> list <span class="token operator">=</span> <span class="token function">createQuery</span><span class="token punctuation">(</span>hql<span class="token punctuation">,</span> params<span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">setFirstResult</span><span class="token punctuation">(</span><span class="token punctuation">(</span>page <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> size<span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">setMaxResults</span><span class="token punctuation">(</span>size<span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> list <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> list<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">0</span> <span class="token operator">?</span> list <span class="token operator">:</span> <span class="token class-name">Collections</span><span class="token punctuation">.</span>EMPTY_LIST<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">/**     * 查询满足条件的记录数     * @param hql 基于HQL的查询语句     * @param params 可变参数列表     * @return 满足查询条件的总记录数     */</span>    <span class="token keyword">protected</span> <span class="token keyword">long</span> <span class="token function">getCountByHQL</span><span class="token punctuation">(</span><span class="token class-name">String</span> hql<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> params<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getCountByHQL</span><span class="token punctuation">(</span>hql<span class="token punctuation">,</span> <span class="token function">getParamList</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">/**     * 查询满足条件的记录数     * @param hql 基于HQL的查询语句     * @param params 参数列表容器     * @return 满足查询条件的总记录数     */</span>    <span class="token keyword">protected</span> <span class="token keyword">long</span> <span class="token function">getCountByHQL</span><span class="token punctuation">(</span><span class="token class-name">String</span> hql<span class="token punctuation">,</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">></span></span> params<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token class-name">Long</span><span class="token punctuation">)</span> <span class="token function">createQuery</span><span class="token punctuation">(</span>hql<span class="token punctuation">,</span> params<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">uniqueResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">// 创建Hibernate查询对象(Query)</span>    <span class="token keyword">private</span> <span class="token class-name">Query</span> <span class="token function">createQuery</span><span class="token punctuation">(</span><span class="token class-name">String</span> hql<span class="token punctuation">,</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">></span></span> params<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">Query</span> query <span class="token operator">=</span> sessionFactory<span class="token punctuation">.</span><span class="token function">getCurrentSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">createQuery</span><span class="token punctuation">(</span>hql<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> params<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            query<span class="token punctuation">.</span><span class="token function">setParameter</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> params<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">return</span> query<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">// 将可变参数列表组装成列表容器</span>    <span class="token keyword">private</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">></span></span> <span class="token function">getParamList</span><span class="token punctuation">(</span><span class="token class-name">Object</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> params<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">></span></span> paramList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>params <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> params<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                paramList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>params<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">return</span> paramList<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token operator">?</span> <span class="token class-name">Collections</span><span class="token punctuation">.</span>EMPTY_LIST <span class="token operator">:</span> paramList<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>jackfrued<span class="token punctuation">.</span>comm</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span><span class="token punctuation">;</span><span class="token comment">/** * 查询条件的接口 */</span><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">QueryBean</span> <span class="token punctuation">&#123;</span>    <span class="token comment">/**     * 添加排序字段     * @param fieldName 用于排序的字段     * @param asc 升序还是降序     * @return 查询条件对象自身(方便级联编程)     */</span>    <span class="token keyword">public</span> <span class="token class-name">QueryBean</span> <span class="token function">addOrder</span><span class="token punctuation">(</span><span class="token class-name">String</span> fieldName<span class="token punctuation">,</span> <span class="token keyword">boolean</span> asc<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">/**     * 添加排序字段     * @param available 是否添加此排序字段     * @param fieldName 用于排序的字段     * @param asc 升序还是降序     * @return 查询条件对象自身(方便级联编程)     */</span>    <span class="token keyword">public</span> <span class="token class-name">QueryBean</span> <span class="token function">addOrder</span><span class="token punctuation">(</span><span class="token keyword">boolean</span> available<span class="token punctuation">,</span> <span class="token class-name">String</span> fieldName<span class="token punctuation">,</span> <span class="token keyword">boolean</span> asc<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">/**     * 添加查询条件     * @param condition 条件     * @param params 替换掉条件中参数占位符的参数     * @return 查询条件对象自身(方便级联编程)     */</span>    <span class="token keyword">public</span> <span class="token class-name">QueryBean</span> <span class="token function">addCondition</span><span class="token punctuation">(</span><span class="token class-name">String</span> condition<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> params<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">/**     * 添加查询条件     * @param available 是否需要添加此条件     * @param condition 条件     * @param params 替换掉条件中参数占位符的参数     * @return 查询条件对象自身(方便级联编程)     */</span>    <span class="token keyword">public</span> <span class="token class-name">QueryBean</span> <span class="token function">addCondition</span><span class="token punctuation">(</span><span class="token keyword">boolean</span> available<span class="token punctuation">,</span> <span class="token class-name">String</span> condition<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> params<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">/**     * 获得查询语句     * @return 查询语句     */</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getQueryString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">/**     * 获取查询记录数的查询语句     * @return 查询记录数的查询语句     */</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getCountString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">/**     * 获得查询参数     * @return 查询参数的列表容器     */</span>    <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">></span></span> <span class="token function">getParameters</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>jackfrued<span class="token punctuation">.</span>comm</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span><span class="token punctuation">;</span><span class="token comment">/** * 查询结果 * @param &lt;T> 泛型参数 */</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">QueryResult</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">></span></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">></span></span> result<span class="token punctuation">;</span>     <span class="token comment">// 持有查询结果的列表容器</span>    <span class="token keyword">private</span> <span class="token keyword">long</span> totalRecords<span class="token punctuation">;</span>  <span class="token comment">// 查询到的总记录数</span>    <span class="token comment">/**     * 构造器     */</span>    <span class="token keyword">public</span> <span class="token class-name">QueryResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">/**     * 构造器     * @param result 持有查询结果的列表容器     * @param totalRecords 查询到的总记录数     */</span>    <span class="token keyword">public</span> <span class="token class-name">QueryResult</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">></span></span> result<span class="token punctuation">,</span> <span class="token keyword">long</span> totalRecords<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>result <span class="token operator">=</span> result<span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>totalRecords <span class="token operator">=</span> totalRecords<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">></span></span> <span class="token function">getResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> result<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setResult</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">></span></span> result<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>result <span class="token operator">=</span> result<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">long</span> <span class="token function">getTotalRecords</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> totalRecords<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setTotalRecords</span><span class="token punctuation">(</span><span class="token keyword">long</span> totalRecords<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>totalRecords <span class="token operator">=</span> totalRecords<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>jackfrued<span class="token punctuation">.</span>dao</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>jackfrued<span class="token punctuation">.</span>comm<span class="token punctuation">.</span></span><span class="token class-name">QueryResult</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>jackfrued<span class="token punctuation">.</span>entity<span class="token punctuation">.</span></span><span class="token class-name">Dept</span><span class="token punctuation">;</span><span class="token comment">/** * 部门数据访问对象接口 */</span><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">DeptDao</span> <span class="token keyword">extends</span> <span class="token class-name">BaseDao</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Dept</span><span class="token punctuation">,</span> <span class="token class-name">Integer</span><span class="token punctuation">></span></span> <span class="token punctuation">&#123;</span>    <span class="token comment">/**     * 分页查询顶级部门     * @param page 页码     * @param size 页码大小     * @return 查询结果对象     */</span>    <span class="token keyword">public</span> <span class="token class-name">QueryResult</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Dept</span><span class="token punctuation">></span></span> <span class="token function">findTopDeptByPage</span><span class="token punctuation">(</span><span class="token keyword">int</span> page<span class="token punctuation">,</span> <span class="token keyword">int</span> size<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>jackfrued<span class="token punctuation">.</span>dao<span class="token punctuation">.</span>impl</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Repository</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>jackfrued<span class="token punctuation">.</span>comm<span class="token punctuation">.</span></span><span class="token class-name">QueryResult</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>jackfrued<span class="token punctuation">.</span>dao<span class="token punctuation">.</span></span><span class="token class-name">BaseDaoHibernateImpl</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>jackfrued<span class="token punctuation">.</span>dao<span class="token punctuation">.</span></span><span class="token class-name">DeptDao</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>jackfrued<span class="token punctuation">.</span>entity<span class="token punctuation">.</span></span><span class="token class-name">Dept</span><span class="token punctuation">;</span><span class="token annotation punctuation">@Repository</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DeptDaoImpl</span> <span class="token keyword">extends</span> <span class="token class-name">BaseDaoHibernateImpl</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Dept</span><span class="token punctuation">,</span> <span class="token class-name">Integer</span><span class="token punctuation">></span></span> <span class="token keyword">implements</span> <span class="token class-name">DeptDao</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> HQL_FIND_TOP_DEPT <span class="token operator">=</span> <span class="token string">" from Dept as d where d.superiorDept is null "</span><span class="token punctuation">;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token class-name">QueryResult</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Dept</span><span class="token punctuation">></span></span> <span class="token function">findTopDeptByPage</span><span class="token punctuation">(</span><span class="token keyword">int</span> page<span class="token punctuation">,</span> <span class="token keyword">int</span> size<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Dept</span><span class="token punctuation">></span></span> list <span class="token operator">=</span> <span class="token function">findByHQLAndPage</span><span class="token punctuation">(</span>HQL_FIND_TOP_DEPT<span class="token punctuation">,</span> page<span class="token punctuation">,</span> size<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">long</span> totalRecords <span class="token operator">=</span> <span class="token function">getCountByHQL</span><span class="token punctuation">(</span><span class="token string">" select count(*) "</span> <span class="token operator">+</span> HQL_FIND_TOP_DEPT<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">QueryResult</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span>list<span class="token punctuation">,</span> totalRecords<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>jackfrued<span class="token punctuation">.</span>comm</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span><span class="token punctuation">;</span><span class="token comment">/** * 分页器 * @param &lt;T> 分页数据对象的类型 */</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PageBean</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">></span></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> DEFAUL_INIT_PAGE <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> DEFAULT_PAGE_SIZE <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> DEFAULT_PAGE_COUNT <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">></span></span> data<span class="token punctuation">;</span>           <span class="token comment">// 分页数据</span>    <span class="token keyword">private</span> <span class="token class-name">PageRange</span> pageRange<span class="token punctuation">;</span>    <span class="token comment">// 页码范围</span>    <span class="token keyword">private</span> <span class="token keyword">int</span> totalPage<span class="token punctuation">;</span>          <span class="token comment">// 总页数</span>    <span class="token keyword">private</span> <span class="token keyword">int</span> size<span class="token punctuation">;</span>               <span class="token comment">// 页面大小</span>    <span class="token keyword">private</span> <span class="token keyword">int</span> currentPage<span class="token punctuation">;</span>        <span class="token comment">// 当前页码</span>    <span class="token keyword">private</span> <span class="token keyword">int</span> pageCount<span class="token punctuation">;</span>          <span class="token comment">// 页码数量</span>    <span class="token comment">/**     * 构造器     * @param currentPage 当前页码     * @param size 页码大小     * @param pageCount 页码数量     */</span>    <span class="token keyword">public</span> <span class="token class-name">PageBean</span><span class="token punctuation">(</span><span class="token keyword">int</span> currentPage<span class="token punctuation">,</span> <span class="token keyword">int</span> size<span class="token punctuation">,</span> <span class="token keyword">int</span> pageCount<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>currentPage <span class="token operator">=</span> currentPage <span class="token operator">></span> <span class="token number">0</span> <span class="token operator">?</span> currentPage <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>size <span class="token operator">=</span> size <span class="token operator">></span> <span class="token number">0</span> <span class="token operator">?</span> size <span class="token operator">:</span> DEFAULT_PAGE_SIZE<span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>pageCount <span class="token operator">=</span> pageCount <span class="token operator">></span> <span class="token number">0</span> <span class="token operator">?</span> size <span class="token operator">:</span> DEFAULT_PAGE_COUNT<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">/**     * 构造器     * @param currentPage 当前页码     * @param size 页码大小     */</span>    <span class="token keyword">public</span> <span class="token class-name">PageBean</span><span class="token punctuation">(</span><span class="token keyword">int</span> currentPage<span class="token punctuation">,</span> <span class="token keyword">int</span> size<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">(</span>currentPage<span class="token punctuation">,</span> size<span class="token punctuation">,</span> DEFAULT_PAGE_COUNT<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">/**     * 构造器     * @param currentPage 当前页码     */</span>    <span class="token keyword">public</span> <span class="token class-name">PageBean</span><span class="token punctuation">(</span><span class="token keyword">int</span> currentPage<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">(</span>currentPage<span class="token punctuation">,</span> DEFAULT_PAGE_SIZE<span class="token punctuation">,</span> DEFAULT_PAGE_COUNT<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">/**     * 构造器     */</span>    <span class="token keyword">public</span> <span class="token class-name">PageBean</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">(</span>DEFAUL_INIT_PAGE<span class="token punctuation">,</span> DEFAULT_PAGE_SIZE<span class="token punctuation">,</span> DEFAULT_PAGE_COUNT<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">></span></span> <span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> data<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getStartPage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> pageRange <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">?</span> pageRange<span class="token punctuation">.</span><span class="token function">getStartPage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getEndPage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> pageRange <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">?</span> pageRange<span class="token punctuation">.</span><span class="token function">getEndPage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">long</span> <span class="token function">getTotalPage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> totalPage<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> size<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getCurrentPage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> currentPage<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">/**     * 将查询结果转换为分页数据     * @param queryResult 查询结果对象     */</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">transferQueryResult</span><span class="token punctuation">(</span><span class="token class-name">QueryResult</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">></span></span> queryResult<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">long</span> totalRecords <span class="token operator">=</span> queryResult<span class="token punctuation">.</span><span class="token function">getTotalRecords</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        data <span class="token operator">=</span> queryResult<span class="token punctuation">.</span><span class="token function">getResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        totalPage <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>totalRecords <span class="token operator">+</span> size <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">/</span> size<span class="token punctuation">)</span><span class="token punctuation">;</span>         totalPage <span class="token operator">=</span> totalPage <span class="token operator">>=</span> <span class="token number">0</span> <span class="token operator">?</span> totalPage <span class="token operator">:</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span>MAX_VALUE<span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>pageRange <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PageRange</span><span class="token punctuation">(</span>pageCount<span class="token punctuation">,</span> currentPage<span class="token punctuation">,</span> totalPage<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>jackfrued<span class="token punctuation">.</span>comm</span><span class="token punctuation">;</span><span class="token comment">/** * 页码范围 */</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PageRange</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token keyword">int</span> startPage<span class="token punctuation">;</span>  <span class="token comment">// 起始页码</span>    <span class="token keyword">private</span> <span class="token keyword">int</span> endPage<span class="token punctuation">;</span>    <span class="token comment">// 终止页码</span>    <span class="token comment">/**     * 构造器     * @param pageCount 总共显示几个页码     * @param currentPage 当前页码     * @param totalPage 总页数     */</span>    <span class="token keyword">public</span> <span class="token class-name">PageRange</span><span class="token punctuation">(</span><span class="token keyword">int</span> pageCount<span class="token punctuation">,</span> <span class="token keyword">int</span> currentPage<span class="token punctuation">,</span> <span class="token keyword">int</span> totalPage<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        startPage <span class="token operator">=</span> currentPage <span class="token operator">-</span> <span class="token punctuation">(</span>pageCount <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>        endPage <span class="token operator">=</span> currentPage <span class="token operator">+</span> pageCount <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>startPage <span class="token operator">&lt;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            startPage <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>            endPage <span class="token operator">=</span> totalPage <span class="token operator">></span> pageCount <span class="token operator">?</span> pageCount <span class="token operator">:</span> totalPage<span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>endPage <span class="token operator">></span> totalPage<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            endPage <span class="token operator">=</span> totalPage<span class="token punctuation">;</span>            startPage <span class="token operator">=</span> <span class="token punctuation">(</span>endPage <span class="token operator">-</span> pageCount <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">?</span> endPage <span class="token operator">-</span> pageCount <span class="token operator">+</span> <span class="token number">1</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">/**     * 获得起始页页码     * @return 起始页页码     */</span>    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getStartPage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> startPage<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">/**     * 获得终止页页码     * @return 终止页页码     */</span>    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getEndPage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> endPage<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>jackfrued<span class="token punctuation">.</span>biz</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>jackfrued<span class="token punctuation">.</span>comm<span class="token punctuation">.</span></span><span class="token class-name">PageBean</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>jackfrued<span class="token punctuation">.</span>entity<span class="token punctuation">.</span></span><span class="token class-name">Dept</span><span class="token punctuation">;</span><span class="token comment">/** * 部门业务逻辑接口 */</span><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">DeptService</span> <span class="token punctuation">&#123;</span>    <span class="token comment">/**     * 创建新的部门     * @param department 部门对象     * @return 创建成功返回true否则返回false     */</span>    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">createNewDepartment</span><span class="token punctuation">(</span><span class="token class-name">Dept</span> department<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">/**     * 删除指定部门     * @param id 要删除的部门的编号     * @return 删除成功返回true否则返回false     */</span>    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">deleteDepartment</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">/**     * 分页获取顶级部门     * @param page 页码     * @param size 页码大小     * @return 部门对象的分页器对象     */</span>    <span class="token keyword">public</span> <span class="token class-name">PageBean</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Dept</span><span class="token punctuation">></span></span> <span class="token function">getTopDeptByPage</span><span class="token punctuation">(</span><span class="token keyword">int</span> page<span class="token punctuation">,</span> <span class="token keyword">int</span> size<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>jackfrued<span class="token punctuation">.</span>biz<span class="token punctuation">.</span>impl</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Service</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>transaction<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Transactional</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>jackfrued<span class="token punctuation">.</span>biz<span class="token punctuation">.</span></span><span class="token class-name">DeptService</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>jackfrued<span class="token punctuation">.</span>comm<span class="token punctuation">.</span></span><span class="token class-name">PageBean</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>jackfrued<span class="token punctuation">.</span>comm<span class="token punctuation">.</span></span><span class="token class-name">QueryResult</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>jackfrued<span class="token punctuation">.</span>dao<span class="token punctuation">.</span></span><span class="token class-name">DeptDao</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>jackfrued<span class="token punctuation">.</span>entity<span class="token punctuation">.</span></span><span class="token class-name">Dept</span><span class="token punctuation">;</span><span class="token annotation punctuation">@Service</span><span class="token annotation punctuation">@Transactional</span>  <span class="token comment">// 声明式事务的注解</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DeptServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">DeptService</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Autowired</span>    <span class="token keyword">private</span> <span class="token class-name">DeptDao</span> deptDao<span class="token punctuation">;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">createNewDepartment</span><span class="token punctuation">(</span><span class="token class-name">Dept</span> department<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> deptDao<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>department<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">deleteDepartment</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> id<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> deptDao<span class="token punctuation">.</span><span class="token function">deleteById</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token class-name">PageBean</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Dept</span><span class="token punctuation">></span></span> <span class="token function">getTopDeptByPage</span><span class="token punctuation">(</span><span class="token keyword">int</span> page<span class="token punctuation">,</span> <span class="token keyword">int</span> size<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">QueryResult</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Dept</span><span class="token punctuation">></span></span> queryResult <span class="token operator">=</span> deptDao<span class="token punctuation">.</span><span class="token function">findTopDeptByPage</span><span class="token punctuation">(</span>page<span class="token punctuation">,</span> size<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">PageBean</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Dept</span><span class="token punctuation">></span></span> pageBean <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PageBean</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span>page<span class="token punctuation">,</span> size<span class="token punctuation">)</span><span class="token punctuation">;</span>        pageBean<span class="token punctuation">.</span><span class="token function">transferQueryResult</span><span class="token punctuation">(</span>queryResult<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> pageBean<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><blockquote><h3 id="如何在-Web-项目中配置-Spring-的-IoC-容器？"><a href="#如何在-Web-项目中配置-Spring-的-IoC-容器？" class="headerlink" title="如何在 Web 项目中配置 Spring 的 IoC 容器？"></a>如何在 Web 项目中配置 Spring 的 IoC 容器？</h3></blockquote><p>答：如果需要在 Web 项目中使用 Spring 的 IoC 容器，可以在 Web 项目配置文件 web.xml 中做出如下配置：</p><p><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>context-param</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param-name</span><span class="token punctuation">></span></span>contextConfigLocation<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>param-name</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param-value</span><span class="token punctuation">></span></span>classpath:applicationContext.xml<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>param-value</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>context-param</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>listener</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>listener-class</span><span class="token punctuation">></span></span>        org.springframework.web.context.ContextLoaderListener    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>listener-class</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>listener</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><blockquote><h3 id="如何在-Web-项目中配置-Spring-MVC？"><a href="#如何在-Web-项目中配置-Spring-MVC？" class="headerlink" title="如何在 Web 项目中配置 Spring MVC？"></a>如何在 Web 项目中配置 Spring MVC？</h3></blockquote><p>答：要使用 Spring MVC 需要在 Web 项目配置文件中配置其前端控制器 <code>DispatcherServlet</code>，如下所示：</p><p><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>web-app</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-name</span><span class="token punctuation">></span></span>example<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-name</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-class</span><span class="token punctuation">></span></span>            org.springframework.web.servlet.DispatcherServlet        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-class</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>load-on-startup</span><span class="token punctuation">></span></span>1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>load-on-startup</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-mapping</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-name</span><span class="token punctuation">></span></span>example<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-name</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>url-pattern</span><span class="token punctuation">></span></span>*.html<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>url-pattern</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-mapping</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>web-app</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p><strong>说明：</strong>上面的配置中使用了 <code>*.html</code> 的后缀映射，这样做一方面不能够通过 URL 推断采用了何种服务器端的技术，另一方面可以欺骗搜索引擎，因为搜索引擎不会搜索动态页面，这种做法称为<strong>伪静态化</strong>。</p><blockquote><h3 id="Spring-MVC-的工作原理是怎样的？"><a href="#Spring-MVC-的工作原理是怎样的？" class="headerlink" title="Spring MVC 的工作原理是怎样的？"></a>Spring MVC 的工作原理是怎样的？</h3></blockquote><p>答：Spring MVC 的工作原理如下图所示：</p><p><img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="/images/post/java_interview/156.png" alt></p><ol><li>客户端的所有请求都交给前端控制器 <code>DispatcherServlet</code> 来处理，它会负责调用系统的其他模块来真正处理用户的请求。</li><li><code>DispatcherServlet</code> 收到请求后，将根据请求的信息（包括 URL、HTTP 协议方法、请求头、请求参数、Cookie 等）以及 <code>HandlerMapping</code> 的配置找到处理该请求的 <code>Handler</code>（任何一个对象都可以作为请求的 <code>Handler</code>）。</li><li>在这个地方 Spring 会通过 <code>Controller</code> 对该处理器进行封装。</li><li><code>Controller</code> 是一个适配器，它用统一的接口对各种 <code>Handler</code> 中的方法进行调用。</li><li><code>Handler</code> 完成对用户请求的处理后，会返回一个 <code>ModelAndView</code> 对象给 <code>DispatcherServlet</code>，<code>ModelAndView</code> 顾名思义，包含了数据模型以及相应的视图的信息。</li><li><code>ModelAndView</code> 的视图是逻辑视图，<code>DispatcherServlet</code> 还要借助 <code>ViewResolver</code> 完成从逻辑视图到真实视图对象的解析工作。</li><li>当得到真正的视图对象后，<code>DispatcherServlet</code> 会利用视图对象对模型数据进行渲染。</li><li>客户端得到响应，可能是一个普通的HTML页面，也可以是 XML 或 JSON 字符串，还可以是一张图片或者一个 PDF 文件。</li></ol><blockquote><h3 id="如何在-Spring-IoC-容器中配置数据源？"><a href="#如何在-Spring-IoC-容器中配置数据源？" class="headerlink" title="如何在 Spring IoC 容器中配置数据源？"></a>如何在 Spring IoC 容器中配置数据源？</h3></blockquote><p>答：</p><p>DBCP 配置：</p><p><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>dataSource<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>org.apache.commons.dbcp.BasicDataSource<span class="token punctuation">"</span></span> <span class="token attr-name">destroy-method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>close<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>driverClassName<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>$&#123;jdbc.driverClassName&#125;<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>url<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>$&#123;jdbc.url&#125;<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>username<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>$&#123;jdbc.username&#125;<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>password<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>$&#123;jdbc.password&#125;<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">context:</span>property-placeholder</span> <span class="token attr-name">location</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>jdbc.properties<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p>C3P0 配置：</p><p><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>dataSource<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.mchange.v2.c3p0.ComboPooledDataSource<span class="token punctuation">"</span></span> <span class="token attr-name">destroy-method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>close<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>driverClass<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>$&#123;jdbc.driverClassName&#125;<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>jdbcUrl<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>$&#123;jdbc.url&#125;<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>user<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>$&#123;jdbc.username&#125;<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>password<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>$&#123;jdbc.password&#125;<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">context:</span>property-placeholder</span> <span class="token attr-name">location</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>jdbc.properties<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p><strong>注意：</strong> DBCP 的详细配置在第 153 题中已经完整的展示过了。</p><blockquote><h3 id="如何配置配置事务增强？"><a href="#如何配置配置事务增强？" class="headerlink" title="如何配置配置事务增强？"></a>如何配置配置事务增强？</h3></blockquote><p>答：</p><p><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8"?></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>beans</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.springframework.org/schema/beans<span class="token punctuation">"</span></span>    <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">"</span></span>    <span class="token attr-name"><span class="token namespace">xmlns:</span>aop</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.springframework.org/schema/aop<span class="token punctuation">"</span></span>    <span class="token attr-name"><span class="token namespace">xmlns:</span>tx</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.springframework.org/schema/tx<span class="token punctuation">"</span></span>    <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>     http://www.springframework.org/schema/beans     http://www.springframework.org/schema/beans/spring-beans.xsd     http://www.springframework.org/schema/tx     http://www.springframework.org/schema/tx/spring-tx.xsd     http://www.springframework.org/schema/aop     http://www.springframework.org/schema/aop/spring-aop.xsd<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token comment">&lt;!-- this is the service object that we want to make transactional --></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>fooService<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>x.y.service.DefaultFooService<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>    <span class="token comment">&lt;!-- the transactional advice --></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">tx:</span>advice</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>txAdvice<span class="token punctuation">"</span></span> <span class="token attr-name">transaction-manager</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>txManager<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token comment">&lt;!-- the transactional semantics... --></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">tx:</span>attributes</span><span class="token punctuation">></span></span>            <span class="token comment">&lt;!-- all methods starting with 'get' are read-only --></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">tx:</span>method</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>get*<span class="token punctuation">"</span></span> <span class="token attr-name">read-only</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>            <span class="token comment">&lt;!-- other methods use the default transaction settings (see below) --></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">tx:</span>method</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>*<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">tx:</span>attributes</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">tx:</span>advice</span><span class="token punctuation">></span></span>    <span class="token comment">&lt;!-- ensure that the above transactional advice runs for any execution of         an operation defined by the FooService interface --></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">aop:</span>config</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">aop:</span>pointcut</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>fooServiceOperation<span class="token punctuation">"</span></span> <span class="token attr-name">expression</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>execution(* x.y.service.FooService.*(..))<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">aop:</span>advisor</span> <span class="token attr-name">advice-ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>txAdvice<span class="token punctuation">"</span></span> <span class="token attr-name">pointcut-ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>fooServiceOperation<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">aop:</span>config</span><span class="token punctuation">></span></span>    <span class="token comment">&lt;!-- don't forget the DataSource --></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>dataSource<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>org.apache.commons.dbcp.BasicDataSource<span class="token punctuation">"</span></span> <span class="token attr-name">destroy-method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>close<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>driverClassName<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>oracle.jdbc.driver.OracleDriver<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>url<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>jdbc:oracle:thin:@localhost:1521:orcl<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>username<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>scott<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>password<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>tiger<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">></span></span>    <span class="token comment">&lt;!-- similarly, don't forget the PlatformTransactionManager --></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>txManager<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>org.springframework.jdbc.datasource.DataSourceTransactionManager<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>dataSource<span class="token punctuation">"</span></span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>dataSource<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">></span></span>    <span class="token comment">&lt;!-- other &lt;bean/> definitions here --></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>beans</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><blockquote><h3 id="选择使用-Spring-框架的原因（Spring-框架为企业级开发带来的好处有哪些）？"><a href="#选择使用-Spring-框架的原因（Spring-框架为企业级开发带来的好处有哪些）？" class="headerlink" title="选择使用 Spring 框架的原因（Spring 框架为企业级开发带来的好处有哪些）？"></a>选择使用 Spring 框架的原因（Spring 框架为企业级开发带来的好处有哪些）？</h3></blockquote><p>答：可以从以下几个方面作答：</p><ul><li>非侵入式：支持基于 POJO 的编程模式，不强制性的要求实现 Spring 框架中的接口或继承 Spring 框架中的类。</li><li>IoC 容器：IoC 容器帮助应用程序管理对象以及对象之间的依赖关系，对象之间的依赖关系如果发生了改变只需要修改配置文件而不是修改代码，因为代码的修改可能意味着项目的重新构建和完整的回归测试。有了 IoC 容器，程序员再也不需要自己编写工厂、单例，这一点特别符合 Spring 的精神“不要重复的发明轮子”。</li><li>AOP（面向切面编程）：将所有的横切关注功能封装到切面（aspect）中，通过配置的方式将横切关注功能动态添加到目标代码上，进一步实现了业务逻辑和系统服务之间的分离。另一方面，有了 AOP 程序员可以省去很多自己写代理类的工作。</li><li>MVC：Spring 的 MVC 框架是非常优秀的，从各个方面都可以甩 Struts 2 几条街，为 Web 表示层提供了更好的解决方案。</li><li>事务管理：Spring 以宽广的胸怀接纳多种持久层技术，并且为其提供了声明式的事务管理，在不需要任何一行代码的情况下就能够完成事务管理。</li><li>其他：选择 Spring 框架的原因还远不止于此，Spring 为 Java 企业级开发提供了一站式选择，你可以在需要的时候使用它的部分和全部，更重要的是，你甚至可以在感觉不到 Spring 存在的情况下，在你的项目中使用 Spring 提供的各种优秀的功能。</li></ul><blockquote><h3 id="Spring-IoC-容器配置-Bean-的方式？"><a href="#Spring-IoC-容器配置-Bean-的方式？" class="headerlink" title="Spring IoC 容器配置 Bean 的方式？"></a>Spring IoC 容器配置 Bean 的方式？</h3></blockquote><p>答：</p><ul><li>基于 XML 文件进行配置。</li><li>基于注解进行配置。</li><li>基于 Java 程序进行配置（Spring 3+）</li></ul><p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>jackfrued<span class="token punctuation">.</span>bean</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Component</span><span class="token punctuation">;</span><span class="token annotation punctuation">@Component</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Person</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token keyword">int</span> age<span class="token punctuation">;</span>    <span class="token annotation punctuation">@Autowired</span>    <span class="token keyword">private</span> <span class="token class-name">Car</span> car<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token keyword">int</span> age<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>age <span class="token operator">=</span> age<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setCar</span><span class="token punctuation">(</span><span class="token class-name">Car</span> car<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>car <span class="token operator">=</span> car<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token string">"Person [name="</span> <span class="token operator">+</span> name <span class="token operator">+</span> <span class="token string">", age="</span> <span class="token operator">+</span> age <span class="token operator">+</span> <span class="token string">", car="</span> <span class="token operator">+</span> car <span class="token operator">+</span> <span class="token string">"]"</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>jackfrued<span class="token punctuation">.</span>bean</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Component</span><span class="token punctuation">;</span><span class="token annotation punctuation">@Component</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Car</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> brand<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token keyword">int</span> maxSpeed<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token class-name">Car</span><span class="token punctuation">(</span><span class="token class-name">String</span> brand<span class="token punctuation">,</span> <span class="token keyword">int</span> maxSpeed<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>brand <span class="token operator">=</span> brand<span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>maxSpeed <span class="token operator">=</span> maxSpeed<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token string">"Car [brand="</span> <span class="token operator">+</span> brand <span class="token operator">+</span> <span class="token string">", maxSpeed="</span> <span class="token operator">+</span> maxSpeed <span class="token operator">+</span> <span class="token string">"]"</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>jackfrued<span class="token punctuation">.</span>config</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Bean</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Configuration</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>jackfrued<span class="token punctuation">.</span>bean<span class="token punctuation">.</span></span><span class="token class-name">Car</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>jackfrued<span class="token punctuation">.</span>bean<span class="token punctuation">.</span></span><span class="token class-name">Person</span><span class="token punctuation">;</span><span class="token annotation punctuation">@Configuration</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AppConfig</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Bean</span>    <span class="token keyword">public</span> <span class="token class-name">Car</span> <span class="token function">car</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Car</span><span class="token punctuation">(</span><span class="token string">"Benz"</span><span class="token punctuation">,</span> <span class="token number">320</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Bean</span>    <span class="token keyword">public</span> <span class="token class-name">Person</span> <span class="token function">person</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token string">"Jack"</span><span class="token punctuation">,</span> <span class="token number">34</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>jackfrued<span class="token punctuation">.</span>test</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span></span><span class="token class-name">ConfigurableApplicationContext</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">AnnotationConfigApplicationContext</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>jackfrued<span class="token punctuation">.</span>bean<span class="token punctuation">.</span></span><span class="token class-name">Person</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>jackfrued<span class="token punctuation">.</span>config<span class="token punctuation">.</span></span><span class="token class-name">AppConfig</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">Test</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">// TWR (Java 7+)</span>        <span class="token keyword">try</span><span class="token punctuation">(</span><span class="token class-name">ConfigurableApplicationContext</span> factory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AnnotationConfigApplicationContext</span><span class="token punctuation">(</span><span class="token class-name">AppConfig</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token class-name">Person</span> person <span class="token operator">=</span> factory<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token class-name">Person</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>person<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><blockquote><h3 id="阐述-Spring-框架中-Bean-的生命周期？"><a href="#阐述-Spring-框架中-Bean-的生命周期？" class="headerlink" title="阐述 Spring 框架中 Bean 的生命周期？"></a>阐述 Spring 框架中 Bean 的生命周期？</h3></blockquote><p>答：</p><ol><li>Spring IoC 容器找到关于 Bean 的定义并实例化该 Bean。</li><li>Spring IoC 容器对 Bean 进行依赖注入。</li><li>如果 Bean 实现了 <code>BeanNameAware</code> 接口，则将该 Bean 的 <code>id</code> 传给 <code>setBeanName</code> 方法。</li><li>如果 Bean 实现了 <code>BeanFactoryAware</code> 接口，则将 <code>BeanFactory</code> 对象传给 <code>setBeanFactory</code> 方法。</li><li>如果 Bean 实现了 <code>BeanPostProcessor</code> 接口，则调用其 <code>postProcessBeforeInitialization</code> 方法。</li><li>如果 Bean 实现了 <code>InitializingBean</code> 接口，则调用其 <code>afterPropertySet</code> 方法。</li><li>如果有和 Bean 关联的 <code>BeanPostProcessors</code> 对象，则这些对象的 <code>postProcessAfterInitialization</code> 方法被调用。</li><li>当销毁 Bean 实例时，如果Bean实现了 <code>DisposableBean</code> 接口，则调用其 <code>destroy</code> 方法。</li></ol><blockquote><h3 id="依赖注入时如何注入集合属性？"><a href="#依赖注入时如何注入集合属性？" class="headerlink" title="依赖注入时如何注入集合属性？"></a>依赖注入时如何注入集合属性？</h3></blockquote><p>答：可以在定义 Bean 属性时，通过 <code>&lt;list&gt;</code>/<code>&lt;set&gt;</code>/<code>&lt;map&gt;</code>/<code>&lt;props&gt;</code> 分别为其注入列表、集合、映射和键值都是字符串的映射属性。</p><blockquote><h3 id="Spring-中的自动装配有哪些限制？"><a href="#Spring-中的自动装配有哪些限制？" class="headerlink" title="Spring 中的自动装配有哪些限制？"></a>Spring 中的自动装配有哪些限制？</h3></blockquote><p>答：</p><ul><li>如果使用了构造器注入或者 setter 注入，那么将覆盖自动装配的依赖关系。</li><li>基本数据类型的值、字符串字面量、类字面量无法使用自动装配来注入。</li><li>优先考虑使用显式的装配来进行更精确的依赖注入而不是使用自动装配。</li></ul><blockquote><h3 id="在-Web-项目中如何获得-Spring-的-IoC-容器？"><a href="#在-Web-项目中如何获得-Spring-的-IoC-容器？" class="headerlink" title="在 Web 项目中如何获得 Spring 的 IoC 容器？"></a>在 Web 项目中如何获得 Spring 的 IoC 容器？</h3></blockquote><p>答：</p><p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">WebApplicationContext</span> ctx <span class="token operator">=</span> <span class="token class-name">WebApplicationContextUtils</span><span class="token punctuation">.</span><span class="token function">getWebApplicationContext</span><span class="token punctuation">(</span>servletContext<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><blockquote><h3 id="大型网站在架构上应当考虑哪些问题？"><a href="#大型网站在架构上应当考虑哪些问题？" class="headerlink" title="大型网站在架构上应当考虑哪些问题？"></a>大型网站在架构上应当考虑哪些问题？</h3></blockquote><p>答：</p><ul><li><p>分层：分层是处理任何复杂系统最常见的手段之一，将系统横向切分成若干个层面，每个层面只承担单一的职责，然后通过下层为上层提供的基础设施和服务以及上层对下层的调用来形成一个完整的复杂的系统。计算机网络的开放系统互联参考模型（OSI/RM）和 Internet 的 TCP/IP 模型都是分层结构。</p><p>  大型网站的软件系统也可以使用分层的理念将其分为<strong>持久层</strong>（提供数据存储和访问服务）、<strong>业务层</strong>（处理业务逻辑，系统中最核心的部分）和<strong>表示层</strong>（系统交互、视图展示）。需要指出的是：(1)分层是逻辑上的划分，在物理上可以位于同一设备上也可以在不同的设备上部署不同的功能模块，这样可以使用更多的计算资源来应对用户的并发访问；(2)层与层之间应当有清晰的边界，这样分层才有意义，才更利于软件的开发和维护。</p></li><li><p>分割：分割是对软件的纵向切分。我们可以将大型网站的不同功能和服务分割开，形成高内聚低耦合的功能模块（单元）。在设计初期可以做一个粗粒度的分割，将网站分割为若干个功能模块，后期还可以进一步对每个模块进行细粒度的分割，这样一方面有助于软件的开发和维护，另一方面有助于分布式的部署，提供网站的并发处理能力和功能的扩展。</p></li><li><p>分布式：除了上面提到的内容，网站的静态资源（JavaScript、CSS、图片等）也可以采用独立分布式部署并采用独立的域名，这样可以减轻应用服务器的负载压力，也使得浏览器对资源的加载更快。数据的存取也应该是分布式的，传统的商业级关系型数据库产品基本上都支持分布式部署，而新生的 NoSQL 产品几乎都是分布式的。当然，网站后台的业务处理也要使用分布式技术，例如查询索引的构建、数据分析等，这些业务计算规模庞大，可以使用 Hadoop 以及 MapReduce 分布式计算框架来处理。</p></li><li><p>集群：集群使得有更多的服务器提供相同的服务，可以更好的提供对并发的支持。</p></li><li><p>缓存：所谓缓存就是用空间换取时间的技术，将数据尽可能放在距离计算最近的位置。使用缓存是网站优化的第一定律。我们通常说的 CDN、反向代理、热点数据都是对缓存技术的使用。</p></li><li><p>异步：异步是实现软件实体之间解耦合的又一重要手段。异步架构是典型的生产者消费者模式，二者之间没有直接的调用关系，只要保持数据结构不变，彼此功能实现可以随意变化而不互相影响，这对网站的扩展非常有利。使用异步处理还可以提高系统可用性，加快网站的响应速度（用 Ajax 加载数据就是一种异步技术），同时还可以起到削峰作用（应对瞬时高并发）。“能推迟处理的都要推迟处理”是网站优化的第二定律，而异步是践行网站优化第二定律的重要手段。</p></li><li><p>冗余：各种服务器都要提供相应的冗余服务器以便在某台或某些服务器宕机时还能保证网站可以正常工作，同时也提供了灾难恢复的可能性。冗余是网站高可用性的重要保证。</p></li></ul><blockquote><h3 id="你用过的网站前端优化的技术有哪些？"><a href="#你用过的网站前端优化的技术有哪些？" class="headerlink" title="你用过的网站前端优化的技术有哪些？"></a>你用过的网站前端优化的技术有哪些？</h3></blockquote><p>答：</p><ul><li><p>浏览器访问优化：</p><ul><li>减少 HTTP 请求数量：合并 CSS、合并 JavaScript、合并图片（CSS Sprite）</li><li>使用浏览器缓存：通过设置 HTTP 响应头中的 Cache-Control 和 Expires 属性，将 CSS、JavaScript、图片等在浏览器中缓存，当这些静态资源需要更新时，可以更新 HTML 文件中的引用来让浏览器重新请求新的资源</li><li>启用压缩</li><li>CSS 前置，JavaScript 后置</li><li>减少 Cookie 传输</li></ul></li><li><p>CDN 加速：CDN（Content Distribute Network）的本质仍然是缓存，将数据缓存在离用户最近的地方，CDN 通常部署在网络运营商的机房，不仅可以提升响应速度，还可以减少应用服务器的压力。当然，CDN 缓存的通常都是静态资源。</p></li><li><p>反向代理：反向代理相当于应用服务器的一个门面，可以保护网站的安全性，也可以实现负载均衡的功能，当然最重要的是它缓存了用户访问的热点资源，可以直接从反向代理将某些内容返回给用户浏览器。</p></li></ul><blockquote><h3 id="你使用过的应用服务器优化技术有哪些？"><a href="#你使用过的应用服务器优化技术有哪些？" class="headerlink" title="你使用过的应用服务器优化技术有哪些？"></a>你使用过的应用服务器优化技术有哪些？</h3></blockquote><p>答：</p><ul><li><p>分布式缓存：缓存的本质就是内存中的哈希表，如果设计一个优质的哈希函数，那么理论上哈希表读写的渐近时间复杂度为 O(1)。缓存主要用来存放那些读写比很高、变化很少的数据，这样应用程序读取数据时先到缓存中读取，如果没有或者数据已经失效再去访问数据库或文件系统，并根据拟定的规则将数据写入缓存。对网站数据的访问也符合二八定律（Pareto 分布，幂律分布），即 80% 的访问都集中在 20% 的数据上，如果能够将这 20% 的数据缓存起来，那么系统的性能将得到显著的改善。当然，使用缓存需要解决以下几个问题：</p><ul><li>频繁修改的数据；</li><li>数据不一致与脏读；</li><li>缓存雪崩（可以采用分布式缓存服务器集群加以解决，<a href="http://memcached.org/">memcached</a> 是广泛采用的解决方案）；</li><li>缓存预热；</li><li>缓存穿透（恶意持续请求不存在的数据）。</li></ul></li><li><p>异步操作：可以使用消息队列将调用异步化，通过异步处理将短时间高并发产生的事件消息存储在消息队列中，从而起到削峰作用。电商网站在进行促销活动时，可以将用户的订单请求存入消息队列，这样可以抵御大量的并发订单请求对系统和数据库的冲击。目前，绝大多数的电商网站即便不进行促销活动，订单系统都采用了消息队列来处理。</p></li><li><p>使用集群。</p></li><li><p>代码优化：</p><ul><li>多线程：基于 Java 的 Web 开发基本上都通过多线程的方式响应用户的并发请求，使用多线程技术在编程上要解决线程安全问题，主要可以考虑以下几个方面：<ul><li>将对象设计为无状态对象（这和面向对象的编程观点是矛盾的，在面向对象的世界中被视为不良设计），这样就不会存在并发访问时对象状态不一致的问题。</li><li>在方法内部创建对象，这样对象由进入方法的线程创建，不会出现多个线程访问同一对象的问题。使用 ThreadLocal 将对象与线程绑定也是很好的做法，这一点在前面已经探讨过了。</li><li>对资源进行并发访问时应当使用合理的锁机制。</li></ul></li><li>非阻塞 I/O： 使用单线程和非阻塞 I/O 是目前公认的比多线程的方式更能充分发挥服务器性能的应用模式，基于 Node.js 构建的服务器就采用了这样的方式。Java 在 JDK 1.4 中就引入了 NIO（Non-blocking I/O）,在 Servlet 3 规范中又引入了异步 Servlet 的概念，这些都为在服务器端采用非阻塞 I/O 提供了必要的基础。</li><li>资源复用：资源复用主要有两种方式，一是单例，二是对象池，我们使用的数据库连接池、线程池都是对象池化技术，这是典型的用空间换取时间的策略，另一方面也实现对资源的复用，从而避免了不必要的创建和释放资源所带来的开销。</li></ul></li></ul><blockquote><h3 id="什么是-XSS-攻击？什么是-SQL-注入攻击？什么是-CSRF-攻击？"><a href="#什么是-XSS-攻击？什么是-SQL-注入攻击？什么是-CSRF-攻击？" class="headerlink" title="什么是 XSS 攻击？什么是 SQL 注入攻击？什么是 CSRF 攻击？"></a>什么是 XSS 攻击？什么是 SQL 注入攻击？什么是 CSRF 攻击？</h3></blockquote><p>答：</p><ul><li><p>XSS（Cross Site Script，跨站脚本攻击）是向网页中注入恶意脚本在用户浏览网页时在用户浏览器中执行恶意脚本的攻击方式。跨站脚本攻击分有两种形式：反射型攻击（诱使用户点击一个嵌入恶意脚本的链接以达到攻击的目标，目前有很多攻击者利用论坛、微博发布含有恶意脚本的 URL 就属于这种方式）和持久型攻击（将恶意脚本提交到被攻击网站的数据库中，用户浏览网页时，恶意脚本从数据库中被加载到页面执行，QQ 邮箱的早期版本就曾经被利用作为持久型跨站脚本攻击的平台）。XSS 虽然不是什么新鲜玩意，但是攻击的手法却不断翻新，防范 XSS 主要有两方面：消毒（对危险字符进行转义）和 HttpOnly（防范 XSS 攻击者窃取 Cookie 数据）。</p></li><li><p>SQL 注入攻击是注入攻击最常见的形式（此外还有 OS 注入攻击（Struts 2 的高危漏洞就是通过 OGNL 实施 OS 注入攻击导致的）），当服务器使用请求参数构造 SQL 语句时，恶意的 SQL 被嵌入到 SQL 中交给数据库执行。SQL 注入攻击需要攻击者对数据库结构有所了解才能进行，攻击者想要获得表结构有多种方式：(1)如果使用开源系统搭建网站，数据库结构也是公开的（目前有很多现成的系统可以直接搭建论坛，电商网站，虽然方便快捷但是风险是必须要认真评估的）；(2)错误回显（如果将服务器的错误信息直接显示在页面上，攻击者可以通过非法参数引发页面错误从而通过错误信息了解数据库结构，Web 应用应当设置友好的错误页，一方面符合最小惊讶原则，一方面屏蔽掉可能给系统带来危险的错误回显信息）；(3)盲注。防范 SQL 注入攻击也可以采用消毒的方式，通过正则表达式对请求参数进行验证，此外，参数绑定也是很好的手段，这样恶意的 SQL 会被当做 SQL 的参数而不是命令被执行，JDBC 中的 <code>PreparedStatement</code> 就是支持参数绑定的语句对象，从性能和安全性上都明显优于 <code>Statement</code>。</p></li><li><p>CSRF 攻击（Cross Site Request Forgery，跨站请求伪造）是攻击者通过跨站请求，以合法的用户身份进行非法操作（如转账或发帖等）。CSRF 的原理是利用浏览器的 Cookie 或服务器的 Session，盗取用户身份，其原理如下图所示。防范 CSRF 的主要手段是识别请求者的身份，主要有以下几种方式：(1)在表单中添加令牌（token）；(2)验证码；(3)检查请求头中的 Referer（前面提到防图片盗链接也是用的这种方式）。令牌和验证都具有一次消费性的特征，因此在原理上一致的，但是验证码是一种糟糕的用户体验，不是必要的情况下不要轻易使用验证码，目前很多网站的做法是如果在短时间内多次提交一个表单未获得成功后才要求提供验证码，这样会获得较好的用户体验。</p></li></ul><p><img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="/images/post/java_interview/168.png" alt></p><p><strong>补充：</strong>防火墙的架设是 Web 安全的重要保障，<a href="https://www.modsecurity.org/">ModSecurity</a> 是开源的 Web 防火墙中的佼佼者。企业级防火墙的架设应当有两级防火墙，Web 服务器和部分应用服务器可以架设在两级防火墙之间的 DMZ，而数据和资源服务器应当架设在第二级防火墙之后。</p><blockquote><h3 id="什么是领域模型（domain-model）？贫血模型（anaemic-domain-model）和充血模型（rich-domain-model）有什么区别？"><a href="#什么是领域模型（domain-model）？贫血模型（anaemic-domain-model）和充血模型（rich-domain-model）有什么区别？" class="headerlink" title="什么是领域模型（domain model）？贫血模型（anaemic domain model）和充血模型（rich domain model）有什么区别？"></a>什么是领域模型（domain model）？贫血模型（anaemic domain model）和充血模型（rich domain model）有什么区别？</h3></blockquote><p>答：领域模型是领域内的概念类或现实世界中对象的可视化表示，又称为概念模型或分析对象模型，它专注于分析问题领域本身，发掘重要的业务领域概念，并建立业务领域概念之间的关系。贫血模型是指使用的领域对象中只有 <code>setter</code> 和 <code>getter</code> 方法（POJO），所有的业务逻辑都不包含在领域对象中而是放在业务逻辑层。有人将我们这里说的贫血模型进一步划分成失血模型（领域对象完全没有业务逻辑）和贫血模型（领域对象有少量的业务逻辑），我们这里就不对此加以区分了。充血模型将大多数业务逻辑和持久化放在领域对象中，业务逻辑（业务门面）只是完成对业务逻辑的封装、事务和权限等的处理。下面两张图分别展示了贫血模型和充血模型的分层架构。</p><p>贫血模型</p><p><img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="/images/post/java_interview/169_1.png" alt></p><p>充血模型</p><p><img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="/images/post/java_interview/169_2.png" alt></p><p>贫血模型下组织领域逻辑通常使用事务脚本模式，让每个过程对应用户可能要做的一个动作，每个动作由一个过程来驱动。也就是说在设计业务逻辑接口的时候，每个方法对应着用户的一个操作，这种模式有以下几个有点：</p><ul><li>它是一个大多数开发者都能够理解的简单过程模型（适合国内的绝大多数开发者）。</li><li>它能够与一个使用行数据入口或表数据入口的简单数据访问层很好的协作。</li><li>事务边界的显而易见，一个事务开始于脚本的开始，终止于脚本的结束，很容易通过代理（或切面）实现声明式事务。</li></ul><p>然而，事务脚本模式的缺点也是很多的，随着领域逻辑复杂性的增加，系统的复杂性将迅速增加，程序结构将变得极度混乱。开源中国社区上有一篇很好的译文<a href="https://www.oschina.net/translate/how-anaemic-domain-models-cause-bad-software">《贫血领域模型是如何导致糟糕的软件产生》</a>对这个问题做了比较细致的阐述。</p><blockquote><h3 id="谈一谈测试驱动开发（TDD）的好处以及你的理解。"><a href="#谈一谈测试驱动开发（TDD）的好处以及你的理解。" class="headerlink" title="谈一谈测试驱动开发（TDD）的好处以及你的理解。"></a>谈一谈测试驱动开发（TDD）的好处以及你的理解。</h3></blockquote><p>答：TDD 是指在编写真正的功能实现代码之前先写测试代码，然后根据需要重构实现代码。在 JUnit 的作者 Kent Beck 的大作《测试驱动开发：实战与模式解析》（Test-Driven Development: by Example）一书中有这么一段内容：“消除恐惧和不确定性是编写测试驱动代码的重要原因”。因为编写代码时的恐惧会让你小心试探，让你回避沟通，让你羞于得到反馈，让你变得焦躁不安，而 TDD 是消除恐惧、让 Java 开发者更加自信更加乐于沟通的重要手段。TDD 会带来的好处可能不会马上呈现，但是你在某个时候一定会发现，这些好处包括：</p><ul><li>更清晰的代码 — 只写需要的代码</li><li>更好的设计</li><li>更出色的灵活性 — 鼓励程序员面向接口编程</li><li>更快速的反馈 — 不会到系统上线时才知道bug的存在</li></ul><p><strong>补充：</strong>敏捷软件开发的概念已经有很多年了，而且也部分的改变了软件开发这个行业，TDD 也是敏捷开发所倡导的。</p><p>TDD 可以在多个层级上应用，包括单元测试（测试一个类中的代码）、集成测试（测试类之间的交互）、系统测试（测试运行的系统）和系统集成测试（测试运行的系统包括使用的第三方组件）。TDD 的实施步骤是：红（失败测试）- 绿（通过测试） - 重构。关于实施 TDD 的详细步骤请参考另一篇文章<a href="https://blog.csdn.net/jackfrued/article/details/44433249">《测试驱动开发之初窥门径》</a>。</p><p>在使用 TDD 开发时，经常会遇到需要被测对象需要依赖其他子系统的情况，但是你希望将测试代码跟依赖项隔离，以保证测试代码仅仅针对当前被测对象或方法展开，这时候你需要的是测试替身。测试替身可以分为四类：</p><ul><li>虚设替身：只传递但是不会使用到的对象，一般用于填充方法的参数列表</li><li>存根替身：总是返回相同的预设响应，其中可能包括一些虚设状态</li><li>伪装替身：可以取代真实版本的可用版本（比真实版本还是会差很多）</li><li>模拟替身：可以表示一系列期望值的对象，并且可以提供预设响应</li></ul><p>Java 世界中实现模拟替身的第三方工具非常多，包括 EasyMock、Mockito、jMock 等。</p>]]></content>
      
      
      <categories>
          
          <category> 教程笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 面试题 </tag>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Java 面试题解析（Java Web）</title>
      <link href="post/d24a315e.html"/>
      <url>post/d24a315e.html</url>
      
        <content type="html"><![CDATA[<blockquote><h3 id="阐述-Servlet-和-CGI-的区别"><a href="#阐述-Servlet-和-CGI-的区别" class="headerlink" title="阐述 Servlet 和 CGI 的区别?"></a>阐述 Servlet 和 CGI 的区别?</h3></blockquote><p>答：Servlet 与 CGI 的区别在于 Servlet 处于服务器进程中，它通过多线程方式运行其 <code>service()</code> 方法，一个实例可以服务于多个请求，并且其实例一般不会销毁，而 CGI 对每个请求都产生新的进程，服务完成后就销毁，所以效率上低于 Servlet。</p><p><strong>补充：</strong>Sun Microsystems 公司在 1996 年发布 Servlet 技术就是为了和 CGI 进行竞争，Servlet 是一个特殊的 Java 程序，一个基于 Java 的 Web 应用通常包含一个或多个 Servlet 类。Servlet 不能够自行创建并执行，它是在 Servlet 容器中运行的，容器将用户的请求传递给 Servlet 程序，并将 Servlet 的响应回传给用户。通常一个 Servlet 会关联一个或多个 JSP 页面。以前 CGI 经常因为性能开销上的问题被诟病，然而 Fast CGI 早就已经解决了 CGI 效率上的问题，所以面试的时候大可不必信口开河的诟病 CGI，事实上有很多你熟悉的网站都使用了 CGI 技术。</p><blockquote><h3 id="Servlet-接口中有哪些方法？"><a href="#Servlet-接口中有哪些方法？" class="headerlink" title="Servlet 接口中有哪些方法？"></a>Servlet 接口中有哪些方法？</h3></blockquote><p>答：Servlet 接口定义了 5 个方法，其中前三个方法与 Servlet 生命周期相关：</p><ul><li><code>void init(ServletConfig config) throws ServletException</code></li><li><code>void service(ServletRequest req, ServletResponse resp) throws ServletException, java.io.IOException</code></li><li><code>void destroy()</code></li><li><code>java.lang.String getServletInfo()</code></li><li><code>ServletConfig getServletConfig()</code></li></ul><p>Web 容器加载 Servlet 并将其实例化后，Servlet 生命周期开始，容器运行其 <code>init()</code> 方法进行 Servlet 的初始化；请求到达时调用 Servlet 的 <code>service()</code> 方法，<code>service()</code> 方法会根据需要调用与请求对应的 <code>doGet</code> 或 <code>doPost</code> 等方法；当服务器关闭或项目被卸载时服务器会将 Servlet 实例销毁，此时会调用 Servlet 的 <code>destroy()</code> 方法。</p><blockquote><h3 id="转发（forward）和重定向（redirect）的区别？"><a href="#转发（forward）和重定向（redirect）的区别？" class="headerlink" title="转发（forward）和重定向（redirect）的区别？"></a>转发（forward）和重定向（redirect）的区别？</h3></blockquote><p>答：<code>forward</code> 是容器中控制权的转向，是服务器请求资源，服务器直接访问目标地址的 URL，把那个 URL 的响应内容读取过来，然后把这些内容再发给浏览器，浏览器根本不知道服务器发送的内容是从哪儿来的，所以它的地址栏中还是原来的地址。<code>redirect</code> 就是服务器端根据逻辑，发送一个状态码，告诉浏览器重新去请求那个地址，因此从浏览器的地址栏中可以看到跳转后的链接地址，很明显 <code>redirect</code> 无法访问到服务器保护起来资源，但是可以从一个网站 <code>redirect</code> 到其他网站。<code>forward</code> 更加高效，所以在满足需要时尽量使用 <code>forward</code>（通过调用 <code>RequestDispatcher</code> 对象的 <code>forward()</code> 方法，该对象可以通过 <code>ServletRequest</code> 对象的 <code>getRequestDispatcher()</code> 方法获得），并且这样也有助于隐藏实际的链接；在有些情况下，比如需要访问一个其它服务器上的资源，则必须使用重定向（通过 <code>HttpServletResponse</code> 对象调用其 <code>sendRedirect()</code> 方法实现）。</p><blockquote><h3 id="JSP-有哪些内置对象？作用分别是什么？"><a href="#JSP-有哪些内置对象？作用分别是什么？" class="headerlink" title="JSP 有哪些内置对象？作用分别是什么？"></a>JSP 有哪些内置对象？作用分别是什么？</h3></blockquote><p>答：JSP 有 9 个内置对象：</p><ul><li><code>request</code>：封装客户端的请求，其中包含来自 GET 或 POST 请求的参数；</li><li><code>response</code>：封装服务器对客户端的响应；</li><li><code>pageContext</code>：通过该对象可以获取其他对象；</li><li><code>session</code>：封装用户会话的对象；</li><li><code>application</code>：封装服务器运行环境的对象；</li><li><code>out</code>：输出服务器响应的输出流对象；</li><li><code>config</code>：Web 应用的配置对象；</li><li><code>page</code>：JSP 页面本身（相当于 Java 程序中的 <code>this</code>）；</li><li><code>exception</code>：封装页面抛出异常的对象。</li></ul><p><strong>补充：</strong>如果用 Servlet 来生成网页中的动态内容无疑是非常繁琐的工作，另一方面，所有的文本和 HTML 标签都是硬编码，即使做出微小的修改，都需要进行重新编译。JSP 解决了 Servlet 的这些问题，它是 Servlet 很好的补充，可以专门用作为用户呈现视图（View），而 Servlet 作为控制器（Controller）专门负责处理用户请求并转发或重定向到某个页面。基于 Java 的 Web 开发很多都同时使用了 Servlet 和 JSP。JSP 页面其实是一个 Servlet，能够运行 Servlet 的服务器（Servlet 容器）通常也是 JSP 容器，可以提供 JSP 页面的运行环境，Tomcat 就是一个 Servlet/JSP 容器。第一次请求一个 JSP 页面时，Servlet/JSP 容器首先将 JSP 页面转换成一个 JSP 页面的实现类，这是一个实现了 JspPage 接口或其子接口 HttpJspPage 的 Java 类。JspPage 接口是 Servlet 的子接口，因此每个 JSP 页面都是一个 Servlet。转换成功后，容器会编译 Servlet 类，之后容器加载和实例化 Java 字节码，并执行它通常对 Servlet 所做的生命周期操作。对同一个 JSP 页面的后续请求，容器会查看这个 JSP 页面是否被修改过，如果修改过就会重新转换并重新编译并执行。如果没有则执行内存中已经存在的 Servlet 实例。我们可以看一段 JSP 代码对应的 Java 程序就知道一切了，而且 9 个内置对象的神秘面纱也会被揭开。</p><p>JSP 页面：</p><p><pre class="line-numbers language-jsp" data-language="jsp"><code class="language-jsp">&lt;%@ page pageEncoding&#x3D;&quot;UTF-8&quot;%&gt;&lt;%String path &#x3D; request.getContextPath();String basePath &#x3D; request.getScheme() + &quot;:&#x2F;&#x2F;&quot; + request.getServerName() + &quot;:&quot; + request.getServerPort() + path + &quot;&#x2F;&quot;;%&gt;&lt;!DOCTYPE html&gt;&lt;html&gt;  &lt;head&gt;    &lt;base href&#x3D;&quot;&lt;%&#x3D;basePath%&gt;&quot;&gt;    &lt;title&gt;首页&lt;&#x2F;title&gt;    &lt;style type&#x3D;&quot;text&#x2F;css&quot;&gt;        * &#123; font-family: &quot;Arial&quot;; &#125;    &lt;&#x2F;style&gt;  &lt;&#x2F;head&gt;  &lt;body&gt;    &lt;h1&gt;Hello, World!&lt;&#x2F;h1&gt;    &lt;hr&#x2F;&gt;    &lt;h2&gt;Current time is: &lt;%&#x3D; new java.util.Date().toString() %&gt;&lt;&#x2F;h2&gt;  &lt;&#x2F;body&gt;&lt;&#x2F;html&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p>对应的 Java 代码：</p><p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/* * Generated by the Jasper component of Apache Tomcat * Version: Apache Tomcat/7.0.52 * Generated at: 2014-10-13 13:28:38 UTC * Note: The last modified time of this file was set to *       the last modified time of the source file after *       generation to assist with modification tracking. */</span><span class="token keyword">package</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>jsp</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span></span><span class="token operator">*</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token operator">*</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>jsp<span class="token punctuation">.</span></span><span class="token operator">*</span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">class</span> index_jsp <span class="token keyword">extends</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>jasper<span class="token punctuation">.</span>runtime<span class="token punctuation">.</span><span class="token class-name">HttpJspBase</span>        <span class="token keyword">implements</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>jasper<span class="token punctuation">.</span>runtime<span class="token punctuation">.</span><span class="token class-name">JspSourceDependent</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>jsp<span class="token punctuation">.</span><span class="token class-name">JspFactory</span> _jspxFactory <span class="token operator">=</span> javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>jsp<span class="token punctuation">.</span><span class="token class-name">JspFactory</span>            <span class="token punctuation">.</span><span class="token function">getDefaultFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span><span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span>java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span><span class="token class-name">String</span><span class="token punctuation">,</span> java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span><span class="token class-name">Long</span><span class="token punctuation">></span></span> _jspx_dependants<span class="token punctuation">;</span>    <span class="token keyword">private</span> javax<span class="token punctuation">.</span>el<span class="token punctuation">.</span><span class="token class-name">ExpressionFactory</span> _el_expressionfactory<span class="token punctuation">;</span>    <span class="token keyword">private</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>tomcat<span class="token punctuation">.</span><span class="token class-name">InstanceManager</span> _jsp_instancemanager<span class="token punctuation">;</span>    <span class="token keyword">public</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span><span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span>java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span><span class="token class-name">String</span><span class="token punctuation">,</span> java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span><span class="token class-name">Long</span><span class="token punctuation">></span></span> <span class="token function">getDependants</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> _jspx_dependants<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">_jspInit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        _el_expressionfactory <span class="token operator">=</span> _jspxFactory<span class="token punctuation">.</span><span class="token function">getJspApplicationContext</span><span class="token punctuation">(</span>                <span class="token function">getServletConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getServletContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getExpressionFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        _jsp_instancemanager <span class="token operator">=</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>jasper<span class="token punctuation">.</span>runtime<span class="token punctuation">.</span><span class="token class-name">InstanceManagerFactory</span>                <span class="token punctuation">.</span><span class="token function">getInstanceManager</span><span class="token punctuation">(</span><span class="token function">getServletConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">_jspDestroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">_jspService</span><span class="token punctuation">(</span>            <span class="token keyword">final</span> javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span>            <span class="token keyword">final</span> javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span><span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">)</span>            <span class="token keyword">throws</span> java<span class="token punctuation">.</span>io<span class="token punctuation">.</span><span class="token class-name">IOException</span><span class="token punctuation">,</span> javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span><span class="token class-name">ServletException</span> <span class="token punctuation">&#123;</span>        <span class="token comment">// 内置对象就是在这里定义的</span>        <span class="token keyword">final</span> javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>jsp<span class="token punctuation">.</span><span class="token class-name">PageContext</span> pageContext<span class="token punctuation">;</span>        javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span><span class="token class-name">HttpSession</span> session <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>        <span class="token keyword">final</span> javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span><span class="token class-name">ServletContext</span> application<span class="token punctuation">;</span>        <span class="token keyword">final</span> javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span><span class="token class-name">ServletConfig</span> config<span class="token punctuation">;</span>        javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>jsp<span class="token punctuation">.</span><span class="token class-name">JspWriter</span> out <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>        <span class="token keyword">final</span> java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span><span class="token class-name">Object</span> page <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>        javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>jsp<span class="token punctuation">.</span><span class="token class-name">JspWriter</span> _jspx_out <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>        javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>jsp<span class="token punctuation">.</span><span class="token class-name">PageContext</span> _jspx_page_context <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>            response<span class="token punctuation">.</span><span class="token function">setContentType</span><span class="token punctuation">(</span><span class="token string">"text/html;charset=UTF-8"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            pageContext <span class="token operator">=</span> _jspxFactory<span class="token punctuation">.</span><span class="token function">getPageContext</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> request<span class="token punctuation">,</span> response<span class="token punctuation">,</span>                    <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token number">8192</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            _jspx_page_context <span class="token operator">=</span> pageContext<span class="token punctuation">;</span>            application <span class="token operator">=</span> pageContext<span class="token punctuation">.</span><span class="token function">getServletContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            config <span class="token operator">=</span> pageContext<span class="token punctuation">.</span><span class="token function">getServletConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            session <span class="token operator">=</span> pageContext<span class="token punctuation">.</span><span class="token function">getSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            out <span class="token operator">=</span> pageContext<span class="token punctuation">.</span><span class="token function">getOut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            _jspx_out <span class="token operator">=</span> out<span class="token punctuation">;</span>            out<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">'\r'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            out<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">String</span> path <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getContextPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">String</span> basePath <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getScheme</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"://"</span>                    <span class="token operator">+</span> request<span class="token punctuation">.</span><span class="token function">getServerName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">":"</span> <span class="token operator">+</span> request<span class="token punctuation">.</span><span class="token function">getServerPort</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                    <span class="token operator">+</span> path <span class="token operator">+</span> <span class="token string">"/"</span><span class="token punctuation">;</span>                        <span class="token comment">// 以下代码通过输出流将HTML标签输出到浏览器中</span>            out<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">"\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            out<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">"\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            out<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">"&lt;!DOCTYPE html>\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            out<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">"&lt;html>\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            out<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">"  &lt;head>\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            out<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">"    &lt;base href=\""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span>basePath<span class="token punctuation">)</span><span class="token punctuation">;</span>            out<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">"\">\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            out<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">"    &lt;title>首页&lt;/title>\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            out<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">"    &lt;style type=\"text/css\">\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            out<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">"    \t* &#123; font-family: \"Arial\"; &#125;\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            out<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">"    &lt;/style>\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            out<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">"  &lt;/head>\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            out<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">"  \r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            out<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">"  &lt;body>\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            out<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">"    &lt;h1>Hello, World!&lt;/h1>\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            out<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">"    &lt;hr/>\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            out<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">"    &lt;h2>Current time is: "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token keyword">new</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span><span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            out<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">"&lt;/h2>\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            out<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">"  &lt;/body>\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            out<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">"&lt;/html>\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span><span class="token class-name">Throwable</span> t<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>t <span class="token keyword">instanceof</span> javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>jsp<span class="token punctuation">.</span><span class="token class-name">SkipPageException</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                out <span class="token operator">=</span> _jspx_out<span class="token punctuation">;</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>out <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> out<span class="token punctuation">.</span><span class="token function">getBufferSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span>                    <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>                        out<span class="token punctuation">.</span><span class="token function">clearBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>java<span class="token punctuation">.</span>io<span class="token punctuation">.</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    <span class="token punctuation">&#125;</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>_jspx_page_context <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>                    _jspx_page_context<span class="token punctuation">.</span><span class="token function">handlePageException</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">else</span>                    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">ServletException</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">finally</span> <span class="token punctuation">&#123;</span>            _jspxFactory<span class="token punctuation">.</span><span class="token function">releasePageContext</span><span class="token punctuation">(</span>_jspx_page_context<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><blockquote><h3 id="get-和-post-请求的区别？"><a href="#get-和-post-请求的区别？" class="headerlink" title="get 和 post 请求的区别？"></a>get 和 post 请求的区别？</h3></blockquote><p>答：</p><ol><li>get 请求用来从服务器上获得资源，而 post 是用来向服务器提交数据；</li><li>get 将表单中数据按照 <code>name=value</code> 的形式，添加到 <code>action</code> 所指向的 URL 后面，并且两者使用 <code>?</code> 连接，而各个变量之间使用 <code>&amp;</code> 连接；post 是将表单中的数据放在 HTTP 协议的请求头或消息体中，传递到 <code>action</code> 所指向 URL；</li><li>get 传输的数据要受到 URL 长度限制（1024 字节）；而 post 可以传输大量的数据，上传文件通常要使用 post 方式；</li><li>使用 get 时参数会显示在地址栏上，如果这些数据不是敏感数据，那么可以使用 get；对于敏感数据还是应用使用 post；</li><li>get 使用 MIME 类型 <code>application/x-www-form-urlencoded</code> 的 URL 编码（也叫百分号编码）文本的格式传递参数，保证被传送的参数由遵循规范的文本组成，例如一个空格的编码是 <code>%20</code>。</li></ol><blockquote><h3 id="常用的-Web-服务器有哪些？"><a href="#常用的-Web-服务器有哪些？" class="headerlink" title="常用的 Web 服务器有哪些？"></a>常用的 Web 服务器有哪些？</h3></blockquote><p>答：Unix 和 Linux 平台下使用最广泛的免费 HTTP 服务器是 Apache 服务器，而 Windows 平台的服务器通常使用 IIS 作为 Web 服务器。选择 Web 服务器应考虑的因素有：性能、安全性、日志和统计、虚拟主机、代理服务器、缓冲服务和集成应用程序等。下面是对常见服务器的简介：</p><ul><li><p>IIS：Microsoft 的 Web 服务器产品，全称是 Internet Information Services。IIS 是允许在公共 Intranet 或 Internet 上发布信息的 Web 服务器。IIS 是目前最流行的 Web 服务器产品之一，很多著名的网站都是建立在 IIS 的平台上。IIS 提供了一个图形界面的管理工具，称为 Internet 服务管理器，可用于监视配置和控制 Internet 服务。IIS 是一种 Web 服务组件，其中包括 Web 服务器、FTP 服务器、NNTP 服务器和 SMTP 服务器，分别用于网页浏览、文件传输、新闻服务和邮件发送等方面，它使得在网络（包括互联网和局域网）上发布信息成了一件很容易的事。它提供 ISAPI（Intranet Server API）作为扩展 Web 服务器功能的编程接口；同时，它还提供一个 Internet 数据库连接器，可以实现对数据库的查询和更新。</p></li><li><p>Kangle：Kangle Web 服务器是一款跨平台、功能强大、安全稳定、易操作的高性能 Web 服务器和反向代理服务器软件。此外，Kangle 也是一款专为做虚拟主机研发的 Web 服务器。实现虚拟主机独立进程、独立身份运行。用户之间安全隔离，一个用户出问题不影响其他用户。支持 PHP、ASP、ASP.NET、Java、Ruby 等多种动态开发语言。</p></li><li><p>WebSphere：WebSphere Application Server 是功能完善、开放的 Web 应用程序服务器，是 IBM 电子商务计划的核心部分，它是基于 Java 的应用环境，用于建立、部署和管理 Internet 和 Intranet Web 应用程序，适应各种 Web 应用程序服务器的需要。</p></li><li><p>WebLogic：WebLogic Server 是一款多功能、基于标准的 Web 应用服务器，为企业构建企业应用提供了坚实的基础。针对各种应用开发、关键性任务的部署，各种系统和数据库的集成、跨 Internet 协作等 Weblogic 都提供了相应的支持。由于它具有全面的功能、对开放标准的遵从性、多层架构、支持基于组件的开发等优势，很多公司的企业级应用都选择它来作为开发和部署的环境。WebLogic Server 在使应用服务器成为企业应用架构的基础方面一直处于领先地位，为构建集成化的企业级应用提供了稳固的基础。</p></li><li><p>Apache：目前 Apache 仍然是世界上用得最多的 Web 服务器，其市场占有率很长时间都保持在 60% 以上（目前的市场份额约 40% 左右）。世界上很多著名的网站都是 Apache 的产物，它的成功之处主要在于它的源代码开放、有一支强大的开发团队、支持跨平台的应用（可以运行在几乎所有的 Unix、Windows、Linux 系统平台上）以及它的可移植性等方面。</p></li><li><p>Tomcat：Tomcat 是一个开放源代码、运行 Servlet 和 JSP 的容器。Tomcat 实现了 Servlet 和 JSP 规范。此外，Tomcat 还实现了 Apache-Jakarta 规范而且比绝大多数商业应用软件服务器要好，因此目前也有不少的 Web 服务器都选择了 Tomcat。</p></li><li><p>Nginx：读作&quot;engine x&quot;，是一个高性能的 HTTP 和反向代理服务器，也是一个 IMAP/POP3/SMTP 代理服务器。 Nginx 是由 Igor Sysoev 为俄罗斯访问量第二的 Rambler 站点开发的，第一个公开版本 0.1.0 发布于 2004 年 10 月 4 日。其将源代码以类 BSD 许可证的形式发布，因它的稳定性、丰富的功能集、示例配置文件和低系统资源的消耗而闻名。在 2014 年下半年，Nginx 的市场份额达到了 14%。</p></li></ul><blockquote><h3 id="JSP-和-Servlet-是什么关系？"><a href="#JSP-和-Servlet-是什么关系？" class="headerlink" title="JSP 和 Servlet 是什么关系？"></a>JSP 和 Servlet 是什么关系？</h3></blockquote><p>答：其实这个问题在上面已经阐述过了，Servlet 是一个特殊的 Java 程序，它运行于服务器的 JVM 中，能够依靠服务器的支持向浏览器提供显示内容。JSP 本质上是 Servlet 的一种简易形式，JSP 会被服务器处理成一个类似于 Servlet 的 Java 程序，可以简化页面内容的生成。Servlet 和 JSP 最主要的不同点在于，Servlet 的应用逻辑是在 Java 文件中，并且完全从表示层中的 HTML 分离开来。而 JSP 的情况是 Java 和 HTML 可以组合成一个扩展名为 <code>.jsp</code> 的文件。有人说，Servlet 就是在 Java 中写 HTML，而 JSP 就是在 HTML 中写 Java 代码，当然这个说法是很片面且不够准确的。JSP 侧重于视图，Servlet 更侧重于控制逻辑，在 MVC 架构模式中，JSP 适合充当视图（view）而 Servlet 适合充当控制器（controller）。</p><blockquote><h3 id="讲解-JSP-中的四种作用域。"><a href="#讲解-JSP-中的四种作用域。" class="headerlink" title="讲解 JSP 中的四种作用域。"></a>讲解 JSP 中的四种作用域。</h3></blockquote><p>答：JSP 中的四种作用域包括 <code>page</code>、<code>request</code>、<code>session</code> 和 <code>application</code>，具体来说：</p><ul><li><code>page</code> 代表与一个页面相关的对象和属性。</li><li><code>request</code> 代表与 Web 客户机发出的一个请求相关的对象和属性。一个请求可能跨越多个页面，涉及多个 Web 组件；需要在页面显示的临时数据可以置于此作用域。</li><li><code>session</code> 代表与某个用户与服务器建立的一次会话相关的对象和属性。跟某个用户相关的数据应该放在用户自己的 session 中。</li><li><code>application</code> 代表与整个 Web 应用程序相关的对象和属性，它实质上是跨越整个 Web 应用程序，包括多个页面、请求和会话的一个全局作用域。</li></ul><blockquote><h3 id="如何实现-JSP-或-Servlet-的单线程模式？"><a href="#如何实现-JSP-或-Servlet-的单线程模式？" class="headerlink" title="如何实现 JSP 或 Servlet 的单线程模式？"></a>如何实现 JSP 或 Servlet 的单线程模式？</h3></blockquote><p>答：</p><p>对于 JSP 页面，可以通过 <code>page</code> 指令进行设置。</p><p><pre class="line-numbers language-jsp" data-language="jsp"><code class="language-jsp">&lt;%@page isThreadSafe&#x3D;”false”%&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><p>对于 Servlet，可以让自定义的 Servlet 实现 <code>SingleThreadModel</code> 标识接口。</p><p><strong>说明：</strong>如果将 JSP 或 Servlet 设置成单线程工作模式，会导致每个请求创建一个 Servlet 实例，这种实践将导致严重的性能问题（服务器的内存压力很大，还会导致频繁的垃圾回收），所以通常情况下并不会这么做。</p><blockquote><h3 id="实现会话跟踪的技术有哪些？"><a href="#实现会话跟踪的技术有哪些？" class="headerlink" title="实现会话跟踪的技术有哪些？"></a>实现会话跟踪的技术有哪些？</h3></blockquote><p>答：由于 HTTP 协议本身是无状态的，服务器为了区分不同的用户，就需要对用户会话进行跟踪，简单的说就是为用户进行登记，为用户分配唯一的 ID，下一次用户在请求中包含此 ID，服务器据此判断到底是哪一个用户。</p><ol><li>URL 重写：在 URL 中添加用户会话的信息作为请求的参数，或者将唯一的会话 ID 添加到 URL 结尾以标识一个会话。</li><li>设置表单隐藏域：将和会话跟踪相关的字段添加到隐式表单域中，这些信息不会在浏览器中显示但是提交表单时会提交给服务器。这两种方式很难处理跨越多个页面的信息传递，因为如果每次都要修改 URL 或在页面中添加隐式表单域来存储用户会话相关信息，事情将变得非常麻烦。</li><li>cookie：cookie 有两种，一种是基于窗口的，浏览器窗口关闭后，cookie 就没有了；另一种是将信息存储在一个临时文件中，并设置存在的时间。当用户通过浏览器和服务器建立一次会话后，会话 ID 就会随响应信息返回存储在基于窗口的 cookie 中，那就意味着只要浏览器没有关闭，会话没有超时，下一次请求时这个会话 ID 又会提交给服务器让服务器识别用户身份。会话中可以为用户保存信息。会话对象是在服务器内存中的，而基于窗口的 cookie 是在客户端内存中的。如果浏览器禁用了 cookie，那么就需要通过下面两种方式进行会话跟踪。当然，在使用 cookie 时要注意几点：首先不要在 cookie 中存放敏感信息；其次 cookie 存储的数据量有限（4k），不能将过多的内容存储 cookie 中；再者浏览器通常只允许一个站点最多存放 20 个 cookie。当然，和用户会话相关的其他信息（除了会话 ID）也可以存在 cookie 方便进行会话跟踪。</li><li>HttpSession：在所有会话跟踪技术中，HttpSession 对象是最强大也是功能最多的。当一个用户第一次访问某个网站时会自动创建 HttpSession，每个用户可以访问他自己的 HttpSession。可以通过 <code>HttpServletRequest</code> 对象的 <code>getSession</code> 方法获得 HttpSession，通过 HttpSession 的 <code>setAttribute</code> 方法可以将一个值放在 HttpSession 中，通过调用 HttpSession 对象的 <code>getAttribute</code> 方法，同时传入属性名就可以获取保存在 HttpSession 中的对象。与上面三种方式不同的是，HttpSession 放在服务器的内存中，因此不要将过大的对象放在里面，即使目前的 Servlet 容器可以在内存将满时将 HttpSession 中的对象移到其他存储设备中，但是这样势必影响性能。添加到 HttpSession 中的值可以是任意 Java 对象，这个对象最好实现了 <code>Serializable</code> 接口，这样 Servlet 容器在必要的时候可以将其序列化到文件中，否则在序列化时就会出现异常。</li></ol><p><strong>补充：</strong>HTML5 中可以使用 Web Storage 技术通过 JavaScript 来保存数据，例如可以使用 <code>localStorage</code> 和 <code>sessionStorage</code> 来保存用户会话的信息，也能够实现会话跟踪。</p><blockquote><h3 id="过滤器有哪些作用和用法？"><a href="#过滤器有哪些作用和用法？" class="headerlink" title="过滤器有哪些作用和用法？"></a>过滤器有哪些作用和用法？</h3></blockquote><p>答：Java Web 开发中的过滤器（filter）是从 Servlet 2.3 规范开始增加的功能，并在 Servlet 2.4 规范中得到增强。对 Web 应用来说，过滤器是一个驻留在服务器端的 Web 组件，它可以截取客户端和服务器之间的请求与响应信息，并对这些信息进行过滤。当 Web 容器接受到一个对资源的请求时，它将判断是否有过滤器与这个资源相关联。如果有，那么容器将把请求交给过滤器进行处理。在过滤器中，你可以改变请求的内容，或者重新设置请求的报头信息，然后再将请求发送给目标资源。当目标资源对请求作出响应时候，容器同样会将响应先转发给过滤器，在过滤器中你可以对响应的内容进行转换，然后再将响应发送到客户端。</p><p>常见的过滤器用途主要包括：对用户请求进行统一认证、对用户的访问请求进行记录和审核、对用户发送的数据进行过滤或替换、转换图象格式、对响应内容进行压缩以减少传输量、对请求或响应进行加解密处理、触发资源访问事件、对 XML 的输出应用 XSLT 等。</p><p>和过滤器相关的接口主要有：<code>Filter</code>、<code>FilterConfig</code> 和 <code>FilterChain</code>。</p><p>编码过滤器的例子：</p><p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span></span><span class="token class-name">Filter</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span></span><span class="token class-name">FilterChain</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span></span><span class="token class-name">FilterConfig</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span></span><span class="token class-name">ServletException</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span></span><span class="token class-name">ServletRequest</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span></span><span class="token class-name">ServletResponse</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">WebFilter</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">WebInitParam</span><span class="token punctuation">;</span><span class="token annotation punctuation">@WebFilter</span><span class="token punctuation">(</span>urlPatterns <span class="token operator">=</span> <span class="token punctuation">&#123;</span> <span class="token string">"*"</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> initParams <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token annotation punctuation">@WebInitParam</span><span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">"encoding"</span><span class="token punctuation">,</span> value<span class="token operator">=</span><span class="token string">"utf-8"</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CodingFilter</span> <span class="token keyword">implements</span> <span class="token class-name">Filter</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> defaultEncoding <span class="token operator">=</span> <span class="token string">"utf-8"</span><span class="token punctuation">;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">doFilter</span><span class="token punctuation">(</span><span class="token class-name">ServletRequest</span> req<span class="token punctuation">,</span> <span class="token class-name">ServletResponse</span> resp<span class="token punctuation">,</span>            <span class="token class-name">FilterChain</span> chain<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">ServletException</span> <span class="token punctuation">&#123;</span>        req<span class="token punctuation">.</span><span class="token function">setCharacterEncoding</span><span class="token punctuation">(</span>defaultEncoding<span class="token punctuation">)</span><span class="token punctuation">;</span>        resp<span class="token punctuation">.</span><span class="token function">setCharacterEncoding</span><span class="token punctuation">(</span>defaultEncoding<span class="token punctuation">)</span><span class="token punctuation">;</span>        chain<span class="token punctuation">.</span><span class="token function">doFilter</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> resp<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token class-name">FilterConfig</span> config<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">String</span> encoding <span class="token operator">=</span> config<span class="token punctuation">.</span><span class="token function">getInitParameter</span><span class="token punctuation">(</span><span class="token string">"encoding"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>encoding <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            defaultEncoding <span class="token operator">=</span> encoding<span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p>下载计数过滤器的例子：</p><p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">File</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">FileReader</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">FileWriter</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Properties</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">ExecutorService</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">Executors</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span></span><span class="token class-name">Filter</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span></span><span class="token class-name">FilterChain</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span></span><span class="token class-name">FilterConfig</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span></span><span class="token class-name">ServletException</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span></span><span class="token class-name">ServletRequest</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span></span><span class="token class-name">ServletResponse</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">WebFilter</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpServletRequest</span><span class="token punctuation">;</span><span class="token annotation punctuation">@WebFilter</span><span class="token punctuation">(</span>urlPatterns <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token string">"/*"</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DownloadCounterFilter</span> <span class="token keyword">implements</span> <span class="token class-name">Filter</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token class-name">ExecutorService</span> executorService <span class="token operator">=</span> <span class="token class-name">Executors</span><span class="token punctuation">.</span><span class="token function">newSingleThreadExecutor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">Properties</span> downloadLog<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">File</span> logFile<span class="token punctuation">;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        executorService<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">doFilter</span><span class="token punctuation">(</span><span class="token class-name">ServletRequest</span> req<span class="token punctuation">,</span> <span class="token class-name">ServletResponse</span> resp<span class="token punctuation">,</span>            <span class="token class-name">FilterChain</span> chain<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">ServletException</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">HttpServletRequest</span> request <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span><span class="token punctuation">)</span> req<span class="token punctuation">;</span>        <span class="token keyword">final</span> <span class="token class-name">String</span> uri <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getRequestURI</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        executorService<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Runnable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token annotation punctuation">@Override</span>            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token class-name">String</span> value <span class="token operator">=</span> downloadLog<span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span>uri<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">if</span><span class="token punctuation">(</span>value <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    downloadLog<span class="token punctuation">.</span><span class="token function">setProperty</span><span class="token punctuation">(</span>uri<span class="token punctuation">,</span> <span class="token string">"1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>                <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>                    <span class="token keyword">int</span> count <span class="token operator">=</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">parseInt</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>                    downloadLog<span class="token punctuation">.</span><span class="token function">setProperty</span><span class="token punctuation">(</span>uri<span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span><span class="token operator">++</span>count<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>                <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>                    downloadLog<span class="token punctuation">.</span><span class="token function">store</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">FileWriter</span><span class="token punctuation">(</span>logFile<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>                 <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        chain<span class="token punctuation">.</span><span class="token function">doFilter</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> resp<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token class-name">FilterConfig</span> config<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">String</span> appPath <span class="token operator">=</span> config<span class="token punctuation">.</span><span class="token function">getServletContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getRealPath</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        logFile <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span>appPath<span class="token punctuation">,</span> <span class="token string">"downloadLog.txt"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>logFile<span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>                logFile<span class="token punctuation">.</span><span class="token function">createNewFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>             <span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>        downloadLog <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Properties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>            downloadLog<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">FileReader</span><span class="token punctuation">(</span>logFile<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p><strong>说明：</strong>这里使用了 Servlet 3 规范中的注解来部署过滤器，当然也可以在 web.xml 中使用 <code>&lt;filter&gt;</code> 和 <code>&lt;filter-mapping&gt;</code> 标签部署过滤器，如 108 题中所示。</p><blockquote><h3 id="监听器有哪些作用和用法？"><a href="#监听器有哪些作用和用法？" class="headerlink" title="监听器有哪些作用和用法？"></a>监听器有哪些作用和用法？</h3></blockquote><p>答：Java Web 开发中的监听器（listener）就是 <code>application</code>、<code>session</code>、<code>request</code> 三个对象创建、销毁或者往其中添加修改删除属性时自动执行代码的功能组件，如下所示：</p><ol><li><code>ServletContextListener</code>：对 Servlet 上下文的创建和销毁进行监听。</li><li><code>ServletContextAttributeListener</code>：监听 Servlet 上下文属性的添加、删除和替换。</li><li><code>HttpSessionListener</code>：对 Session 的创建和销毁进行监听。</li><li><code>HttpSessionAttributeListener</code>：对 Session 对象中属性的添加、删除和替换进行监听。</li><li><code>ServletRequestListener</code>：对请求对象的初始化和销毁进行监听。</li><li><code>ServletRequestAttributeListener</code>：对请求对象属性的添加、删除和替换进行监听。</li></ol><p><strong>补充：</strong>session 的销毁有两种情况：(1)session 超时（可以在 web.xml 中通过 <code>&lt;session-config&gt;/&lt;session-timeout&gt;</code> 标签配置超时时间）；(2)通过调用 session 对象的 <code>invalidate()</code> 方法使 session 失效。</p><p>下面是一个统计网站最多在线人数监听器的例子。</p><p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span></span><span class="token class-name">ServletContextEvent</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span></span><span class="token class-name">ServletContextListener</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">WebListener</span><span class="token punctuation">;</span><span class="token comment">/** 上下文监听器，在服务器启动时初始化onLineCount和maxOnLineCount两个变量 并将其置于服务器上下文（ServletContext）中，其初始值都是0*/</span><span class="token annotation punctuation">@WebListener</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">InitListener</span> <span class="token keyword">implements</span> <span class="token class-name">ServletContextListener</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">contextDestroyed</span><span class="token punctuation">(</span><span class="token class-name">ServletContextEvent</span> evt<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">contextInitialized</span><span class="token punctuation">(</span><span class="token class-name">ServletContextEvent</span> evt<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        evt<span class="token punctuation">.</span><span class="token function">getServletContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"onLineCount"</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        evt<span class="token punctuation">.</span><span class="token function">getServletContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"maxOnLineCount"</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>text<span class="token punctuation">.</span></span><span class="token class-name">DateFormat</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>text<span class="token punctuation">.</span></span><span class="token class-name">SimpleDateFormat</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Date</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span></span><span class="token class-name">ServletContext</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">WebListener</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpSessionEvent</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpSessionListener</span><span class="token punctuation">;</span><span class="token comment">/** 会话监听器，在用户会话创建和销毁的时候根据情况 修改onLineCount和maxOnLineCount的值*/</span><span class="token annotation punctuation">@WebListener</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MaxCountListener</span> <span class="token keyword">implements</span> <span class="token class-name">HttpSessionListener</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">sessionCreated</span><span class="token punctuation">(</span><span class="token class-name">HttpSessionEvent</span> event<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">ServletContext</span> ctx <span class="token operator">=</span> event<span class="token punctuation">.</span><span class="token function">getSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getServletContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">int</span> count <span class="token operator">=</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">parseInt</span><span class="token punctuation">(</span>ctx<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">"onLineCount"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        count<span class="token operator">++</span><span class="token punctuation">;</span>        ctx<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"onLineCount"</span><span class="token punctuation">,</span> count<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">int</span> maxOnLineCount <span class="token operator">=</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">parseInt</span><span class="token punctuation">(</span>ctx<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">"maxOnLineCount"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>count <span class="token operator">></span> maxOnLineCount<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            ctx<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"maxOnLineCount"</span><span class="token punctuation">,</span> count<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">DateFormat</span> df <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SimpleDateFormat</span><span class="token punctuation">(</span><span class="token string">"yyyy-MM-dd HH:mm:ss"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            ctx<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"date"</span><span class="token punctuation">,</span> df<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">sessionDestroyed</span><span class="token punctuation">(</span><span class="token class-name">HttpSessionEvent</span> event<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">ServletContext</span> app <span class="token operator">=</span> event<span class="token punctuation">.</span><span class="token function">getSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getServletContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">int</span> count <span class="token operator">=</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">parseInt</span><span class="token punctuation">(</span>app<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">"onLineCount"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        count<span class="token operator">--</span><span class="token punctuation">;</span>        app<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"onLineCount"</span><span class="token punctuation">,</span> count<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p><strong>说明：</strong>这里使用了 Servlet 3 规范中的 @WebListener 注解配置监听器，当然你可以在 web.xml 文件中用 <code>&lt;listener&gt;</code> 标签配置监听器，如 108 题中所示。</p><blockquote><h3 id="web-xml-文件中可以配置哪些内容？"><a href="#web-xml-文件中可以配置哪些内容？" class="headerlink" title="web.xml 文件中可以配置哪些内容？"></a>web.xml 文件中可以配置哪些内容？</h3></blockquote><p>答：web.xml 用于配置 Web 应用的相关信息，如：监听器（listener）、过滤器（filter）、Servlet、相关参数、会话超时时间、安全验证方式、错误页面等，下面是一些开发中常见的配置：</p><ol><li>配置Spring上下文加载监听器加载Spring配置文件并创建IoC容器：</li></ol><p><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>context-param</span><span class="token punctuation">></span></span>   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param-name</span><span class="token punctuation">></span></span>contextConfigLocation<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>param-name</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param-value</span><span class="token punctuation">></span></span>classpath:applicationContext.xml<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>param-value</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>context-param</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>listener</span><span class="token punctuation">></span></span>   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>listener-class</span><span class="token punctuation">></span></span>     org.springframework.web.context.ContextLoaderListener   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>listener-class</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>listener</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><ol><li>配置Spring的OpenSessionInView过滤器来解决延迟加载和Hibernate会话关闭的矛盾：</li></ol><p><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filter</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filter-name</span><span class="token punctuation">></span></span>openSessionInView<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filter-name</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filter-class</span><span class="token punctuation">></span></span>       org.springframework.orm.hibernate3.support.OpenSessionInViewFilter    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filter-class</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filter</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filter-mapping</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filter-name</span><span class="token punctuation">></span></span>openSessionInView<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filter-name</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>url-pattern</span><span class="token punctuation">></span></span>/*<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>url-pattern</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filter-mapping</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><ol><li>配置会话超时时间为10分钟：</li></ol><p><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>session-config</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>session-timeout</span><span class="token punctuation">></span></span>10<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>session-timeout</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>session-config</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></p><ol><li>配置404和Exception的错误页面：</li></ol><p><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>error-page</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>error-code</span><span class="token punctuation">></span></span>404<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>error-code</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>location</span><span class="token punctuation">></span></span>/error.jsp<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>location</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>error-page</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>error-page</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exception-type</span><span class="token punctuation">></span></span>java.lang.Exception<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exception-type</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>location</span><span class="token punctuation">></span></span>/error.jsp<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>location</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>error-page</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><ol><li>配置安全认证方式：</li></ol><p><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>security-constraint</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>web-resource-collection</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>web-resource-name</span><span class="token punctuation">></span></span>ProtectedArea<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>web-resource-name</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>url-pattern</span><span class="token punctuation">></span></span>/admin/*<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>url-pattern</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>http-method</span><span class="token punctuation">></span></span>GET<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>http-method</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>http-method</span><span class="token punctuation">></span></span>POST<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>http-method</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>web-resource-collection</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>auth-constraint</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>role-name</span><span class="token punctuation">></span></span>admin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>role-name</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>auth-constraint</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>security-constraint</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>login-config</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>auth-method</span><span class="token punctuation">></span></span>BASIC<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>auth-method</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>login-config</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>security-role</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>role-name</span><span class="token punctuation">></span></span>admin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>role-name</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>security-role</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p><strong>说明：</strong>对 Servlet（小服务）、Listener（监听器）和 Filter（过滤器）等 Web 组件的配置，Servlet 3 规范提供了基于注解的配置方式，可以分别使用 <code>@WebServlet</code>、<code>@WebListener</code>、<code>@WebFilter</code> 注解进行配置。</p><p><strong>补充：</strong>如果 Web 提供了有价值的商业信息或者是敏感数据，那么站点的安全性就是必须考虑的问题。安全认证是实现安全性的重要手段，认证就是要解决“Are you who you say you are?”的问题。认证的方式非常多，简单说来可以分为三类：</p><ul><li>A. What you know? — 口令</li><li>B. What you have? — 数字证书（U盾、密保卡）</li><li>C. Who you are? — 指纹识别、虹膜识别</li></ul><p>在 Tomcat 中可以通过建立安全套接字层（Secure Socket Layer, SSL）以及通过基本验证或表单验证来实现对安全性的支持。</p><blockquote><h3 id="你的项目中使用过哪些-JSTL-标签（JSP-标准标签库）？"><a href="#你的项目中使用过哪些-JSTL-标签（JSP-标准标签库）？" class="headerlink" title="你的项目中使用过哪些 JSTL 标签（JSP 标准标签库）？"></a>你的项目中使用过哪些 JSTL 标签（JSP 标准标签库）？</h3></blockquote><p>答：项目中主要使用了 JSTL 的核心标签库，包括 <code>&lt;c:if&gt;</code>、<code>&lt;c:choose&gt;</code>、<code>&lt;c: when&gt;</code>、<code>&lt;c: otherwise&gt;</code>、<code>&lt;c:forEach&gt;</code> 等，主要用于构造循环和分支结构以控制显示逻辑。</p><p><strong>说明：</strong>虽然 JSTL 标签库提供了 <code>core</code>、<code>sql</code>、<code>fmt</code>、<code>xml</code> 等标签库，但是实际开发中建议只使用核心标签库（<code>core</code>），而且最好只使用分支和循环标签并辅以表达式语言（EL），这样才能真正做到数据显示和业务逻辑的分离，这才是最佳实践。</p><blockquote><h3 id="使用标签库有什么好处？如何自定义-JSP-标签？"><a href="#使用标签库有什么好处？如何自定义-JSP-标签？" class="headerlink" title="使用标签库有什么好处？如何自定义 JSP 标签？"></a>使用标签库有什么好处？如何自定义 JSP 标签？</h3></blockquote><p>答：使用标签库的好处包括以下几个方面：</p><ul><li>分离 JSP 页面的内容和逻辑，简化了 Web 开发；</li><li>开发者可以创建自定义标签来封装业务逻辑和显示逻辑；</li><li>标签具有很好的可移植性、可维护性和可重用性；</li><li>避免了对 Scriptlet（小脚本）的使用（很多公司的项目开发都不允许在 JSP 中书写小脚本）。</li></ul><p>自定义 JSP 标签包括以下几个步骤：</p><ol><li>编写一个 Java 类实现实现 <code>Tag</code>/<code>BodyTag</code>/<code>IterationTag</code> 接口（开发中通常不直接实现这些接口而是继承 <code>TagSupport</code>/<code>BodyTagSupport</code>/<code>SimpleTagSupport</code> 类，这是对缺省适配模式的应用），重写 <code>doStartTag()</code>、<code>doEndTag()</code> 等方法，定义标签要完成的功能；</li><li>编写扩展名为 <code>tld</code> 的标签描述文件对自定义标签进行部署，tld 文件通常放在 WEB-INF 文件夹下或其子目录中；</li><li>在 JSP 页面中使用 <code>taglib</code> 指令引用该标签库。</li></ol><p>下面是一个自定义标签库的例子。</p><ol><li><p>标签类源代码 TimeTag.java：</p><p> <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>jackfrued<span class="token punctuation">.</span>tags</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>text<span class="token punctuation">.</span></span><span class="token class-name">SimpleDateFormat</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Date</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>jsp<span class="token punctuation">.</span></span><span class="token class-name">JspException</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>jsp<span class="token punctuation">.</span></span><span class="token class-name">JspWriter</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>jsp<span class="token punctuation">.</span>tagext<span class="token punctuation">.</span></span><span class="token class-name">TagSupport</span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TimeTag</span> <span class="token keyword">extends</span> <span class="token class-name">TagSupport</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">long</span> serialVersionUID <span class="token operator">=</span> <span class="token number">1L</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> format <span class="token operator">=</span> <span class="token string">"yyyy-MM-dd hh:mm:ss"</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> foreColor <span class="token operator">=</span> <span class="token string">"black"</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> backColor <span class="token operator">=</span> <span class="token string">"white"</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">doStartTag</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">JspException</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">SimpleDateFormat</span> sdf <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SimpleDateFormat</span><span class="token punctuation">(</span>format<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">JspWriter</span> writer <span class="token operator">=</span> pageContext<span class="token punctuation">.</span><span class="token function">getOut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">StringBuilder</span> sb <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        sb<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"&lt;span style='color:%s;background-color:%s'>%s&lt;/span>"</span><span class="token punctuation">,</span>            foreColor<span class="token punctuation">,</span> backColor<span class="token punctuation">,</span> sdf<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>          writer<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span>sb<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>          e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">return</span> SKIP_BODY<span class="token punctuation">;</span>      <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setFormat</span><span class="token punctuation">(</span><span class="token class-name">String</span> format<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>format <span class="token operator">=</span> format<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setForeColor</span><span class="token punctuation">(</span><span class="token class-name">String</span> foreColor<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>foreColor <span class="token operator">=</span> foreColor<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setBackColor</span><span class="token punctuation">(</span><span class="token class-name">String</span> backColor<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>backColor <span class="token operator">=</span> backColor<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p></li><li><p>编写标签库描述文件 my.tld：</p><p> <pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8" ?></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>taglib</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://java.sun.com/xml/ns/j2ee<span class="token punctuation">"</span></span>    <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">"</span></span>    <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://java.sun.com/xml/ns/j2ee     http://java.sun.com/xml/ns/j2ee/web-jsptaglibrary_2_0.xsd<span class="token punctuation">"</span></span>    <span class="token attr-name">version</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>2.0<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>description</span><span class="token punctuation">></span></span>定义标签库<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>description</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tlib-version</span><span class="token punctuation">></span></span>1.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tlib-version</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>short-name</span><span class="token punctuation">></span></span>MyTag<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>short-name</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tag</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">></span></span>time<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tag-class</span><span class="token punctuation">></span></span>com.jackfrued.tags.TimeTag<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tag-class</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body-content</span><span class="token punctuation">></span></span>empty<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body-content</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>attribute</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">></span></span>format<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>required</span><span class="token punctuation">></span></span>false<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>required</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>attribute</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>attribute</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">></span></span>foreColor<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>attribute</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>attribute</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">></span></span>backColor<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>attribute</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tag</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>taglib</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p></li><li><p>在 JSP 页面中使用自定义标签：</p><p> <pre class="line-numbers language-jsp" data-language="jsp"><code class="language-jsp">&lt;%@ page pageEncoding&#x3D;&quot;UTF-8&quot;%&gt;&lt;%@ taglib prefix&#x3D;&quot;my&quot; uri&#x3D;&quot;&#x2F;WEB-INF&#x2F;tld&#x2F;my.tld&quot; %&gt;&lt;%String path &#x3D; request.getContextPath();String basePath &#x3D; request.getScheme() + &quot;:&#x2F;&#x2F;&quot; + request.getServerName() + &quot;:&quot; + request.getServerPort() + path + &quot;&#x2F;&quot;;%&gt;&lt;!DOCTYPE html&gt;&lt;html&gt;  &lt;head&gt;    &lt;base href&#x3D;&quot;&lt;%&#x3D;basePath%&gt;&quot;&gt;    &lt;title&gt;首页&lt;&#x2F;title&gt;    &lt;style type&#x3D;&quot;text&#x2F;css&quot;&gt;        * &#123; font-family: &quot;Arial&quot;; font-size:72px; &#125;    &lt;&#x2F;style&gt;  &lt;&#x2F;head&gt;  &lt;body&gt;    &lt;my:time format&#x3D;&quot;yyyy-MM-dd&quot; backColor&#x3D;&quot;blue&quot; foreColor&#x3D;&quot;yellow&quot;&#x2F;&gt;  &lt;&#x2F;body&gt;&lt;&#x2F;html&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p></li></ol><p><strong>注意：</strong>如果要将自定义的标签库发布成 JAR 文件，需要将标签库描述文件（tld 文件）放在 JAR 文件的 META-INF 目录下，可以用 JDK 中的 jar 工具完成 JAR 文件的生成，如果不清楚如何操作，可以请教<a href="https://www.google.com/">谷老师</a>和<a href="https://www.baidu.com/">百老师</a>。</p><blockquote><h3 id="说一下表达式语言（EL）的隐式对象及其作用。"><a href="#说一下表达式语言（EL）的隐式对象及其作用。" class="headerlink" title="说一下表达式语言（EL）的隐式对象及其作用。"></a>说一下表达式语言（EL）的隐式对象及其作用。</h3></blockquote><p>答：EL 的隐式对象包括：pageContext、initParam（访问上下文参数）、param（访问请求参数）、paramValues、header（访问请求头）、headerValues、cookie（访问 cookie）、applicationScope（访问 application 作用域）、sessionScope（访问 session 作用域）、requestScope（访问 request 作用域）、pageScope（访问 page 作用域）。</p><p>用法如下所示：</p><p><pre class="line-numbers language-jsp" data-language="jsp"><code class="language-jsp">$&#123;pageContext.request.method&#125;$&#123;pageContext[&quot;request&quot;][&quot;method&quot;]&#125;$&#123;pageContext.request[&quot;method&quot;]&#125;$&#123;pageContext[&quot;request&quot;].method&#125;$&#123;initParam.defaultEncoding&#125;$&#123;header[&quot;accept-language&quot;]&#125;$&#123;headerValues[&quot;accept-language&quot;][0]&#125;$&#123;cookie.jsessionid.value&#125;$&#123;sessionScope.loginUser.username&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p><strong>补充：</strong>表达式语言的 <code>.</code> 和 <code>[]</code> 运算作用是一致的，唯一的差别在于如果访问的属性名不符合 Java 标识符命名规则，例如上面的 <code>accept-language</code> 就不是一个有效的 Java 标识符，那么这时候就只能用 <code>[]</code> 运算符而不能使用 <code>.</code> 运算符获取它的值。</p><blockquote><h3 id="表达式语言（EL）支持哪些运算符？"><a href="#表达式语言（EL）支持哪些运算符？" class="headerlink" title="表达式语言（EL）支持哪些运算符？"></a>表达式语言（EL）支持哪些运算符？</h3></blockquote><p>答：除了 <code>.</code> 和 <code>[]</code> 运算符，EL 还提供了：</p><ul><li>算术运算符：<code>+</code>、<code>-</code>、<code>*</code>、<code>/</code> 或 <code>div</code>、<code>%</code> 或 <code>mod</code>；</li><li>关系运算符：<code>==</code> 或 <code>eq</code>、<code>!=</code> 或 <code>ne</code>、<code>&gt;</code> 或 <code>gt</code>、<code>&gt;=</code> 或 <code>ge</code>、<code>&lt;</code> 或 <code>lt</code>、<code>&lt;=</code> 或 <code>le</code>；</li><li>逻辑运算符：<code>&amp;&amp;</code> 或 <code>and</code>、<code>||</code> 或 <code>or</code>、<code>!</code> 或 <code>not</code>；</li><li>条件运算符：<code>$&#123;statement? A : B&#125;</code>（跟 Java 的条件运算符类似）；</li><li><code>empty</code> 运算符：检查一个值是否为 <code>null</code> 或者 <code>空</code>（数组长度为 0 或集合中没有元素也返回 <code>true</code>）。</li></ul><blockquote><h3 id="Java-Web-开发的-Model-1-和-Model-2-分别指的是什么？"><a href="#Java-Web-开发的-Model-1-和-Model-2-分别指的是什么？" class="headerlink" title="Java Web 开发的 Model 1 和 Model 2 分别指的是什么？"></a>Java Web 开发的 Model 1 和 Model 2 分别指的是什么？</h3></blockquote><p>答：Model 1 是以页面为中心的 Java Web开发，使用 JSP+JavaBean 技术将页面显示逻辑和业务逻辑处理分开，JSP 实现页面显示，JavaBean 对象用来保存数据和实现业务逻辑。Model 2 是基于 MVC（模型-视图-控制器，Model-View-Controller）架构模式的开发模型，实现了模型和视图的彻底分离，利于团队开发和代码复用，如下图所示。</p><p><img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="/images/post/java_interview/113.png" alt></p><blockquote><h3 id="Servlet-3-中的异步处理指的是什么？"><a href="#Servlet-3-中的异步处理指的是什么？" class="headerlink" title="Servlet 3 中的异步处理指的是什么？"></a>Servlet 3 中的异步处理指的是什么？</h3></blockquote><p>答：在 Servlet 3 中引入了一项新的技术可以让 Servlet 异步处理请求。有人可能会质疑，既然都有多线程了，还需要异步处理请求吗？答案是肯定需要的，因为如果一个任务处理时间相当长，那么 Servlet 或 Filter 会一直占用着请求处理线程直到任务结束，随着并发用户的增加，容器将会遭遇线程超出的风险，这这种情况下很多的请求将会被堆积起来而后续的请求可能会遭遇拒绝服务，直到有资源可以处理请求为止。异步特性可以帮助应用节省容器中的线程，特别适合执行时间长而且用户需要得到结果的任务，如果用户不需要得到结果则直接将一个 Runnable 对象交给 Executor 并立即返回即可。</p><p><strong>补充：</strong>多线程在 Java 诞生初期无疑是一个亮点，而 Servlet 单实例多线程的工作方式也曾为其赢得美名，然而技术的发展往往会颠覆我们很多的认知，就如同当年爱因斯坦的相对论颠覆了牛顿的经典力学一般。事实上，异步处理绝不是 Serlvet 3 首创，如果你了解 Node.js 的话，对 Servlet 3 的这个重要改进就不以为奇了。</p><p>下面是一个支持异步处理请求的 Servlet 的例子。</p><p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span></span><span class="token class-name">AsyncContext</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span></span><span class="token class-name">ServletException</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">WebServlet</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpServlet</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpServletRequest</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpServletResponse</span><span class="token punctuation">;</span><span class="token annotation punctuation">@WebServlet</span><span class="token punctuation">(</span>urlPatterns <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token string">"/async"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> asyncSupported <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AsyncServlet</span> <span class="token keyword">extends</span> <span class="token class-name">HttpServlet</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">long</span> serialVersionUID <span class="token operator">=</span> <span class="token number">1L</span><span class="token punctuation">;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">doGet</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> req<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> resp<span class="token punctuation">)</span>             <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>        <span class="token comment">// 开启Tomcat异步Servlet支持</span>        req<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"org.apache.catalina.ASYNC_SUPPORTED"</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">final</span> <span class="token class-name">AsyncContext</span> ctx <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token function">startAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 启动异步处理的上下文</span>        <span class="token comment">// ctx.setTimeout(30000);</span>        ctx<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Runnable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token annotation punctuation">@Override</span>            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token comment">// 在此处添加异步处理的代码</span>                ctx<span class="token punctuation">.</span><span class="token function">complete</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><blockquote><h3 id="如何在基于-Java-的-Web-项目中实现文件上传和下载？"><a href="#如何在基于-Java-的-Web-项目中实现文件上传和下载？" class="headerlink" title="如何在基于 Java 的 Web 项目中实现文件上传和下载？"></a>如何在基于 Java 的 Web 项目中实现文件上传和下载？</h3></blockquote><p>答：在 Sevlet 3 以前，Servlet API 中没有支持上传功能的 API，因此要实现上传功能需要引入第三方工具从 POST 请求中获得上传的附件或者通过自行处理输入流来获得上传的文件，我们推荐使用 Apache 的 commons-fileupload。</p><p>从 Servlet 3 开始，文件上传变得无比简单，相信看看下面的例子一切都清楚了。</p><p>上传页面index.jsp：</p><p><pre class="line-numbers language-jsp" data-language="jsp"><code class="language-jsp">&lt;%@ page pageEncoding&#x3D;&quot;utf-8&quot;%&gt;&lt;!DOCTYPE html&gt;&lt;html&gt;&lt;head&gt;&lt;meta http-equiv&#x3D;&quot;Content-Type&quot; content&#x3D;&quot;text&#x2F;html; charset&#x3D;UTF-8&quot;&gt;&lt;title&gt;Photo Upload&lt;&#x2F;title&gt;&lt;&#x2F;head&gt;&lt;body&gt;&lt;h1&gt;Select your photo and upload&lt;&#x2F;h1&gt;&lt;hr&#x2F;&gt;&lt;div style&#x3D;&quot;color:red;font-size:14px;&quot;&gt;$&#123;hint&#125;&lt;&#x2F;div&gt;&lt;form action&#x3D;&quot;UploadServlet&quot; method&#x3D;&quot;post&quot; enctype&#x3D;&quot;multipart&#x2F;form-data&quot;&gt;    Photo file: &lt;input type&#x3D;&quot;file&quot; name&#x3D;&quot;photo&quot; &#x2F;&gt;    &lt;input type&#x3D;&quot;submit&quot; value&#x3D;&quot;Upload&quot; &#x2F;&gt;&lt;&#x2F;form&gt;&lt;&#x2F;body&gt;&lt;&#x2F;html&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p>支持上传的 Servlet：</p><p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>jackfrued<span class="token punctuation">.</span>servlet</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span></span><span class="token class-name">ServletException</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">MultipartConfig</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">WebServlet</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpServlet</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpServletRequest</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpServletResponse</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">Part</span><span class="token punctuation">;</span><span class="token annotation punctuation">@WebServlet</span><span class="token punctuation">(</span><span class="token string">"/UploadServlet"</span><span class="token punctuation">)</span><span class="token annotation punctuation">@MultipartConfig</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UploadServlet</span> <span class="token keyword">extends</span> <span class="token class-name">HttpServlet</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">long</span> serialVersionUID <span class="token operator">=</span> <span class="token number">1L</span><span class="token punctuation">;</span>    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">doPost</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span>            <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>        <span class="token comment">// 可以用request.getPart()方法获得名为photo的上传附件</span>        <span class="token comment">// 也可以用request.getParts()获得所有上传附件（多文件上传）</span>        <span class="token comment">// 然后通过循环分别处理每一个上传的文件</span>        <span class="token class-name">Part</span> part <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getPart</span><span class="token punctuation">(</span><span class="token string">"photo"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>part <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> part<span class="token punctuation">.</span><span class="token function">getSubmittedFileName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token comment">// 用ServletContext对象的getRealPath()方法获得上传文件夹的绝对路径</span>            <span class="token class-name">String</span> savePath <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getServletContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getRealPath</span><span class="token punctuation">(</span><span class="token string">"/upload"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">// Servlet 3.1规范中可以用Part对象的getSubmittedFileName()方法获得上传的文件名</span>            <span class="token comment">// 更好的做法是为上传的文件进行重命名（避免同名文件的相互覆盖）</span>            part<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>savePath <span class="token operator">+</span> <span class="token string">"/"</span> <span class="token operator">+</span> part<span class="token punctuation">.</span><span class="token function">getSubmittedFileName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            request<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"hint"</span><span class="token punctuation">,</span> <span class="token string">"Upload Successfully!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>            request<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"hint"</span><span class="token punctuation">,</span> <span class="token string">"Upload failed!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token comment">// 跳转回到上传页面</span>        request<span class="token punctuation">.</span><span class="token function">getRequestDispatcher</span><span class="token punctuation">(</span><span class="token string">"index.jsp"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forward</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><blockquote><h3 id="服务器收到用户提交的表单数据，到底是调用-Servlet-的-doGet-还是-doPost-方法？"><a href="#服务器收到用户提交的表单数据，到底是调用-Servlet-的-doGet-还是-doPost-方法？" class="headerlink" title="服务器收到用户提交的表单数据，到底是调用 Servlet 的 doGet() 还是 doPost() 方法？"></a>服务器收到用户提交的表单数据，到底是调用 Servlet 的 <code>doGet()</code> 还是 <code>doPost()</code> 方法？</h3></blockquote><p>答：HTML 的 <code>&lt;form&gt;</code> 元素有一个 <code>method</code> 属性，用来指定提交表单的方式，其值可以是 <code>get</code> 或 <code>post</code>。我们自定义的 Servlet 一般情况下会重写 <code>doGet()</code> 或 <code>doPost()</code> 两个方法之一或全部，如果是 <code>GET</code> 请求就调用 <code>doGet()</code> 方法，如果是 <code>POST</code> 请求就调用 <code>doPost()</code> 方法，那为什么为什么这样呢？我们自定义的 Servlet 通常继承自 <code>HttpServlet</code>，<code>HttpServlet</code> 继承自 <code>GenericServlet</code> 并重写了其中的 <code>service()</code> 方法，这个方法是 Servlet 接口中定义的。<code>HttpServlet</code> 重写的 <code>service()</code> 方法会先获取用户请求的方法，然后根据请求方法调用 <code>doGet()</code>、<code>doPost()</code>、<code>doPut()</code>、<code>doDelete()</code> 等方法，如果在自定义 Servlet 中重写了这些方法，那么显然会调用重写过的（自定义的）方法，这显然是对模板方法模式的应用（如果不理解，请参考阎宏博士的《Java与模式》一书的第 37 章）。当然，自定义 Servlet 中也可以直接重写 <code>service()</code> 方法，那么不管是哪种方式的请求，都可以通过自己的代码进行处理，这对于不区分请求方法的场景比较合适。</p><blockquote><h3 id="JSP-中的静态包含和动态包含有什么区别？"><a href="#JSP-中的静态包含和动态包含有什么区别？" class="headerlink" title="JSP 中的静态包含和动态包含有什么区别？"></a>JSP 中的静态包含和动态包含有什么区别？</h3></blockquote><p>答：静态包含是通过 JSP 的 <code>include</code> 指令包含页面，动态包含是通过 JSP 标准动作 <code>&lt;jsp:forward&gt;</code> 包含页面。</p><ul><li><p>静态包含是编译时包含，如果包含的页面不存在则会产生编译错误，而且两个页面的 <code>contentType</code> 属性应保持一致，因为两个页面会合二为一，只产生一个 class 文件，因此被包含页面发生的变动再包含它的页面更新前不会得到更新。</p></li><li><p>动态包含是运行时包含，可以向被包含的页面传递参数，包含页面和被包含页面是独立的，会编译出两个 class 文件，如果被包含的页面不存在，不会产生编译错误，也不影响页面其他部分的执行。代码如下所示：</p></li></ul><p><pre class="line-numbers language-jsp" data-language="jsp"><code class="language-jsp">&lt;%-- 静态包含 --%&gt;&lt;%@ include file&#x3D;&quot;...&quot; %&gt;&lt;%-- 动态包含 --%&gt;&lt;jsp:include page&#x3D;&quot;...&quot;&gt;    &lt;jsp:param name&#x3D;&quot;...&quot; value&#x3D;&quot;...&quot; &#x2F;&gt;&lt;&#x2F;jsp:include&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><blockquote><h3 id="Servlet-中如何获取用户提交的查询参数或表单数据？"><a href="#Servlet-中如何获取用户提交的查询参数或表单数据？" class="headerlink" title="Servlet 中如何获取用户提交的查询参数或表单数据？"></a>Servlet 中如何获取用户提交的查询参数或表单数据？</h3></blockquote><p>答：可以通过请求对象 <code>HttpServletRequest</code> 的 <code>getParameter()</code> 方法通过参数名获得参数值。如果有包含多个值的参数（例如复选框），可以通过请求对象的 <code>getParameterValues()</code> 方法获得。当然也可以通过请求对象的 <code>getParameterMap()</code> 获得一个参数名和参数值的映射（Map）。</p><blockquote><h3 id="Servlet-中如何获取用户配置的初始化参数以及服务器上下文参数？"><a href="#Servlet-中如何获取用户配置的初始化参数以及服务器上下文参数？" class="headerlink" title="Servlet 中如何获取用户配置的初始化参数以及服务器上下文参数？"></a>Servlet 中如何获取用户配置的初始化参数以及服务器上下文参数？</h3></blockquote><p>答：可以通过重写 Servlet 接口的 <code>init(ServletConfig)</code> 方法并通过 <code>ServletConfig</code> 对象的 <code>getInitParameter()</code> 方法来获取 Servlet 的初始化参数。可以通过 <code>ServletConfig</code> 对象的 <code>getServletContext()</code> 方法获取 <code>ServletContext</code> 对象，并通过该对象的 <code>getInitParameter()</code> 方法来获取服务器上下文参数。当然，<code>ServletContext</code> 对象也在处理用户请求的方法（如 <code>doGet()</code> 方法）中通过请求对象的 <code>getServletContext()</code>方法来获得。</p><blockquote><h3 id="如何设置请求的编码以及响应内容的类型？"><a href="#如何设置请求的编码以及响应内容的类型？" class="headerlink" title="如何设置请求的编码以及响应内容的类型？"></a>如何设置请求的编码以及响应内容的类型？</h3></blockquote><p>答：通过请求对象 <code>ServletRequest</code> 的 <code>setCharacterEncoding(String)</code> 方法可以设置请求的编码，其实要彻底解决乱码问题就应该让页面、服务器、请求和响应、Java 程序都使用统一的编码，最好的选择当然是 <code>UTF-8</code>；通过响应对象 <code>ServletResponse</code> 的 <code>setContentType(String)</code> 方法可以设置响应内容的类型，当然也可以通过 <code>HttpServletResponsed</code> 对象的 <code>setHeader(String, String)</code> 方法来设置。</p><p><strong>说明：</strong>现在如果还有公司在面试的时候问 JSP 的声明标记、表达式标记、小脚本标记这些内容的话，这样的公司也不用去了，其实 JSP 内置对象、JSP 指令这些东西基本上都可以忘却了，关于 Java Web 开发的相关知识，可以看一下我的 <a target="_blank" rel="noopener" href="/images/post/java_interview/servlet_jsp.png" one-link-mark="yes">Servlet&amp;JSP 思维导图</a>，上面有完整的知识点的罗列。</p><blockquote><h3 id="解释一下网络应用的模式及其特点。"><a href="#解释一下网络应用的模式及其特点。" class="headerlink" title="解释一下网络应用的模式及其特点。"></a>解释一下网络应用的模式及其特点。</h3></blockquote><p>答：典型的网络应用模式大致有三类：B/S、C/S、P2P。其中 B 代表浏览器（Browser）、C 代表客户端（Client）、S 代表服务器（Server），P2P 是对等模式，不区分客户端和服务器。B/S 应用模式中可以视为特殊的 C/S 应用模式，只是将 C/S 应用模式中的特殊的客户端换成了浏览器，因为几乎所有的系统上都有浏览器，那么只要打开浏览器就可以使用应用，没有安装、配置、升级客户端所带来的各种开销。P2P 应用模式中，成千上万台彼此连接的计算机都处于对等的地位，整个网络一般来说不依赖专用的集中服务器。网络中的每一台计算机既能充当网络服务的请求者，又对其它计算机的请求作出响应，提供资源和服务。通常这些资源和服务包括：信息的共享和交换、计算资源（如 CPU 的共享）、存储共享（如缓存和磁盘空间的使用）等，这种应用模式最大的阻力安全性、版本等问题，目前有很多应用都混合使用了多种应用模型，最常见的网络视频应用，它几乎把三种模式都用上了。</p><p><strong>补充：</strong>此题要跟“电子商务模式”区分开，因为有很多人被问到这个问题的时候马上想到的是 B2B（如阿里巴巴）、B2C（如当当、亚马逊、京东）、C2C（如淘宝、拍拍）、C2B（如威客）、O2O（如美团、饿了么）。对于这类问题，可以去百度上面科普一下。</p><blockquote><h3 id="什么是-Web-Service（Web-服务）？"><a href="#什么是-Web-Service（Web-服务）？" class="headerlink" title="什么是 Web Service（Web 服务）？"></a>什么是 Web Service（Web 服务）？</h3></blockquote><p>答：从表面上看，Web Service 就是一个应用程序，它向外界暴露出一个能够通过 Web 进行调用的 API。这就是说，你能够用编程的方法透明的调用这个应用程序，不需要了解它的任何细节，跟你使用的编程语言也没有关系。例如可以创建一个提供天气预报的 Web Service，那么无论你用哪种编程语言开发的应用都可以通过调用它的 API 并传入城市信息来获得该城市的天气预报。之所以称之为 Web Service，是因为它基于 HTTP 协议传输数据，这使得运行在不同机器上的不同应用无须借助附加的、专门的第三方软件或硬件，就可相互交换数据或集成。</p><p><strong>补充：</strong>这里必须要提及的一个概念是 SOA（Service-Oriented Architecture，面向服务的架构），SOA 是一种思想，它将应用程序的不同功能单元通过中立的契约联系起来，独立于硬件平台、操作系统和编程语言，使得各种形式的功能单元能够更好的集成。显然，Web Service 是 SOA 的一种较好的解决方案，它更多的是一种标准，而不是一种具体的技术。</p><blockquote><h3 id="概念解释：SOAP、WSDL、UDDI。"><a href="#概念解释：SOAP、WSDL、UDDI。" class="headerlink" title="概念解释：SOAP、WSDL、UDDI。"></a>概念解释：SOAP、WSDL、UDDI。</h3></blockquote><p>答：</p><ul><li>SOAP：简单对象访问协议（Simple Object Access Protocol），是 Web Service 中交换数据的一种协议规范。</li><li>WSDL：Web 服务描述语言（Web Service Description Language），它描述了 Web 服务的公共接口。这是一个基于 XML 的关于如何与 Web 服务通讯和使用的服务描述；也就是描述与目录中列出的 Web 服务进行交互时需要绑定的协议和信息格式。通常采用抽象语言描述该服务支持的操作和信息，使用的时候再将实际的网络协议和信息格式绑定给该服务。</li><li>UDDI：统一描述、发现和集成（Universal Description, Discovery and Integration），它是一个基于 XML 的跨平台的描述规范，可以使世界范围内的企业在互联网上发布自己所提供的服务。简单的说，UDDI 是访问各种 WSDL 的一个门面（可以参考设计模式中的门面模式）。</li></ul><blockquote><h3 id="Java-规范中和-Web-Service-相关的规范有哪些？"><a href="#Java-规范中和-Web-Service-相关的规范有哪些？" class="headerlink" title="Java 规范中和 Web Service 相关的规范有哪些？"></a>Java 规范中和 Web Service 相关的规范有哪些？</h3></blockquote><p>答：Java 规范中和 Web Service 相关的有三个：</p><ul><li>JAX-WS(JSR 224)：这个规范是早期的基于 SOAP 的 Web Service 规范 JAX-RPC 的替代版本，它并不提供向下兼容性，因为 RPC 样式的 WSDL 以及相关的 API 已经在 Java EE5 中被移除了。WS-MetaData 是 JAX-WS 的依赖规范，提供了基于注解配置 Web Service 和 SOAP 消息的相关 API。</li><li>JAXM(JSR 67)：定义了发送和接收消息所需的 API，相当于 Web Service 的服务器端。</li><li>JAX-RS(JSR 311 &amp; JSR 339 &amp; JSR 370)：是 Java 针对 REST（Representation State Transfer）架构风格制定的一套 Web Service 规范。REST 是一种软件架构模式，是一种风格，它不像 SOAP 那样本身承载着一种消息协议， (两种风格的 Web Service 均采用了 HTTP 做传输协议，因为 HTTP 协议能穿越防火墙，Java 的远程方法调用（RMI）等是重量级协议，通常不能穿越防火墙），因此可以将 REST 视为基于 HTTP 协议的软件架构。REST 中最重要的两个概念是资源定位和资源操作，而 HTTP 协议恰好完整的提供了这两个点。HTTP 协议中的 URI 可以完成资源定位，而 GET、POST、OPTION、DELETE 方法可以完成资源操作。因此 REST 完全依赖 HTTP 协议就可以完成 Web Service，而不像 SOAP 协议那样只利用了 HTTP 的传输特性，定位和操作都是由 SOAP 协议自身完成的，也正是由于 SOAP 消息的存在使得基于 SOAP 的 Web Service 显得笨重而逐渐被淘汰。</li></ul><blockquote><h3 id="介绍一下你了解的-Java-领域的-Web-Service-框架。"><a href="#介绍一下你了解的-Java-领域的-Web-Service-框架。" class="headerlink" title="介绍一下你了解的 Java 领域的 Web Service 框架。"></a>介绍一下你了解的 Java 领域的 Web Service 框架。</h3></blockquote><p>答：Java 领域的 Web Service 框架很多，包括 Axis2（Axis 的升级版本）、Jersey（RESTful 的 Web Service 框架）、CXF（XFire 的延续版本）、Hessian、Turmeric、JBoss SOA 等，其中绝大多数都是开源框架。</p><p><strong>注意：</strong>面试被问到这类问题的时候一定选择自己用过的最熟悉的作答，如果之前没有了解过就应该在面试前花一些时间了解其中的两个，并比较其优缺点，这样才能在面试时给出一个漂亮的答案。</p>]]></content>
      
      
      <categories>
          
          <category> 教程笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 面试题 </tag>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Java 面试题解析（设计模式）</title>
      <link href="post/1cfbd3b3.html"/>
      <url>post/1cfbd3b3.html</url>
      
        <content type="html"><![CDATA[<blockquote><h3 id="简述一下面向对象的-quot-六原则一法则-quot-。"><a href="#简述一下面向对象的-quot-六原则一法则-quot-。" class="headerlink" title="简述一下面向对象的&quot;六原则一法则&quot;。"></a>简述一下面向对象的&quot;六原则一法则&quot;。</h3></blockquote><p>答：</p><ul><li><p><strong>单一职责原则：一个类只做它该做的事情。</strong>（单一职责原则想表达的就是&quot;高内聚&quot;，写代码最终极的原则只有六个字“高内聚、低耦合”，就如同葵花宝典或辟邪剑谱的中心思想就八个字“欲练此功必先自宫”，所谓的高内聚就是一个代码模块只完成一项功能，在面向对象中，如果只让一个类完成它该做的事，而不涉及与它无关的领域就是践行了高内聚的原则，这个类就只有单一职责。我们都知道一句话叫“因为专注，所以专业”，一个对象如果承担太多的职责，那么注定它什么都做不好。这个世界上任何好的东西都有两个特征，一个是功能单一，好的相机绝对不是电视购物里面卖的那种一个机器有一百多种功能的，它基本上只能照相；另一个是模块化，好的自行车是组装车，从减震叉、刹车到变速器，所有的部件都是可以拆卸和重新组装的，好的乒乓球拍也不是成品拍，一定是底板和胶皮可以拆分和自行组装的，一个好的软件系统，它里面的每个功能模块也应该是可以轻易的拿到其他系统中使用的，这样才能实现软件复用的目标。）</p></li><li><p><strong>开闭原则：软件实体应当对扩展开放，对修改关闭。</strong>（在理想的状态下，当我们需要为一个软件系统增加新功能时，只需要从原来的系统派生出一些新类就可以，不需要修改原来的任何一行代码。要做到开闭有两个要点：(1)抽象是关键，一个系统中如果没有抽象类或接口系统就没有扩展点；(2)封装可变性，将系统中的各种可变因素封装到一个继承结构中，如果多个可变因素混杂在一起，系统将变得复杂而换乱，如果不清楚如何封装可变性，可以参考《设计模式精解》一书中对桥梁模式的讲解的章节。）</p></li><li><p><strong>依赖倒转原则：面向接口编程。</strong>（该原则说得直白和具体一些就是声明方法的参数类型、方法的返回类型、变量的引用类型时，尽可能使用抽象类型而不用具体类型，因为抽象类型可以被它的任何一个子类型所替代，请参考下面的里氏替换原则。）<strong>里氏替换原则：任何时候都可以用子类型替换掉父类型。</strong>（关于里氏替换原则的描述，Barbara Liskov 女士的描述比这个要复杂得多，但简单的说就是能用父类型的地方就一定能使用子类型。里氏替换原则可以检查继承关系是否合理，如果一个继承关系违背了里氏替换原则，那么这个继承关系一定是错误的，需要对代码进行重构。例如让猫继承狗，或者狗继承猫，又或者让正方形继承长方形都是错误的继承关系，因为你很容易找到违反里氏替换原则的场景。需要注意的是：子类一定是增加父类的能力而不是减少父类的能力，因为子类比父类的能力更多，把能力多的对象当成能力少的对象来用当然没有任何问题。）</p></li><li><p><strong>接口隔离原则：接口要小而专，绝不能大而全。</strong>（臃肿的接口是对接口的污染，既然接口表示能力，那么一个接口只应该描述一种能力，接口也应该是高度内聚的。例如，琴棋书画就应该分别设计为四个接口，而不应设计成一个接口中的四个方法，因为如果设计成一个接口中的四个方法，那么这个接口很难用，毕竟琴棋书画四样都精通的人还是少数，而如果设计成四个接口，会几项就实现几个接口，这样的话每个接口被复用的可能性是很高的。Java中的接口代表能力、代表约定、代表角色，能否正确的使用接口一定是编程水平高低的重要标识。）</p></li><li><p><strong>合成聚合复用原则：优先使用聚合或合成关系复用代码。</strong>（通过继承来复用代码是面向对象程序设计中被滥用得最多的东西，因为所有的教科书都无一例外的对继承进行了鼓吹从而误导了初学者，类与类之间简单的说有三种关系，Is-A 关系、Has-A 关系、Use-A 关系，分别代表继承、关联和依赖。其中，关联关系根据其关联的强度又可以进一步划分为关联、聚合和合成，但说白了都是 Has-A关 系，合成聚合复用原则想表达的是优先考虑 Has-A 关系而不是 Is-A 关系复用代码，原因嘛可以自己从百度上找到一万个理由，需要说明的是，即使在 Java 的 API 中也有不少滥用继承的例子，例如 Properties 类继承了 Hashtable 类，Stack 类继承了 Vector 类，这些继承明显就是错误的，更好的做法是在 Properties 类中放置一个 Hashtable 类型的成员并且将其键和值都设置为字符串来存储数据，而 Stack 类的设计也应该是在 Stack 类中放一个 Vector 对象来存储数据。记住：任何时候都不要继承工具类，工具是可以拥有并可以使用的，而不是拿来继承的。）</p></li><li><p><strong>迪米特法则：迪米特法则又叫最少知识原则，一个对象应当对其他对象有尽可能少的了解。</strong>（迪米特法则简单的说就是如何做到“低耦合”，门面模式和调停者模式就是对迪米特法则的践行。对于门面模式可以举一个简单的例子，你去一家公司洽谈业务，你不需要了解这个公司内部是如何运作的，你甚至可以对这个公司一无所知，去的时候只需要找到公司入口处的前台美女，告诉她们你要做什么，她们会找到合适的人跟你接洽，前台的美女就是公司这个系统的门面。再复杂的系统都可以为用户提供一个简单的门面，Java Web 开发中作为前端控制器的 Servlet 或 Filter 不就是一个门面吗，浏览器对服务器的运作方式一无所知，但是通过前端控制器就能够根据你的请求得到相应的服务。调停者模式也可以举一个简单的例子来说明，例如一台计算机，CPU、内存、硬盘、显卡、声卡各种设备需要相互配合才能很好的工作，但是如果这些东西都直接连接到一起，计算机的布线将异常复杂，在这种情况下，主板作为一个调停者的身份出现，它将各个设备连接在一起而不需要每个设备之间直接交换数据，这样就减小了系统的耦合度和复杂度，如下图所示。迪米特法则用通俗的话来将就是不要和陌生人打交道，如果真的需要，找一个自己的朋友，让他替你和陌生人打交道。）</p></li></ul><p><img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="/images/post/java_interview/89_1.png" alt></p><p><img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="/images/post/java_interview/89_2.png" alt></p><blockquote><h3 id="简述一下你了解的设计模式。"><a href="#简述一下你了解的设计模式。" class="headerlink" title="简述一下你了解的设计模式。"></a>简述一下你了解的设计模式。</h3></blockquote><p>答：所谓设计模式，就是一套被反复使用的代码设计经验的总结（情境中一个问题经过证实的一个解决方案）。使用设计模式是为了可重用代码、让代码更容易被他人理解、保证代码可靠性。设计模式使人们可以更加简单方便的复用成功的设计和体系结构。将已证实的技术表述成设计模式也会使新系统开发者更加容易理解其设计思路。</p><p>在 GoF 的《Design Patterns: Elements of Reusable Object-Oriented Software》中给出了三类（<strong>创建型</strong>[对类的实例化过程的抽象化]、<strong>结构型</strong>[描述如何将类或对象结合在一起形成更大的结构]、<strong>行为型</strong>[对在不同的对象之间划分责任和算法的抽象化]）共 23 种设计模式，包括：Abstract Factory（抽象工厂模式），Builder（建造者模式），Factory Method（工厂方法模式），Prototype（原始模型模式），Singleton（单例模式）；Facade（门面模式），Adapter（适配器模式），Bridge（桥梁模式），Composite（合成模式），Decorator（装饰模式），Flyweight（享元模式），Proxy（代理模式）；Command（命令模式），Interpreter（解释器模式），Visitor（访问者模式），Iterator（迭代子模式），Mediator（调停者模式），Memento（备忘录模式），Observer（观察者模式），State（状态模式），Strategy（策略模式），Template Method（模板方法模式），Chain Of Responsibility（责任链模式）。</p><p>面试被问到关于设计模式的知识时，可以拣最常用的作答，例如：</p><ul><li>工厂模式：工厂类可以根据条件生成不同的子类实例，这些子类有一个公共的抽象父类并且实现了相同的方法，但是这些方法针对不同的数据进行了不同的操作（多态方法）。当得到子类的实例后，开发人员可以调用基类中的方法而不必考虑到底返回的是哪一个子类的实例。</li><li>代理模式：给一个对象提供一个代理对象，并由代理对象控制原对象的引用。实际开发中，按照使用目的的不同，代理可以分为：远程代理、虚拟代理、保护代理、Cache 代理、防火墙代理、同步化代理、智能引用代理。</li><li>适配器模式：把一个类的接口变换成客户端所期待的另一种接口，从而使原本因接口不匹配而无法在一起使用的类能够一起工作。</li><li>模板方法模式：提供一个抽象类，将部分逻辑以具体方法或构造器的形式实现，然后声明一些抽象方法来迫使子类实现剩余的逻辑。不同的子类可以以不同的方式实现这些抽象方法（多态实现），从而实现不同的业务逻辑。</li></ul><p>除此之外，还可以讲讲上面提到的门面模式、桥梁模式、单例模式、装潢模式（Collections 工具类和 I/O 系统中都使用装潢模式）等，反正基本原则就是拣自己最熟悉的、用得最多的作答，以免言多必失。</p><blockquote><h3 id="用Java写一个单例类。"><a href="#用Java写一个单例类。" class="headerlink" title="用Java写一个单例类。"></a>用Java写一个单例类。</h3></blockquote><p>答：</p><ul><li><p>饿汉式单例</p><p>  <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Singleton</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token class-name">Singleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">Singleton</span> instance <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Singleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Singleton</span> <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> instance<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p></li><li><p>懒汉式单例</p><p>  <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Singleton</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">Singleton</span> instance <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">Singleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">synchronized</span> <span class="token class-name">Singleton</span> <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>instance <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> instance ＝ <span class="token keyword">new</span> <span class="token class-name">Singleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> instance<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p></li></ul><p><strong>注意：</strong>实现一个单例有两点注意事项，(1)将构造器私有，不允许外界通过构造器创建对象；(2)通过公开的静态方法向外界返回类的唯一实例。这里有一个问题可以思考：Spring 的 IoC 容器可以为普通的类创建单例，它是怎么做到的呢？</p><blockquote><h3 id="什么是-UML？"><a href="#什么是-UML？" class="headerlink" title="什么是 UML？"></a>什么是 UML？</h3></blockquote><p>答：UML 是统一建模语言（Unified Modeling Language）的缩写，它发表于 1997 年，综合了当时已经存在的面向对象的建模语言、方法和过程，是一个支持模型化和软件系统开发的图形化语言，为软件开发的所有阶段提供模型化和可视化支持。使用UML可以帮助沟通与交流，辅助应用设计和文档的生成，还能够阐释系统的结构和行为。</p><blockquote><h3 id="UML-中有哪些常用的图？"><a href="#UML-中有哪些常用的图？" class="headerlink" title="UML 中有哪些常用的图？"></a>UML 中有哪些常用的图？</h3></blockquote><p>答：UML 定义了多种图形化的符号来描述软件系统部分或全部的静态结构和动态结构，包括：用例图（use case diagram）、类图（class diagram）、时序图（sequence diagram）、协作图（collaboration diagram）、状态图（statechart diagram）、活动图（activity diagram）、构件图（component diagram）、部署图（deployment diagram）等。在这些图形化符号中，有三种图最为重要，分别是：用例图（用来捕获需求，描述系统的功能，通过该图可以迅速的了解系统的功能模块及其关系）、类图（描述类以及类与类之间的关系，通过该图可以快速了解系统）、时序图（描述执行特定任务时对象之间的交互关系以及执行顺序，通过该图可以了解对象能接收的消息也就是说对象能够向外界提供的服务）。</p><ul><li>用例图：</li></ul><p><img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="/images/post/java_interview/93_1.png" alt></p><ul><li>类图：</li></ul><p><img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="/images/post/java_interview/93_2.png" alt></p><ul><li>时序图：</li></ul><p><img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="/images/post/java_interview/93_3.png" alt></p><blockquote><h3 id="用-Java-写一个冒泡排序。"><a href="#用-Java-写一个冒泡排序。" class="headerlink" title="用 Java 写一个冒泡排序。"></a>用 Java 写一个冒泡排序。</h3></blockquote><p>答：冒泡排序几乎是个程序员都写得出来，但是面试的时候如何写一个逼格高的冒泡排序却不是每个人都能做到，下面提供一个参考代码：</p><p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Comparator</span><span class="token punctuation">;</span><span class="token comment">/** * 排序器接口(策略模式: 将算法封装到具有共同接口的独立的类中使得它们可以相互替换) */</span><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Sorter</span> <span class="token punctuation">&#123;</span>   <span class="token comment">/**    * 排序    * @param list 待排序的数组    */</span>   <span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span> <span class="token keyword">extends</span> <span class="token class-name">Comparable</span><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">></span><span class="token punctuation">></span></span> <span class="token keyword">void</span> <span class="token function">sort</span><span class="token punctuation">(</span><span class="token class-name">T</span><span class="token punctuation">[</span><span class="token punctuation">]</span> list<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">/**    * 排序    * @param list 待排序的数组    * @param comp 比较两个对象的比较器    */</span>   <span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">></span></span> <span class="token keyword">void</span> <span class="token function">sort</span><span class="token punctuation">(</span><span class="token class-name">T</span><span class="token punctuation">[</span><span class="token punctuation">]</span> list<span class="token punctuation">,</span> <span class="token class-name">Comparator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">></span></span> comp<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Comparator</span><span class="token punctuation">;</span><span class="token comment">/** * 冒泡排序 */</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BubbleSorter</span> <span class="token keyword">implements</span> <span class="token class-name">Sorter</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span> <span class="token keyword">extends</span> <span class="token class-name">Comparable</span><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">></span><span class="token punctuation">></span></span> <span class="token keyword">void</span> <span class="token function">sort</span><span class="token punctuation">(</span><span class="token class-name">T</span><span class="token punctuation">[</span><span class="token punctuation">]</span> list<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">boolean</span> swapped <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> len <span class="token operator">=</span> list<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> len <span class="token operator">&amp;&amp;</span> swapped<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            swapped <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> len <span class="token operator">-</span> i<span class="token punctuation">;</span> <span class="token operator">++</span>j<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>list<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">compareTo</span><span class="token punctuation">(</span>list<span class="token punctuation">[</span>j <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    <span class="token class-name">T</span> temp <span class="token operator">=</span> list<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span>                    list<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> list<span class="token punctuation">[</span>j <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>                    list<span class="token punctuation">[</span>j <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> temp<span class="token punctuation">;</span>                    swapped <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">></span></span> <span class="token keyword">void</span> <span class="token function">sort</span><span class="token punctuation">(</span><span class="token class-name">T</span><span class="token punctuation">[</span><span class="token punctuation">]</span> list<span class="token punctuation">,</span> <span class="token class-name">Comparator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">></span></span> comp<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">boolean</span> swapped <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> len <span class="token operator">=</span> list<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> len <span class="token operator">&amp;&amp;</span> swapped<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            swapped <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> len <span class="token operator">-</span> i<span class="token punctuation">;</span> <span class="token operator">++</span>j<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>comp<span class="token punctuation">.</span><span class="token function">compare</span><span class="token punctuation">(</span>list<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">,</span> list<span class="token punctuation">[</span>j <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    <span class="token class-name">T</span> temp <span class="token operator">=</span> list<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span>                    list<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> list<span class="token punctuation">[</span>j <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>                    list<span class="token punctuation">[</span>j <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> temp<span class="token punctuation">;</span>                    swapped <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><blockquote><h3 id="用-Java-写一个折半查找。"><a href="#用-Java-写一个折半查找。" class="headerlink" title="用 Java 写一个折半查找。"></a>用 Java 写一个折半查找。</h3></blockquote><p>答：折半查找，也称二分查找、二分搜索，是一种在有序数组中查找某一特定元素的搜索算法。搜素过程从数组的中间元素开始，如果中间元素正好是要查找的元素，则搜素过程结束；如果某一特定元素大于或者小于中间元素，则在数组大于或小于中间元素的那一半中查找，而且跟开始一样从中间元素开始比较。如果在某一步骤数组已经为空，则表示找不到指定的元素。这种搜索算法每一次比较都使搜索范围缩小一半，其时间复杂度是 O(logN)。</p><p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Comparator</span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyUtil</span> <span class="token punctuation">&#123;</span>   <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span> <span class="token keyword">extends</span> <span class="token class-name">Comparable</span><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">></span><span class="token punctuation">></span></span> <span class="token keyword">int</span> <span class="token function">binarySearch</span><span class="token punctuation">(</span><span class="token class-name">T</span><span class="token punctuation">[</span><span class="token punctuation">]</span> x<span class="token punctuation">,</span> <span class="token class-name">T</span> key<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token keyword">return</span> <span class="token function">binarySearch</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> x<span class="token punctuation">.</span>length<span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token punctuation">&#125;</span>   <span class="token comment">// 使用循环实现的二分查找</span>   <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">></span></span> <span class="token keyword">int</span> <span class="token function">binarySearch</span><span class="token punctuation">(</span><span class="token class-name">T</span><span class="token punctuation">[</span><span class="token punctuation">]</span> x<span class="token punctuation">,</span> <span class="token class-name">T</span> key<span class="token punctuation">,</span> <span class="token class-name">Comparator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">></span></span> comp<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token keyword">int</span> low <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>      <span class="token keyword">int</span> high <span class="token operator">=</span> x<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>      <span class="token keyword">while</span> <span class="token punctuation">(</span>low <span class="token operator">&lt;=</span> high<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>          <span class="token keyword">int</span> mid <span class="token operator">=</span> <span class="token punctuation">(</span>low <span class="token operator">+</span> high<span class="token punctuation">)</span> <span class="token operator">>>></span> <span class="token number">1</span><span class="token punctuation">;</span>          <span class="token keyword">int</span> cmp <span class="token operator">=</span> comp<span class="token punctuation">.</span><span class="token function">compare</span><span class="token punctuation">(</span>x<span class="token punctuation">[</span>mid<span class="token punctuation">]</span><span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token keyword">if</span> <span class="token punctuation">(</span>cmp <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            low<span class="token operator">=</span> mid <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>          <span class="token punctuation">&#125;</span>          <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>cmp <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            high<span class="token operator">=</span> mid <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>          <span class="token punctuation">&#125;</span>          <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> mid<span class="token punctuation">;</span>          <span class="token punctuation">&#125;</span>      <span class="token punctuation">&#125;</span>      <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>   <span class="token punctuation">&#125;</span>   <span class="token comment">// 使用递归实现的二分查找</span>   <span class="token keyword">private</span> <span class="token keyword">static</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span> <span class="token keyword">extends</span> <span class="token class-name">Comparable</span><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">></span><span class="token punctuation">></span></span> <span class="token keyword">int</span> <span class="token function">binarySearch</span><span class="token punctuation">(</span><span class="token class-name">T</span><span class="token punctuation">[</span><span class="token punctuation">]</span> x<span class="token punctuation">,</span> <span class="token keyword">int</span> low<span class="token punctuation">,</span> <span class="token keyword">int</span> high<span class="token punctuation">,</span> <span class="token class-name">T</span> key<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token keyword">if</span><span class="token punctuation">(</span>low <span class="token operator">&lt;=</span> high<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">int</span> mid <span class="token operator">=</span> low <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>high <span class="token operator">-</span>low<span class="token punctuation">)</span> <span class="token operator">>></span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>key<span class="token punctuation">.</span><span class="token function">compareTo</span><span class="token punctuation">(</span>x<span class="token punctuation">[</span>mid<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>           <span class="token keyword">return</span> mid<span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>key<span class="token punctuation">.</span><span class="token function">compareTo</span><span class="token punctuation">(</span>x<span class="token punctuation">[</span>mid<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>           <span class="token keyword">return</span> <span class="token function">binarySearch</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span>low<span class="token punctuation">,</span> mid <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>           <span class="token keyword">return</span> <span class="token function">binarySearch</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span>mid <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> high<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>      <span class="token punctuation">&#125;</span>      <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>   <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p><strong>说明：</strong>上面的代码中给出了折半查找的两个版本，一个用递归实现，一个用循环实现。需要注意的是计算中间位置时不应该使用(high+ low) / 2的方式，因为加法运算可能导致整数越界，这里应该使用以下三种方式之一：low + (high - low) / 2或low + (high – low) &gt;&gt; 1或(low + high) &gt;&gt;&gt; 1（&gt;&gt;&gt;是逻辑右移，是不带符号位的右移）</p>]]></content>
      
      
      <categories>
          
          <category> 教程笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 面试题 </tag>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Java 面试题解析（反射）</title>
      <link href="post/9fbf7373.html"/>
      <url>post/9fbf7373.html</url>
      
        <content type="html"><![CDATA[<blockquote><h3 id="获得一个类的类对象有哪些方式？"><a href="#获得一个类的类对象有哪些方式？" class="headerlink" title="获得一个类的类对象有哪些方式？"></a>获得一个类的类对象有哪些方式？</h3></blockquote><p>答：</p><ul><li>类型.class，例如：<code>String.class</code></li><li>对象.getClass()，例如：<code>&quot;hello&quot;.getClass()</code></li><li>Class.forName()，例如：<code>Class.forName(&quot;java.lang.String&quot;)</code></li></ul><blockquote><h3 id="如何通过反射创建对象？"><a href="#如何通过反射创建对象？" class="headerlink" title="如何通过反射创建对象？"></a>如何通过反射创建对象？</h3></blockquote><p>答：</p><ul><li>通过类对象调用 <code>newInstance()</code> 方法，例如：<code>String.class.newInstance()</code></li><li>通过类对象的 <code>getConstructor()</code> 或 <code>getDeclaredConstructor()</code> 方法获得构造器（Constructor）对象并调用其 <code>newInstance()</code> 方法创建对象，例如：<code>String.class.getConstructor(String.class).newInstance(&quot;Hello&quot;);</code></li></ul><blockquote><h3 id="如何通过反射获取和设置对象私有字段的值？"><a href="#如何通过反射获取和设置对象私有字段的值？" class="headerlink" title="如何通过反射获取和设置对象私有字段的值？"></a>如何通过反射获取和设置对象私有字段的值？</h3></blockquote><p>答：可以通过类对象的 <code>getDeclaredField()</code> 方法字段（Field）对象，然后再通过字段对象的 <code>setAccessible(true)</code> 将其设置为可以访问，接下来就可以通过 get/set 方法来获取/设置字段的值了。下面的代码实现了一个反射的工具类，其中的两个静态方法分别用于获取和设置私有字段的值，字段可以是基本类型也可以是对象类型且支持多级对象操作，例如 <code>ReflectionUtil.get(dog, &quot;owner.car.engine.id&quot;);</code> 可以获得 dog 对象的主人的汽车的引擎的 ID 号。</p><p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span><span class="token class-name">Constructor</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span><span class="token class-name">Field</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span><span class="token class-name">Modifier</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">ArrayList</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span><span class="token punctuation">;</span><span class="token comment">/** * 反射工具类 */</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ReflectionUtil</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token class-name">ReflectionUtil</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">AssertionError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">/**     * 通过反射取对象指定字段(属性)的值     * @param target 目标对象     * @param fieldName 字段的名字     * @throws 如果取不到对象指定字段的值则抛出异常     * @return 字段的值     */</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Object</span> <span class="token function">getValue</span><span class="token punctuation">(</span><span class="token class-name">Object</span> target<span class="token punctuation">,</span> <span class="token class-name">String</span> fieldName<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">></span></span> clazz <span class="token operator">=</span> target<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> fs <span class="token operator">=</span> fieldName<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">"\\."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> fs<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token class-name">Field</span> f <span class="token operator">=</span> clazz<span class="token punctuation">.</span><span class="token function">getDeclaredField</span><span class="token punctuation">(</span>fs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                f<span class="token punctuation">.</span><span class="token function">setAccessible</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                target <span class="token operator">=</span> f<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span><span class="token punctuation">;</span>                clazz <span class="token operator">=</span> target<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>            <span class="token class-name">Field</span> f <span class="token operator">=</span> clazz<span class="token punctuation">.</span><span class="token function">getDeclaredField</span><span class="token punctuation">(</span>fs<span class="token punctuation">[</span>fs<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            f<span class="token punctuation">.</span><span class="token function">setAccessible</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">return</span> f<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">/**     * 通过反射给对象的指定字段赋值     * @param target 目标对象     * @param fieldName 字段的名称     * @param value 值     */</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">setValue</span><span class="token punctuation">(</span><span class="token class-name">Object</span> target<span class="token punctuation">,</span> <span class="token class-name">String</span> fieldName<span class="token punctuation">,</span> <span class="token class-name">Object</span> value<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">></span></span> clazz <span class="token operator">=</span> target<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> fs <span class="token operator">=</span> fieldName<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">"\\."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> fs<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token class-name">Field</span> f <span class="token operator">=</span> clazz<span class="token punctuation">.</span><span class="token function">getDeclaredField</span><span class="token punctuation">(</span>fs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                f<span class="token punctuation">.</span><span class="token function">setAccessible</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token class-name">Object</span> val <span class="token operator">=</span> f<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">if</span><span class="token punctuation">(</span>val <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    <span class="token class-name">Constructor</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">></span></span> c <span class="token operator">=</span> f<span class="token punctuation">.</span><span class="token function">getType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getDeclaredConstructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    c<span class="token punctuation">.</span><span class="token function">setAccessible</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    val <span class="token operator">=</span> c<span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    f<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> val<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>                target <span class="token operator">=</span> val<span class="token punctuation">;</span>                clazz <span class="token operator">=</span> target<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>            <span class="token class-name">Field</span> f <span class="token operator">=</span> clazz<span class="token punctuation">.</span><span class="token function">getDeclaredField</span><span class="token punctuation">(</span>fs<span class="token punctuation">[</span>fs<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            f<span class="token punctuation">.</span><span class="token function">setAccessible</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            f<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><blockquote><h3 id="如何通过反射调用对象的方法？"><a href="#如何通过反射调用对象的方法？" class="headerlink" title="如何通过反射调用对象的方法？"></a>如何通过反射调用对象的方法？</h3></blockquote><p>答：请看下面的代码：</p><p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span><span class="token class-name">Method</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">MethodInvokeTest</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">String</span> str <span class="token operator">=</span> <span class="token string">"hello"</span><span class="token punctuation">;</span>        <span class="token class-name">Method</span> m <span class="token operator">=</span> str<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span><span class="token string">"toUpperCase"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>m<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// HELLO</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p>]]></content>
      
      
      <categories>
          
          <category> 教程笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 面试题 </tag>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Java 面试题解析（数据库）</title>
      <link href="post/73adfcb0.html"/>
      <url>post/73adfcb0.html</url>
      
        <content type="html"><![CDATA[<blockquote><h3 id="XML-文档定义有几种形式？它们之间有何本质区别？解析-XML-文档有哪几种方式？"><a href="#XML-文档定义有几种形式？它们之间有何本质区别？解析-XML-文档有哪几种方式？" class="headerlink" title="XML 文档定义有几种形式？它们之间有何本质区别？解析 XML 文档有哪几种方式？"></a>XML 文档定义有几种形式？它们之间有何本质区别？解析 XML 文档有哪几种方式？</h3></blockquote><p>答：XML 文档定义分为 DTD 和 Schema 两种形式，二者都是对 XML 语法的约束，其本质区别在于 Schema 本身也是一个 XML 文件，可以被 XML 解析器解析，而且可以为 XML 承载的数据定义类型，约束能力较之 DTD 更强大。对 XML 的解析主要有 DOM（文档对象模型，Document Object Model）、SAX（Simple API for XML）和 StAX（Java 6 中引入的新的解析 XML 的方式，Streaming API for XML），其中 DOM 处理大型文件时其性能下降的非常厉害，这个问题是由 DOM 树结构占用的内存较多造成的，而且 DOM 解析方式必须在解析文件之前把整个文档装入内存，适合对 XML 的随机访问（典型的用空间换取时间的策略）；SAX 是事件驱动型的 XML 解析方式，它顺序读取 XML 文件，不需要一次全部装载整个文件。当遇到像文件开头，文档结束，或者标签开头与标签结束时，它会触发一个事件，用户通过事件回调代码来处理XML文件，适合对 XML 的顺序访问；顾名思义，StAX 把重点放在流上，实际上 StAX 与其他解析方式的本质区别就在于应用程序能够把 XML 作为一个事件流来处理。将 XML 作为一组事件来处理的想法并不新颖（SAX 就是这样做的），但不同之处在于 StAX 允许应用程序代码把这些事件逐个拉出来，而不用提供在解析器方便时从解析器中接收事件的处理程序。</p><blockquote><h3 id="你在项目中哪些地方用到了-XML？"><a href="#你在项目中哪些地方用到了-XML？" class="headerlink" title="你在项目中哪些地方用到了 XML？"></a>你在项目中哪些地方用到了 XML？</h3></blockquote><p>答：XML 的主要作用有两个方面：数据交换和信息配置。在做数据交换时，XML 将数据用标签组装成起来，然后压缩打包加密后通过网络传送给接收者，接收解密与解压缩后再从 XML 文件中还原相关信息进行处理，XML 曾经是异构系统间交换数据的事实标准，但此项功能几乎已经被 JSON（JavaScript Object Notation）取而代之。当然，目前很多软件仍然使用 XML 来存储配置信息，我们在很多项目中通常也会将作为配置信息的硬代码写在 XML 文件中，Java 的很多框架也是这么做的，而且这些框架都选择了 dom4j 作为处理 XML 的工具，因为 Sun 公司的官方 API 实在不怎么好用。</p><p><strong>补充：</strong>现在有很多时髦的软件（如 Sublime）已经开始将配置文件书写成 JSON 格式，我们已经强烈的感受到 XML 的另一项功能也将逐渐被业界抛弃。</p><blockquote><h3 id="阐述-JDBC-操作数据库的步骤。"><a href="#阐述-JDBC-操作数据库的步骤。" class="headerlink" title="阐述 JDBC 操作数据库的步骤。"></a>阐述 JDBC 操作数据库的步骤。</h3></blockquote><p>答：下面的代码以连接本机的 Oracle 数据库为例，演示 JDBC 操作数据库的步骤。</p><ol><li><p>加载驱动。</p><p> <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token string">"oracle.jdbc.driver.OracleDriver"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p></li><li><p>创建连接。</p><p> <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">Connection</span> con <span class="token operator">=</span> <span class="token class-name">DriverManager</span><span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span><span class="token string">"jdbc:oracle:thin:@localhost:1521:orcl"</span><span class="token punctuation">,</span> <span class="token string">"scott"</span><span class="token punctuation">,</span> <span class="token string">"tiger"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p></li><li><p>创建语句。</p><p> <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">PreparedStatement</span> ps <span class="token operator">=</span> con<span class="token punctuation">.</span><span class="token function">prepareStatement</span><span class="token punctuation">(</span><span class="token string">"select * from emp where sal between ? and ?"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>ps<span class="token punctuation">.</span><span class="token function">setInt</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>ps<span class="token punctuation">.</span><span class="token function">setInt</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></p></li><li><p>执行语句。</p><p> <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">ResultSet</span> rs <span class="token operator">=</span> ps<span class="token punctuation">.</span><span class="token function">executeQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p></li><li><p>处理结果。</p><p> <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">while</span><span class="token punctuation">(</span>rs<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>rs<span class="token punctuation">.</span><span class="token function">getInt</span><span class="token punctuation">(</span><span class="token string">"empno"</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">" - "</span> <span class="token operator">+</span> rs<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">"ename"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></p></li><li><p>关闭资源。</p><p> <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">finally</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span>con <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>            con<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">SQLException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p></li></ol><p><strong>注意：</strong>关闭外部资源的顺序应该和打开的顺序相反，也就是说先关闭 <code>ResultSet</code>、再关闭 <code>Statement</code>、最后关闭 <code>Connection</code>。上面的代码只关闭了 Connection`（连接），虽然通常情况下在关闭连接时，连接上创建的语句和打开的游标也会关闭，但不能保证总是如此，因此应该按照刚才说的顺序分别关闭。此外，第一步加载驱动在 JDBC 4.0 中是可以省略的（自动从类路径中加载驱动），但是我们建议保留。</p><blockquote><h3 id="Statement-和-PreparedStatement-有什么区别？哪个性能更好？"><a href="#Statement-和-PreparedStatement-有什么区别？哪个性能更好？" class="headerlink" title="Statement 和 PreparedStatement 有什么区别？哪个性能更好？"></a><code>Statement</code> 和 <code>PreparedStatement</code> 有什么区别？哪个性能更好？</h3></blockquote><p>答：与 <code>Statement</code> 相比，<code>PreparedStatement</code> 主要有以下优势：</p><ol><li><code>PreparedStatement</code> 接口代表预编译的语句，它主要的优势在于可以减少 SQL 的编译错误并增加 SQL 的安全性（减少 SQL 注射攻击的可能性）；</li><li><code>PreparedStatement</code> 中的 SQL 语句是可以带参数的，避免了用字符串连接拼接 SQL 语句的麻烦和不安全；</li><li>当批量处理 SQL 或频繁执行相同的查询时，<code>PreparedStatement</code>有明显的性能上的优势，由于数据库可以将编译优化后的 SQL 语句缓存起来，下次执行相同结构的语句时就会很快（不用再次编译和生成执行计划）。</li></ol><p><strong>补充：</strong>为了提供对存储过程的调用，JDBC API 中还提供了 <code>CallableStatement</code> 接口。存储过程（Stored Procedure）是数据库中一组为了完成特定功能的 SQL 语句的集合，经编译后存储在数据库中，用户通过指定存储过程的名字并给出参数（如果该存储过程带有参数）来执行它。虽然调用存储过程会在网络开销、安全性、性能上获得很多好处，但是存在如果底层数据库发生迁移时就会有很多麻烦，因为每种数据库的存储过程在书写上存在不少的差别。</p><blockquote><h3 id="使用-JDBC-操作数据库时，如何提升读取数据的性能？如何提升更新数据的性能？"><a href="#使用-JDBC-操作数据库时，如何提升读取数据的性能？如何提升更新数据的性能？" class="headerlink" title="使用 JDBC 操作数据库时，如何提升读取数据的性能？如何提升更新数据的性能？"></a>使用 JDBC 操作数据库时，如何提升读取数据的性能？如何提升更新数据的性能？</h3></blockquote><p>答：要<strong>提升读取数据的性能</strong>，可以指定通过结果集（ResultSet）对象的 <code>setFetchSize()</code> 方法指定每次抓取的记录数（典型的空间换时间策略）；要提升更新数据的性能可以使用 <code>PreparedStatement</code> 语句构建批处理，将若干 SQL 语句置于一个批处理中执行。</p><blockquote><h3 id="在进行数据库编程时，连接池有什么作用？"><a href="#在进行数据库编程时，连接池有什么作用？" class="headerlink" title="在进行数据库编程时，连接池有什么作用？"></a>在进行数据库编程时，连接池有什么作用？</h3></blockquote><p>答：由于创建连接和释放连接都有很大的开销（尤其是数据库服务器不在本地时，每次建立连接都需要进行 TCP 的三次握手，释放连接需要进行 TCP 四次握手，造成的开销是不可忽视的），为了提升系统访问数据库的性能，可以事先创建若干连接置于连接池中，需要时直接从连接池获取，使用结束时归还连接池而不必关闭连接，从而避免频繁创建和释放连接所造成的开销，这是典型的用空间换取时间的策略（浪费了空间存储连接，但节省了创建和释放连接的时间）。池化技术在 Java 开发中是很常见的，在使用线程时创建线程池的道理与此相同。基于 Java 的开源数据库连接池主要有：C3P0、Proxool、DBCP、BoneCP、Druid等。</p><p><strong>补充：</strong>在计算机系统中时间和空间是不可调和的矛盾，理解这一点对设计满足性能要求的算法是至关重要的。大型网站性能优化的一个关键就是使用缓存，而缓存跟上面讲的连接池道理非常类似，也是使用空间换时间的策略。可以将热点数据置于缓存中，当用户查询这些数据时可以直接从缓存中得到，这无论如何也快过去数据库中查询。当然，缓存的置换策略等也会对系统性能产生重要影响，对于这个问题的讨论已经超出了这里要阐述的范围。</p><blockquote><h3 id="什么是-DAO-模式？"><a href="#什么是-DAO-模式？" class="headerlink" title="什么是 DAO 模式？"></a>什么是 DAO 模式？</h3></blockquote><p>答：DAO（Data Access Object）顾名思义是一个为数据库或其他持久化机制提供了抽象接口的对象，在不暴露底层持久化方案实现细节的前提下提供了各种数据访问操作。在实际的开发中，应该将所有对数据源的访问操作进行抽象化后封装在一个公共 API 中。用程序设计语言来说，就是建立一个接口，接口中定义了此应用程序中将会用到的所有事务方法。在这个应用程序中，当需要和数据源进行交互的时候则使用这个接口，并且编写一个单独的类来实现这个接口，在逻辑上该类对应一个特定的数据存储。DAO 模式实际上包含了两个模式，一是 Data Accessor（数据访问器），二是 Data Object（数据对象），前者要解决如何访问数据的问题，而后者要解决的是如何用对象封装数据。</p><blockquote><h3 id="事务的-ACID-是指什么？"><a href="#事务的-ACID-是指什么？" class="headerlink" title="事务的 ACID 是指什么？"></a>事务的 ACID 是指什么？</h3></blockquote><p>答：</p><ul><li>原子性（Atomic）：事务中各项操作，要么全做要么全不做，任何一项操作的失败都会导致整个事务的失败；</li><li>一致性（Consistent）：事务结束后系统状态是一致的；</li><li>隔离性（Isolated）：并发执行的事务彼此无法看到对方的中间状态；</li><li>持久性（Durable）：事务完成后所做的改动都会被持久化，即使发生灾难性的失败。通过日志和同步备份可以在故障发生后重建数据。</li></ul><p><strong>补充：</strong>关于事务，在面试中被问到的概率是很高的，可以问的问题也是很多的。首先需要知道的是，只有存在<strong>并发数据访问</strong>时才需要事务。当多个事务访问同一数据时，可能会存在 5 类问题，包括 3 类<strong>数据读取</strong>问题（脏读、不可重复读和幻读）和 2 类<strong>数据更新</strong>问题（第 1 类丢失更新和第 2 类丢失更新）。</p><ul><li>脏读（Dirty Read）：A 事务读取 B 事务尚未提交的数据并在此基础上操作，而 B 事务执行回滚，那么 A 读取到的数据就是脏数据。</li></ul><div class="table-container"><table><thead><tr><th>时间</th><th>转账事务A</th><th>取款事务B</th></tr></thead><tbody><tr><td>T1</td><td>&nbsp;</td><td>开始事务</td></tr><tr><td>T2</td><td>开始事务</td><td>&nbsp;</td></tr><tr><td>T3</td><td>&nbsp;</td><td>查询账户余额为1000元</td></tr><tr><td>T4</td><td>&nbsp;</td><td>取出500元余额修改为500元</td></tr><tr><td>T5</td><td>查询账户余额为500元（脏读）</td><td>&nbsp;</td></tr><tr><td>T6</td><td>&nbsp;</td><td>撤销事务余额恢复为1000元</td></tr><tr><td>T7</td><td>汇入100元把余额修改为600元</td><td>&nbsp;</td></tr><tr><td>T8</td><td>提交事务</td><td>&nbsp;</td></tr></tbody></table></div><ul><li>不可重复读（Unrepeatable Read）：事务 A 重新读取前面读取过的数据，发现该数据已经被另一个已提交的事务 B 修改过了。</li></ul><div class="table-container"><table><thead><tr><th>时间</th><th>转账事务A</th><th>取款事务B</th></tr></thead><tbody><tr><td>T1</td><td>&nbsp;</td><td>开始事务</td></tr><tr><td>T2</td><td>开始事务</td><td>&nbsp;</td></tr><tr><td>T3</td><td>&nbsp;</td><td>查询账户余额为1000元</td></tr><tr><td>T4</td><td>查询账户余额为1000元</td><td>&nbsp;</td></tr><tr><td>T5</td><td>&nbsp;</td><td>取出100元修改余额为900元</td></tr><tr><td>T6</td><td>&nbsp;</td><td>提交事务</td></tr><tr><td>T7</td><td>查询账户余额为900元（不可重复读）</td><td>&nbsp;</td></tr></tbody></table></div><ul><li>幻读（Phantom Read）：事务 A 重新执行一个查询，返回一系列符合查询条件的行，发现其中插入了被事务 B 提交的行。</li></ul><div class="table-container"><table><thead><tr><th>时间</th><th>统计金额事务A</th><th>转账事务B</th></tr></thead><tbody><tr><td>T1</td><td>&nbsp;</td><td>开始事务</td></tr><tr><td>T2</td><td>开始事务</td><td>&nbsp;</td></tr><tr><td>T3</td><td>统计总存款为10000元</td><td>&nbsp;</td></tr><tr><td>T4</td><td>&nbsp;</td><td>新增一个存款账户存入100元</td></tr><tr><td>T5</td><td>&nbsp;</td><td>提交事务</td></tr><tr><td>T6</td><td>再次统计总存款为10100元（幻读）</td><td>&nbsp;</td></tr></tbody></table></div><ul><li>第 1 类丢失更新：事务 A 撤销时，把已经提交的事务 B 的更新数据覆盖了。</li></ul><div class="table-container"><table><thead><tr><th>时间</th><th>取款事务A</th><th>转账事务B</th></tr></thead><tbody><tr><td>T1</td><td>开始事务</td><td>&nbsp;</td></tr><tr><td>T2</td><td>&nbsp;</td><td>开始事务</td></tr><tr><td>T3</td><td>查询账户余额为1000元</td><td>&nbsp;</td></tr><tr><td>T4</td><td>&nbsp;</td><td>查询账户余额为1000元</td></tr><tr><td>T5</td><td>&nbsp;</td><td>汇入100元修改余额为1100元</td></tr><tr><td>T6</td><td>&nbsp;</td><td>提交事务</td></tr><tr><td>T7</td><td>取出100元将余额修改为900元</td><td>&nbsp;</td></tr><tr><td>T8</td><td>撤销事务</td><td>&nbsp;</td></tr><tr><td>T9</td><td>余额恢复为1000元（丢失更新）</td><td>&nbsp;</td></tr></tbody></table></div><ul><li>第 2 类丢失更新：事务 A 覆盖事务 B 已经提交的数据，造成事务 B 所做的操作丢失。</li></ul><div class="table-container"><table><thead><tr><th>时间</th><th>转账事务A</th><th>取款事务B</th></tr></thead><tbody><tr><td>T1</td><td>&nbsp;</td><td>开始事务</td></tr><tr><td>T2</td><td>开始事务</td><td>&nbsp;</td></tr><tr><td>T3</td><td>&nbsp;</td><td>查询账户余额为1000元</td></tr><tr><td>T4</td><td>查询账户余额为1000元</td><td>&nbsp;</td></tr><tr><td>T5</td><td>&nbsp;</td><td>取出100元将余额修改为900元</td></tr><tr><td>T6</td><td>&nbsp;</td><td>提交事务</td></tr><tr><td>T7</td><td>汇入100元将余额修改为1100元</td><td>&nbsp;</td></tr><tr><td>T8</td><td>提交事务</td><td>&nbsp;</td></tr><tr><td>T9</td><td>查询账户余额为1100元（丢失更新）</td><td>&nbsp;</td></tr></tbody></table></div><p>数据并发访问所产生的问题，在有些场景下可能是允许的，但是有些场景下可能就是致命的，数据库通常会通过<strong>锁机制</strong>来解决数据并发访问问题，按锁定对象不同可以分为<strong>表级锁</strong>和<strong>行级锁</strong>；按并发事务锁定关系可以分为<strong>共享锁</strong>和<strong>独占锁</strong>，具体的内容大家可以自行查阅资料进行了解。</p><p>直接使用锁是非常麻烦的，为此数据库为用户提供了自动锁机制，只要用户指定会话的事务隔离级别，数据库就会通过分析 SQL 语句然后为事务访问的资源加上合适的锁，此外，数据库还会维护这些锁通过各种手段提高系统的性能，这些对用户来说都是透明的（就是说你不用理解，事实上我确实也不知道）。ANSI/ISO SQL 92 标准定义了 4 个等级的事务隔离级别，如下表所示：</p><div class="table-container"><table><thead><tr><th>隔离级别</th><th>脏读</th><th>不可重复读</th><th>幻读</th><th>第一类丢失更新</th><th>第二类丢失更新</th></tr></thead><tbody><tr><td>READ UNCOMMITED</td><td>允许</td><td>允许</td><td>允许</td><td>不允许</td><td>允许</td></tr><tr><td>READ COMMITTED</td><td>不允许</td><td>允许</td><td>允许</td><td>不允许</td><td>允许</td></tr><tr><td>REPEATABLE READ</td><td>不允许</td><td>不允许</td><td>允许</td><td>不允许</td><td>不允许</td></tr><tr><td>SERIALIZABLE</td><td>不允许</td><td>不允许</td><td>不允许</td><td>不允许</td><td>不允许</td></tr></tbody></table></div><p><strong>注意：</strong>需要说明的是，事务隔离级别和数据访问的并发性是对立的，事务隔离级别越高并发性就越差。所以要根据具体的应用来确定合适的事务隔离级别，这个地方没有万能的原则。</p><blockquote><h3 id="JDBC-中如何进行事务处理？"><a href="#JDBC-中如何进行事务处理？" class="headerlink" title="JDBC 中如何进行事务处理？"></a>JDBC 中如何进行事务处理？</h3></blockquote><p>答：<code>Connection</code> 提供了事务处理的方法，通过调用 <code>setAutoCommit(false)</code> 可以设置手动提交事务；当事务完成后用 <code>commit()</code> 显式提交事务；如果在事务处理过程中发生异常则通过 <code>rollback()</code> 进行事务回滚。除此之外，从 JDBC 3.0 中还引入了 Savepoint（保存点）的概念，允许通过代码设置保存点并让事务回滚到指定的保存点。</p><p><img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="/images/post/java_interview/81.png" alt></p><blockquote><h3 id="JDBC-能否处理-Blob-和-Clob？"><a href="#JDBC-能否处理-Blob-和-Clob？" class="headerlink" title="JDBC 能否处理 Blob 和 Clob？"></a>JDBC 能否处理 Blob 和 Clob？</h3></blockquote><p>答： Blob 是指二进制大对象（Binary Large Object），而 Clob 是指大字符对象（Character Large Objec），因此其中 Blob 是为存储大的二进制数据而设计的，而 Clob 是为存储大的文本数据而设计的。JDBC 的 <code>PreparedStatement</code> 和 <code>ResultSet</code> 都提供了相应的方法来支持 Blob 和 Clob 操作。下面的代码展示了如何使用 JDBC 操作 LOB：下面以 MySQL 数据库为例，创建一个张有三个字段的用户表，包括编号（<code>id</code>）、姓名（<code>name</code>）和照片（<code>photo</code>），建表语句如下：</p><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> tb_user <span class="token punctuation">(</span>  id <span class="token keyword">INT</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token keyword">auto_increment</span><span class="token punctuation">,</span>  name <span class="token keyword">VARCHAR</span> <span class="token punctuation">(</span> <span class="token number">20</span> <span class="token punctuation">)</span> <span class="token keyword">UNIQUE</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>  photo <span class="token keyword">LONGBLOB</span> <span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p>下面的 Java 代码向数据库中插入一条记录：</p><p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">FileInputStream</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">InputStream</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>sql<span class="token punctuation">.</span></span><span class="token class-name">Connection</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>sql<span class="token punctuation">.</span></span><span class="token class-name">DriverManager</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>sql<span class="token punctuation">.</span></span><span class="token class-name">PreparedStatement</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>sql<span class="token punctuation">.</span></span><span class="token class-name">SQLException</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">JdbcLobTest</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">Connection</span> con <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>            <span class="token comment">// 1. 加载驱动（Java6以上版本可以省略）</span>            <span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token string">"com.mysql.jdbc.Driver"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">// 2. 建立连接</span>            con <span class="token operator">=</span> <span class="token class-name">DriverManager</span><span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span><span class="token string">"jdbc:mysql://localhost:3306/test"</span><span class="token punctuation">,</span> <span class="token string">"root"</span><span class="token punctuation">,</span> <span class="token string">"123456"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">// 3. 创建语句对象</span>            <span class="token class-name">PreparedStatement</span> ps <span class="token operator">=</span> con<span class="token punctuation">.</span><span class="token function">prepareStatement</span><span class="token punctuation">(</span><span class="token string">"insert into tb_user values (default, ?, ?)"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            ps<span class="token punctuation">.</span><span class="token function">setString</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"Jack"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">// 将SQL语句中第一个占位符换成字符串</span>            <span class="token keyword">try</span> <span class="token punctuation">(</span><span class="token class-name">InputStream</span> in <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileInputStream</span><span class="token punctuation">(</span><span class="token string">"test.jpg"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// Java 7的TWR</span>                ps<span class="token punctuation">.</span><span class="token function">setBinaryStream</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> in<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment">// 将SQL语句中第二个占位符换成二进制流</span>                                <span class="token comment">// 4. SQL 语句获得受影响行数</span>                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>ps<span class="token punctuation">.</span><span class="token function">executeUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span> <span class="token operator">?</span> <span class="token string">"插入成功"</span> <span class="token operator">:</span> <span class="token string">"插入失败"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"读取照片失败!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">ClassNotFoundException</span> <span class="token operator">|</span> <span class="token class-name">SQLException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>     <span class="token comment">// Java 7的多异常捕获</span>            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">finally</span> <span class="token punctuation">&#123;</span>     <span class="token comment">// 释放外部资源的代码都应当放在finally中保证其能够得到执行</span>            <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>                <span class="token keyword">if</span><span class="token punctuation">(</span>con <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>con<span class="token punctuation">.</span><span class="token function">isClosed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    con<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// 5. 释放数据库连接 </span>                    con <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>     <span class="token comment">// 指示垃圾回收器可以回收该对象</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">SQLException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><blockquote><h3 id="简述正则表达式及其用途。"><a href="#简述正则表达式及其用途。" class="headerlink" title="简述正则表达式及其用途。"></a>简述正则表达式及其用途。</h3></blockquote><p>答：在编写处理字符串的程序时，经常会有查找符合某些复杂规则的字符串的需要。正则表达式就是用于描述这些规则的工具。换句话说，正则表达式就是记录文本规则的代码。</p><p><strong>说明：</strong>计算机诞生初期处理的信息几乎都是数值，但是时过境迁，今天我们使用计算机处理的信息更多的时候不是数值而是字符串，正则表达式就是在进行字符串匹配和处理的时候最为强大的工具，绝大多数语言都提供了对正则表达式的支持。</p><blockquote><h3 id="Java-中是如何支持正则表达式操作的？"><a href="#Java-中是如何支持正则表达式操作的？" class="headerlink" title="Java 中是如何支持正则表达式操作的？"></a>Java 中是如何支持正则表达式操作的？</h3></blockquote><p>答：Java 中的 <code>String</code> 类提供了支持正则表达式操作的方法，包括：<code>matches()</code>、<code>replaceAll()</code>、<code>replaceFirst()</code>、<code>split()</code>。此外，Java 中可以用 <code>Pattern</code> 类表示正则表达式对象，它提供了丰富的 API 进行各种正则表达式操作，请参考下面面试题的代码。</p><p>面试题：如果要从字符串中截取第一个英文左括号之前的字符串，例如：北京市(朝阳区)(西城区)(海淀区)，截取结果为：北京市，那么正则表达式怎么写？</p><p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>regex<span class="token punctuation">.</span></span><span class="token class-name">Matcher</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>regex<span class="token punctuation">.</span></span><span class="token class-name">Pattern</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">RegExpTest</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">String</span> str <span class="token operator">=</span> <span class="token string">"北京市(朝阳区)(西城区)(海淀区)"</span><span class="token punctuation">;</span>        <span class="token class-name">Pattern</span> p <span class="token operator">=</span> <span class="token class-name">Pattern</span><span class="token punctuation">.</span><span class="token function">compile</span><span class="token punctuation">(</span><span class="token string">".*?(?=\\()"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Matcher</span> m <span class="token operator">=</span> p<span class="token punctuation">.</span><span class="token function">matcher</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>m<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>m<span class="token punctuation">.</span><span class="token function">group</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p><strong>说明：</strong>上面的正则表达式中使用了懒惰匹配和前瞻，如果不清楚这些内容，推荐读一下网上很有名的<a href="https://www.jb51.net/tools/zhengze.html">《正则表达式30分钟入门教程》</a>。</p>]]></content>
      
      
      <categories>
          
          <category> 教程笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 面试题 </tag>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Java 面试题解析（IO流）</title>
      <link href="post/af128a42.html"/>
      <url>post/af128a42.html</url>
      
        <content type="html"><![CDATA[<blockquote><h3 id="Java-中如何实现序列化，有什么意义？"><a href="#Java-中如何实现序列化，有什么意义？" class="headerlink" title="Java 中如何实现序列化，有什么意义？"></a>Java 中如何实现序列化，有什么意义？</h3></blockquote><p>答：序列化就是一种用来处理对象流的机制，所谓对象流也就是将对象的内容进行流化。可以对流化后的对象进行读写操作，也可将流化后的对象传输于网络之间。序列化是为了解决对象流读写操作时可能引发的问题（如果不进行序列化可能会存在数据乱序的问题）。</p><p>要实现序列化，需要让一个类实现 <code>Serializable</code> 接口，该接口是一个标识性接口，标注该类对象是可被序列化的，然后使用一个输出流来构造一个对象输出流并通过 <code>writeObject(Object)</code> 方法就可以将实现对象写出（即保存其状态）；如果需要反序列化则可以用一个输入流建立对象输入流，然后通过 <code>readObject</code> 方法从流中读取对象。序列化除了能够实现对象的持久化之外，还能够用于对象的深度克隆（可以参考第 29 题）。</p><blockquote><h3 id="Java-中有几种类型的流？"><a href="#Java-中有几种类型的流？" class="headerlink" title="Java 中有几种类型的流？"></a>Java 中有几种类型的流？</h3></blockquote><p>答：<strong>字节流</strong>和<strong>字符流</strong>。字节流继承于 <code>InputStream</code>、<code>OutputStream</code>，字符流继承于 <code>Reader</code>、<code>Writer</code>。在 <code>java.io</code> 包中还有许多其他的流，主要是为了提高性能和使用方便。关于 Java 的 I/O 需要注意的有两点：一是两种<strong>对称性</strong>（输入和输出的对称性，字节和字符的对称性）；二是两种<strong>设计模式</strong>（适配器模式和装潢模式）。另外 Java 中的流不同于 C# 的是它只有一个维度一个方向。</p><p>面试题 - 编程实现文件拷贝。（这个题目在笔试的时候经常出现，下面的代码给出了两种实现方案）</p><p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">FileInputStream</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">FileOutputStream</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">InputStream</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">OutputStream</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span></span><span class="token class-name">ByteBuffer</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>channels<span class="token punctuation">.</span></span><span class="token class-name">FileChannel</span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">MyUtil</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// 工具类中的方法都是静态方式访问的，因此将构造器私有不允许创建对象(绝对好习惯)</span>    <span class="token keyword">private</span> <span class="token class-name">MyUtil</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">AssertionError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">fileCopy</span><span class="token punctuation">(</span><span class="token class-name">String</span> source<span class="token punctuation">,</span> <span class="token class-name">String</span> target<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">try</span> <span class="token punctuation">(</span><span class="token class-name">InputStream</span> in <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileInputStream</span><span class="token punctuation">(</span>source<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">try</span> <span class="token punctuation">(</span><span class="token class-name">OutputStream</span> out <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileOutputStream</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> buffer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token number">4096</span><span class="token punctuation">]</span><span class="token punctuation">;</span>                <span class="token keyword">int</span> bytesToRead<span class="token punctuation">;</span>                <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token punctuation">(</span>bytesToRead <span class="token operator">=</span> in<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    out<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>buffer<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> bytesToRead<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">fileCopyNIO</span><span class="token punctuation">(</span><span class="token class-name">String</span> source<span class="token punctuation">,</span> <span class="token class-name">String</span> target<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">try</span> <span class="token punctuation">(</span><span class="token class-name">FileInputStream</span> in <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileInputStream</span><span class="token punctuation">(</span>source<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">try</span> <span class="token punctuation">(</span><span class="token class-name">FileOutputStream</span> out <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileOutputStream</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token class-name">FileChannel</span> inChannel <span class="token operator">=</span> in<span class="token punctuation">.</span><span class="token function">getChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token class-name">FileChannel</span> outChannel <span class="token operator">=</span> out<span class="token punctuation">.</span><span class="token function">getChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token class-name">ByteBuffer</span> buffer <span class="token operator">=</span> <span class="token class-name">ByteBuffer</span><span class="token punctuation">.</span><span class="token function">allocate</span><span class="token punctuation">(</span><span class="token number">4096</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">while</span><span class="token punctuation">(</span>inChannel<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    buffer<span class="token punctuation">.</span><span class="token function">flip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    outChannel<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>                    buffer<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p><strong>注意：</strong>上面用到 Java 7 的 TWR，使用 TWR 后可以不用在 <code>finally</code> 中释放外部资源 ，从而让代码更加优雅。</p><blockquote><h3 id="写一个方法，输入一个文件名和一个字符串，统计这个字符串在这个文件中出现的次数。"><a href="#写一个方法，输入一个文件名和一个字符串，统计这个字符串在这个文件中出现的次数。" class="headerlink" title="写一个方法，输入一个文件名和一个字符串，统计这个字符串在这个文件中出现的次数。"></a>写一个方法，输入一个文件名和一个字符串，统计这个字符串在这个文件中出现的次数。</h3></blockquote><p>答：代码如下：</p><p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">BufferedReader</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">FileReader</span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">MyUtil</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// 工具类中的方法都是静态方式访问的，因此将构造器私有不允许创建对象(绝对好习惯)</span>    <span class="token keyword">private</span> <span class="token class-name">MyUtil</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">AssertionError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">/**     * 统计给定文件中给定字符串的出现次数     * @param filename 文件名     * @param word 字符串     * @return 字符串在文件中出现的次数     */</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">countWordInFile</span><span class="token punctuation">(</span><span class="token class-name">String</span> filename<span class="token punctuation">,</span> <span class="token class-name">String</span> word<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">int</span> counter <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>        <span class="token keyword">try</span> <span class="token punctuation">(</span><span class="token class-name">FileReader</span> fr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileReader</span><span class="token punctuation">(</span>filename<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">try</span> <span class="token punctuation">(</span><span class="token class-name">BufferedReader</span> br <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BufferedReader</span><span class="token punctuation">(</span>fr<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token class-name">String</span> line <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>                <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>line <span class="token operator">=</span> br<span class="token punctuation">.</span><span class="token function">readLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    <span class="token keyword">int</span> index <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>                    <span class="token keyword">while</span> <span class="token punctuation">(</span>line<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">>=</span> word<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>index <span class="token operator">=</span> line<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>word<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">>=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                        counter<span class="token operator">++</span><span class="token punctuation">;</span>                        line <span class="token operator">=</span> line<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span>index <span class="token operator">+</span> word<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token punctuation">&#125;</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> ex<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            ex<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">return</span> counter<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><blockquote><h3 id="如何用-Java-代码列出一个目录下所有的文件？"><a href="#如何用-Java-代码列出一个目录下所有的文件？" class="headerlink" title="如何用 Java 代码列出一个目录下所有的文件？"></a>如何用 Java 代码列出一个目录下所有的文件？</h3></blockquote><p>答：</p><p>如果只要求列出当前文件夹下的文件，代码如下所示：</p><p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">File</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">Test12</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">File</span> f <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token string">"/Users/Hao/Downloads"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token class-name">File</span> temp <span class="token operator">:</span> f<span class="token punctuation">.</span><span class="token function">listFiles</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">if</span><span class="token punctuation">(</span>temp<span class="token punctuation">.</span><span class="token function">isFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>temp<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p>如果需要对文件夹继续展开，代码如下所示：</p><p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">File</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">Test12</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token function">showDirectory</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token string">"/Users/Hao/Downloads"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">showDirectory</span><span class="token punctuation">(</span><span class="token class-name">File</span> f<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token function">_walkDirectory</span><span class="token punctuation">(</span>f<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">_walkDirectory</span><span class="token punctuation">(</span><span class="token class-name">File</span> f<span class="token punctuation">,</span> <span class="token keyword">int</span> level<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>f<span class="token punctuation">.</span><span class="token function">isDirectory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token class-name">File</span> temp <span class="token operator">:</span> f<span class="token punctuation">.</span><span class="token function">listFiles</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token function">_walkDirectory</span><span class="token punctuation">(</span>temp<span class="token punctuation">,</span> level <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> level <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"\t"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>f<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p>在 Java 7 中可以使用 NIO.2 的 API 来做同样的事情，代码如下所示：</p><p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">class</span> <span class="token class-name">ShowFileTest</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">Path</span> initPath <span class="token operator">=</span> <span class="token class-name">Paths</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"/Users/Hao/Downloads"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Files</span><span class="token punctuation">.</span><span class="token function">walkFileTree</span><span class="token punctuation">(</span>initPath<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">SimpleFileVisitor</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Path</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token annotation punctuation">@Override</span>            <span class="token keyword">public</span> <span class="token class-name">FileVisitResult</span> <span class="token function">visitFile</span><span class="token punctuation">(</span><span class="token class-name">Path</span> file<span class="token punctuation">,</span> <span class="token class-name">BasicFileAttributes</span> attrs<span class="token punctuation">)</span>                     <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>file<span class="token punctuation">.</span><span class="token function">getFileName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">return</span> <span class="token class-name">FileVisitResult</span><span class="token punctuation">.</span>CONTINUE<span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><blockquote><h3 id="用-Java-的套接字编程实现一个多线程的回显（echo）服务器。"><a href="#用-Java-的套接字编程实现一个多线程的回显（echo）服务器。" class="headerlink" title="用 Java 的套接字编程实现一个多线程的回显（echo）服务器。"></a>用 Java 的套接字编程实现一个多线程的回显（echo）服务器。</h3></blockquote><p>答：</p><p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">BufferedReader</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">InputStreamReader</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">PrintWriter</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>net<span class="token punctuation">.</span></span><span class="token class-name">ServerSocket</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>net<span class="token punctuation">.</span></span><span class="token class-name">Socket</span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">EchoServer</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> ECHO_SERVER_PORT <span class="token operator">=</span> <span class="token number">6789</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token keyword">try</span><span class="token punctuation">(</span><span class="token class-name">ServerSocket</span> server <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ServerSocket</span><span class="token punctuation">(</span>ECHO_SERVER_PORT<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"服务器已经启动..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token class-name">Socket</span> client <span class="token operator">=</span> server<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ClientHandler</span><span class="token punctuation">(</span>client<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">ClientHandler</span> <span class="token keyword">implements</span> <span class="token class-name">Runnable</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">private</span> <span class="token class-name">Socket</span> client<span class="token punctuation">;</span>        <span class="token keyword">public</span> <span class="token class-name">ClientHandler</span><span class="token punctuation">(</span><span class="token class-name">Socket</span> client<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">this</span><span class="token punctuation">.</span>client <span class="token operator">=</span> client<span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token annotation punctuation">@Override</span>        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">try</span><span class="token punctuation">(</span><span class="token class-name">BufferedReader</span> br <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BufferedReader</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">InputStreamReader</span><span class="token punctuation">(</span>client<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token class-name">PrintWriter</span> pw <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PrintWriter</span><span class="token punctuation">(</span>client<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token class-name">String</span> msg <span class="token operator">=</span> br<span class="token punctuation">.</span><span class="token function">readLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"收到"</span> <span class="token operator">+</span> client<span class="token punctuation">.</span><span class="token function">getInetAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"发送的: "</span> <span class="token operator">+</span> msg<span class="token punctuation">)</span><span class="token punctuation">;</span>                pw<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>                pw<span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token class-name">Exception</span> ex<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                ex<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span> <span class="token keyword">finally</span> <span class="token punctuation">&#123;</span>                <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>                    client<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p><strong>注意：</strong>上面的代码使用了 Java 7 的 TWR 语法，由于很多外部资源类都间接的实现了 <code>AutoCloseable</code> 接口（单方法回调接口），因此可以利用 TWR 语法在 <code>try</code> 结束的时候通过回调的方式自动调用外部资源类的 <code>close()</code> 方法，避免书写冗长的 <code>finally</code> 代码块。此外，上面的代码用一个静态内部类实现线程的功能，使用多线程可以避免一个用户 I/O 操作所产生的中断影响其他用户对服务器的访问，简单的说就是一个用户的输入操作不会造成其他用户的阻塞。当然，上面的代码使用线程池可以获得更好的性能，因为频繁的创建和销毁线程所造成的开销也是不可忽视的。</p><p>下面是一段回显客户端测试代码：</p><p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">BufferedReader</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">InputStreamReader</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">PrintWriter</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>net<span class="token punctuation">.</span></span><span class="token class-name">Socket</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Scanner</span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">EchoClient</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">Socket</span> client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Socket</span><span class="token punctuation">(</span><span class="token string">"localhost"</span><span class="token punctuation">,</span> <span class="token number">6789</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Scanner</span> sc <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Scanner</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"请输入内容: "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">String</span> msg <span class="token operator">=</span> sc<span class="token punctuation">.</span><span class="token function">nextLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        sc<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">PrintWriter</span> pw <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PrintWriter</span><span class="token punctuation">(</span>client<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        pw<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>        pw<span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">BufferedReader</span> br <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BufferedReader</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">InputStreamReader</span><span class="token punctuation">(</span>client<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>br<span class="token punctuation">.</span><span class="token function">readLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        client<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p>如果希望用 NIO 的多路复用套接字实现服务器，代码如下所示。NIO 的操作虽然带来了更好的性能，但是有些操作是比较底层的，对于初学者来说还是有些难于理解。</p><p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>net<span class="token punctuation">.</span></span><span class="token class-name">InetSocketAddress</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span></span><span class="token class-name">ByteBuffer</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span></span><span class="token class-name">CharBuffer</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>channels<span class="token punctuation">.</span></span><span class="token class-name">SelectionKey</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>channels<span class="token punctuation">.</span></span><span class="token class-name">Selector</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>channels<span class="token punctuation">.</span></span><span class="token class-name">ServerSocketChannel</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>channels<span class="token punctuation">.</span></span><span class="token class-name">SocketChannel</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Iterator</span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">EchoServerNIO</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> ECHO_SERVER_PORT <span class="token operator">=</span> <span class="token number">6789</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> ECHO_SERVER_TIMEOUT <span class="token operator">=</span> <span class="token number">5000</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> BUFFER_SIZE <span class="token operator">=</span> <span class="token number">1024</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">ServerSocketChannel</span> serverChannel <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">Selector</span> selector <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>    <span class="token comment">// 多路复用选择器</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">ByteBuffer</span> buffer <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>    <span class="token comment">// 缓冲区</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">listen</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>            serverChannel <span class="token operator">=</span> <span class="token class-name">ServerSocketChannel</span><span class="token punctuation">.</span><span class="token keyword">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            buffer <span class="token operator">=</span> <span class="token class-name">ByteBuffer</span><span class="token punctuation">.</span><span class="token function">allocate</span><span class="token punctuation">(</span>BUFFER_SIZE<span class="token punctuation">)</span><span class="token punctuation">;</span>            serverChannel<span class="token punctuation">.</span><span class="token function">socket</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">InetSocketAddress</span><span class="token punctuation">(</span>ECHO_SERVER_PORT<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            serverChannel<span class="token punctuation">.</span><span class="token function">configureBlocking</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            selector <span class="token operator">=</span> <span class="token class-name">Selector</span><span class="token punctuation">.</span><span class="token keyword">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            serverChannel<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span>selector<span class="token punctuation">,</span> <span class="token class-name">SelectionKey</span><span class="token punctuation">.</span>OP_ACCEPT<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">listen</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>selector<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span>ECHO_SERVER_TIMEOUT<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    <span class="token class-name">Iterator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SelectionKey</span><span class="token punctuation">></span></span> it <span class="token operator">=</span> selector<span class="token punctuation">.</span><span class="token function">selectedKeys</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">iterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token keyword">while</span> <span class="token punctuation">(</span>it<span class="token punctuation">.</span><span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                        <span class="token class-name">SelectionKey</span> key <span class="token operator">=</span> it<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        it<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token function">handleKey</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token punctuation">&#125;</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">handleKey</span><span class="token punctuation">(</span><span class="token class-name">SelectionKey</span> key<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">SocketChannel</span> channel <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>key<span class="token punctuation">.</span><span class="token function">isAcceptable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token class-name">ServerSocketChannel</span> serverChannel <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">ServerSocketChannel</span><span class="token punctuation">)</span> key<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                channel <span class="token operator">=</span> serverChannel<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                channel<span class="token punctuation">.</span><span class="token function">configureBlocking</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                channel<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span>selector<span class="token punctuation">,</span> <span class="token class-name">SelectionKey</span><span class="token punctuation">.</span>OP_READ<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>key<span class="token punctuation">.</span><span class="token function">isReadable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                channel <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">SocketChannel</span><span class="token punctuation">)</span> key<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                buffer<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>channel<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    buffer<span class="token punctuation">.</span><span class="token function">flip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token class-name">CharBuffer</span> charBuffer <span class="token operator">=</span> <span class="token class-name">CharsetHelper</span><span class="token punctuation">.</span><span class="token function">decode</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token class-name">String</span> msg <span class="token operator">=</span> charBuffer<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"收到"</span> <span class="token operator">+</span> channel<span class="token punctuation">.</span><span class="token function">getRemoteAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"的消息："</span> <span class="token operator">+</span> msg<span class="token punctuation">)</span><span class="token punctuation">;</span>                    channel<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token class-name">CharsetHelper</span><span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span><span class="token class-name">CharBuffer</span><span class="token punctuation">.</span><span class="token function">wrap</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>                    channel<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>channel <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                channel<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span></span><span class="token class-name">ByteBuffer</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span></span><span class="token class-name">CharBuffer</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>charset<span class="token punctuation">.</span></span><span class="token class-name">CharacterCodingException</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>charset<span class="token punctuation">.</span></span><span class="token class-name">Charset</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>charset<span class="token punctuation">.</span></span><span class="token class-name">CharsetDecoder</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>charset<span class="token punctuation">.</span></span><span class="token class-name">CharsetEncoder</span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">CharsetHelper</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> UTF_8 <span class="token operator">=</span> <span class="token string">"UTF-8"</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">CharsetEncoder</span> encoder <span class="token operator">=</span> <span class="token class-name">Charset</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span>UTF_8<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">newEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">CharsetDecoder</span> decoder <span class="token operator">=</span> <span class="token class-name">Charset</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span>UTF_8<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">newDecoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">CharsetHelper</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">ByteBuffer</span> <span class="token function">encode</span><span class="token punctuation">(</span><span class="token class-name">CharBuffer</span> in<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">CharacterCodingException</span><span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> encoder<span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">CharBuffer</span> <span class="token function">decode</span><span class="token punctuation">(</span><span class="token class-name">ByteBuffer</span> in<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">CharacterCodingException</span><span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> decoder<span class="token punctuation">.</span><span class="token function">decode</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p>]]></content>
      
      
      <categories>
          
          <category> 教程笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 面试题 </tag>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Java 面试题解析（并发）</title>
      <link href="post/32cf50db.html"/>
      <url>post/32cf50db.html</url>
      
        <content type="html"><![CDATA[<blockquote><h3 id="Thread-类的-sleep-方法和对象的-wait-方法都可以让线程暂停执行，它们有什么区别"><a href="#Thread-类的-sleep-方法和对象的-wait-方法都可以让线程暂停执行，它们有什么区别" class="headerlink" title="Thread 类的 sleep() 方法和对象的 wait() 方法都可以让线程暂停执行，它们有什么区别?"></a><code>Thread</code> 类的 <code>sleep()</code> 方法和对象的 <code>wait()</code> 方法都可以让线程暂停执行，它们有什么区别?</h3></blockquote><p>答：<code>sleep()</code> 方法（休眠）是线程类 <code>Thread</code> 的静态方法，调用此方法会让当前线程暂停执行指定的时间，将执行机会（CPU）让给其他线程，但是对象的锁依然保持，因此休眠时间结束后会自动恢复（线程回到就绪状态，请参考第 66 题中的线程状态转换图）。<code>wait()</code> 是 <code>Object</code> 类的方法，调用对象的 <code>wait()</code> 方法导致当前线程放弃对象的锁（线程暂停执行），进入对象的等待池（wait pool），只有调用对象的 <code>notify()</code> 方法（或 <code>notifyAll()</code> 方法）时才能唤醒等待池中的线程进入等锁池（lock pool），如果线程重新获得对象的锁就可以进入就绪状态。</p><p><strong>补充：</strong>可能不少人对什么是进程，什么是线程还比较模糊，对于为什么需要多线程编程也不是特别理解。简单的说：进程是具有一定独立功能的程序关于某个数据集合上的一次运行活动，是操作系统进行资源分配和调度的一个独立单位；线程是进程的一个实体，是 CPU 调度和分派的基本单位，是比进程更小的能独立运行的基本单位。线程的划分尺度小于进程，这使得多线程程序的并发性高；进程在执行时通常拥有独立的内存单元，而线程之间可以共享内存。使用多线程的编程通常能够带来更好的性能和用户体验，但是多线程的程序对于其他程序是不友好的，因为它可能占用了更多的 CPU 资源。当然，也不是线程越多，程序的性能就越好，因为线程之间的调度和切换也会浪费 CPU 时间。时下很时髦的 Node.js 就采用了单线程异步 I/O 的工作模式。</p><blockquote><h3 id="线程的-sleep-方法和-yield-方法有什么区别？"><a href="#线程的-sleep-方法和-yield-方法有什么区别？" class="headerlink" title="线程的 sleep() 方法和 yield() 方法有什么区别？"></a>线程的 <code>sleep()</code> 方法和 <code>yield()</code> 方法有什么区别？</h3></blockquote><p>答：</p><ol><li><code>sleep()</code> 方法给其他线程运行机会时不考虑线程的优先级，因此会给低优先级的线程以运行的机会；<code>yield()</code> 方法只会给相同优先级或更高优先级的线程以运行的机会；</li><li>线程执行 <code>sleep()</code> 方法后转入阻塞（blocked）状态，而执行 <code>yield()</code> 方法后转入就绪（ready）状态；</li><li><code>sleep()</code> 方法声明抛出 <code>InterruptedException</code>，而 <code>yield()</code> 方法没有声明任何异常；</li><li><code>sleep()</code> 方法比 <code>yield()</code> 方法（跟操作系统 CPU 调度相关）具有更好的可移植性。</li></ol><blockquote><h3 id="当一个线程进入一个对象的-synchronized-方法-A-之后，其它线程是否可进入此对象的-synchronized-方法-B？"><a href="#当一个线程进入一个对象的-synchronized-方法-A-之后，其它线程是否可进入此对象的-synchronized-方法-B？" class="headerlink" title="当一个线程进入一个对象的 synchronized 方法 A 之后，其它线程是否可进入此对象的 synchronized 方法 B？"></a>当一个线程进入一个对象的 <code>synchronized</code> 方法 <code>A</code> 之后，其它线程是否可进入此对象的 <code>synchronized</code> 方法 <code>B</code>？</h3></blockquote><p>答：不能。其它线程只能访问该对象的非同步方法，同步方法则不能进入。因为非静态方法上的 <code>synchronized</code> 修饰符要求执行方法时要获得对象的锁，如果已经进入 <code>A</code> 方法说明对象锁已经被取走，那么试图进入 <code>B</code> 方法的线程就只能在<strong>等锁池</strong>（注意不是等待池哦）中等待对象的锁。</p><blockquote><h3 id="请说出与线程同步以及线程调度相关的方法。"><a href="#请说出与线程同步以及线程调度相关的方法。" class="headerlink" title="请说出与线程同步以及线程调度相关的方法。"></a>请说出与线程同步以及线程调度相关的方法。</h3></blockquote><p>答：</p><ul><li><code>wait()</code>：使一个线程处于等待（阻塞）状态，并且释放所持有的对象的锁；</li><li><code>sleep()</code>：使一个正在运行的线程处于睡眠状态，是一个静态方法，调用此方法要处理 <code>InterruptedException</code> 异常；</li><li><code>notify()</code>：唤醒一个处于等待状态的线程，当然在调用此方法的时候，并不能确切的唤醒某一个等待状态的线程，而是由 JVM 确定唤醒哪个线程，而且<strong>与优先级无关</strong>；</li><li><code>notityAll()</code>：唤醒所有处于等待状态的线程，该方法并不是将对象的锁给所有线程，而是让它们<strong>竞争</strong>，只有获得锁的线程才能进入就绪状态；</li></ul><p><strong>说明：</strong>关于 Java 多线程和并发编程的问题，建议大家看我的另一篇文章<a href="https://blog.csdn.net/jackfrued/article/details/44499227">《关于Java并发编程的总结和思考》</a>。</p><p><strong>补充：</strong>Java 5 通过 <code>Lock</code> 接口提供了显式的锁机制（explicit lock），增强了灵活性以及对线程的协调。<code>Lock</code> 接口中定义了加锁 <code>lock()</code> 和解锁 <code>unlock()</code> 的方法，同时还提供了 <code>newCondition()</code> 方法来产生用于线程之间通信的 <code>Condition</code> 对象；此外，Java 5 还提供了信号量机制（semaphore），信号量可以用来限制对某个共享资源进行访问的线程的数量。在对资源进行访问之前，线程必须得到信号量的许可（调用 <code>Semaphore</code> 对象的 <code>acquire()</code> 方法）；在完成对资源的访问后，线程必须向信号量归还许可（调用 <code>Semaphore</code> 对象的 <code>release()</code> 方法）。</p><p>下面的例子演示了 100 个线程同时向一个银行账户中存入 1 元钱，在没有使用同步机制和使用同步机制情况下的执行情况。</p><p>银行账户类：</p><p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/** * 银行账户 */</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Account</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token keyword">double</span> balance<span class="token punctuation">;</span>       <span class="token comment">// 账户余额</span>    <span class="token comment">/**     * 存款     * @param money 存入金额     */</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">deposit</span><span class="token punctuation">(</span><span class="token keyword">double</span> money<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">double</span> newBalance <span class="token operator">=</span> balance <span class="token operator">+</span> money<span class="token punctuation">;</span>        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>            <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment">// 模拟此业务需要一段处理时间</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> ex<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            ex<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        balance <span class="token operator">=</span> newBalance<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">/**     * 获得账户余额     */</span>    <span class="token keyword">public</span> <span class="token keyword">double</span> <span class="token function">getBalance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> balance<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/** * 存钱线程类 */</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AddMoneyThread</span> <span class="token keyword">implements</span> <span class="token class-name">Runnable</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token class-name">Account</span> account<span class="token punctuation">;</span>    <span class="token comment">// 存入账户</span>    <span class="token keyword">private</span> <span class="token keyword">double</span> money<span class="token punctuation">;</span>       <span class="token comment">// 存入金额</span>    <span class="token keyword">public</span> <span class="token class-name">AddMoneyThread</span><span class="token punctuation">(</span><span class="token class-name">Account</span> account<span class="token punctuation">,</span> <span class="token keyword">double</span> money<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>account <span class="token operator">=</span> account<span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>money <span class="token operator">=</span> money<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        account<span class="token punctuation">.</span><span class="token function">deposit</span><span class="token punctuation">(</span>money<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// 调用存款方法</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">ExecutorService</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">Executors</span><span class="token punctuation">;</span><span class="token comment">/** * 测试类 */</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Test01</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">Account</span> account <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Account</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">ExecutorService</span> service <span class="token operator">=</span> <span class="token class-name">Executors</span><span class="token punctuation">.</span><span class="token function">newFixedThreadPool</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">100</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            service<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">AddMoneyThread</span><span class="token punctuation">(</span>account<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>                service<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">!</span>service<span class="token punctuation">.</span><span class="token function">isTerminated</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"账户余额: "</span> <span class="token operator">+</span> account<span class="token punctuation">.</span><span class="token function">getBalance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p>在没有同步的情况下，执行结果通常是显示账户余额在 10 元以下，出现这种状况的原因是，当一个线程 A 试图存入 1 元的时候，另外一个线程 B 也能够进入存款的方法中，线程 B 读取到的账户余额仍然是线程 A 存入 1 元钱之前的账户余额，因此也是在原来的余额 0 上面做了加 1 元的操作，同理线程 C 也会做类似的事情，所以最后 100 个线程执行结束时，本来期望账户余额为 100 元，但实际得到的通常在 10 元以下（很可能是 1 元哦）。解决这个问题的办法就是同步，当一个线程对银行账户存钱时，需要将此账户锁定，待其操作完成后才允许其他的线程进行操作，代码有如下几种调整方案：</p><ol><li><p>在银行账户的存款（<code>deposit</code>）方法上同步（<code>synchronized</code>）关键字</p><p> <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/*** 银行账户*/</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Account</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token keyword">double</span> balance<span class="token punctuation">;</span>     <span class="token comment">// 账户余额</span>    <span class="token comment">/**    * 存款    * @param money 存入金额    */</span>    <span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">deposit</span><span class="token punctuation">(</span><span class="token keyword">double</span> money<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token comment">// 加上同步（synchronized）关键字</span>        <span class="token keyword">double</span> newBalance <span class="token operator">=</span> balance <span class="token operator">+</span> money<span class="token punctuation">;</span>        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>            <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// 模拟此业务需要一段处理时间</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> ex<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            ex<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        balance <span class="token operator">=</span> newBalance<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">/**    * 获得账户余额    */</span>    <span class="token keyword">public</span> <span class="token keyword">double</span> <span class="token function">getBalance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> balance<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p></li><li><p>在线程调用存款方法时对银行账户进行同步</p><p> <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/*** 存钱线程*/</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AddMoneyThread</span> <span class="token keyword">implements</span> <span class="token class-name">Runnable</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token class-name">Account</span> account<span class="token punctuation">;</span>    <span class="token comment">// 存入账户</span>    <span class="token keyword">private</span> <span class="token keyword">double</span> money<span class="token punctuation">;</span>       <span class="token comment">// 存入金额</span>    <span class="token keyword">public</span> <span class="token class-name">AddMoneyThread</span><span class="token punctuation">(</span><span class="token class-name">Account</span> account<span class="token punctuation">,</span> <span class="token keyword">double</span> money<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>account <span class="token operator">=</span> account<span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>money <span class="token operator">=</span> money<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>account<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token comment">// 加上同步（synchronized）关键字</span>            account<span class="token punctuation">.</span><span class="token function">deposit</span><span class="token punctuation">(</span>money<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p></li><li><p>通过 Java 5 显示的锁机制，为每个银行账户创建一个锁对象，在存款操作进行加锁和解锁的操作</p><p> <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span>locks<span class="token punctuation">.</span></span><span class="token class-name">Lock</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span>locks<span class="token punctuation">.</span></span><span class="token class-name">ReentrantLock</span><span class="token punctuation">;</span><span class="token comment">/*** 银行账户*/</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Account</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token class-name">Lock</span> accountLock <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ReentrantLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token keyword">double</span> balance<span class="token punctuation">;</span> <span class="token comment">// 账户余额</span>    <span class="token comment">/**    * 存入金额    * @param money    */</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">deposit</span><span class="token punctuation">(</span><span class="token keyword">double</span> money<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        accountLock<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 加锁</span>        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">double</span> newBalance <span class="token operator">=</span> balance <span class="token operator">+</span> money<span class="token punctuation">;</span>            <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>                <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 模拟此业务需要一段处理时间</span>            <span class="token punctuation">&#125;</span>            <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> ex<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                ex<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>            balance <span class="token operator">=</span> newBalance<span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">finally</span> <span class="token punctuation">&#123;</span>            accountLock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 解锁</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">/**    * 获得账户余额    */</span>    <span class="token keyword">public</span> <span class="token keyword">double</span> <span class="token function">getBalance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> balance<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p>按照上述三种方式对代码进行修改后，重写执行测试代码 Test01，将看到最终的账户余额为 100 元。当然也可以使用 <code>Semaphore</code> 或 <code>CountdownLatch</code> 来实现同步。</p></li></ol><blockquote><h3 id="编写多线程程序有几种实现方式？"><a href="#编写多线程程序有几种实现方式？" class="headerlink" title="编写多线程程序有几种实现方式？"></a>编写多线程程序有几种实现方式？</h3></blockquote><p>答：Java 5 以前实现多线程有两种实现方法：一种是继承 <code>Thread</code> 类；另一种是实现 <code>Runnable</code> 接口。两种方式都要通过重写 <code>run()</code> 方法来定义线程的行为，推荐使用后者，因为 Java 中的继承是单继承，一个类有一个父类，如果继承了 <code>Thread</code> 类就无法再继承其他类了，显然使用 <code>Runnable</code> 接口更为灵活。</p><p><strong>补充：</strong>Java 5 以后创建线程还有第三种方式：实现 <code>Callable</code> 接口，该接口中的 <code>call</code> 方法可以在线程执行结束时产生一个返回值，代码如下所示：</p><p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">ArrayList</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">Callable</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">ExecutorService</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">Executors</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">Future</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">MyTask</span> <span class="token keyword">implements</span> <span class="token class-name">Callable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">></span></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token keyword">int</span> upperBounds<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token class-name">MyTask</span><span class="token punctuation">(</span><span class="token keyword">int</span> upperBounds<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>upperBounds <span class="token operator">=</span> upperBounds<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token class-name">Integer</span> <span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">int</span> sum <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>         <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> upperBounds<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            sum <span class="token operator">+=</span> i<span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">return</span> sum<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name">Test</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Future</span><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">></span><span class="token punctuation">></span></span> list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">ExecutorService</span> service <span class="token operator">=</span> <span class="token class-name">Executors</span><span class="token punctuation">.</span><span class="token function">newFixedThreadPool</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>service<span class="token punctuation">.</span><span class="token function">submit</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MyTask</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">int</span> sum <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token class-name">Future</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">></span></span> future <span class="token operator">:</span> list<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token comment">// while(!future.isDone()) ;</span>            sum <span class="token operator">+=</span> future<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>sum<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><blockquote><h3 id="synchronized-关键字的用法？"><a href="#synchronized-关键字的用法？" class="headerlink" title="synchronized 关键字的用法？"></a><code>synchronized</code> 关键字的用法？</h3></blockquote><p>答：<code>synchronized</code> 关键字可以将对象或者方法标记为<strong>同步</strong>，以实现对对象和方法的互斥访问，可以用 <code>synchronized(对象) &#123; … &#125;</code> 定义同步代码块，或者在声明方法时将 <code>synchronized</code> 作为方法的修饰符。在第 60 题的例子中已经展示了 <code>synchronized</code> 关键字的用法。</p><blockquote><h3 id="举例说明同步和异步。"><a href="#举例说明同步和异步。" class="headerlink" title="举例说明同步和异步。"></a>举例说明同步和异步。</h3></blockquote><p>答：如果系统中存在临界资源（资源数量少于竞争资源的线程数量的资源），例如正在写的数据以后可能被另一个线程读到，或者正在读的数据可能已经被另一个线程写过了，那么这些数据就必须进行同步存取（数据库操作中的排他锁就是最好的例子）。当应用程序在对象上调用了一个需要花费很长时间来执行的方法，并且不希望让程序等待方法的返回时，就应该使用异步编程，在很多情况下采用异步途径往往更有效率。事实上，所谓的同步就是指<strong>阻塞式操作</strong>，而异步就是<strong>非阻塞式操作</strong>。</p><blockquote><h3 id="启动一个线程是调用-run-还是-start-方法？"><a href="#启动一个线程是调用-run-还是-start-方法？" class="headerlink" title="启动一个线程是调用 run() 还是 start() 方法？"></a>启动一个线程是调用 <code>run()</code> 还是 <code>start()</code> 方法？</h3></blockquote><p>答：启动一个线程是调用 <code>start()</code> 方法，使线程所代表的虚拟处理机处于可运行状态，这意味着它可以由 JVM 调度并执行，这并不意味着线程就会立即运行。<code>run()</code> 方法是线程启动后要进行回调（callback）的方法。</p><blockquote><h3 id="什么是线程池（thread-pool）？"><a href="#什么是线程池（thread-pool）？" class="headerlink" title="什么是线程池（thread pool）？"></a>什么是线程池（thread pool）？</h3></blockquote><p>答：在面向对象编程中，创建和销毁对象是很费时间的，因为创建一个对象要获取内存资源或者其它更多资源。在 Java 中更是如此，虚拟机将试图跟踪每一个对象，以便能够在对象销毁后进行垃圾回收。所以提高服务程序效率的一个手段就是尽可能减少创建和销毁对象的次数，特别是一些很耗资源的对象创建和销毁，这就是“池化资源”技术产生的原因。线程池顾名思义就是事先创建若干个可执行的线程放入一个池（容器）中，需要的时候从池中获取线程不用自行创建，使用完毕不需要销毁线程而是放回池中，从而减少创建和销毁线程对象的开销。</p><p>Java 5+ 中的 <code>Executor</code> 接口定义一个执行线程的工具。它的子类型即线程池接口是 <code>ExecutorService</code>。要配置一个线程池是比较复杂的，尤其是对于线程池的原理不是很清楚的情况下，因此在工具类 <code>Executors</code> 里面提供了一些静态工厂方法，生成一些常用的线程池，如下所示：</p><ul><li><code>newSingleThreadExecutor</code>：创建一个单线程的线程池。这个线程池只有一个线程在工作，也就是相当于单线程串行执行所有任务。如果这个唯一的线程因为异常结束，那么会有一个新的线程来替代它。此线程池保证所有任务的执行顺序按照任务的提交顺序执行。</li><li><code>newFixedThreadPool</code>：创建固定大小的线程池。每次提交一个任务就创建一个线程，直到线程达到线程池的最大大小。线程池的大小一旦达到最大值就会保持不变，如果某个线程因为执行异常而结束，那么线程池会补充一个新线程。</li><li><code>newCachedThreadPool</code>：创建一个可缓存的线程池。如果线程池的大小超过了处理任务所需要的线程，那么就会回收部分空闲（60 秒不执行任务）的线程，当任务数增加时，此线程池又可以智能的添加新线程来处理任务。此线程池不会对线程池大小做限制，线程池大小完全依赖于操作系统（或者说 JVM）能够创建的最大线程大小。</li><li><code>newScheduledThreadPool</code>：创建一个大小无限的线程池。此线程池支持定时以及周期性执行任务的需求。</li><li><code>newSingleThreadScheduledExecutor</code>：创建一个单线程的线程池。此线程池支持定时以及周期性执行任务的需求。</li></ul><p>第 60 题的例子中演示了通过 <code>Executors</code> 工具类创建线程池并使用线程池执行线程的代码。如果希望在服务器上使用线程池，强烈建议使用 <code>newFixedThreadPool</code> 方法来创建线程池，这样能获得更好的性能。</p><blockquote><h3 id="线程的基本状态以及状态之间的关系？"><a href="#线程的基本状态以及状态之间的关系？" class="headerlink" title="线程的基本状态以及状态之间的关系？"></a>线程的基本状态以及状态之间的关系？</h3></blockquote><p>答：</p><p><img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="/images/post/java_interview/66.png" alt></p><p><strong>说明：</strong>其中 <code>Running</code> 表示运行状态，<code>Runnable</code> 表示就绪状态（万事俱备，只欠 CPU），<code>Blocked</code> 表示阻塞状态，阻塞状态又有多种情况，可能是因为调用 <code>wait()</code> 方法进入等待池，也可能是执行同步方法或同步代码块进入等锁池，或者是调用了 <code>sleep()</code> 方法或 <code>join()</code> 方法等待休眠或其他线程结束，或是因为发生了 I/O 中断。</p><blockquote><h3 id="简述-synchronized-和-java-util-concurrent-locks-Lock-的异同？"><a href="#简述-synchronized-和-java-util-concurrent-locks-Lock-的异同？" class="headerlink" title="简述 synchronized 和 java.util.concurrent.locks.Lock 的异同？"></a>简述 <code>synchronized</code> 和 <code>java.util.concurrent.locks.Lock</code> 的异同？</h3></blockquote><p>答：<code>Lock</code> 是 Java 5 以后引入的新的 API，和关键字 <code>synchronized</code> 相比主要相同点：<code>Lock</code> 能完成 <code>synchronized</code> 所实现的所有功能；主要不同点：<code>Lock</code> 有比 <code>synchronized</code> 更精确的线程语义和更好的性能，而且不强制性的要求一定要获得锁。<code>synchronized</code> 会自动释放锁，而 <code>Lock</code> 一定要求程序员手工释放，并且最好在 <code>finally</code> 块中释放（这是释放外部资源的最好的地方）。</p>]]></content>
      
      
      <categories>
          
          <category> 教程笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 面试题 </tag>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Java 面试题解析（容器）</title>
      <link href="post/d07acd09.html"/>
      <url>post/d07acd09.html</url>
      
        <content type="html"><![CDATA[<blockquote><h3 id="List、Set、Map-是否继承自-Collection-接口？"><a href="#List、Set、Map-是否继承自-Collection-接口？" class="headerlink" title="List、Set、Map 是否继承自 Collection 接口？"></a><code>List</code>、<code>Set</code>、<code>Map</code> 是否继承自 <code>Collection</code> 接口？</h3></blockquote><p>答：<code>List</code>、<code>Set</code> 是，<code>Map</code> 不是。<code>Map</code> 是键值对映射容器，与 <code>List</code> 和 <code>Set</code> 有明显的区别，而 <code>Set</code> 存储的零散的元素且不允许有重复元素（数学中的集合也是如此），<code>List</code> 是线性结构的容器，适用于按数值索引访问元素的情形。</p><blockquote><h3 id="阐述-ArrayList、Vector、LinkedList-的存储性能和特性。"><a href="#阐述-ArrayList、Vector、LinkedList-的存储性能和特性。" class="headerlink" title="阐述 ArrayList、Vector、LinkedList 的存储性能和特性。"></a>阐述 <code>ArrayList</code>、<code>Vector</code>、<code>LinkedList</code> 的存储性能和特性。</h3></blockquote><p>答：</p><ul><li><p><code>ArrayList</code> 和 <code>Vector</code> 都是使用<strong>数组方式</strong>存储数据，此数组元素数大于实际存储的数据以便增加和插入元素，它们都允许直接按序号索引元素，但是插入元素要涉及数组元素移动等内存操作，所以索引数据快而插入数据慢，<code>Vector</code> 中的方法由于添加了 <code>synchronized</code> 修饰，因此 <code>Vector</code> 是<strong>线程安全</strong>的容器，但性能上较 <code>ArrayList</code> 差，因此已经是 Java 中的遗留容器。</p></li><li><p><code>LinkedList</code> 使用<strong>双向链表</strong>实现存储（将内存中零散的内存单元通过附加的引用关联起来，形成一个可以按序号索引的线性结构，这种链式存储方式与数组的连续存储方式相比，内存的利用率更高），按序号索引数据需要进行前向或后向遍历，但是插入数据时只需要记录本项的前后项即可，所以插入速度较快。</p></li><li><p><code>Vector</code> 属于遗留容器（Java 早期的版本中提供的容器，除此之外，<code>Hashtable</code>、<code>Dictionary</code>、<code>BitSet</code>、<code>Stack</code>、<code>Properties</code> 都是遗留容器），已经不推荐使用，但是由于 <code>ArrayList</code> 和 <code>LinkedListed</code> 都是<strong>非线程安全</strong>的，如果遇到多个线程操作同一个容器的场景，则可以通过工具类 <code>Collections</code> 中的 <code>synchronizedList</code> 方法将其转换成线程安全的容器后再使用（这是对装潢模式的应用，将已有对象传入另一个类的构造器中创建新的对象来增强实现）。</p></li></ul><p><strong>补充：</strong>遗留容器中的 <code>Properties</code> 类和 <code>Stack</code> 类在设计上有严重的问题，<code>Properties</code> 是一个键和值都是字符串的特殊的键值对映射，在设计上应该是关联一个 <code>Hashtable</code> 并将其两个泛型参数设置为 <code>String</code> 类型，但是 Java API 中的 <code>Properties</code> 直接继承了 <code>Hashtable</code>，这很明显是对继承的滥用。这里复用代码的方式应该是 Has-A 关系而不是 Is-A 关系，另一方面容器都属于工具类，继承工具类本身就是一个错误的做法，使用工具类最好的方式是 Has-A 关系（关联）或 Use-A 关系（依赖）。同理，<code>Stack</code> 类继承 <code>Vector</code> 也是不正确的。Sun 公司的工程师们也会犯这种低级错误，让人唏嘘不已。</p><blockquote><h3 id="Collection-和-Collections-的区别？"><a href="#Collection-和-Collections-的区别？" class="headerlink" title="Collection 和 Collections 的区别？"></a><code>Collection</code> 和 <code>Collections</code> 的区别？</h3></blockquote><p>答：<code>Collection</code> 是一个接口，它是 <code>Set</code>、<code>List</code> 等容器的父接口；<code>Collections</code> 是个一个工具类，提供了一系列的静态方法来辅助容器操作，这些方法包括对容器的搜索、排序、线程安全化等等。</p><blockquote><h3 id="List、Map、Set-三个接口存取元素时，各有什么特点？"><a href="#List、Map、Set-三个接口存取元素时，各有什么特点？" class="headerlink" title="List、Map、Set 三个接口存取元素时，各有什么特点？"></a><code>List</code>、<code>Map</code>、<code>Set</code> 三个接口存取元素时，各有什么特点？</h3></blockquote><p>答：<code>List</code> 以特定索引来存取元素，可以有重复元素。<code>Set</code> 不能存放重复元素（用对象的 <code>equals()</code> 方法来区分元素是否重复）。<code>Map</code> 保存键值对（key-value pair）映射，映射关系可以是一对一或多对一。<code>Set</code> 和 <code>Map</code> 容器都有基于哈希存储和排序树的两种实现版本，基于哈希存储的版本理论存取时间复杂度为 <code>O(1)</code>，而基于排序树版本的实现在插入或删除元素时会按照元素或元素的键（key）构成排序树从而达到排序和去重的效果。</p><blockquote><h3 id="TreeMap-和-TreeSet-在排序时如何比较元素？Collections工具类中的sort-方法如何比较元素？"><a href="#TreeMap-和-TreeSet-在排序时如何比较元素？Collections工具类中的sort-方法如何比较元素？" class="headerlink" title="TreeMap 和 TreeSet 在排序时如何比较元素？Collections工具类中的sort()方法如何比较元素？"></a><code>TreeMap</code> 和 <code>TreeSet</code> 在排序时如何比较元素？<code>Collections</code>工具类中的<code>sort()</code>方法如何比较元素？</h3></blockquote><p>答：<code>TreeSet</code> 要求存放的对象所属的类必须实现 <code>Comparable</code> 接口，该接口提供了比较元素的 <code>compareTo()</code> 方法，当插入元素时会回调该方法比较元素的大小。<code>TreeMap</code> 要求存放的键值对映射的键必须实现 <code>Comparable</code> 接口从而根据键对元素进行排序。<code>Collections</code> 工具类的 <code>sort()</code> 方法有两种重载的形式，第一种要求传入的待排序容器中存放的对象比较实现 <code>Comparable</code> 接口以实现元素的比较；第二种不强制性的要求容器中的元素必须可比较，但是要求传入第二个参数，参数是 <code>Comparator</code> 接口的子类型（需要重写 <code>compare</code> 方法实现元素的比较），相当于一个临时定义的排序规则，其实就是通过接口注入比较元素大小的算法，也是对回调模式的应用（Java 中对函数式编程的支持）。例子1：</p><p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Student</span> <span class="token keyword">implements</span> <span class="token class-name">Comparable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Student</span><span class="token punctuation">></span></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>        <span class="token comment">// 姓名</span>    <span class="token keyword">private</span> <span class="token keyword">int</span> age<span class="token punctuation">;</span>            <span class="token comment">// 年龄</span>    <span class="token keyword">public</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token keyword">int</span> age<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>age <span class="token operator">=</span> age<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token string">"Student [name="</span> <span class="token operator">+</span> name <span class="token operator">+</span> <span class="token string">", age="</span> <span class="token operator">+</span> age <span class="token operator">+</span> <span class="token string">"]"</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">compareTo</span><span class="token punctuation">(</span><span class="token class-name">Student</span> o<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>age <span class="token operator">-</span> o<span class="token punctuation">.</span>age<span class="token punctuation">;</span> <span class="token comment">// 比较年龄(年龄的升序)</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Set</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">TreeSet</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">Test01</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Student</span><span class="token punctuation">></span></span> set <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TreeSet</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment">// Java 7 的钻石语法(构造器后面的尖括号中不需要写类型)</span>        set<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token string">"Hao LUO"</span><span class="token punctuation">,</span> <span class="token number">33</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        set<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token string">"XJ WANG"</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        set<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token string">"Bruce LEE"</span><span class="token punctuation">,</span> <span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        set<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token string">"Bob YANG"</span><span class="token punctuation">,</span> <span class="token number">22</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token class-name">Student</span> stu <span class="token operator">:</span> set<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>stu<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span><span class="token comment">//      输出结果：</span><span class="token comment">//      Student [name=Bob YANG, age=22]</span><span class="token comment">//      Student [name=XJ WANG, age=32]</span><span class="token comment">//      Student [name=Hao LUO, age=33]</span><span class="token comment">//      Student [name=Bruce LEE, age=60]</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p>例子2：</p><p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Student</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>    <span class="token comment">// 姓名</span>    <span class="token keyword">private</span> <span class="token keyword">int</span> age<span class="token punctuation">;</span>        <span class="token comment">// 年龄</span>    <span class="token keyword">public</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token keyword">int</span> age<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>age <span class="token operator">=</span> age<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">/**     * 获取学生姓名     */</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> name<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">/**     * 获取学生年龄     */</span>    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getAge</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> age<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token string">"Student [name="</span> <span class="token operator">+</span> name <span class="token operator">+</span> <span class="token string">", age="</span> <span class="token operator">+</span> age <span class="token operator">+</span> <span class="token string">"]"</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">ArrayList</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Collections</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Comparator</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">Test02</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Student</span><span class="token punctuation">></span></span> list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment">// Java 7的钻石语法(构造器后面的尖括号中不需要写类型)</span>        list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token string">"Hao LUO"</span><span class="token punctuation">,</span> <span class="token number">33</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token string">"XJ WANG"</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token string">"Bruce LEE"</span><span class="token punctuation">,</span> <span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token string">"Bob YANG"</span><span class="token punctuation">,</span> <span class="token number">22</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// 通过 sort 方法的第二个参数传入一个 Comparator 接口对象</span>        <span class="token comment">// 相当于是传入一个比较对象大小的算法到 sort 方法中</span>        <span class="token comment">// 由于 Java 中没有函数指针、仿函数、委托这样的概念</span>        <span class="token comment">// 因此要将一个算法传入一个方法中唯一的选择就是通过接口回调</span>        <span class="token class-name">Collections</span><span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span>list<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Comparator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Student</span><span class="token punctuation">></span></span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token annotation punctuation">@Override</span>            <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">compare</span><span class="token punctuation">(</span><span class="token class-name">Student</span> o1<span class="token punctuation">,</span> <span class="token class-name">Student</span> o2<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token keyword">return</span> o1<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">compareTo</span><span class="token punctuation">(</span>o2<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// 比较学生姓名</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token class-name">Student</span> stu <span class="token operator">:</span> list<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>stu<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span><span class="token comment">//      输出结果: </span><span class="token comment">//      Student [name=Bob YANG, age=22]</span><span class="token comment">//      Student [name=Bruce LEE, age=60]</span><span class="token comment">//      Student [name=Hao LUO, age=33]</span><span class="token comment">//      Student [name=XJ WANG, age=32]</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p>]]></content>
      
      
      <categories>
          
          <category> 教程笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 面试题 </tag>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Java 面试题解析（基础）</title>
      <link href="post/11ea51ea.html"/>
      <url>post/11ea51ea.html</url>
      
        <content type="html"><![CDATA[<blockquote><h3 id="面向对象的特征有哪些方面？"><a href="#面向对象的特征有哪些方面？" class="headerlink" title="面向对象的特征有哪些方面？"></a>面向对象的特征有哪些方面？</h3></blockquote><p>答：面向对象的特征主要有以下几个方面：</p><ul><li><p>抽象：抽象是将一类对象的共同特征总结出来构造类的过程，包括<strong>数据抽象</strong>和<strong>行为抽象</strong>两方面。抽象只关注对象有哪些属性和行为，并不关注这些行为的细节是什么。</p></li><li><p>继承：继承是从已有类得到继承信息创建新类的过程。提供继承信息的类被称为父类（超类、基类）；得到继承信息的类被称为子类（派生类）。继承让变化中的软件系统有了一定的延续性，同时继承也是封装程序中可变因素的重要手段。</p></li><li><p>封装：通常认为封装是把数据和操作数据的方法绑定起来，对数据的访问只能通过已定义的接口。面向对象的本质就是将现实世界描绘成一系列完全自治、封闭的对象。我们在类中编写的方法就是对实现细节的一种封装；我们编写一个类就是对数据和数据操作的封装。可以说，封装就是隐藏一切可隐藏的东西，只向外界提供最简单的编程接口（可以想想普通洗衣机和全自动洗衣机的差别，明显全自动洗衣机封装更好因此操作起来更简单；我们现在使用的智能手机也是封装得足够好的，因为几个按键就搞定了所有的事情）。</p></li><li><p>多态性：多态性是指允许不同子类型的对象对同一消息作出不同的响应。简单的说就是用同样的对象引用调用同样的方法但是做了不同的事情。多态性分为<strong>编译时的多态性</strong>和<strong>运行时的多态性</strong>。如果将对象的方法视为对象向外界提供的服务，那么运行时的多态性可以解释为：当 A 系统访问 B 系统提供的服务时，B 系统有多种提供服务的方式，但一切对 A 系统来说都是透明的（就像电动剃须刀是 A 系统，它的供电系统是 B 系统，B 系统可以使用电池供电或者用交流电，甚至还有可能是太阳能，A 系统只会通过 B 类对象调用供电的方法，但并不知道供电系统的底层实现是什么，究竟通过何种方式获得了动力）。</p><ul><li><strong>方法重载</strong>（<code>overload</code>）实现的是编译时的多态性（也称为前绑定），而<strong>方法重写</strong>（<code>override</code>）实现的是运行时的多态性（也称为后绑定）。</li><li>运行时的多态是面向对象最精髓的东西，要实现多态需要做两件事：<ol><li>方法重写（子类继承父类并重写父类中已有的或抽象的方法）；</li><li>对象造型（用父类型引用引用子类型对象，这样同样的引用调用同样的方法就会根据子类对象的不同而表现出不同的行为）。</li></ol></li></ul></li></ul><blockquote><h3 id="访问修饰符-public、private、protected、以及不写（默认）时的区别？"><a href="#访问修饰符-public、private、protected、以及不写（默认）时的区别？" class="headerlink" title="访问修饰符 public、private、protected、以及不写（默认）时的区别？"></a>访问修饰符 <code>public</code>、<code>private</code>、<code>protected</code>、以及不写（默认）时的区别？</h3></blockquote><p>答：</p><div class="table-container"><table><thead><tr><th>修饰符</th><th>当前类</th><th>同包</th><th>子类</th><th>其他包</th></tr></thead><tbody><tr><td>public</td><td>√</td><td>√</td><td>√</td><td>√</td></tr><tr><td>protected</td><td>√</td><td>√</td><td>√</td><td>×</td></tr><tr><td>default</td><td>√</td><td>√</td><td>×</td><td>×</td></tr><tr><td>private</td><td>√</td><td>×</td><td>×</td><td>×</td></tr></tbody></table></div><p>类的成员不写访问修饰时默认为 <code>default</code>。默认对于同一个包中的其他类相当于公开（<code>public</code>），对于不是同一个包中的其他类相当于私有（<code>private</code>）。受保护（<code>protected</code>）对子类相当于公开，对不是同一包中的没有父子关系的类相当于私有。Java 中，外部类的修饰符只能是 <code>public</code> 或默认，类的成员（包括内部类）的修饰符可以是以上四种。</p><blockquote><h3 id="String-是最基本的数据类型吗？"><a href="#String-是最基本的数据类型吗？" class="headerlink" title="String 是最基本的数据类型吗？"></a><code>String</code> 是最基本的数据类型吗？</h3></blockquote><p>答：不是。Java 中的基本数据类型只有 8 个：<code>byte</code>、<code>short</code>、<code>int</code>、<code>long</code>、<code>float</code>、<code>double</code>、<code>char</code>、<code>boolean</code>；除了基本类型（primitive type），剩下的都是引用类型（reference type），Java 5 以后引入的枚举类型（enum）也算是一种比较特殊的引用类型。</p><blockquote><h3 id="float-f-3-4-是否正确？"><a href="#float-f-3-4-是否正确？" class="headerlink" title="float f = 3.4; 是否正确？"></a><code>float f = 3.4;</code> 是否正确？</h3></blockquote><p>答：不正确。3.4 是双精度数，将双精度型（<code>double</code>）赋值给浮点型（<code>float</code>）属于<strong>下转型</strong>（down-casting，也称为窄化）会造成<strong>精度损失</strong>，因此需要<strong>强制类型转换</strong> <code>float f = (float)3.4;</code> 或者写成 <code>float f = 3.4F</code>;。</p><blockquote><h3 id="short-s1-1-s1-s1-1-有错吗？short-s1-1-s1-1-有错吗？"><a href="#short-s1-1-s1-s1-1-有错吗？short-s1-1-s1-1-有错吗？" class="headerlink" title="short s1 = 1; s1 = s1 + 1; 有错吗？short s1 = 1; s1 += 1; 有错吗？"></a><code>short s1 = 1; s1 = s1 + 1;</code> 有错吗？<code>short s1 = 1; s1 += 1;</code> 有错吗？</h3></blockquote><p>答：对于 <code>short s1 = 1; s1 = s1 + 1;</code> 由于 1 是 <code>int</code> 类型，因此 <code>s1 + 1</code> 运算结果也是 <code>int</code> 型，需要强制转换类型才能赋值给 <code>short</code> 型。而 <code>short s1 = 1; s1 += 1;</code> 可以正确编译，因为 <code>s1 += 1;</code> 相当于 <code>s1 = (short)(s1 + 1);</code> 其中有隐含的强制类型转换。</p><blockquote><h3 id="Java-有没有-goto？"><a href="#Java-有没有-goto？" class="headerlink" title="Java 有没有 goto？"></a>Java 有没有 <code>goto</code>？</h3></blockquote><p>答：<code>goto</code> 是 Java 中的<strong>保留字</strong>，在目前版本的 Java 中没有使用。（根据James Gosling（Java之父）编写的《The Java Programming Language》一书的附录中给出了一个 Java 关键字列表，其中有 <code>goto</code> 和 <code>const</code>，但是这两个是目前无法使用的关键字，因此有些地方将其称之为保留字，其实保留字这个词应该有更广泛的意义，因为熟悉 C 语言的程序员都知道，在系统类库中使用过的有特殊意义的单词或单词的组合都被视为保留字）。</p><blockquote><h3 id="int-和-Integer-有什么区别？"><a href="#int-和-Integer-有什么区别？" class="headerlink" title="int 和 Integer 有什么区别？"></a><code>int</code> 和 <code>Integer</code> 有什么区别？</h3></blockquote><p>答：Java 是一个近乎纯洁的面向对象编程语言，但是为了编程的方便还是引入了基本数据类型，但是为了能够将这些基本数据类型当成对象操作，Java 为每一个基本数据类型都引入了对应的包装类型（wrapper class），<code>int</code> 的包装类就是 <code>Integer</code>，从 Java 5 开始引入了<strong>自动装箱 / 拆箱</strong>机制，使得二者可以相互转换。</p><p>Java 为每个原始类型提供了包装类型：</p><ul><li>原始类型：<code>boolean</code>，<code>char</code>，<code>byte</code>，<code>short</code>，<code>int</code>，<code>long</code>，<code>float</code>，<code>double</code>。</li><li>包装类型：<code>Boolean</code>，<code>Character</code>，<code>Byte</code>，<code>Short</code>，<code>Integer</code>，<code>Long</code>，<code>Float</code>，<code>Double</code>。</li></ul><p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">class</span> <span class="token class-name">AutoUnboxingTest</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">Integer</span> a <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Integer</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Integer</span> b <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>                  <span class="token comment">// 将 3 自动装箱成Integer类型</span>        <span class="token keyword">int</span> c <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>a <span class="token operator">==</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment">// false 两个引用没有引用同一对象</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>a <span class="token operator">==</span> c<span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment">// true a 自动拆箱成 int 类型再和 c 比较</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p>最近还遇到一个面试题，也是和自动装箱和拆箱有点关系的，代码如下所示：</p><p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Test</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">// 整型字面量的值在 -128 到 127 之间直接引用常量池中的 Integer 对象，否则 new 新的 Integer 对象</span>        <span class="token class-name">Integer</span> f1 <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">,</span> f2 <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">,</span> f3 <span class="token operator">=</span> <span class="token number">150</span><span class="token punctuation">,</span> f4 <span class="token operator">=</span> <span class="token number">150</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>f1 <span class="token operator">==</span> f2<span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment">// true 直接引用常量池中的 Integer 对象</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>f3 <span class="token operator">==</span> f4<span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment">// false 两个引用没有引用同一对象</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p>如果不明就里很容易认为两个输出要么都是 <code>true</code> 要么都是 <code>false</code>。首先需要注意的是 <code>f1</code>、<code>f2</code>、<code>f3</code>、<code>f4</code> 四个变量都是 <code>Integer</code> 对象引用，所以下面的 <code>==</code> 运算比较的不是值而是引用。装箱的本质是什么呢？当我们给一个 <code>Integer</code> 对象赋一个 <code>int</code> 值的时候，会调用 <code>Integer</code> 类的静态方法 <code>valueOf</code>，如果看看 <code>valueOf</code> 的源代码就知道发生了什么。</p><p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Integer</span> <span class="token function">valueOf</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">>=</span> <span class="token class-name">IntegerCache</span><span class="token punctuation">.</span>low <span class="token operator">&amp;&amp;</span> i <span class="token operator">&lt;=</span> <span class="token class-name">IntegerCache</span><span class="token punctuation">.</span>high<span class="token punctuation">)</span>        <span class="token keyword">return</span> <span class="token class-name">IntegerCache</span><span class="token punctuation">.</span>cache<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token class-name">IntegerCache</span><span class="token punctuation">.</span>low<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Integer</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p><code>IntegerCache</code> 是 <code>Integer</code> 的内部类，其代码如下所示：</p><p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/**  * Cache to support the object identity semantics of autoboxing for values between  * -128 and 127 (inclusive) as required by JLS.  *  * The cache is initialized on first usage.  The size of the cache  * may be controlled by the &#123;@code -XX:AutoBoxCacheMax=&lt;size>&#125; option.  * During VM initialization, java.lang.Integer.IntegerCache.high property  * may be set and saved in the private system properties in the  * sun.misc.VM class.  */</span><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">IntegerCache</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> low <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">128</span><span class="token punctuation">;</span>    <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> high<span class="token punctuation">;</span>    <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Integer</span> cache<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">static</span> <span class="token punctuation">&#123;</span>        <span class="token comment">// high value may be configured by property</span>        <span class="token keyword">int</span> h <span class="token operator">=</span> <span class="token number">127</span><span class="token punctuation">;</span>        <span class="token class-name">String</span> integerCacheHighPropValue <span class="token operator">=</span>            sun<span class="token punctuation">.</span>misc<span class="token punctuation">.</span>VM<span class="token punctuation">.</span><span class="token function">getSavedProperty</span><span class="token punctuation">(</span><span class="token string">"java.lang.Integer.IntegerCache.high"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>integerCacheHighPropValue <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>                <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>integerCacheHighPropValue<span class="token punctuation">)</span><span class="token punctuation">;</span>                i <span class="token operator">=</span> <span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token number">127</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token comment">// Maximum array size is Integer.MAX_VALUE</span>                h <span class="token operator">=</span> <span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span>MAX_VALUE <span class="token operator">-</span> <span class="token punctuation">(</span><span class="token operator">-</span>low<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span><span class="token punctuation">(</span> <span class="token class-name">NumberFormatException</span> nfe<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token comment">// If the property cannot be parsed into an int, ignore it.</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>        high <span class="token operator">=</span> h<span class="token punctuation">;</span>        cache <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Integer</span><span class="token punctuation">[</span><span class="token punctuation">(</span>high <span class="token operator">-</span> low<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token keyword">int</span> j <span class="token operator">=</span> low<span class="token punctuation">;</span>        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> k <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> k <span class="token operator">&lt;</span> cache<span class="token punctuation">.</span>length<span class="token punctuation">;</span> k<span class="token operator">++</span><span class="token punctuation">)</span>            cache<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Integer</span><span class="token punctuation">(</span>j<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// range [-128, 127] must be interned (JLS7 5.1.7)</span>        <span class="token keyword">assert</span> <span class="token class-name">IntegerCache</span><span class="token punctuation">.</span>high <span class="token operator">>=</span> <span class="token number">127</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">private</span> <span class="token class-name">IntegerCache</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p>简单的说，如果整型字面量的值在 <code>-128</code> 到 <code>127</code> 之间，那么不会 <code>new</code> 新的 <code>Integer</code> 对象，而是直接引用常量池中的 <code>Integer</code> 对象，所以上面的面试题中 <code>f1 == f2</code> 的结果是 <code>true</code>，而 <code>f3==f4</code> 的结果是 <code>false</code>。</p><p><strong>注意：</strong>越是貌似简单的面试题其中的玄机就越多，需要面试者有相当深厚的功力。</p><blockquote><h3 id="amp-和-amp-amp-的区别？"><a href="#amp-和-amp-amp-的区别？" class="headerlink" title="&amp; 和 &amp;&amp; 的区别？"></a><code>&amp;</code> 和 <code>&amp;&amp;</code> 的区别？</h3></blockquote><p>答：<code>&amp;</code> 运算符有两种用法：(1)<strong>按位与</strong>；(2)<strong>逻辑与</strong>。<code>&amp;&amp;</code> 运算符是<strong>短路与</strong>运算。逻辑与跟短路与的差别是非常巨大的，虽然二者都要求运算符左右两端的布尔值都是 <code>true</code> 整个表达式的值才是 <code>true</code>。<code>&amp;&amp;</code> 之所以称为短路运算是因为，如果 <code>&amp;&amp;</code> 左边的表达式的值是 <code>false</code>，右边的表达式会被直接短路掉，不会进行运算。很多时候我们可能都需要用 <code>&amp;&amp;</code> 而不是 <code>&amp;</code>，例如在验证用户登录时判定用户名不是 <code>null</code> 而且不是空字符串，应当写为：<code>username != null &amp;&amp;!username.equals(&quot;&quot;)</code>，二者的顺序不能交换，更不能用 <code>&amp;</code> 运算符，因为第一个条件如果不成立，根本不能进行字符串的 <code>equals</code> 比较，否则会产生 <code>NullPointerException</code> 异常。<strong>注意：</strong>逻辑或运算符（<code>|</code>）和短路或运算符（<code>||</code>）的差别也是如此。</p><p><strong>补充：</strong>如果你熟悉 JavaScript，那你可能更能感受到短路运算的强大，想成为 JavaScript 的高手就先从玩转短路运算开始吧。</p><blockquote><h3 id="解释内存中的栈（stack）、堆（heap）和方法区（method-area）的用法。"><a href="#解释内存中的栈（stack）、堆（heap）和方法区（method-area）的用法。" class="headerlink" title="解释内存中的栈（stack）、堆（heap）和方法区（method area）的用法。"></a>解释内存中的栈（stack）、堆（heap）和方法区（method area）的用法。</h3></blockquote><p>答：通常我们定义一个基本数据类型的变量，一个对象的引用，还有就是函数调用的现场保存都使用 JVM 中的栈空间；而通过 <code>new</code> 关键字和构造器创建的对象则放在堆空间，堆是垃圾收集器管理的主要区域，由于现在的垃圾收集器都采用分代收集算法，所以堆空间还可以细分为新生代和老生代，再具体一点可以分为 Eden、Survivor（又可分为 From Survivor 和 To Survivor）、Tenured；方法区和堆都是各个线程共享的内存区域，用于存储已经被 JVM 加载的类信息、常量、静态变量、JIT 编译器编译后的代码等数据；程序中的字面量（literal）如直接书写的 <code>100</code>、<code>&quot;hello&quot;</code> 和常量都是放在常量池中，常量池是方法区的一部分。栈空间操作起来最快但是栈很小，通常大量的对象都是放在堆空间，栈和堆的大小都可以通过 JVM 的启动参数来进行调整，栈空间用光了会引发 <code>StackOverflowError</code>，而堆和常量池空间不足则会引发 <code>OutOfMemoryError</code>。</p><p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">String</span> str <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><p>上面的语句中变量 <code>str</code> 放在栈上，用 <code>new</code> 创建出来的字符串对象放在堆上，而 <code>&quot;hello&quot;</code> 这个字面量是放在方法区的。</p><p><strong>补充1：</strong>较新版本的 Java（从 Java 6 的某个更新开始）中，由于 JIT 编译器的发展和“逃逸分析”技术的逐渐成熟，栈上分配、标量替换等优化技术使得对象一定分配在堆上这件事情已经变得不那么绝对了。</p><p><strong>补充2：</strong>运行时常量池相当于 Class 文件常量池具有动态性，Java 语言并不要求常量一定只有编译期间才能产生，运行期间也可以将新的常量放入池中，<code>String</code> 类的 <code>intern()</code> 方法就是这样的。</p><p>看看下面代码的执行结果是什么并且比较一下 Java 7 以前和以后的运行结果是否一致。</p><p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">String</span> s1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuilder</span><span class="token punctuation">(</span><span class="token string">"go"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"od"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>s1<span class="token punctuation">.</span><span class="token function">intern</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> s1<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">String</span> s2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuilder</span><span class="token punctuation">(</span><span class="token string">"ja"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"va"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>s2<span class="token punctuation">.</span><span class="token function">intern</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> s2<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><blockquote><h3 id="Math-round-11-5-等于多少？Math-round-11-5-等于多少？"><a href="#Math-round-11-5-等于多少？Math-round-11-5-等于多少？" class="headerlink" title="Math.round(11.5) 等于多少？Math.round(-11.5) 等于多少？"></a><code>Math.round(11.5)</code> 等于多少？<code>Math.round(-11.5)</code> 等于多少？</h3></blockquote><p>答：<code>Math.round(11.5)</code> 的返回值是 <code>12</code>，<code>Math.round(-11.5)</code> 的返回值是 <code>-11</code>。四舍五入的原理是在参数上加 <code>0.5</code> 然后进行下取整。</p><blockquote><h3 id="switch-是否能作用在-byte-上，是否能作用在-long-上，是否能作用在-String-上？"><a href="#switch-是否能作用在-byte-上，是否能作用在-long-上，是否能作用在-String-上？" class="headerlink" title="switch 是否能作用在 byte 上，是否能作用在 long 上，是否能作用在 String 上？"></a><code>switch</code> 是否能作用在 <code>byte</code> 上，是否能作用在 <code>long</code> 上，是否能作用在 <code>String</code> 上？</h3></blockquote><p>答：在 Java 5 以前，<code>switch(expr)</code> 中，<code>expr</code> 只能是 <code>byte</code>、<code>short</code>、<code>char</code>、<code>int</code>。从 Java 5 开 始，Java 中引入了枚举类型，<code>expr</code> 也可以是 <code>enum</code> 类型，从 Java 7 开始，<code>expr</code> 还可以是字符串（<code>String</code>），但是长整型（<code>long</code>）在目前所有的版本中都是不可以的。</p><blockquote><h3 id="用最有效率的方法计算-2-乘以-8？"><a href="#用最有效率的方法计算-2-乘以-8？" class="headerlink" title="用最有效率的方法计算 2 乘以 8？"></a>用最有效率的方法计算 2 乘以 8？</h3></blockquote><p>答：<code>2 &lt;&lt; 3</code>（左移 3 位相当于乘以 2 的 3 次方，右移3位相当于除以 2 的 3 次方）。</p><p><strong>补充：</strong>我们为编写的类重写 <code>hashCode</code> 方法时，可能会看到如下所示的代码，其实我们不太理解为什么要使用这样的乘法运算来产生哈希码（散列码），而且为什么这个数是个素数，为什么通常选择 31 这个数？前两个问题的答案你可以自己百度一下，选择 31 是因为可以用移位和减法运算来代替乘法，从而得到更好的性能。说到这里你可能已经想到了：<code>31 * num</code> 等价于 <code>(num &lt;&lt; 5) - num</code>，左移 5 位相当于乘以 2 的 5 次方再减去自身就相当于乘以 31，现在的 JVM 都能自动完成这个优化。</p><p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PhoneNumber</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token keyword">int</span> areaCode<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> prefix<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> lineNumber<span class="token punctuation">;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">final</span> <span class="token keyword">int</span> prime <span class="token operator">=</span> <span class="token number">31</span><span class="token punctuation">;</span>        <span class="token keyword">int</span> result <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>        result <span class="token operator">=</span> prime <span class="token operator">*</span> result <span class="token operator">+</span> areaCode<span class="token punctuation">;</span>        result <span class="token operator">=</span> prime <span class="token operator">*</span> result                <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>lineNumber <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token number">0</span> <span class="token operator">:</span> lineNumber<span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        result <span class="token operator">=</span> prime <span class="token operator">*</span> result <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>prefix <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token number">0</span> <span class="token operator">:</span> prefix<span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> result<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">equals</span><span class="token punctuation">(</span><span class="token class-name">Object</span> obj<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span> <span class="token operator">==</span> obj<span class="token punctuation">)</span>            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>obj <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> obj<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>        <span class="token class-name">PhoneNumber</span> other <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">PhoneNumber</span><span class="token punctuation">)</span> obj<span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>areaCode <span class="token operator">!=</span> other<span class="token punctuation">.</span>areaCode<span class="token punctuation">)</span>            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>lineNumber <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>other<span class="token punctuation">.</span>lineNumber <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>                <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>lineNumber<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>other<span class="token punctuation">.</span>lineNumber<span class="token punctuation">)</span><span class="token punctuation">)</span>            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>prefix <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>other<span class="token punctuation">.</span>prefix <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>                <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>prefix<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>other<span class="token punctuation">.</span>prefix<span class="token punctuation">)</span><span class="token punctuation">)</span>            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><blockquote><h3 id="数组有没有-length-方法？String-有没有-length-方法？"><a href="#数组有没有-length-方法？String-有没有-length-方法？" class="headerlink" title="数组有没有 length() 方法？String 有没有 length() 方法？"></a>数组有没有 <code>length()</code> 方法？String 有没有 <code>length()</code> 方法？</h3></blockquote><p>答：数组没有 <code>length()</code> 方法，有 <code>length</code> 的属性。<code>String</code> 有 <code>length()</code> 方法。<code>JavaScript</code> 中，获得字符串的长度是通过 <code>length</code> 属性得到的，这一点容易和 Java 混淆。</p><blockquote><h3 id="在-Java-中，如何跳出当前的多重嵌套循环？"><a href="#在-Java-中，如何跳出当前的多重嵌套循环？" class="headerlink" title="在 Java 中，如何跳出当前的多重嵌套循环？"></a>在 Java 中，如何跳出当前的多重嵌套循环？</h3></blockquote><p>答：在最外层循环前加一个标记如 <code>A</code>，然后用 <code>break A;</code> 可以跳出多重循环。（Java 中支持带标签的 <code>break</code> 和 <code>continue</code> 语句，作用有点类似于 C 和 C++ 中的 <code>goto</code> 语句，但是就像要避免使用 <code>goto</code> 一样，应该避免使用带标签的 <code>break</code> 和 <code>continue</code>，因为它不会让你的程序变得更优雅，很多时候甚至有相反的作用，所以这种语法其实不知道更好）</p><blockquote><h3 id="构造器（constructor）是否可被重写（override）？"><a href="#构造器（constructor）是否可被重写（override）？" class="headerlink" title="构造器（constructor）是否可被重写（override）？"></a>构造器（<code>constructor</code>）是否可被重写（<code>override</code>）？</h3></blockquote><p>答：构造器不能被继承，因此不能被重写，但可以被重载。</p><blockquote><h3 id="两个对象值相同-x-equals-y-true-，但却可有不同的-hash-code，这句话对不对？"><a href="#两个对象值相同-x-equals-y-true-，但却可有不同的-hash-code，这句话对不对？" class="headerlink" title="两个对象值相同 (x.equals(y) == true)，但却可有不同的 hash code，这句话对不对？"></a>两个对象值相同 (<code>x.equals(y) == true</code>)，但却可有不同的 <code>hash code</code>，这句话对不对？</h3></blockquote><p>答：不对，如果两个对象 <code>x</code> 和 <code>y</code> 满足 <code>x.equals(y) == true</code>，它们的哈希码（hash code）应当相同。Java 对于 <code>eqauls</code> 方法和 <code>hashCode</code> 方法是这样规定的：</p><ol><li>如果两个对象相同（<code>equals</code> 方法返回 <code>true</code>），那么它们的 <code>hashCode</code> 值一定要相同；</li><li>如果两个对象的 <code>hashCode</code> 相同，它们并不一定相同。</li></ol><p>当然，你未必要按照要求去做，但是如果你违背了上述原则就会发现在使用容器时，相同的对象可以出现在 <code>Set</code> 集合中，同时增加新元素的效率会大大下降（对于使用哈希存储的系统，如果哈希码频繁的冲突将会造成存取性能急剧下降）。</p><p><strong>补充：</strong>关于 <code>equals</code> 和 <code>hashCode</code> 方法，很多 Java 程序员都知道，但很多人也就是仅仅知道而已，在 Joshua Bloch 的大作《Effective Java》（很多软件公司，《Effective Java》、《Java编程思想》以及《重构：改善既有代码质量》是 Java 程序员必看书籍，如果你还没看过，那就赶紧去亚马逊买一本吧）中是这样介绍 <code>equals</code> 方法的：首先 <code>equals</code> 方法必须满足<strong>自反性</strong>（<code>x.equals(x)</code> 必须返回 <code>true</code>）、<strong>对称性</strong>（ <code>x.equals(y)</code> 返回 <code>true</code> 时，<code>y.equals(x)</code> 也必须返回 <code>true</code>）、<strong>传递性</strong>（<code>x.equals(y)</code> 和 <code>y.equals(z)</code> 都返回 <code>true</code> 时，<code>x.equals(z)</code> 也必须返回 <code>true</code>）和<strong>一致性</strong>（当 <code>x</code> 和 <code>y</code> 引用的对象信息没有被修改时，多次调用 <code>x.equals(y)</code> 应该得到同样的返回值），而且对于任何非 <code>null</code> 值的引用 <code>x</code>，<code>x.equals(null)</code> 必须返回 <code>false</code>。实现高质量的 <code>equals</code> 方法的诀窍包括：</p><ol><li>使用 <code>==</code> 操作符检查“参数是否为这个对象的引用”；</li><li>使用 <code>instanceof</code> 操作符检查“参数是否为正确的类型”；</li><li>对于类中的关键属性，检查参数传入对象的属性是否与之相匹配；</li><li>编写完 <code>equals</code> 方法后，问自己它是否满足对称性、传递性、一致性；</li><li>重写 <code>equals</code> 时总是要重写 <code>hashCode</code>；</li><li>不要将 <code>equals</code> 方法参数中的 <code>Object</code> 对象替换为其他的类型，在重写时不要忘掉 <code>@Override</code> 注解。</li></ol><blockquote><h3 id="是否可以继承-String-类？"><a href="#是否可以继承-String-类？" class="headerlink" title="是否可以继承 String 类？"></a>是否可以继承 <code>String</code> 类？</h3></blockquote><p>答：<code>String</code> 类是 <code>final</code> 类，不可以被继承。</p><p><strong>补充：</strong>继承 <code>String</code> 本身就是一个错误的行为，对 <code>String</code> 类型最好的重用方式是关联关系（Has-A）和依赖关系（Use-A）而不是继承关系（Is-A）。</p><blockquote><h3 id="当一个对象被当作参数传递到一个方法后，此方法可改变这个对象的属性，并可返回变化后的结果，那么这里到底是值传递还是引用传递？"><a href="#当一个对象被当作参数传递到一个方法后，此方法可改变这个对象的属性，并可返回变化后的结果，那么这里到底是值传递还是引用传递？" class="headerlink" title="当一个对象被当作参数传递到一个方法后，此方法可改变这个对象的属性，并可返回变化后的结果，那么这里到底是值传递还是引用传递？"></a>当一个对象被当作参数传递到一个方法后，此方法可改变这个对象的属性，并可返回变化后的结果，那么这里到底是值传递还是引用传递？</h3></blockquote><p>答：是值传递。Java 语言的方法调用只支持参数的值传递。当一个对象实例作为一个参数被传递到方法中时，参数的值就是对该对象的引用。对象的属性可以在被调用过程中被改变，但对对象引用的改变是不会影响到调用者的。C++ 和 C# 中可以通过传引用或传输出参数来改变传入的参数的值。在 C# 中可以编写如下所示的代码，但是在 Java 中却做不到。</p><p><pre class="line-numbers language-csharp" data-language="csharp"><code class="language-csharp"><span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span><span class="token keyword">namespace</span> <span class="token namespace">CS01</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">class</span> <span class="token class-name">Program</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">swap</span><span class="token punctuation">(</span><span class="token keyword">ref</span> <span class="token class-name"><span class="token keyword">int</span></span> x<span class="token punctuation">,</span> <span class="token keyword">ref</span> <span class="token class-name"><span class="token keyword">int</span></span> y<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token class-name"><span class="token keyword">int</span></span> temp <span class="token operator">=</span> x<span class="token punctuation">;</span>            x <span class="token operator">=</span> y<span class="token punctuation">;</span>            y <span class="token operator">=</span> temp<span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> Main <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token class-name"><span class="token keyword">int</span></span> a <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">,</span> b <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>            swap <span class="token punctuation">(</span><span class="token keyword">ref</span> a<span class="token punctuation">,</span> <span class="token keyword">ref</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">// a = 10, b = 5;</span>            Console<span class="token punctuation">.</span>WriteLine <span class="token punctuation">(</span><span class="token string">"a = &#123;0&#125;, b = &#123;1&#125;"</span><span class="token punctuation">,</span> a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p><strong>说明：</strong>Java中没有传引用实在是非常的不方便，这一点在 Java 8 中仍然没有得到改进，正是如此在 Java 编写的代码中才会出现大量的 <code>Wrapper</code> 类（将需要通过方法调用修改的引用置于一个 <code>Wrapper</code> 类中，再将 <code>Wrapper</code> 对象传入方法），这样的做法只会让代码变得臃肿，尤其是让从 C 和 C++ 转型为 Java 程序员的开发者无法容忍。</p><blockquote><h3 id="String-和-StringBuilder、StringBuffer-的区别？"><a href="#String-和-StringBuilder、StringBuffer-的区别？" class="headerlink" title="String 和 StringBuilder、StringBuffer 的区别？"></a><code>String</code> 和 <code>StringBuilder</code>、<code>StringBuffer</code> 的区别？</h3></blockquote><p>答：Java 平台提供了两种类型的字符串：<code>String</code> 和 <code>StringBuffer/StringBuilder</code>，它们可以储存和操作字符串。其中 <code>String</code> 是只读字符串，也就意味着 String 引用的字符串内容是不能被改变的。而 <code>StringBuffer/StringBuilder</code> 类表示的字符串对象可以直接进行修改。<code>StringBuilder</code> 是 Java 5 中引入的，它和 <code>StringBuffer</code> 的方法完全相同，区别在于它是在单线程环境下使用的，因为它的所有方面都没有被 <code>synchronized</code> 修饰，因此它的效率也比 <code>StringBuffer</code> 要高。</p><p>面试题1 - 什么情况下用 <code>+</code> 运算符进行字符串连接比调用 <code>StringBuffer/StringBuilder</code> 对象的 <code>append</code> 方法连接字符串性能更好？</p><p>面试题2 - 请说出下面程序的输出。</p><p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">class</span> <span class="token class-name">StringEqualTest</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">String</span> s1 <span class="token operator">=</span> <span class="token string">"Programming"</span><span class="token punctuation">;</span>        <span class="token class-name">String</span> s2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span><span class="token string">"Programming"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">String</span> s3 <span class="token operator">=</span> <span class="token string">"Program"</span><span class="token punctuation">;</span>        <span class="token class-name">String</span> s4 <span class="token operator">=</span> <span class="token string">"ming"</span><span class="token punctuation">;</span>        <span class="token class-name">String</span> s5 <span class="token operator">=</span> <span class="token string">"Program"</span> <span class="token operator">+</span> <span class="token string">"ming"</span><span class="token punctuation">;</span>        <span class="token class-name">String</span> s6 <span class="token operator">=</span> s3 <span class="token operator">+</span> s4<span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>s1 <span class="token operator">==</span> s2<span class="token punctuation">)</span><span class="token punctuation">;</span>             <span class="token comment">// false</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>s1 <span class="token operator">==</span> s5<span class="token punctuation">)</span><span class="token punctuation">;</span>             <span class="token comment">// true</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>s1 <span class="token operator">==</span> s6<span class="token punctuation">)</span><span class="token punctuation">;</span>             <span class="token comment">// false</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>s1 <span class="token operator">==</span> s6<span class="token punctuation">.</span><span class="token function">intern</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// true</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>s2 <span class="token operator">==</span> s2<span class="token punctuation">.</span><span class="token function">intern</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// false</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p><strong>补充：</strong>解答上面的面试题需要清楚两点：</p><ol><li><p><code>String</code> 对象的 <code>intern</code> 方法会得到字符串对象在常量池中对应的版本的引用（如果常量池中有一个字符串与 <code>String</code> 对象的 <code>equals</code> 结果是 <code>true</code>），如果常量池中没有对应的字符串，则该字符串将被添加到常量池中，然后返回常量池中字符串的引用；</p></li><li><p>字符串的 <code>+</code> 操作其本质是创建了 <code>StringBuilder</code> 对象进行 <code>append</code> 操作，然后将拼接后的 <code>StringBuilder</code> 对象用 <code>toString</code> 方法处理成 <code>String</code> 对象，这一点可以用 <code>javap -c StringEqualTest.class</code> 命令获得 class 文件对应的 JVM 字节码指令就可以看出来。</p></li></ol><blockquote><h3 id="重载（Overload）和重写（Override）的区别。重载的方法能否根据返回类型进行区分？"><a href="#重载（Overload）和重写（Override）的区别。重载的方法能否根据返回类型进行区分？" class="headerlink" title="重载（Overload）和重写（Override）的区别。重载的方法能否根据返回类型进行区分？"></a>重载（Overload）和重写（Override）的区别。重载的方法能否根据返回类型进行区分？</h3></blockquote><p>答：方法的重载和重写都是实现多态的方式，区别在于前者实现的是编译时的多态性，而后者实现的是运行时的多态性。重载发生在一个类中，同名的方法如果有不同的参数列表（参数类型不同、参数个数不同或者二者都不同）则视为重载；重写发生在子类与父类之间，重写要求子类被重写方法与父类被重写方法有相同的返回类型，比父类被重写方法更好访问，不能比父类被重写方法声明更多的异常（里氏代换原则）。重载对返回类型没有特殊的要求。</p><p>面试题：华为的面试题中曾经问过这样一个问题 - &quot;为什么不能根据返回类型来区分重载&quot;，快说出你的答案吧！</p><blockquote><h3 id="描述一下-JVM-加载-class-文件的原理机制？"><a href="#描述一下-JVM-加载-class-文件的原理机制？" class="headerlink" title="描述一下 JVM 加载 class 文件的原理机制？"></a>描述一下 JVM 加载 <code>class</code> 文件的原理机制？</h3></blockquote><p>答：JVM 中类的装载是由类加载器（ClassLoader）和它的子类来实现的，Java中的类加载器是一个重要的 Java 运行时系统组件，它负责在运行时查找和装入类文件中的类。</p><p>由于 Java 的跨平台性，经过编译的 Java 源程序并不是一个可执行程序，而是一个或多个类文件。当 Java 程序需要使用某个类时，JVM 会确保这个类已经被加载、连接（验证、准备和解析）和初始化。类的加载是指把类的 <code>.class</code> 文件中的数据读入到内存中，通常是创建一个字节数组读入 <code>.class</code> 文件，然后产生与所加载类对应的 <code>Class</code> 对象。加载完成后，<code>Class</code> 对象还不完整，所以此时的类还不可用。当类被加载后就进入连接阶段，这一阶段包括<strong>验证</strong>、<strong>准备</strong>（为静态变量分配内存并设置默认的初始值）和<strong>解析</strong>（将符号引用替换为直接引用）三个步骤。最后 JVM 对类进行初始化，包括：(1)如果类存在直接的父类并且这个类还没有被初始化，那么就先初始化父类；(2)如果类中存在初始化语句，就依次执行这些初始化语句。</p><p>类的加载是由类加载器完成的，类加载器包括：根加载器（BootStrap）、扩展加载器（Extension）、系统加载器（System）和用户自定义类加载器（<code>java.lang.ClassLoader</code> 的子类）。从 Java 2（JDK 1.2）开始，类加载过程采取了父亲委托机制（PDM）。PDM 更好的保证了 Java 平台的安全性，在该机制中，JVM 自带的 Bootstrap 是根加载器，其他的加载器都有且仅有一个父类加载器。类的加载首先请求父类加载器加载，父类加载器无能为力时才由其子类加载器自行加载。JVM 不会向 Java 程序提供对 Bootstrap 的引用。下面是关于几个类加载器的说明：</p><ul><li>Bootstrap：一般用本地代码实现，负责加载 JVM 基础核心类库（<code>rt.jar</code>）；</li><li>Extension：从 <code>java.ext.dirs</code> 系统属性所指定的目录中加载类库，它的父加载器是 Bootstrap；</li><li>System：又叫应用类加载器，其父类是 <code>Extension</code>。它是应用最广泛的类加载器。它从环境变量 <code>classpath</code> 或者系统属性 <code>java.class.path</code> 所指定的目录中记载类，是用户自定义加载器的默认父加载器。</li></ul><blockquote><h3 id="char-类型变量中能不能存储一个中文汉字，为什么？"><a href="#char-类型变量中能不能存储一个中文汉字，为什么？" class="headerlink" title="char 类型变量中能不能存储一个中文汉字，为什么？"></a><code>char</code> 类型变量中能不能存储一个中文汉字，为什么？</h3></blockquote><p>答：<code>char</code> 类型可以存储一个中文汉字，因为 Java 中使用的编码是 <code>Unicode</code>（不选择任何特定的编码，直接使用字符在字符集中的编号，这是统一的唯一方法），一个 <code>char</code> 类型占 2 个字节（16 比特），所以放一个中文是没问题的。</p><p><strong>补充：</strong>使用 <code>Unicode</code> 意味着字符在 JVM 内部和外部有不同的表现形式，在 JVM 内部都是 <code>Unicode</code>，当这个字符被从 JVM 内部转移到外部时（例如存入文件系统中），需要进行编码转换。所以 Java 中有字节流和字符流，以及在字符流和字节流之间进行转换的转换流，如 <code>InputStreamReader</code> 和 <code>OutputStreamReader</code>，这两个类是字节流和字符流之间的适配器类，承担了编码转换的任务；对于 C 程序员来说，要完成这样的编码转换恐怕要依赖于 <code>union</code>（联合体/共用体）共享内存的特征来实现了。</p><blockquote><h3 id="抽象类（abstract-class）和接口（interface）有什么异同？"><a href="#抽象类（abstract-class）和接口（interface）有什么异同？" class="headerlink" title="抽象类（abstract class）和接口（interface）有什么异同？"></a>抽象类（abstract class）和接口（interface）有什么异同？</h3></blockquote><p>答：抽象类和接口都不能够实例化，但可以定义抽象类和接口类型的引用。一个类如果继承了某个抽象类或者实现了某个接口都需要对其中的抽象方法全部进行实现，否则该类仍然需要被声明为抽象类。接口比抽象类更加抽象，因为抽象类中可以定义构造器，可以有抽象方法和具体方法，而接口中不能定义构造器而且其中的方法全部都是抽象方法。抽象类中的成员可以是 <code>private</code>、<code>默认</code>、<code>protected</code>、<code>public</code> 的，而接口中的成员全都是 <code>public</code> 的。抽象类中可以定义成员变量，而接口中定义的成员变量实际上都是常量。有抽象方法的类必须被声明为抽象类，而抽象类未必要有抽象方法。</p><blockquote><h3 id="静态嵌套类（Static-Nested-Class）和内部类（Inner-Class）的不同？"><a href="#静态嵌套类（Static-Nested-Class）和内部类（Inner-Class）的不同？" class="headerlink" title="静态嵌套类（Static Nested Class）和内部类（Inner Class）的不同？"></a>静态嵌套类（Static Nested Class）和内部类（Inner Class）的不同？</h3></blockquote><p>答：Static Nested Class 是被声明为静态（<code>static</code>）的内部类，它可以不依赖于外部类实例被实例化。而通常的内部类需要在外部类实例化后才能实例化，其语法看起来挺诡异的，如下所示。</p><p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/** * 扑克类（一副扑克） */</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Poker</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> suites <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token string">"黑桃"</span><span class="token punctuation">,</span> <span class="token string">"红桃"</span><span class="token punctuation">,</span> <span class="token string">"草花"</span><span class="token punctuation">,</span> <span class="token string">"方块"</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> faces <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">Card</span><span class="token punctuation">[</span><span class="token punctuation">]</span> cards<span class="token punctuation">;</span>    <span class="token comment">/**     * 构造器     */</span>    <span class="token keyword">public</span> <span class="token class-name">Poker</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        cards <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Card</span><span class="token punctuation">[</span><span class="token number">52</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> suites<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> faces<span class="token punctuation">.</span>length<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                cards<span class="token punctuation">[</span>i <span class="token operator">*</span> <span class="token number">13</span> <span class="token operator">+</span> j<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Card</span><span class="token punctuation">(</span>suites<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> faces<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">/**     * 洗牌 （随机乱序）     */</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">shuffle</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> len <span class="token operator">=</span> cards<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> len<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">int</span> index <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> len<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">Card</span> temp <span class="token operator">=</span> cards<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">;</span>            cards<span class="token punctuation">[</span>index<span class="token punctuation">]</span> <span class="token operator">=</span> cards<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>            cards<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> temp<span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">/**     * 发牌     * @param index 发牌的位置     */</span>    <span class="token keyword">public</span> <span class="token class-name">Card</span> <span class="token function">deal</span><span class="token punctuation">(</span><span class="token keyword">int</span> index<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> cards<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">/**     * 卡片类（一张扑克）     * [内部类]     */</span>    <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Card</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">private</span> <span class="token class-name">String</span> suite<span class="token punctuation">;</span>   <span class="token comment">// 花色</span>        <span class="token keyword">private</span> <span class="token keyword">int</span> face<span class="token punctuation">;</span>       <span class="token comment">// 点数</span>        <span class="token keyword">public</span> <span class="token class-name">Card</span><span class="token punctuation">(</span><span class="token class-name">String</span> suite<span class="token punctuation">,</span> <span class="token keyword">int</span> face<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">this</span><span class="token punctuation">.</span>suite <span class="token operator">=</span> suite<span class="token punctuation">;</span>            <span class="token keyword">this</span><span class="token punctuation">.</span>face <span class="token operator">=</span> face<span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token annotation punctuation">@Override</span>        <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token class-name">String</span> faceStr <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>            <span class="token keyword">switch</span><span class="token punctuation">(</span>face<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">case</span> <span class="token number">1</span><span class="token operator">:</span> faceStr <span class="token operator">=</span> <span class="token string">"A"</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span>            <span class="token keyword">case</span> <span class="token number">11</span><span class="token operator">:</span> faceStr <span class="token operator">=</span> <span class="token string">"J"</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span>            <span class="token keyword">case</span> <span class="token number">12</span><span class="token operator">:</span> faceStr <span class="token operator">=</span> <span class="token string">"Q"</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span>            <span class="token keyword">case</span> <span class="token number">13</span><span class="token operator">:</span> faceStr <span class="token operator">=</span> <span class="token string">"K"</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span>            <span class="token keyword">default</span><span class="token operator">:</span> faceStr <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>face<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>            <span class="token keyword">return</span> suite <span class="token operator">+</span> faceStr<span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p>测试代码：</p><p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">class</span> <span class="token class-name">PokerTest</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">Poker</span> poker <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Poker</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        poker<span class="token punctuation">.</span><span class="token function">shuffle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                  <span class="token comment">// 洗牌</span>        <span class="token class-name">Poker</span><span class="token punctuation">.</span><span class="token class-name">Card</span> c1 <span class="token operator">=</span> poker<span class="token punctuation">.</span><span class="token function">deal</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// 发第一张牌</span>        <span class="token comment">// 对于非静态内部类Card</span>        <span class="token comment">// 只有通过其外部类Poker对象才能创建Card对象</span>        <span class="token class-name">Poker</span><span class="token punctuation">.</span><span class="token class-name">Card</span> c2 <span class="token operator">=</span> poker<span class="token punctuation">.</span><span class="token keyword">new</span> <span class="token class-name">Card</span><span class="token punctuation">(</span><span class="token string">"红心"</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// 自己创建一张牌</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>c1<span class="token punctuation">)</span><span class="token punctuation">;</span>           <span class="token comment">// 洗牌后的第一张</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>c2<span class="token punctuation">)</span><span class="token punctuation">;</span>           <span class="token comment">// 打印: 红心A</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p>面试题 - 下面的代码哪些地方会产生编译错误？</p><p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">class</span> <span class="token class-name">Outer</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">class</span> <span class="token class-name">Inner</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token keyword">new</span> <span class="token class-name">Inner</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token keyword">new</span> <span class="token class-name">Inner</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">new</span> <span class="token class-name">Inner</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p><strong>注意：</strong>Java 中非静态内部类对象的创建要依赖其外部类对象，上面的面试题中 <code>foo</code> 和 <code>main</code> 方法都是静态方法，静态方法中没有 <code>this</code>，也就是说没有所谓的外部类对象，因此无法创建内部类对象，如果要在静态方法中创建内部类对象，可以这样做：</p><p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">new</span> <span class="token class-name">Outer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">new</span> <span class="token class-name">Inner</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><blockquote><h3 id="Java-中会存在内存泄漏吗，请简单描述。"><a href="#Java-中会存在内存泄漏吗，请简单描述。" class="headerlink" title="Java 中会存在内存泄漏吗，请简单描述。"></a>Java 中会存在内存泄漏吗，请简单描述。</h3></blockquote><p>答：理论上 Java 因为有垃圾回收机制（GC）不会存在内存泄露问题（这也是 Java 被广泛使用于服务器端编程的一个重要原因）；然而在实际开发中，可能会存在无用但可达的对象，这些对象不能被 GC 回收，因此也会导致内存泄露的发生。例如 Hibernate 的 Session（一级缓存）中的对象属于持久态，垃圾回收器是不会回收这些对象的，然而这些对象中可能存在无用的垃圾对象，如果不及时关闭（close）或清空（flush）一级缓存就可能导致内存泄露。下面例子中的代码也会导致内存泄露。</p><p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Arrays</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">EmptyStackException</span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyStack</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">></span></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token class-name">T</span><span class="token punctuation">[</span><span class="token punctuation">]</span> elements<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token keyword">int</span> size <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> INIT_CAPACITY <span class="token operator">=</span> <span class="token number">16</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token class-name">MyStack</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        elements <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">T</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">[</span>INIT_CAPACITY<span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">push</span><span class="token punctuation">(</span><span class="token class-name">T</span> elem<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token function">ensureCapacity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        elements<span class="token punctuation">[</span>size<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> elem<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token class-name">T</span> <span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>size <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>             <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">EmptyStackException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> elements<span class="token punctuation">[</span><span class="token operator">--</span>size<span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">ensureCapacity</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>elements<span class="token punctuation">.</span>length <span class="token operator">==</span> size<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            elements <span class="token operator">=</span> <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">copyOf</span><span class="token punctuation">(</span>elements<span class="token punctuation">,</span> <span class="token number">2</span> <span class="token operator">*</span> size <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p>上面的代码实现了一个栈（先进后出（FILO））结构，乍看之下似乎没有什么明显的问题，它甚至可以通过你编写的各种单元测试。然而其中的 <code>pop</code> 方法却存在内存泄露的问题，当我们用 <code>pop</code> 方法弹出栈中的对象时，该对象不会被当作垃圾回收，即使使用栈的程序不再引用这些对象，因为栈内部维护着对这些对象的过期引用（obsolete reference）。在支持垃圾回收的语言中，内存泄露是很隐蔽的，这种内存泄露其实就是无意识的对象保持。如果一个对象引用被无意识的保留起来了，那么垃圾回收器不会处理这个对象，也不会处理该对象引用的其他对象，即使这样的对象只有少数几个，也可能会导致很多的对象被排除在垃圾回收之外，从而对性能造成重大影响，极端情况下会引发 Disk Paging（物理内存与硬盘的虚拟内存交换数据），甚至造成 OutOfMemoryError。</p><blockquote><h3 id="抽象的（abstract）方法是否可同时是静态的（static），是否可同时是本地方法（native），是否可同时被-synchronized-修饰？"><a href="#抽象的（abstract）方法是否可同时是静态的（static），是否可同时是本地方法（native），是否可同时被-synchronized-修饰？" class="headerlink" title="抽象的（abstract）方法是否可同时是静态的（static），是否可同时是本地方法（native），是否可同时被 synchronized 修饰？"></a>抽象的（<code>abstract</code>）方法是否可同时是静态的（<code>static</code>），是否可同时是本地方法（<code>native</code>），是否可同时被 <code>synchronized</code> 修饰？</h3></blockquote><p>答：都不能。抽象方法需要子类重写，而静态的方法是无法被重写的，因此二者是矛盾的。本地方法是由本地代码（如 C 代码）实现的方法，而抽象方法是没有实现的，也是矛盾的。<code>synchronized</code> 和方法的实现细节有关，抽象方法不涉及实现细节，因此也是相互矛盾的。</p><blockquote><h3 id="阐述静态变量和实例变量的区别。"><a href="#阐述静态变量和实例变量的区别。" class="headerlink" title="阐述静态变量和实例变量的区别。"></a>阐述静态变量和实例变量的区别。</h3></blockquote><p>答：静态变量是被 <code>static</code> 修饰符修饰的变量，也称为类变量，它属于类，不属于类的任何一个对象，一个类不管创建多少个对象，静态变量在内存中有且仅有一个拷贝；实例变量必须依存于某一实例，需要先创建对象然后通过对象才能访问到它。静态变量可以实现让多个对象共享内存。</p><p><strong>补充：</strong>在 Java 开发中，上下文类和工具类中通常会有大量的静态成员。</p><blockquote><h3 id="是否可以从一个静态（static）方法内部发出对非静态（non-static）方法的调用？"><a href="#是否可以从一个静态（static）方法内部发出对非静态（non-static）方法的调用？" class="headerlink" title="是否可以从一个静态（static）方法内部发出对非静态（non-static）方法的调用？"></a>是否可以从一个静态（static）方法内部发出对非静态（non-static）方法的调用？</h3></blockquote><p>答：不可以，静态方法只能访问静态成员，因为非静态方法的调用要先创建对象，在调用静态方法时可能对象并没有被初始化。</p><blockquote><h3 id="如何实现对象克隆？"><a href="#如何实现对象克隆？" class="headerlink" title="如何实现对象克隆？"></a>如何实现对象克隆？</h3></blockquote><p>答：有两种方式：</p><ul><li>实现 <code>Cloneable</code> 接口并重写 <code>Object</code> 类中的 <code>clone()</code> 方法；</li><li>实现 <code>Serializable</code> 接口，通过对象的序列化和反序列化实现克隆，可以实现真正的深度克隆，代码如下。</li></ul><p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">ByteArrayInputStream</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">ByteArrayOutputStream</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">ObjectInputStream</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">ObjectOutputStream</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">Serializable</span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyUtil</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token class-name">MyUtil</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">AssertionError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@SuppressWarnings</span><span class="token punctuation">(</span><span class="token string">"unchecked"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span> <span class="token keyword">extends</span> <span class="token class-name">Serializable</span><span class="token punctuation">></span></span> <span class="token class-name">T</span> <span class="token function">clone</span><span class="token punctuation">(</span><span class="token class-name">T</span> obj<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">ByteArrayOutputStream</span> bout <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ByteArrayOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">ObjectOutputStream</span> oos <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ObjectOutputStream</span><span class="token punctuation">(</span>bout<span class="token punctuation">)</span><span class="token punctuation">;</span>        oos<span class="token punctuation">.</span><span class="token function">writeObject</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">ByteArrayInputStream</span> bin <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ByteArrayInputStream</span><span class="token punctuation">(</span>bout<span class="token punctuation">.</span><span class="token function">toByteArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">ObjectInputStream</span> ois <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ObjectInputStream</span><span class="token punctuation">(</span>bin<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token class-name">T</span><span class="token punctuation">)</span> ois<span class="token punctuation">.</span><span class="token function">readObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// **说明：**调用ByteArrayInputStream或ByteArrayOutputStream对象的close方法没有任何意义</span>        <span class="token comment">// 这两个基于内存的流只要垃圾回收器清理对象就能够释放资源，这一点不同于对外部资源（如文件流）的释放</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p>下面是测试代码：</p><p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">Serializable</span><span class="token punctuation">;</span><span class="token comment">/** * 人类 */</span><span class="token keyword">class</span> <span class="token class-name">Person</span> <span class="token keyword">implements</span> <span class="token class-name">Serializable</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">long</span> serialVersionUID <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">9102017020286042305L</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>    <span class="token comment">// 姓名</span>    <span class="token keyword">private</span> <span class="token keyword">int</span> age<span class="token punctuation">;</span>        <span class="token comment">// 年龄</span>    <span class="token keyword">private</span> <span class="token class-name">Car</span> car<span class="token punctuation">;</span>        <span class="token comment">// 座驾</span>    <span class="token keyword">public</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token keyword">int</span> age<span class="token punctuation">,</span> <span class="token class-name">Car</span> car<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>age <span class="token operator">=</span> age<span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>car <span class="token operator">=</span> car<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> name<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setName</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getAge</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> age<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setAge</span><span class="token punctuation">(</span><span class="token keyword">int</span> age<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>age <span class="token operator">=</span> age<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token class-name">Car</span> <span class="token function">getCar</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> car<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setCar</span><span class="token punctuation">(</span><span class="token class-name">Car</span> car<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>car <span class="token operator">=</span> car<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token string">"Person [name="</span> <span class="token operator">+</span> name <span class="token operator">+</span> <span class="token string">", age="</span> <span class="token operator">+</span> age <span class="token operator">+</span> <span class="token string">", car="</span> <span class="token operator">+</span> car <span class="token operator">+</span> <span class="token string">"]"</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/** * 小汽车类 */</span><span class="token keyword">class</span> <span class="token class-name">Car</span> <span class="token keyword">implements</span> <span class="token class-name">Serializable</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">long</span> serialVersionUID <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">5713945027627603702L</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> brand<span class="token punctuation">;</span>       <span class="token comment">// 品牌</span>    <span class="token keyword">private</span> <span class="token keyword">int</span> maxSpeed<span class="token punctuation">;</span>       <span class="token comment">// 最高时速</span>    <span class="token keyword">public</span> <span class="token class-name">Car</span><span class="token punctuation">(</span><span class="token class-name">String</span> brand<span class="token punctuation">,</span> <span class="token keyword">int</span> maxSpeed<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>brand <span class="token operator">=</span> brand<span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>maxSpeed <span class="token operator">=</span> maxSpeed<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getBrand</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> brand<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setBrand</span><span class="token punctuation">(</span><span class="token class-name">String</span> brand<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>brand <span class="token operator">=</span> brand<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getMaxSpeed</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> maxSpeed<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setMaxSpeed</span><span class="token punctuation">(</span><span class="token keyword">int</span> maxSpeed<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>maxSpeed <span class="token operator">=</span> maxSpeed<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token string">"Car [brand="</span> <span class="token operator">+</span> brand <span class="token operator">+</span> <span class="token string">", maxSpeed="</span> <span class="token operator">+</span> maxSpeed <span class="token operator">+</span> <span class="token string">"]"</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">class</span> <span class="token class-name">CloneTest</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>            <span class="token class-name">Person</span> p1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token string">"Hao LUO"</span><span class="token punctuation">,</span> <span class="token number">33</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Car</span><span class="token punctuation">(</span><span class="token string">"Benz"</span><span class="token punctuation">,</span> <span class="token number">300</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">Person</span> p2 <span class="token operator">=</span> <span class="token class-name">MyUtil</span><span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span>p1<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 深度克隆</span>            p2<span class="token punctuation">.</span><span class="token function">getCar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setBrand</span><span class="token punctuation">(</span><span class="token string">"BYD"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">// 修改克隆的 Person 对象 p2 关联的汽车对象的品牌属性</span>            <span class="token comment">// 原来的 Person 对象 p1 关联的汽车不会受到任何影响</span>            <span class="token comment">// 因为在克隆 Person 对象时其关联的汽车对象也被克隆了</span>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>p1<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p><strong>注意：</strong>基于序列化和反序列化实现的克隆不仅仅是深度克隆，更重要的是通过泛型限定，可以检查出要克隆的对象是否支持序列化，这项检查是编译器完成的，不是在运行时抛出异常，这种是方案明显优于使用 <code>Object</code> 类的 <code>clone()</code> 方法克隆对象。让问题在编译的时候暴露出来总是好过把问题留到运行时。</p><blockquote><h3 id="GC-是什么？为什么要有-GC？"><a href="#GC-是什么？为什么要有-GC？" class="headerlink" title="GC 是什么？为什么要有 GC？"></a>GC 是什么？为什么要有 GC？</h3></blockquote><p>答：GC 是垃圾收集的意思，内存处理是编程人员容易出现问题的地方，忘记或者错误的内存回收会导致程序或系统的不稳定甚至崩溃，Java 提供的 GC 功能可以自动监测对象是否超过作用域从而达到自动回收内存的目的，Java 语言没有提供释放已分配内存的显示操作方法。Java 程序员不用担心内存管理，因为垃圾收集器会自动进行管理。要请求垃圾收集，可以调用下面的方法之一：<code>System.gc()</code> 或 <code>Runtime.getRuntime().gc()</code> ，但 JVM 可以屏蔽掉显示的垃圾回收调用。</p><p>垃圾回收可以有效的防止内存泄露，有效的使用可以使用的内存。垃圾回收器通常是作为一个单独的低优先级的线程运行，不可预知的情况下对内存堆中已经死亡的或者长时间没有使用的对象进行清除和回收，程序员不能实时的调用垃圾回收器对某个对象或所有对象进行垃圾回收。在 Java 诞生初期，垃圾回收是 Java 最大的亮点之一，因为服务器端的编程需要有效的防止内存泄露问题，然而时过境迁，如今 Java 的垃圾回收机制已经成为被诟病的东西。移动智能终端用户通常觉得 iOS 的系统比 Android 系统有更好的用户体验，其中一个深层次的原因就在于 Android 系统中垃圾回收的不可预知性。</p><p><strong>补充：</strong>垃圾回收机制有很多种，包括：分代复制垃圾回收、标记垃圾回收、增量垃圾回收等方式。标准的 Java 进程既有栈又有堆。栈保存了原始型局部变量，堆保存了要创建的对象。Java 平台对堆内存回收和再利用的基本算法被称为标记和清除，但是 Java 对其进行了改进，采用“分代式垃圾收集”。这种方法会跟 Java 对象的生命周期将堆内存划分为不同的区域，在垃圾收集过程中，可能会将对象移动到不同区域：</p><ul><li>伊甸园（Eden）：这是对象最初诞生的区域，并且对大多数对象来说，这里是它们唯一存在过的区域。</li><li>幸存者乐园（Survivor）：从伊甸园幸存下来的对象会被挪到这里。</li><li>终身颐养园（Tenured）：这是足够老的幸存对象的归宿。年轻代收集（Minor-GC）过程是不会触及这个地方的。当年轻代收集不能把对象放进终身颐养园时，就会触发一次完全收集（Major-GC），这里可能还会牵扯到压缩，以便为大对象腾出足够的空间。</li></ul><p>与垃圾回收相关的 JVM 参数：</p><ul><li><code>-Xms / -Xmx</code>：堆的初始大小 / 堆的最大大小</li><li><code>-Xmn</code>：堆中年轻代的大小</li><li><code>-XX:-DisableExplicitGC</code>：让System.gc()不产生任何作用</li><li><code>-XX:+PrintGCDetails</code>：打印GC的细节</li><li><code>-XX:+PrintGCDateStamps</code>：打印GC操作的时间戳</li><li><code>-XX:NewSize / XX:MaxNewSize</code>：设置新生代大小/新生代最大大小</li><li><code>-XX:NewRatio</code>：可以设置老生代和新生代的比例</li><li><code>-XX:PrintTenuringDistribution</code>：设置每次新生代GC后输出幸存者乐园中对象年龄的分布</li><li><code>-XX:InitialTenuringThreshold / -XX:MaxTenuringThreshold</code>：设置老年代阀值的初始值和最大值</li><li><code>-XX:TargetSurvivorRatio</code>：设置幸存区的目标使用率</li></ul><blockquote><h3 id="String-s-new-String-quot-xyz-quot-创建了几个字符串对象？"><a href="#String-s-new-String-quot-xyz-quot-创建了几个字符串对象？" class="headerlink" title="String s = new String(&quot;xyz&quot;); 创建了几个字符串对象？"></a><code>String s = new String(&quot;xyz&quot;);</code> 创建了几个字符串对象？</h3></blockquote><p>答：两个对象，一个是静态区的 <code>&quot;xyz&quot;</code>，一个是用 <code>new</code> 创建在堆上的对象。</p><blockquote><h3 id="接口是否可继承（extends）接口？抽象类是否可实现（implements）接口？抽象类是否可继承具体类（concrete-class）？"><a href="#接口是否可继承（extends）接口？抽象类是否可实现（implements）接口？抽象类是否可继承具体类（concrete-class）？" class="headerlink" title="接口是否可继承（extends）接口？抽象类是否可实现（implements）接口？抽象类是否可继承具体类（concrete class）？"></a>接口是否可继承（extends）接口？抽象类是否可实现（implements）接口？抽象类是否可继承具体类（concrete class）？</h3></blockquote><p>答：接口可以继承接口，而且支持多重继承。抽象类可以实现（implements）接口，抽象类可继承具体类也可以继承抽象类。</p><blockquote><h3 id="一个-java-源文件中是否可以包含多个类（不是内部类）？有什么限制？"><a href="#一个-java-源文件中是否可以包含多个类（不是内部类）？有什么限制？" class="headerlink" title="一个 .java 源文件中是否可以包含多个类（不是内部类）？有什么限制？"></a>一个 <code>.java</code> 源文件中是否可以包含多个类（不是内部类）？有什么限制？</h3></blockquote><p>答：可以，但一个源文件中最多只能有一个公开类（public class）而且文件名必须和公开类的类名完全保持一致。</p><blockquote><h3 id="Anonymous-Inner-Class（匿名内部类）是否可以继承其它类？是否可以实现接口？"><a href="#Anonymous-Inner-Class（匿名内部类）是否可以继承其它类？是否可以实现接口？" class="headerlink" title="Anonymous Inner Class（匿名内部类）是否可以继承其它类？是否可以实现接口？"></a>Anonymous Inner Class（匿名内部类）是否可以继承其它类？是否可以实现接口？</h3></blockquote><p>答：可以继承其他类或实现其他接口，在 Swing 编程和 Android 开发中常用此方式来实现事件监听和回调。</p><blockquote><h3 id="内部类可以引用它的包含类（外部类）的成员吗？有没有什么限制？"><a href="#内部类可以引用它的包含类（外部类）的成员吗？有没有什么限制？" class="headerlink" title="内部类可以引用它的包含类（外部类）的成员吗？有没有什么限制？"></a>内部类可以引用它的包含类（外部类）的成员吗？有没有什么限制？</h3></blockquote><p>答：一个内部类对象可以访问创建它的外部类对象的成员，包括私有成员。</p><blockquote><h3 id="Java-中的-final-关键字有哪些用法？"><a href="#Java-中的-final-关键字有哪些用法？" class="headerlink" title="Java 中的 final 关键字有哪些用法？"></a>Java 中的 <code>final</code> 关键字有哪些用法？</h3></blockquote><p>答：</p><ul><li>修饰类：表示该类不能被继承；</li><li>修饰方法：表示方法不能被重写；</li><li>修饰变量：表示变量只能一次赋值以后值不能被修改（常量）。</li></ul><blockquote><h3 id="指出下面程序的运行结果。"><a href="#指出下面程序的运行结果。" class="headerlink" title="指出下面程序的运行结果。"></a>指出下面程序的运行结果。</h3></blockquote><p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">class</span> <span class="token class-name">A</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">static</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token class-name">A</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name">B</span> <span class="token keyword">extends</span> <span class="token class-name">A</span><span class="token punctuation">&#123;</span>    <span class="token keyword">static</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token class-name">B</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"b"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Hello</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">A</span> ab <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">B</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        ab <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">B</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p>答：执行结果：<code>1a2b2b</code>。创建对象时构造器的调用顺序是：先初始化静态成员，然后调用父类构造器，再初始化非静态成员，最后调用自身构造器。</p><p><strong>注意：</strong>如果不能给出此题的正确答案，说明之前第 21 题 Java 类加载机制还没有完全理解，赶紧再看看吧。</p><blockquote><h3 id="数据类型之间的转换："><a href="#数据类型之间的转换：" class="headerlink" title="数据类型之间的转换："></a>数据类型之间的转换：</h3><ul><li>如何将字符串转换为基本数据类型？</li><li>如何将基本数据类型转换为字符串？</li></ul></blockquote><p>答：</p><ul><li>调用基本数据类型对应的包装类中的方法 <code>parseXXX(String)</code> 或 <code>valueOf(String)</code> 即可返回相应基本类型；</li><li>一种方法是将基本数据类型与空字符串（<code>&quot;&quot;</code>）连接（<code>+</code>）即可获得其所对应的字符串；另一种方法是调用 <code>String</code> 类中的 <code>valueOf()</code> 方法返回相应字符串</li></ul><blockquote><h3 id="如何实现字符串的反转及替换？"><a href="#如何实现字符串的反转及替换？" class="headerlink" title="如何实现字符串的反转及替换？"></a>如何实现字符串的反转及替换？</h3></blockquote><p>答：方法很多，可以自己写实现也可以使用 <code>String</code> 或 <code>StringBuffer/StringBuilder</code> 中的方法。有一道很常见的面试题是用递归实现字符串反转，代码如下所示：</p><p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token function">reverse</span><span class="token punctuation">(</span><span class="token class-name">String</span> originStr<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span>originStr <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> originStr<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">1</span><span class="token punctuation">)</span>         <span class="token keyword">return</span> originStr<span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token function">reverse</span><span class="token punctuation">(</span>originStr<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> originStr<span class="token punctuation">.</span><span class="token function">charAt</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><blockquote><h3 id="怎样将-GB2312-编码的字符串转换为-ISO-8859-1-编码的字符串？"><a href="#怎样将-GB2312-编码的字符串转换为-ISO-8859-1-编码的字符串？" class="headerlink" title="怎样将 GB2312 编码的字符串转换为 ISO-8859-1 编码的字符串？"></a>怎样将 GB2312 编码的字符串转换为 ISO-8859-1 编码的字符串？</h3></blockquote><p>答：代码如下所示：</p><p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">String</span> s1 <span class="token operator">=</span> <span class="token string">"你好"</span><span class="token punctuation">;</span><span class="token class-name">String</span> s2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>s1<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token string">"GB2312"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"ISO-8859-1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></p><blockquote><h3 id="日期和时间："><a href="#日期和时间：" class="headerlink" title="日期和时间："></a>日期和时间：</h3><p>问题1：如何取得年月日、小时分钟秒？</p></blockquote><p>创建 <code>java.util.Calendar</code> 实例，调用其 <code>get()</code> 方法传入不同的参数即可获得参数所对应的值。Java 8中可以使用 <code>java.time.LocalDateTime</code> 来获取，代码如下所示。</p><p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DateTimeTest</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">Calendar</span> cal <span class="token operator">=</span> <span class="token class-name">Calendar</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>cal<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">Calendar</span><span class="token punctuation">.</span>YEAR<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>cal<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">Calendar</span><span class="token punctuation">.</span>MONTH<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// 0 - 11</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>cal<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">Calendar</span><span class="token punctuation">.</span>DATE<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>cal<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">Calendar</span><span class="token punctuation">.</span>HOUR_OF_DAY<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>cal<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">Calendar</span><span class="token punctuation">.</span>MINUTE<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>cal<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">Calendar</span><span class="token punctuation">.</span>SECOND<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// Java 8</span>        <span class="token class-name">LocalDateTime</span> dt <span class="token operator">=</span> <span class="token class-name">LocalDateTime</span><span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>dt<span class="token punctuation">.</span><span class="token function">getYear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>dt<span class="token punctuation">.</span><span class="token function">getMonthValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment">// 1 - 12</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>dt<span class="token punctuation">.</span><span class="token function">getDayOfMonth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>dt<span class="token punctuation">.</span><span class="token function">getHour</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>dt<span class="token punctuation">.</span><span class="token function">getMinute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>dt<span class="token punctuation">.</span><span class="token function">getSecond</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><blockquote><p>问题2：如何取得从 1970 年 1 月 1 日 0 时 0 分 0 秒到现在的毫秒数？</p></blockquote><p>以下方法均可获得该毫秒数。</p><p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">Calendar</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTimeInMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">Clock</span><span class="token punctuation">.</span><span class="token function">systemDefaultZone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">millis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Java 8</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></p><blockquote><p>问题3：如何取得某月的最后一天？</p></blockquote><p>代码如下所示。</p><p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">Calendar</span> time <span class="token operator">=</span> <span class="token class-name">Calendar</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>time<span class="token punctuation">.</span><span class="token function">getActualMaximum</span><span class="token punctuation">(</span><span class="token class-name">Calendar</span><span class="token punctuation">.</span>DAY_OF_MONTH<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></p><blockquote><p>问题4：如何格式化日期？</p></blockquote><p>利用 <code>java.text.DataFormat</code> 的子类（如 <code>SimpleDateFormat</code> 类）中的 <code>format(Date)</code> 方法可将日期格式化。Java 8 中可以用 <code>java.time.format.DateTimeFormatter</code> 来格式化时间日期，代码如下所示。</p><p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>text<span class="token punctuation">.</span></span><span class="token class-name">SimpleDateFormat</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>time<span class="token punctuation">.</span></span><span class="token class-name">LocalDate</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>time<span class="token punctuation">.</span>format<span class="token punctuation">.</span></span><span class="token class-name">DateTimeFormatter</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Date</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">DateFormatTest</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">SimpleDateFormat</span> oldFormatter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SimpleDateFormat</span><span class="token punctuation">(</span><span class="token string">"yyyy/MM/dd"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Date</span> date1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>oldFormatter<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span>date1<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// Java 8</span>        <span class="token class-name">DateTimeFormatter</span> newFormatter <span class="token operator">=</span> <span class="token class-name">DateTimeFormatter</span><span class="token punctuation">.</span><span class="token function">ofPattern</span><span class="token punctuation">(</span><span class="token string">"yyyy/MM/dd"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">LocalDate</span> date2 <span class="token operator">=</span> <span class="token class-name">LocalDate</span><span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>date2<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span>newFormatter<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p><strong>补充：</strong>Java 的时间日期 API 一直以来都是被诟病的东西，为了解决这一问题，Java 8 中引入了新的时间日期 API，其中包括 <code>LocalDate</code>、<code>LocalTime</code>、<code>LocalDateTime</code>、<code>Clock</code>、<code>Instant</code> 等类，这些的类的设计都使用了不变模式，因此是线程安全的设计。如果不理解这些内容，可以参考我的另一篇文章<a href="https://blog.csdn.net/jackfrued/article/details/44499227">《关于 Java 并发编程的总结和思考》</a>。</p><blockquote><h3 id="打印昨天的当前时刻。"><a href="#打印昨天的当前时刻。" class="headerlink" title="打印昨天的当前时刻。"></a>打印昨天的当前时刻。</h3></blockquote><p>答：</p><p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Calendar</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">YesterdayCurrent</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token class-name">Calendar</span> cal <span class="token operator">=</span> <span class="token class-name">Calendar</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        cal<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">Calendar</span><span class="token punctuation">.</span>DATE<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>cal<span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p>在Java 8中，可以用下面的代码实现相同的功能。</p><p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>time<span class="token punctuation">.</span></span><span class="token class-name">LocalDateTime</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">YesterdayCurrent</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">LocalDateTime</span> today <span class="token operator">=</span> <span class="token class-name">LocalDateTime</span><span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">LocalDateTime</span> yesterday <span class="token operator">=</span> today<span class="token punctuation">.</span><span class="token function">minusDays</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>yesterday<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><blockquote><h3 id="比较一下-Java-和-JavaSciprt。"><a href="#比较一下-Java-和-JavaSciprt。" class="headerlink" title="比较一下 Java 和 JavaSciprt。"></a>比较一下 Java 和 JavaSciprt。</h3></blockquote><p>答：JavaScript 与 Java 是两个公司开发的不同的两个产品。Java 是原 Sun Microsystems 公司推出的面向对象的程序设计语言，特别适合于互联网应用程序开发；而 JavaScript 是 Netscape 公司的产品，为了扩展 Netscape 浏览器的功能而开发的一种可以嵌入 Web 页面中运行的基于对象和事件驱动的解释性语言。JavaScript 的前身是 LiveScript；而 Java 的前身是 Oak 语言。</p><p>下面对两种语言间的异同作如下比较：</p><ul><li>基于对象和面向对象：Java 是一种真正的面向对象的语言，即使是开发简单的程序，必须设计对象； JavaScript 是种脚本语言，它可以用来制作与网络无关的，与用户交互作用的复杂软件。它是一种基于对象（Object-Based）和事件驱动（Event-Driven）的编程语言，因而它本身提供了非常丰富的内部对象供设计人员使用。</li><li>解释和编译：Java 的源代码在执行之前，必须经过编译。JavaScript 是一种解释性编程语言，其源代码不需经过编译，由浏览器解释执行。（目前的浏览器几乎都使用了 JIT（即时编译）技术来提升 JavaScript 的运行效率）</li><li>强类型变量和类型弱变量：Java 采用强类型变量检查，即所有变量在编译之前必须作声明；JavaScript 中变量是弱类型的，甚至在使用变量前可以不作声明，JavaScript 的解释器在运行时检查推断其数据类型。</li><li>代码格式不一样。</li></ul><p><strong>补充：</strong>上面列出的四点是网上流传的所谓的标准答案。其实 Java 和 JavaScript 最重要的区别是一个是静态语言，一个是动态语言。目前的编程语言的发展趋势是函数式语言和动态语言。在 Java 中类（class）是一等公民，而 JavaScript 中函数（function）是一等公民，因此 JavaScript 支持函数式编程，可以使用 Lambda 函数和闭包（closure），当然 Java 8 也开始支持函数式编程，提供了对 Lambda 表达式以及函数式接口的支持。对于这类问题，在面试的时候最好还是用自己的语言回答会更加靠谱，不要背网上所谓的标准答案。</p><blockquote><h3 id="什么时候用断言（assert）？"><a href="#什么时候用断言（assert）？" class="headerlink" title="什么时候用断言（assert）？"></a>什么时候用断言（assert）？</h3></blockquote><p>答：断言在软件开发中是一种常用的调试方式，很多开发语言中都支持这种机制。一般来说，断言用于保证程序最基本、关键的正确性。断言检查通常在开发和测试时开启。为了保证程序的执行效率，在软件发布后断言检查通常是关闭的。断言是一个包含布尔表达式的语句，在执行这个语句时假定该表达式为 <code>true</code>；如果表达式的值为 <code>false</code>，那么系统会报告一个 AssertionError。断言的使用如下面的代码所示：</p><p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">assert</span><span class="token punctuation">(</span>a <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// throws an AssertionError if a &lt;= 0</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><p>断言可以有两种形式：</p><p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">assert</span> <span class="token class-name">Expression1</span><span class="token punctuation">;</span><span class="token keyword">assert</span> <span class="token class-name">Expression1</span> <span class="token operator">:</span> <span class="token class-name">Expression2</span> <span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></p><p>Expression1 应该总是产生一个布尔值。Expression2 可以是得出一个值的任意表达式；这个值用于生成显示更多调试信息的字符串消息。</p><p>要在运行时启用断言，可以在启动 JVM 时使用 <code>-enableassertions</code> 或者 <code>-ea</code> 标记。要在运行时选择禁用断言，可以在启动 JVM 时使用 <code>-da</code> 或者 <code>-disableassertions</code> 标记。要在系统类中启用或禁用断言，可使用 <code>-esa</code> 或 <code>-dsa</code> 标记。还可以在包的基础上启用或者禁用断言。</p><p><strong>注意：</strong>断言不应该以任何方式改变程序的状态。简单的说，如果希望在不满足某些条件时阻止代码的执行，就可以考虑用断言来阻止它。</p><blockquote><h3 id="Error-和-Exception有什么区别？"><a href="#Error-和-Exception有什么区别？" class="headerlink" title="Error 和 Exception有什么区别？"></a>Error 和 Exception有什么区别？</h3></blockquote><p>答：</p><ul><li>Error 表示系统级的错误和程序不必处理的异常，是恢复不是不可能但很困难的情况下的一种严重问题；比如内存溢出，不可能指望程序能处理这样的情况；</li><li>Exception 表示需要捕捉或者需要程序进行处理的异常，是一种设计或实现问题；也就是说，它表示如果程序运行正常，从不会发生的情况。</li></ul><p>面试题：2005 年摩托罗拉的面试中曾经问过这么一个问题“If a process reports a stack overflow run-time error, what’s the most possible cause?”，给了四个选项 a. lack of memory; b. write on an invalid memory space; c. recursive function calling; d. array index out of boundary. Java 程序在运行时也可能会遭遇 StackOverflowError，这是一个无法恢复的错误，只能重新修改代码了，这个面试题的答案是 c。如果写了不能迅速收敛的递归，则很有可能引发栈溢出的错误，如下所示：</p><p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">class</span> <span class="token class-name">StackOverflowErrorTest</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p><strong>注意：</strong>用递归编写程序时一定要牢记两点：1. 递归公式；2. 收敛条件（什么时候就不再继续递归）。</p><blockquote><h3 id="try-里有一个-return-语句，那么紧跟在这个-try-后的-finally-里的代码会不会被执行，什么时候被执行，在-return-前还是后"><a href="#try-里有一个-return-语句，那么紧跟在这个-try-后的-finally-里的代码会不会被执行，什么时候被执行，在-return-前还是后" class="headerlink" title="try{} 里有一个 return 语句，那么紧跟在这个 try 后的 finally{} 里的代码会不会被执行，什么时候被执行，在 return 前还是后?"></a><code>try&#123;&#125;</code> 里有一个 <code>return</code> 语句，那么紧跟在这个 <code>try</code> 后的 <code>finally&#123;&#125;</code> 里的代码会不会被执行，什么时候被执行，在 <code>return</code> 前还是后?</h3></blockquote><p>答：会执行，在方法返回调用者前执行。</p><p><strong>注意：</strong>在 <code>finally</code> 中改变返回值的做法是不好的，因为如果存在 <code>finally</code> 代码块，<code>try</code> 中的 <code>return</code> 语句不会立马返回调用者，而是记录下返回值待 <code>finally</code> 代码块执行完毕之后再向调用者返回其值，然后如果在 <code>finally</code> 中修改了返回值，就会返回修改后的值。显然，在 <code>finally</code> 中返回或者修改返回值会对程序造成很大的困扰，C# 中直接用编译错误的方式来阻止程序员干这种龌龊的事情，Java 中也可以通过提升编译器的语法检查级别来产生警告或错误，Eclipse 中可以在如图所示的地方进行设置，强烈建议将此项设置为编译错误。</p><p><img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="/images/post/java_interview/46.png" alt></p><blockquote><h3 id="Java-语言如何进行异常处理，关键字：throws、throw、try、catch、finally-分别如何使用？"><a href="#Java-语言如何进行异常处理，关键字：throws、throw、try、catch、finally-分别如何使用？" class="headerlink" title="Java 语言如何进行异常处理，关键字：throws、throw、try、catch、finally 分别如何使用？"></a>Java 语言如何进行异常处理，关键字：<code>throws</code>、<code>throw</code>、<code>try</code>、<code>catch</code>、<code>finally</code> 分别如何使用？</h3></blockquote><p>答：Java 通过面向对象的方法进行异常处理，把各种不同的异常进行分类，并提供了良好的接口。在 Java 中，每个异常都是一个对象，它是 <code>Throwable</code> 类或其子类的实例。当一个方法出现异常后便抛出一个异常对象，该对象中包含有异常信息，调用这个对象的方法可以捕获到这个异常并可以对其进行处理。</p><p>Java 的异常处理是通过5个关键词来实现的：<code>try</code>、<code>catch</code>、<code>throw</code>、<code>throws</code> 和 <code>finally</code>。</p><p>一般情况下是用 <code>try</code> 来执行一段程序，如果系统会抛出（throw）一个异常对象，可以通过它的类型来捕获（catch）它，或通过总是执行代码块（finally）来处理；<code>try</code> 用来指定一块预防所有异常的程序；<code>catch</code> 子句紧跟在 <code>try</code> 块后面，用来指定你想要捕获的异常的类型；<code>throw</code> 语句用来明确地抛出一个异常；<code>throws</code> 用来声明一个方法可能抛出的各种异常（当然声明异常时允许无病呻吟）；<code>finally</code> 为确保一段代码不管发生什么异常状况都要被执行；<code>try</code> 语句可以嵌套，每当遇到一个 <code>try</code> 语句，异常的结构就会被放入异常栈中，直到所有的 <code>try</code> 语句都完成。如果下一级的 <code>try</code> 语句没有对某种异常进行处理，异常栈就会执行出栈操作，直到遇到有处理这种异常的 <code>try</code> 语句或者最终将异常抛给 JVM。</p><blockquote><h3 id="运行时异常与受检异常有何异同？"><a href="#运行时异常与受检异常有何异同？" class="headerlink" title="运行时异常与受检异常有何异同？"></a>运行时异常与受检异常有何异同？</h3></blockquote><p>答：异常表示程序运行过程中可能出现的非正常状态，运行时异常表示虚拟机的通常操作中可能遇到的异常，是一种常见运行错误，只要程序设计得没有问题通常就不会发生。受检异常跟程序运行的上下文环境有关，即使程序设计无误，仍然可能因使用的问题而引发。Java 编译器要求方法必须声明抛出可能发生的受检异常，但是并不要求必须声明抛出未被捕获的运行时异常。异常和继承一样，是面向对象程序设计中经常被滥用的东西，在《Effective Java》中对异常的使用给出了以下指导原则：</p><ul><li>不要将异常处理用于正常的控制流（设计良好的 API 不应该强迫它的调用者为了正常的控制流而使用异常）</li><li>对可以恢复的情况使用受检异常，对编程错误使用运行时异常</li><li>避免不必要的使用受检异常（可以通过一些状态检测手段来避免异常的发生）</li><li>优先使用标准的异常</li><li>每个方法抛出的异常都要有文档</li><li>保持异常的原子性</li><li>不要在 <code>catch</code> 中忽略掉捕获到的异常</li></ul><blockquote><h3 id="列出一些你常见的运行时异常？"><a href="#列出一些你常见的运行时异常？" class="headerlink" title="列出一些你常见的运行时异常？"></a>列出一些你常见的运行时异常？</h3></blockquote><p>答：</p><ul><li><code>ArithmeticException</code>：算术异常</li><li><code>ClassCastException</code>：类转换异常</li><li><code>IllegalArgumentException</code>：非法参数异常</li><li><code>IndexOutOfBoundsException</code>：下标越界异常</li><li><code>NullPointerException</code>：空指针异常</li><li><code>SecurityException</code>：安全异常</li></ul><blockquote><h3 id="阐述-final、finally、finalize-的区别。"><a href="#阐述-final、finally、finalize-的区别。" class="headerlink" title="阐述 final、finally、finalize 的区别。"></a>阐述 <code>final</code>、<code>finally</code>、<code>finalize</code> 的区别。</h3></blockquote><p>答：</p><ul><li><code>final</code>：修饰符（关键字）有三种用法：如果一个类被声明为 <code>final</code>，意味着它不能再派生出新的子类，即不能被继承，因此它和 <code>abstract</code> 是反义词。将变量声明为 <code>final</code>，可以保证它们在使用中不被改变，被声明为 <code>final</code> 的变量必须在声明时给定初值，而在以后的引用中只能读取不可修改。被声明为 <code>final</code> 的方法也同样只能使用，不能在子类中被重写。</li><li><code>finally</code>：通常放在 <code>try…catch…</code> 的后面构造总是执行代码块，这就意味着程序无论正常执行还是发生异常，这里的代码只要 JVM 不关闭都能执行，可以将释放外部资源的代码写在 <code>finally</code> 块中。</li><li><code>finalize</code>：<code>Object</code> 类中定义的方法，Java 中允许使用 <code>finalize()</code> 方法在垃圾收集器将对象从内存中清除出去之前做必要的清理工作。这个方法是由垃圾收集器在销毁对象时调用的，通过重写 <code>finalize()</code> 方法可以整理系统资源或者执行其他清理工作。</li></ul><blockquote><h3 id="类-ExampleA-继承-Exception，类-ExampleB-继承-ExampleA。有如下代码片段："><a href="#类-ExampleA-继承-Exception，类-ExampleB-继承-ExampleA。有如下代码片段：" class="headerlink" title="类 ExampleA 继承 Exception，类 ExampleB 继承 ExampleA。有如下代码片段："></a>类 <code>ExampleA</code> 继承 <code>Exception</code>，类 <code>ExampleB</code> 继承 <code>ExampleA</code>。有如下代码片段：</h3><p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">try</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">ExampleB</span><span class="token punctuation">(</span><span class="token string">"b"</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span> <span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token class-name">ExampleA</span> e<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"ExampleA"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span> <span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Exception"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p>请问执行此段代码的输出是什么？</p></blockquote><p>答：输出：<code>ExampleA</code>。根据里氏代换原则（能使用父类型的地方一定能使用子类型），抓取<code>ExampleA</code> 类型异常的 <code>catch</code> 块能够抓住 <code>try</code> 块中抛出的 <code>ExampleB</code> 类型的异常。</p><p>面试题 - 说出下面代码的运行结果。（此题的出处是《Java编程思想》一书）</p><p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">class</span> <span class="token class-name">Annoyance</span> <span class="token keyword">extends</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name">Sneeze</span> <span class="token keyword">extends</span> <span class="token class-name">Annoyance</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name">Human</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span>         <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>                <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Sneeze</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>             <span class="token keyword">catch</span> <span class="token punctuation">(</span> <span class="token class-name">Annoyance</span> a <span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Caught Annoyance"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">throw</span> a<span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>         <span class="token keyword">catch</span> <span class="token punctuation">(</span> <span class="token class-name">Sneeze</span> s <span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Caught Sneeze"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">return</span> <span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">finally</span> <span class="token punctuation">&#123;</span>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Hello World!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span><span class="token comment">//       输出结果：</span><span class="token comment">//       Caught Annoyance</span><span class="token comment">//       Caught Sneeze</span><span class="token comment">//       Hello World!</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p>]]></content>
      
      
      <categories>
          
          <category> 教程笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 面试题 </tag>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Java 面试题解析</title>
      <link href="post/d2aef718.html"/>
      <url>post/d2aef718.html</url>
      
        <content type="html"><![CDATA[<h2 id="Java-基础"><a href="#Java-基础" class="headerlink" title="Java 基础"></a><a href="/post/11ea51ea.html">Java 基础</a></h2><h2 id="Java-容器"><a href="#Java-容器" class="headerlink" title="Java 容器"></a><a href="/post/d07acd09.html">Java 容器</a></h2><h2 id="Java-并发"><a href="#Java-并发" class="headerlink" title="Java 并发"></a><a href="/post/32cf50db.html">Java 并发</a></h2><h2 id="Java-IO流"><a href="#Java-IO流" class="headerlink" title="Java IO流"></a><a href="/post/af128a42.html">Java IO流</a></h2><h2 id="Java-数据库"><a href="#Java-数据库" class="headerlink" title="Java 数据库"></a><a href="/post/73adfcb0.html">Java 数据库</a></h2><h2 id="Java-反射"><a href="#Java-反射" class="headerlink" title="Java 反射"></a><a href="/post/9fbf7373.html">Java 反射</a></h2><h2 id="Java-设计模式"><a href="#Java-设计模式" class="headerlink" title="Java 设计模式"></a><a href="/post/1cfbd3b3.html">Java 设计模式</a></h2><h2 id="Java-Web"><a href="#Java-Web" class="headerlink" title="Java Web"></a><a href="/post/d24a315e.html">Java Web</a></h2><h2 id="Java-EE"><a href="#Java-EE" class="headerlink" title="Java EE"></a><a href="/post/dc04fa32.html">Java EE</a></h2>]]></content>
      
      
      <categories>
          
          <category> 教程笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 面试题 </tag>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>排序算法</title>
      <link href="post/735e5788.html"/>
      <url>post/735e5788.html</url>
      
        <content type="html"><![CDATA[<h1 id="排序算法"><a href="#排序算法" class="headerlink" title="排序算法"></a>排序算法</h1><p>排序是计算机程序设计中的一种重要操作，它的功能是将一个数据元素（或记录）的任意序列，重新排列成一个关键字有序的序列，排序就是把集合中的元素按照一定的次序排序在一起。</p><p>排序算法可以分为内部排序和外部排序，内部排序是数据记录在内存中进行排序，而外部排序是因排序的数据很大，一次不能容纳全部的排序记录，在排序过程中需要访问外存。常见的内部排序算法有：插入排序、希尔排序、选择排序、冒泡排序、归并排序、快速排序、堆排序、基数排序等。</p><h2 id="相关概念"><a href="#相关概念" class="headerlink" title="相关概念"></a>相关概念</h2><ul><li>稳定排序：如果 a 原本在 b 的前面，且 a == b，排序之后 a 仍然在 b 的前面，则为稳定排序。</li><li>非稳定排序：如果 a 原本在 b 的前面，且 a == b，排序之后 a 可能不在 b 的前面，则为非稳定排序。</li><li>原地排序：原地排序就是指在排序过程中不申请多余的存储空间，只利用原来存储待排数据的存储空间进行比较和交换的数据排序。</li><li>非原地排序：需要利用额外的数组来辅助排序。</li><li>时间复杂度：一个算法执行所消耗的时间。</li><li>空间复杂度：运行完一个算法所需的内存大小。</li></ul><h2 id="时间复杂度对比"><a href="#时间复杂度对比" class="headerlink" title="时间复杂度对比"></a>时间复杂度对比</h2><div class="table-container"><table><thead><tr><th>排序算法</th><th>平均时间复杂度</th><th>最坏时间复杂度</th><th>最优时间复杂度</th><th>空间复杂度</th><th>排序方式</th><th>稳定性</th></tr></thead><tbody><tr><td><a href="#冒泡排序">冒泡排序</a></td><td>O(n²)</td><td>O(n²)</td><td>O(n)</td><td>O(1)</td><td>In-Place</td><td>稳定</td></tr><tr><td><a href="#选择排序">选择排序</a></td><td>O(n²)</td><td>O(n²)</td><td>O(n²)</td><td>O(1)</td><td>In-Place</td><td>不稳定</td></tr><tr><td><a href="#插入排序">插入排序</a></td><td>O(n²)</td><td>O(n²)</td><td>O(n)</td><td>O(1)</td><td>In-Place</td><td>稳定</td></tr><tr><td><a href="#希尔排序">希尔排序</a></td><td>O(n¹˙³)</td><td>O(n²)</td><td>O(n)</td><td>O(1)</td><td>In-Place</td><td>不稳定</td></tr><tr><td><a href="#归并排序">归并排序</a></td><td>O(nlogn)</td><td>O(nlogn)</td><td>O(nlogn)</td><td>O(n)</td><td>Out-Place</td><td>稳定</td></tr><tr><td><a href="#快速排序">快速排序</a></td><td>O(nlogn)</td><td>O(n²)</td><td>O(nlogn)</td><td>O(logn)</td><td>In-Place</td><td>不稳定</td></tr><tr><td><a href="#堆排序">堆排序</a></td><td>O(nlogn)</td><td>O(nlogn)</td><td>O(nlogn)</td><td>O(1)</td><td>In-Place</td><td>不稳定</td></tr><tr><td><a href="#计数排序">计数排序</a></td><td>O(n+k)</td><td>O(n+k)</td><td>O(n+k)</td><td>O(k)</td><td>Out-Place</td><td>稳定</td></tr><tr><td><a href="#桶排序">桶排序</a></td><td>O(n+k)</td><td>O(n²)</td><td>O(n)</td><td>O(n+k)</td><td>Out-Place</td><td>稳定</td></tr><tr><td><a href="#基数排序">基数排序</a></td><td>O(n×k)</td><td>O(n×k)</td><td>O(n×k)</td><td>O(n+k)</td><td>Out-Place</td><td>稳定</td></tr></tbody></table></div><p><strong>注意：</strong></p><ul><li>n：数据规模</li><li>k：&quot;桶&quot;的个数</li><li>In-place：占用常数内存，不占用额外内存</li><li>Out-place：占用额外内存</li><li>稳定性：排序后 2 个相等键值的顺序和排序之前它们的顺序相同</li></ul><h1 id="冒泡排序"><a href="#冒泡排序" class="headerlink" title="冒泡排序"></a>冒泡排序</h1><p>冒泡排序（Bubble Sort）又称为泡式排序，是一种简单的排序算法。它重复地走访过要排序的数列，一次比较两个元素，如果他们的顺序错误就把他们交换过来。走访数列的工作是重复地进行直到没有再需要交换，也就是说该数列已经排序完成。这个算法的名字由来是因为越小的元素会经由交换慢慢“浮”到数列的顶端。</p><p>冒泡排序对 n 个项目需要 O(n²) 的比较次数，且可以原地排序。尽管这个算法是最简单了解和实现的排序算法之一，但它对于包含大量的元素的数列排序是很没有效率的。</p><h2 id="算法步骤"><a href="#算法步骤" class="headerlink" title="算法步骤"></a>算法步骤</h2><ol><li>比较相邻的元素。如果第一个比第二个大，就交换他们两个；</li><li>对每一对相邻元素作同样的工作，从开始第一对到结尾的最后一对。这步做完后，最后的元素会是最大的；</li><li>针对所有的元素重复以上的步骤，除了最后一个；</li><li>持续每次对越来越少的元素重复上面的步骤，直到没有任何一对数字需要比较。</li></ol><h2 id="动图展示"><a href="#动图展示" class="headerlink" title="动图展示"></a>动图展示</h2><p><img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="/images/post/sort_algorithm/bubble_sort.gif" alt></p><h2 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h2><h3 id="Java"><a href="#Java" class="headerlink" title="Java"></a>Java</h3><p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">bubbleSort</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> array<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">int</span> temp<span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> array<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">boolean</span> <span class="token class-name">Flag</span> <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span> <span class="token comment">// 是否发生交换。没有交换，提前跳出外层循环</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> array<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span> <span class="token operator">-</span> i<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>array<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">></span> array<span class="token punctuation">[</span>j <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                temp <span class="token operator">=</span> array<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span>                array<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> array<span class="token punctuation">[</span>j <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>                array<span class="token punctuation">[</span>j <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> temp<span class="token punctuation">;</span>                <span class="token class-name">Flag</span> <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">Flag</span><span class="token punctuation">)</span>        <span class="token punctuation">&#123;</span>            <span class="token keyword">break</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">return</span> array<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h3 id="Python"><a href="#Python" class="headerlink" title="Python"></a>Python</h3><p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">bubble_sort</span><span class="token punctuation">(</span>iterable<span class="token punctuation">)</span><span class="token punctuation">:</span>    new_arr <span class="token operator">=</span> arr<span class="token punctuation">(</span>iterable<span class="token punctuation">)</span>    arr_len <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>new_arr<span class="token punctuation">)</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>arr_len<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>arr_len <span class="token operator">-</span> i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">if</span> new_arr<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">></span> new_arr<span class="token punctuation">[</span>j <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">:</span>                new_arr<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">,</span> new_arr<span class="token punctuation">[</span>j <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> new_arr<span class="token punctuation">[</span>j <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> new_arr<span class="token punctuation">[</span>j<span class="token punctuation">]</span>    <span class="token keyword">return</span> new_arr<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h1 id="选择排序"><a href="#选择排序" class="headerlink" title="选择排序"></a>选择排序</h1><p>选择排序（Selection sort）是一种简单直观的排序算法。它的工作原理如下。首先在未排序序列中找到最小（大）元素，存放到排序序列的起始位置，然后，再从剩余未排序元素中继续寻找最小（大）元素，然后放到已排序序列的末尾。以此类推，直到所有元素均排序完毕。</p><p>选择排序的主要优点与数据移动有关。如果某个元素位于正确的最终位置上，则它不会被移动。选择排序每次交换一对元素，它们当中至少有一个将被移到其最终位置上，因此对 n 个元素的表进行排序总共进行至多 (n-1) 次交换。在所有的完全依靠交换去移动元素的排序方法中，选择排序属于非常好的一种。</p><h2 id="算法步骤-1"><a href="#算法步骤-1" class="headerlink" title="算法步骤"></a>算法步骤</h2><ol><li>首先在未排序序列中找到最小（大）元素，存放到排序序列的起始位置；</li><li>再从剩余未排序元素中继续寻找最小（大）元素，然后放到已排序序列的末尾；</li><li>重复第二步，直到所有元素均排序完毕。</li></ol><h2 id="动图展示-1"><a href="#动图展示-1" class="headerlink" title="动图展示"></a>动图展示</h2><p><img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="/images/post/sort_algorithm/selection_sort.gif" alt></p><h2 id="代码实现-1"><a href="#代码实现-1" class="headerlink" title="代码实现"></a>代码实现</h2><h3 id="Java-1"><a href="#Java-1" class="headerlink" title="Java"></a>Java</h3><p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">selectionSort</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> arr<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// 总共要经过 n-1 轮比较</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> arr<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">int</span> min <span class="token operator">=</span> i<span class="token punctuation">;</span>        <span class="token comment">// 每轮需要比较的次数 N-i</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> arr<span class="token punctuation">.</span>length<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>arr<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">&lt;</span> arr<span class="token punctuation">[</span>min<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token comment">// 记录目前能找到的最小值元素的下标</span>                min <span class="token operator">=</span> j<span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>        <span class="token comment">// 将找到的最小值和i位置所在的值进行交换</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">!=</span> min<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">int</span> tmp <span class="token operator">=</span> arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>            arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> arr<span class="token punctuation">[</span>min<span class="token punctuation">]</span><span class="token punctuation">;</span>            arr<span class="token punctuation">[</span>min<span class="token punctuation">]</span> <span class="token operator">=</span> tmp<span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">return</span> arr<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h3 id="Python-1"><a href="#Python-1" class="headerlink" title="Python"></a>Python</h3><p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">selection_sort</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        minIndex <span class="token operator">=</span> i        <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">if</span> arr<span class="token punctuation">[</span>minIndex<span class="token punctuation">]</span> <span class="token operator">></span> arr<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">:</span>                minIndex <span class="token operator">=</span> j        <span class="token keyword">if</span> i <span class="token operator">==</span> minIndex<span class="token punctuation">:</span>            <span class="token keyword">pass</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> arr<span class="token punctuation">[</span>minIndex<span class="token punctuation">]</span> <span class="token operator">=</span> arr<span class="token punctuation">[</span>minIndex<span class="token punctuation">]</span><span class="token punctuation">,</span> arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span>    <span class="token keyword">return</span> arr<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h1 id="插入排序"><a href="#插入排序" class="headerlink" title="插入排序"></a>插入排序</h1><p>插入排序（Insertion Sort）是一种简单直观的排序算法。它的工作原理是通过构建有序序列，对于未排序数据，在已排序序列中从后向前扫描，找到相应位置并插入。插入排序在实现上，通常采用 In-Place 排序（即只需用到 O(1) 的额外空间的排序），因而在从后向前扫描过程中，需要反复把已排序元素逐步向后挪位，为最新元素提供插入空间。</p><h2 id="算法步骤-2"><a href="#算法步骤-2" class="headerlink" title="算法步骤"></a>算法步骤</h2><ol><li>从第一个元素开始，该元素可以认为已经被排序；</li><li>取出下一个元素，在已经排序的元素序列中从后向前扫描；</li><li>如果该元素（已排序）大于新元素，将该元素移到下一位置；</li><li>重复步骤 3，直到找到已排序的元素小于或者等于新元素的位置；</li><li>将新元素插入到该位置后；</li><li>重复步骤 2~5。</li></ol><h2 id="动图展示-2"><a href="#动图展示-2" class="headerlink" title="动图展示"></a>动图展示</h2><p><img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="/images/post/sort_algorithm/insertion_sort.gif" alt></p><h2 id="代码实现-2"><a href="#代码实现-2" class="headerlink" title="代码实现"></a>代码实现</h2><h3 id="Java-2"><a href="#Java-2" class="headerlink" title="Java"></a>Java</h3><p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">insertionSort</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> arr<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// 从下标为 1 的元素开始选择合适的位置插入，因为下标为 0 的元素，默认是有序的</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> arr<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">// 记录要插入的数据</span>        <span class="token keyword">int</span> tmp <span class="token operator">=</span> arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token comment">// 从已经排序的序列最右边的开始比较，找到比其小的数</span>        <span class="token keyword">int</span> j <span class="token operator">=</span> i<span class="token punctuation">;</span>        <span class="token keyword">while</span> <span class="token punctuation">(</span>j <span class="token operator">></span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> tmp <span class="token operator">&lt;</span> arr<span class="token punctuation">[</span>j <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            arr<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> arr<span class="token punctuation">[</span>j <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>            j<span class="token operator">--</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token comment">// 存在比其小的数，插入</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>j <span class="token operator">!=</span> i<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            arr<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> tmp<span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">return</span> arr<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h3 id="Python-2"><a href="#Python-2" class="headerlink" title="Python"></a>Python</h3><p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">insertion_sort</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        preIndex <span class="token operator">=</span> i <span class="token operator">-</span> <span class="token number">1</span>        current <span class="token operator">=</span> arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span>        <span class="token keyword">while</span> preIndex <span class="token operator">>=</span> <span class="token number">0</span> <span class="token keyword">and</span> arr<span class="token punctuation">[</span>preIndex<span class="token punctuation">]</span> <span class="token operator">></span> current<span class="token punctuation">:</span>            arr<span class="token punctuation">[</span>preIndex <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> arr<span class="token punctuation">[</span>preIndex<span class="token punctuation">]</span>            preIndex <span class="token operator">-=</span> <span class="token number">1</span>        arr<span class="token punctuation">[</span>preIndex <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> current    <span class="token keyword">return</span> arr<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h1 id="希尔排序"><a href="#希尔排序" class="headerlink" title="希尔排序"></a>希尔排序</h1><p>希尔排序（Shellsort），也称递减增量排序算法，是插入排序的一种更高效的改进版本。希尔排序是非稳定排序算法。</p><p>希尔排序是基于插入排序的以下两点性质而提出改进方法的：</p><ul><li>插入排序在对几乎已经排好序的数据操作时，效率高，即可以达到线性排序的效率</li><li>但插入排序一般来说是低效的，因为插入排序每次只能将数据移动一位</li></ul><p>希尔排序的基本思想是：先将整个待排序的记录序列分割成为若干子序列分别进行直接插入排序，待整个序列中的记录&quot;基本有序&quot;时，再对全体记录进行依次直接插入排序。</p><h2 id="算法步骤-3"><a href="#算法步骤-3" class="headerlink" title="算法步骤"></a>算法步骤</h2><ol><li>选择一个增量序列 t₁, t₂, ..., tₖ，其中 tᵢ &gt; tⱼ, tₖ = 1；</li><li>按增量序列个数 k，对序列进行 k 趟排序；</li><li>每趟排序，根据对应的增量 tᵢ，将待排序列分割成若干长度为 m 的子序列，分别对各子表进行直接插入排序。仅增量因子为 1 时，整个序列作为一个表来处理，表长度即为整个序列的长度。</li></ol><h2 id="动图展示-3"><a href="#动图展示-3" class="headerlink" title="动图展示"></a>动图展示</h2><p><img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="/images/post/sort_algorithm/_sort.gif" alt></p><h2 id="代码实现-3"><a href="#代码实现-3" class="headerlink" title="代码实现"></a>代码实现</h2><h3 id="Java-3"><a href="#Java-3" class="headerlink" title="Java"></a>Java</h3><p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">shellSort</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> arr<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">int</span> length <span class="token operator">=</span> arr<span class="token punctuation">.</span>length<span class="token punctuation">;</span>    <span class="token keyword">int</span> temp<span class="token punctuation">;</span>    <span class="token comment">// 动态定义间隔序列</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> step <span class="token operator">=</span> length <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span> step <span class="token operator">>=</span> <span class="token number">1</span><span class="token punctuation">;</span> step <span class="token operator">/=</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">// 插入排序</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> step<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            temp <span class="token operator">=</span> arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>            <span class="token keyword">int</span> j <span class="token operator">=</span> i <span class="token operator">-</span> step<span class="token punctuation">;</span>            <span class="token keyword">while</span> <span class="token punctuation">(</span>j <span class="token operator">>=</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> arr<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">></span> temp<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                arr<span class="token punctuation">[</span>j <span class="token operator">+</span> step<span class="token punctuation">]</span> <span class="token operator">=</span> arr<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span>                j <span class="token operator">-=</span> step<span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>            arr<span class="token punctuation">[</span>j <span class="token operator">+</span> step<span class="token punctuation">]</span> <span class="token operator">=</span> temp<span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h3 id="Python-3"><a href="#Python-3" class="headerlink" title="Python"></a>Python</h3><p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">shell_sort</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">:</span>    n <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span>    <span class="token comment"># 初始步長</span>    gap <span class="token operator">=</span> n <span class="token operator">//</span> <span class="token number">2</span>    <span class="token keyword">while</span> gap <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">:</span>        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>gap<span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token comment"># 每个步長進行插入排序</span>            temp <span class="token operator">=</span> arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span>            j <span class="token operator">=</span> i            <span class="token comment"># 插入排序</span>            <span class="token keyword">while</span> j <span class="token operator">>=</span> <span class="token number">0</span> <span class="token keyword">and</span> j<span class="token operator">-</span>gap <span class="token operator">>=</span> <span class="token number">0</span> <span class="token keyword">and</span> arr<span class="token punctuation">[</span>j <span class="token operator">-</span> gap<span class="token punctuation">]</span> <span class="token operator">></span> temp<span class="token punctuation">:</span>                arr<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> arr<span class="token punctuation">[</span>j <span class="token operator">-</span> gap<span class="token punctuation">]</span>                j <span class="token operator">-=</span> gap            arr<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> temp        <span class="token comment"># 得到新的步長</span>        gap <span class="token operator">=</span> gap <span class="token operator">//</span> <span class="token number">2</span>    <span class="token keyword">return</span> arr<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h1 id="归并排序"><a href="#归并排序" class="headerlink" title="归并排序"></a>归并排序</h1><p>归并排序（Merge sort）是建立在归并操作上的一种有效的排序算法。该算法是采用分治法（Divide and Conquer）的一个非常典型的应用。</p><p>作为一种典型的分而治之思想的算法应用，归并排序的实现由两种方法：</p><p>自上而下的递归（所有递归的方法都可以用迭代重写，所以就有了第 2 种方法）；自下而上的迭代；</p><h2 id="算法步骤-4"><a href="#算法步骤-4" class="headerlink" title="算法步骤"></a>算法步骤</h2><p><strong>递归法（Top-down）</strong></p><ol><li>申请空间，使其大小为两个已经排序序列之和，该空间用来存放合并后的序列；</li><li>设定两个指针，最初位置分别为两个已经排序序列的起始位置；</li><li>比较两个指针所指向的元素，选择相对小的元素放入到合并空间，并移动指针到下一位置；</li><li>重复步骤3直到某一指针到达序列尾；</li><li>将另一序列剩下的所有元素直接复制到合并序列尾。</li></ol><p><strong>迭代法（Bottom-up）</strong></p><p>原理如下（假设序列共有 n 个元素）：</p><ol><li>将序列每相邻两个数字进行归并操作，形成 ceil(n/2) 个序列，排序后每个序列包含两/一个元素；</li><li>若此时序列数不是1个则将上述序列再次归并，形成 ceil(n/4) 个序列，每个序列包含四/三个元素；</li><li>重复步骤 2，直到所有元素排序完毕，即序列数为 1。</li></ol><h2 id="动图展示-4"><a href="#动图展示-4" class="headerlink" title="动图展示"></a>动图展示</h2><p><img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="/images/post/sort_algorithm/merge_sort.gif" alt></p><h2 id="代码实现-4"><a href="#代码实现-4" class="headerlink" title="代码实现"></a>代码实现</h2><h3 id="Java-4"><a href="#Java-4" class="headerlink" title="Java"></a>Java</h3><p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// 递归版：</span><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">merge_sort_recursive</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> arr<span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> result<span class="token punctuation">,</span> <span class="token keyword">int</span> start<span class="token punctuation">,</span> <span class="token keyword">int</span> end<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>start <span class="token operator">>=</span> end<span class="token punctuation">)</span>        <span class="token keyword">return</span><span class="token punctuation">;</span>    <span class="token keyword">int</span> len <span class="token operator">=</span> end <span class="token operator">-</span> start<span class="token punctuation">,</span> mid <span class="token operator">=</span> <span class="token punctuation">(</span>len <span class="token operator">>></span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span> start<span class="token punctuation">;</span>    <span class="token keyword">int</span> start1 <span class="token operator">=</span> start<span class="token punctuation">,</span> end1 <span class="token operator">=</span> mid<span class="token punctuation">;</span>    <span class="token keyword">int</span> start2 <span class="token operator">=</span> mid <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> end2 <span class="token operator">=</span> end<span class="token punctuation">;</span>    <span class="token function">merge_sort_recursive</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span> result<span class="token punctuation">,</span> start1<span class="token punctuation">,</span> end1<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//左边归并排序，使得左子序列有序</span>    <span class="token function">merge_sort_recursive</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span> result<span class="token punctuation">,</span> start2<span class="token punctuation">,</span> end2<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//右边归并排序，使得右子序列有序</span>    <span class="token keyword">int</span> k <span class="token operator">=</span> start<span class="token punctuation">;</span>    <span class="token keyword">while</span> <span class="token punctuation">(</span>start1 <span class="token operator">&lt;=</span> end1 <span class="token operator">&amp;&amp;</span> start2 <span class="token operator">&lt;=</span> end2<span class="token punctuation">)</span>        result<span class="token punctuation">[</span>k<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> arr<span class="token punctuation">[</span>start1<span class="token punctuation">]</span> <span class="token operator">&lt;</span> arr<span class="token punctuation">[</span>start2<span class="token punctuation">]</span> <span class="token operator">?</span> arr<span class="token punctuation">[</span>start1<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">:</span> arr<span class="token punctuation">[</span>start2<span class="token operator">++</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">while</span> <span class="token punctuation">(</span>start1 <span class="token operator">&lt;=</span> end1<span class="token punctuation">)</span>        result<span class="token punctuation">[</span>k<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> arr<span class="token punctuation">[</span>start1<span class="token operator">++</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">while</span> <span class="token punctuation">(</span>start2 <span class="token operator">&lt;=</span> end2<span class="token punctuation">)</span>        result<span class="token punctuation">[</span>k<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> arr<span class="token punctuation">[</span>start2<span class="token operator">++</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span>k <span class="token operator">=</span> start<span class="token punctuation">;</span> k <span class="token operator">&lt;=</span> end<span class="token punctuation">;</span> k<span class="token operator">++</span><span class="token punctuation">)</span>        arr<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> result<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">merge_sort</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> arr<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">int</span> len <span class="token operator">=</span> arr<span class="token punctuation">.</span>length<span class="token punctuation">;</span>    <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> result <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">int</span><span class="token punctuation">[</span>len<span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token function">merge_sort_recursive</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span> result<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> len <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">// 迭代版：</span><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">merge_sort</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> arr<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> orderedArr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">int</span><span class="token punctuation">[</span>arr<span class="token punctuation">.</span>length<span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> arr<span class="token punctuation">.</span>length <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">;</span> i <span class="token operator">*=</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> <span class="token punctuation">(</span>arr<span class="token punctuation">.</span>length <span class="token operator">+</span> i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">/</span> i<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">int</span> left <span class="token operator">=</span> i <span class="token operator">*</span> j<span class="token punctuation">;</span>            <span class="token keyword">int</span> mid <span class="token operator">=</span> left <span class="token operator">+</span> i <span class="token operator">/</span> <span class="token number">2</span> <span class="token operator">>=</span> arr<span class="token punctuation">.</span>length <span class="token operator">?</span> <span class="token punctuation">(</span>arr<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token punctuation">(</span>left <span class="token operator">+</span> i <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">int</span> right <span class="token operator">=</span> i <span class="token operator">*</span> <span class="token punctuation">(</span>j <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span> <span class="token operator">>=</span> arr<span class="token punctuation">.</span>length <span class="token operator">?</span> <span class="token punctuation">(</span>arr<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token punctuation">(</span>i <span class="token operator">*</span> <span class="token punctuation">(</span>j <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">int</span> start <span class="token operator">=</span> left<span class="token punctuation">,</span> l <span class="token operator">=</span> left<span class="token punctuation">,</span> m <span class="token operator">=</span> mid<span class="token punctuation">;</span>            <span class="token keyword">while</span> <span class="token punctuation">(</span>l <span class="token operator">&lt;</span> mid <span class="token operator">&amp;&amp;</span> m <span class="token operator">&lt;=</span> right<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>arr<span class="token punctuation">[</span>l<span class="token punctuation">]</span> <span class="token operator">&lt;</span> arr<span class="token punctuation">[</span>m<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    orderedArr<span class="token punctuation">[</span>start<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> arr<span class="token punctuation">[</span>l<span class="token operator">++</span><span class="token punctuation">]</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>                    orderedArr<span class="token punctuation">[</span>start<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> arr<span class="token punctuation">[</span>m<span class="token operator">++</span><span class="token punctuation">]</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span>            <span class="token keyword">while</span> <span class="token punctuation">(</span>l <span class="token operator">&lt;</span> mid<span class="token punctuation">)</span>                orderedArr<span class="token punctuation">[</span>start<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> arr<span class="token punctuation">[</span>l<span class="token operator">++</span><span class="token punctuation">]</span><span class="token punctuation">;</span>            <span class="token keyword">while</span> <span class="token punctuation">(</span>m <span class="token operator">&lt;=</span> right<span class="token punctuation">)</span>                orderedArr<span class="token punctuation">[</span>start<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> arr<span class="token punctuation">[</span>m<span class="token operator">++</span><span class="token punctuation">]</span><span class="token punctuation">;</span>            <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">arraycopy</span><span class="token punctuation">(</span>orderedArr<span class="token punctuation">,</span> left<span class="token punctuation">,</span> arr<span class="token punctuation">,</span> left<span class="token punctuation">,</span> right <span class="token operator">-</span> left <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h3 id="Python-4"><a href="#Python-4" class="headerlink" title="Python"></a>Python</h3><p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">mergeSort</span><span class="token punctuation">(</span>nums<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>nums<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">2</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> nums    mid <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>nums<span class="token punctuation">)</span> <span class="token operator">//</span> <span class="token number">2</span>    left <span class="token operator">=</span> mergeSort<span class="token punctuation">(</span>nums<span class="token punctuation">[</span><span class="token punctuation">:</span>mid<span class="token punctuation">]</span><span class="token punctuation">)</span>    right <span class="token operator">=</span> mergeSort<span class="token punctuation">(</span>nums<span class="token punctuation">[</span>mid<span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    result <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>    <span class="token keyword">while</span> left <span class="token keyword">and</span> right<span class="token punctuation">:</span>        <span class="token keyword">if</span> left<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">&lt;=</span> right<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">:</span>            result<span class="token punctuation">.</span>append<span class="token punctuation">(</span>left<span class="token punctuation">.</span>pop<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            result<span class="token punctuation">.</span>append<span class="token punctuation">(</span>right<span class="token punctuation">.</span>pop<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> left<span class="token punctuation">:</span>        result <span class="token operator">+=</span> left    <span class="token keyword">if</span> right<span class="token punctuation">:</span>        result <span class="token operator">+=</span> right    <span class="token keyword">return</span> result<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h1 id="快速排序"><a href="#快速排序" class="headerlink" title="快速排序"></a>快速排序</h1><p>快速排序（Quicksort），又称分区交换排序（partition-exchange sort），简称快排，一种排序算法，最早由东尼·霍尔提出。在平均状况下，排序 n 个项目要 O(nlogn) 次比较。在最坏状况下则需要 O(n²)次比较，但这种状况并不常见。事实上，快速排序(nlogn)通常明显比其他算法更快，因为它的内部循环（inner loop）可以在大部分的架构上很有效率地达成。</p><h2 id="算法步骤-5"><a href="#算法步骤-5" class="headerlink" title="算法步骤"></a>算法步骤</h2><ol><li>挑选基准值：从数列中挑出一个元素，称为“基准”（pivot）；</li><li>分割：重新排序数列，所有比基准值小的元素摆放在基准前面，所有比基准值大的元素摆在基准后面（与基准值相等的数可以到任何一边）。在这个分割结束之后，对基准值的排序就已经完成；</li><li>递归排序子序列：递归地将小于基准值元素的子序列和大于基准值元素的子序列排序。</li></ol><h2 id="动图展示-5"><a href="#动图展示-5" class="headerlink" title="动图展示"></a>动图展示</h2><p><img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="/images/post/sort_algorithm/quick_sort.gif" alt></p><h2 id="代码实现-5"><a href="#代码实现-5" class="headerlink" title="代码实现"></a>代码实现</h2><h3 id="Java-5"><a href="#Java-5" class="headerlink" title="Java"></a>Java</h3><p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">quickSort</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> arr<span class="token punctuation">,</span> <span class="token keyword">int</span> left<span class="token punctuation">,</span> <span class="token keyword">int</span> right<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">int</span> left <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token keyword">int</span> right <span class="token operator">=</span> arr<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span>    <span class="token comment">// 当传递的目标数组含有两个以上的元素时，进行递归调用。（即：当传递的目标数组只含有一个元素时，此趟排序结束）</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>left <span class="token operator">&lt;</span> right<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">int</span> partitionIndex <span class="token operator">=</span> <span class="token function">partition</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span> left<span class="token punctuation">,</span> right<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//获取关键值的下标（快排的核心）</span>        <span class="token function">quickSort</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span> left<span class="token punctuation">,</span> partitionIndex <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//递归调用，快排划分出来的左区间</span>        <span class="token function">quickSort</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span> partitionIndex <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> right<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//递归调用，快排划分出来的右区间</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">return</span> arr<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">partition</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> arr<span class="token punctuation">,</span> <span class="token keyword">int</span> left<span class="token punctuation">,</span> <span class="token keyword">int</span> right<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// 设定基准值（pivot）</span>    <span class="token keyword">int</span> pivot <span class="token operator">=</span> left<span class="token punctuation">;</span>    <span class="token keyword">int</span> index <span class="token operator">=</span> pivot <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> index<span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> right<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">&lt;</span> arr<span class="token punctuation">[</span>pivot<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token function">swap</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span> i<span class="token punctuation">,</span> index<span class="token punctuation">)</span><span class="token punctuation">;</span>            index<span class="token operator">++</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token function">swap</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span> pivot<span class="token punctuation">,</span> index <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> index <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">swap</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> arr<span class="token punctuation">,</span> <span class="token keyword">int</span> i<span class="token punctuation">,</span> <span class="token keyword">int</span> j<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">int</span> temp <span class="token operator">=</span> arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>    arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> arr<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span>    arr<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> temp<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h3 id="Python-5"><a href="#Python-5" class="headerlink" title="Python"></a>Python</h3><p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">quickSort</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span> left<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> right<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    left <span class="token operator">=</span> <span class="token number">0</span> <span class="token keyword">if</span> <span class="token keyword">not</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>left<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">,</span> <span class="token builtin">float</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">else</span> left    right <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span> <span class="token keyword">if</span> <span class="token keyword">not</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>right<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">,</span> <span class="token builtin">float</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">else</span> right    <span class="token keyword">if</span> left <span class="token operator">&lt;</span> right<span class="token punctuation">:</span>        partitionIndex <span class="token operator">=</span> partition<span class="token punctuation">(</span>arr<span class="token punctuation">,</span> left<span class="token punctuation">,</span> right<span class="token punctuation">)</span>        quickSort<span class="token punctuation">(</span>arr<span class="token punctuation">,</span> left<span class="token punctuation">,</span> partitionIndex <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>        quickSort<span class="token punctuation">(</span>arr<span class="token punctuation">,</span> partitionIndex <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> right<span class="token punctuation">)</span>    <span class="token keyword">return</span> arr<span class="token keyword">def</span> <span class="token function">partition</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span> left<span class="token punctuation">,</span> right<span class="token punctuation">)</span><span class="token punctuation">:</span>    pivot <span class="token operator">=</span> left    index <span class="token operator">=</span> pivot <span class="token operator">+</span> <span class="token number">1</span>    i <span class="token operator">=</span> index    <span class="token keyword">while</span> i <span class="token operator">&lt;=</span> right<span class="token punctuation">:</span>        <span class="token keyword">if</span> arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">&lt;</span> arr<span class="token punctuation">[</span>pivot<span class="token punctuation">]</span><span class="token punctuation">:</span>            swap<span class="token punctuation">(</span>arr<span class="token punctuation">,</span> i<span class="token punctuation">,</span> index<span class="token punctuation">)</span>            index <span class="token operator">+=</span> <span class="token number">1</span>        i <span class="token operator">+=</span> <span class="token number">1</span>    swap<span class="token punctuation">(</span>arr<span class="token punctuation">,</span> pivot<span class="token punctuation">,</span> index <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> index <span class="token operator">-</span> <span class="token number">1</span><span class="token keyword">def</span> <span class="token function">swap</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span> i<span class="token punctuation">,</span> j<span class="token punctuation">)</span><span class="token punctuation">:</span>    arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> arr<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> arr<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">,</span> arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h1 id="堆排序"><a href="#堆排序" class="headerlink" title="堆排序"></a>堆排序</h1><p>堆排序（Heapsort）是指利用堆这种数据结构所设计的一种排序算法。堆是一个近似完全二叉树的结构，并同时满足堆的性质：即子节点的键值或索引总是小于（或者大于）它的父节点。堆排序可以说是一种利用堆的概念来排序的选择排序。分为两种方法：</p><ul><li>大顶堆：每个节点的值都大于或等于其子节点的值，在堆排序算法中用于升序排列。</li><li>小顶堆：每个节点的值都小于或等于其子节点的值，在堆排序算法中用于降序排列。</li></ul><p>在堆的数据结构中，堆中的最大值总是位于根节点（在优先队列中使用堆的话堆中的最小值位于根节点）。堆中定义以下几种操作：</p><ul><li>最大堆调整（Max Heapify）：将堆的末端子节点作调整，使得子节点永远小于父节点。</li><li>创建最大堆（Build Max Heap）：将堆中的所有数据重新排序。</li><li>堆排序（HeapSort）：移除位在第一个数据的根节点，并做最大堆调整的递归运算。</li></ul><h2 id="算法步骤-6"><a href="#算法步骤-6" class="headerlink" title="算法步骤"></a>算法步骤</h2><ol><li>创建一个堆 H[0 ... n-1]；</li><li>把堆首（最大值）和堆尾互换；</li><li>把堆的尺寸缩小 1，并调用 shift_down(0)，目的是把新的数组顶端数据调整到相应位置；</li><li>重复步骤 2，直到堆的尺寸为 1。</li></ol><h2 id="动图展示-6"><a href="#动图展示-6" class="headerlink" title="动图展示"></a>动图展示</h2><p><img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="/images/post/sort_algorithm/heap_sort.gif" alt></p><h2 id="代码实现-6"><a href="#代码实现-6" class="headerlink" title="代码实现"></a>代码实现</h2><h3 id="Java-6"><a href="#Java-6" class="headerlink" title="Java"></a>Java</h3><p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/**  * 堆排序的主要入口方法，共两步。  */</span><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">heapSort</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> arr<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">/*      *  第一步：将数组堆化      *  beginIndex = 第一个非叶子节点。      *  从第一个非叶子节点开始即可。无需从最后一个叶子节点开始。      *  叶子节点可以看作已符合堆要求的节点，根节点就是它自己且自己以下值为最大。      */</span>    <span class="token keyword">int</span> len <span class="token operator">=</span> arr<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>    <span class="token keyword">int</span> beginIndex <span class="token operator">=</span> <span class="token punctuation">(</span>arr<span class="token punctuation">.</span>length <span class="token operator">>></span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> beginIndex<span class="token punctuation">;</span> i <span class="token operator">>=</span> <span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">--</span><span class="token punctuation">)</span>        <span class="token function">maxHeapify</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> len<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">/*      * 第二步：对堆化数据排序      * 每次都是移出最顶层的根节点A[0]，与最尾部节点位置调换，同时遍历长度 - 1。      * 然后从新整理被换到根节点的末尾元素，使其符合堆的特性。      * 直至未排序的堆长度为 0。      */</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> len<span class="token punctuation">;</span> i <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token function">swap</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">maxHeapify</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">swap</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token punctuation">,</span> <span class="token keyword">int</span> j<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">int</span> temp <span class="token operator">=</span> arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>    arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> arr<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span>    arr<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> temp<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">/**  * 调整索引为 index 处的数据，使其符合堆的特性。  *  * @param index 需要堆化处理的数据的索引  * @param len 未排序的堆（数组）的长度  */</span><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">maxHeapify</span><span class="token punctuation">(</span><span class="token keyword">int</span> index<span class="token punctuation">,</span> <span class="token keyword">int</span> len<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">int</span> li <span class="token operator">=</span> <span class="token punctuation">(</span>index <span class="token operator">&lt;&lt;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">// 左子节点索引</span>    <span class="token keyword">int</span> ri <span class="token operator">=</span> li <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>           <span class="token comment">// 右子节点索引</span>    <span class="token keyword">int</span> cMax <span class="token operator">=</span> li<span class="token punctuation">;</span>             <span class="token comment">// 子节点值最大索引，默认左子节点。</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>li <span class="token operator">></span> len<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>      <span class="token comment">// 左子节点索引超出计算范围，直接返回。</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>ri <span class="token operator">&lt;=</span> len <span class="token operator">&amp;&amp;</span> arr<span class="token punctuation">[</span>ri<span class="token punctuation">]</span> <span class="token operator">></span> arr<span class="token punctuation">[</span>li<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">// 先判断左右子节点，哪个较大。</span>        cMax <span class="token operator">=</span> ri<span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>arr<span class="token punctuation">[</span>cMax<span class="token punctuation">]</span> <span class="token operator">></span> arr<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token function">swap</span><span class="token punctuation">(</span>cMax<span class="token punctuation">,</span> index<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment">// 如果父节点被子节点调换，</span>        <span class="token function">maxHeapify</span><span class="token punctuation">(</span>cMax<span class="token punctuation">,</span> len<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 则需要继续判断换下后的父节点是否符合堆的特性。</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h3 id="Python-6"><a href="#Python-6" class="headerlink" title="Python"></a>Python</h3><p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">heap_sort</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">sift_down</span><span class="token punctuation">(</span>start<span class="token punctuation">,</span> end<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token triple-quoted-string string">"""最大堆调整"""</span>        root <span class="token operator">=</span> start        <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>            child <span class="token operator">=</span> <span class="token number">2</span> <span class="token operator">*</span> root <span class="token operator">+</span> <span class="token number">1</span>            <span class="token keyword">if</span> child <span class="token operator">></span> end<span class="token punctuation">:</span>                <span class="token keyword">break</span>            <span class="token keyword">if</span> child <span class="token operator">+</span> <span class="token number">1</span> <span class="token operator">&lt;=</span> end <span class="token keyword">and</span> arr<span class="token punctuation">[</span>child<span class="token punctuation">]</span> <span class="token operator">&lt;</span> arr<span class="token punctuation">[</span>child <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">:</span>                child <span class="token operator">+=</span> <span class="token number">1</span>            <span class="token keyword">if</span> arr<span class="token punctuation">[</span>root<span class="token punctuation">]</span> <span class="token operator">&lt;</span> arr<span class="token punctuation">[</span>child<span class="token punctuation">]</span><span class="token punctuation">:</span>                arr<span class="token punctuation">[</span>root<span class="token punctuation">]</span><span class="token punctuation">,</span> arr<span class="token punctuation">[</span>child<span class="token punctuation">]</span> <span class="token operator">=</span> arr<span class="token punctuation">[</span>child<span class="token punctuation">]</span><span class="token punctuation">,</span> arr<span class="token punctuation">[</span>root<span class="token punctuation">]</span>                root <span class="token operator">=</span> child            <span class="token keyword">else</span><span class="token punctuation">:</span>                <span class="token keyword">break</span>    <span class="token comment"># 创建最大堆</span>    <span class="token keyword">for</span> start <span class="token keyword">in</span> <span class="token builtin">xrange</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">//</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        sift_down<span class="token punctuation">(</span>start<span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>    <span class="token comment"># 堆排序</span>    <span class="token keyword">for</span> end <span class="token keyword">in</span> <span class="token builtin">xrange</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        arr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> arr<span class="token punctuation">[</span>end<span class="token punctuation">]</span> <span class="token operator">=</span> arr<span class="token punctuation">[</span>end<span class="token punctuation">]</span><span class="token punctuation">,</span> arr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>        sift_down<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> end <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> arr<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h1 id="计数排序"><a href="#计数排序" class="headerlink" title="计数排序"></a>计数排序</h1><p>计数排序（Counting sort）是一种稳定的线性时间排序算法。计数排序使用一个额外的数组 C，其中第 i 个元素是待排序数组 A 中值等于 i 的元素的个数。然后根据数组 C 来将 A 中的元素排到正确的位置。</p><h2 id="算法步骤-7"><a href="#算法步骤-7" class="headerlink" title="算法步骤"></a>算法步骤</h2><p>通俗地理解，例如有 10 个年龄不同的人，统计出有 8 个人的年龄比 A 小，那 A 的年龄就排在第9位，用这个方法可以得到其他每个人的位置，也就排好了序。当然，年龄有重复时需要特殊处理（保证稳定性），这就是为什么最后要反向填充目标数组，以及将每个数字的统计减去 1。</p><ol><li>找出待排序的数组中最大和最小的元素</li><li>统计数组中每个值为 i 的元素出现的次数，存入数组 C 的第 i 项</li><li>对所有的计数累加（从 C 中的第一个元素开始，每一项和前一项相加）</li><li>反向填充目标数组：将每个元素 i 放在新数组的第 C[i] 项，每放一个元素就将 C[i] 减去1</li></ol><h2 id="动图展示-7"><a href="#动图展示-7" class="headerlink" title="动图展示"></a>动图展示</h2><p><img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="/images/post/sort_algorithm/counting_sort.gif" alt></p><h2 id="代码实现-7"><a href="#代码实现-7" class="headerlink" title="代码实现"></a>代码实现</h2><h3 id="Java-7"><a href="#Java-7" class="headerlink" title="Java"></a>Java</h3><p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">countingSort</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> arr<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">int</span> maxValue <span class="token operator">=</span> <span class="token function">getMaxValue</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span>    <span class="token keyword">int</span> bucketLen <span class="token operator">=</span> maxValue <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>    <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> bucket <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">int</span><span class="token punctuation">[</span>bucketLen<span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> value <span class="token operator">:</span> arr<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        bucket<span class="token punctuation">[</span>value<span class="token punctuation">]</span><span class="token operator">++</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">int</span> sortedIndex <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> bucketLen<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">while</span> <span class="token punctuation">(</span>bucket<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            arr<span class="token punctuation">[</span>sortedIndex<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> j<span class="token punctuation">;</span>            bucket<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token operator">--</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">return</span> arr<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getMaxValue</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> arr<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">int</span> maxValue <span class="token operator">=</span> arr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> value <span class="token operator">:</span> arr<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>maxValue <span class="token operator">&lt;</span> value<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            maxValue <span class="token operator">=</span> value<span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">return</span> maxValue<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h3 id="Python-7"><a href="#Python-7" class="headerlink" title="Python"></a>Python</h3><p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">countingSort</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">:</span>    maxValue <span class="token operator">=</span> arr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>    <span class="token keyword">for</span> value <span class="token keyword">in</span> arr<span class="token punctuation">:</span>        <span class="token keyword">if</span> maxValue <span class="token operator">&lt;</span> value<span class="token punctuation">:</span>            maxValue <span class="token operator">=</span> value    bucketLen <span class="token operator">=</span> maxValue <span class="token operator">+</span> <span class="token number">1</span>    bucket <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">*</span> bucketLen    sortedIndex <span class="token operator">=</span> <span class="token number">0</span>    arrLen <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>arrLen<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">if</span> <span class="token keyword">not</span> bucket<span class="token punctuation">[</span>arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">:</span>            bucket<span class="token punctuation">[</span>arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span>        bucket<span class="token punctuation">[</span>arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">+=</span> <span class="token number">1</span>    <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>bucketLen<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">while</span> bucket<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">:</span>            arr<span class="token punctuation">[</span>sortedIndex<span class="token punctuation">]</span> <span class="token operator">=</span> j            sortedIndex <span class="token operator">+=</span> <span class="token number">1</span>            bucket<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">-=</span> <span class="token number">1</span>    <span class="token keyword">return</span> arr<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h1 id="桶排序"><a href="#桶排序" class="headerlink" title="桶排序"></a>桶排序</h1><p>桶排序（Bucket sort）或所谓的箱排序，是一个排序算法，工作的原理是将数组分到有限数量的桶里。每个桶再个别排序（有可能再使用别的排序算法或是以递归方式继续使用桶排序进行排序）。</p><p>桶排序是计数排序的升级版。它利用了函数的映射关系，高效与否的关键就在于这个映射函数的确定。为了使桶排序更加高效，我们需要做到这两点：</p><p>在额外空间充足的情况下，尽量增大桶的数量使用的映射函数能够将输入的 N 个数据均匀的分配到 K 个桶中</p><h2 id="算法步骤-8"><a href="#算法步骤-8" class="headerlink" title="算法步骤"></a>算法步骤</h2><ol><li>设置一个定量的数组当作空桶子。</li><li>寻访序列，并且把项目一个一个放到对应的桶子去。</li><li>对每个不是空的桶子进行排序。</li><li>从不是空的桶子里把项目再放回原来的序列中。</li></ol><h2 id="动图展示-8"><a href="#动图展示-8" class="headerlink" title="动图展示"></a>动图展示</h2><p><img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="/images/post/sort_algorithm/bucket_sort.gif" alt></p><h2 id="代码实现-8"><a href="#代码实现-8" class="headerlink" title="代码实现"></a>代码实现</h2><h3 id="Java-8"><a href="#Java-8" class="headerlink" title="Java"></a>Java</h3><p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">indexFor</span><span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">,</span> <span class="token keyword">int</span> min<span class="token punctuation">,</span> <span class="token keyword">int</span> step<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> <span class="token punctuation">(</span>a <span class="token operator">-</span> min<span class="token punctuation">)</span> <span class="token operator">/</span> step<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">bucketSort</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> arr<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">int</span> max <span class="token operator">=</span> arr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> min <span class="token operator">=</span> arr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> a <span class="token operator">:</span> arr<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>max <span class="token operator">&lt;</span> a<span class="token punctuation">)</span>            max <span class="token operator">=</span> a<span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>min <span class="token operator">></span> a<span class="token punctuation">)</span>            min <span class="token operator">=</span> a<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">// 该值也可根据实际情况选择</span>    <span class="token keyword">int</span> bucketNum <span class="token operator">=</span> max <span class="token operator">/</span> <span class="token number">10</span> <span class="token operator">-</span> min <span class="token operator">/</span> <span class="token number">10</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>    <span class="token class-name">List</span> buckList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">List</span><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">></span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// 创建桶</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> bucketNum<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        buckList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">// 将数据分配到各个桶中</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> arr<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">int</span> index <span class="token operator">=</span> <span class="token function">indexFor</span><span class="token punctuation">(</span>arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> min<span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">></span></span><span class="token punctuation">)</span> buckList<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">></span></span> bucket <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>    <span class="token keyword">int</span> index <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> bucketNum<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        bucket <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">></span></span><span class="token punctuation">)</span> buckList<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// 对每个桶进行排序，这里使用了插入排序</span>        <span class="token function">insertSort</span><span class="token punctuation">(</span>bucket<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> k <span class="token operator">:</span> bucket<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            arr<span class="token punctuation">[</span>index<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> k<span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token comment">// 把桶內元素使用插入排序</span><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">insertSort</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">></span></span> bucket<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> bucket<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">int</span> temp <span class="token operator">=</span> bucket<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">int</span> j <span class="token operator">=</span> i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">;</span> j <span class="token operator">>=</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> bucket<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span> <span class="token operator">></span> temp<span class="token punctuation">;</span> j<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            bucket<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>j <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> bucket<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        bucket<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>j <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> temp<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h3 id="Python-8"><a href="#Python-8" class="headerlink" title="Python"></a>Python</h3><p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">bucket_sort</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">:</span>    max_num <span class="token operator">=</span> <span class="token builtin">max</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span>    <span class="token comment"># 不能使用[[]]*(max+1)，这样新建的空间中各个[]是共享内存的</span>    buf <span class="token operator">=</span> <span class="token punctuation">&#123;</span>i<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>max_num<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span>    arr_len <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>arr_len<span class="token punctuation">)</span><span class="token punctuation">:</span>        num <span class="token operator">=</span> arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span>        <span class="token comment"># 将相应范围内的数据加入到[]中</span>        buf<span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span>num<span class="token punctuation">)</span>    arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">if</span> buf<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">:</span>            <span class="token comment"># 这里还需要对一个范围内的数据进行排序，然后再进行输出</span>            arr<span class="token punctuation">.</span>extend<span class="token punctuation">(</span><span class="token builtin">sorted</span><span class="token punctuation">(</span>buf<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> arr<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h1 id="基数排序"><a href="#基数排序" class="headerlink" title="基数排序"></a>基数排序</h1><p>基数排序（Radix sort）是一种非比较型整数排序算法，其原理是将整数按位数切割成不同的数字，然后按每个位数分别比较。由于整数也可以表达字符串（比如名字或日期）和特定格式的浮点数，所以基数排序也不是只能使用于整数。</p><p>基数排序有两种方法：基数排序的方式可以采用LSD（Least significant digital）或MSD（Most significant digital），LSD的排序方式由键值的最右边开始，而MSD则相反，由键值的最左边开始。</p><h2 id="算法步骤-9"><a href="#算法步骤-9" class="headerlink" title="算法步骤"></a>算法步骤</h2><ol><li>将所有待比较数值（正整数）统一为同样的数位长度，数位较短的数前面补零；</li><li>从最低位开始，依次进行一次排序；</li><li>这样从最低位排序一直到最高位排序完成以后，数列就变成一个有序序列。</li></ol><h2 id="动图展示-9"><a href="#动图展示-9" class="headerlink" title="动图展示"></a>动图展示</h2><p><img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="/images/post/sort_algorithm/radix_sort.gif" alt></p><h2 id="代码实现-9"><a href="#代码实现-9" class="headerlink" title="代码实现"></a>代码实现</h2><h3 id="Java-9"><a href="#Java-9" class="headerlink" title="Java"></a>Java</h3><p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">radixSort</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> array<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">int</span> max <span class="token operator">=</span> <span class="token function">getMax</span><span class="token punctuation">(</span>array<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">int</span> bit <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>    <span class="token keyword">while</span><span class="token punctuation">(</span>max <span class="token operator">/</span> bit <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token function">radix</span><span class="token punctuation">(</span>array<span class="token punctuation">,</span> bit<span class="token punctuation">)</span><span class="token punctuation">;</span>        bit <span class="token operator">*=</span> <span class="token number">10</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">radix</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> array<span class="token punctuation">,</span> <span class="token keyword">int</span> bit<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> temp <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">int</span><span class="token punctuation">[</span>array<span class="token punctuation">.</span>length<span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> bucket <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> array<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        bucket<span class="token punctuation">[</span><span class="token punctuation">(</span>array<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">/</span> bit<span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">10</span><span class="token punctuation">]</span><span class="token operator">++</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> bucket<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        bucket<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">+=</span> bucket<span class="token punctuation">[</span>i<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> array<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">>=</span> <span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        temp<span class="token punctuation">[</span>bucket<span class="token punctuation">[</span><span class="token punctuation">(</span>array<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">/</span> bit<span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">10</span><span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> array<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>        bucket<span class="token punctuation">[</span><span class="token punctuation">(</span>array<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">/</span> bit<span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">10</span><span class="token punctuation">]</span><span class="token operator">--</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> temp<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        array<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> temp<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getMax</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> array<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">int</span> max <span class="token operator">=</span> array<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> array<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>array<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">></span> max<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            max <span class="token operator">=</span> array<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">return</span> max<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h3 id="Python-9"><a href="#Python-9" class="headerlink" title="Python"></a>Python</h3><p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">radix_sort</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">:</span>    n <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span><span class="token builtin">max</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 记录最大值的位数</span>    <span class="token keyword">for</span> k <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment"># n轮排序</span>        <span class="token comment"># 每一轮生成10个列表</span>        bucket_list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">]</span>  <span class="token comment"># 因为每一位数字都是0~9，故建立10个桶</span>        <span class="token keyword">for</span> i <span class="token keyword">in</span> arr<span class="token punctuation">:</span>            <span class="token comment"># 按第k位放入到桶中</span>            bucket_list<span class="token punctuation">[</span>i <span class="token operator">//</span> <span class="token punctuation">(</span><span class="token number">10</span> <span class="token operator">**</span> k<span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span>i<span class="token punctuation">)</span>        <span class="token comment"># 按当前桶的顺序重排列表</span>        arr <span class="token operator">=</span> <span class="token punctuation">[</span>j <span class="token keyword">for</span> i <span class="token keyword">in</span> bucket_list <span class="token keyword">for</span> j <span class="token keyword">in</span> i<span class="token punctuation">]</span>    <span class="token keyword">return</span> arr<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p>]]></content>
      
      
      <categories>
          
          <category> 教程笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 算法 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>HTML 特殊符号编码对照表</title>
      <link href="post/65795b97.html"/>
      <url>post/65795b97.html</url>
      
        <content type="html"><![CDATA[<div class="table-container"><table><thead><tr><th>符号</th><th>命名实体</th><th>十进制编码</th><th>符号</th><th>命名实体</th><th>十进制编码</th><th>符号</th><th>命名实体</th><th>十进制编码</th></tr></thead><tbody><tr><td><code>Α</code></td><td><code>&amp;Alpha;</code></td><td><code>&amp;#913;</code></td><td><code>Β</code></td><td><code>&amp;Beta;</code></td><td><code>&amp;#914;</code></td><td><code>Γ</code></td><td><code>&amp;Gamma;</code></td><td><code>&amp;#915;</code></td></tr><tr><td><code>Δ</code></td><td><code>&amp;Delta;</code></td><td><code>&amp;#916;</code></td><td><code>Ε</code></td><td><code>&amp;Epsilon;</code></td><td><code>&amp;#917;</code></td><td><code>Ζ</code></td><td><code>&amp;Zeta;</code></td><td><code>&amp;#918;</code></td></tr><tr><td><code>Η</code></td><td><code>&amp;Eta;</code></td><td><code>&amp;#919;</code></td><td><code>Θ</code></td><td><code>&amp;Theta;</code></td><td><code>&amp;#920;</code></td><td><code>Ι</code></td><td><code>&amp;Iota;</code></td><td><code>&amp;#921;</code></td></tr><tr><td><code>Κ</code></td><td><code>&amp;Kappa;</code></td><td><code>&amp;#922;</code></td><td><code>Λ</code></td><td><code>&amp;Lambda;</code></td><td><code>&amp;#923;</code></td><td><code>Μ</code></td><td><code>&amp;Mu;</code></td><td><code>&amp;#924;</code></td></tr><tr><td><code>Ν</code></td><td><code>&amp;Nu;</code></td><td><code>&amp;#925;</code></td><td><code>Ξ</code></td><td><code>&amp;Xi;</code></td><td><code>&amp;#926;</code></td><td><code>Ο</code></td><td><code>&amp;Omicron;</code></td><td><code>&amp;#927;</code></td></tr><tr><td><code>Π</code></td><td><code>&amp;Pi;</code></td><td><code>&amp;#928;</code></td><td><code>Ρ</code></td><td><code>&amp;Rho;</code></td><td><code>&amp;#929;</code></td><td><code>Σ</code></td><td><code>&amp;Sigma;</code></td><td><code>&amp;#931;</code></td></tr><tr><td><code>Τ</code></td><td><code>&amp;Tau;</code></td><td><code>&amp;#932;</code></td><td><code>Υ</code></td><td><code>&amp;Upsilon;</code></td><td><code>&amp;#933;</code></td><td><code>Φ</code></td><td><code>&amp;Phi;</code></td><td><code>&amp;#934;</code></td></tr><tr><td><code>Χ</code></td><td><code>&amp;Chi;</code></td><td><code>&amp;#935;</code></td><td><code>Ψ</code></td><td><code>&amp;Psi;</code></td><td><code>&amp;#936;</code></td><td><code>Ω</code></td><td><code>&amp;Omega;</code></td><td><code>&amp;#937;</code></td></tr><tr><td><code>α</code></td><td><code>&amp;alpha;</code></td><td><code>&amp;#945;</code></td><td><code>β</code></td><td><code>&amp;beta;</code></td><td><code>&amp;#946;</code></td><td><code>γ</code></td><td><code>&amp;gamma;</code></td><td><code>&amp;#947;</code></td></tr><tr><td><code>δ</code></td><td><code>&amp;delta;</code></td><td><code>&amp;#948;</code></td><td><code>ε</code></td><td><code>&amp;epsilon;</code></td><td><code>&amp;#949;</code></td><td><code>ζ</code></td><td><code>&amp;zeta;</code></td><td><code>&amp;#950;</code></td></tr><tr><td><code>η</code></td><td><code>&amp;eta;</code></td><td><code>&amp;#951;</code></td><td><code>θ</code></td><td><code>&amp;theta;</code></td><td><code>&amp;#952;</code></td><td><code>ι</code></td><td><code>&amp;iota;</code></td><td><code>&amp;#953;</code></td></tr><tr><td><code>κ</code></td><td><code>&amp;kappa;</code></td><td><code>&amp;#954;</code></td><td><code>λ</code></td><td><code>&amp;lambda;</code></td><td><code>&amp;#955;</code></td><td><code>μ</code></td><td><code>&amp;mu;</code></td><td><code>&amp;#956;</code></td></tr><tr><td><code>ν</code></td><td><code>&amp;nu;</code></td><td><code>&amp;#957;</code></td><td><code>ξ</code></td><td><code>&amp;xi;</code></td><td><code>&amp;#958;</code></td><td><code>ο</code></td><td><code>&amp;omicron;</code></td><td><code>&amp;#959;</code></td></tr><tr><td><code>π</code></td><td><code>&amp;pi;</code></td><td><code>&amp;#960;</code></td><td><code>ρ</code></td><td><code>&amp;rho;</code></td><td><code>&amp;#961;</code></td><td><code>ς</code></td><td><code>&amp;sigmaf;</code></td><td><code>&amp;#962;</code></td></tr><tr><td><code>σ</code></td><td><code>&amp;sigma;</code></td><td><code>&amp;#963;</code></td><td><code>τ</code></td><td><code>&amp;tau;</code></td><td><code>&amp;#964;</code></td><td><code>υ</code></td><td><code>&amp;upsilon;</code></td><td><code>&amp;#965;</code></td></tr><tr><td><code>φ</code></td><td><code>&amp;phi;</code></td><td><code>&amp;#966;</code></td><td><code>χ</code></td><td><code>&amp;chi;</code></td><td><code>&amp;#967;</code></td><td><code>ψ</code></td><td><code>&amp;psi;</code></td><td><code>&amp;#968;</code></td></tr><tr><td><code>ω</code></td><td><code>&amp;omega;</code></td><td><code>&amp;#969;</code></td><td><code>ϑ</code></td><td><code>&amp;thetasym;</code></td><td><code>&amp;#977;</code></td><td><code>ϒ</code></td><td><code>&amp;upsih;</code></td><td><code>&amp;#978;</code></td></tr><tr><td><code>ϖ</code></td><td><code>&amp;piv;</code></td><td><code>&amp;#982;</code></td><td><code>•</code></td><td><code>&amp;bull;</code></td><td><code>&amp;#8226;</code></td><td><code>…</code></td><td><code>&amp;hellip;</code></td><td><code>&amp;#8230;</code></td></tr><tr><td><code>′</code></td><td><code>&amp;prime;</code></td><td><code>&amp;#8242;</code></td><td><code>″</code></td><td><code>&amp;Prime;</code></td><td><code>&amp;#8243;</code></td><td><code>‾</code></td><td><code>&amp;oline;</code></td><td><code>&amp;#8254;</code></td></tr><tr><td><code>⁄</code></td><td><code>&amp;frasl;</code></td><td><code>&amp;#8260;</code></td><td><code>℘</code></td><td><code>&amp;weierp;</code></td><td><code>&amp;#8472;</code></td><td><code>ℑ</code></td><td><code>&amp;image;</code></td><td><code>&amp;#8465;</code></td></tr><tr><td><code>ℜ</code></td><td><code>&amp;real;</code></td><td><code>&amp;#8476;</code></td><td><code>™</code></td><td><code>&amp;trade;</code></td><td><code>&amp;#8482;</code></td><td><code>ℵ</code></td><td><code>&amp;alefsym;</code></td><td><code>&amp;#8501;</code></td></tr><tr><td><code>←</code></td><td><code>&amp;larr;</code></td><td><code>&amp;#8592;</code></td><td><code>↑</code></td><td><code>&amp;uarr;</code></td><td><code>&amp;#8593;</code></td><td><code>→</code></td><td><code>&amp;rarr;</code></td><td><code>&amp;#8594;</code></td></tr><tr><td><code>↓</code></td><td><code>&amp;darr;</code></td><td><code>&amp;#8595;</code></td><td><code>↔</code></td><td><code>&amp;harr;</code></td><td><code>&amp;#8596;</code></td><td><code>↵</code></td><td><code>&amp;crarr;</code></td><td><code>&amp;#8629;</code></td></tr><tr><td><code>⇐</code></td><td><code>&amp;lArr;</code></td><td><code>&amp;#8656;</code></td><td><code>⇑</code></td><td><code>&amp;uArr;</code></td><td><code>&amp;#8657;</code></td><td><code>⇒</code></td><td><code>&amp;rArr;</code></td><td><code>&amp;#8658;</code></td></tr><tr><td><code>⇓</code></td><td><code>&amp;dArr;</code></td><td><code>&amp;#8659;</code></td><td><code>⇔</code></td><td><code>&amp;hArr;</code></td><td><code>&amp;#8660;</code></td><td><code>∀</code></td><td><code>&amp;forall;</code></td><td><code>&amp;#8704;</code></td></tr><tr><td><code>∂</code></td><td><code>&amp;part;</code></td><td><code>&amp;#8706;</code></td><td><code>∃</code></td><td><code>&amp;exist;</code></td><td><code>&amp;#8707;</code></td><td><code>∅</code></td><td><code>&amp;empty;</code></td><td><code>&amp;#8709;</code></td></tr><tr><td><code>∇</code></td><td><code>&amp;nabla;</code></td><td><code>&amp;#8711;</code></td><td><code>∈</code></td><td><code>&amp;isin;</code></td><td><code>&amp;#8712;</code></td><td><code>∉</code></td><td><code>&amp;notin;</code></td><td><code>&amp;#8713;</code></td></tr><tr><td><code>∋</code></td><td><code>&amp;ni;</code></td><td><code>&amp;#8715;</code></td><td><code>∏</code></td><td><code>&amp;prod;</code></td><td><code>&amp;#8719;</code></td><td><code>∑</code></td><td><code>&amp;sum;</code></td><td><code>&amp;#8722;</code></td></tr><tr><td><code>−</code></td><td><code>&amp;minus;</code></td><td><code>&amp;#8722;</code></td><td><code>∗</code></td><td><code>&amp;lowast;</code></td><td><code>&amp;#8727;</code></td><td><code>√</code></td><td><code>&amp;radic;</code></td><td><code>&amp;#8730;</code></td></tr><tr><td><code>∝</code></td><td><code>&amp;prop;</code></td><td><code>&amp;#8733;</code></td><td><code>∞</code></td><td><code>&amp;infin;</code></td><td><code>&amp;#8734;</code></td><td><code>∠</code></td><td><code>&amp;ang;</code></td><td><code>&amp;#8736;</code></td></tr><tr><td><code>∧</code></td><td><code>&amp;and;</code></td><td><code>&amp;#8869;</code></td><td><code>∨</code></td><td><code>&amp;or;</code></td><td><code>&amp;#8870;</code></td><td><code>∩</code></td><td><code>&amp;cap;</code></td><td><code>&amp;#8745;</code></td></tr><tr><td><code>∪</code></td><td><code>&amp;cup;</code></td><td><code>&amp;#8746;</code></td><td><code>∫</code></td><td><code>&amp;int;</code></td><td><code>&amp;#8747;</code></td><td><code>∴</code></td><td><code>&amp;there4;</code></td><td><code>&amp;#8756;</code></td></tr><tr><td><code>∼</code></td><td><code>&amp;sim;</code></td><td><code>&amp;#8764;</code></td><td><code>≅</code></td><td><code>&amp;cong;</code></td><td><code>&amp;#8773;</code></td><td><code>≈</code></td><td><code>&amp;asymp;</code></td><td><code>&amp;#8773;</code></td></tr><tr><td><code>≠</code></td><td><code>&amp;ne;</code></td><td><code>&amp;#8800;</code></td><td><code>≡</code></td><td><code>&amp;equiv;</code></td><td><code>&amp;#8801;</code></td><td><code>≤</code></td><td><code>&amp;le;</code></td><td><code>&amp;#8804;</code></td></tr><tr><td><code>≥</code></td><td><code>&amp;ge;</code></td><td><code>&amp;#8805;</code></td><td><code>⊂</code></td><td><code>&amp;sub;</code></td><td><code>&amp;#8834;</code></td><td><code>⊃</code></td><td><code>&amp;sup;</code></td><td><code>&amp;#8835;</code></td></tr><tr><td><code>⊄</code></td><td><code>&amp;nsub;</code></td><td><code>&amp;#8836;</code></td><td><code>⊆</code></td><td><code>&amp;sube;</code></td><td><code>&amp;#8838;</code></td><td><code>⊇</code></td><td><code>&amp;supe;</code></td><td><code>&amp;#8839;</code></td></tr><tr><td><code>⊕</code></td><td><code>&amp;oplus;</code></td><td><code>&amp;#8853;</code></td><td><code>⊗</code></td><td><code>&amp;otimes;</code></td><td><code>&amp;#8855;</code></td><td><code>⊥</code></td><td><code>&amp;perp;</code></td><td><code>&amp;#8869;</code></td></tr><tr><td><code>⋅</code></td><td><code>&amp;sdot;</code></td><td><code>&amp;#8901;</code></td><td><code>⌈</code></td><td><code>&amp;lceil;</code></td><td><code>&amp;#8968;</code></td><td><code>⌉</code></td><td><code>&amp;rceil;</code></td><td><code>&amp;#8969;</code></td></tr><tr><td><code>⌊</code></td><td><code>&amp;lfloor;</code></td><td><code>&amp;#8970;</code></td><td><code>⌋</code></td><td><code>&amp;rfloor;</code></td><td><code>&amp;#8971;</code></td><td><code>◊</code></td><td><code>&amp;loz;</code></td><td><code>&amp;#9674;</code></td></tr><tr><td><code>♠</code></td><td><code>&amp;spades;</code></td><td><code>&amp;#9824;</code></td><td><code>♣</code></td><td><code>&amp;clubs;</code></td><td><code>&amp;#9827;</code></td><td><code>♥</code></td><td><code>&amp;hearts;</code></td><td><code>&amp;#9829;</code></td></tr><tr><td><code>♦</code></td><td><code>&amp;diams;</code></td><td><code>&amp;#9830;</code></td><td><code> </code></td><td><code>&amp;nbsp;</code></td><td><code>&amp;#160;</code></td><td><code>¡</code></td><td><code>&amp;iexcl;</code></td><td><code>&amp;#161;</code></td></tr><tr><td><code>¢</code></td><td><code>&amp;cent;</code></td><td><code>&amp;#162;</code></td><td><code>£</code></td><td><code>&amp;pound;</code></td><td><code>&amp;#163;</code></td><td><code>¤</code></td><td><code>&amp;curren;</code></td><td><code>&amp;#164;</code></td></tr><tr><td><code>¥</code></td><td><code>&amp;yen;</code></td><td><code>&amp;#165;</code></td><td><code>¦</code></td><td><code>&amp;brvbar;</code></td><td><code>&amp;#166;</code></td><td><code>§</code></td><td><code>&amp;sect;</code></td><td><code>&amp;#167;</code></td></tr><tr><td><code>¨</code></td><td><code>&amp;uml;</code></td><td><code>&amp;#168;</code></td><td><code>©</code></td><td><code>&amp;copy;</code></td><td><code>&amp;#169;</code></td><td><code>ª</code></td><td><code>&amp;ordf;</code></td><td><code>&amp;#170;</code></td></tr><tr><td><code>«</code></td><td><code>&amp;laquo;</code></td><td><code>&amp;#171;</code></td><td><code>¬</code></td><td><code>&amp;not;</code></td><td><code>&amp;#172;</code></td><td><code>­</code></td><td><code>&amp;shy;</code></td><td><code>&amp;#173;</code></td></tr><tr><td><code>®</code></td><td><code>&amp;reg;</code></td><td><code>&amp;#174;</code></td><td><code>¯</code></td><td><code>&amp;macr;</code></td><td><code>&amp;#175;</code></td><td><code>°</code></td><td><code>&amp;deg;</code></td><td><code>&amp;#176;</code></td></tr><tr><td><code>±</code></td><td><code>&amp;plusmn;</code></td><td><code>&amp;#177;</code></td><td><code>²</code></td><td><code>&amp;sup2;</code></td><td><code>&amp;#178;</code></td><td><code>³</code></td><td><code>&amp;sup3;</code></td><td><code>&amp;#179;</code></td></tr><tr><td><code>´</code></td><td><code>&amp;acute;</code></td><td><code>&amp;#180;</code></td><td><code>µ</code></td><td><code>&amp;micro;</code></td><td><code>&amp;#181;</code></td><td><code>&quot;</code></td><td><code>&amp;quot;</code></td><td><code>&amp;#34;</code></td></tr><tr><td><code>&lt;</code></td><td><code>&amp;lt;</code></td><td><code>&amp;#60;</code></td><td><code>&gt;</code></td><td><code>&amp;gt;</code></td><td><code>&amp;#62;</code></td><td><code>&#39;</code></td><td><code>&amp;apos;</code></td><td><code>&amp;#39;</code></td></tr></tbody></table></div>]]></content>
      
      
      <categories>
          
          <category> 教程笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 文档 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>特殊符号</title>
      <link href="post/73bb9016.html"/>
      <url>post/73bb9016.html</url>
      
        <content type="html"><![CDATA[<h1 id="编号序号"><a href="#编号序号" class="headerlink" title="编号序号"></a>编号序号</h1><p>①②③④⑤⑥⑦⑧⑨⑩⑪⑫⑬⑭⑮⑯⑰⑱⑲⑳⓪</p><p>❶❷❸❹❺❻❼❽❾❿⓫⓬⓭⓮⓯⓰⓱⓲⓳⓴</p><p>㊀㊁㊂㊃㊄㊅㊆㊇㊈㊉</p><p>一二三四五六七八九十</p><p>⑴⑵⑶⑷⑸⑹⑺⑻⑼⑽⑾⑿⒀⒁⒂⒃⒄⒅⒆⒇</p><p>⒈⒉⒊⒋⒌⒍⒎⒏⒐⒑⒒⒓⒔⒕⒖⒗⒘⒙⒚⒛</p><p>ⅠⅡⅢⅣⅤⅥⅦⅧⅨⅩⅪⅫ</p><p>ⒶⒷⒸⒹⒺⒻⒼⒽⒾⒿⓀⓁⓂⓃⓄⓅⓆⓇⓈⓉⓊⓋⓌⓍⓎⓏ</p><p>ⓐⓑⓒⓓⓔⓕⓖⓗⓘⓙⓚⓛⓜⓝⓞⓟⓠⓡⓢⓣⓤⓥⓦⓧⓨⓩ</p><p>⒜⒝⒞⒟⒠⒡⒢⒣⒤⒥⒦⒧⒨⒩⒪⒫⒬⒭⒮⒯⒰⒱⒲⒳⒴⒵</p><p>⁰¹²³⁴⁵⁶⁷⁸⁹₀₁₂₃₄₅₆₇₈₉</p><h1 id="数学符号"><a href="#数学符号" class="headerlink" title="数学符号"></a>数学符号</h1><p>﹢﹣×÷±/≌∽≦≧≒﹤﹥≈≡≠=≤≥&lt;&gt;≮≯≂≃≄≅≆≇≈≉≊≋≍≎≏≐≑≒≓≔≕≖≗≘≙≚≛≜≝≞≟≢≣≨≩⊰⊱⋛⋚∷∶∝∞∧∨∑∏∪∩∈∵∴⊥∥∠⌒⊙√∟⊿㏒㏑⅟½⅓⅕⅙⅛⅔⅖⅚⅜¾⅗⅝⅞⅘∫∬∭∮∯∰∱∲∳%℅‰‱øØπ</p><h1 id="标点符号"><a href="#标点符号" class="headerlink" title="标点符号"></a>标点符号</h1><p>。，、&#39;：∶；?‘’“”〝〞ˆˇ﹕︰﹔﹖﹑·¨….¸;！´？！～—ˉ|‖&quot;〃`@﹫¡¿﹏﹋﹌︴々﹟#﹩$﹠&amp;﹪%*﹡﹢﹦﹤‐￣¯―﹨ˆ˜﹍﹎+=&lt;<em>_-\ˇ~﹉﹊（）〈〉‹›﹛﹜『』〖〗[]《》〔〕{}「」【】︵︷^︹︽</em>﹁﹃︻︶︸﹀︺︾ˉ﹂﹄︼❝❞</p><h1 id="上标符号"><a href="#上标符号" class="headerlink" title="上标符号"></a>上标符号</h1><p>ᵃ ᵇ ᶜ ᵈ ᵉ ᵍ ʰ ⁱ ʲ ᵏ ˡ ᵐ ⁿ ᵒ ᵖ ᵒ⃒ ʳ ˢ ᵗ ᵘ ᵛ ʷ ˣ ʸ ᙆ ᴬ ᴮ ᒼ ᴰ ᴱ ᴳ ᴴ ᴵ ᴶ ᴷ ᴸ ᴹ ᴺ ᴼ ᴾ ᴼ̴ ᴿ ˢ ᵀ ᵁ ᵂ ˣ ᵞ ᙆ ꝰ ˀ ˁ ˤ ꟸ ꭜ ʱ ꭝ ꭞ ʴ ʵ ʶ ꭟ ˠ ꟹ ᴭ ᴯ ᴲ ᴻ ᴽ ᵄ ᵅ ᵆ ᵊ ᵋ ᵌ ᵑ ᵓ ᵚ ᵝ ᵞ ᵟ ᵠ ᵡ ᵎ ᵔ ᵕ ᵙ ᵜ ᶛ ᶜ ᶝ ᶞ ᶟ ᶡ ᶣ ᶤ ᶥ ᶦ ᶧ ᶨ ᶩ ᶪ ᶫ ᶬ ᶭ ᶮ ᶯ ᶰ ᶱ ᶲ ᶳ ᶴ ᶵ ᶶ ᶷ ᶸ ᶹ ᶺ ᶼ ᶽ ᶾ ᶿ ꚜ ꚝ ჼ ᒃ ᕻ ᑦ ᒄ ᕪ ᑋ ᑊ ᔿ ᐢ ᣕ ᐤ ᣖ ᣴ ᣗ ᔆ ᙚ ᐡ ᘁ ᐜ ᕽ ᙆ ᙇ ᒼ ᣳ ᒢ ᒻ ᔿ ᐤ ᣖ ᣵ ᙚ ᐪ ᓑ ᘁ ᐜ ᕽ ᙆ ᙇ ⁰ ¹ ² ³ ⁴ ⁵ ⁶ ⁷ ⁸ ⁹ ⁺ ⁻ ⁼ ˂ ˃ ⁽ ⁾ ˙ * º ㆒㆓㆔㆕㆖㆗㆘㆙㆚㆛㆜㆝㆞</p><h1 id="下标符号"><a href="#下标符号" class="headerlink" title="下标符号"></a>下标符号</h1><p>₀ ₁ ₂ ₃ ₄ ₅ ₆ ₇ ₈ ₉ ₊ ₋ ₌ ₍ ₎ ₐ ₑ ₒ ₓ ₔ ₕ ₖ ₗ ₘ ₙ ₚ ₛ ₜ ᵤ ᵥ ₓ ᙮ ᵤ ᵩ ᵦ ₗ ˪ ៳ ៷ ₒ ᵨ ₛ ៴ ᵤ ᵪ ᵧ</p><h1 id="单位符号"><a href="#单位符号" class="headerlink" title="单位符号"></a>单位符号</h1><p>°′″%℃℉Å﹪‰㎡㏕㎜㎝㎞㏎m³㎎㎏㏄º○¤%º¹²³⁴⁵⁶⁷⁸⁹⁰⁺⁻⁼⁽⁾ʲʰʳʷʸⁿ</p><h1 id="箭头符号"><a href="#箭头符号" class="headerlink" title="箭头符号"></a>箭头符号</h1><p>↑↓←→↖↗↘↙↔↕➻➼➽➸➳➺➻➴➵➶➷➹▶►▷◁◀◄«»➩➪➫➬➭➮➯➱⏎➲➾➔➘➙➚➛➜➝➞➟➠➡➢➣➤➥➦➧➨↚↛↜↝↞↟↠↠↡↢↣↤↤↥↦↧↨⇄⇅⇆⇇⇈⇉⇊⇋⇌⇍⇎⇏⇐⇑⇒⇓⇔⇖⇗⇘⇙⇜↩↪↫↬↭↮↯↰↱↲↳↴↵↶↷↸↹☇☈↼↽↾↿⇀⇁⇂⇃⇞⇟⇠⇡⇢⇣⇤⇥⇦⇧⇨⇩⇪↺↻⇚⇛</p><h1 id="符号图案"><a href="#符号图案" class="headerlink" title="符号图案"></a>符号图案</h1><p>✐✎✏✑✒✉✁✂✃✄✆✉☎☏☑√☐☒✗ㄨ✘✕✖✖☢☠☣✈★☆✡囍㍿☯☰☲☱☴☵☶☳☷☜☞☚☛☟♤♧♡♢♠♣♥♦웃유❖☪✿♂♀✪✯☭➳卍卐√×■□◆●○✙☺☻❀⚘♔♕♖♗♙♚♛♜♝♞♟♂♀♠♣❤☜☞⊙☼▧▨♨▪◊◦▣▤▥▦▩◘◈◇♬♪♩♭♪の→あぃ￡Ю〓§♤¤✲❈✿✲❈➹☀☂☁【】┱┲❣✚✪✣✤✥✦※❉❥❦❧❃❂❁✄☪☣☢☠☭ღ☀☁☂☃☄☇☈⊙☊☋☌☍ⓛⓞⓥⓔ╬『』∴☀♫♬♩♭♪﹌の►◄♨↘▀▄█▌◦☼♪の→▬♦◊◦♠♣▣۰··۰►◄♨▪▫☼♦⊙●○①⊕Θ¤㊣♀◆◇◣◢◥▲▼△▽⊿◤◥✡✓✔✕✖♂♀☜☞⊙◎►◄♨◐◑▪▫☼♦▐░▒▬♦◊◘◙◦☼▣▤▥▦▩◘◙◈♫♬♪♩♭♪✄☪☣☢☠♯♩♪♫♬♭♮☪ºº₪¤큐«»™♂✿｡◕‿◕｡☹⊰⊱❀҉এృةمʚΐɞʚɞﻬ๑ف๓ق͜✿҉͜ღ҉℘ೄζั͡ตԅ️✾ೄ೨Ͽ҉✿ೃ✿҉͜✿ۣζั͡✿يℳ❀͜҉　҉҉͡꧁༺๑๑༻꧂დ﹏⃣ぃ￡</p><h1 id="希腊字母"><a href="#希腊字母" class="headerlink" title="希腊字母"></a>希腊字母</h1><p>ΑΒΓΔΕΖΗΘΙΚΛΜΝΞΟΠΡΣΤΥΦΧΨΩαβγδεζνξοπρσηθικλμτυφχψω</p><h1 id="俄语字母"><a href="#俄语字母" class="headerlink" title="俄语字母"></a>俄语字母</h1><p>АБВГДЕЁЖЗИЙКЛМНОПРСТУФХЦЧШЩЪЫЬЭЮЯабвгдеёжзийклмнопрстуфхцчшщъыьэюя</p><h1 id="汉语拼音"><a href="#汉语拼音" class="headerlink" title="汉语拼音"></a>汉语拼音</h1><p>āáǎàōóǒòēéěèīíǐìūúǔùǖǘǚǜüêɑńňɡㄅㄆㄇㄈㄉㄊㄋㄌㄍㄎㄏㄐㄑㄒㄓㄔㄕㄖㄗㄘㄙㄚㄛㄜㄝㄞㄟㄠㄡㄢㄣㄤㄥㄦㄧㄨㄩ</p><h1 id="中文字符"><a href="#中文字符" class="headerlink" title="中文字符"></a>中文字符</h1><p>卍卐卄巜朤氺曱甴囍兀々〆のぁ〡〢〣〤〥〦〧〨〩㊎㊍㊌㊋㊏㊚㊛㊐㊊㊣㊤㊥㊦㊧㊨㊒㊫㊑㊓㊔㊕㊖㊗㊘㊜㊝㊞㊟㊠㊡㊢㊩㊪㊬㊭㊮㊯㊰㊀㊁㊂㊃㊄㊅㊆㊇㊈㊉</p><h1 id="韩国符号"><a href="#韩国符号" class="headerlink" title="韩国符号"></a>韩国符号</h1><p>ㄱㄲㄳㄴㄵㄶㄷㄸㄹㄺㄻㄼㄽㄾㄿㅀㅁㅂㅃㅄㅅㅆㅇㅈㅉㅊㅋㅌㅍㅎㅏㅐㅑㅒㅓㅔㅗㅘㅙㅚㅛㅜㅝㅞㅟㅠㅡㅢㅥㅦㅧㅨㅩㅪㅫㅬㅭㅮㅯㅰㅱㅲㅳㅴㅵㅶㅷㅸㅹㅺㅻㅼㅽㅾㅿㆀㆁㆂㆃㆄㆅㆆㆇㆈㆉㆊ</p><h1 id="天气符"><a href="#天气符" class="headerlink" title="天气符"></a>天气符</h1><p>ϟ☀☁☂☃☄☉☼☽☾♁♨❄❅❆</p><h1 id="制表符"><a href="#制表符" class="headerlink" title="制表符"></a>制表符</h1><p>─━│┃╌╍╎╏┄┅┆┇┈┉┊┋┌┍┎┏┐┑┒┓└┕┖┗┘┙┚┛├┝┞┟┠┡┢┣┤┥┦┧┨┩┪┫┬┭┮┯┰┱┲┳┴┵┶┷┸┹┺┻┼┽┾┿╀╁╂╃╄╅╆╇╈╉╊╋╪╫╬═║╒╓╔╕╖╗╘╙╚╛╜╝╞╟╠╡╢╣╤╥╦╧╨╩╳╔╗╝╚╬═╓╩┠┨┯┷┏┓┗┛┳⊥﹃﹄┌╮╭╯╰</p><h1 id="国际象棋符号"><a href="#国际象棋符号" class="headerlink" title="国际象棋符号"></a>国际象棋符号</h1><p>♚　♛　♝　♞　♜　♟　♔　♕　♗　♘　♖　♟</p><h1 id="货币符号"><a href="#货币符号" class="headerlink" title="货币符号"></a>货币符号</h1><p>¥：人民币符号。</p><p>฿：泰铢标志（被使用在泰国），分标志（美元、欧元和其它货币细分）。</p><p>₡：col3on标志（被使用在哥斯达黎加和在萨尔瓦多）。</p><p>₠：ECU 标志（不广泛被应用, 和历史; 由欧洲替换）。</p><p>₢：克鲁赛罗标志（以前被使用在巴西）。</p><p>€：欧元标志。</p><p>₩：韩元、朝鲜元标志。</p><p>$：美元标志（并且被使用为许多其它货币在美洲, 譬如不同的比索, 和以前为葡萄牙埃斯库多作为 cifr6ao）。</p><p>￡：英磅标志（大不列颠及北爱尔兰联合王国/英国 货币符号）。</p><p>₯：德拉克马标志（以前被使用在希腊）。</p><p>₫：oong 标志（被使用在越南）。</p><p>円：日元的货币符。</p>]]></content>
      
      
      <categories>
          
          <category> 教程笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 文档 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>HDFS Shell 命令</title>
      <link href="post/d1e7dfd3.html"/>
      <url>post/d1e7dfd3.html</url>
      
        <content type="html"><![CDATA[<h1 id="FS-Shell"><a href="#FS-Shell" class="headerlink" title="FS Shell"></a>FS Shell</h1><ul><li><p>调用文件系统（FS）的 Shell 命令应使用 <code>bin/hadoop fs &lt;args&gt;</code> 的形式。</p></li><li><p>所有的 FS shell 命令使用 URI 路径作为参数。</p></li><li><p>URI 格式是 <code>scheme://authority/path</code>。对 HDFS 文件系统，<code>scheme</code> 是 <code>hdfs</code>，对本地文件系统，<code>scheme</code> 是 <code>file</code>。其中 <code>scheme</code> 和 <code>authority</code> 参数都是可选的，如果未加指定，就会使用配置中指定的默认 <code>scheme</code>。</p></li><li><p>一个 HDFS 文件或目录比如 <code>/parent/child</code> 可以表示成 <code>hdfs://namenode:namenodeport/parent/child</code>，或者更简单的 <code>/parent/child</code>（假设你配置文件中的默认值是 <code>namenode:namenodeport</code>）。</p></li><li><p>大多数 FS Shell 命令的行为和对应的 Unix Shell 命令类似，不同之处会在下面介绍各命令使用详情时指出。出错信息会输出到 <code>stderr</code>，其他信息输出到 <code>stdout</code>。</p></li></ul><h1 id="cat"><a href="#cat" class="headerlink" title="cat"></a>cat</h1><ul><li><p><strong>使用方法</strong>：</p><p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">hadoop fs -cat URI [URI …]<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p></li><li><p><strong>说明</strong>：将路径指定文件的内容输出到 <code>stdout</code>。</p></li><li><p><strong>示例</strong>：</p><p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">hadoop fs -cat hdfs:&#x2F;&#x2F;host1:port1&#x2F;file1 hdfs:&#x2F;&#x2F;host2:port2&#x2F;file2hadoop fs -cat file:&#x2F;&#x2F;&#x2F;file3 &#x2F;user&#x2F;hadoop&#x2F;file4<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></p></li><li><strong>返回值</strong>：成功返回 <code>0</code>，失败返回 <code>-1</code>。</li></ul><h1 id="chgrp"><a href="#chgrp" class="headerlink" title="chgrp"></a>chgrp</h1><ul><li><p><strong>使用方法</strong>：</p><p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">hadoop fs -chgrp [-R] GROUP URI [URI …]&#96;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p></li><li><strong>说明</strong>：改变文件所属的组。使用 <code>-R</code> 将使改变在目录结构下递归进行。命令的使用者必须是文件的所有者或者超级用户。</li></ul><h1 id="chmod"><a href="#chmod" class="headerlink" title="chmod"></a>chmod</h1><ul><li><p><strong>使用方法</strong>：</p><p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">hadoop fs -chmod [-R] &lt;MODE[,MODE]... | OCTALMODE&gt; URI [URI …]<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p></li><li><strong>说明</strong>：改变文件的权限。使用 <code>-R</code> 将使改变在目录结构下递归进行。命令的使用者必须是文件的所有者或者超级用户。</li></ul><h1 id="chown"><a href="#chown" class="headerlink" title="chown"></a>chown</h1><ul><li><p><strong>使用方法</strong>：</p><p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">hadoop fs -chown [-R] [OWNER][:[GROUP]] URI [URI ]<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p></li><li><strong>说明</strong>：改变文件的拥有者。使用 <code>-R</code> 将使改变在目录结构下递归进行。命令的使用者必须是超级用户。</li></ul><h1 id="copyFromLocal"><a href="#copyFromLocal" class="headerlink" title="copyFromLocal"></a>copyFromLocal</h1><ul><li><p><strong>使用方法</strong>：</p><p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">hadoop fs -copyFromLocal &lt;localsrc&gt; URI<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p></li><li><strong>说明</strong>：除了限定源路径是一个本地文件外，和 <a href="#put">put</a> 命令相似。</li></ul><h1 id="copyToLocal"><a href="#copyToLocal" class="headerlink" title="copyToLocal"></a>copyToLocal</h1><ul><li><p><strong>使用方法</strong>：</p><p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">hadoop fs -copyToLocal [-ignorecrc] [-crc] URI &lt;localdst&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p></li><li><strong>说明</strong>：除了限定目标路径是一个本地文件外，和 <a href="#get">get</a> 命令类似。</li></ul><h1 id="cp"><a href="#cp" class="headerlink" title="cp"></a>cp</h1><ul><li><p><strong>使用方法</strong>：</p><p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">hadoop fs -cp URI [URI …] &lt;dest&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p></li><li><p><strong>说明</strong>：将文件从源路径复制到目标路径。这个命令允许有多个源路径，此时目标路径必须是一个目录。</p></li><li><p><strong>示例</strong>：</p><p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">hadoop fs -cp &#x2F;user&#x2F;hadoop&#x2F;file1 &#x2F;user&#x2F;hadoop&#x2F;file2hadoop fs -cp &#x2F;user&#x2F;hadoop&#x2F;file1 &#x2F;user&#x2F;hadoop&#x2F;file2 &#x2F;user&#x2F;hadoop&#x2F;dir<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></p></li><li><strong>返回值</strong>：成功返回 <code>0</code>，失败返回 <code>-1</code>。</li></ul><h1 id="du"><a href="#du" class="headerlink" title="du"></a>du</h1><ul><li><p><strong>使用方法</strong>：</p><p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">hadoop fs -du URI [URI …]<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p></li><li><p><strong>说明</strong>：显示目录中所有文件的大小，或者当只指定一个文件时，显示此文件的大小。</p></li><li><p><strong>示例</strong>：</p><p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">hadoop fs -du &#x2F;user&#x2F;hadoop&#x2F;dir1 &#x2F;user&#x2F;hadoop&#x2F;file1 hdfs:&#x2F;&#x2F;host:port&#x2F;user&#x2F;hadoop&#x2F;dir1<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p></li><li><strong>返回值</strong>：成功返回 <code>0</code>，失败返回 <code>-1</code>。</li></ul><h1 id="dus"><a href="#dus" class="headerlink" title="dus"></a>dus</h1><ul><li><p><strong>使用方法</strong>：</p><p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">hadoop fs -dus &lt;args&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p></li><li><strong>说明</strong>：显示文件的大小。</li></ul><h1 id="expunge"><a href="#expunge" class="headerlink" title="expunge"></a>expunge</h1><ul><li><p><strong>使用方法</strong>：</p><p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">hadoop fs -expunge<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p></li><li><strong>说明</strong>：清空回收站。请参考 <a href="http://hadoop.apache.org/docs/r1.0.4/cn/hdfs_design.html">HDFS 设计文档</a> 以获取更多关于回收站特性的信息。</li></ul><h1 id="get"><a href="#get" class="headerlink" title="get"></a>get</h1><ul><li><p><strong>使用方法</strong>：</p><p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">hadoop fs -get [-ignorecrc] [-crc] &lt;src&gt; &lt;localdst&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p></li><li><p><strong>说明</strong>：复制文件到本地文件系统。可用 <code>-ignorecrc</code> 选项复制 CRC 校验失败的文件。使用 <code>-crc</code> 选项复制文件以及 CRC 信息。</p></li><li><p><strong>示例</strong>：</p><p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">hadoop fs -get &#x2F;user&#x2F;hadoop&#x2F;file localfilehadoop fs -get hdfs:&#x2F;&#x2F;host:port&#x2F;user&#x2F;hadoop&#x2F;file localfile<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></p></li><li><strong>返回值</strong>：成功返回 <code>0</code>，失败返回 <code>-1</code>。</li></ul><h1 id="getmerge"><a href="#getmerge" class="headerlink" title="getmerge"></a>getmerge</h1><ul><li><p><strong>使用方法</strong>：</p><p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">hadoop fs -getmerge &lt;src&gt; &lt;localdst&gt; [addnl]<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p></li><li><strong>说明</strong>：接受一个源目录和一个目标文件作为输入，并且将源目录中所有的文件连接成本地目标文件。<code>addnl</code> 是可选的，用于指定在每个文件结尾添加一个换行符。</li></ul><h1 id="ls"><a href="#ls" class="headerlink" title="ls"></a>ls</h1><ul><li><p><strong>使用方法</strong>：</p><p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">hadoop fs -ls &lt;args&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p></li><li><p><strong>说明</strong>：</p><ul><li><p>如果是文件，则按照如下格式返回文件信息：</p><p>  文件名 | &lt;副本数&gt; | 文件大小 | 修改日期 | 修改时间 | 权限 | 用户ID | 组ID</p></li><li><p>如果是目录，则返回它直接子文件的一个列表，就像在 Unix 中一样。目录返回列表的信息：</p><p>  目录名 | <code>&lt;dir&gt;</code> | 修改日期 | 修改时间 | 权限 | 用户ID | 组ID</p></li></ul></li><li><p><strong>示例</strong>：</p><p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">hadoop fs -ls &#x2F;user&#x2F;hadoop&#x2F;file1 &#x2F;user&#x2F;hadoop&#x2F;file2 hdfs:&#x2F;&#x2F;host:port&#x2F;user&#x2F;hadoop&#x2F;dir1 &#x2F;nonexistentfile<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p></li><li><strong>返回值</strong>：成功返回 <code>0</code>，失败返回 <code>-1</code>。</li></ul><h1 id="lsr"><a href="#lsr" class="headerlink" title="lsr"></a>lsr</h1><ul><li><p><strong>使用方法</strong>：</p><p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">hadoop fs -lsr &lt;args&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p></li><li><strong>说明</strong>：<a href="#ls">ls</a> 命令的递归版本。类似于 Unix 中的 <code>ls -R</code>。</li></ul><h1 id="mkdir"><a href="#mkdir" class="headerlink" title="mkdir"></a>mkdir</h1><ul><li><p><strong>使用方法</strong>：</p><p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">hadoop fs -mkdir &lt;paths&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p></li><li><p><strong>说明</strong>：接受路径指定的 <code>URI</code> 作为参数，创建这些目录。其行为类似于 Unix 的 <code>mkdir -p</code>，它会创建路径中的各级父目录。</p></li><li><p><strong>示例</strong>：</p><p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">hadoop fs -mkdir &#x2F;user&#x2F;hadoop&#x2F;dir1 &#x2F;user&#x2F;hadoop&#x2F;dir2hadoop fs -mkdir hdfs:&#x2F;&#x2F;host1:port1&#x2F;user&#x2F;hadoop&#x2F;dir hdfs:&#x2F;&#x2F;host2:port2&#x2F;user&#x2F;hadoop&#x2F;dir<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></p></li><li><strong>返回值</strong>：成功返回 <code>0</code>，失败返回 <code>-1</code>。</li></ul><h1 id="movefromLocal"><a href="#movefromLocal" class="headerlink" title="movefromLocal"></a>movefromLocal</h1><ul><li><p><strong>使用方法</strong>：</p><p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">dfs -moveFromLocal &lt;src&gt; &lt;dst&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p></li><li><strong>说明</strong>：输出一个 <code>not implemented</code> 信息。</li></ul><h1 id="mv"><a href="#mv" class="headerlink" title="mv"></a>mv</h1><ul><li><p><strong>使用方法</strong>：</p><p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">hadoop fs -mv URI [URI …] &lt;dest&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p></li><li><p><strong>说明</strong>：将文件从源路径移动到目标路径。这个命令允许有多个源路径，此时目标路径必须是一个目录。不允许在不同的文件系统间移动文件。</p></li><li><p><strong>示例</strong>：</p><p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">hadoop fs -mv &#x2F;user&#x2F;hadoop&#x2F;file1 &#x2F;user&#x2F;hadoop&#x2F;file2hadoop fs -mv hdfs:&#x2F;&#x2F;host:port&#x2F;file1 hdfs:&#x2F;&#x2F;host:port&#x2F;file2 hdfs:&#x2F;&#x2F;host:port&#x2F;file3 hdfs:&#x2F;&#x2F;host:port&#x2F;dir1<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></p></li><li><strong>返回值</strong>：成功返回 <code>0</code>，失败返回 <code>-1</code>。</li></ul><h1 id="put"><a href="#put" class="headerlink" title="put"></a>put</h1><ul><li><p><strong>使用方法</strong>：</p><p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">hadoop fs -put &lt;localsrc&gt; ... &lt;dst&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p></li><li><p><strong>说明</strong>：从本地文件系统中复制单个或多个源路径到目标文件系统。也支持从标准输入中读取输入写入目标文件系统。</p></li><li><p><strong>示例</strong>：</p><p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">hadoop fs -put localfile &#x2F;user&#x2F;hadoop&#x2F;hadoopfilehadoop fs -put localfile1 localfile2 &#x2F;user&#x2F;hadoop&#x2F;hadoopdirhadoop fs -put localfile hdfs:&#x2F;&#x2F;host:port&#x2F;hadoop&#x2F;hadoopfilehadoop fs -put - hdfs:&#x2F;&#x2F;host:port&#x2F;hadoop&#x2F;hadoopfile<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></p></li><li><strong>返回值</strong>：成功返回 <code>0</code>，失败返回 <code>-1</code>。</li></ul><h1 id="rm"><a href="#rm" class="headerlink" title="rm"></a>rm</h1><ul><li><p><strong>使用方法</strong>：</p><p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">hadoop fs -rm URI [URI …]<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p></li><li><p><strong>说明</strong>：删除指定的文件。只删除非空目录和文件。请参考 <a href="#rmr">rmr</a> 命令了解递归删除。</p></li><li><p><strong>示例</strong>：</p><p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">hadoop fs -rm hdfs:&#x2F;&#x2F;host:port&#x2F;file &#x2F;user&#x2F;hadoop&#x2F;emptydir<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p></li><li><strong>返回值</strong>：成功返回 <code>0</code>，失败返回 <code>-1</code>。</li></ul><h1 id="rmr"><a href="#rmr" class="headerlink" title="rmr"></a>rmr</h1><ul><li><p><strong>使用方法</strong>：</p><p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">hadoop fs -rmr URI [URI …]<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p></li><li><p><strong>说明</strong>：<a href="#rm">rm</a> 命令的递归版本。</p></li><li><p><strong>示例</strong>：</p><p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">hadoop fs -rmr &#x2F;user&#x2F;hadoop&#x2F;dirhadoop fs -rmr hdfs:&#x2F;&#x2F;host:port&#x2F;user&#x2F;hadoop&#x2F;dir<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></p></li><li><strong>返回值</strong>：成功返回 <code>0</code>，失败返回 <code>-1</code>。</li></ul><h1 id="setrep"><a href="#setrep" class="headerlink" title="setrep"></a>setrep</h1><ul><li><p><strong>使用方法</strong>：</p><p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">hadoop fs -setrep [-R] &lt;path&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p></li><li><p><strong>说明</strong>：改变一个文件的副本系数。<code>-R</code> 选项用于递归改变目录下所有文件的副本系数。</p></li><li><p><strong>示例</strong>：</p><p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">hadoop fs -setrep -w 3 -R &#x2F;user&#x2F;hadoop&#x2F;dir1<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p></li><li><strong>返回值</strong>：成功返回 <code>0</code>，失败返回 <code>-1</code>。</li></ul><h1 id="stat"><a href="#stat" class="headerlink" title="stat"></a>stat</h1><ul><li><p><strong>使用方法</strong>：</p><p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">hadoop fs -stat URI [URI …]<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p></li><li><p><strong>说明</strong>：返回指定路径的统计信息。</p></li><li><p><strong>示例</strong>：</p><p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">hadoop fs -stat path<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p></li><li><strong>返回值</strong>：成功返回 <code>0</code>，失败返回 <code>-1</code>。</li></ul><h1 id="tail"><a href="#tail" class="headerlink" title="tail"></a>tail</h1><ul><li><p><strong>使用方法</strong>：</p><p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">hadoop fs -tail [-f] URI<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p></li><li><p><strong>说明</strong>：将文件尾部 1K 字节的内容输出到 <code>stdout</code>。支持 <code>-f</code> 选项，行为和 Unix 中一致。</p></li><li><p><strong>示例</strong>：</p><p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">hadoop fs -tail pathname<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p></li><li><strong>返回值</strong>：成功返回 <code>0</code>，失败返回 <code>-1</code>。</li></ul><h1 id="test"><a href="#test" class="headerlink" title="test"></a>test</h1><ul><li><p><strong>使用方法</strong>：</p><p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">hadoop fs -test -[ezd] URI<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p></li><li><p><strong>说明</strong>：</p><ul><li><code>e</code> 检查文件是否存在。如果存在则返回 <code>0</code>。</li><li><code>z</code> 检查文件是否是 0 字节。如果是则返回 <code>0</code>。</li><li><code>d</code> 如果路径是个目录，则返回 <code>1</code>，否则返回 <code>0</code>。</li></ul></li><li><p><strong>示例</strong>：</p><p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">hadoop fs -test -e filename<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p></li></ul><h1 id="text"><a href="#text" class="headerlink" title="text"></a>text</h1><ul><li><p><strong>使用方法</strong>：</p><p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">hadoop fs -text &lt;src&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p></li><li><strong>说明</strong>：将源文件输出为文本格式。允许的格式是 <code>zip</code> 和 <code>TextRecordInputStream</code>。</li></ul><h1 id="touchz"><a href="#touchz" class="headerlink" title="touchz"></a>touchz</h1><ul><li><p><strong>使用方法</strong>：</p><p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">hadoop fs -touchz URI [URI …]<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p></li><li><p><strong>说明</strong>：创建一个 0 字节的空文件。</p></li><li><p><strong>示例</strong>：</p><p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">hadoop -touchz pathname<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p></li><li><strong>返回值</strong>：成功返回 <code>0</code>，失败返回 <code>-1</code>。</li></ul>]]></content>
      
      
      <categories>
          
          <category> 教程笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 大数据 </tag>
            
            <tag> Hadoop </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Git 使用教程</title>
      <link href="post/c3cf24c7.html"/>
      <url>post/c3cf24c7.html</url>
      
        <content type="html"><![CDATA[<h1 id="什么是-Git"><a href="#什么是-Git" class="headerlink" title="什么是 Git"></a>什么是 Git</h1><p>Git 是一个开源的分布式版本控制系统，用于敏捷高效地处理任何或小或大的项目。</p><p>Git 是 Linus Torvalds 为了帮助管理 Linux 内核开发而开发的一个开放源码的版本控制软件。</p><p>Git 与常用的版本控制工具 CVS，Subversion 等不同，它采用了分布式版本库的方式，不必服务器端软件支持。</p><h1 id="Git-与-SVN-区别"><a href="#Git-与-SVN-区别" class="headerlink" title="Git 与 SVN 区别"></a>Git 与 SVN 区别</h1><p>Git 不仅仅是个版本控制系统，它也是个内容管理系统（CMS），工作管理系统等。</p><p>如果你是一个具有使用 SVN 背景的人，你需要做一定的思想转换，来适应 Git 提供的一些概念和特征。</p><p>Git 与 SVN 区别点：</p><ol><li>Git 是分布式的，SVN 是集中式的：这是 Git 和其它非分布式的版本控制系统，例如 SVN，CVS 等，最核心的区别。</li><li>Git 把内容按元数据方式存储，而 SVN 是按文件：所有的资源控制系统都是把文件的元信息隐藏在一个类似 .svn、.cvs 等的文件夹里。</li><li>Git 分支和 SVN 的分支不同：分支在 SVN 中一点都不特别，其实它就是版本库中的另外一个目录。</li><li>Git 没有一个全局的版本号，而 SVN 有：目前为止这是跟 SVN 相比 Git 缺少的最大的一个特征。</li><li>Git 的内容完整性要优于 SVN：Git 的内容存储使用的是 SHA-1 哈希算法。这能确保代码内容的完整性，确保在遇到磁盘故障和网络问题时降低对版本库的破坏。</li></ol><h1 id="Git-的安装和配置"><a href="#Git-的安装和配置" class="headerlink" title="Git 的安装和配置"></a>Git 的安装和配置</h1><p><a href="https://git-scm.com/downloads">Git 下载地址（Linux/Unix，Mac，Windows 等相关平台）</a></p><p><a href="http://git-scm.com/docs">Git 完整命令手册地址</a></p><p><a href="github-git-cheat-sheet.pdf">Git PDF 版命令手册</a></p><p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">### 配置所有 Git 仓库的 用户名 和 email $ git config --global user.name &quot;Your Name&quot;$ git config --global user.email &quot;youremail@example.com&quot;### 配置当前 Git 仓库的 用户名 和 email$ git config user.name &quot;Your Name&quot;$ git config user.email &quot;youremail@example.com&quot;### 查看全局配置的 用户名 和 email $ git config --global user.name      查看用户名$ git config --global user.email     查看邮箱地址### 查看当前仓库配置的 用户名 和 email $ git config user.name      查看用户名$ git config user.email     查看邮箱地址# Git 是分布式版本控制系统，所以，每个机器都配置你的名字和 Email 地址# git config 命令的 --global 参数，用了这个参数，表示你这台机器上所有的 Git 仓库都会使用这个配置，当然也可以对某个仓库指定不同的用户名和 Email 地址（不加 --global）。<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h1 id="Git-工作流程"><a href="#Git-工作流程" class="headerlink" title="Git 工作流程"></a>Git 工作流程</h1><p><img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="/images/post/git/workflow.png" alt></p><p>以上包括一些简单而常用的命令，但是先不关心这些，先来了解下面这 4 个专有名词。</p><ul><li>Workspace：<a href="#工作区">工作区</a></li><li>Index/Stage：<a href="#暂存区">暂存区</a></li><li>Repository：<a href="#本地仓库">仓库区（或本地仓库）</a></li><li>Remote：<a href="#远程仓库">远程仓库</a></li></ul><h2 id="工作区"><a href="#工作区" class="headerlink" title="工作区"></a>工作区</h2><p>程序员进行开发改动的地方，是你当前看到的，也是最新的。</p><p>平常我们开发就是拷贝远程仓库中的一个分支，基于该分支进行开发。在开发过程中就是对工作区的操作。</p><h2 id="暂存区"><a href="#暂存区" class="headerlink" title="暂存区"></a>暂存区</h2><p>.git 目录下的 index 文件，暂存区会记录 <code>git add</code> 添加文件的相关信息（文件名、大小、timestamp...），不保存文件实体，通过 id 指向每个文件实体。可以使用 <code>git status</code> 查看暂存区的状态。暂存区标记了你当前工作区中，哪些内容是被 git 管理的。</p><p>当你完成某个需求或功能后需要提交到远程仓库，那么第一步就是通过 <code>git add</code> 先提交到暂存区，被 git 管理。</p><h2 id="本地仓库"><a href="#本地仓库" class="headerlink" title="本地仓库"></a>本地仓库</h2><p>保存了对象被提交过的各个版本，比起工作区和暂存区的内容，它要更旧一些。</p><p><code>git commit</code> 后同步 index 的目录树到本地仓库，方便从下一步通过 <code>git push</code> 同步本地仓库与远程仓库的同步。</p><h2 id="远程仓库"><a href="#远程仓库" class="headerlink" title="远程仓库"></a>远程仓库</h2><p>远程仓库的内容可能被分布在多个地点的处于协作关系的本地仓库修改，因此它可能与本地仓库同步，也可能不同步，但是它的内容是最旧的。</p><h2 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h2><ul><li>任何对象都是在工作区中诞生和被修改；</li><li>任何修改都是从进入 <code>index</code> 区才开始被版本控制；</li><li>只有把修改提交到本地仓库，该修改才能在仓库中留下痕迹；</li><li>与协作者分享本地的修改，可以把它们 <code>push</code> 到远程仓库来共享。</li></ul><p>下面这幅图更加直接阐述了四个区域之间的关系，可能有些命令不太清楚，下面将会详细介绍。</p><p><img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="/images/post/git/workflow2.png" alt></p><h1 id="Git-常用命令"><a href="#Git-常用命令" class="headerlink" title="Git 常用命令"></a>Git 常用命令</h1><p><img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="/images/post/git/command.png" alt></p><h2 id="版本与配置"><a href="#版本与配置" class="headerlink" title="版本与配置"></a>版本与配置</h2><p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">$ git                         查看 git 的相关命令（git --help）$ git --version               查看 git 的版本$ git config                  查看 git config 的相关命令<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></p><h2 id="初始化本地仓库"><a href="#初始化本地仓库" class="headerlink" title="初始化本地仓库"></a>初始化本地仓库</h2><p>Git 使用 <code>git init</code> 命令来初始化一个 Git 仓库，Git 的很多命令都需要在 Git 的仓库中运行，所以 <code>git init</code> 是使用 Git 的第一个命令。</p><p>在执行完成 <code>git init</code> 命令后，Git 仓库会生成一个 .git 目录，该目录包含了资源的所有元数据，其他的项目目录保持不变。</p><p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">$ git init                    创建本地仓库$ git clone                   克隆远程仓库<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></p><h2 id="添加文件到仓库"><a href="#添加文件到仓库" class="headerlink" title="添加文件到仓库"></a>添加文件到仓库</h2><p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">$ git add &lt;file&gt;                 如: git add readme.txt$ git commit -m &quot;description&quot;    如: git commit -m &quot;add readme.txt&quot;# 添加文件到仓库分两步:# 1. add 添加该文件到仓库# 添加许多同种类型的文件，可以使用通配符 *（记得加引号），如: git add &quot;*.txt&quot; 命令就是添加所有 .txt 文件# 2. commit 提交该文件到仓库，description 为你对该次提交的描述说明# 注意: 可以多次 add 不同的文件，commit 可以一次提交多个文件<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h2 id="查看仓库目前状态"><a href="#查看仓库目前状态" class="headerlink" title="查看仓库目前状态"></a>查看仓库目前状态</h2><p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">$ git status                 查看项目是否有修改、添加、未追踪的文件等<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><h2 id="查看修改"><a href="#查看修改" class="headerlink" title="查看修改"></a>查看修改</h2><p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">$ git diff                   查看工作区（work dict）和暂存区（stage）的区别$ git diff &lt;file&gt;$ git diff --cached          查看暂存区（stage）和分支（master）的区别$ git diff HEAD -- &lt;file&gt;    查看工作区和版本库里面最新版本的区别#如: git diff readme.txt     查看 readme.txt 修改了什么，有什么不同<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h2 id="查看提交日志"><a href="#查看提交日志" class="headerlink" title="查看提交日志"></a>查看提交日志</h2><p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">$ git log$ git log --oneline           美化输出信息，每个记录显示为一行，显示 commit_id 前几位数$ git log --pretty&#x3D;oneline    美化输出信息，每个记录显示为一行，显示完整的 commit_id$ git log --graph --pretty&#x3D;format:&#39;%h -%d %s (%cr)&#39; --abbrev-commit --$ git log --graph --pretty&#x3D;oneline --abbrev-commit# 显示从最近到最远的提交日志# 日志输出一大串类似 3628164...882e1e0 的是 commit_id（版本号），和 SVN 不一样，Git 的 commit_id 不是 1，2，3... 递增的数字，而是一个 SHA1 计算出来的一个非常大的数字，用十六进制表示，因为 Git 是分布式的版本控制系统，当多人在同一个版本库里工作，如果大家都用 1，2，3... 作为版本号，那肯定就冲突了# 最后一个会打印出提交的时间等，（HEAD -&gt; master）指向的是当前的版本# 退出查看 log 日志，输入字母 q（英文状态）<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h2 id="版本回退"><a href="#版本回退" class="headerlink" title="版本回退"></a>版本回退</h2><p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">$ git reset --hard HEAD^$ git reset --hard &lt;commit_id&gt;# HEAD        表示当前版本，也就是最新的提交# HEAD^       上一个版本# HEAD^^      上上一个版本# HEAD~100    往上100个版本# 回退到 commit_id 对应的那个版本，commit_id 为版本号，只需要前几位就行<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h2 id="查看命令历史"><a href="#查看命令历史" class="headerlink" title="查看命令历史"></a>查看命令历史</h2><p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">$ git reflog# 假如我们依次提交了三个版本 a-&gt;b-&gt;c，然后昨天我们从版本 c 回退到了版本 b，今天我们又想要回到版本 c，此时就可以使用 reflog 命令来查找 c 版本的 commit_id，然后使用 reset 命令来进行版本回退<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></p><h2 id="撤销修改"><a href="#撤销修改" class="headerlink" title="撤销修改"></a>撤销修改</h2><p><strong>丢弃工作区（Working Directory）的修改</strong></p><p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">$ git restore &lt;file&gt;        （建议使用，如: git restore readme.txt）$ git checkout -- &lt;file&gt;# 命令中 -- 很重要，没有就变成 “切换到另一个分支” 的命令<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></p><p><strong>丢弃暂存区（stage/index）的修改</strong></p><p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"># 第一步: 把暂存区的修改撤销掉（unstage），重新放回工作区$ git restore --staged &lt;file&gt;# 第二步: 撤销工作区的修改$ git restore &lt;file&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p><strong>小结</strong></p><ul><li><p>当你改乱了工作区某个文件的内容，想直接丢弃工作区的修改时，用命令 <code>git restore &lt;file&gt;</code>。</p></li><li><p>当你不但改乱了工作区某个文件的内容，还添加到了暂存区时，想丢弃修改，分两步，第一步用命令 <code>git restore --staged &lt;file&gt;</code>，就回到了场景 1，第二步按场景 1 操作。</p></li><li><p>已经提交了不合适的修改到版本库时，想要撤销本次提交，参考<a href="#版本回退">版本回退</a>一节，不过前提是没有推送到远程库。</p></li></ul><h2 id="删除文件"><a href="#删除文件" class="headerlink" title="删除文件"></a>删除文件</h2><p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">$ git rm &lt;file&gt;# git rm &lt;file&gt; 相当于执行- rm &lt;file&gt;- git add &lt;file&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h1 id="远程仓库-1"><a href="#远程仓库-1" class="headerlink" title="远程仓库"></a>远程仓库</h1><ol><li><p>创建 SSH Key</p><p> <pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">$ ssh-keygen -t rsa -C &quot;youremail@example.com&quot;# 邮件地址换成你自己的邮件地址，然后一直回车，使用默认值即可，无需设置密码。<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></p><p> 在用户主目录下，看看有没有 .ssh 目录，如果有，再看看这个目录下有没有 id_rsa 和 id_rsa.pub 这两个文件，如果已经有了，可直接跳到下一步。如果没有，创建 SSH Key</p><p> 如果一切顺利的话，可以在用户主目录里找到 .ssh 目录，里面有 id_rsa 和 id_rsa.pub 两个文件，这两个就是 SSH Key 的秘钥对，id_rsa 是私钥，不能泄露出去，id_rsa.pub 是公钥，可以放心地告诉任何人。</p></li><li><p>登录 GitHub，在 Settings 中找到 SSH 设置项中添加新的 SSH Key，设置任意 title，在 Key 文本框里粘贴 id_rsa.pub 文件的内容</p></li><li><p>关联远程仓库（先有本地仓库）</p><p> <pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">$ git remote add origin git@github.com:username&#x2F;repo.git# 后面的地址换成自己的 GitHub 仓库地址<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></p></li><li><p>推送到远程仓库</p><p> <pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">$ git remote       查看远程库信息$ git remote -v    查看远程库详细信息$ git remote rm origin  删除已关联的远程库 origin$ git push -u origin master    #第一次推送$ git push origin master      推送本地 master 分支到远程库$ git push origin dev         推送本地 dev 分支到远程库#  除了第一次推送，不需要添加 -u 参数# 一个本地库关联多个远程库，例如同时关联 GitHub 和 Gitee:# 1. 先关联GitHub的远程库：（注意:远程库的名称叫 github，不叫 origin）$ git remote add github git@github.com:username&#x2F;repo.git# 2. 再关联Gitee的远程库：（注意:远程库的名称叫 gitee，不叫 origin）$ git remote add gitee git@gitee.com:username&#x2F;repo.git# 3. 推送到远程库$ git push github master$ git push gitee master<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p> 加上了 <code>-u</code> 参数，Git 不但会把本地的 master 分支内容推送的远程新的 master 分支，还会把本地的 master 分支和远程的 master 分支关联起来</p></li><li><p>从远程仓库克隆（先有远程库）</p><p> <pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">$ git clone git@github.com:username&#x2F;repo.git# GitHub 支持多种协议，上面是 ssh 协议，还有 https 协议<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></p></li></ol><h1 id="Git-分支"><a href="#Git-分支" class="headerlink" title="Git 分支"></a>Git 分支</h1><p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">$ git branch           查看分支列表及当前分支$ git branch dev       创建 dev 分支$ git switch dev       切换到 dev 分支（git checkout dev）$ git switch -c dev    创建并切换到新的 dev 分支（git checkout -b dev）$ git switch -c dev origin&#x2F;dev  创建远程 origin 的 dev 分支到本地并切换到该分支$ git branch -d dev    删除 dev 分支$ git branch -D dev    强制删除 dev 分支$ git merge dev        合并 dev 分支到当前分支（当有冲突的时候，需要先解决冲突）$ git merge --no-ff -m &quot;merge with no-ff&quot; dev    合并 dev 分支到当前分支（禁用 Fast forward 合并策略）$ git pull  拉取远程分支最新的内容$ git branch --set-upstream-to&#x3D;origin&#x2F;dev dev    指定本地 dev 分支与远程 origin&#x2F;dev 分支的链接# 为本次合并要创建一个新的commit，所以加上 -m 参数，把 commit 描述写进去# 合并分支时，加上 --no-ff 参数就可以用普通模式合并，合并后的历史有分支，能看出来曾经做过合并，而 fast forward 合并就看不出来曾经做过合并<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">$ git log --graph    查看分支合并图$ git log --graph --pretty&#x3D;oneline --abbrev-commit$ git stash          保存当前工作区和暂存区的修改状态，切换到其他分支修复 bug 等工作，然后在回来继续工作$ git stash list     查看保存现场的列表$ git stash pop      恢复的同时把 stash 内容也删除$ git stash apply    恢复现场，stash内容并不删除$ git stash drop     删除 stash 内容$ git stash apply stash@&#123;0&#125;    多次 stash，恢复的时候，先用 git stash list 查看，然后恢复指定的 stash# 通常在 dev 分支开发时，需要有紧急 bug 需要马上处理，保存现在修改的文件等，先修复 bug 后再回来继续工作的情况$ git cherry-pick &lt;commit&gt;    复制一个特定的提交到当前分支（当前分支的内容需要先 commit，然后冲突的文件需要解决冲突，然后 commit）$ git rebase    把本地未 push 的分叉提交历史整理成直线（使得我们在查看历史提交的变化时更容易，因为分叉的提交需要三方对比）<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h1 id="Git-标签"><a href="#Git-标签" class="headerlink" title="Git 标签"></a>Git 标签</h1><p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"># 切换到对应的分支 branch 上，查看或者操作对应的标签 tag $ git tag                                 查看所有的标签$ git tag &lt;tagname&gt;                       打标签（默认标签是打在最新提交的commit上），如: git tag v1.0$ git tag &lt;tagname&gt; &lt;commit_id&gt;           给对应的 commit_id 打标签$ git tag -a &lt;tagname&gt; -m &quot;标签说明信息&quot; &lt;commit_id&gt;    创建带有说明的标签，用 -a 指定标签名，-m 指定说明文字$ git tag -d &lt;tagname&gt;                    删除一个本地标签$ git push origin :refs&#x2F;tags&#x2F;&lt;tagname&gt;    可以删除一个远程标签$ git show &lt;tagname&gt;                      查看标签信息$ git push origin &lt;tagname&gt;               推送一个本地标签到远程$ git push origin --tags                  一次性推送全部尚未推送到远程的本地标签# 删除远程标签，需要先删除本地标签，然后在删除远程标签，如:删除标签 v0.9$ git tag -d v0.9$ git push origin :refs&#x2F;tags&#x2F;v0.9<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h1 id="Commit-message-格式"><a href="#Commit-message-格式" class="headerlink" title="Commit message 格式"></a>Commit message 格式</h1><p>Git 每次提交代码，都要写 Commit message（提交说明），否则就不允许提交。但是，一般来说，Commit message 应该清晰明了，说明本次提交的目的。</p><p>每次提交，Commit message 都包括三个部分：header，body 和 footer。</p><p><pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>type</span><span class="token punctuation">></span></span>(<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">></span></span>): <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>subject</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>BLANK</span> <span class="token attr-name">LINE</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>BLANK</span> <span class="token attr-name">LINE</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>footer</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p>其中，header 是必需的，body 和 footer 可以省略。</p><p>不管是哪一个部分，任何一行都不得超过 72 个字符（或 100 个字符）。这是为了避免自动换行影响美观。</p><h2 id="Header"><a href="#Header" class="headerlink" title="Header"></a>Header</h2><p>Header 部分只有一行，包括三个字段：<code>type</code>（必需）、<code>scope</code>（可选）和<code>subject</code>（必需）。</p><h3 id="type"><a href="#type" class="headerlink" title="type"></a>type</h3><p>用于说明 commit 的类别，只允许使用下面7个标识。</p><ul><li><code>feat</code>：新功能（feature）</li><li><code>fix</code>：修补 bug</li><li><code>docs</code>：文档（documentation）</li><li><code>style</code>：格式（不影响代码运行的变动）</li><li><code>refactor</code>：重构（即不是新增功能，也不是修改 bug 的代码变动）</li><li><code>test</code>：增加测试</li><li><code>chore</code>：构建过程或辅助工具的变动</li></ul><p>如果 type 为 <code>feat</code> 和 <code>fix</code>，则该 commit 将肯定出现在 Change log 之中。其他情况（docs、chore、style、refactor、test）由你决定，要不要放入 Change log，建议是不要。</p><h3 id="scope"><a href="#scope" class="headerlink" title="scope"></a>scope</h3><p>scope 用于说明 commit 影响的范围，比如数据层、控制层、视图层等等，视项目不同而不同。</p><p>例如在 Angular，可以是 <code>$location</code>, <code>$browser</code>, <code>$compile</code>, <code>$rootScope</code>, <code>ngHref</code>, <code>ngClick</code>, <code>ngView</code> 等。</p><p>如果你的修改影响了不止一个 <code>scope</code>，你可以使用 <code>*</code> 代替。</p><h3 id="subject"><a href="#subject" class="headerlink" title="subject"></a>subject</h3><p>subject 是 commit 目的的简短描述，不超过 50 个字符。</p><p>其他注意事项：</p><ul><li>以动词开头，使用第一人称现在时，比如 change，而不是 changed 或 changes</li><li>第一个字母小写</li><li>结尾不加句号（.）</li></ul><h2 id="Body"><a href="#Body" class="headerlink" title="Body"></a>Body</h2><p>Body 部分是对本次 commit 的详细描述，可以分成多行。下面是一个范例。</p><p><pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown">More detailed explanatory text, if necessary.  Wrap it to about 72 characters or so. Further paragraphs come after blank lines.<span class="token list punctuation">-</span> Bullet points are okay, too<span class="token list punctuation">-</span> Use a hanging indent<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p>有三个注意点:</p><ul><li>使用第一人称现在时，比如使用 change 而不是 changed 或 changes。</li><li>永远别忘了第 2 行是空行</li><li>应该说明代码变动的动机，以及与以前行为的对比。</li></ul><h2 id="Footer"><a href="#Footer" class="headerlink" title="Footer"></a>Footer</h2><p>Footer 部分只用于以下两种情况：</p><h3 id="不兼容变动"><a href="#不兼容变动" class="headerlink" title="不兼容变动"></a>不兼容变动</h3><p>如果当前代码与上一个版本不兼容，则 Footer 部分以 <code>BREAKING CHANGE</code> 开头，后面是对变动的描述、以及变动理由和迁移方法。</p><p><pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown">BREAKING CHANGE: isolate scope bindings definition has changed.<span class="token code keyword">    To migrate the code follow the example below:</span><span class="token code keyword">    Before:</span><span class="token code keyword">    scope: &#123;      myAttr: 'attribute',    &#125;</span><span class="token code keyword">    After:</span><span class="token code keyword">    scope: &#123;      myAttr: '@',    &#125;</span><span class="token code keyword">    The removed `inject` wasn't generaly useful for directives so there should be no code using it.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h3 id="关闭-Issue"><a href="#关闭-Issue" class="headerlink" title="关闭 Issue"></a>关闭 Issue</h3><p>如果当前 commit 针对某个 issue，那么可以在 Footer 部分关闭这个 issue 。</p><p><pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown">Closes #234<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><h2 id="Revert"><a href="#Revert" class="headerlink" title="Revert"></a>Revert</h2><p>还有一种特殊情况，如果当前 commit 用于撤销以前的 commit，则必须以 <code>revert:</code> 开头，后面跟着被撤销 Commit 的 Header。</p><p><pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown">revert: feat(pencil): add 'graphiteWidth' optionThis reverts commit 667ecc1654a317a13331b17617d973392f415f02.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></p><p>Body 部分的格式是固定的，必须写成 <code>This reverts commit &amp;lt;hash&gt;.</code>，其中的 hash 是被撤销 commit 的 SHA 标识符。</p><p>如果当前 commit 与被撤销的 commit，在同一个发布（release）里面，那么它们都不会出现在 Change log 里面。如果两者在不同的发布，那么当前 commit，会出现在 Change log 的 Reverts 小标题下面。</p>]]></content>
      
      
      <categories>
          
          <category> 教程笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> git </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>26 个字母 26 句话</title>
      <link href="post/32c40e7c.html"/>
      <url>post/32c40e7c.html</url>
      
        <content type="html"><![CDATA[<p><style>#article-container img {width: 50%}</style></p><p>一个字母一张图，一张图一个感悟，一个感悟一份思考，一份思考一个行动。</p><p><img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/letter/a_proverb.png" alt><img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/letter/b_proverb.png" alt><img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/letter/c_proverb.png" alt><img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/letter/d_proverb.png" alt><img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/letter/e_proverb.png" alt><img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/letter/f_proverb.png" alt><img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/letter/g_proverb.png" alt><img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/letter/h_proverb.png" alt><img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/letter/i_proverb.png" alt><img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/letter/j_proverb.png" alt><img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/letter/k_proverb.png" alt><img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/letter/l_proverb.png" alt><img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/letter/m_proverb.png" alt><img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/letter/n_proverb.png" alt><img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/letter/o_proverb.png" alt><img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/letter/p_proverb.png" alt><img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/letter/q_proverb.png" alt><img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/letter/r_proverb.png" alt><img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/letter/s_proverb.png" alt><img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/letter/t_proverb.png" alt><img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/letter/u_proverb.png" alt><img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/letter/v_proverb.png" alt><img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/letter/w_proverb.png" alt><img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/letter/x_proverb.png" alt><img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/letter/y_proverb.png" alt><img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/letter/z_proverb.png" alt></p>]]></content>
      
      
      <categories>
          
          <category> 生活随记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 生活随记 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>作品案例</title>
      <link href="post/8b714264.html"/>
      <url>post/8b714264.html</url>
      
        <content type="html"><![CDATA[]]></content>
      
      
      <categories>
          
          <category> 作品案例 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 作品案例 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>R 语言统计分析</title>
      <link href="post/741c153c.html"/>
      <url>post/741c153c.html</url>
      
        <content type="html"><![CDATA[<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>R 中的统计分析通过使用许多内置函数来执行。这些函数大多数是 R 基础包的一部分。这些函数将 R 向量作为输入和参数，并给出结果。</p><h1 id="平均值"><a href="#平均值" class="headerlink" title="平均值"></a>平均值</h1><p>通过求出数据集的和再除以求和数的总量得到平均值</p><p>函数 <code>mean()</code> 用于在 R 语言中计算平均值。</p><h2 id="语法"><a href="#语法" class="headerlink" title="语法"></a>语法</h2><p>用于计算 R 中的平均值的基本语法是：</p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r">mean<span class="token punctuation">(</span>x<span class="token punctuation">,</span> trim <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> na.rm <span class="token operator">=</span> <span class="token boolean">FALSE</span><span class="token punctuation">,</span> <span class="token ellipsis">...</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><p>以下是所使用的参数的说明：</p><ul><li><code>x</code> 是输入向量。</li><li><code>trim</code> 用于从排序向量的两端丢弃一些观察结果。</li><li><code>na.rm</code> 用于从输入向量中删除缺失值。</li></ul><p><pre class="line-numbers language-r" data-language="r"><code class="language-r"><span class="token comment"># Create a vector. </span>x <span class="token operator">&lt;-</span> c<span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4.2</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">54</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">21</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token comment"># Find Mean.</span>result.mean <span class="token operator">&lt;-</span> mean<span class="token punctuation">(</span>x<span class="token punctuation">)</span>print<span class="token punctuation">(</span>result.mean<span class="token punctuation">)</span><span class="token comment"># 当我们执行上面的代码，它产生以下结果：</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token number">8.22</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h2 id="应用-trim-选项"><a href="#应用-trim-选项" class="headerlink" title="应用 trim 选项"></a>应用 trim 选项</h2><p>当提供 <code>trim</code> 参数时，向量中的值被排序，然后从计算平均值中减去所需的观察值。</p><p>当 <code>trim = 0.3</code> 时，来自每端的 3 个值将从计算中减去以找到均值。</p><p>在这种情况下，排序的向量是 <code>(-21, -5, 2, 3, 4.2, 7, 8, 12, 18, 54)</code>，并且从用于计算平均值的向量中移除的值是左边的 <code>(-21, -5, 2)</code> 从和右边的 <code>(12, 18, 54)</code>。</p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r"><span class="token comment"># Create a vector.</span>x <span class="token operator">&lt;-</span> c<span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4.2</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">54</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">21</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token comment"># Find Mean.</span>result.mean <span class="token operator">&lt;-</span> mean<span class="token punctuation">(</span>x<span class="token punctuation">,</span> trim <span class="token operator">=</span> <span class="token number">0.3</span><span class="token punctuation">)</span>print<span class="token punctuation">(</span>result.mean<span class="token punctuation">)</span><span class="token comment"># 当我们执行上面的代码，它产生以下结果：</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token number">5.55</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h2 id="应用-NA-选项"><a href="#应用-NA-选项" class="headerlink" title="应用 NA 选项"></a>应用 NA 选项</h2><p>如果有缺失值，则平均函数返回 <code>NA</code>。</p><p>要从计算中删除缺少的值，请使用 <code>na.rm = TRUE</code>。这意味着去除 <code>NA</code> 值。</p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r"><span class="token comment"># Create a vector. </span>x <span class="token operator">&lt;-</span> c<span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4.2</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">54</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">21</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token keyword">NA</span><span class="token punctuation">)</span><span class="token comment"># Find mean.</span>result.mean <span class="token operator">&lt;-</span> mean<span class="token punctuation">(</span>x<span class="token punctuation">)</span>print<span class="token punctuation">(</span>result.mean<span class="token punctuation">)</span><span class="token comment"># Find mean dropping NA values.</span>result.mean <span class="token operator">&lt;-</span> mean<span class="token punctuation">(</span>x<span class="token punctuation">,</span> na.rm <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">)</span>print<span class="token punctuation">(</span>result.mean<span class="token punctuation">)</span><span class="token comment"># 当我们执行上面的代码，它产生以下结果：</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token keyword">NA</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token number">8.22</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h1 id="中位数"><a href="#中位数" class="headerlink" title="中位数"></a>中位数</h1><p>数据系列中的最中间值称为中位数。在 R 语言中使用 <code>median()</code> 函数来计算此值。</p><h2 id="语法-1"><a href="#语法-1" class="headerlink" title="语法"></a>语法</h2><p>计算 R 语言中位数的基本语法是：</p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r">median<span class="token punctuation">(</span>x<span class="token punctuation">,</span> na.rm <span class="token operator">=</span> <span class="token boolean">FALSE</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><p>以下是所使用的参数的说明：</p><ul><li><code>x</code> 是输入向量。</li><li><code>na.rm</code> 用于从输入向量中删除缺失值。</li></ul><p><pre class="line-numbers language-r" data-language="r"><code class="language-r"><span class="token comment"># Create the vector.</span>x <span class="token operator">&lt;-</span> c<span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4.2</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">54</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">21</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token comment"># Find the median.</span>median.result <span class="token operator">&lt;-</span> median<span class="token punctuation">(</span>x<span class="token punctuation">)</span>print<span class="token punctuation">(</span>median.result<span class="token punctuation">)</span><span class="token comment"># 当我们执行上面的代码，它产生以下结果：</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token number">5.6</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h1 id="众数"><a href="#众数" class="headerlink" title="众数"></a>众数</h1><p>众数是一组数据中出现次数最多的值，不同于平均值和中位数，众数可以同时包含数字和字符数据。R 没有标准的内置函数来计算众数。因此，我们将创建一个用户自定义函数来计算 R 语言中的数据集的众数。该函数将向量作为输入，并将众数值作为输出。</p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r"><span class="token comment"># Create the function.</span>getmode <span class="token operator">&lt;-</span> <span class="token keyword">function</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>   uniqv <span class="token operator">&lt;-</span> unique<span class="token punctuation">(</span>v<span class="token punctuation">)</span>   uniqv<span class="token punctuation">[</span>which.max<span class="token punctuation">(</span>tabulate<span class="token punctuation">(</span>match<span class="token punctuation">(</span>v<span class="token punctuation">,</span> uniqv<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span><span class="token comment"># Create the vector with numbers.</span>v <span class="token operator">&lt;-</span> c<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token comment"># Calculate the mode using the user function.</span>result <span class="token operator">&lt;-</span> getmode<span class="token punctuation">(</span>v<span class="token punctuation">)</span>print<span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token comment"># Create the vector with characters.</span>charv <span class="token operator">&lt;-</span> c<span class="token punctuation">(</span><span class="token string">"o"</span><span class="token punctuation">,</span> <span class="token string">"it"</span><span class="token punctuation">,</span> <span class="token string">"the"</span><span class="token punctuation">,</span> <span class="token string">"it"</span><span class="token punctuation">,</span> <span class="token string">"it"</span><span class="token punctuation">)</span><span class="token comment"># Calculate the mode using the user function.</span>result <span class="token operator">&lt;-</span> getmode<span class="token punctuation">(</span>charv<span class="token punctuation">)</span>print<span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token comment"># 当我们执行上面的代码，它产生以下结果：</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token number">2</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token string">"it"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h1 id="线性回归"><a href="#线性回归" class="headerlink" title="线性回归"></a>线性回归</h1><p>回归分析是一种非常广泛使用的统计工具，用于建立两个变量之间的关系模型。这些变量之一称为预测变量，其值通过实验收集。另一个变量称为响应变量，其值从预测变量派生。</p><p>在线性回归中，这两个变量通过方程相关，其中这两个变量的指数（幂）为 1，数学上，线性关系表示当绘制为曲线图时的直线。任何变量的指数不等于1的非线性关系将创建一条曲线。</p><p>线性回归的一般数学方程为：</p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r">y <span class="token operator">=</span> ax <span class="token operator">+</span> b<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><p>以下是所使用的参数的说明：</p><ul><li><code>y</code> 是响应变量。</li><li><code>x</code> 是预测变量。</li><li><code>a，b</code> 被称为系数常数。</li></ul><p><strong>建立回归的步骤</strong></p><p>回归的简单例子是当人的身高已知时预测人的体重。为了做到这一点，我们需要有一个人的身高和体重之间的关系。</p><p>创建关系的步骤是：</p><ol><li>进行收集高度和相应重量的观测值的样本的实验。</li><li>使用 R 语言中的 <code>lm()</code> 函数创建关系模型。</li><li>从创建的模型中找到系数，并使用这些创建数学方程</li><li>获得关系模型的摘要以了解预测中的平均误差。也称为残差。</li><li>为了预测新人的体重，使用 R 中的 <code>predict()</code> 函数。</li></ol><p><strong>输入数据</strong></p><p>下面是代表观察的样本数据：</p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r"><span class="token comment"># Values of height</span><span class="token number">151</span><span class="token punctuation">,</span> <span class="token number">174</span><span class="token punctuation">,</span> <span class="token number">138</span><span class="token punctuation">,</span> <span class="token number">186</span><span class="token punctuation">,</span> <span class="token number">128</span><span class="token punctuation">,</span> <span class="token number">136</span><span class="token punctuation">,</span> <span class="token number">179</span><span class="token punctuation">,</span> <span class="token number">163</span><span class="token punctuation">,</span> <span class="token number">152</span><span class="token punctuation">,</span> <span class="token number">131</span><span class="token comment"># Values of weight.</span><span class="token number">63</span><span class="token punctuation">,</span> <span class="token number">81</span><span class="token punctuation">,</span> <span class="token number">56</span><span class="token punctuation">,</span> <span class="token number">91</span><span class="token punctuation">,</span> <span class="token number">47</span><span class="token punctuation">,</span> <span class="token number">57</span><span class="token punctuation">,</span> <span class="token number">76</span><span class="token punctuation">,</span> <span class="token number">72</span><span class="token punctuation">,</span> <span class="token number">62</span><span class="token punctuation">,</span> <span class="token number">48</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h2 id="lm-函数"><a href="#lm-函数" class="headerlink" title="lm()函数"></a>lm()函数</h2><p>此函数创建预测变量和响应变量之间的关系模型。</p><p><strong>语法</strong></p><p>线性回归中 <code>lm()</code> 函数的基本语法是：</p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r">lm<span class="token punctuation">(</span>formula<span class="token punctuation">,</span> data<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><p>以下是所使用的参数的说明：</p><ul><li><code>formula</code> 是表示 <code>x</code> 和 <code>y</code> 之间的关系的符号。</li><li><code>data</code> 是应用公式的向量。</li></ul><p><strong>创建关系模型并获取系数</strong></p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r">x <span class="token operator">&lt;-</span> c<span class="token punctuation">(</span><span class="token number">151</span><span class="token punctuation">,</span> <span class="token number">174</span><span class="token punctuation">,</span> <span class="token number">138</span><span class="token punctuation">,</span> <span class="token number">186</span><span class="token punctuation">,</span> <span class="token number">128</span><span class="token punctuation">,</span> <span class="token number">136</span><span class="token punctuation">,</span> <span class="token number">179</span><span class="token punctuation">,</span> <span class="token number">163</span><span class="token punctuation">,</span> <span class="token number">152</span><span class="token punctuation">,</span> <span class="token number">131</span><span class="token punctuation">)</span>y <span class="token operator">&lt;-</span> c<span class="token punctuation">(</span><span class="token number">63</span><span class="token punctuation">,</span> <span class="token number">81</span><span class="token punctuation">,</span> <span class="token number">56</span><span class="token punctuation">,</span> <span class="token number">91</span><span class="token punctuation">,</span> <span class="token number">47</span><span class="token punctuation">,</span> <span class="token number">57</span><span class="token punctuation">,</span> <span class="token number">76</span><span class="token punctuation">,</span> <span class="token number">72</span><span class="token punctuation">,</span> <span class="token number">62</span><span class="token punctuation">,</span> <span class="token number">48</span><span class="token punctuation">)</span><span class="token comment"># Apply the lm() function.</span>relation <span class="token operator">&lt;-</span> lm<span class="token punctuation">(</span>y <span class="token operator">~</span> x<span class="token punctuation">)</span>print<span class="token punctuation">(</span>relation<span class="token punctuation">)</span><span class="token comment"># 当我们执行上面的代码，它产生以下结果：</span>Call<span class="token operator">:</span>lm<span class="token punctuation">(</span>formula <span class="token operator">=</span> y <span class="token operator">~</span> x<span class="token punctuation">)</span>Coefficients<span class="token operator">:</span><span class="token punctuation">(</span>Intercept<span class="token punctuation">)</span>            x   <span class="token operator">-</span><span class="token number">38.4551</span>       <span class="token number">0.6746</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p><strong>获取相关的摘要</strong></p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r">x <span class="token operator">&lt;-</span> c<span class="token punctuation">(</span><span class="token number">151</span><span class="token punctuation">,</span> <span class="token number">174</span><span class="token punctuation">,</span> <span class="token number">138</span><span class="token punctuation">,</span> <span class="token number">186</span><span class="token punctuation">,</span> <span class="token number">128</span><span class="token punctuation">,</span> <span class="token number">136</span><span class="token punctuation">,</span> <span class="token number">179</span><span class="token punctuation">,</span> <span class="token number">163</span><span class="token punctuation">,</span> <span class="token number">152</span><span class="token punctuation">,</span> <span class="token number">131</span><span class="token punctuation">)</span>y <span class="token operator">&lt;-</span> c<span class="token punctuation">(</span><span class="token number">63</span><span class="token punctuation">,</span> <span class="token number">81</span><span class="token punctuation">,</span> <span class="token number">56</span><span class="token punctuation">,</span> <span class="token number">91</span><span class="token punctuation">,</span> <span class="token number">47</span><span class="token punctuation">,</span> <span class="token number">57</span><span class="token punctuation">,</span> <span class="token number">76</span><span class="token punctuation">,</span> <span class="token number">72</span><span class="token punctuation">,</span> <span class="token number">62</span><span class="token punctuation">,</span> <span class="token number">48</span><span class="token punctuation">)</span><span class="token comment"># Apply the lm() function.</span>relation <span class="token operator">&lt;-</span> lm<span class="token punctuation">(</span>y <span class="token operator">~</span> x<span class="token punctuation">)</span>print<span class="token punctuation">(</span>summary<span class="token punctuation">(</span>relation<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment"># 当我们执行上面的代码，它产生以下结果：</span>Call<span class="token operator">:</span>lm<span class="token punctuation">(</span>formula <span class="token operator">=</span> y <span class="token operator">~</span> x<span class="token punctuation">)</span>Residuals<span class="token operator">:</span>    Min      <span class="token number">1</span>Q  Median      <span class="token number">3</span>Q     Max <span class="token operator">-</span><span class="token number">6.3002</span> <span class="token operator">-</span><span class="token number">1.6629</span>  <span class="token number">0.0412</span>  <span class="token number">1.8944</span>  <span class="token number">3.9775</span> Coefficients<span class="token operator">:</span>             Estimate Std. Error t value Pr<span class="token punctuation">(</span><span class="token operator">></span><span class="token operator">|</span>t<span class="token operator">|</span><span class="token punctuation">)</span>    <span class="token punctuation">(</span>Intercept<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token number">38.45509</span>    <span class="token number">8.04901</span>  <span class="token operator">-</span><span class="token number">4.778</span>  <span class="token number">0.00139</span> <span class="token operator">*</span><span class="token operator">*</span> x             <span class="token number">0.67461</span>    <span class="token number">0.05191</span>  <span class="token number">12.997</span> <span class="token number">1.16e-06</span> <span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>Signif. codes<span class="token operator">:</span>  <span class="token number">0</span> ‘<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span>’ <span class="token number">0.001</span> ‘<span class="token operator">*</span><span class="token operator">*</span>’ <span class="token number">0.01</span> ‘<span class="token operator">*</span>’ <span class="token number">0.05</span> ‘.’ <span class="token number">0.1</span> ‘ ’ <span class="token number">1</span>Residual standard error<span class="token operator">:</span> <span class="token number">3.253</span> on <span class="token number">8</span> degrees of freedomMultiple R<span class="token operator">-</span>squared<span class="token operator">:</span>  <span class="token number">0.9548</span><span class="token punctuation">,</span>Adjusted R<span class="token operator">-</span>squared<span class="token operator">:</span>  <span class="token number">0.9491</span> F<span class="token operator">-</span>statistic<span class="token operator">:</span> <span class="token number">168.9</span> on <span class="token number">1</span> and <span class="token number">8</span> DF<span class="token punctuation">,</span>  p<span class="token operator">-</span>value<span class="token operator">:</span> <span class="token number">1.164e-06</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h2 id="predict-函数"><a href="#predict-函数" class="headerlink" title="predict() 函数"></a>predict() 函数</h2><p><strong>语法</strong></p><p>线性回归中的 <code>predict()</code> 的基本语法是：</p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r">predict<span class="token punctuation">(</span>object<span class="token punctuation">,</span> newdata<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><p>以下是所使用的参数的说明：</p><ul><li><code>object</code> 是已使用 <code>lm()</code> 函数创建的公式。</li><li><code>newdata</code> 是包含预测变量的新值的向量。</li></ul><p><strong>预测新人的体重</strong></p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r"><span class="token comment"># The predictor vector.</span>x <span class="token operator">&lt;-</span> c<span class="token punctuation">(</span><span class="token number">151</span><span class="token punctuation">,</span> <span class="token number">174</span><span class="token punctuation">,</span> <span class="token number">138</span><span class="token punctuation">,</span> <span class="token number">186</span><span class="token punctuation">,</span> <span class="token number">128</span><span class="token punctuation">,</span> <span class="token number">136</span><span class="token punctuation">,</span> <span class="token number">179</span><span class="token punctuation">,</span> <span class="token number">163</span><span class="token punctuation">,</span> <span class="token number">152</span><span class="token punctuation">,</span> <span class="token number">131</span><span class="token punctuation">)</span><span class="token comment"># The resposne vector.</span>y <span class="token operator">&lt;-</span> c<span class="token punctuation">(</span><span class="token number">63</span><span class="token punctuation">,</span> <span class="token number">81</span><span class="token punctuation">,</span> <span class="token number">56</span><span class="token punctuation">,</span> <span class="token number">91</span><span class="token punctuation">,</span> <span class="token number">47</span><span class="token punctuation">,</span> <span class="token number">57</span><span class="token punctuation">,</span> <span class="token number">76</span><span class="token punctuation">,</span> <span class="token number">72</span><span class="token punctuation">,</span> <span class="token number">62</span><span class="token punctuation">,</span> <span class="token number">48</span><span class="token punctuation">)</span><span class="token comment"># Apply the lm() function.</span>relation <span class="token operator">&lt;-</span> lm<span class="token punctuation">(</span>y <span class="token operator">~</span> x<span class="token punctuation">)</span><span class="token comment"># Find weight of a person with height 170.</span>a <span class="token operator">&lt;-</span> data.frame<span class="token punctuation">(</span>x <span class="token operator">=</span> <span class="token number">170</span><span class="token punctuation">)</span>result <span class="token operator">&lt;-</span> predict<span class="token punctuation">(</span>relation<span class="token punctuation">,</span> a<span class="token punctuation">)</span>print<span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token comment"># 当我们执行上面的代码，它产生以下结果：</span>       <span class="token number">1</span> <span class="token number">76.22869</span> <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p><strong>以图形方式可视化回归</strong></p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r"><span class="token comment"># Create the predictor and response variable.</span>x <span class="token operator">&lt;-</span> c<span class="token punctuation">(</span><span class="token number">151</span><span class="token punctuation">,</span> <span class="token number">174</span><span class="token punctuation">,</span> <span class="token number">138</span><span class="token punctuation">,</span> <span class="token number">186</span><span class="token punctuation">,</span> <span class="token number">128</span><span class="token punctuation">,</span> <span class="token number">136</span><span class="token punctuation">,</span> <span class="token number">179</span><span class="token punctuation">,</span> <span class="token number">163</span><span class="token punctuation">,</span> <span class="token number">152</span><span class="token punctuation">,</span> <span class="token number">131</span><span class="token punctuation">)</span>y <span class="token operator">&lt;-</span> c<span class="token punctuation">(</span><span class="token number">63</span><span class="token punctuation">,</span> <span class="token number">81</span><span class="token punctuation">,</span> <span class="token number">56</span><span class="token punctuation">,</span> <span class="token number">91</span><span class="token punctuation">,</span> <span class="token number">47</span><span class="token punctuation">,</span> <span class="token number">57</span><span class="token punctuation">,</span> <span class="token number">76</span><span class="token punctuation">,</span> <span class="token number">72</span><span class="token punctuation">,</span> <span class="token number">62</span><span class="token punctuation">,</span> <span class="token number">48</span><span class="token punctuation">)</span>relation <span class="token operator">&lt;-</span> lm<span class="token punctuation">(</span>y <span class="token operator">~</span> x<span class="token punctuation">)</span><span class="token comment"># Give the chart file a name.</span>png<span class="token punctuation">(</span>file <span class="token operator">=</span> <span class="token string">"linear_regression.png"</span><span class="token punctuation">)</span><span class="token comment"># Plot the chart.</span>plot<span class="token punctuation">(</span>y<span class="token punctuation">,</span> x<span class="token punctuation">,</span> col <span class="token operator">=</span> <span class="token string">"blue"</span><span class="token punctuation">,</span> main <span class="token operator">=</span> <span class="token string">"Height &amp; Weight Regression"</span><span class="token punctuation">,</span> abline<span class="token punctuation">(</span>lm<span class="token punctuation">(</span>x <span class="token operator">~</span> y<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> cex <span class="token operator">=</span> <span class="token number">1.3</span><span class="token punctuation">,</span> pch <span class="token operator">=</span> <span class="token number">16</span><span class="token punctuation">,</span> xlab <span class="token operator">=</span> <span class="token string">"Weight in Kg"</span><span class="token punctuation">,</span> ylab <span class="token operator">=</span> <span class="token string">"Height in cm"</span><span class="token punctuation">)</span><span class="token comment"># Save the file.</span>dev.off<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p>当我们执行上面的代码，它产生以下结果：</p><p><img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="/images/post/r_statistics/linear_regression.png" alt></p><h1 id="多元回归"><a href="#多元回归" class="headerlink" title="多元回归"></a>多元回归</h1><p>多元回归是线性回归到两个以上变量之间的关系的延伸。在简单线性关系中，我们有一个预测变量和一个响应变量，但在多元回归中，我们有多个预测变量和一个响应变量。</p><p>多元回归的一般数学方程为：</p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r">y <span class="token operator">=</span> a <span class="token operator">+</span> b1x1 <span class="token operator">+</span> b2x2 <span class="token operator">+</span> <span class="token ellipsis">...</span> <span class="token operator">+</span> bnxn<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><p>以下是所使用的参数的说明：</p><ul><li><code>y</code> 是响应变量。</li><li><code>a, b1, b2, ..., bn</code> 是系数。</li><li><code>x1, x2, ..., xn</code> 是预测变量。</li></ul><p>我们使用 R 语言中的 <code>lm()</code> 函数创建回归模型。模型使用输入数据确定系数的值。接下来，我们可以使用这些系数来预测给定的一组预测变量的响应变量的值。</p><p><code>lm()</code> 函数函数创建预测变量和响应变量之间的关系模型。</p><p><strong>语法</strong></p><p><code>lm()</code> 函数在多元回归中的基本语法是：</p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r">lm<span class="token punctuation">(</span>y <span class="token operator">~</span> x1 <span class="token operator">+</span> x2 <span class="token operator">+</span> x3 <span class="token operator">+</span> <span class="token ellipsis">...</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><p>以下是所使用的参数的说明：</p><ul><li><code>y ~ x1 + x2 + x3...</code> 是表示响应变量和预测变量之间的关系的符号。</li><li><code>data</code> 是应用公式的向量。</li></ul><p><strong>实例</strong></p><p><strong>输入数据</strong></p><p>考虑在R 语言环境中可用的数据集 <code>mtcars</code> 。它给出了每加仑里程 <code>mpg</code>，气缸排量 <code>disp</code>，马力 <code>hp</code>，汽车重量 <code>wt</code> 和一些其他参数的不同汽车模型之间的比较。</p><p>模型的目标是建立 <code>mpg</code> 作为响应变量与 <code>disp</code>，<code>hp</code> 和 <code>wt</code> 作为预测变量之间的关系。为此，我们从 <code>mtcars</code> 数据集中创建这些变量的子集。</p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r">input <span class="token operator">&lt;-</span> mtcars<span class="token punctuation">[</span><span class="token punctuation">,</span> c<span class="token punctuation">(</span><span class="token string">"mpg"</span><span class="token punctuation">,</span> <span class="token string">"disp"</span><span class="token punctuation">,</span> <span class="token string">"hp"</span><span class="token punctuation">,</span> <span class="token string">"wt"</span><span class="token punctuation">)</span><span class="token punctuation">]</span>print<span class="token punctuation">(</span>head<span class="token punctuation">(</span>input<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment"># 当我们执行上面的代码，它产生以下结果：</span>                   mpg disp  hp    wtMazda RX4         <span class="token number">21.0</span>  <span class="token number">160</span> <span class="token number">110</span> <span class="token number">2.620</span>Mazda RX4 Wag     <span class="token number">21.0</span>  <span class="token number">160</span> <span class="token number">110</span> <span class="token number">2.875</span>Datsun <span class="token number">710</span>        <span class="token number">22.8</span>  <span class="token number">108</span>  <span class="token number">93</span> <span class="token number">2.320</span>Hornet <span class="token number">4</span> Drive    <span class="token number">21.4</span>  <span class="token number">258</span> <span class="token number">110</span> <span class="token number">3.215</span>Hornet Sportabout <span class="token number">18.7</span>  <span class="token number">360</span> <span class="token number">175</span> <span class="token number">3.440</span>Valiant           <span class="token number">18.1</span>  <span class="token number">225</span> <span class="token number">105</span> <span class="token number">3.460</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p><strong>创建关系模型并获取系数</strong></p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r">input <span class="token operator">&lt;-</span> mtcars<span class="token punctuation">[</span><span class="token punctuation">,</span> c<span class="token punctuation">(</span><span class="token string">"mpg"</span><span class="token punctuation">,</span> <span class="token string">"disp"</span><span class="token punctuation">,</span> <span class="token string">"hp"</span><span class="token punctuation">,</span> <span class="token string">"wt"</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token comment"># Create the relationship model.</span>model <span class="token operator">&lt;-</span> lm<span class="token punctuation">(</span>mpg <span class="token operator">~</span> disp <span class="token operator">+</span> hp <span class="token operator">+</span> wt<span class="token punctuation">,</span> data <span class="token operator">=</span> input<span class="token punctuation">)</span><span class="token comment"># Show the model.</span>print<span class="token punctuation">(</span>model<span class="token punctuation">)</span><span class="token comment"># Get the Intercept and coefficients as vector elements.</span>cat<span class="token punctuation">(</span><span class="token string">"# # # # The Coefficient Values # # # #"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span>a <span class="token operator">&lt;-</span> coef<span class="token punctuation">(</span>model<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>print<span class="token punctuation">(</span>a<span class="token punctuation">)</span>Xdisp <span class="token operator">&lt;-</span> coef<span class="token punctuation">(</span>model<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>Xhp <span class="token operator">&lt;-</span> coef<span class="token punctuation">(</span>model<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span>Xwt <span class="token operator">&lt;-</span> coef<span class="token punctuation">(</span>model<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span>print<span class="token punctuation">(</span>Xdisp<span class="token punctuation">)</span>print<span class="token punctuation">(</span>Xhp<span class="token punctuation">)</span>print<span class="token punctuation">(</span>Xwt<span class="token punctuation">)</span><span class="token comment"># 当我们执行上面的代码，它产生以下结果：</span>Call<span class="token operator">:</span>lm<span class="token punctuation">(</span>formula <span class="token operator">=</span> mpg <span class="token operator">~</span> disp <span class="token operator">+</span> hp <span class="token operator">+</span> wt<span class="token punctuation">,</span> data <span class="token operator">=</span> input<span class="token punctuation">)</span>Coefficients<span class="token operator">:</span><span class="token punctuation">(</span>Intercept<span class="token punctuation">)</span>         disp           hp           wt    <span class="token number">37.105505</span>    <span class="token operator">-</span><span class="token number">0.000937</span>    <span class="token operator">-</span><span class="token number">0.031157</span>    <span class="token operator">-</span><span class="token number">3.800891</span> <span class="token comment"># # # # The Coefficient Values # # # #</span><span class="token punctuation">(</span>Intercept<span class="token punctuation">)</span>    <span class="token number">37.10551</span>          disp <span class="token operator">-</span><span class="token number">0.0009370091</span>         hp <span class="token operator">-</span><span class="token number">0.03115655</span>        wt <span class="token operator">-</span><span class="token number">3.800891</span> <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p><strong>创建回归模型的方程</strong></p><p>基于上述截距和系数值，我们创建了数学方程。</p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r">Y <span class="token operator">=</span> a <span class="token operator">+</span> Xdisp<span class="token operator">*</span>x1 <span class="token operator">+</span> Xhp<span class="token operator">*</span>x2 <span class="token operator">+</span> Xwt<span class="token operator">*</span>x3orY <span class="token operator">=</span> <span class="token number">37.105505</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">0.000937</span><span class="token punctuation">)</span><span class="token operator">*</span>x1 <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">0.031157</span><span class="token punctuation">)</span><span class="token operator">*</span>x2 <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">3.800891</span><span class="token punctuation">)</span><span class="token operator">*</span>x3<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></p><p><strong>应用方程预测新值</strong></p><p>当提供一组新的位移，马力和重量值时，我们可以使用上面创建的回归方程来预测里程数。对于 <code>disp = 221</code>，<code>hp = 102</code> 和 <code>wt = 2.91</code> 的汽车，预测里程为：</p><p><code>Y = 37.105505 + (-0.000937)*221 + (-0.031157)*102 + (-3.800891)*2.91 = 22.65982</code></p><p><strong>使用 <code>predict()</code> 函数预测</strong></p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r">x <span class="token operator">=</span> data.frame<span class="token punctuation">(</span>disp <span class="token operator">=</span> <span class="token number">221</span><span class="token punctuation">,</span> hp <span class="token operator">=</span> <span class="token number">102</span><span class="token punctuation">,</span> wt <span class="token operator">=</span> <span class="token number">2.91</span><span class="token punctuation">)</span>result <span class="token operator">=</span> predict<span class="token punctuation">(</span>model<span class="token punctuation">,</span> x<span class="token punctuation">)</span>print<span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token comment"># 当我们执行上面的代码，它产生以下结果：</span>       <span class="token number">1</span> <span class="token number">22.65987</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h1 id="逻辑回归"><a href="#逻辑回归" class="headerlink" title="逻辑回归"></a>逻辑回归</h1><p>逻辑回归是回归模型，其中响应变量（因变量）具有诸如 <code>True/False</code> 或 <code>0/1</code> 的分类值。它实际上基于将其与预测变量相关的数学方程测量二元响应的概率作为响应变量的值。</p><p>逻辑回归的一般数学方程为：</p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r">y <span class="token operator">=</span> <span class="token number">1</span><span class="token operator">/</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">+</span> e<span class="token operator">^</span><span class="token operator">-</span><span class="token punctuation">(</span>a <span class="token operator">+</span> b1x1 <span class="token operator">+</span> b2x2 <span class="token operator">+</span> b3x3 <span class="token operator">+</span> <span class="token ellipsis">...</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><p>以下是所使用的参数的说明：</p><ul><li><code>y</code> 是响应变量。</li><li><code>x</code> 是预测变量。</li><li><code>a</code> 和 <code>b</code> 是作为数字常数的系数。</li></ul><p>用于创建回归模型的函数是 <code>glm()</code> 函数。</p><p><strong>语法</strong></p><p>逻辑回归中 <code>glm()</code> 函数的基本语法是：</p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r">glm<span class="token punctuation">(</span>formula<span class="token punctuation">,</span> data<span class="token punctuation">,</span> family<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><p>以下是所使用的参数的说明：</p><ul><li><code>formula</code> 是表示变量之间的关系的符号。</li><li><code>data</code> 是给出这些变量的值的数据集。</li><li><code>family</code> 是 R 语言对象来指定模型的细节。它的值是二项逻辑回归。</li></ul><p><strong>实例</strong></p><p>内置数据集 <code>mtcars</code> 描述具有各种发动机规格的、不同型号的汽车。在 <code>mtcars</code> 数据集中，传输模式（自动或手动）由 <code>am</code> 列描述，它是一个二进制值 <code>0</code> 或 <code>1</code>。我们可以在列 <code>am</code> 和其他 3 列（<code>hp</code>，<code>wt</code> 和 <code>cyl</code>）之间创建逻辑回归模型。</p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r"><span class="token comment"># Select some columns form mtcars.</span>input <span class="token operator">&lt;-</span> mtcars<span class="token punctuation">[</span><span class="token punctuation">,</span> c<span class="token punctuation">(</span><span class="token string">"am"</span><span class="token punctuation">,</span> <span class="token string">"cyl"</span><span class="token punctuation">,</span> <span class="token string">"hp"</span><span class="token punctuation">,</span> <span class="token string">"wt"</span><span class="token punctuation">)</span><span class="token punctuation">]</span>print<span class="token punctuation">(</span>head<span class="token punctuation">(</span>input<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment"># 当我们执行上面的代码，它产生以下结果：</span>                  am   cyl  hp    wtMazda RX4          <span class="token number">1</span>   <span class="token number">6</span>    <span class="token number">110</span>   <span class="token number">2.620</span>Mazda RX4 Wag      <span class="token number">1</span>   <span class="token number">6</span>    <span class="token number">110</span>   <span class="token number">2.875</span>Datsun <span class="token number">710</span>         <span class="token number">1</span>   <span class="token number">4</span>     <span class="token number">93</span>   <span class="token number">2.320</span>Hornet <span class="token number">4</span> Drive     <span class="token number">0</span>   <span class="token number">6</span>    <span class="token number">110</span>   <span class="token number">3.215</span>Hornet Sportabout  <span class="token number">0</span>   <span class="token number">8</span>    <span class="token number">175</span>   <span class="token number">3.440</span>Valiant            <span class="token number">0</span>   <span class="token number">6</span>    <span class="token number">105</span>   <span class="token number">3.460</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p><strong>创建回归模型</strong></p><p>我们使用 <code>glm()</code> 函数创建回归模型，并得到其摘要进行分析。</p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r">input <span class="token operator">&lt;-</span> mtcars<span class="token punctuation">[</span><span class="token punctuation">,</span> c<span class="token punctuation">(</span><span class="token string">"am"</span><span class="token punctuation">,</span> <span class="token string">"cyl"</span><span class="token punctuation">,</span> <span class="token string">"hp"</span><span class="token punctuation">,</span> <span class="token string">"wt"</span><span class="token punctuation">)</span><span class="token punctuation">]</span>am.data <span class="token operator">=</span> glm<span class="token punctuation">(</span>formula <span class="token operator">=</span> am <span class="token operator">~</span> cyl <span class="token operator">+</span> hp <span class="token operator">+</span> wt<span class="token punctuation">,</span> data <span class="token operator">=</span> input<span class="token punctuation">,</span> family <span class="token operator">=</span> binomial<span class="token punctuation">)</span>print<span class="token punctuation">(</span>summary<span class="token punctuation">(</span>am.data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment"># 当我们执行上面的代码，它产生以下结果：</span>Call<span class="token operator">:</span>glm<span class="token punctuation">(</span>formula <span class="token operator">=</span> am <span class="token operator">~</span> cyl <span class="token operator">+</span> hp <span class="token operator">+</span> wt<span class="token punctuation">,</span> family <span class="token operator">=</span> binomial<span class="token punctuation">,</span> data <span class="token operator">=</span> input<span class="token punctuation">)</span>Deviance Residuals<span class="token operator">:</span>      Min        <span class="token number">1</span>Q    Median        <span class="token number">3</span>Q       Max  <span class="token operator">-</span><span class="token number">2.17272</span>  <span class="token operator">-</span><span class="token number">0.14907</span>  <span class="token operator">-</span><span class="token number">0.01464</span>   <span class="token number">0.14116</span>   <span class="token number">1.27641</span>  Coefficients<span class="token operator">:</span>            Estimate Std. Error z value Pr<span class="token punctuation">(</span><span class="token operator">></span><span class="token operator">|</span>z<span class="token operator">|</span><span class="token punctuation">)</span>  <span class="token punctuation">(</span>Intercept<span class="token punctuation">)</span> <span class="token number">19.70288</span>    <span class="token number">8.11637</span>   <span class="token number">2.428</span>   <span class="token number">0.0152</span> <span class="token operator">*</span>cyl          <span class="token number">0.48760</span>    <span class="token number">1.07162</span>   <span class="token number">0.455</span>   <span class="token number">0.6491</span>  hp           <span class="token number">0.03259</span>    <span class="token number">0.01886</span>   <span class="token number">1.728</span>   <span class="token number">0.0840</span> .wt          <span class="token operator">-</span><span class="token number">9.14947</span>    <span class="token number">4.15332</span>  <span class="token operator">-</span><span class="token number">2.203</span>   <span class="token number">0.0276</span> <span class="token operator">*</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>Signif. codes<span class="token operator">:</span>  <span class="token number">0</span> ‘<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span>’ <span class="token number">0.001</span> ‘<span class="token operator">*</span><span class="token operator">*</span>’ <span class="token number">0.01</span> ‘<span class="token operator">*</span>’ <span class="token number">0.05</span> ‘.’ <span class="token number">0.1</span> ‘ ’ <span class="token number">1</span><span class="token punctuation">(</span>Dispersion parameter <span class="token keyword">for</span> binomial family taken to be <span class="token number">1</span><span class="token punctuation">)</span>    Null deviance<span class="token operator">:</span> <span class="token number">43.2297</span>  on <span class="token number">31</span>  degrees of freedomResidual deviance<span class="token operator">:</span>  <span class="token number">9.8415</span>  on <span class="token number">28</span>  degrees of freedomAIC<span class="token operator">:</span> <span class="token number">17.841</span>Number of Fisher Scoring iterations<span class="token operator">:</span> <span class="token number">8</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p><strong>结论</strong></p><p>在 <code>summary</code> 中，对于变量 <code>cyl</code> 和 <code>hp</code> ，最后一列中的 <code>P</code> 值大于 <code>0.05</code>，我们认为它们对变量 <code>am</code> 的值有贡献是无关紧要的。只有重量 <code>wt</code> 影响该回归模型中的 <code>am</code> 值。</p><h1 id="标准分布"><a href="#标准分布" class="headerlink" title="标准分布"></a>标准分布</h1><p>在来自独立源的数据的随机集合中，通常观察到数据的分布是正常的。这意味着，在绘制水平轴上的变量值和垂直轴上的值的计数的图形时，我们得到钟形曲线。曲线的中心表示数据集的平均值。在图中，<code>50%</code> 的值位于平均值的左侧，另外 <code>50%</code> 位于图表的右侧。这在统计学中被称为正态分布。</p><p>R 语言有四个内置函数来产生正态分布。它们描述如下：</p><p><strong>语法</strong></p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r">dnorm<span class="token punctuation">(</span>x<span class="token punctuation">,</span> mean<span class="token punctuation">,</span> sd<span class="token punctuation">)</span>pnorm<span class="token punctuation">(</span>x<span class="token punctuation">,</span> mean<span class="token punctuation">,</span> sd<span class="token punctuation">)</span>qnorm<span class="token punctuation">(</span>p<span class="token punctuation">,</span> mean<span class="token punctuation">,</span> sd<span class="token punctuation">)</span>rnorm<span class="token punctuation">(</span>n<span class="token punctuation">,</span> mean<span class="token punctuation">,</span> sd<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></p><p>以下是所使用的参数的说明：</p><ul><li><code>x</code> 是数字的向量。</li><li><code>P</code> 是概率的向量。</li><li><code>n</code> 是观察的数量（样本大小）。</li><li><code>mean</code> 是样本数据的平均值。它的默认值为 <code>0</code>。</li><li><code>sd</code> 是标准偏差。它的默认值为 <code>1</code>。</li></ul><h2 id="dnorm"><a href="#dnorm" class="headerlink" title="dnorm()"></a>dnorm()</h2><p>该函数给出给定平均值和标准偏差在每个点的概率分布的高度。</p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r"><span class="token comment"># Create a sequence of numbers between -10 and 10 incrementing by 0.1.</span>x <span class="token operator">&lt;-</span> seq<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> by <span class="token operator">=</span> <span class="token number">.1</span><span class="token punctuation">)</span><span class="token comment"># Choose the mean as 2.5 and standard deviation as 0.5.</span>y <span class="token operator">&lt;-</span> dnorm<span class="token punctuation">(</span>x<span class="token punctuation">,</span> mean <span class="token operator">=</span> <span class="token number">2.5</span><span class="token punctuation">,</span> sd <span class="token operator">=</span> <span class="token number">0.5</span><span class="token punctuation">)</span><span class="token comment"># Give the chart file a name.</span>png<span class="token punctuation">(</span>file <span class="token operator">=</span> <span class="token string">"dnorm.png"</span><span class="token punctuation">)</span>plot<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token comment"># Save the file.</span>dev.off<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p>当我们执行上面的代码，它产生以下结果：</p><p><img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="/images/post/r_statistics/dnorm.png" alt></p><h2 id="pnorm"><a href="#pnorm" class="headerlink" title="pnorm()"></a>pnorm()</h2><p>该函数给出正态分布随机数的概率小于给定数的值。它也被称为“累积分布函数”。</p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r"><span class="token comment"># Create a sequence of numbers between -10 and 10 incrementing by 0.2.</span>x <span class="token operator">&lt;-</span> seq<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> by <span class="token operator">=</span> <span class="token number">.2</span><span class="token punctuation">)</span> <span class="token comment"># Choose the mean as 2.5 and standard deviation as 2. </span>y <span class="token operator">&lt;-</span> pnorm<span class="token punctuation">(</span>x<span class="token punctuation">,</span> mean <span class="token operator">=</span> <span class="token number">2.5</span><span class="token punctuation">,</span> sd <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token comment"># Give the chart file a name.</span>png<span class="token punctuation">(</span>file <span class="token operator">=</span> <span class="token string">"pnorm.png"</span><span class="token punctuation">)</span><span class="token comment"># Plot the graph.</span>plot<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token comment"># Save the file.</span>dev.off<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p>当我们执行上面的代码，它产生以下结果：</p><p><img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="/images/post/r_statistics/pnorm.png" alt></p><h2 id="qnorm"><a href="#qnorm" class="headerlink" title="qnorm()"></a>qnorm()</h2><p>该函数采用概率值，并给出累积值与概率值匹配的数字。</p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r"><span class="token comment"># Create a sequence of probability values incrementing by 0.02.</span>x <span class="token operator">&lt;-</span> seq<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> by <span class="token operator">=</span> <span class="token number">0.02</span><span class="token punctuation">)</span><span class="token comment"># Choose the mean as 2 and standard deviation as 3.</span>y <span class="token operator">&lt;-</span> qnorm<span class="token punctuation">(</span>x<span class="token punctuation">,</span> mean <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span> sd <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token comment"># Give the chart file a name.</span>png<span class="token punctuation">(</span>file <span class="token operator">=</span> <span class="token string">"qnorm.png"</span><span class="token punctuation">)</span><span class="token comment"># Plot the graph.</span>plot<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token comment"># Save the file.</span>dev.off<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p>当我们执行上面的代码，它产生以下结果：</p><p><img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="/images/post/r_statistics/qnorm.png" alt></p><h2 id="rnorm"><a href="#rnorm" class="headerlink" title="rnorm()"></a>rnorm()</h2><p>此函数用于生成分布正常的随机数。它将样本大小作为输入，并生成许多随机数。我们绘制一个直方图来显示生成的数字的分布。</p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r"><span class="token comment"># Create a sample of 50 numbers which are normally distributed.</span>y <span class="token operator">&lt;-</span> rnorm<span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token comment"># Give the chart file a name.</span>png<span class="token punctuation">(</span>file <span class="token operator">=</span> <span class="token string">"rnorm.png"</span><span class="token punctuation">)</span><span class="token comment"># Plot the histogram for this sample.</span>hist<span class="token punctuation">(</span>y<span class="token punctuation">,</span> main <span class="token operator">=</span> <span class="token string">"Normal DIstribution"</span><span class="token punctuation">)</span><span class="token comment"># Save the file.</span>dev.off<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p>当我们执行上面的代码，它产生以下结果：</p><p><img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="/images/post/r_statistics/rnorm.png" alt></p><h1 id="二项分布"><a href="#二项分布" class="headerlink" title="二项分布"></a>二项分布</h1><p>二项分布模型处理在一系列实验中仅发现两个可能结果的事件的成功概率。例如，掷硬币总是给出正或反。在二项分布期间估计在 <code>10</code> 次重复抛掷硬币中精确找到 <code>3</code> 个正的概率。</p><p>R 语言有四个内置函数来生成二项分布。它们描述如下：</p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r">dbinom<span class="token punctuation">(</span>x<span class="token punctuation">,</span> size<span class="token punctuation">,</span> prob<span class="token punctuation">)</span>pbinom<span class="token punctuation">(</span>x<span class="token punctuation">,</span> size<span class="token punctuation">,</span> prob<span class="token punctuation">)</span>qbinom<span class="token punctuation">(</span>p<span class="token punctuation">,</span> size<span class="token punctuation">,</span> prob<span class="token punctuation">)</span>rbinom<span class="token punctuation">(</span>n<span class="token punctuation">,</span> size<span class="token punctuation">,</span> prob<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></p><p>以下是所使用的参数的说明：</p><ul><li><code>x</code> 是数字的向量。</li><li><code>P</code> 是概率向量。</li><li><code>n</code> 是观察的数量。</li><li><code>size</code> 是试验的数量。</li><li><code>prob</code> 是每个试验成功的概率。</li></ul><h2 id="dbinom"><a href="#dbinom" class="headerlink" title="dbinom()"></a>dbinom()</h2><p>该函数给出每个点的概率密度分布。</p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r"><span class="token comment"># Create a sample of 50 numbers which are incremented by 1.</span>x <span class="token operator">&lt;-</span> seq<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">,</span> by <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token comment"># Create the binomial distribution.</span>y <span class="token operator">&lt;-</span> dbinom<span class="token punctuation">(</span>x<span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">)</span><span class="token comment"># Give the chart file a name.</span>png<span class="token punctuation">(</span>file <span class="token operator">=</span> <span class="token string">"dbinom.png"</span><span class="token punctuation">)</span><span class="token comment"># Plot the graph for this sample.</span>plot<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token comment"># Save the file.</span>dev.off<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p>当我们执行上面的代码，它产生以下结果：</p><p><img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="/images/post/r_statistics/dbinom.png" alt></p><h2 id="pbinom"><a href="#pbinom" class="headerlink" title="pbinom()"></a>pbinom()</h2><p>此函数给出事件的累积概率。它是表示概率的单个值。</p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r"><span class="token comment"># Probability of getting 26 or less heads from a 51 tosses of a coin.</span>x <span class="token operator">&lt;-</span> pbinom<span class="token punctuation">(</span><span class="token number">26</span><span class="token punctuation">,</span> <span class="token number">51</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">)</span>print<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token comment"># 当我们执行上面的代码，它产生以下结果：</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token number">0.610116</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h2 id="qbinom"><a href="#qbinom" class="headerlink" title="qbinom()"></a>qbinom()</h2><p>该函数采用概率值，并给出累积值与概率值匹配的数字。</p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r"><span class="token comment"># How many heads will have a probability of 0.25 will come out when a coin is tossed 51 times.</span>x <span class="token operator">&lt;-</span> qbinom<span class="token punctuation">(</span><span class="token number">0.25</span><span class="token punctuation">,</span> <span class="token number">51</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">)</span>print<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token comment"># 当我们执行上面的代码，它产生以下结果：</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token number">23</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h2 id="rbinom"><a href="#rbinom" class="headerlink" title="rbinom()"></a>rbinom()</h2><p>该函数从给定样本产生给定概率的所需数量的随机值。</p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r"><span class="token comment"># Find 8 random values from a sample of 150 with probability of 0.4.</span>x <span class="token operator">&lt;-</span> rbinom<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">150</span><span class="token punctuation">,</span> <span class="token number">.4</span><span class="token punctuation">)</span>print<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token comment"># 当我们执行上面的代码，它产生以下结果：</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token number">63</span> <span class="token number">62</span> <span class="token number">64</span> <span class="token number">54</span> <span class="token number">54</span> <span class="token number">47</span> <span class="token number">57</span> <span class="token number">59</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h1 id="泊松回归"><a href="#泊松回归" class="headerlink" title="泊松回归"></a>泊松回归</h1><p>泊松回归（Poisson regression）是用来为计数资料和列联表建模的一种回归分析，其中响应变量是计数而不是分数的形式。</p><p>例如，在一个足球系列赛中出线或获胜的次数。此外，响应变量的值遵循泊松分布。</p><p>泊松回归的一般数学方程为：</p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r">log<span class="token punctuation">(</span>y<span class="token punctuation">)</span> <span class="token operator">=</span> a <span class="token operator">+</span> b1x1 <span class="token operator">+</span> b2x2 <span class="token operator">+</span> bnxn <span class="token ellipsis">...</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><p>以下是所使用的参数的说明：</p><ul><li><code>x</code>​ 是预测变量。</li><li><code>y</code> ​是响应变量。</li><li>​<code>a</code> ​和 ​<code>b</code> ​是数字系数。</li></ul><p>用于创建泊松回归模型的函数是​ <code>glm()​</code> 函数。</p><p><strong>语法</strong></p><p>在泊松回归中 ​<code>glm()</code>​ 函数的基本语法是：</p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r">glm<span class="token punctuation">(</span>formula<span class="token punctuation">,</span> data<span class="token punctuation">,</span> family<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><p>以下是所使用的参数的说明：</p><ul><li><code>formula</code> ​是表示变量之间的关系的符号。</li><li><code>​data​</code> 是给出这些变量的值的数据集。</li><li><code>​family​</code> 是 R 语言对象来指定模型的细节。它的值是“泊松”的逻辑回归。</li></ul><p><strong>实例</strong></p><p>我们有内置的数据集 <code>​warpbreaks</code>，其描述了羊毛类型 <code>wool</code>（​A​ 或 ​B​）和张力 <code>tension</code>（低，中或高）对每个织机的经纱断裂数量 <code>breaks</code> 的影响。让我们考虑“断裂”作为响应变量，它是断裂次数的计数。羊毛“类型”和“张力”作为预测变量。</p><p><strong>输入数据</strong></p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r">input <span class="token operator">&lt;-</span> warpbreaksprint<span class="token punctuation">(</span>head<span class="token punctuation">(</span>input<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment"># 当我们执行上面的代码，它产生以下结果：</span>  breaks wool tension<span class="token number">1</span>     <span class="token number">26</span>    A       L<span class="token number">2</span>     <span class="token number">30</span>    A       L<span class="token number">3</span>     <span class="token number">54</span>    A       L<span class="token number">4</span>     <span class="token number">25</span>    A       L<span class="token number">5</span>     <span class="token number">70</span>    A       L<span class="token number">6</span>     <span class="token number">52</span>    A       L<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p><strong>创建回归模型</strong></p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r">output <span class="token operator">&lt;-</span>glm<span class="token punctuation">(</span>formula <span class="token operator">=</span> breaks <span class="token operator">~</span> wool <span class="token operator">+</span> tension<span class="token punctuation">,</span> data <span class="token operator">=</span> warpbreaks<span class="token punctuation">,</span> family <span class="token operator">=</span> poisson<span class="token punctuation">)</span>print<span class="token punctuation">(</span>summary<span class="token punctuation">(</span>output<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment"># 当我们执行上面的代码，它产生以下结果：</span>Call<span class="token operator">:</span>glm<span class="token punctuation">(</span>formula <span class="token operator">=</span> breaks <span class="token operator">~</span> wool <span class="token operator">+</span> tension<span class="token punctuation">,</span> family <span class="token operator">=</span> poisson<span class="token punctuation">,</span> data <span class="token operator">=</span> warpbreaks<span class="token punctuation">)</span>Deviance Residuals<span class="token operator">:</span>     Min       <span class="token number">1</span>Q   Median       <span class="token number">3</span>Q      Max  <span class="token operator">-</span><span class="token number">3.6871</span>  <span class="token operator">-</span><span class="token number">1.6503</span>  <span class="token operator">-</span><span class="token number">0.4269</span>   <span class="token number">1.1902</span>   <span class="token number">4.2616</span>  Coefficients<span class="token operator">:</span>            Estimate Std. Error z value Pr<span class="token punctuation">(</span><span class="token operator">></span><span class="token operator">|</span>z<span class="token operator">|</span><span class="token punctuation">)</span>    <span class="token punctuation">(</span>Intercept<span class="token punctuation">)</span>  <span class="token number">3.69196</span>    <span class="token number">0.04541</span>  <span class="token number">81.302</span>  <span class="token operator">&lt;</span> <span class="token number">2e-16</span> <span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span>woolB       <span class="token operator">-</span><span class="token number">0.20599</span>    <span class="token number">0.05157</span>  <span class="token operator">-</span><span class="token number">3.994</span> <span class="token number">6.49e-05</span> <span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span>tensionM    <span class="token operator">-</span><span class="token number">0.32132</span>    <span class="token number">0.06027</span>  <span class="token operator">-</span><span class="token number">5.332</span> <span class="token number">9.73e-08</span> <span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span>tensionH    <span class="token operator">-</span><span class="token number">0.51849</span>    <span class="token number">0.06396</span>  <span class="token operator">-</span><span class="token number">8.107</span> <span class="token number">5.21e-16</span> <span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>Signif. codes<span class="token operator">:</span>  <span class="token number">0</span> ‘<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span>’ <span class="token number">0.001</span> ‘<span class="token operator">*</span><span class="token operator">*</span>’ <span class="token number">0.01</span> ‘<span class="token operator">*</span>’ <span class="token number">0.05</span> ‘.’ <span class="token number">0.1</span> ‘ ’ <span class="token number">1</span><span class="token punctuation">(</span>Dispersion parameter <span class="token keyword">for</span> poisson family taken to be <span class="token number">1</span><span class="token punctuation">)</span>    Null deviance<span class="token operator">:</span> <span class="token number">297.37</span>  on <span class="token number">53</span>  degrees of freedomResidual deviance<span class="token operator">:</span> <span class="token number">210.39</span>  on <span class="token number">50</span>  degrees of freedomAIC<span class="token operator">:</span> <span class="token number">493.06</span>Number of Fisher Scoring iterations<span class="token operator">:</span> <span class="token number">4</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p>在 <code>summary</code> 中，我们查找最后一列中的 <code>​p</code> ​值小于​ <code>0.05</code>​，以考虑预测变量对响应变量的影响。如图所示，具有张力类型 <code>​M</code> ​和​ <code>H</code>​ 的羊毛类型 ​<code>B</code> ​对断裂计数有影响。</p><h1 id="协方差分析"><a href="#协方差分析" class="headerlink" title="协方差分析"></a>协方差分析</h1><p>我们使用回归分析创建模型，描述变量在预测变量对响应变量的影响。有时，如果我们有一个类别变量，如 <code>Yes/No</code> 或 <code>Male/Female</code> 等。简单的回归分析为分类变量的每个值提供多个结果。在这种情况下，我们可以通过将分类变量与预测变量一起使用并比较分类变量的每个级别的回归线来研究分类变量的效果。这样的分析被称为协方差分析，也称为 ANCOVA。</p><p><strong>实例</strong></p><p>考虑在 R 语言中内置的数据集 <code>mtcars</code> 。在其中我们观察到字段 <code>am</code> 表示传输的类型（自动或手动）。它是值为 <code>0/1</code> 的分类变量。汽车的每加仑英里数 <code>mpg</code> 也可以取决于马力 <code>hp</code> 的值。</p><p>我们研究 <code>am</code> 的值对 <code>mpg</code> 和 <code>hp</code> 之间回归的影响。它是通过使用 <code>aov()</code> 函数，然后使用 <code>anova()</code> 函数来比较多个回归来完成的。</p><p><strong>输入数据</strong></p><p>从数据集 <code>mtcars</code> 创建一个包含字段 <code>mpg</code>，<code>hp</code> 和 <code>am</code> 的数据框。这里我们取 <code>mpg</code> 作为响应变量，<code>hp</code> 作为预测变量，<code>am</code> 作为分类变量。</p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r">input <span class="token operator">&lt;-</span> mtcars<span class="token punctuation">[</span><span class="token punctuation">,</span> c<span class="token punctuation">(</span><span class="token string">"am"</span><span class="token punctuation">,</span> <span class="token string">"mpg"</span><span class="token punctuation">,</span> <span class="token string">"hp"</span><span class="token punctuation">)</span><span class="token punctuation">]</span>print<span class="token punctuation">(</span>head<span class="token punctuation">(</span>input<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment"># 当我们执行上面的代码，它产生以下结果：</span>                  am  mpg  hpMazda RX4          <span class="token number">1</span> <span class="token number">21.0</span> <span class="token number">110</span>Mazda RX4 Wag      <span class="token number">1</span> <span class="token number">21.0</span> <span class="token number">110</span>Datsun <span class="token number">710</span>         <span class="token number">1</span> <span class="token number">22.8</span>  <span class="token number">93</span>Hornet <span class="token number">4</span> Drive     <span class="token number">0</span> <span class="token number">21.4</span> <span class="token number">110</span>Hornet Sportabout  <span class="token number">0</span> <span class="token number">18.7</span> <span class="token number">175</span>Valiant            <span class="token number">0</span> <span class="token number">18.1</span> <span class="token number">105</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p><strong>协方差分析</strong></p><p>我们创建一个回归模型，以 <code>hp</code> 作为预测变量，<code>mpg</code> 作为响应变量，考虑 <code>am</code> 和 <code>hp</code> 之间的相互作用。</p><p><strong>模型与分类变量和预测变量之间的相互作用</strong></p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r"><span class="token comment"># Get the dataset.</span>input <span class="token operator">&lt;-</span> mtcars<span class="token comment"># Create the regression model.</span>result <span class="token operator">&lt;-</span> aov<span class="token punctuation">(</span>mpg <span class="token operator">~</span> hp <span class="token operator">*</span> am<span class="token punctuation">,</span> data <span class="token operator">=</span> input<span class="token punctuation">)</span>print<span class="token punctuation">(</span>summary<span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment"># 当我们执行上面的代码，它产生以下结果：</span>            Df Sum Sq Mean Sq F value   Pr<span class="token punctuation">(</span><span class="token operator">></span>F<span class="token punctuation">)</span>    hp           <span class="token number">1</span>  <span class="token number">678.4</span>   <span class="token number">678.4</span>  <span class="token number">77.391</span> <span class="token number">1.50e-09</span> <span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span>am           <span class="token number">1</span>  <span class="token number">202.2</span>   <span class="token number">202.2</span>  <span class="token number">23.072</span> <span class="token number">4.75e-05</span> <span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span>hp<span class="token operator">:</span>am        <span class="token number">1</span>    <span class="token number">0.0</span>     <span class="token number">0.0</span>   <span class="token number">0.001</span>    <span class="token number">0.981</span>    Residuals   <span class="token number">28</span>  <span class="token number">245.4</span>     <span class="token number">8.8</span>                     <span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>Signif. codes<span class="token operator">:</span>  <span class="token number">0</span> ‘<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span>’ <span class="token number">0.001</span> ‘<span class="token operator">*</span><span class="token operator">*</span>’ <span class="token number">0.01</span> ‘<span class="token operator">*</span>’ <span class="token number">0.05</span> ‘.’ <span class="token number">0.1</span> ‘ ’ <span class="token number">1</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p>这个结果表明，马力 <code>hp</code> 和传输类型 <code>am</code> 对每加仑的英里 <code>mpg</code> 有显着的影响，因为两种情况下的 <code>P</code> 值都小于 <code>0.05</code>。但是这两个变量之间的相互作用不显着，因为 <code>hp:am</code> 的 <code>P</code> 值大于 <code>0.05</code>。</p><p><strong>没有分类变量和预测变量之间相互作用的模型</strong></p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r"><span class="token comment"># Get the dataset.</span>input <span class="token operator">&lt;-</span> mtcars<span class="token comment"># Create the regression model.</span>result <span class="token operator">&lt;-</span> aov<span class="token punctuation">(</span>mpg <span class="token operator">~</span> hp <span class="token operator">+</span> am<span class="token punctuation">,</span> data <span class="token operator">=</span> input<span class="token punctuation">)</span>print<span class="token punctuation">(</span>summary<span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment"># 当我们执行上面的代码，它产生以下结果：</span>            Df Sum Sq Mean Sq F value   Pr<span class="token punctuation">(</span><span class="token operator">></span>F<span class="token punctuation">)</span>    hp           <span class="token number">1</span>  <span class="token number">678.4</span>   <span class="token number">678.4</span>   <span class="token number">80.15</span> <span class="token number">7.63e-10</span> <span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span>am           <span class="token number">1</span>  <span class="token number">202.2</span>   <span class="token number">202.2</span>   <span class="token number">23.89</span> <span class="token number">3.46e-05</span> <span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span>Residuals   <span class="token number">29</span>  <span class="token number">245.4</span>     <span class="token number">8.5</span>                     <span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>Signif. codes<span class="token operator">:</span>  <span class="token number">0</span> ‘<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span>’ <span class="token number">0.001</span> ‘<span class="token operator">*</span><span class="token operator">*</span>’ <span class="token number">0.01</span> ‘<span class="token operator">*</span>’ <span class="token number">0.05</span> ‘.’ <span class="token number">0.1</span> ‘ ’ <span class="token number">1</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p>这个结果表明，马力 <code>hp</code> 和传输类型 <code>am</code> 对每加仑的英里 <code>mpg</code> 有显着的影响，因为两种情况下的 <code>P</code> 值都小于 <code>0.05</code>。</p><p><strong>比较两个模型</strong></p><p>现在我们可以比较两个模型来得出结论，变量的相互作用是否真正重要。为此，我们使用 <code>anova()</code> 函数。</p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r"><span class="token comment"># Get the dataset.</span>input <span class="token operator">&lt;-</span> mtcars<span class="token comment"># Create the regression models.</span>result1 <span class="token operator">&lt;-</span> aov<span class="token punctuation">(</span>mpg <span class="token operator">~</span> hp <span class="token operator">*</span> am<span class="token punctuation">,</span> data <span class="token operator">=</span> input<span class="token punctuation">)</span>result2 <span class="token operator">&lt;-</span> aov<span class="token punctuation">(</span>mpg <span class="token operator">~</span> hp <span class="token operator">+</span> am<span class="token punctuation">,</span> data <span class="token operator">=</span> input<span class="token punctuation">)</span><span class="token comment"># Compare the two models.</span>print<span class="token punctuation">(</span>anova<span class="token punctuation">(</span>result1<span class="token punctuation">,</span> result2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment"># 当我们执行上面的代码，它产生以下结果：</span>Analysis of Variance TableModel <span class="token number">1</span><span class="token operator">:</span> mpg <span class="token operator">~</span> hp <span class="token operator">*</span> amModel <span class="token number">2</span><span class="token operator">:</span> mpg <span class="token operator">~</span> hp <span class="token operator">+</span> am  Res.Df    RSS Df  Sum of Sq     F Pr<span class="token punctuation">(</span><span class="token operator">></span>F<span class="token punctuation">)</span><span class="token number">1</span>     <span class="token number">28</span> <span class="token number">245.43</span>                           <span class="token number">2</span>     <span class="token number">29</span> <span class="token number">245.44</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">-</span><span class="token number">0.0052515</span> <span class="token number">6e-04</span> <span class="token number">0.9806</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p>由于 <code>P</code> 值大于 <code>0.05</code>，我们得出结论，马力 <code>hp</code> 和传播类型 <code>am</code> 之间的相互作用不显着。因此，在汽车和手动变速器模式下，每加仑的里程将以类似的方式取决于汽车的马力。</p><h1 id="时间序列分析"><a href="#时间序列分析" class="headerlink" title="时间序列分析"></a>时间序列分析</h1><p>时间序列是将统一统计值按照时间发生的先后顺序来进行排列，时间序列分析的主要目的是根据已有数据对未来进行预测。</p><p>一个稳定的时间序列中常常包含两个部分，那么就是：有规律的时间序列 + 噪声。所以，在以下的方法中，主要的目的就是去过滤噪声值，让我们的时间序列更加的有分析意义。</p><p><strong>语法</strong></p><p>时间序列分析中 <code>ts()</code> 函数的基本语法是：</p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r">timeseries.object.name <span class="token operator">&lt;-</span> ts<span class="token punctuation">(</span>data<span class="token punctuation">,</span> start<span class="token punctuation">,</span> end<span class="token punctuation">,</span> frequency<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><p>以下是所使用的参数的说明：</p><ul><li><code>data</code> 是包含在时间序列中使用的值的向量或矩阵。</li><li><code>start</code> 以时间序列指定第一次观察的开始时间。</li><li><code>end</code> 指定时间序列中最后一次观测的结束时间。</li><li><code>frequency</code> 指定每单位时间的观测数。</li></ul><p>除了参数 <code>data</code>，所有其他参数是可选的。</p><p><strong>时间序列的预处理</strong></p><ol><li><p>平稳性检验</p><p> 拿到一个时间序列之后，我们首先要对其稳定性进行判断，只有非白噪声的稳定性时间序列才有分析的意义以及预测未来数据的价值。</p><p> 所谓平稳，是指统计值在一个常数上下波动并且波动范围是有界限的。如果有明显的趋势或者周期性，那么就是不稳定的。一般判断有三种方法：</p><ul><li>画出时间序列的趋势图，看趋势判断</li><li>画自相关图和偏相关图，平稳时间序列的自相关图和偏相关图，要么拖尾，要么截尾。</li><li><p>检验序列中是否存在单位根，如果存在单位根，就是非平稳时间序列。</p><p>在 R 语言中，<code>DF</code> 检测是一种检测稳定性的方法，如果得出的 <code>P</code> 值小于临界值，则认为是数列是稳定的。</p></li></ul></li><li><p>白噪声检验</p><p> 白噪声序列，又称为纯随机性序列，序列的各个值之间没有任何的相关关系，序列在进行无序的随机波动，可以终止对该序列的分析，因为从白噪声序列中是提取不到任何有价值的信息的。</p></li><li><p>平稳时间序列的参数特点</p><p> 均值和方差为常数，并且具有与时间无关的自协方差。</p></li></ol><p><strong>时间序列建模步骤</strong></p><ol><li><p>拿到被分析的时间序列数据集。</p></li><li><p>对数据绘图，观测其平稳性。若为非平稳时间序列要先进行 <code>d</code> 阶差分运算后化为平稳时间序列，此处的 <code>d</code> 即为 <code>ARIMA(p,d,q)</code> 模型中的 <code>d</code>；若为平稳序列，则用 <code>ARMA(p,q)</code> 模型。所以 <code>ARIMA(p,d,q)</code> 模型区别于 <code>ARMA(p,q)</code> 之处就在于前者的自回归部分的特征多项式含有 <code>d</code> 个单位根。</p></li><li><p>对得到的平稳时间序列分别求得其自相关系数 <code>ACF</code> 和偏自相关系数 <code>PACF</code>，通过对自相关图和偏自相关图的分析，得到最佳的阶层 <code>p</code> 和阶数 <code>q</code>。由以上得到的 <code>d</code>、<code>q</code>、<code>p</code>，得到 <code>ARIMA</code> 模型。</p></li><li><p>模型诊断。进行诊断分析，以证实所得模型确实与所观察到的数据特征相符。若不相符，重新回到第 3 步。</p></li></ol><p><strong>实例</strong></p><p>考虑从 2012 年 1 月开始的一个地方的年降雨量细节。我们创建一个 R 时间序列对象为期 12 个月并绘制它。</p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r"><span class="token comment"># Get the data points in form of a R vector.</span>rainfall <span class="token operator">&lt;-</span> c<span class="token punctuation">(</span><span class="token number">799</span><span class="token punctuation">,</span> <span class="token number">1174.8</span><span class="token punctuation">,</span> <span class="token number">865.1</span><span class="token punctuation">,</span> <span class="token number">1334.6</span><span class="token punctuation">,</span> <span class="token number">635.4</span><span class="token punctuation">,</span> <span class="token number">918.5</span><span class="token punctuation">,</span> <span class="token number">685.5</span><span class="token punctuation">,</span> <span class="token number">998.6</span><span class="token punctuation">,</span> <span class="token number">784.2</span><span class="token punctuation">,</span> <span class="token number">985</span><span class="token punctuation">,</span> <span class="token number">882.8</span><span class="token punctuation">,</span> <span class="token number">1071</span><span class="token punctuation">)</span><span class="token comment"># Convert it to a time series object.</span>rainfall.timeseries <span class="token operator">&lt;-</span> ts<span class="token punctuation">(</span>rainfall<span class="token punctuation">,</span> start <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token number">2012</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> frequency <span class="token operator">=</span> <span class="token number">12</span><span class="token punctuation">)</span><span class="token comment"># Print the timeseries data.</span>print<span class="token punctuation">(</span>rainfall.timeseries<span class="token punctuation">)</span><span class="token comment"># Give the chart file a name.</span>png<span class="token punctuation">(</span>file <span class="token operator">=</span> <span class="token string">"rainfall.png"</span><span class="token punctuation">)</span><span class="token comment"># Plot a graph of the time series.</span>plot<span class="token punctuation">(</span>rainfall.timeseries<span class="token punctuation">)</span><span class="token comment"># Save the file.</span>dev.off<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment"># 当我们执行上面的代码，它产生以下结果及图表：</span>        Jan    Feb    Mar    Apr    May    Jun    Jul    Aug    Sep    Oct    Nov    Dec<span class="token number">2012</span>  <span class="token number">799.0</span> <span class="token number">1174.8</span>  <span class="token number">865.1</span> <span class="token number">1334.6</span>  <span class="token number">635.4</span>  <span class="token number">918.5</span>  <span class="token number">685.5</span>  <span class="token number">998.6</span>  <span class="token number">784.2</span>  <span class="token number">985.0</span>  <span class="token number">882.8</span> <span class="token number">1071.0</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p><img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="/images/post/r_statistics/rainfall.png" alt></p><p><strong>不同的时间间隔</strong></p><p><code>ts()</code> 函数中的频率参数值决定了测量数据点的时间间隔。值为 12 表示时间序列为 12 个月。其他值及其含义如下：</p><ul><li><code>frequency = 12</code>：指定一年中每个月的数据点。</li><li><code>frequency = 4</code>：每年的每个季度的数据点。</li><li><code>frequency = 6</code>：每小时的 10 分钟的数据点。</li><li><code>frequency = 24 * 6</code>：将一天的每 10 分钟的数据点固定。</li></ul><p><strong>多时间序列</strong></p><p>我们可以通过将两个系列组合成一个矩阵，在一个图表中绘制多个时间序列。</p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r"><span class="token comment"># Get the data points in form of a R vector.</span>rainfall1 <span class="token operator">&lt;-</span> c<span class="token punctuation">(</span><span class="token number">799</span><span class="token punctuation">,</span> <span class="token number">1174.8</span><span class="token punctuation">,</span> <span class="token number">865.1</span><span class="token punctuation">,</span> <span class="token number">1334.6</span><span class="token punctuation">,</span> <span class="token number">635.4</span><span class="token punctuation">,</span> <span class="token number">918.5</span><span class="token punctuation">,</span> <span class="token number">685.5</span><span class="token punctuation">,</span> <span class="token number">998.6</span><span class="token punctuation">,</span> <span class="token number">784.2</span><span class="token punctuation">,</span> <span class="token number">985</span><span class="token punctuation">,</span> <span class="token number">882.8</span><span class="token punctuation">,</span> <span class="token number">1071</span><span class="token punctuation">)</span>rainfall2 <span class="token operator">&lt;-</span> c<span class="token punctuation">(</span><span class="token number">655</span><span class="token punctuation">,</span> <span class="token number">1306.9</span><span class="token punctuation">,</span> <span class="token number">1323.4</span><span class="token punctuation">,</span> <span class="token number">1172.2</span><span class="token punctuation">,</span> <span class="token number">562.2</span><span class="token punctuation">,</span> <span class="token number">824</span><span class="token punctuation">,</span> <span class="token number">822.4</span><span class="token punctuation">,</span> <span class="token number">1265.5</span><span class="token punctuation">,</span> <span class="token number">799.6</span><span class="token punctuation">,</span> <span class="token number">1105.6</span><span class="token punctuation">,</span> <span class="token number">1106.7</span><span class="token punctuation">,</span> <span class="token number">1337.8</span><span class="token punctuation">)</span><span class="token comment"># Convert them to a matrix.</span>combined.rainfall <span class="token operator">&lt;-</span> matrix<span class="token punctuation">(</span>c<span class="token punctuation">(</span>rainfall1<span class="token punctuation">,</span> rainfall2<span class="token punctuation">)</span><span class="token punctuation">,</span> nrow <span class="token operator">=</span> <span class="token number">12</span><span class="token punctuation">)</span><span class="token comment"># Convert it to a time series object.</span>rainfall.timeseries <span class="token operator">&lt;-</span> ts<span class="token punctuation">(</span>combined.rainfall<span class="token punctuation">,</span> start <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token number">2012</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> frequency <span class="token operator">=</span> <span class="token number">12</span><span class="token punctuation">)</span><span class="token comment"># Print the timeseries data.</span>print<span class="token punctuation">(</span>rainfall.timeseries<span class="token punctuation">)</span><span class="token comment"># Give the chart file a name.</span>png<span class="token punctuation">(</span>file <span class="token operator">=</span> <span class="token string">"rainfall_combined.png"</span><span class="token punctuation">)</span><span class="token comment"># Plot a graph of the time series.</span>plot<span class="token punctuation">(</span>rainfall.timeseries<span class="token punctuation">,</span> main <span class="token operator">=</span> <span class="token string">"Multiple Time Series"</span><span class="token punctuation">)</span><span class="token comment"># Save the file.</span>dev.off<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment"># 当我们执行上面的代码，它产生以下结果及图表：</span>         Series <span class="token number">1</span> Series <span class="token number">2</span>Jan <span class="token number">2012</span>    <span class="token number">799.0</span>    <span class="token number">655.0</span>Feb <span class="token number">2012</span>   <span class="token number">1174.8</span>   <span class="token number">1306.9</span>Mar <span class="token number">2012</span>    <span class="token number">865.1</span>   <span class="token number">1323.4</span>Apr <span class="token number">2012</span>   <span class="token number">1334.6</span>   <span class="token number">1172.2</span>May <span class="token number">2012</span>    <span class="token number">635.4</span>    <span class="token number">562.2</span>Jun <span class="token number">2012</span>    <span class="token number">918.5</span>    <span class="token number">824.0</span>Jul <span class="token number">2012</span>    <span class="token number">685.5</span>    <span class="token number">822.4</span>Aug <span class="token number">2012</span>    <span class="token number">998.6</span>   <span class="token number">1265.5</span>Sep <span class="token number">2012</span>    <span class="token number">784.2</span>    <span class="token number">799.6</span>Oct <span class="token number">2012</span>    <span class="token number">985.0</span>   <span class="token number">1105.6</span>Nov <span class="token number">2012</span>    <span class="token number">882.8</span>   <span class="token number">1106.7</span>Dec <span class="token number">2012</span>   <span class="token number">1071.0</span>   <span class="token number">1337.8</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p><img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="/images/post/r_statistics/rainfall_combined.png" alt></p><h1 id="非线性最小二乘"><a href="#非线性最小二乘" class="headerlink" title="非线性最小二乘"></a>非线性最小二乘</h1><p>当模拟真实世界数据用于回归分析时，我们观察到，很少情况下，模型的方程是给出线性图的线性方程。大多数时候，真实世界数据模型的方程涉及更高程度的数学函数，如 <code>3</code> 的指数或 <code>sin</code> 函数。在这种情况下，模型的图给出了曲线而不是线。线性和非线性回归的目的是调整模型参数的值，以找到最接近您的数据的线或曲线。在找到这些值时，我们将能够以良好的精确度估计响应变量。</p><p>在最小二乘回归中，我们建立了一个回归模型，其中来自回归曲线的不同点的垂直距离的平方和被最小化。我们通常从定义的模型开始，并假设系数的一些值。然后我们应用 R 语言的 <code>nls()</code> 函数获得更准确的值以及置信区间。</p><p><strong>语法</strong></p><p>在 R 语言中创建非线性最小二乘测试的基本语法是：</p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r">nls<span class="token punctuation">(</span>formula<span class="token punctuation">,</span> data<span class="token punctuation">,</span> start<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><p>以下是所使用的参数的说明：</p><ul><li><code>formula</code> 是包括变量和参数的非线性模型公式。</li><li><code>data</code> 是用于计算公式中变量的数据框。</li><li><code>start</code> 是起始估计的命名列表或命名数字向量。</li></ul><p><strong>实例</strong></p><p>我们将考虑一个假设其系数的初始值的非线性模型。接下来，我们将看到这些假设值的置信区间是什么，以便我们可以判断这些值在模型中有多好。</p><p>所以让我们考虑以下的方程 <code>a = b1*x^2 + b2</code>。</p><p>让我们假设初始系数为 <code>b1 = 1</code> 和 <code>b2 = 3</code>，并将这些值拟合到 <code>nls()</code> 函数中。</p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r">x <span class="token operator">&lt;-</span> c<span class="token punctuation">(</span><span class="token number">1.6</span><span class="token punctuation">,</span> <span class="token number">2.1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2.23</span><span class="token punctuation">,</span> <span class="token number">3.71</span><span class="token punctuation">,</span> <span class="token number">3.25</span><span class="token punctuation">,</span> <span class="token number">3.4</span><span class="token punctuation">,</span> <span class="token number">3.86</span><span class="token punctuation">,</span> <span class="token number">1.19</span><span class="token punctuation">,</span> <span class="token number">2.21</span><span class="token punctuation">)</span>y <span class="token operator">&lt;-</span> c<span class="token punctuation">(</span><span class="token number">5.19</span><span class="token punctuation">,</span> <span class="token number">7.43</span><span class="token punctuation">,</span> <span class="token number">6.94</span><span class="token punctuation">,</span> <span class="token number">8.11</span><span class="token punctuation">,</span> <span class="token number">18.75</span><span class="token punctuation">,</span> <span class="token number">14.88</span><span class="token punctuation">,</span> <span class="token number">16.06</span><span class="token punctuation">,</span> <span class="token number">19.12</span><span class="token punctuation">,</span> <span class="token number">3.21</span><span class="token punctuation">,</span> <span class="token number">7.58</span><span class="token punctuation">)</span><span class="token comment"># Give the chart file a name.</span>png<span class="token punctuation">(</span>file <span class="token operator">=</span> <span class="token string">"nls.png"</span><span class="token punctuation">)</span><span class="token comment"># Plot these values.</span>plot<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token comment"># Take the assumed values and fit into the model.</span>model <span class="token operator">&lt;-</span> nls<span class="token punctuation">(</span>y <span class="token operator">~</span> b1<span class="token operator">*</span>x<span class="token operator">^</span><span class="token number">2</span> <span class="token operator">+</span> b2<span class="token punctuation">,</span> start <span class="token operator">=</span> list<span class="token punctuation">(</span>b1 <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> b2 <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment"># Plot the chart with new data by fitting it to a prediction from 100 data points.</span>new.data <span class="token operator">&lt;-</span> data.frame<span class="token punctuation">(</span>x <span class="token operator">=</span> seq<span class="token punctuation">(</span>min<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span> max<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span> len <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span>lines<span class="token punctuation">(</span>new.data<span class="token operator">$</span>x<span class="token punctuation">,</span> predict<span class="token punctuation">(</span>model<span class="token punctuation">,</span> newdata <span class="token operator">=</span> new.data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment"># Save the file.</span>dev.off<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment"># Get the sum of the squared residuals.</span>print<span class="token punctuation">(</span>sum<span class="token punctuation">(</span>resid<span class="token punctuation">(</span>model<span class="token punctuation">)</span><span class="token operator">^</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment"># Get the confidence intervals on the chosen values of the coefficients.</span>print<span class="token punctuation">(</span>confint<span class="token punctuation">(</span>model<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment"># 当我们执行上面的代码，它产生以下结果及图表：</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token number">1.081935</span>Waiting <span class="token keyword">for</span> profiling to be done<span class="token ellipsis">...</span>       <span class="token number">2.5</span>%    <span class="token number">97.5</span>%b1 <span class="token number">1.137708</span> <span class="token number">1.253135</span>b2 <span class="token number">1.497364</span> <span class="token number">2.496484</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p><img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="/images/post/r_statistics/nls.png" alt></p><p>我们可以得出结论，<code>b1</code> 的值更接近 <code>1</code>，而 <code>b2</code> 的值更接近 <code>2</code> 而不是 <code>3</code>。</p><h1 id="决策树"><a href="#决策树" class="headerlink" title="决策树"></a>决策树</h1><p>决策树是以树的形式表示选择及其结果的图。图中的节点表示事件或选择，并且图的边缘表示决策规则或条件。它主要用于使用R的机器学习和数据挖掘应用程序。</p><p>决策树的使用的例子是：预测电子邮件是垃圾邮件或非垃圾邮件，预测肿瘤癌变，或者基于这些因素预测贷款的信用风险。通常，使用观测数据（也称为训练数据）来创建模型。然后使用一组验证数据来验证和改进模型。R 具有用于创建和可视化决策树的包。对于新的预测变量集合，我们使用此模型来确定 R 包 <code>party</code> 用于创建决策树。</p><p><strong>安装 R 语言包</strong></p><p>在 R 语言控制台中使用以下命令安装软件包。您还必须安装相关软件包（如果有）。</p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r">install.packages<span class="token punctuation">(</span><span class="token string">"party"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><p><code>party</code> 包具有用于创建和分析决策树的函数 <code>ctree()</code>。</p><p><strong>语法</strong></p><p>在 R 中创建决策树的基本语法是：</p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r">ctree<span class="token punctuation">(</span>formula<span class="token punctuation">,</span> data<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><p>以下是所使用的参数的说明：</p><ul><li><code>formula</code> 是描述预测变量和响应变量的公式。</li><li><code>data</code> 是所使用的数据集的名称。</li></ul><p><strong>输入数据</strong></p><p>我们将使用名为 <code>readingSkills</code> 的 R 内置数据集来创建决策树。它描述了某人的 <code>readingSkills</code> 的分数，如果我们知道变量 <code>年龄</code>， <code>shoesize</code>，<code>分数</code>，以及<code>该人是否为母语者</code>。</p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r"><span class="token comment"># Load the party package. It will automatically load other dependent packages.</span>library<span class="token punctuation">(</span>party<span class="token punctuation">)</span><span class="token comment"># Print some records from data set readingSkills.</span>print<span class="token punctuation">(</span>head<span class="token punctuation">(</span>readingSkills<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment"># 当我们执行上面的代码，它产生以下结果：</span>  nativeSpeaker age shoeSize    score<span class="token number">1</span>           yes   <span class="token number">5</span> <span class="token number">24.83189</span> <span class="token number">32.29385</span><span class="token number">2</span>           yes   <span class="token number">6</span> <span class="token number">25.95238</span> <span class="token number">36.63105</span><span class="token number">3</span>            no  <span class="token number">11</span> <span class="token number">30.42170</span> <span class="token number">49.60593</span><span class="token number">4</span>           yes   <span class="token number">7</span> <span class="token number">28.66450</span> <span class="token number">40.28456</span><span class="token number">5</span>           yes  <span class="token number">11</span> <span class="token number">31.88207</span> <span class="token number">55.46085</span><span class="token number">6</span>           yes  <span class="token number">10</span> <span class="token number">30.07843</span> <span class="token number">52.83124</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p><strong>实例</strong></p><p>我们将使用 <code>ctree()</code> 函数创建决策树并查看其图形。</p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r"><span class="token comment"># Load the party package. It will automatically load other dependent packages.</span>library<span class="token punctuation">(</span>party<span class="token punctuation">)</span><span class="token comment"># Create the input data frame.</span>input.dat <span class="token operator">&lt;-</span> readingSkills<span class="token punctuation">[</span>c<span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">105</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">]</span><span class="token comment"># Give the chart file a name.</span>png<span class="token punctuation">(</span>file <span class="token operator">=</span> <span class="token string">"decision_tree.png"</span><span class="token punctuation">)</span><span class="token comment"># Create the tree.</span>output.tree <span class="token operator">&lt;-</span> ctree<span class="token punctuation">(</span>nativeSpeaker <span class="token operator">~</span> age <span class="token operator">+</span> shoeSize <span class="token operator">+</span> score<span class="token punctuation">,</span> data <span class="token operator">=</span> input.dat<span class="token punctuation">)</span><span class="token comment"># Plot the tree.</span>plot<span class="token punctuation">(</span>output.tree<span class="token punctuation">)</span><span class="token comment"># Save the file.</span>dev.off<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p>当我们执行上面的代码，它产生以下图表：</p><p><img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="/images/post/r_statistics/decision_tree.png" alt></p><p><strong>结论</strong></p><p>从上面显示的决策树，我们可以得出结论，其 <code>readingSkills</code> 分数低于 <code>38.3</code> 和年龄超过 <code>6</code> 的人不是一个母语者。</p><h1 id="随机森林"><a href="#随机森林" class="headerlink" title="随机森林"></a>随机森林</h1><p>在随机森林方法中，创建大量的决策树。每个观察被馈入每个决策树。每个观察的最常见的结果被用作最终输出。新的观察结果被馈入所有的树并且对每个分类模型取多数投票。</p><p>对构建树时未使用的情况进行错误估计。这称为 <code>OOB（袋外）</code> 误差估计，其被提及为百分比。</p><p>R 语言包 <code>randomForest</code> 用于创建随机森林。</p><p><strong>安装 R 包</strong></p><p>在 R 语言控制台中使用以下命令安装软件包。您还必须安装相关软件包（如果有）。</p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r">install.packages<span class="token punctuation">(</span><span class="token string">"randomForest"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><p>包 <code>randomForest</code> 具有函数 <code>randomForest()</code>，用于创建和分析随机森林。</p><p><strong>语法</strong></p><p>在 R 语言中创建随机森林的基本语法是：</p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r">randomForest<span class="token punctuation">(</span>formula<span class="token punctuation">,</span> data<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><p>以下是所使用的参数的说明：</p><ul><li><code>formula</code> 是描述预测变量和响应变量的公式。</li><li><code>data</code> 是所使用的数据集的名称。</li></ul><p><strong>输入数据</strong></p><p>我们将使用名为 <code>readingSkills</code> 的 R 语言内置数据集来创建决策树。它描述了某人的 <code>readingSkills</code> 的分数，如果我们知道变量 <code>age</code>，<code>shoesize</code>，<code>score</code>，以及<code>该人是否是母语者</code>。</p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r"><span class="token comment"># Load the party package. It will automatically load other required packages.</span>library<span class="token punctuation">(</span>party<span class="token punctuation">)</span><span class="token comment"># Print some records from data set readingSkills.</span>print<span class="token punctuation">(</span>head<span class="token punctuation">(</span>readingSkills<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment"># 当我们执行上面的代码，它产生以下结果：</span>  nativeSpeaker age shoeSize    score<span class="token number">1</span>           yes   <span class="token number">5</span> <span class="token number">24.83189</span> <span class="token number">32.29385</span><span class="token number">2</span>           yes   <span class="token number">6</span> <span class="token number">25.95238</span> <span class="token number">36.63105</span><span class="token number">3</span>            no  <span class="token number">11</span> <span class="token number">30.42170</span> <span class="token number">49.60593</span><span class="token number">4</span>           yes   <span class="token number">7</span> <span class="token number">28.66450</span> <span class="token number">40.28456</span><span class="token number">5</span>           yes  <span class="token number">11</span> <span class="token number">31.88207</span> <span class="token number">55.46085</span><span class="token number">6</span>           yes  <span class="token number">10</span> <span class="token number">30.07843</span> <span class="token number">52.83124</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p><strong>实例</strong></p><p>我们将使用 <code>randomForest()</code> 函数来创建决策树并查看它的图。</p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r"><span class="token comment"># Load the party package. It will automatically load other required packages.</span>library<span class="token punctuation">(</span>party<span class="token punctuation">)</span>library<span class="token punctuation">(</span>randomForest<span class="token punctuation">)</span><span class="token comment"># Create the forest.</span>output.forest <span class="token operator">&lt;-</span> randomForest<span class="token punctuation">(</span>nativeSpeaker <span class="token operator">~</span> age <span class="token operator">+</span> shoeSize <span class="token operator">+</span> score<span class="token punctuation">,</span> data <span class="token operator">=</span> readingSkills<span class="token punctuation">)</span><span class="token comment"># View the forest results.</span>print<span class="token punctuation">(</span>output.forest<span class="token punctuation">)</span><span class="token comment"># Importance of each predictor.</span>print<span class="token punctuation">(</span>importance<span class="token punctuation">(</span>fit<span class="token punctuation">,</span> type <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment"># 当我们执行上面的代码，它产生以下结果：</span>Call<span class="token operator">:</span> randomForest<span class="token punctuation">(</span>formula <span class="token operator">=</span> nativeSpeaker <span class="token operator">~</span> age <span class="token operator">+</span> shoeSize <span class="token operator">+</span> score<span class="token punctuation">,</span> data <span class="token operator">=</span> readingSkills<span class="token punctuation">)</span>                Type of random forest<span class="token operator">:</span> classification                     Number of trees<span class="token operator">:</span> <span class="token number">500</span>No. of variables tried at each split<span class="token operator">:</span> <span class="token number">1</span>        OOB estimate of  error rate<span class="token operator">:</span> <span class="token number">1.5</span>%Confusion matrix<span class="token operator">:</span>    no yes class.errorno  <span class="token number">99</span>   <span class="token number">1</span>        <span class="token number">0.01</span>yes  <span class="token number">2</span>  <span class="token number">98</span>        <span class="token number">0.02</span>         MeanDecreaseGiniage              <span class="token number">13.95406</span>shoeSize         <span class="token number">18.91006</span>score            <span class="token number">56.73051</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p>结论从上面显示的随机森林，我们可以得出结论，鞋码 <code>shoeSize</code> 和成绩 <code>score</code> 是决定如果某人是母语者或不是母语的重要因素。此外，该模型只有 <code>1%</code> 的误差，这意味着我们可以预测精度为 <code>99%</code>。</p><h1 id="生存分析"><a href="#生存分析" class="headerlink" title="生存分析"></a>生存分析</h1><p>生存分析处理预测特定事件将要发生的时间。它也被称为故障时间分析或分析死亡时间。例如，预测患有癌症的人将存活的天数或预测机械系统将失败的时间。</p><p>命名为 <code>survival</code> 的 R 语言包用于进行生存分析。此包包含函数 <code>Surv()</code>，它将输入数据作为 R 语言公式，并在选择的变量中创建一个生存对象用于分析。然后我们使用函数 <code>survfit()</code> 创建一个分析图。</p><p><strong>安装软件包</strong></p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r">install.packages<span class="token punctuation">(</span><span class="token string">"survival"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><p><strong>语法</strong></p><p>在 R 语言中创建生存分析的基本语法是：</p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r">Surv<span class="token punctuation">(</span>time<span class="token punctuation">,</span> event<span class="token punctuation">)</span>survfit<span class="token punctuation">(</span>formula<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></p><p>以下是所使用的参数的说明：</p><ul><li><code>time</code> 是直到事件发生的跟踪时间。</li><li><code>event</code> 指示预期事件的发生的状态。</li><li><code>formula</code> 是预测变量之间的关系。</li></ul><p><strong>实例</strong></p><p>我们将考虑在上面安装的 <code>survival</code> 包中存在的名为 <code>pbc</code> 的数据集。它描述了关于受肝原发性胆汁性肝硬化 <code>PBC</code> 影响的人的生存数据点。在数据集中存在的许多列中，我们主要关注字段 <code>time</code> 和 <code>status</code>。时间表示在接受肝移植或患者死亡的患者的登记和事件的较早之间的天数。</p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r"><span class="token comment"># Load the library.</span>library<span class="token punctuation">(</span><span class="token string">"survival"</span><span class="token punctuation">)</span><span class="token comment"># Print first few rows.</span>print<span class="token punctuation">(</span>head<span class="token punctuation">(</span>pbc<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment"># 当我们执行上面的代码，它产生以下结果：</span>  id time status trt      age sex ascites hepato spiders edema bili chol albumin copper alk.phos    ast trig platelet protime stage<span class="token number">1</span>  <span class="token number">1</span>  <span class="token number">400</span>      <span class="token number">2</span>   <span class="token number">1</span> <span class="token number">58.76523</span>   f       <span class="token number">1</span>      <span class="token number">1</span>       <span class="token number">1</span>   <span class="token number">1.0</span> <span class="token number">14.5</span>  <span class="token number">261</span>    <span class="token number">2.60</span>    <span class="token number">156</span>   <span class="token number">1718.0</span> <span class="token number">137.95</span>  <span class="token number">172</span>      <span class="token number">190</span>    <span class="token number">12.2</span>     <span class="token number">4</span><span class="token number">2</span>  <span class="token number">2</span> <span class="token number">4500</span>      <span class="token number">0</span>   <span class="token number">1</span> <span class="token number">56.44627</span>   f       <span class="token number">0</span>      <span class="token number">1</span>       <span class="token number">1</span>   <span class="token number">0.0</span>  <span class="token number">1.1</span>  <span class="token number">302</span>    <span class="token number">4.14</span>     <span class="token number">54</span>   <span class="token number">7394.8</span> <span class="token number">113.52</span>   <span class="token number">88</span>      <span class="token number">221</span>    <span class="token number">10.6</span>     <span class="token number">3</span><span class="token number">3</span>  <span class="token number">3</span> <span class="token number">1012</span>      <span class="token number">2</span>   <span class="token number">1</span> <span class="token number">70.07255</span>   m       <span class="token number">0</span>      <span class="token number">0</span>       <span class="token number">0</span>   <span class="token number">0.5</span>  <span class="token number">1.4</span>  <span class="token number">176</span>    <span class="token number">3.48</span>    <span class="token number">210</span>    <span class="token number">516.0</span>  <span class="token number">96.10</span>   <span class="token number">55</span>      <span class="token number">151</span>    <span class="token number">12.0</span>     <span class="token number">4</span><span class="token number">4</span>  <span class="token number">4</span> <span class="token number">1925</span>      <span class="token number">2</span>   <span class="token number">1</span> <span class="token number">54.74059</span>   f       <span class="token number">0</span>      <span class="token number">1</span>       <span class="token number">1</span>   <span class="token number">0.5</span>  <span class="token number">1.8</span>  <span class="token number">244</span>    <span class="token number">2.54</span>     <span class="token number">64</span>   <span class="token number">6121.8</span>  <span class="token number">60.63</span>   <span class="token number">92</span>      <span class="token number">183</span>    <span class="token number">10.3</span>     <span class="token number">4</span><span class="token number">5</span>  <span class="token number">5</span> <span class="token number">1504</span>      <span class="token number">1</span>   <span class="token number">2</span> <span class="token number">38.10541</span>   f       <span class="token number">0</span>      <span class="token number">1</span>       <span class="token number">1</span>   <span class="token number">0.0</span>  <span class="token number">3.4</span>  <span class="token number">279</span>    <span class="token number">3.53</span>    <span class="token number">143</span>    <span class="token number">671.0</span> <span class="token number">113.15</span>   <span class="token number">72</span>      <span class="token number">136</span>    <span class="token number">10.9</span>     <span class="token number">3</span><span class="token number">6</span>  <span class="token number">6</span> <span class="token number">2503</span>      <span class="token number">2</span>   <span class="token number">2</span> <span class="token number">66.25873</span>   f       <span class="token number">0</span>      <span class="token number">1</span>       <span class="token number">0</span>   <span class="token number">0.0</span>  <span class="token number">0.8</span>  <span class="token number">248</span>    <span class="token number">3.98</span>     <span class="token number">50</span>    <span class="token number">944.0</span>  <span class="token number">93.00</span>   <span class="token number">63</span>       <span class="token keyword">NA</span>    <span class="token number">11.0</span>     <span class="token number">3</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p>从上述数据，我们正在考虑分析的时间和状态。</p><p><strong>应用 <code>Surv()</code> 和 <code>survfit()</code> 函数</strong></p><p>现在我们继续应用 <code>Surv()</code> 函数到上面的数据集，并创建一个将显示趋势图。</p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r"><span class="token comment"># Load the library.</span>library<span class="token punctuation">(</span><span class="token string">"survival"</span><span class="token punctuation">)</span><span class="token comment"># Create the survival object. </span>survfit<span class="token punctuation">(</span>Surv<span class="token punctuation">(</span>pbc<span class="token operator">$</span>time<span class="token punctuation">,</span> pbc<span class="token operator">$</span>status <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">~</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token comment"># Give the chart file a name.</span>png<span class="token punctuation">(</span>file <span class="token operator">=</span> <span class="token string">"survival.png"</span><span class="token punctuation">)</span><span class="token comment"># Plot the graph. </span>plot<span class="token punctuation">(</span>survfit<span class="token punctuation">(</span>Surv<span class="token punctuation">(</span>pbc<span class="token operator">$</span>time<span class="token punctuation">,</span> pbc<span class="token operator">$</span>status <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">~</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment"># Save the file.</span>dev.off<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment"># 当我们执行上面的代码，它产生以下结果及图表：</span>Call<span class="token operator">:</span> survfit<span class="token punctuation">(</span>formula <span class="token operator">=</span> Surv<span class="token punctuation">(</span>pbc<span class="token operator">$</span>time<span class="token punctuation">,</span> pbc<span class="token operator">$</span>status <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">~</span> <span class="token number">1</span><span class="token punctuation">)</span>      n  events  median <span class="token number">0.95L</span>CL <span class="token number">0.95</span>UCL     <span class="token number">418</span>     <span class="token number">161</span>    <span class="token number">3395</span>    <span class="token number">3090</span>    <span class="token number">3853</span> <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p><img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="/images/post/r_statistics/survival.png" alt></p><p>上图中的趋势有助于我们预测在特定天数结束时的生存概率。</p><h1 id="卡方检验"><a href="#卡方检验" class="headerlink" title="卡方检验"></a>卡方检验</h1><p>卡方检验是一种确定两个分类变量之间是否存在显着相关性的统计方法。这两个变量应该来自相同的人口，他们应该是类似：<code>是/否</code>，<code>男/女</code>，<code>红/绿</code> 等。</p><p>例如，我们可以建立一个观察人们的冰淇淋购买模式的数据集，并尝试将一个人的性别与他们喜欢的冰淇淋的味道相关联。如果发现相关性，我们可以通过了解访问的人的性别的数量来计划适当的味道库存。</p><p><strong>语法</strong></p><p>用于执行卡方检验的函数是 <code>chisq.test()</code>。</p><p>在 R 语言中创建卡方检验的基本语法是：</p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r">chisq.test<span class="token punctuation">(</span>data<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><p>以下是所使用的参数的说明：</p><ul><li><code>data</code> 是以包含观察中变量的计数值的表的形式的数据。</li></ul><p><strong>实例</strong></p><p>我们将在 <code>MASS</code> 包中获取 <code>Cars93</code> 数据，代表 1993 年不同型号汽车的销售额。</p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r">library<span class="token punctuation">(</span><span class="token string">"MASS"</span><span class="token punctuation">)</span>print<span class="token punctuation">(</span>str<span class="token punctuation">(</span>Cars93<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment"># 当我们执行上面的代码，它产生以下结果：</span><span class="token string">'data.frame'</span><span class="token operator">:</span><span class="token number">93</span> obs. of  <span class="token number">27</span> variables<span class="token operator">:</span> <span class="token operator">$</span> Manufacturer      <span class="token operator">:</span> Factor w<span class="token operator">/</span> <span class="token number">32</span> levels <span class="token string">"Acura"</span><span class="token punctuation">,</span><span class="token string">"Audi"</span><span class="token punctuation">,</span>..<span class="token operator">:</span> <span class="token number">1</span> <span class="token number">1</span> <span class="token number">2</span> <span class="token number">2</span> <span class="token number">3</span> <span class="token number">4</span> <span class="token number">4</span> <span class="token number">4</span> <span class="token number">4</span> <span class="token number">5</span> <span class="token ellipsis">...</span> <span class="token operator">$</span> Model             <span class="token operator">:</span> Factor w<span class="token operator">/</span> <span class="token number">93</span> levels <span class="token string">"100"</span><span class="token punctuation">,</span><span class="token string">"190E"</span><span class="token punctuation">,</span><span class="token string">"240"</span><span class="token punctuation">,</span>..<span class="token operator">:</span> <span class="token number">49</span> <span class="token number">56</span> <span class="token number">9</span> <span class="token number">1</span> <span class="token number">6</span> <span class="token number">24</span> <span class="token number">54</span> <span class="token number">74</span> <span class="token number">73</span> <span class="token number">35</span> <span class="token ellipsis">...</span> <span class="token operator">$</span> Type              <span class="token operator">:</span> Factor w<span class="token operator">/</span> <span class="token number">6</span> levels <span class="token string">"Compact"</span><span class="token punctuation">,</span><span class="token string">"Large"</span><span class="token punctuation">,</span>..<span class="token operator">:</span> <span class="token number">4</span> <span class="token number">3</span> <span class="token number">1</span> <span class="token number">3</span> <span class="token number">3</span> <span class="token number">3</span> <span class="token number">2</span> <span class="token number">2</span> <span class="token number">3</span> <span class="token number">2</span> <span class="token ellipsis">...</span> <span class="token operator">$</span> Min.Price         <span class="token operator">:</span> num  <span class="token number">12.9</span> <span class="token number">29.2</span> <span class="token number">25.9</span> <span class="token number">30.8</span> <span class="token number">23.7</span> <span class="token number">14.2</span> <span class="token number">19.9</span> <span class="token number">22.6</span> <span class="token number">26.3</span> <span class="token number">33</span> <span class="token ellipsis">...</span> <span class="token operator">$</span> Price             <span class="token operator">:</span> num  <span class="token number">15.9</span> <span class="token number">33.9</span> <span class="token number">29.1</span> <span class="token number">37.7</span> <span class="token number">30</span> <span class="token number">15.7</span> <span class="token number">20.8</span> <span class="token number">23.7</span> <span class="token number">26.3</span> <span class="token number">34.7</span> <span class="token ellipsis">...</span> <span class="token operator">$</span> Max.Price         <span class="token operator">:</span> num  <span class="token number">18.8</span> <span class="token number">38.7</span> <span class="token number">32.3</span> <span class="token number">44.6</span> <span class="token number">36.2</span> <span class="token number">17.3</span> <span class="token number">21.7</span> <span class="token number">24.9</span> <span class="token number">26.3</span> <span class="token number">36.3</span> <span class="token ellipsis">...</span> <span class="token operator">$</span> MPG.city          <span class="token operator">:</span> int  <span class="token number">25</span> <span class="token number">18</span> <span class="token number">20</span> <span class="token number">19</span> <span class="token number">22</span> <span class="token number">22</span> <span class="token number">19</span> <span class="token number">16</span> <span class="token number">19</span> <span class="token number">16</span> <span class="token ellipsis">...</span> <span class="token operator">$</span> MPG.highway       <span class="token operator">:</span> int  <span class="token number">31</span> <span class="token number">25</span> <span class="token number">26</span> <span class="token number">26</span> <span class="token number">30</span> <span class="token number">31</span> <span class="token number">28</span> <span class="token number">25</span> <span class="token number">27</span> <span class="token number">25</span> <span class="token ellipsis">...</span> <span class="token operator">$</span> AirBags           <span class="token operator">:</span> Factor w<span class="token operator">/</span> <span class="token number">3</span> levels <span class="token string">"Driver &amp; Passenger"</span><span class="token punctuation">,</span>..<span class="token operator">:</span> <span class="token number">3</span> <span class="token number">1</span> <span class="token number">2</span> <span class="token number">1</span> <span class="token number">2</span> <span class="token number">2</span> <span class="token number">2</span> <span class="token number">2</span> <span class="token number">2</span> <span class="token number">2</span> <span class="token ellipsis">...</span> <span class="token operator">$</span> DriveTrain        <span class="token operator">:</span> Factor w<span class="token operator">/</span> <span class="token number">3</span> levels <span class="token string">"4WD"</span><span class="token punctuation">,</span><span class="token string">"Front"</span><span class="token punctuation">,</span>..<span class="token operator">:</span> <span class="token number">2</span> <span class="token number">2</span> <span class="token number">2</span> <span class="token number">2</span> <span class="token number">3</span> <span class="token number">2</span> <span class="token number">2</span> <span class="token number">3</span> <span class="token number">2</span> <span class="token number">2</span> <span class="token ellipsis">...</span> <span class="token operator">$</span> Cylinders         <span class="token operator">:</span> Factor w<span class="token operator">/</span> <span class="token number">6</span> levels <span class="token string">"3"</span><span class="token punctuation">,</span><span class="token string">"4"</span><span class="token punctuation">,</span><span class="token string">"5"</span><span class="token punctuation">,</span><span class="token string">"6"</span><span class="token punctuation">,</span>..<span class="token operator">:</span> <span class="token number">2</span> <span class="token number">4</span> <span class="token number">4</span> <span class="token number">4</span> <span class="token number">2</span> <span class="token number">2</span> <span class="token number">4</span> <span class="token number">4</span> <span class="token number">4</span> <span class="token number">5</span> <span class="token ellipsis">...</span> <span class="token operator">$</span> EngineSize        <span class="token operator">:</span> num  <span class="token number">1.8</span> <span class="token number">3.2</span> <span class="token number">2.8</span> <span class="token number">2.8</span> <span class="token number">3.5</span> <span class="token number">2.2</span> <span class="token number">3.8</span> <span class="token number">5.7</span> <span class="token number">3.8</span> <span class="token number">4.9</span> <span class="token ellipsis">...</span> <span class="token operator">$</span> Horsepower        <span class="token operator">:</span> int  <span class="token number">140</span> <span class="token number">200</span> <span class="token number">172</span> <span class="token number">172</span> <span class="token number">208</span> <span class="token number">110</span> <span class="token number">170</span> <span class="token number">180</span> <span class="token number">170</span> <span class="token number">200</span> <span class="token ellipsis">...</span> <span class="token operator">$</span> RPM               <span class="token operator">:</span> int  <span class="token number">6300</span> <span class="token number">5500</span> <span class="token number">5500</span> <span class="token number">5500</span> <span class="token number">5700</span> <span class="token number">5200</span> <span class="token number">4800</span> <span class="token number">4000</span> <span class="token number">4800</span> <span class="token number">4100</span> <span class="token ellipsis">...</span> <span class="token operator">$</span> Rev.per.mile      <span class="token operator">:</span> int  <span class="token number">2890</span> <span class="token number">2335</span> <span class="token number">2280</span> <span class="token number">2535</span> <span class="token number">2545</span> <span class="token number">2565</span> <span class="token number">1570</span> <span class="token number">1320</span> <span class="token number">1690</span> <span class="token number">1510</span> <span class="token ellipsis">...</span> <span class="token operator">$</span> Man.trans.avail   <span class="token operator">:</span> Factor w<span class="token operator">/</span> <span class="token number">2</span> levels <span class="token string">"No"</span><span class="token punctuation">,</span><span class="token string">"Yes"</span><span class="token operator">:</span> <span class="token number">2</span> <span class="token number">2</span> <span class="token number">2</span> <span class="token number">2</span> <span class="token number">2</span> <span class="token number">1</span> <span class="token number">1</span> <span class="token number">1</span> <span class="token number">1</span> <span class="token number">1</span> <span class="token ellipsis">...</span> <span class="token operator">$</span> Fuel.tank.capacity<span class="token operator">:</span> num  <span class="token number">13.2</span> <span class="token number">18</span> <span class="token number">16.9</span> <span class="token number">21.1</span> <span class="token number">21.1</span> <span class="token number">16.4</span> <span class="token number">18</span> <span class="token number">23</span> <span class="token number">18.8</span> <span class="token number">18</span> <span class="token ellipsis">...</span> <span class="token operator">$</span> Passengers        <span class="token operator">:</span> int  <span class="token number">5</span> <span class="token number">5</span> <span class="token number">5</span> <span class="token number">6</span> <span class="token number">4</span> <span class="token number">6</span> <span class="token number">6</span> <span class="token number">6</span> <span class="token number">5</span> <span class="token number">6</span> <span class="token ellipsis">...</span> <span class="token operator">$</span> Length            <span class="token operator">:</span> int  <span class="token number">177</span> <span class="token number">195</span> <span class="token number">180</span> <span class="token number">193</span> <span class="token number">186</span> <span class="token number">189</span> <span class="token number">200</span> <span class="token number">216</span> <span class="token number">198</span> <span class="token number">206</span> <span class="token ellipsis">...</span> <span class="token operator">$</span> Wheelbase         <span class="token operator">:</span> int  <span class="token number">102</span> <span class="token number">115</span> <span class="token number">102</span> <span class="token number">106</span> <span class="token number">109</span> <span class="token number">105</span> <span class="token number">111</span> <span class="token number">116</span> <span class="token number">108</span> <span class="token number">114</span> <span class="token ellipsis">...</span> <span class="token operator">$</span> Width             <span class="token operator">:</span> int  <span class="token number">68</span> <span class="token number">71</span> <span class="token number">67</span> <span class="token number">70</span> <span class="token number">69</span> <span class="token number">69</span> <span class="token number">74</span> <span class="token number">78</span> <span class="token number">73</span> <span class="token number">73</span> <span class="token ellipsis">...</span> <span class="token operator">$</span> Turn.circle       <span class="token operator">:</span> int  <span class="token number">37</span> <span class="token number">38</span> <span class="token number">37</span> <span class="token number">37</span> <span class="token number">39</span> <span class="token number">41</span> <span class="token number">42</span> <span class="token number">45</span> <span class="token number">41</span> <span class="token number">43</span> <span class="token ellipsis">...</span> <span class="token operator">$</span> Rear.seat.room    <span class="token operator">:</span> num  <span class="token number">26.5</span> <span class="token number">30</span> <span class="token number">28</span> <span class="token number">31</span> <span class="token number">27</span> <span class="token number">28</span> <span class="token number">30.5</span> <span class="token number">30.5</span> <span class="token number">26.5</span> <span class="token number">35</span> <span class="token ellipsis">...</span> <span class="token operator">$</span> Luggage.room      <span class="token operator">:</span> int  <span class="token number">11</span> <span class="token number">15</span> <span class="token number">14</span> <span class="token number">17</span> <span class="token number">13</span> <span class="token number">16</span> <span class="token number">17</span> <span class="token number">21</span> <span class="token number">14</span> <span class="token number">18</span> <span class="token ellipsis">...</span> <span class="token operator">$</span> Weight            <span class="token operator">:</span> int  <span class="token number">2705</span> <span class="token number">3560</span> <span class="token number">3375</span> <span class="token number">3405</span> <span class="token number">3640</span> <span class="token number">2880</span> <span class="token number">3470</span> <span class="token number">4105</span> <span class="token number">3495</span> <span class="token number">3620</span> <span class="token ellipsis">...</span> <span class="token operator">$</span> Origin            <span class="token operator">:</span> Factor w<span class="token operator">/</span> <span class="token number">2</span> levels <span class="token string">"USA"</span><span class="token punctuation">,</span><span class="token string">"non-USA"</span><span class="token operator">:</span> <span class="token number">2</span> <span class="token number">2</span> <span class="token number">2</span> <span class="token number">2</span> <span class="token number">2</span> <span class="token number">1</span> <span class="token number">1</span> <span class="token number">1</span> <span class="token number">1</span> <span class="token number">1</span> <span class="token ellipsis">...</span> <span class="token operator">$</span> Make              <span class="token operator">:</span> Factor w<span class="token operator">/</span> <span class="token number">93</span> levels <span class="token string">"Acura Integra"</span><span class="token punctuation">,</span>..<span class="token operator">:</span> <span class="token number">1</span> <span class="token number">2</span> <span class="token number">4</span> <span class="token number">3</span> <span class="token number">5</span> <span class="token number">6</span> <span class="token number">7</span> <span class="token number">9</span> <span class="token number">8</span> <span class="token number">10</span> <span class="token ellipsis">...</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p>上述结果表明数据集有很多因素变量，可以被认为是分类变量。对于我们的模型，我们将考虑变量 <code>AirBags</code> 和 <code>Type</code>。在这里，我们的目标是找出所售的汽车类型和安全气囊类型之间的任何显着的相关性。如果观察到相关性，我们可以估计哪种类型的汽车可以更好地卖什么类型的气囊。</p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r"><span class="token comment"># Load the library.</span>library<span class="token punctuation">(</span><span class="token string">"MASS"</span><span class="token punctuation">)</span><span class="token comment"># Create a data frame from the main data set.</span>car.data <span class="token operator">&lt;-</span> data.frame<span class="token punctuation">(</span>Cars93<span class="token operator">$</span>AirBags<span class="token punctuation">,</span> Cars93<span class="token operator">$</span>Type<span class="token punctuation">)</span><span class="token comment"># Create a table with the needed variables.</span>car.data <span class="token operator">=</span> table<span class="token punctuation">(</span>Cars93<span class="token operator">$</span>AirBags<span class="token punctuation">,</span> Cars93<span class="token operator">$</span>Type<span class="token punctuation">)</span> print<span class="token punctuation">(</span>car.data<span class="token punctuation">)</span><span class="token comment"># Perform the Chi-Square test.</span>print<span class="token punctuation">(</span>chisq.test<span class="token punctuation">(</span>car.data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment"># 当我们执行上面的代码，它产生以下结果：</span>                     Compact Large Midsize Small Sporty Van  Driver <span class="token operator">&amp;</span> Passenger       <span class="token number">2</span>     <span class="token number">4</span>       <span class="token number">7</span>     <span class="token number">0</span>      <span class="token number">3</span>   <span class="token number">0</span>  Driver only              <span class="token number">9</span>     <span class="token number">7</span>      <span class="token number">11</span>     <span class="token number">5</span>      <span class="token number">8</span>   <span class="token number">3</span>  None                     <span class="token number">5</span>     <span class="token number">0</span>       <span class="token number">4</span>    <span class="token number">16</span>      <span class="token number">3</span>   <span class="token number">6</span>Pearson`s Chi<span class="token operator">-</span>squared testdata<span class="token operator">:</span>  car.dataX<span class="token operator">-</span>squared <span class="token operator">=</span> <span class="token number">33.001</span><span class="token punctuation">,</span> df <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">,</span> p<span class="token operator">-</span>value <span class="token operator">=</span> <span class="token number">0.0002723</span>Warning message<span class="token operator">:</span>In chisq.test<span class="token punctuation">(</span>car.data<span class="token punctuation">)</span> <span class="token operator">:</span> Chi<span class="token operator">-</span>squared approximation may be incorrect<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p><strong>结论</strong>结果显示 <code>P</code> 值小于 <code>0.05</code>，这表明汽车类型和安全气囊类型之间具有相关性。</p>]]></content>
      
      
      <categories>
          
          <category> 教程笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 大数据 </tag>
            
            <tag> R </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>R 语言数据接口</title>
      <link href="post/996a1090.html"/>
      <url>post/996a1090.html</url>
      
        <content type="html"><![CDATA[<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>R 语言处理的数据一般从外部导入，因此需要数据接口来读取各种格式化的数据。</p><p>在 R 语言中，我们可以从存储在 R 语言环境外的文件中读取数据。我们还可以将数据写入将被操作系统存储和访问的文件。R 语言可以读取和写入各种文件格式，如​ <code>CSV</code>​，​<code>Excel</code>​，<code>XML</code>，<code>JSON</code> ​等。</p><h1 id="CSV-文件"><a href="#CSV-文件" class="headerlink" title="CSV 文件"></a>CSV 文件</h1><p>本章节学习从​ <code>CSV</code> 文件读取数据，然后将数据写入 <code>CSV</code> ​文件。该文件应该存在于当前工作目录中，以便 R 语言可以读取它。当然我们也可以设置我们自己的目录并从那里读取文件。</p><h2 id="获取和设置工作目录"><a href="#获取和设置工作目录" class="headerlink" title="获取和设置工作目录"></a>获取和设置工作目录</h2><p>您可以使用 ​<code>getwd()</code>​ 函数检查R 语言工作区指向的目录。您还可以使用 <code>setwd()​</code> 函数设置新的工作目录。</p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r"><span class="token comment"># Get and print current working directory.</span>print<span class="token punctuation">(</span>getwd<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment"># Set current working directory.</span>setwd<span class="token punctuation">(</span><span class="token string">"E:/data"</span><span class="token punctuation">)</span><span class="token comment"># Get and print current working directory.</span>print<span class="token punctuation">(</span>getwd<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment"># 当我们执行上面的代码，它产生以下结果：</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token string">"C:/Users/user/Documents"</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token string">"E:/data"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p>此结果取决于您的操作系统和您当前工作的目录。</p><h2 id="创建-CSV-文件"><a href="#创建-CSV-文件" class="headerlink" title="创建 CSV 文件"></a>创建 CSV 文件</h2><p><code>CSV</code> 文件是一个文本文件，其中列中的值由逗号分隔。</p><p>通过将以下数据复制到文本编辑器（如记事本）中来创建文件。使用 <code>.csv</code> 扩展名保存使用记事本中的保存为所有文件​（<code>*.*</code>）​选项，将文件保存为 <code>input.csv</code>。</p><p><pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown">id,name,salary,start_date,dept1,Rick,623.3,2012-01-01,IT2,Dan,515.2,2013-09-23,Operations3,Michelle,611,2014-11-15,IT4,Ryan,729,2014-05-11,HR ,Gary,843.25,2015-03-27,Finance6,Nina,578,2013-05-21,IT7,Simon,632.8,2013-07-30,Operations8,Guru,722.5,2014-06-17,Finance<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h2 id="读取-CSV-文件"><a href="#读取-CSV-文件" class="headerlink" title="读取 CSV 文件"></a>读取 CSV 文件</h2><p>以下是​ <code>read.csv()</code> ​函数的一个简单示例，用于读取当前工作目录中可用的 <code>CSV</code> 文件。</p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r">data <span class="token operator">&lt;-</span> read.csv<span class="token punctuation">(</span><span class="token string">"input.csv"</span><span class="token punctuation">)</span>print<span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token comment"># 当我们执行上面的代码，它产生以下结果：</span>  id     name salary start_date       dept<span class="token number">1</span>  <span class="token number">1</span>     Rick <span class="token number">623.30</span> <span class="token number">2012</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">01</span>         IT<span class="token number">2</span>  <span class="token number">2</span>      Dan <span class="token number">515.20</span> <span class="token number">2013</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">23</span> Operations<span class="token number">3</span>  <span class="token number">3</span> Michelle <span class="token number">611.00</span> <span class="token number">2014</span><span class="token operator">-</span><span class="token number">11</span><span class="token operator">-</span><span class="token number">15</span>         IT<span class="token number">4</span>  <span class="token number">4</span>     Ryan <span class="token number">729.00</span> <span class="token number">2014</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">11</span>         HR<span class="token number">5</span> <span class="token keyword">NA</span>     Gary <span class="token number">843.25</span> <span class="token number">2015</span><span class="token operator">-</span><span class="token number">03</span><span class="token operator">-</span><span class="token number">27</span>    Finance<span class="token number">6</span>  <span class="token number">6</span>     Nina <span class="token number">578.00</span> <span class="token number">2013</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">21</span>         IT<span class="token number">7</span>  <span class="token number">7</span>    Simon <span class="token number">632.80</span> <span class="token number">2013</span><span class="token operator">-</span><span class="token number">07</span><span class="token operator">-</span><span class="token number">30</span> Operations<span class="token number">8</span>  <span class="token number">8</span>     Guru <span class="token number">722.50</span> <span class="token number">2014</span><span class="token operator">-</span><span class="token number">06</span><span class="token operator">-</span><span class="token number">17</span>    Finance<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h2 id="分析-CSV-文件"><a href="#分析-CSV-文件" class="headerlink" title="分析 CSV 文件"></a>分析 CSV 文件</h2><p>默认情况下，<code>​read.csv()​</code> 函数将输出作为数据框。这可以容易地如下检查。此外，我们可以检查列和行的数量。</p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r">data <span class="token operator">&lt;-</span> read.csv<span class="token punctuation">(</span><span class="token string">"input.csv"</span><span class="token punctuation">)</span>print<span class="token punctuation">(</span>is.data.frame<span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span>print<span class="token punctuation">(</span>ncol<span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span>print<span class="token punctuation">(</span>nrow<span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment"># 当我们执行上面的代码，它产生以下结果：</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token boolean">TRUE</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token number">5</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token number">8</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p>一旦我们读取数据框中的数据，我们可以应用所有适用于数据框的函数。</p><p><strong>获取最高工资</strong></p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r"><span class="token comment"># Create a data frame.</span>data <span class="token operator">&lt;-</span> read.csv<span class="token punctuation">(</span><span class="token string">"input.csv"</span><span class="token punctuation">)</span><span class="token comment"># Get the max salary from data frame.</span>sal <span class="token operator">&lt;-</span> max<span class="token punctuation">(</span>data<span class="token operator">$</span>salary<span class="token punctuation">)</span>print<span class="token punctuation">(</span>sal<span class="token punctuation">)</span><span class="token comment"># 当我们执行上面的代码，它产生以下结果：</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token number">843.25</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p><strong>获取具有最高工资的人的详细信息</strong></p><p>我们可以获取满足特定过滤条件的行，类似于 <code>​SQL WHERE</code> 子句。</p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r"><span class="token comment"># Create a data frame.</span>data <span class="token operator">&lt;-</span> read.csv<span class="token punctuation">(</span><span class="token string">"input.csv"</span><span class="token punctuation">)</span><span class="token comment"># Get the person detail having max salary.</span>retval <span class="token operator">&lt;-</span> subset<span class="token punctuation">(</span>data<span class="token punctuation">,</span> salary <span class="token operator">==</span> max<span class="token punctuation">(</span>salary<span class="token punctuation">)</span><span class="token punctuation">)</span>print<span class="token punctuation">(</span>retval<span class="token punctuation">)</span><span class="token comment"># 当我们执行上面的代码，它产生以下结果：</span>  id name salary start_date    dept<span class="token number">5</span> <span class="token keyword">NA</span> Gary <span class="token number">843.25</span> <span class="token number">2015</span><span class="token operator">-</span><span class="token number">03</span><span class="token operator">-</span><span class="token number">27</span> Finance<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p><strong>获取所有的 IT 部门员工的信息</strong></p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r"><span class="token comment"># Create a data frame.</span>data <span class="token operator">&lt;-</span> read.csv<span class="token punctuation">(</span><span class="token string">"input.csv"</span><span class="token punctuation">)</span>retval <span class="token operator">&lt;-</span> subset<span class="token punctuation">(</span> data<span class="token punctuation">,</span> dept <span class="token operator">==</span> <span class="token string">"IT"</span><span class="token punctuation">)</span>print<span class="token punctuation">(</span>retval<span class="token punctuation">)</span><span class="token comment"># 当我们执行上面的代码，它产生以下结果：</span>  id     name salary start_date dept<span class="token number">1</span>  <span class="token number">1</span>     Rick  <span class="token number">623.3</span> <span class="token number">2012</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">01</span>   IT<span class="token number">3</span>  <span class="token number">3</span> Michelle  <span class="token number">611.0</span> <span class="token number">2014</span><span class="token operator">-</span><span class="token number">11</span><span class="token operator">-</span><span class="token number">15</span>   IT<span class="token number">6</span>  <span class="token number">6</span>     Nina  <span class="token number">578.0</span> <span class="token number">2013</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">21</span>   IT<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p><strong>获取工资大于 600 的 IT 部门的人员</strong></p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r"><span class="token comment"># Create a data frame.</span>data <span class="token operator">&lt;-</span> read.csv<span class="token punctuation">(</span><span class="token string">"input.csv"</span><span class="token punctuation">)</span>info <span class="token operator">&lt;-</span> subset<span class="token punctuation">(</span>data<span class="token punctuation">,</span> salary <span class="token operator">></span> <span class="token number">600</span> <span class="token operator">&amp;</span> dept <span class="token operator">==</span> <span class="token string">"IT"</span><span class="token punctuation">)</span>print<span class="token punctuation">(</span>info<span class="token punctuation">)</span><span class="token comment"># 当我们执行上面的代码，它产生以下结果：</span>  id     name salary start_date dept<span class="token number">1</span>  <span class="token number">1</span>     Rick  <span class="token number">623.3</span> <span class="token number">2012</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">01</span>   IT<span class="token number">3</span>  <span class="token number">3</span> Michelle  <span class="token number">611.0</span> <span class="token number">2014</span><span class="token operator">-</span><span class="token number">11</span><span class="token operator">-</span><span class="token number">15</span>   IT<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p><strong>获取 2014 年或之后加入的人</strong></p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r"><span class="token comment"># Create a data frame.</span>data <span class="token operator">&lt;-</span> read.csv<span class="token punctuation">(</span><span class="token string">"input.csv"</span><span class="token punctuation">)</span>retval <span class="token operator">&lt;-</span> subset<span class="token punctuation">(</span>data<span class="token punctuation">,</span> as.Date<span class="token punctuation">(</span>start_date<span class="token punctuation">)</span> <span class="token operator">></span> as.Date<span class="token punctuation">(</span><span class="token string">"2014-01-01"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>print<span class="token punctuation">(</span>retval<span class="token punctuation">)</span><span class="token comment"># 当我们执行上面的代码，它产生以下结果：</span>  id     name salary start_date    dept<span class="token number">3</span>  <span class="token number">3</span> Michelle <span class="token number">611.00</span> <span class="token number">2014</span><span class="token operator">-</span><span class="token number">11</span><span class="token operator">-</span><span class="token number">15</span>      IT<span class="token number">4</span>  <span class="token number">4</span>     Ryan <span class="token number">729.00</span> <span class="token number">2014</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">11</span>      HR<span class="token number">5</span> <span class="token keyword">NA</span>     Gary <span class="token number">843.25</span> <span class="token number">2015</span><span class="token operator">-</span><span class="token number">03</span><span class="token operator">-</span><span class="token number">27</span> Finance<span class="token number">8</span>  <span class="token number">8</span>     Guru <span class="token number">722.50</span> <span class="token number">2014</span><span class="token operator">-</span><span class="token number">06</span><span class="token operator">-</span><span class="token number">17</span> Finance<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h2 id="写入-CSV-文件"><a href="#写入-CSV-文件" class="headerlink" title="写入 CSV 文件"></a>写入 CSV 文件</h2><p>R 语言可以创建​ <code>CSV</code> 文件形式的现有数据框。​<code>write.csv()</code> ​函数用于创建​ <code>CSV</code> 文件。此文件在工作目录中创建。</p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r"><span class="token comment"># Create a data frame.</span>data <span class="token operator">&lt;-</span> read.csv<span class="token punctuation">(</span><span class="token string">"input.csv"</span><span class="token punctuation">)</span>retval <span class="token operator">&lt;-</span> subset<span class="token punctuation">(</span>data<span class="token punctuation">,</span> as.Date<span class="token punctuation">(</span>start_date<span class="token punctuation">)</span> <span class="token operator">></span> as.Date<span class="token punctuation">(</span><span class="token string">"2014-01-01"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment"># Write filtered data into a new file.</span>write.csv<span class="token punctuation">(</span>retval<span class="token punctuation">,</span> <span class="token string">"output.csv"</span><span class="token punctuation">)</span>newdata <span class="token operator">&lt;-</span> read.csv<span class="token punctuation">(</span><span class="token string">"output.csv"</span><span class="token punctuation">)</span>print<span class="token punctuation">(</span>newdata<span class="token punctuation">)</span><span class="token comment"># 当我们执行上面的代码，它产生以下结果：</span>  X id     name salary start_date    dept<span class="token number">1</span> <span class="token number">3</span>  <span class="token number">3</span> Michelle <span class="token number">611.00</span> <span class="token number">2014</span><span class="token operator">-</span><span class="token number">11</span><span class="token operator">-</span><span class="token number">15</span>      IT<span class="token number">2</span> <span class="token number">4</span>  <span class="token number">4</span>     Ryan <span class="token number">729.00</span> <span class="token number">2014</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">11</span>      HR<span class="token number">3</span> <span class="token number">5</span> <span class="token keyword">NA</span>     Gary <span class="token number">843.25</span> <span class="token number">2015</span><span class="token operator">-</span><span class="token number">03</span><span class="token operator">-</span><span class="token number">27</span> Finance<span class="token number">4</span> <span class="token number">8</span>  <span class="token number">8</span>     Guru <span class="token number">722.50</span> <span class="token number">2014</span><span class="token operator">-</span><span class="token number">06</span><span class="token operator">-</span><span class="token number">17</span> Finance<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p>这里列 <code>X</code> 来自数据集 ​<code>newper</code>​。这可以在写入文件时使用附加参数 <code>row.names = FALSE</code> 删除。</p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r"><span class="token comment"># Create a data frame.</span>data <span class="token operator">&lt;-</span> read.csv<span class="token punctuation">(</span><span class="token string">"input.csv"</span><span class="token punctuation">)</span>retval <span class="token operator">&lt;-</span> subset<span class="token punctuation">(</span>data<span class="token punctuation">,</span> as.Date<span class="token punctuation">(</span>start_date<span class="token punctuation">)</span> <span class="token operator">></span> as.Date<span class="token punctuation">(</span><span class="token string">"2014-01-01"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment"># Write filtered data into a new file.</span>write.csv<span class="token punctuation">(</span>retval<span class="token punctuation">,</span> <span class="token string">"output.csv"</span><span class="token punctuation">,</span> row.names <span class="token operator">=</span> <span class="token boolean">FALSE</span><span class="token punctuation">)</span>newdata <span class="token operator">&lt;-</span> read.csv<span class="token punctuation">(</span><span class="token string">"output.csv"</span><span class="token punctuation">)</span>print<span class="token punctuation">(</span>newdata<span class="token punctuation">)</span><span class="token comment"># 当我们执行上面的代码，它产生以下结果：</span>  id     name salary start_date    dept<span class="token number">1</span>  <span class="token number">3</span> Michelle <span class="token number">611.00</span> <span class="token number">2014</span><span class="token operator">-</span><span class="token number">11</span><span class="token operator">-</span><span class="token number">15</span>      IT<span class="token number">2</span>  <span class="token number">4</span>     Ryan <span class="token number">729.00</span> <span class="token number">2014</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">11</span>      HR<span class="token number">3</span> <span class="token keyword">NA</span>     Gary <span class="token number">843.25</span> <span class="token number">2015</span><span class="token operator">-</span><span class="token number">03</span><span class="token operator">-</span><span class="token number">27</span> Finance<span class="token number">4</span>  <span class="token number">8</span>     Guru <span class="token number">722.50</span> <span class="token number">2014</span><span class="token operator">-</span><span class="token number">06</span><span class="token operator">-</span><span class="token number">17</span> Finance<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h1 id="Excel-文件"><a href="#Excel-文件" class="headerlink" title="Excel 文件"></a>Excel 文件</h1><p>Microsoft Excel 是最广泛使用的电子表格程序，以 <code>.xls</code> 或 <code>.xlsx</code> 格式存储数据。R 语言可以直接从这些文件使用一些 <code>Excel</code> 特定的包获取数据，如<code>XLConnect</code>，<code>xlsx</code>，<code>gdata</code> 等。</p><p>下面我们将使用 <code>xlsx</code> 包。R 语言也可以使用这个包写入 <code>Excel</code> 文件。</p><h2 id="安装-xlsx-软件包"><a href="#安装-xlsx-软件包" class="headerlink" title="安装 xlsx 软件包"></a>安装 xlsx 软件包</h2><p>您可以在R控制台中使用以下命令来安装 <code>xlsx</code> 软件包。它可能会要求安装一些额外的软件包这个软件包依赖。按照具有所需软件包名称的同一命令安装其他软件包。</p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r">install.packages<span class="token punctuation">(</span><span class="token string">"xlsx"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><h2 id="验证并加载-xlsx-软件包"><a href="#验证并加载-xlsx-软件包" class="headerlink" title="验证并加载 xlsx 软件包"></a>验证并加载 xlsx 软件包</h2><p>使用以下命令验证并加载 <code>xlsx</code> 软件包。</p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r"><span class="token comment"># Verify the package is installed.</span>any<span class="token punctuation">(</span>grepl<span class="token punctuation">(</span><span class="token string">"xlsx"</span><span class="token punctuation">,</span> installed.packages<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment"># Load the library into R workspace.</span>library<span class="token punctuation">(</span><span class="token string">"xlsx"</span><span class="token punctuation">)</span><span class="token comment"># 当我们执行上面的代码，它产生以下结果：</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token boolean">TRUE</span>Loading required package<span class="token operator">:</span> rJavaLoading required package<span class="token operator">:</span> methodsLoading required package<span class="token operator">:</span> xlsxjars<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h2 id="创建-xlsx-文件"><a href="#创建-xlsx-文件" class="headerlink" title="创建 xlsx 文件"></a>创建 xlsx 文件</h2><p>打开 Microsoft Excel，将以下数据复制并粘贴到名为 <code>sheet1</code> 的工作表中。</p><div class="table-container"><table><thead><tr><th style="text-align:center">id</th><th style="text-align:center">name</th><th style="text-align:center">salary</th><th style="text-align:center">start_date</th><th style="text-align:center">dept</th></tr></thead><tbody><tr><td style="text-align:center">1</td><td style="text-align:center">Rick</td><td style="text-align:center">623.3</td><td style="text-align:center">2012-01-01</td><td style="text-align:center">IT</td></tr><tr><td style="text-align:center">2</td><td style="text-align:center">Dan</td><td style="text-align:center">515.2</td><td style="text-align:center">2013-09-23</td><td style="text-align:center">Operations</td></tr><tr><td style="text-align:center">3</td><td style="text-align:center">Michelle</td><td style="text-align:center">611</td><td style="text-align:center">2014-11-15</td><td style="text-align:center">IT</td></tr><tr><td style="text-align:center">4</td><td style="text-align:center">Ryan</td><td style="text-align:center">729</td><td style="text-align:center">2014-05-11</td><td style="text-align:center">HR</td></tr><tr><td style="text-align:center"></td><td style="text-align:center">Gary</td><td style="text-align:center">843.25</td><td style="text-align:center">2015-03-27</td><td style="text-align:center">Finance</td></tr><tr><td style="text-align:center">6</td><td style="text-align:center">Nina</td><td style="text-align:center">578</td><td style="text-align:center">2013-05-21</td><td style="text-align:center">IT</td></tr><tr><td style="text-align:center">7</td><td style="text-align:center">Simon</td><td style="text-align:center">632.8</td><td style="text-align:center">2013-07-30</td><td style="text-align:center">Operations</td></tr><tr><td style="text-align:center">8</td><td style="text-align:center">Guru</td><td style="text-align:center">722.5</td><td style="text-align:center">2014-06-17</td><td style="text-align:center">Finance</td></tr></tbody></table></div><p>还要将以下数据复制并粘贴到另一个工作表，并将此工作表重命名为 <code>city</code>。</p><div class="table-container"><table><thead><tr><th style="text-align:center">name</th><th style="text-align:center">city</th></tr></thead><tbody><tr><td style="text-align:center">Rick</td><td style="text-align:center">Seattle</td></tr><tr><td style="text-align:center">Dan</td><td style="text-align:center">Tampa</td></tr><tr><td style="text-align:center">Michelle</td><td style="text-align:center">Chicago</td></tr><tr><td style="text-align:center">Ryan</td><td style="text-align:center">Seattle</td></tr><tr><td style="text-align:center">Gary</td><td style="text-align:center">Houston</td></tr><tr><td style="text-align:center">Nina</td><td style="text-align:center">Boston</td></tr><tr><td style="text-align:center">Simon</td><td style="text-align:center">Mumbai</td></tr><tr><td style="text-align:center">Guru</td><td style="text-align:center">Dallas</td></tr></tbody></table></div><p>将 Excel 文件另存为 <code>input.xlsx</code>。应将其保存在 R 工作区的当前工作目录中。</p><h2 id="读取-Excel-文件"><a href="#读取-Excel-文件" class="headerlink" title="读取 Excel 文件"></a>读取 Excel 文件</h2><p>通过使用 <code>read.xlsx()</code> 函数读取 <code>input.xlsx</code>，以下脚本读取第一个工作表的数据。结果作为数据框存储在 R 语言环境中。</p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r"><span class="token comment"># Read the first worksheet in the file input.xlsx.</span>data <span class="token operator">&lt;-</span> read.xlsx<span class="token punctuation">(</span><span class="token string">"input.xlsx"</span><span class="token punctuation">,</span> sheetIndex <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">)</span>print<span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token comment"># 当我们执行上面的代码，它产生以下结果：</span>  id     name salary start_date       dept<span class="token number">1</span>  <span class="token number">1</span>     Rick <span class="token number">623.30</span> <span class="token number">2012</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">01</span>         IT<span class="token number">2</span>  <span class="token number">2</span>      Dan <span class="token number">515.20</span> <span class="token number">2013</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">23</span> Operations<span class="token number">3</span>  <span class="token number">3</span> Michelle <span class="token number">611.00</span> <span class="token number">2014</span><span class="token operator">-</span><span class="token number">11</span><span class="token operator">-</span><span class="token number">15</span>         IT<span class="token number">4</span>  <span class="token number">4</span>     Ryan <span class="token number">729.00</span> <span class="token number">2014</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">11</span>         HR<span class="token number">5</span> <span class="token keyword">NA</span>     Gary <span class="token number">843.25</span> <span class="token number">2015</span><span class="token operator">-</span><span class="token number">03</span><span class="token operator">-</span><span class="token number">27</span>    Finance<span class="token number">6</span>  <span class="token number">6</span>     Nina <span class="token number">578.00</span> <span class="token number">2013</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">21</span>         IT<span class="token number">7</span>  <span class="token number">7</span>    Simon <span class="token number">632.80</span> <span class="token number">2013</span><span class="token operator">-</span><span class="token number">07</span><span class="token operator">-</span><span class="token number">30</span> Operations<span class="token number">8</span>  <span class="token number">8</span>     Guru <span class="token number">722.50</span> <span class="token number">2014</span><span class="token operator">-</span><span class="token number">06</span><span class="token operator">-</span><span class="token number">17</span>    Finance<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p>我们可以通过设置 <code>sheetIndex</code> 参数读取指定的工作表。</p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r"><span class="token comment"># Read the worksheet named by city in the file input.xlsx.</span>data <span class="token operator">&lt;-</span> read.xlsx<span class="token punctuation">(</span><span class="token string">"input.xlsx"</span><span class="token punctuation">,</span> sheetIndex <span class="token operator">=</span> <span class="token string">"city"</span><span class="token punctuation">)</span>print<span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token comment"># 当我们执行上面的代码，它产生以下结果：</span>      name    city<span class="token number">1</span>     Rick Seattle<span class="token number">2</span>      Dan   Tampa<span class="token number">3</span> Michelle Chicago<span class="token number">4</span>     Ryan Seattle<span class="token number">5</span>     Gary Houston<span class="token number">6</span>     Nina  Boston<span class="token number">7</span>    Simon  Mumbai<span class="token number">8</span>     Guru  Dallas<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h2 id="写入-Excel-文件"><a href="#写入-Excel-文件" class="headerlink" title="写入 Excel 文件"></a>写入 Excel 文件</h2><p>R 语言中的 <code>write.xlsx()</code> 函数用于创建 <code>Excel</code> 文件，此文件在工作目录中创建。</p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r"><span class="token comment"># Read the first worksheet in the file input.xlsx.</span>data <span class="token operator">&lt;-</span> read.xlsx<span class="token punctuation">(</span><span class="token string">"input.xlsx"</span><span class="token punctuation">,</span> sheetIndex <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">)</span>retval <span class="token operator">&lt;-</span> subset<span class="token punctuation">(</span>data<span class="token punctuation">,</span> as.Date<span class="token punctuation">(</span>start_date<span class="token punctuation">)</span> <span class="token operator">></span> as.Date<span class="token punctuation">(</span><span class="token string">"2014-01-01"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment"># Write the data into a new file.</span>write.xlsx<span class="token punctuation">(</span>retval<span class="token punctuation">,</span> file <span class="token operator">=</span> <span class="token string">"output.xlsx"</span><span class="token punctuation">,</span> row.names <span class="token operator">=</span> <span class="token boolean">FALSE</span><span class="token punctuation">,</span> sheetName <span class="token operator">=</span> <span class="token string">"salary"</span><span class="token punctuation">)</span>newdata <span class="token operator">&lt;-</span> read.xlsx<span class="token punctuation">(</span><span class="token string">"output.xlsx"</span><span class="token punctuation">,</span> sheetIndex <span class="token operator">=</span> <span class="token string">"salary"</span><span class="token punctuation">)</span>print<span class="token punctuation">(</span>newdata<span class="token punctuation">)</span><span class="token comment"># 当我们执行上面的代码，它产生以下结果：</span>  id     name salary start_date    dept<span class="token number">1</span>  <span class="token number">3</span> Michelle <span class="token number">611.00</span> <span class="token number">2014</span><span class="token operator">-</span><span class="token number">11</span><span class="token operator">-</span><span class="token number">15</span>      IT<span class="token number">2</span>  <span class="token number">4</span>     Ryan <span class="token number">729.00</span> <span class="token number">2014</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">11</span>      HR<span class="token number">3</span> <span class="token keyword">NA</span>     Gary <span class="token number">843.25</span> <span class="token number">2015</span><span class="token operator">-</span><span class="token number">03</span><span class="token operator">-</span><span class="token number">27</span> Finance<span class="token number">4</span>  <span class="token number">8</span>     Guru <span class="token number">722.50</span> <span class="token number">2014</span><span class="token operator">-</span><span class="token number">06</span><span class="token operator">-</span><span class="token number">17</span> Finance<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h1 id="二进制文件"><a href="#二进制文件" class="headerlink" title="二进制文件"></a>二进制文件</h1><p>二进制文件是包含仅以位和字节（<code>0</code> 和 <code>1</code>）的形式存储的信息的文件。它们不是人类可读的，因为它中的字节转换为包含许多其他不可打印字符的字符和符号。尝试使用任何文本编辑器读取二进制文件将显示如 <code>Ø</code> 和 <code>ð</code> 的字符。</p><p>二进制文件必须由特定程序读取才能使用。例如，Microsoft Word 程序的二进制文件只能通过 Word 程序读取到人类可读的形式。这表示，除了人类可读的文本之外，还有更多的信息，例如字符和页码等的格式化，它们也与字母数字字符一起存储。最后一个二进制文件是一个连续的字节序列。我们在文本文件中看到的换行符是连接第一行到下一行的字符。</p><p>有时，由其他程序生成的数据需要由 R 作为二进制文件处理。另外，R 语言是创建可以与其他程序共享的二进制文件所必需的。</p><p>R 语言有两个函数 <code>WriteBin()</code> 和 <code>readBin()</code> 来创建和读取二进制文件。</p><h2 id="语法"><a href="#语法" class="headerlink" title="语法"></a>语法</h2><p><pre class="line-numbers language-r" data-language="r"><code class="language-r">writeBin<span class="token punctuation">(</span>object<span class="token punctuation">,</span> con<span class="token punctuation">)</span>readBin<span class="token punctuation">(</span>con<span class="token punctuation">,</span> what<span class="token punctuation">,</span> n<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></p><p>以下是所使用的参数的说明：</p><ul><li><code>con</code> 是读取或写入二进制文件的连接对象。</li><li><code>object</code> 是要写入的二进制文件。</li><li><code>what</code> 是像字符，整数等代表字节模式被读取。</li><li><code>n</code> 是从二进制文件读取的字节数。</li></ul><h2 id="写入二进制文件"><a href="#写入二进制文件" class="headerlink" title="写入二进制文件"></a>写入二进制文件</h2><p>我们考虑 R 语言内置数据 <code>mtcars</code>。首先，我们从它创建一个 <code>CSV</code> 文件，并将其转换为二进制文件，并将其存储为操作系统文件。接下来我们读取这个创建的二进制文件。</p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r"><span class="token comment"># Read the "mtcars" data frame as a csv file and store only the columns "cyl", "am" and "gear".</span>write.table<span class="token punctuation">(</span>mtcars<span class="token punctuation">,</span> file <span class="token operator">=</span> <span class="token string">"mtcars.csv"</span><span class="token punctuation">,</span> row.names <span class="token operator">=</span> <span class="token boolean">FALSE</span><span class="token punctuation">,</span> na <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">,</span> col.names <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">,</span> sep <span class="token operator">=</span> <span class="token string">","</span><span class="token punctuation">)</span><span class="token comment"># Store 5 records from the csv file as a new data frame.</span>new.mtcars <span class="token operator">&lt;-</span> read.table<span class="token punctuation">(</span><span class="token string">"mtcars.csv"</span><span class="token punctuation">,</span> sep <span class="token operator">=</span> <span class="token string">","</span><span class="token punctuation">,</span> header <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">,</span> nrows <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token comment"># Create a connection object to write the binary file using mode "wb".</span>write.filename <span class="token operator">=</span> file<span class="token punctuation">(</span><span class="token string">"binmtcars.dat"</span><span class="token punctuation">,</span> <span class="token string">"wb"</span><span class="token punctuation">)</span><span class="token comment"># Write the column names of the data frame to the connection object.</span>writeBin<span class="token punctuation">(</span>c<span class="token punctuation">(</span><span class="token string">"cyl"</span><span class="token punctuation">,</span> <span class="token string">"am"</span><span class="token punctuation">,</span> <span class="token string">"gear"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> write.filename<span class="token punctuation">)</span><span class="token comment"># Write the records in each of the column to the file.</span>writeBin<span class="token punctuation">(</span>c<span class="token punctuation">(</span>new.mtcars<span class="token operator">$</span>cyl<span class="token punctuation">,</span> new.mtcars<span class="token operator">$</span>am<span class="token punctuation">,</span> new.mtcars<span class="token operator">$</span>gear<span class="token punctuation">)</span><span class="token punctuation">,</span> write.filename<span class="token punctuation">)</span><span class="token comment"># Close the file for writing so that it can be read by other program.</span>close<span class="token punctuation">(</span>write.filename<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h2 id="读取二进制文件"><a href="#读取二进制文件" class="headerlink" title="读取二进制文件"></a>读取二进制文件</h2><p>上面创建的二进制文件将所有数据存储为连续字节。因此，我们将通过选择适当的列名称值和列值来读取它。</p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r"><span class="token comment"># Create a connection object to read the file in binary mode using "rb".</span>read.filename <span class="token operator">&lt;-</span> file<span class="token punctuation">(</span><span class="token string">"binmtcars.dat"</span><span class="token punctuation">,</span> <span class="token string">"rb"</span><span class="token punctuation">)</span><span class="token comment"># First read the column names. n = 3 as we have 3 columns.</span>column.names <span class="token operator">&lt;-</span> readBin<span class="token punctuation">(</span>read.filename<span class="token punctuation">,</span> character<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  n <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token comment"># Next read the column values. n = 18 as we have 3 column names and 15 values.</span>read.filename <span class="token operator">&lt;-</span> file<span class="token punctuation">(</span><span class="token string">"binmtcars.dat"</span><span class="token punctuation">,</span> <span class="token string">"rb"</span><span class="token punctuation">)</span>bindata <span class="token operator">&lt;-</span> readBin<span class="token punctuation">(</span>read.filename<span class="token punctuation">,</span> integer<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> n <span class="token operator">=</span> <span class="token number">18</span><span class="token punctuation">)</span><span class="token comment"># Print the data.</span>print<span class="token punctuation">(</span>bindata<span class="token punctuation">)</span><span class="token comment"># Read the values from 4th byte to 8th byte which represents "cyl".</span>cyldata <span class="token operator">=</span> bindata<span class="token punctuation">[</span><span class="token number">4</span><span class="token operator">:</span><span class="token number">8</span><span class="token punctuation">]</span>print<span class="token punctuation">(</span>cyldata<span class="token punctuation">)</span><span class="token comment"># Read the values form 9th byte to 13th byte which represents "am".</span>amdata <span class="token operator">=</span> bindata<span class="token punctuation">[</span><span class="token number">9</span><span class="token operator">:</span><span class="token number">13</span><span class="token punctuation">]</span>print<span class="token punctuation">(</span>amdata<span class="token punctuation">)</span><span class="token comment"># Read the values form 9th byte to 13th byte which represents "gear".</span>geardata <span class="token operator">=</span> bindata<span class="token punctuation">[</span><span class="token number">14</span><span class="token operator">:</span><span class="token number">18</span><span class="token punctuation">]</span>print<span class="token punctuation">(</span>geardata<span class="token punctuation">)</span><span class="token comment"># Combine all the read values to a dat frame.</span>finaldata <span class="token operator">=</span> cbind<span class="token punctuation">(</span>cyldata<span class="token punctuation">,</span> amdata<span class="token punctuation">,</span> geardata<span class="token punctuation">)</span>colnames<span class="token punctuation">(</span>finaldata<span class="token punctuation">)</span> <span class="token operator">=</span> column.namesprint<span class="token punctuation">(</span>finaldata<span class="token punctuation">)</span><span class="token comment"># 当我们执行上面的代码，它产生以下结果和图表 -</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>    <span class="token number">7108963</span> <span class="token number">1728081249</span>    <span class="token number">7496037</span>          <span class="token number">6</span>          <span class="token number">6</span>          <span class="token number">4</span><span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span>          <span class="token number">6</span>          <span class="token number">8</span>          <span class="token number">1</span>          <span class="token number">1</span>          <span class="token number">1</span>          <span class="token number">0</span><span class="token punctuation">[</span><span class="token number">13</span><span class="token punctuation">]</span>         <span class="token number">0</span>          <span class="token number">4</span>          <span class="token number">4</span>          <span class="token number">4</span>          <span class="token number">3</span>          <span class="token number">3</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token number">6</span> <span class="token number">6</span> <span class="token number">4</span> <span class="token number">6</span> <span class="token number">8</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token number">1</span> <span class="token number">1</span> <span class="token number">1</span> <span class="token number">0</span> <span class="token number">0</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token number">4</span> <span class="token number">4</span> <span class="token number">4</span> <span class="token number">3</span> <span class="token number">3</span>     cyl am gear<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token punctuation">]</span>   <span class="token number">6</span>  <span class="token number">1</span>    <span class="token number">4</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token punctuation">]</span>   <span class="token number">6</span>  <span class="token number">1</span>    <span class="token number">4</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token punctuation">]</span>   <span class="token number">4</span>  <span class="token number">1</span>    <span class="token number">4</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token punctuation">]</span>   <span class="token number">6</span>  <span class="token number">0</span>    <span class="token number">3</span><span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token punctuation">]</span>   <span class="token number">8</span>  <span class="token number">0</span>    <span class="token number">3</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p>正如我们所看到的，我们通过读取 R 中的二进制文件得到原始数据。</p><h1 id="XML文件"><a href="#XML文件" class="headerlink" title="XML文件"></a>XML文件</h1><p><code>XML</code> 是一种文件格式，它使用标准 <code>ASCII</code> 文本共享万维网，内部网和其他地方的文件格式和数据。它代表可扩展标记语言 <code>XML</code>。类似于 <code>HTML</code>，它包含标记标签。但是与 <code>HTML</code> 中的标记标记描述页面的结构不同，在 <code>XML</code> 中，标记描述了包含在文件中的数据的含义。</p><p>您可以使用 <code>XML</code> 包读取 R 语言中的 <code>XML</code> 文件。此软件包可以使用以下命令安装。</p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r">install.packages<span class="token punctuation">(</span><span class="token string">"XML"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><h2 id="创建-XML-文件"><a href="#创建-XML-文件" class="headerlink" title="创建 XML 文件"></a>创建 XML 文件</h2><p>通过将以下数据复制到文本编辑器（如记事本）中来创建文件。使用 <code>.xml</code> 扩展名保存使用记事本中的保存为所有文件​（<code>*.*</code>）​选项，将文件保存为 <code>input.xml</code>。</p><p><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>RECORDS</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>EMPLOYEE</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ID</span><span class="token punctuation">></span></span>1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ID</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>NAME</span><span class="token punctuation">></span></span>Rick<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>NAME</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>SALARY</span><span class="token punctuation">></span></span>623.3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>SALARY</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>STARTDATE</span><span class="token punctuation">></span></span>2012-01-01<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>STARTDATE</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>DEPT</span><span class="token punctuation">></span></span>IT<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>DEPT</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>EMPLOYEE</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>EMPLOYEE</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ID</span><span class="token punctuation">></span></span>2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ID</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>NAME</span><span class="token punctuation">></span></span>Dan<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>NAME</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>SALARY</span><span class="token punctuation">></span></span>515.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>SALARY</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>STARTDATE</span><span class="token punctuation">></span></span>2013-09-23<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>STARTDATE</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>DEPT</span><span class="token punctuation">></span></span>Operations<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>DEPT</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>EMPLOYEE</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>EMPLOYEE</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ID</span><span class="token punctuation">></span></span>3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ID</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>NAME</span><span class="token punctuation">></span></span>Michelle<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>NAME</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>SALARY</span><span class="token punctuation">></span></span>611<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>SALARY</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>STARTDATE</span><span class="token punctuation">></span></span>2014-11-15<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>STARTDATE</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>DEPT</span><span class="token punctuation">></span></span>IT<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>DEPT</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>EMPLOYEE</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>EMPLOYEE</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ID</span><span class="token punctuation">></span></span>4<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ID</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>NAME</span><span class="token punctuation">></span></span>Ryan<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>NAME</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>SALARY</span><span class="token punctuation">></span></span>729<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>SALARY</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>STARTDATE</span><span class="token punctuation">></span></span>2014-05-11<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>STARTDATE</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>DEPT</span><span class="token punctuation">></span></span>HR<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>DEPT</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>EMPLOYEE</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>EMPLOYEE</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ID</span><span class="token punctuation">></span></span>5<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ID</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>NAME</span><span class="token punctuation">></span></span>Gary<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>NAME</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>SALARY</span><span class="token punctuation">></span></span>843.25<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>SALARY</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>STARTDATE</span><span class="token punctuation">></span></span>2015-03-27<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>STARTDATE</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>DEPT</span><span class="token punctuation">></span></span>Finance<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>DEPT</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>EMPLOYEE</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>EMPLOYEE</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ID</span><span class="token punctuation">></span></span>6<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ID</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>NAME</span><span class="token punctuation">></span></span>Nina<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>NAME</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>SALARY</span><span class="token punctuation">></span></span>578<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>SALARY</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>STARTDATE</span><span class="token punctuation">></span></span>2013-05-21<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>STARTDATE</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>DEPT</span><span class="token punctuation">></span></span>IT<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>DEPT</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>EMPLOYEE</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>EMPLOYEE</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ID</span><span class="token punctuation">></span></span>7<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ID</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>NAME</span><span class="token punctuation">></span></span>Simon<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>NAME</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>SALARY</span><span class="token punctuation">></span></span>632.8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>SALARY</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>STARTDATE</span><span class="token punctuation">></span></span>2013-07-30<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>STARTDATE</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>DEPT</span><span class="token punctuation">></span></span>Operations<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>DEPT</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>EMPLOYEE</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>EMPLOYEE</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ID</span><span class="token punctuation">></span></span>8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ID</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>NAME</span><span class="token punctuation">></span></span>Guru<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>NAME</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>SALARY</span><span class="token punctuation">></span></span>722.5<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>SALARY</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>STARTDATE</span><span class="token punctuation">></span></span>2014-06-17<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>STARTDATE</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>DEPT</span><span class="token punctuation">></span></span>Finance<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>DEPT</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>EMPLOYEE</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>RECORDS</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h2 id="读取-XML-文件"><a href="#读取-XML-文件" class="headerlink" title="读取 XML 文件"></a>读取 XML 文件</h2><p><code>XML</code> 文件由 R 语言使用函数 <code>xmlParse()</code> 读取。它作为列表存储在 R 语言中。</p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r"><span class="token comment"># Load the package required to read XML files.</span>library<span class="token punctuation">(</span><span class="token string">"XML"</span><span class="token punctuation">)</span><span class="token comment"># Also load the other required package.</span>library<span class="token punctuation">(</span><span class="token string">"methods"</span><span class="token punctuation">)</span><span class="token comment"># Give the input file name to the function.</span>result <span class="token operator">&lt;-</span> xmlParse<span class="token punctuation">(</span>file <span class="token operator">=</span> <span class="token string">"input.xml"</span><span class="token punctuation">)</span><span class="token comment"># Print the result.</span>print<span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token comment"># 当我们执行上面的代码，它产生以下结果：</span><span class="token number">1</span>Rick<span class="token number">623.3</span><span class="token number">2012</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">01</span>IT<span class="token number">2</span>Dan<span class="token number">515.2</span><span class="token number">2013</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">23</span>Operations<span class="token number">3</span>Michelle<span class="token number">611</span><span class="token number">2014</span><span class="token operator">-</span><span class="token number">11</span><span class="token operator">-</span><span class="token number">15</span>IT<span class="token number">4</span>Ryan<span class="token number">729</span><span class="token number">2014</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">11</span>HR<span class="token number">5</span>Gary<span class="token number">843.25</span><span class="token number">2015</span><span class="token operator">-</span><span class="token number">03</span><span class="token operator">-</span><span class="token number">27</span>Finance<span class="token number">6</span>Nina<span class="token number">578</span><span class="token number">2013</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">21</span>IT<span class="token number">7</span>Simon<span class="token number">632.8</span><span class="token number">2013</span><span class="token operator">-</span><span class="token number">07</span><span class="token operator">-</span><span class="token number">30</span>Operations<span class="token number">8</span>Guru<span class="token number">722.5</span><span class="token number">2014</span><span class="token operator">-</span><span class="token number">06</span><span class="token operator">-</span><span class="token number">17</span>Finance<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p><strong>获取 XML 文件中存在的节点数</strong></p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r"><span class="token comment"># Load the packages required to read XML files.</span>library<span class="token punctuation">(</span><span class="token string">"XML"</span><span class="token punctuation">)</span>library<span class="token punctuation">(</span><span class="token string">"methods"</span><span class="token punctuation">)</span><span class="token comment"># Give the input file name to the function.</span>result <span class="token operator">&lt;-</span> xmlParse<span class="token punctuation">(</span>file <span class="token operator">=</span> <span class="token string">"input.xml"</span><span class="token punctuation">)</span><span class="token comment"># Exract the root node form the xml file.</span>rootnode <span class="token operator">&lt;-</span> xmlRoot<span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token comment"># Find number of nodes in the root.</span>rootsize <span class="token operator">&lt;-</span> xmlSize<span class="token punctuation">(</span>rootnode<span class="token punctuation">)</span><span class="token comment"># Print the result.</span>print<span class="token punctuation">(</span>rootsize<span class="token punctuation">)</span><span class="token comment"># 当我们执行上面的代码，它产生以下结果：</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token number">8</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p><strong>第一个节点的详细信息</strong></p><p>让我们看看解析文件的第一条记录。它将给我们一个关于存在于顶层节点中的各种元素的想法。</p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r"><span class="token comment"># Load the packages required to read XML files.</span>library<span class="token punctuation">(</span><span class="token string">"XML"</span><span class="token punctuation">)</span>library<span class="token punctuation">(</span><span class="token string">"methods"</span><span class="token punctuation">)</span><span class="token comment"># Give the input file name to the function.</span>result <span class="token operator">&lt;-</span> xmlParse<span class="token punctuation">(</span>file <span class="token operator">=</span> <span class="token string">"input.xml"</span><span class="token punctuation">)</span><span class="token comment"># Exract the root node form the xml file.</span>rootnode <span class="token operator">&lt;-</span> xmlRoot<span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token comment"># Print the result.</span>print<span class="token punctuation">(</span>rootnode<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token comment"># 当我们执行上面的代码，它产生以下结果：</span><span class="token operator">$</span>EMPLOYEE  <span class="token number">1</span>  Rick  <span class="token number">623.3</span>  <span class="token number">2012</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">01</span>  ITattr<span class="token punctuation">(</span><span class="token punctuation">,</span><span class="token string">"class"</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token string">"XMLInternalNodeList"</span> <span class="token string">"XMLNodeList"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p><strong>获取节点的不同元素</strong></p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r"><span class="token comment"># Load the packages required to read XML files.</span>library<span class="token punctuation">(</span><span class="token string">"XML"</span><span class="token punctuation">)</span>library<span class="token punctuation">(</span><span class="token string">"methods"</span><span class="token punctuation">)</span><span class="token comment"># Give the input file name to the function.</span>result <span class="token operator">&lt;-</span> xmlParse<span class="token punctuation">(</span>file <span class="token operator">=</span> <span class="token string">"input.xml"</span><span class="token punctuation">)</span><span class="token comment"># Exract the root node form the xml file.</span>rootnode <span class="token operator">&lt;-</span> xmlRoot<span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token comment"># Get the first element of the first node.</span>print<span class="token punctuation">(</span>rootnode<span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token comment"># Get the fifth element of the first node.</span>print<span class="token punctuation">(</span>rootnode<span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token comment"># Get the second element of the third node.</span>print<span class="token punctuation">(</span>rootnode<span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token comment"># 当我们执行上面的代码，它产生以下结果：</span><span class="token number">1</span>ITMichelle<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h2 id="XML-到数据框"><a href="#XML-到数据框" class="headerlink" title="XML 到数据框"></a>XML 到数据框</h2><p>为了在大文件中有效地处理数据，我们将 <code>XML</code> 文件中的数据作为数据框读取。然后处理数据框以进行数据分析。</p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r"><span class="token comment"># Load the packages required to read XML files.</span>library<span class="token punctuation">(</span><span class="token string">"XML"</span><span class="token punctuation">)</span>library<span class="token punctuation">(</span><span class="token string">"methods"</span><span class="token punctuation">)</span><span class="token comment"># Convert the input xml file to a data frame.</span>xmldataframe <span class="token operator">&lt;-</span> xmlToDataFrame<span class="token punctuation">(</span><span class="token string">"input.xml"</span><span class="token punctuation">)</span>print<span class="token punctuation">(</span>xmldataframe<span class="token punctuation">)</span><span class="token comment"># 当我们执行上面的代码，它产生以下结果：</span>  ID     NAME SALARY  STARTDATE       DEPT<span class="token number">1</span>  <span class="token number">1</span>     Rick  <span class="token number">623.3</span> <span class="token number">2012</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">01</span>         IT<span class="token number">2</span>  <span class="token number">2</span>      Dan  <span class="token number">515.2</span> <span class="token number">2013</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">23</span> Operations<span class="token number">3</span>  <span class="token number">3</span> Michelle    <span class="token number">611</span> <span class="token number">2014</span><span class="token operator">-</span><span class="token number">11</span><span class="token operator">-</span><span class="token number">15</span>         IT<span class="token number">4</span>  <span class="token number">4</span>     Ryan    <span class="token number">729</span> <span class="token number">2014</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">11</span>         HR<span class="token number">5</span>  <span class="token number">5</span>     Gary <span class="token number">843.25</span> <span class="token number">2015</span><span class="token operator">-</span><span class="token number">03</span><span class="token operator">-</span><span class="token number">27</span>    Finance<span class="token number">6</span>  <span class="token number">6</span>     Nina    <span class="token number">578</span> <span class="token number">2013</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">21</span>         IT<span class="token number">7</span>  <span class="token number">7</span>    Simon  <span class="token number">632.8</span> <span class="token number">2013</span><span class="token operator">-</span><span class="token number">07</span><span class="token operator">-</span><span class="token number">30</span> Operations<span class="token number">8</span>  <span class="token number">8</span>     Guru  <span class="token number">722.5</span> <span class="token number">2014</span><span class="token operator">-</span><span class="token number">06</span><span class="token operator">-</span><span class="token number">17</span>    Finance<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p>由于数据现在可以作为数据框，我们可以使用数据框相关函数来读取和操作文件。</p><h1 id="JSON-文件"><a href="#JSON-文件" class="headerlink" title="JSON 文件"></a>JSON 文件</h1><p><code>JSON</code> 文件以人类可读格式将数据存储为文本。<code>JSON</code> 代表 <code>JavaScript Object Notation</code>。R 可以使用 <code>rjson</code> 包读取 <code>JSON</code> 文件。</p><p>在 R 语言控制台中，您可以发出以下命令来安装 <code>rjson</code> 包。</p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r">install.packages<span class="token punctuation">(</span><span class="token string">"rjson"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><h2 id="创建-JSON-文件"><a href="#创建-JSON-文件" class="headerlink" title="创建 JSON 文件"></a>创建 JSON 文件</h2><p>通过将以下数据复制到文本编辑器（如记事本）中来创建文件。使用 <code>.json</code> 扩展名保存使用记事本中的保存为所有文件​（<code>*.*</code>）选项，将文件保存为 <code>input.json</code>。</p><p><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span><span class="token property">"ID"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"1"</span><span class="token punctuation">,</span> <span class="token string">"2"</span><span class="token punctuation">,</span> <span class="token string">"3"</span><span class="token punctuation">,</span> <span class="token string">"4"</span><span class="token punctuation">,</span> <span class="token string">"5"</span><span class="token punctuation">,</span> <span class="token string">"6"</span><span class="token punctuation">,</span> <span class="token string">"7"</span><span class="token punctuation">,</span> <span class="token string">"8"</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token property">"Name"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"Rick"</span><span class="token punctuation">,</span> <span class="token string">"Dan"</span><span class="token punctuation">,</span> <span class="token string">"Michelle"</span><span class="token punctuation">,</span> <span class="token string">"Ryan"</span><span class="token punctuation">,</span> <span class="token string">"Gary"</span><span class="token punctuation">,</span> <span class="token string">"Nina"</span><span class="token punctuation">,</span> <span class="token string">"Simon"</span><span class="token punctuation">,</span> <span class="token string">"Guru"</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token property">"Salary"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"623.3"</span><span class="token punctuation">,</span> <span class="token string">"515.2"</span><span class="token punctuation">,</span> <span class="token string">"611"</span><span class="token punctuation">,</span> <span class="token string">"729"</span><span class="token punctuation">,</span> <span class="token string">"843.25"</span><span class="token punctuation">,</span> <span class="token string">"578"</span><span class="token punctuation">,</span> <span class="token string">"632.8"</span><span class="token punctuation">,</span> <span class="token string">"722.5"</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token property">"StartDate"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"2012-01-01"</span><span class="token punctuation">,</span> <span class="token string">"2013-09-23"</span><span class="token punctuation">,</span> <span class="token string">"2014-11-15"</span><span class="token punctuation">,</span> <span class="token string">"2014-05-11"</span><span class="token punctuation">,</span> <span class="token string">"2015-03-27"</span><span class="token punctuation">,</span> <span class="token string">"2013-05-21"</span><span class="token punctuation">,</span><span class="token string">"2013-07-30"</span><span class="token punctuation">,</span> <span class="token string">"2014-06-17"</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token property">"Dept"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"IT"</span><span class="token punctuation">,</span> <span class="token string">"Operations"</span><span class="token punctuation">,</span> <span class="token string">"IT"</span><span class="token punctuation">,</span> <span class="token string">"HR"</span><span class="token punctuation">,</span> <span class="token string">"Finance"</span><span class="token punctuation">,</span> <span class="token string">"IT"</span><span class="token punctuation">,</span> <span class="token string">"Operations"</span><span class="token punctuation">,</span> <span class="token string">"Finance"</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h2 id="读取-JSON-文件"><a href="#读取-JSON-文件" class="headerlink" title="读取 JSON 文件"></a>读取 JSON 文件</h2><p><code>JSON</code> 文件由 R 使用来自 <code>fromJSON()</code> 的函数读取。它作为列表存储在 R 中。</p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r"><span class="token comment"># Load the package required to read JSON files.</span>library<span class="token punctuation">(</span><span class="token string">"rjson"</span><span class="token punctuation">)</span><span class="token comment"># Give the input file name to the function.</span>result <span class="token operator">&lt;-</span> fromJSON<span class="token punctuation">(</span>file <span class="token operator">=</span> <span class="token string">"input.json"</span><span class="token punctuation">)</span><span class="token comment"># Print the result.</span>print<span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token comment"># 当我们执行上面的代码，它产生以下结果：</span><span class="token operator">$</span>ID<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token string">"1"</span> <span class="token string">"2"</span> <span class="token string">"3"</span> <span class="token string">"4"</span> <span class="token string">"5"</span> <span class="token string">"6"</span> <span class="token string">"7"</span> <span class="token string">"8"</span><span class="token operator">$</span>Name<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token string">"Rick"</span>     <span class="token string">"Dan"</span>      <span class="token string">"Michelle"</span> <span class="token string">"Ryan"</span>     <span class="token string">"Gary"</span>     <span class="token string">"Nina"</span>     <span class="token string">"Simon"</span>    <span class="token string">"Guru"</span>    <span class="token operator">$</span>Salary<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token string">"623.3"</span>  <span class="token string">"515.2"</span>  <span class="token string">"611"</span>    <span class="token string">"729"</span>    <span class="token string">"843.25"</span> <span class="token string">"578"</span>    <span class="token string">"632.8"</span>  <span class="token string">"722.5"</span> <span class="token operator">$</span>StartDate<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token string">"2012-01-01"</span> <span class="token string">"2013-09-23"</span> <span class="token string">"2014-11-15"</span> <span class="token string">"2014-05-11"</span> <span class="token string">"2015-03-27"</span> <span class="token string">"2013-05-21"</span> <span class="token string">"2013-07-30"</span> <span class="token string">"2014-06-17"</span><span class="token operator">$</span>Dept<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token string">"IT"</span>         <span class="token string">"Operations"</span> <span class="token string">"IT"</span>         <span class="token string">"HR"</span>         <span class="token string">"Finance"</span>    <span class="token string">"IT"</span>         <span class="token string">"Operations"</span> <span class="token string">"Finance"</span>   <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h2 id="将-JSON-转换为数据框"><a href="#将-JSON-转换为数据框" class="headerlink" title="将 JSON 转换为数据框"></a>将 JSON 转换为数据框</h2><p>我们可以使用 <code>as.data.frame()</code> 函数将上面提取的数据转换为 R 语言数据框以进行进一步分析。</p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r"><span class="token comment"># Load the package required to read JSON files.</span>library<span class="token punctuation">(</span><span class="token string">"rjson"</span><span class="token punctuation">)</span><span class="token comment"># Give the input file name to the function.</span>result <span class="token operator">&lt;-</span> fromJSON<span class="token punctuation">(</span>file <span class="token operator">=</span> <span class="token string">"input.json"</span><span class="token punctuation">)</span><span class="token comment"># Convert JSON file to a data frame.</span>json_data_frame <span class="token operator">&lt;-</span> as.data.frame<span class="token punctuation">(</span>result<span class="token punctuation">)</span>print<span class="token punctuation">(</span>json_data_frame<span class="token punctuation">)</span><span class="token comment"># 当我们执行上面的代码，它产生以下结果：</span>  ID     Name Salary  StartDate       Dept<span class="token number">1</span>  <span class="token number">1</span>     Rick  <span class="token number">623.3</span> <span class="token number">2012</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">01</span>         IT<span class="token number">2</span>  <span class="token number">2</span>      Dan  <span class="token number">515.2</span> <span class="token number">2013</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">23</span> Operations<span class="token number">3</span>  <span class="token number">3</span> Michelle    <span class="token number">611</span> <span class="token number">2014</span><span class="token operator">-</span><span class="token number">11</span><span class="token operator">-</span><span class="token number">15</span>         IT<span class="token number">4</span>  <span class="token number">4</span>     Ryan    <span class="token number">729</span> <span class="token number">2014</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">11</span>         HR<span class="token number">5</span>  <span class="token number">5</span>     Gary <span class="token number">843.25</span> <span class="token number">2015</span><span class="token operator">-</span><span class="token number">03</span><span class="token operator">-</span><span class="token number">27</span>    Finance<span class="token number">6</span>  <span class="token number">6</span>     Nina    <span class="token number">578</span> <span class="token number">2013</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">21</span>         IT<span class="token number">7</span>  <span class="token number">7</span>    Simon  <span class="token number">632.8</span> <span class="token number">2013</span><span class="token operator">-</span><span class="token number">07</span><span class="token operator">-</span><span class="token number">30</span> Operations<span class="token number">8</span>  <span class="token number">8</span>     Guru  <span class="token number">722.5</span> <span class="token number">2014</span><span class="token operator">-</span><span class="token number">06</span><span class="token operator">-</span><span class="token number">17</span>    Finance<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h1 id="Web-数据"><a href="#Web-数据" class="headerlink" title="Web 数据"></a>Web 数据</h1><p>许多网站提供数据供其用户使用。例如，世界卫生组织（WHO）以 <code>CSV</code>，<code>txt</code> 和 <code>XML</code> 文件的形式提供健康和医疗信息的报告。使用 R 语言程序，我们可以从这些网站以编程方式提取特定数据。R 语言中用于从网站中提取数据的一些包是 <code>RCurl</code>，<code>XML</code> 和 <code>stringr</code>，它们用于连接到 URL，识别文件所需的链接并将它们下载到本地环境。</p><p>安装 R 语言的包处理URL和链接到文件需要以下的包。如果它们在R 语言环境中不可用，您可以使用以下命令安装它们。</p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r">install.packages<span class="token punctuation">(</span><span class="token string">"RCurl"</span><span class="token punctuation">)</span>install.packages<span class="token punctuation">(</span><span class="token string">"XML"</span><span class="token punctuation">)</span>install.packages<span class="token punctuation">(</span><span class="token string">"stringr"</span><span class="token punctuation">)</span>install.packages<span class="token punctuation">(</span><span class="token string">"plyr"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></p><h2 id="读取-Web-数据"><a href="#读取-Web-数据" class="headerlink" title="读取 Web 数据"></a>读取 Web 数据</h2><p>我们将访问 <code>URL</code> 天气数据，并使用 R 下载 2015 年的 <code>CSV</code> 文件。</p><p>我们将使用函数 <code>getHTMLLinks()</code> 来收集文件的 <code>URL</code>。然后我们将使用函数<code>downlaod.file()</code> 将文件保存到本地系统。由于我们将对多个文件一次又一次地应用相同的代码，因此我们将创建一个被多次调用的函数。文件名作为参数以 R 列表对象的形式传递到此函数。</p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r"><span class="token comment"># Load the package required.</span>library<span class="token punctuation">(</span><span class="token string">"RCurl"</span><span class="token punctuation">)</span>library<span class="token punctuation">(</span><span class="token string">"XML"</span><span class="token punctuation">)</span>library<span class="token punctuation">(</span><span class="token string">"stringr"</span><span class="token punctuation">)</span>library<span class="token punctuation">(</span><span class="token string">"plyr"</span><span class="token punctuation">)</span><span class="token comment"># Read the URL.</span>url <span class="token operator">&lt;-</span> <span class="token string">"https://www.geos.ed.ac.uk/~weather/jcmb_ws/"</span><span class="token comment"># Gather the html links present in the webpage.</span>links <span class="token operator">&lt;-</span> getHTMLLinks<span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token comment"># Identify only the links which point to the JCMB 2015 files. </span>filenames <span class="token operator">&lt;-</span> links<span class="token punctuation">[</span>str_detect<span class="token punctuation">(</span>links<span class="token punctuation">,</span> <span class="token string">"JCMB_2015"</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token comment"># Store the file names as a list.</span>filenames_list <span class="token operator">&lt;-</span> as.list<span class="token punctuation">(</span>filenames<span class="token punctuation">)</span><span class="token comment"># Create a function to download the files by passing the URL and filename list.</span>downloadcsv <span class="token operator">&lt;-</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>mainurl<span class="token punctuation">,</span> filename<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>   filedetails <span class="token operator">&lt;-</span> str_c<span class="token punctuation">(</span>mainurl<span class="token punctuation">,</span> filename<span class="token punctuation">)</span>   download.file<span class="token punctuation">(</span>filedetails<span class="token punctuation">,</span> filename<span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token comment"># Now apply the l_ply function and save the files into the current R working directory.</span>l_ply<span class="token punctuation">(</span>filenames<span class="token punctuation">,</span> downloadcsv<span class="token punctuation">,</span> mainurl <span class="token operator">=</span> <span class="token string">"https://www.geos.ed.ac.uk/~weather/jcmb_ws/"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p><strong>验证文件下载</strong></p><p>运行上述代码后，您可以在当前 R 语言工作目录中找到以下文件。<pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown">JCMB_2015.csvJCMB_2015_Apr.csvJCMB_2015_Aug.csvJCMB_2015_Dec.csvJCMB_2015_Feb.csvJCMB_2015_Jan.csvJCMB_2015_Jul.csvJCMB_2015_Jun.csvJCMB_2015_Mar.csvJCMB_2015_May.csvJCMB_2015_Nov.csvJCMB_2015_Oct.csvJCMB_2015_Sep.csv<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h1 id="数据库"><a href="#数据库" class="headerlink" title="数据库"></a>数据库</h1><p>数据是关系数据库系统以规范化格式存储。因此，要进行统计计算，我们将需要非常先进和复杂的 <code>SQL</code> 查询。但 R 语言可以轻松地连接到许多关系数据库，如 <code>MySQL</code>，<code>Oracle</code>，<code>SQL Server</code> 等，并从它们获取记录作为数据框。一旦数据在 R 语言环境中可用，它就变成正常的 R 语言数据集，并且可以使用所有强大的包和函数来操作或分析。</p><p>在本教程中，我们将使用 MySQL 作为连接到 R 语言的参考数据库。</p><p>R 语言有一个名为 <code>RMySQL</code> 的内置包，它提供与 MySQL 数据库之间的本地连接。您可以使用以下命令在 R 语言环境中安装此软件包。</p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r">install.packages<span class="token punctuation">(</span><span class="token string">"RMySQL"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><h2 id="连接到-MySQL"><a href="#连接到-MySQL" class="headerlink" title="连接到 MySQL"></a>连接到 MySQL</h2><p>一旦安装了包，我们在 R 中创建一个连接对象以连接到数据库。它使用用户名，密码，数据库名称和主机名作为输入。</p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r"><span class="token comment"># Create a connection Object to MySQL database.</span><span class="token comment"># We will connect to the sampel database named "testdb" that comes with MySQL installation.</span>library<span class="token punctuation">(</span><span class="token string">"RMySQL"</span><span class="token punctuation">)</span>conn <span class="token operator">=</span> dbConnect<span class="token punctuation">(</span>MySQL<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> user <span class="token operator">=</span> <span class="token string">'root'</span><span class="token punctuation">,</span> password <span class="token operator">=</span> <span class="token string">'root'</span><span class="token punctuation">,</span> dbname <span class="token operator">=</span> <span class="token string">'testdb'</span><span class="token punctuation">,</span> host <span class="token operator">=</span> <span class="token string">'localhost'</span><span class="token punctuation">,</span> port<span class="token operator">=</span><span class="token number">3306</span><span class="token punctuation">)</span><span class="token comment"># Set the encoding method to gbk</span>dbSendQuery<span class="token punctuation">(</span>conn<span class="token punctuation">,</span> <span class="token string">'SET NAMES gbk'</span><span class="token punctuation">)</span><span class="token comment"># List the tables available in this database.</span>dbListTables<span class="token punctuation">(</span>conn<span class="token punctuation">)</span><span class="token comment"># 当我们执行上面的代码，它产生以下结果：</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token string">"employee_tbl"</span>    <span class="token string">"tbl"</span>    <span class="token string">"tcount_tbl"</span>    <span class="token string">"transaction_test"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h2 id="查询表数据"><a href="#查询表数据" class="headerlink" title="查询表数据"></a>查询表数据</h2><p>我们可以使用函数 <code>dbSendQuery()</code> 查询 MySQL 中的数据库表。查询在 MySQL 中执行，并使用 R 语言 <code>fetch()</code> 函数返回结果集。最后，它被存储为 R 语言中的数据框。</p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r"><span class="token comment"># Query the "tbl" tables to get all the rows.</span>result <span class="token operator">=</span> dbSendQuery<span class="token punctuation">(</span>conn<span class="token punctuation">,</span> <span class="token string">"SELECT * FROM tbl"</span><span class="token punctuation">)</span><span class="token comment"># Store the result in a R data frame object. n = 6 is used to fetch first 6 rows.</span>data.frame <span class="token operator">=</span> fetch<span class="token punctuation">(</span>result<span class="token punctuation">,</span> n <span class="token operator">=</span> <span class="token number">6</span><span class="token punctuation">)</span>print<span class="token punctuation">(</span>data.frame<span class="token punctuation">)</span><span class="token comment"># 当我们执行上面的代码，它产生以下结果：</span>  id       title author submission_date<span class="token number">1</span>  <span class="token number">1</span>    学习 PHP    PHP      <span class="token number">2021</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">12</span><span class="token number">2</span>  <span class="token number">2</span>  学习 MySQL  MySQL      <span class="token number">2021</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">12</span><span class="token number">3</span>  <span class="token number">3</span>    学习 C<span class="token operator">+</span><span class="token operator">+</span>    C<span class="token operator">+</span><span class="token operator">+</span>      <span class="token number">2021</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">01</span><span class="token number">4</span>  <span class="token number">4</span> 学习 Python Python      <span class="token number">2021</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">01</span><span class="token number">5</span>  <span class="token number">5</span>  MySQL 教程  MySQL      <span class="token number">2021</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">12</span><span class="token number">6</span>  <span class="token number">6</span>   JAVA 教程   JAVA      <span class="token number">2021</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">12</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p><strong>带过滤条件的查询</strong></p><p>我们可以传递任何有效的 <code>SELECT</code> 查询来获取结果。</p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r"><span class="token comment"># Query the "tbl" tables to get all the rows with author equal to 'MySQL'.</span>result <span class="token operator">=</span> dbSendQuery<span class="token punctuation">(</span>conn<span class="token punctuation">,</span> <span class="token string">"SELECT * FROM tbl WHERE author = 'MySQL'"</span><span class="token punctuation">)</span><span class="token comment"># Fetch all the records and store it as a data frame.</span>data.frame <span class="token operator">=</span> fetch<span class="token punctuation">(</span>result<span class="token punctuation">)</span>print<span class="token punctuation">(</span>data.frame<span class="token punctuation">)</span><span class="token comment"># 当我们执行上面的代码，它产生以下结果：</span>  id      title author submission_date<span class="token number">1</span>  <span class="token number">2</span> 学习 MySQL  MySQL      <span class="token number">2021</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">12</span><span class="token number">2</span>  <span class="token number">5</span> MySQL 教程  MySQL      <span class="token number">2021</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">12</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h2 id="更新表数据"><a href="#更新表数据" class="headerlink" title="更新表数据"></a>更新表数据</h2><p>我们可以通过将更新查询传递给 <code>dbSendQuery()</code> 函数来更新 MySQL 表中的行。</p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r"><span class="token comment"># Query the "tbl" tables to get the rows with id equal to 1.</span>result <span class="token operator">=</span> dbSendQuery<span class="token punctuation">(</span>conn<span class="token punctuation">,</span> <span class="token string">"SELECT * FROM tbl WHERE id = 1"</span><span class="token punctuation">)</span><span class="token comment"># Fetch all the records and store it as a data frame.</span>data.frame <span class="token operator">=</span> fetch<span class="token punctuation">(</span>result<span class="token punctuation">)</span>print<span class="token punctuation">(</span>data.frame<span class="token punctuation">)</span><span class="token comment"># Update the record with id equal to 1.</span>dbSendQuery<span class="token punctuation">(</span>conn<span class="token punctuation">,</span> <span class="token string">"UPDATE tbl SET submission_date = '2000-01-12' WHERE id = 1"</span><span class="token punctuation">)</span><span class="token comment"># Query the "tbl" tables to get the rows with id equal to 1.</span>result <span class="token operator">=</span> dbSendQuery<span class="token punctuation">(</span>conn<span class="token punctuation">,</span> <span class="token string">"SELECT * FROM tbl WHERE id = 1"</span><span class="token punctuation">)</span><span class="token comment"># Fetch all the records and store it as a data frame.</span>data.frame <span class="token operator">=</span> fetch<span class="token punctuation">(</span>result<span class="token punctuation">)</span>print<span class="token punctuation">(</span>data.frame<span class="token punctuation">)</span><span class="token comment"># 在执行上面的代码后，我们可以看到在 MySQL 环境中更新的表。</span>  id    title author submission_date<span class="token number">1</span>  <span class="token number">1</span> 学习 PHP    PHP      <span class="token number">2021</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">12</span>  id    title author submission_date<span class="token number">1</span>  <span class="token number">1</span> 学习 PHP    PHP      <span class="token number">2000</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">12</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h2 id="向表插入数据"><a href="#向表插入数据" class="headerlink" title="向表插入数据"></a>向表插入数据</h2><p><pre class="line-numbers language-r" data-language="r"><code class="language-r"><span class="token comment"># Insert data to the "tbl" tables</span>dbSendQuery<span class="token punctuation">(</span>conn<span class="token punctuation">,</span>   <span class="token string">"INSERT INTO tbl (title, author, submission_date) VALUES('学习 R', 'R', '2021-01-22')"</span><span class="token punctuation">)</span><span class="token comment"># Query the "tbl" tables to get all the rows.</span>result <span class="token operator">=</span> dbSendQuery<span class="token punctuation">(</span>conn<span class="token punctuation">,</span> <span class="token string">"SELECT * FROM tbl"</span><span class="token punctuation">)</span><span class="token comment"># Fetch all the records and store it as a data frame.</span>data.frame <span class="token operator">=</span> fetch<span class="token punctuation">(</span>result<span class="token punctuation">)</span>print<span class="token punctuation">(</span>data.frame<span class="token punctuation">)</span><span class="token comment"># 在执行上面的代码后，我们可以看到插入到 MySQL 环境中的表中的行。</span>  id       title author submission_date<span class="token number">1</span>  <span class="token number">1</span>    学习 PHP    PHP      <span class="token number">2000</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">12</span><span class="token number">2</span>  <span class="token number">2</span>  学习 MySQL  MySQL      <span class="token number">2021</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">12</span><span class="token number">3</span>  <span class="token number">3</span>    学习 C<span class="token operator">+</span><span class="token operator">+</span>    C<span class="token operator">+</span><span class="token operator">+</span>      <span class="token number">2021</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">01</span><span class="token number">4</span>  <span class="token number">4</span> 学习 Python Python      <span class="token number">2021</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">01</span><span class="token number">5</span>  <span class="token number">5</span>  MySQL 教程  MySQL      <span class="token number">2021</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">12</span><span class="token number">6</span>  <span class="token number">6</span>   JAVA 教程   JAVA      <span class="token number">2021</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">12</span><span class="token number">7</span>  <span class="token number">7</span>      学习 R      R      <span class="token number">2021</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">22</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h2 id="创建表"><a href="#创建表" class="headerlink" title="创建表"></a>创建表</h2><p>我们可以在 MySQL 中使用函数 <code>dbWriteTable()</code> 创建表。如果表已经存在，它将覆盖该表，并将数据框用作输入。</p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r"><span class="token comment"># Create the connection object to the database where we want to create the table.</span>conn <span class="token operator">=</span> dbConnect<span class="token punctuation">(</span>MySQL<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> user <span class="token operator">=</span> <span class="token string">'root'</span><span class="token punctuation">,</span> password <span class="token operator">=</span> <span class="token string">'root'</span><span class="token punctuation">,</span> dbname <span class="token operator">=</span> <span class="token string">'testdb'</span><span class="token punctuation">,</span> host <span class="token operator">=</span> <span class="token string">'localhost'</span><span class="token punctuation">,</span> port <span class="token operator">=</span> <span class="token string">'3306'</span><span class="token punctuation">)</span><span class="token comment"># Use the R data frame "mtcars" to create the table in MySQL.</span><span class="token comment"># All the rows of mtcars are taken inot MySQL.</span>dbWriteTable<span class="token punctuation">(</span>conn<span class="token punctuation">,</span> <span class="token string">"mtcars"</span><span class="token punctuation">,</span> mtcars<span class="token punctuation">[</span><span class="token punctuation">,</span> <span class="token punctuation">]</span><span class="token punctuation">,</span> overwrite <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">)</span><span class="token comment"># List the tables available in this database.</span>dbListTables<span class="token punctuation">(</span>conn<span class="token punctuation">)</span><span class="token comment"># Query the "mtcars" tables to get the rows</span>result <span class="token operator">=</span> dbSendQuery<span class="token punctuation">(</span>conn<span class="token punctuation">,</span> <span class="token string">"SELECT * FROM mtcars"</span><span class="token punctuation">)</span><span class="token comment"># Fetch all the records and store it as a data frame.</span>data.frame <span class="token operator">=</span> fetch<span class="token punctuation">(</span>result<span class="token punctuation">)</span>print<span class="token punctuation">(</span>data.frame<span class="token punctuation">)</span><span class="token comment"># 执行上面的代码后，我们可以看到在 MySQL 环境中创建的表。</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token boolean">TRUE</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token string">"employee_tbl"</span>    <span class="token string">"tbl"</span>    <span class="token string">"tcount_tbl"</span>    <span class="token string">"transaction_test"</span>             row_names  mpg cyl  disp  hp drat    wt  qsec vs am gear carb<span class="token number">1</span>            Mazda RX4 <span class="token number">21.0</span>   <span class="token number">6</span> <span class="token number">160.0</span> <span class="token number">110</span> <span class="token number">3.90</span> <span class="token number">2.620</span> <span class="token number">16.46</span>  <span class="token number">0</span>  <span class="token number">1</span>    <span class="token number">4</span>    <span class="token number">4</span><span class="token number">2</span>        Mazda RX4 Wag <span class="token number">21.0</span>   <span class="token number">6</span> <span class="token number">160.0</span> <span class="token number">110</span> <span class="token number">3.90</span> <span class="token number">2.875</span> <span class="token number">17.02</span>  <span class="token number">0</span>  <span class="token number">1</span>    <span class="token number">4</span>    <span class="token number">4</span><span class="token number">3</span>           Datsun <span class="token number">710</span> <span class="token number">22.8</span>   <span class="token number">4</span> <span class="token number">108.0</span>  <span class="token number">93</span> <span class="token number">3.85</span> <span class="token number">2.320</span> <span class="token number">18.61</span>  <span class="token number">1</span>  <span class="token number">1</span>    <span class="token number">4</span>    <span class="token number">1</span><span class="token number">4</span>       Hornet <span class="token number">4</span> Drive <span class="token number">21.4</span>   <span class="token number">6</span> <span class="token number">258.0</span> <span class="token number">110</span> <span class="token number">3.08</span> <span class="token number">3.215</span> <span class="token number">19.44</span>  <span class="token number">1</span>  <span class="token number">0</span>    <span class="token number">3</span>    <span class="token number">1</span><span class="token number">5</span>    Hornet Sportabout <span class="token number">18.7</span>   <span class="token number">8</span> <span class="token number">360.0</span> <span class="token number">175</span> <span class="token number">3.15</span> <span class="token number">3.440</span> <span class="token number">17.02</span>  <span class="token number">0</span>  <span class="token number">0</span>    <span class="token number">3</span>    <span class="token number">2</span><span class="token number">6</span>              Valiant <span class="token number">18.1</span>   <span class="token number">6</span> <span class="token number">225.0</span> <span class="token number">105</span> <span class="token number">2.76</span> <span class="token number">3.460</span> <span class="token number">20.22</span>  <span class="token number">1</span>  <span class="token number">0</span>    <span class="token number">3</span>    <span class="token number">1</span><span class="token number">7</span>           Duster <span class="token number">360</span> <span class="token number">14.3</span>   <span class="token number">8</span> <span class="token number">360.0</span> <span class="token number">245</span> <span class="token number">3.21</span> <span class="token number">3.570</span> <span class="token number">15.84</span>  <span class="token number">0</span>  <span class="token number">0</span>    <span class="token number">3</span>    <span class="token number">4</span><span class="token number">8</span>            Merc <span class="token number">240</span>D <span class="token number">24.4</span>   <span class="token number">4</span> <span class="token number">146.7</span>  <span class="token number">62</span> <span class="token number">3.69</span> <span class="token number">3.190</span> <span class="token number">20.00</span>  <span class="token number">1</span>  <span class="token number">0</span>    <span class="token number">4</span>    <span class="token number">2</span><span class="token number">9</span>             Merc <span class="token number">230</span> <span class="token number">22.8</span>   <span class="token number">4</span> <span class="token number">140.8</span>  <span class="token number">95</span> <span class="token number">3.92</span> <span class="token number">3.150</span> <span class="token number">22.90</span>  <span class="token number">1</span>  <span class="token number">0</span>    <span class="token number">4</span>    <span class="token number">2</span><span class="token number">10</span>            Merc <span class="token number">280</span> <span class="token number">19.2</span>   <span class="token number">6</span> <span class="token number">167.6</span> <span class="token number">123</span> <span class="token number">3.92</span> <span class="token number">3.440</span> <span class="token number">18.30</span>  <span class="token number">1</span>  <span class="token number">0</span>    <span class="token number">4</span>    <span class="token number">4</span><span class="token number">11</span>           Merc <span class="token number">280</span>C <span class="token number">17.8</span>   <span class="token number">6</span> <span class="token number">167.6</span> <span class="token number">123</span> <span class="token number">3.92</span> <span class="token number">3.440</span> <span class="token number">18.90</span>  <span class="token number">1</span>  <span class="token number">0</span>    <span class="token number">4</span>    <span class="token number">4</span><span class="token number">12</span>          Merc <span class="token number">450</span>SE <span class="token number">16.4</span>   <span class="token number">8</span> <span class="token number">275.8</span> <span class="token number">180</span> <span class="token number">3.07</span> <span class="token number">4.070</span> <span class="token number">17.40</span>  <span class="token number">0</span>  <span class="token number">0</span>    <span class="token number">3</span>    <span class="token number">3</span><span class="token number">13</span>          Merc <span class="token number">450</span>SL <span class="token number">17.3</span>   <span class="token number">8</span> <span class="token number">275.8</span> <span class="token number">180</span> <span class="token number">3.07</span> <span class="token number">3.730</span> <span class="token number">17.60</span>  <span class="token number">0</span>  <span class="token number">0</span>    <span class="token number">3</span>    <span class="token number">3</span><span class="token number">14</span>         Merc <span class="token number">450</span>SLC <span class="token number">15.2</span>   <span class="token number">8</span> <span class="token number">275.8</span> <span class="token number">180</span> <span class="token number">3.07</span> <span class="token number">3.780</span> <span class="token number">18.00</span>  <span class="token number">0</span>  <span class="token number">0</span>    <span class="token number">3</span>    <span class="token number">3</span><span class="token number">15</span>  Cadillac Fleetwood <span class="token number">10.4</span>   <span class="token number">8</span> <span class="token number">472.0</span> <span class="token number">205</span> <span class="token number">2.93</span> <span class="token number">5.250</span> <span class="token number">17.98</span>  <span class="token number">0</span>  <span class="token number">0</span>    <span class="token number">3</span>    <span class="token number">4</span><span class="token number">16</span> Lincoln Continental <span class="token number">10.4</span>   <span class="token number">8</span> <span class="token number">460.0</span> <span class="token number">215</span> <span class="token number">3.00</span> <span class="token number">5.424</span> <span class="token number">17.82</span>  <span class="token number">0</span>  <span class="token number">0</span>    <span class="token number">3</span>    <span class="token number">4</span><span class="token number">17</span>   Chrysler Imperial <span class="token number">14.7</span>   <span class="token number">8</span> <span class="token number">440.0</span> <span class="token number">230</span> <span class="token number">3.23</span> <span class="token number">5.345</span> <span class="token number">17.42</span>  <span class="token number">0</span>  <span class="token number">0</span>    <span class="token number">3</span>    <span class="token number">4</span><span class="token number">18</span>            Fiat <span class="token number">128</span> <span class="token number">32.4</span>   <span class="token number">4</span>  <span class="token number">78.7</span>  <span class="token number">66</span> <span class="token number">4.08</span> <span class="token number">2.200</span> <span class="token number">19.47</span>  <span class="token number">1</span>  <span class="token number">1</span>    <span class="token number">4</span>    <span class="token number">1</span><span class="token number">19</span>         Honda Civic <span class="token number">30.4</span>   <span class="token number">4</span>  <span class="token number">75.7</span>  <span class="token number">52</span> <span class="token number">4.93</span> <span class="token number">1.615</span> <span class="token number">18.52</span>  <span class="token number">1</span>  <span class="token number">1</span>    <span class="token number">4</span>    <span class="token number">2</span><span class="token number">20</span>      Toyota Corolla <span class="token number">33.9</span>   <span class="token number">4</span>  <span class="token number">71.1</span>  <span class="token number">65</span> <span class="token number">4.22</span> <span class="token number">1.835</span> <span class="token number">19.90</span>  <span class="token number">1</span>  <span class="token number">1</span>    <span class="token number">4</span>    <span class="token number">1</span><span class="token number">21</span>       Toyota Corona <span class="token number">21.5</span>   <span class="token number">4</span> <span class="token number">120.1</span>  <span class="token number">97</span> <span class="token number">3.70</span> <span class="token number">2.465</span> <span class="token number">20.01</span>  <span class="token number">1</span>  <span class="token number">0</span>    <span class="token number">3</span>    <span class="token number">1</span><span class="token number">22</span>    Dodge Challenger <span class="token number">15.5</span>   <span class="token number">8</span> <span class="token number">318.0</span> <span class="token number">150</span> <span class="token number">2.76</span> <span class="token number">3.520</span> <span class="token number">16.87</span>  <span class="token number">0</span>  <span class="token number">0</span>    <span class="token number">3</span>    <span class="token number">2</span><span class="token number">23</span>         AMC Javelin <span class="token number">15.2</span>   <span class="token number">8</span> <span class="token number">304.0</span> <span class="token number">150</span> <span class="token number">3.15</span> <span class="token number">3.435</span> <span class="token number">17.30</span>  <span class="token number">0</span>  <span class="token number">0</span>    <span class="token number">3</span>    <span class="token number">2</span><span class="token number">24</span>          Camaro Z28 <span class="token number">13.3</span>   <span class="token number">8</span> <span class="token number">350.0</span> <span class="token number">245</span> <span class="token number">3.73</span> <span class="token number">3.840</span> <span class="token number">15.41</span>  <span class="token number">0</span>  <span class="token number">0</span>    <span class="token number">3</span>    <span class="token number">4</span><span class="token number">25</span>    Pontiac Firebird <span class="token number">19.2</span>   <span class="token number">8</span> <span class="token number">400.0</span> <span class="token number">175</span> <span class="token number">3.08</span> <span class="token number">3.845</span> <span class="token number">17.05</span>  <span class="token number">0</span>  <span class="token number">0</span>    <span class="token number">3</span>    <span class="token number">2</span><span class="token number">26</span>           Fiat X1<span class="token operator">-</span><span class="token number">9</span> <span class="token number">27.3</span>   <span class="token number">4</span>  <span class="token number">79.0</span>  <span class="token number">66</span> <span class="token number">4.08</span> <span class="token number">1.935</span> <span class="token number">18.90</span>  <span class="token number">1</span>  <span class="token number">1</span>    <span class="token number">4</span>    <span class="token number">1</span><span class="token number">27</span>       Porsche <span class="token number">914</span><span class="token operator">-</span><span class="token number">2</span> <span class="token number">26.0</span>   <span class="token number">4</span> <span class="token number">120.3</span>  <span class="token number">91</span> <span class="token number">4.43</span> <span class="token number">2.140</span> <span class="token number">16.70</span>  <span class="token number">0</span>  <span class="token number">1</span>    <span class="token number">5</span>    <span class="token number">2</span><span class="token number">28</span>        Lotus Europa <span class="token number">30.4</span>   <span class="token number">4</span>  <span class="token number">95.1</span> <span class="token number">113</span> <span class="token number">3.77</span> <span class="token number">1.513</span> <span class="token number">16.90</span>  <span class="token number">1</span>  <span class="token number">1</span>    <span class="token number">5</span>    <span class="token number">2</span><span class="token number">29</span>      Ford Pantera L <span class="token number">15.8</span>   <span class="token number">8</span> <span class="token number">351.0</span> <span class="token number">264</span> <span class="token number">4.22</span> <span class="token number">3.170</span> <span class="token number">14.50</span>  <span class="token number">0</span>  <span class="token number">1</span>    <span class="token number">5</span>    <span class="token number">4</span><span class="token number">30</span>        Ferrari Dino <span class="token number">19.7</span>   <span class="token number">6</span> <span class="token number">145.0</span> <span class="token number">175</span> <span class="token number">3.62</span> <span class="token number">2.770</span> <span class="token number">15.50</span>  <span class="token number">0</span>  <span class="token number">1</span>    <span class="token number">5</span>    <span class="token number">6</span><span class="token number">31</span>       Maserati Bora <span class="token number">15.0</span>   <span class="token number">8</span> <span class="token number">301.0</span> <span class="token number">335</span> <span class="token number">3.54</span> <span class="token number">3.570</span> <span class="token number">14.60</span>  <span class="token number">0</span>  <span class="token number">1</span>    <span class="token number">5</span>    <span class="token number">8</span><span class="token number">32</span>          Volvo <span class="token number">142</span>E <span class="token number">21.4</span>   <span class="token number">4</span> <span class="token number">121.0</span> <span class="token number">109</span> <span class="token number">4.11</span> <span class="token number">2.780</span> <span class="token number">18.60</span>  <span class="token number">1</span>  <span class="token number">1</span>    <span class="token number">4</span>    <span class="token number">2</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h2 id="删除表"><a href="#删除表" class="headerlink" title="删除表"></a>删除表</h2><p>我们可以删除 MySQL 数据库中的表，将 <code>DROP TABLE</code> 语句传递到 <code>dbSendQuery()</code> 中，就像我们使用它查询表中的数据一样。</p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r"><span class="token comment"># List the tables available in this database.</span>dbListTables<span class="token punctuation">(</span>conn<span class="token punctuation">)</span><span class="token comment"># Delete the "mtcars" table.</span>dbSendQuery<span class="token punctuation">(</span>conn<span class="token punctuation">,</span> <span class="token string">'DROP TABLE IF EXISTS mtcars'</span><span class="token punctuation">)</span><span class="token comment"># List the tables available in this database.</span>dbListTables<span class="token punctuation">(</span>conn<span class="token punctuation">)</span><span class="token comment"># 执行上面的代码后，我们可以看到表在MySQL环境中被删除。</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token string">"employee_tbl"</span>     <span class="token string">"mtcars"</span>           <span class="token string">"tbl"</span>              <span class="token string">"tcount_tbl"</span>       <span class="token string">"transaction_test"</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token string">"employee_tbl"</span>     <span class="token string">"tbl"</span>              <span class="token string">"tcount_tbl"</span>       <span class="token string">"transaction_test"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p>]]></content>
      
      
      <categories>
          
          <category> 教程笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 大数据 </tag>
            
            <tag> R </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>R 语言图表</title>
      <link href="post/b35ac98a.html"/>
      <url>post/b35ac98a.html</url>
      
        <content type="html"><![CDATA[<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>R 提供了非常丰富的绘图功能，可以通过命令：<code>demo(graphics)</code>（二维图表） 或者 <code>demo(persp)</code>（三维图表）来体验 R 绘图功能的强大。</p><p>图形工具是 R 环境的一个重要组成部分。R 提供了多种绘图相关的命令，分成三类：</p><ul><li><strong>高级绘图命令</strong>：在图形设备上产生一个新的图区，它可能包括坐标轴，标签，标题等等。</li><li><strong>低级绘图命令</strong>：在一个已经存在的图上加上更多的图形元素，如额外的点，线和标签。</li><li><strong>交互式图形命令</strong>：允许交互式地用鼠标在一个已经存在的图上添加图形信息或者提取图形信息。</li></ul><p>下面介绍 R 的常用图表。</p><h1 id="条形图"><a href="#条形图" class="headerlink" title="条形图"></a>条形图</h1><p>条形图表示矩形条中的数据，条的长度与变量的值成比例。R 语言使用函数 <code>barplot()</code> 创建条形图。R 语言可以在条形图中绘制垂直和水平条。在条形图中，每个条可以给予不同的颜色。</p><h2 id="语法"><a href="#语法" class="headerlink" title="语法"></a>语法</h2><p>在 R 语言中创建条形图的基本语法是：</p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r">barplot<span class="token punctuation">(</span>H<span class="token punctuation">,</span> xlab<span class="token punctuation">,</span> ylab<span class="token punctuation">,</span> main<span class="token punctuation">,</span> names.arg<span class="token punctuation">,</span> col<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><p>以下是所使用的参数的说明：</p><ul><li><code>H</code> 是包含在条形图中使用的数值的向量或矩阵。</li><li><code>xlab</code> 是 <code>x</code> 轴的标签。</li><li><code>ylab</code> 是 <code>y</code> 轴的标签。</li><li><code>main</code> 是条形图的标题。</li><li><code>names.arg</code> 是在每个条下出现的名称的向量。</li><li><code>col</code> 用于向图中的条形提供颜色。</li></ul><h2 id="创建条形图"><a href="#创建条形图" class="headerlink" title="创建条形图"></a>创建条形图</h2><p>使用输入向量和每个条的名称创建一个简单的条形图。</p><p>以下脚本将创建并保存当前 R 语言工作目录中的条形图。</p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r"><span class="token comment"># Create the data for the chart.</span>H <span class="token operator">&lt;-</span> c<span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">28</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">41</span><span class="token punctuation">)</span><span class="token comment"># Give the chart file a name.</span>png<span class="token punctuation">(</span>file <span class="token operator">=</span> <span class="token string">"barchart.png"</span><span class="token punctuation">)</span><span class="token comment"># Plot the bar chart.</span>barplot<span class="token punctuation">(</span>H<span class="token punctuation">)</span><span class="token comment"># Save the file.</span>dev.off<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p>当我们执行上面的代码，它产生以下结果：</p><p><img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="/images/post/r_chart/barchart.png" alt></p><h2 id="条形图标签，标题和颜色"><a href="#条形图标签，标题和颜色" class="headerlink" title="条形图标签，标题和颜色"></a>条形图标签，标题和颜色</h2><p>可以通过添加更多参数来扩展条形图的功能。主要参数用于添加标题。<code>col</code> 参数用于向条形添加颜色。<code>name.args</code> 是具有与输入向量相同数量的值的向量，以描述每个条的含义。</p><p>以下脚本将在当前 R 语言工作目录中创建并保存条形图。</p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r"><span class="token comment"># Create the data for the chart.</span>H <span class="token operator">&lt;-</span> c<span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">28</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">41</span><span class="token punctuation">)</span>M <span class="token operator">&lt;-</span> c<span class="token punctuation">(</span><span class="token string">"Mar"</span><span class="token punctuation">,</span> <span class="token string">"Apr"</span><span class="token punctuation">,</span> <span class="token string">"May"</span><span class="token punctuation">,</span> <span class="token string">"Jun"</span><span class="token punctuation">,</span> <span class="token string">"Jul"</span><span class="token punctuation">)</span><span class="token comment"># Give the chart file a name.</span>png<span class="token punctuation">(</span>file <span class="token operator">=</span> <span class="token string">"barchart_months_revenue.png"</span><span class="token punctuation">)</span><span class="token comment"># Plot the bar chart.</span>barplot<span class="token punctuation">(</span>H<span class="token punctuation">,</span> names.arg <span class="token operator">=</span> M<span class="token punctuation">,</span> xlab <span class="token operator">=</span> <span class="token string">"Month"</span><span class="token punctuation">,</span> ylab <span class="token operator">=</span> <span class="token string">"Revenue"</span><span class="token punctuation">,</span> col <span class="token operator">=</span> <span class="token string">"blue"</span><span class="token punctuation">,</span> main <span class="token operator">=</span> <span class="token string">"Revenue chart"</span><span class="token punctuation">,</span> border <span class="token operator">=</span> <span class="token string">"red"</span><span class="token punctuation">)</span><span class="token comment"># Save the file.</span>dev.off<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p>当我们执行上面的代码，它产生以下结果：</p><p><img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="/images/post/r_chart/barchart_months_revenue.png" alt></p><h2 id="组合条形图和堆积条形图"><a href="#组合条形图和堆积条形图" class="headerlink" title="组合条形图和堆积条形图"></a>组合条形图和堆积条形图</h2><p>我们可以使用矩阵作为输入值，在每个条中创建条形图和堆叠组的条形图。</p><p>超过两个变量表示为用于创建组合条形图和堆叠条形图的矩阵。</p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r"><span class="token comment"># Create the input vectors.</span>colors <span class="token operator">&lt;-</span> c<span class="token punctuation">(</span><span class="token string">"green"</span><span class="token punctuation">,</span> <span class="token string">"orange"</span><span class="token punctuation">,</span> <span class="token string">"brown"</span><span class="token punctuation">)</span>months <span class="token operator">&lt;-</span> c<span class="token punctuation">(</span><span class="token string">"Mar"</span><span class="token punctuation">,</span> <span class="token string">"Apr"</span><span class="token punctuation">,</span> <span class="token string">"May"</span><span class="token punctuation">,</span> <span class="token string">"Jun"</span><span class="token punctuation">,</span> <span class="token string">"Jul"</span><span class="token punctuation">)</span>regions <span class="token operator">&lt;-</span> c<span class="token punctuation">(</span><span class="token string">"East"</span><span class="token punctuation">,</span> <span class="token string">"West"</span><span class="token punctuation">,</span> <span class="token string">"North"</span><span class="token punctuation">)</span><span class="token comment"># Create the matrix of the values.</span>Values <span class="token operator">&lt;-</span> matrix<span class="token punctuation">(</span>c<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">,</span> nrow <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">,</span> ncol <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">,</span> byrow <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">)</span><span class="token comment"># Give the chart file a name.</span>png<span class="token punctuation">(</span>file <span class="token operator">=</span> <span class="token string">"barchart_stacked.png"</span><span class="token punctuation">)</span><span class="token comment"># Create the bar chart.</span>barplot<span class="token punctuation">(</span>Values<span class="token punctuation">,</span> main <span class="token operator">=</span> <span class="token string">"total revenue"</span><span class="token punctuation">,</span> names.arg <span class="token operator">=</span> months<span class="token punctuation">,</span> xlab <span class="token operator">=</span> <span class="token string">"month"</span><span class="token punctuation">,</span> ylab <span class="token operator">=</span> <span class="token string">"revenue"</span><span class="token punctuation">,</span> col <span class="token operator">=</span> colors<span class="token punctuation">)</span><span class="token comment"># Add the legend to the chart.</span>legend<span class="token punctuation">(</span><span class="token string">"topleft"</span><span class="token punctuation">,</span> regions<span class="token punctuation">,</span> cex <span class="token operator">=</span> <span class="token number">1.3</span><span class="token punctuation">,</span> fill <span class="token operator">=</span> colors<span class="token punctuation">)</span><span class="token comment"># Save the file.</span>dev.off<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p>当我们执行上面的代码，它产生以下结果：</p><p><img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="/images/post/r_chart/barchart_stacked.png" alt></p><h1 id="箱线图"><a href="#箱线图" class="headerlink" title="箱线图"></a>箱线图</h1><p>箱线图是数据集中的数据分布良好的度量。它将数据集分成三个四分位数。此图表表示数据集中的最小值，最大值，中值，第一四分位数和第三四分位数。它还可用于通过绘制每个数据集的箱线图来比较数据集之间的数据分布。</p><p>R 语言中使用 <code>boxplot()</code> 函数来创建箱线图。</p><h2 id="语法-1"><a href="#语法-1" class="headerlink" title="语法"></a>语法</h2><p>在 R 语言中创建箱线图的基本语法是：</p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r">boxplot<span class="token punctuation">(</span>x<span class="token punctuation">,</span> data<span class="token punctuation">,</span> notch<span class="token punctuation">,</span> varwidth<span class="token punctuation">,</span> names<span class="token punctuation">,</span> main<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><p>以下是所使用的参数的说明：</p><ul><li><code>x</code> 是向量或公式。</li><li><code>data</code> 是数据框。</li><li><code>notch</code> 是逻辑值。设置为 <code>TRUE</code> 以绘制凹口。</li><li><code>varwidth</code> 是一个逻辑值。设置为 <code>TRUE</code> 以绘制与样本大小成比例的框的宽度。</li><li><code>names</code> 是将打印在每个箱线图下的组标签。</li><li><code>main</code> 用于给图表标题。</li></ul><p>我们使用 R 语言环境中可用的数据集 <code>mtcars</code> 来创建基本箱线图。让我们看看 <code>mtcars</code> 中的列 <code>mpg</code> 和 <code>cyl</code>。</p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r">input <span class="token operator">&lt;-</span> mtcars<span class="token punctuation">[</span><span class="token punctuation">,</span> c<span class="token punctuation">(</span><span class="token string">'mpg'</span><span class="token punctuation">,</span> <span class="token string">'cyl'</span><span class="token punctuation">)</span><span class="token punctuation">]</span>print<span class="token punctuation">(</span>head<span class="token punctuation">(</span>input<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment"># 当我们执行上面的代码，它产生以下结果：</span>                   mpg  cylMazda RX4         <span class="token number">21.0</span>   <span class="token number">6</span>Mazda RX4 Wag     <span class="token number">21.0</span>   <span class="token number">6</span>Datsun <span class="token number">710</span>        <span class="token number">22.8</span>   <span class="token number">4</span>Hornet <span class="token number">4</span> Drive    <span class="token number">21.4</span>   <span class="token number">6</span>Hornet Sportabout <span class="token number">18.7</span>   <span class="token number">8</span>Valiant           <span class="token number">18.1</span>   <span class="token number">6</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h2 id="创建箱线图"><a href="#创建箱线图" class="headerlink" title="创建箱线图"></a>创建箱线图</h2><p>以下脚本将为 <code>mpg</code>（英里 / 加仑）和 <code>cyl</code>（气缸数）之间的关系创建箱线图。</p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r"><span class="token comment"># Give the chart file a name.</span>png<span class="token punctuation">(</span>file <span class="token operator">=</span> <span class="token string">"boxplot.png"</span><span class="token punctuation">)</span><span class="token comment"># Plot the chart.</span>boxplot<span class="token punctuation">(</span>mpg <span class="token operator">~</span> cyl<span class="token punctuation">,</span> data <span class="token operator">=</span> mtcars<span class="token punctuation">,</span> xlab <span class="token operator">=</span> <span class="token string">"Number of Cylinders"</span><span class="token punctuation">,</span> ylab <span class="token operator">=</span> <span class="token string">"Miles Per Gallon"</span><span class="token punctuation">,</span> main <span class="token operator">=</span> <span class="token string">"Mileage Data"</span><span class="token punctuation">)</span><span class="token comment"># Save the file.</span>dev.off<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p>当我们执行上面的代码，它产生以下结果：</p><p><img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="/images/post/r_chart/boxplot.png" alt></p><h2 id="带槽的箱线图"><a href="#带槽的箱线图" class="headerlink" title="带槽的箱线图"></a>带槽的箱线图</h2><p>我们可以绘制带槽的箱线图，以了解不同数据组的中值如何相互匹配。以下脚本将为每个数据组创建一个带缺口的箱线图。</p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r"><span class="token comment"># Give the chart file a name.</span>png<span class="token punctuation">(</span>file <span class="token operator">=</span> <span class="token string">"boxplot_with_notch.png"</span><span class="token punctuation">)</span><span class="token comment"># Plot the chart.</span>boxplot<span class="token punctuation">(</span>mpg <span class="token operator">~</span> cyl<span class="token punctuation">,</span> data <span class="token operator">=</span> mtcars<span class="token punctuation">,</span> xlab <span class="token operator">=</span> <span class="token string">"Number of Cylinders"</span><span class="token punctuation">,</span> ylab <span class="token operator">=</span> <span class="token string">"Miles Per Gallon"</span><span class="token punctuation">,</span> main <span class="token operator">=</span> <span class="token string">"Mileage Data"</span><span class="token punctuation">,</span> notch <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">,</span> varwidth <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">,</span> col <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token string">"green"</span><span class="token punctuation">,</span> <span class="token string">"yellow"</span><span class="token punctuation">,</span> <span class="token string">"purple"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> names <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token string">"High"</span><span class="token punctuation">,</span> <span class="token string">"Medium"</span><span class="token punctuation">,</span> <span class="token string">"Low"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment"># Save the file.</span>dev.off<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p>当我们执行上面的代码，它产生以下结果：</p><p><img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="/images/post/r_chart/boxplot_with_notch.png" alt></p><h1 id="直方图"><a href="#直方图" class="headerlink" title="直方图"></a>直方图</h1><p>直方图表示被存储到范围中的变量的值的频率。直方图类似于条形图，但不同之处在于将值分组为连续范围。直方图中的每个柱表示该范围中存在的值的数量的高度。</p><p>R 语言使用 <code>hist()</code> 函数创建直方图。此函数使用向量作为输入，并使用一些更多的参数来绘制直方图。</p><h2 id="语法-2"><a href="#语法-2" class="headerlink" title="语法"></a>语法</h2><p>使用 R 语言创建直方图的基本语法是：</p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r">hist<span class="token punctuation">(</span>v<span class="token punctuation">,</span> main<span class="token punctuation">,</span> xlab<span class="token punctuation">,</span> xlim<span class="token punctuation">,</span> ylim<span class="token punctuation">,</span> breaks<span class="token punctuation">,</span> col<span class="token punctuation">,</span> border<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><p>以下是所使用的参数的说明：</p><ul><li><code>v</code> 是包含直方图中使用的数值的向量。</li><li><code>main</code> 表示图表的标题。</li><li><code>col</code> 用于设置条的颜色。</li><li><code>border</code> 用于设置每个条的边框颜色。</li><li><code>xlab</code> 用于给出 <code>x</code> 轴的描述。</li><li><code>xlim</code> 用于指定 <code>x</code> 轴上的值的范围。</li><li><code>ylim</code> 用于指定 <code>y</code> 轴上的值的范围。</li><li><code>break</code> 用于提及每个条的宽度。</li></ul><h2 id="创建直方图"><a href="#创建直方图" class="headerlink" title="创建直方图"></a>创建直方图</h2><p>使用输入 <code>vector</code>，<code>label</code>，<code>col</code> 和边界参数创建一个简单的直方图。</p><p>下面给出的脚本将创建并保存当前R 语言工作目录中的直方图。</p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r"><span class="token comment"># Create data for the graph.</span>v <span class="token operator">&lt;-</span> c<span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">21</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">36</span><span class="token punctuation">,</span> <span class="token number">22</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">41</span><span class="token punctuation">,</span> <span class="token number">31</span><span class="token punctuation">,</span> <span class="token number">33</span><span class="token punctuation">,</span> <span class="token number">19</span><span class="token punctuation">)</span><span class="token comment"># Give the chart file a name.</span>png<span class="token punctuation">(</span>file <span class="token operator">=</span> <span class="token string">"histogram.png"</span><span class="token punctuation">)</span><span class="token comment"># Create the histogram.</span>hist<span class="token punctuation">(</span>v<span class="token punctuation">,</span> xlab <span class="token operator">=</span> <span class="token string">"Weight"</span><span class="token punctuation">,</span> col <span class="token operator">=</span> <span class="token string">"yellow"</span><span class="token punctuation">,</span> border <span class="token operator">=</span> <span class="token string">"blue"</span><span class="token punctuation">)</span><span class="token comment"># Save the file.</span>dev.off<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p>当我们执行上面的代码，它产生以下结果：</p><p><img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="/images/post/r_chart/histogram.png" alt></p><h2 id="X-和-Y-值的范围"><a href="#X-和-Y-值的范围" class="headerlink" title="X 和 Y 值的范围"></a>X 和 Y 值的范围</h2><p>要指定 X 轴和 Y 轴允许的值的范围，我们可以使用 <code>xlim</code> 和 <code>ylim</code> 参数。</p><p>每个条的宽度可以通过使用间隔来确定。</p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r"><span class="token comment"># Create data for the graph.</span>v <span class="token operator">&lt;-</span> c<span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">21</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">36</span><span class="token punctuation">,</span> <span class="token number">22</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">41</span><span class="token punctuation">,</span> <span class="token number">31</span><span class="token punctuation">,</span> <span class="token number">33</span><span class="token punctuation">,</span> <span class="token number">19</span><span class="token punctuation">)</span><span class="token comment"># Give the chart file a name.</span>png<span class="token punctuation">(</span>file <span class="token operator">=</span> <span class="token string">"histogram_lim_breaks.png"</span><span class="token punctuation">)</span><span class="token comment"># Create the histogram.</span>hist<span class="token punctuation">(</span>v<span class="token punctuation">,</span> xlab <span class="token operator">=</span> <span class="token string">"Weight"</span><span class="token punctuation">,</span> col <span class="token operator">=</span> <span class="token string">"green"</span><span class="token punctuation">,</span> border <span class="token operator">=</span> <span class="token string">"red"</span><span class="token punctuation">,</span> xlim <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ylim <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span> breaks <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token comment"># Save the file.</span>dev.off<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p>当我们执行上面的代码，它产生以下结果：</p><p><img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="/images/post/r_chart/histogram_lim_breaks.png" alt></p><h1 id="折线图"><a href="#折线图" class="headerlink" title="折线图"></a>折线图</h1><p>折线图是通过在它们之间绘制线段来连接一系列点的图。这些点在它们的坐标（通常是 X 坐标）值之一中排序。折线图通常用于识别数据中的趋势。</p><p>R 语言中的 <code>plot()</code> 函数用于创建折线图。</p><h2 id="语法-3"><a href="#语法-3" class="headerlink" title="语法"></a>语法</h2><p>在 R 语言中创建折线图的基本语法是：</p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r">plot<span class="token punctuation">(</span>v<span class="token punctuation">,</span> type<span class="token punctuation">,</span> col<span class="token punctuation">,</span> xlab<span class="token punctuation">,</span> ylab<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><p>以下是所使用的参数的说明：</p><ul><li><code>v</code> 是包含数值的向量。</li><li><code>type</code> 采用值 <code>p</code> 仅绘制点，<code>l</code> 仅绘制线和 <code>o</code> 绘制点和线。</li><li><code>xlab</code> 是x轴的标签。</li><li><code>ylab</code> 是y轴的标签。</li><li><code>main</code> 是图表的标题。</li><li><code>col</code> 用于给点和线的颜色。</li></ul><h2 id="创建折线图"><a href="#创建折线图" class="headerlink" title="创建折线图"></a>创建折线图</h2><p>使用输入向量和类型参数 <code>o</code> 创建简单的折线图。以下脚本将在当前 R 工作目录中创建并保存折线图。</p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r"><span class="token comment"># Create the data for the chart.</span>v <span class="token operator">&lt;-</span> c<span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">28</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">41</span><span class="token punctuation">)</span><span class="token comment"># Give the chart file a name.</span>png<span class="token punctuation">(</span>file <span class="token operator">=</span> <span class="token string">"line_chart.png"</span><span class="token punctuation">)</span><span class="token comment"># Plot the bar chart. </span>plot<span class="token punctuation">(</span>v<span class="token punctuation">,</span> type <span class="token operator">=</span> <span class="token string">"o"</span><span class="token punctuation">)</span><span class="token comment"># Save the file.</span>dev.off<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p>当我们执行上面的代码，它产生以下结果：</p><p><img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="/images/post/r_chart/line_chart.png" alt></p><h2 id="折线图标题，颜色和标签"><a href="#折线图标题，颜色和标签" class="headerlink" title="折线图标题，颜色和标签"></a>折线图标题，颜色和标签</h2><p>线图的特征可以通过使用附加参数来扩展。我们向点和线添加颜色，为图表添加标题，并向轴添加标签。</p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r"><span class="token comment"># Create the data for the chart.</span>v <span class="token operator">&lt;-</span> c<span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">28</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">41</span><span class="token punctuation">)</span><span class="token comment"># Give the chart file a name.</span>png<span class="token punctuation">(</span>file <span class="token operator">=</span> <span class="token string">"line_chart_label_colored.png"</span><span class="token punctuation">)</span><span class="token comment"># Plot the bar chart.</span>plot<span class="token punctuation">(</span>v<span class="token punctuation">,</span> type <span class="token operator">=</span> <span class="token string">"o"</span><span class="token punctuation">,</span> col <span class="token operator">=</span> <span class="token string">"red"</span><span class="token punctuation">,</span> xlab <span class="token operator">=</span> <span class="token string">"Month"</span><span class="token punctuation">,</span> ylab <span class="token operator">=</span> <span class="token string">"Rain fall"</span><span class="token punctuation">,</span> main <span class="token operator">=</span> <span class="token string">"Rain fall chart"</span><span class="token punctuation">)</span><span class="token comment"># Save the file.</span>dev.off<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p>当我们执行上面的代码，它产生以下结果：</p><p><img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="/images/post/r_chart/line_chart_label_colored.png" alt></p><h2 id="多线型折线图"><a href="#多线型折线图" class="headerlink" title="多线型折线图"></a>多线型折线图</h2><p>通过使用 <code>lines()</code> 函数，可以在同一个图表上绘制多条线。</p><p>在绘制第一行之后，<code>lines()</code> 函数可以使用一个额外的向量作为输入来绘制图表中的第二行。</p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r"><span class="token comment"># Create the data for the chart.</span>v <span class="token operator">&lt;-</span> c<span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">28</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">41</span><span class="token punctuation">)</span>t <span class="token operator">&lt;-</span> c<span class="token punctuation">(</span><span class="token number">14</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">19</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token comment"># Give the chart file a name.</span>png<span class="token punctuation">(</span>file <span class="token operator">=</span> <span class="token string">"line_chart_2_lines.png"</span><span class="token punctuation">)</span><span class="token comment"># Plot the bar chart.</span>plot<span class="token punctuation">(</span>v<span class="token punctuation">,</span> type <span class="token operator">=</span> <span class="token string">"o"</span><span class="token punctuation">,</span> col <span class="token operator">=</span> <span class="token string">"red"</span><span class="token punctuation">,</span> xlab <span class="token operator">=</span> <span class="token string">"Month"</span><span class="token punctuation">,</span> ylab <span class="token operator">=</span> <span class="token string">"Rain fall"</span><span class="token punctuation">,</span> main <span class="token operator">=</span> <span class="token string">"Rain fall chart"</span><span class="token punctuation">)</span>lines<span class="token punctuation">(</span>t<span class="token punctuation">,</span> type <span class="token operator">=</span> <span class="token string">"o"</span><span class="token punctuation">,</span> col <span class="token operator">=</span> <span class="token string">"blue"</span><span class="token punctuation">)</span><span class="token comment"># Save the file.</span>dev.off<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p>当我们执行上面的代码，它产生以下结果：</p><p><img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="/images/post/r_chart/line_chart_2_lines.png" alt></p><h1 id="散点图"><a href="#散点图" class="headerlink" title="散点图"></a>散点图</h1><p>散点图显示在笛卡尔平面中绘制的许多点。每个点表示两个变量的值。在水平轴上选择一个变量，在垂直轴上选择另一个变量。</p><p>R 语言使用 <code>plot()</code> 函数创建简单散点图。</p><h2 id="语法-4"><a href="#语法-4" class="headerlink" title="语法"></a>语法</h2><p>在 R 语言中创建散点图的基本语法是：</p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r">plot<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> main<span class="token punctuation">,</span> xlab<span class="token punctuation">,</span> ylab<span class="token punctuation">,</span> xlim<span class="token punctuation">,</span> ylim<span class="token punctuation">,</span> axes<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><p>以下是所使用的参数的说明：</p><ul><li><code>x</code> 是其值为水平坐标的数据集。</li><li><code>y</code> 是其值是垂直坐标的数据集。</li><li><code>main</code> 要是图形的图块。</li><li><code>xlab</code> 是水平轴上的标签。</li><li><code>ylab</code> 是垂直轴上的标签。</li><li><code>xlim</code> 是用于绘图的 <code>x</code> 的值的极限。</li><li><code>ylim</code> 是用于绘图的 <code>y</code> 的值的极限。</li><li><code>axes</code> 指示是否应在绘图上绘制两个轴。</li></ul><h2 id="创建散点图"><a href="#创建散点图" class="headerlink" title="创建散点图"></a>创建散点图</h2><p>我们使用 R 语言环境中可用的数据集 <code>mtcars</code> 来创建基本散点图。让我们使用 <code>mtcars</code> 中的 <code>wt</code> 和 <code>mpg</code> 列。</p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r">input <span class="token operator">&lt;-</span> mtcars<span class="token punctuation">[</span><span class="token punctuation">,</span> c<span class="token punctuation">(</span><span class="token string">'wt'</span><span class="token punctuation">,</span> <span class="token string">'mpg'</span><span class="token punctuation">)</span><span class="token punctuation">]</span>print<span class="token punctuation">(</span>head<span class="token punctuation">(</span>input<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment"># 当我们执行上面的代码，它产生以下结果：</span>                    wt      mpgMazda RX4           <span class="token number">2.620</span>   <span class="token number">21.0</span>Mazda RX4 Wag       <span class="token number">2.875</span>   <span class="token number">21.0</span>Datsun <span class="token number">710</span>          <span class="token number">2.320</span>   <span class="token number">22.8</span>Hornet <span class="token number">4</span> Drive      <span class="token number">3.215</span>   <span class="token number">21.4</span>Hornet Sportabout   <span class="token number">3.440</span>   <span class="token number">18.7</span>Valiant             <span class="token number">3.460</span>   <span class="token number">18.1</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p>以下脚本将为 <code>wt</code>（重量）和 <code>mpg</code>（英里/加仑）之间的关系创建一个散点图。</p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r"><span class="token comment"># Get the input values.</span>input <span class="token operator">&lt;-</span> mtcars<span class="token punctuation">[</span><span class="token punctuation">,</span> c<span class="token punctuation">(</span><span class="token string">'wt'</span><span class="token punctuation">,</span> <span class="token string">'mpg'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token comment"># Give the chart file a name.</span>png<span class="token punctuation">(</span>file <span class="token operator">=</span> <span class="token string">"scatterplot.png"</span><span class="token punctuation">)</span><span class="token comment"># Plot the chart for cars with weight between 2.5 to 5 and mileage between 15 and 30.</span>plot<span class="token punctuation">(</span>x <span class="token operator">=</span> input<span class="token operator">$</span>wt<span class="token punctuation">,</span> y <span class="token operator">=</span> input<span class="token operator">$</span>mpg<span class="token punctuation">,</span> xlab <span class="token operator">=</span> <span class="token string">"Weight"</span><span class="token punctuation">,</span> ylab <span class="token operator">=</span> <span class="token string">"Milage"</span><span class="token punctuation">,</span> xlim <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token number">2.5</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ylim <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">,</span> main <span class="token operator">=</span> <span class="token string">"Weight vs Milage"</span><span class="token punctuation">)</span><span class="token comment"># Save the file.</span>dev.off<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p>当我们执行上面的代码，它产生以下结果：</p><p><img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="/images/post/r_chart/scatterplot.png" alt></p><h2 id="散点图矩阵"><a href="#散点图矩阵" class="headerlink" title="散点图矩阵"></a>散点图矩阵</h2><p>当我们有两个以上的变量，我们想找到一个变量和其余变量之间的相关性，我们使用散点图矩阵。我们使用 <code>pairs()</code> 函数创建散点图的矩阵。</p><h3 id="语法-5"><a href="#语法-5" class="headerlink" title="语法"></a>语法</h3><p>在 R 中创建散点图矩阵的基本语法是：</p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r">pairs<span class="token punctuation">(</span>formula<span class="token punctuation">,</span> data<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><p>以下是所使用的参数的说明：</p><ul><li><code>formula</code> 表示成对使用的一系列变量。</li><li><code>data</code> 表示将从其获取变量的数据集。</li></ul><h3 id="创建散点图矩阵"><a href="#创建散点图矩阵" class="headerlink" title="创建散点图矩阵"></a>创建散点图矩阵</h3><p>每个变量与每个剩余变量配对。为每对绘制散点图。</p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r"><span class="token comment"># Give the chart file a name.</span>png<span class="token punctuation">(</span>file <span class="token operator">=</span> <span class="token string">"scatterplot_matrices.png"</span><span class="token punctuation">)</span><span class="token comment"># Plot the matrices between 4 variables giving 12 plots.</span><span class="token comment"># One variable with 3 others and total 4 variables.</span>pairs<span class="token punctuation">(</span><span class="token operator">~</span>wt <span class="token operator">+</span> mpg <span class="token operator">+</span> disp <span class="token operator">+</span> cyl<span class="token punctuation">,</span> data <span class="token operator">=</span> mtcars<span class="token punctuation">,</span> main <span class="token operator">=</span> <span class="token string">"Scatterplot Matrix"</span><span class="token punctuation">)</span><span class="token comment"># Save the file.</span>dev.off<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p>当执行上面的代码中，我们得到以下输出。</p><p><img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="/images/post/r_chart/scatterplot_matrices.png" alt></p><h1 id="饼状图"><a href="#饼状图" class="headerlink" title="饼状图"></a>饼状图</h1><p>R 编程语言有许多库来创建图表和图表。饼图是将值表示为具有不同颜色的圆的切片。切片被标记，并且对应于每个片的数字也在图表中表示。</p><p>在 R 语言中，饼图是使用 <code>pie()</code> 函数创建的，它使用正数作为向量输入。附加参数用于控制标签，颜色，标题等。</p><h2 id="语法-6"><a href="#语法-6" class="headerlink" title="语法"></a>语法</h2><p>使用 R 语言创建饼图的基本语法是：</p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r">pie<span class="token punctuation">(</span>x<span class="token punctuation">,</span> labels<span class="token punctuation">,</span> radius<span class="token punctuation">,</span> main<span class="token punctuation">,</span> col<span class="token punctuation">,</span> clockwise<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><p>以下是所使用的参数的说明：</p><ul><li><code>x</code> 是包含饼图中使用的数值的向量。</li><li><code>labels</code> 用于给出切片的描述。</li><li><code>radius</code> 表示饼图圆的半径（值 <code>-1</code> 和 <code>+1</code> 之间）。</li><li><code>main</code> 表示图表的标题。</li><li><code>col</code> 表示调色板。</li><li><code>clockwise</code> 是指示片段是顺时针还是逆时针绘制的逻辑值。</li></ul><h2 id="创建饼状图"><a href="#创建饼状图" class="headerlink" title="创建饼状图"></a>创建饼状图</h2><p>使用输入向量和标签创建一个非常简单的饼图。以下脚本将创建并保存当前 R 语言工作目录中的饼图。</p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r"><span class="token comment"># Create data for the graph.</span>x <span class="token operator">&lt;-</span> c<span class="token punctuation">(</span><span class="token number">21</span><span class="token punctuation">,</span> <span class="token number">62</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">53</span><span class="token punctuation">)</span>labels <span class="token operator">&lt;-</span> c<span class="token punctuation">(</span><span class="token string">"London"</span><span class="token punctuation">,</span> <span class="token string">"New York"</span><span class="token punctuation">,</span> <span class="token string">"Singapore"</span><span class="token punctuation">,</span> <span class="token string">"Mumbai"</span><span class="token punctuation">)</span><span class="token comment"># Give the chart file a name.</span>png<span class="token punctuation">(</span>file <span class="token operator">=</span> <span class="token string">"pie.png"</span><span class="token punctuation">)</span><span class="token comment"># Plot the chart.</span>pie<span class="token punctuation">(</span>x<span class="token punctuation">,</span> labels<span class="token punctuation">)</span><span class="token comment"># Save the file.</span>dev.off<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p>当我们执行上面的代码，它产生以下结果：</p><p><img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="/images/post/r_chart/pie.png" alt></p><h2 id="饼图标题和颜色"><a href="#饼图标题和颜色" class="headerlink" title="饼图标题和颜色"></a>饼图标题和颜色</h2><p>我们可以通过向函数中添加更多参数来扩展图表的功能。我们将使用参数 <code>main</code> 向图表添加标题，另一个参数是 <code>col</code>，它将在绘制图表时使用彩虹色板。托盘的长度应与图表中的值的数量相同。因此，我们使用 <code>length(x)</code>。</p><p>以下脚本将创建并保存当前 R 语言工作目录中的饼图。</p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r"><span class="token comment"># Create data for the graph.</span>x <span class="token operator">&lt;-</span> c<span class="token punctuation">(</span><span class="token number">21</span><span class="token punctuation">,</span> <span class="token number">62</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">53</span><span class="token punctuation">)</span>labels <span class="token operator">&lt;-</span> c<span class="token punctuation">(</span><span class="token string">"London"</span><span class="token punctuation">,</span> <span class="token string">"New York"</span><span class="token punctuation">,</span> <span class="token string">"Singapore"</span><span class="token punctuation">,</span> <span class="token string">"Mumbai"</span><span class="token punctuation">)</span><span class="token comment"># Give the chart file a name.</span>png<span class="token punctuation">(</span>file <span class="token operator">=</span> <span class="token string">"pie_title_colours.png"</span><span class="token punctuation">)</span><span class="token comment"># Plot the chart with title and rainbow color pallet.</span>pie<span class="token punctuation">(</span>x<span class="token punctuation">,</span> labels<span class="token punctuation">,</span> main <span class="token operator">=</span> <span class="token string">"City pie chart"</span><span class="token punctuation">,</span> col <span class="token operator">=</span> rainbow<span class="token punctuation">(</span>length<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment"># Save the file.</span>dev.off<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p>当我们执行上面的代码，它产生以下结果：</p><p><img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="/images/post/r_chart/pie_title_colours.png" alt></p><h2 id="切片百分比和图表图例"><a href="#切片百分比和图表图例" class="headerlink" title="切片百分比和图表图例"></a>切片百分比和图表图例</h2><p>我们可以通过创建其他图表变量来添加切片百分比和图表图例。</p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r"><span class="token comment"># Create data for the graph.</span>x <span class="token operator">&lt;-</span> c<span class="token punctuation">(</span><span class="token number">21</span><span class="token punctuation">,</span> <span class="token number">62</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">53</span><span class="token punctuation">)</span>labels <span class="token operator">&lt;-</span> c<span class="token punctuation">(</span><span class="token string">"London"</span><span class="token punctuation">,</span> <span class="token string">"New York"</span><span class="token punctuation">,</span> <span class="token string">"Singapore"</span><span class="token punctuation">,</span> <span class="token string">"Mumbai"</span><span class="token punctuation">)</span>piepercent<span class="token operator">&lt;-</span> round<span class="token punctuation">(</span><span class="token number">100</span><span class="token operator">*</span>x<span class="token operator">/</span>sum<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token comment"># Give the chart file a name.</span>png<span class="token punctuation">(</span>file <span class="token operator">=</span> <span class="token string">"pie_percentage_legends.png"</span><span class="token punctuation">)</span><span class="token comment"># Plot the chart.</span>pie<span class="token punctuation">(</span>x<span class="token punctuation">,</span> labels <span class="token operator">=</span> piepercent<span class="token punctuation">,</span> main <span class="token operator">=</span> <span class="token string">"City pie chart"</span><span class="token punctuation">,</span> col <span class="token operator">=</span> rainbow<span class="token punctuation">(</span>length<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> legend<span class="token punctuation">(</span><span class="token string">"topright"</span><span class="token punctuation">,</span> c<span class="token punctuation">(</span><span class="token string">"London"</span><span class="token punctuation">,</span> <span class="token string">"New York"</span><span class="token punctuation">,</span> <span class="token string">"Singapore"</span><span class="token punctuation">,</span> <span class="token string">"Mumbai"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> cex <span class="token operator">=</span> <span class="token number">0.8</span><span class="token punctuation">,</span> fill <span class="token operator">=</span> rainbow<span class="token punctuation">(</span>length<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment"># Save the file.</span>dev.off<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p>当我们执行上面的代码，它产生以下结果：</p><p><img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="/images/post/r_chart/pie_percentage_legends.png" alt></p><h2 id="3D饼图"><a href="#3D饼图" class="headerlink" title="3D饼图"></a>3D饼图</h2><p>可以使用其他软件包绘制具有 3 个维度的饼图。软件包 <code>plotrix</code> 有一个名为 <code>pie3D()</code> 的函数，用于此。</p><p>如果没有安装 <code>plotrix</code> 包可以使用 <code>install.packages(&quot;plotrix&quot;)</code> 语句安装。</p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r"><span class="token comment"># Get the library.</span>library<span class="token punctuation">(</span>plotrix<span class="token punctuation">)</span><span class="token comment"># Create data for the graph.</span>x <span class="token operator">&lt;-</span> c<span class="token punctuation">(</span><span class="token number">21</span><span class="token punctuation">,</span> <span class="token number">62</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">53</span><span class="token punctuation">)</span>lbl <span class="token operator">&lt;-</span> c<span class="token punctuation">(</span><span class="token string">"London"</span><span class="token punctuation">,</span> <span class="token string">"New York"</span><span class="token punctuation">,</span> <span class="token string">"Singapore"</span><span class="token punctuation">,</span> <span class="token string">"Mumbai"</span><span class="token punctuation">)</span><span class="token comment"># Give the chart file a name.</span>png<span class="token punctuation">(</span>file <span class="token operator">=</span> <span class="token string">"3d_pie_chart.png"</span><span class="token punctuation">)</span><span class="token comment"># Plot the chart.</span>pie3D<span class="token punctuation">(</span>x<span class="token punctuation">,</span> labels <span class="token operator">=</span> lbl<span class="token punctuation">,</span> explode <span class="token operator">=</span> <span class="token number">0.1</span><span class="token punctuation">,</span> main <span class="token operator">=</span> <span class="token string">"Pie Chart of Countries"</span><span class="token punctuation">)</span><span class="token comment"># Save the file.</span>dev.off<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p>当我们执行上面的代码，它产生以下结果：</p><p><img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="/images/post/r_chart/3d_pie_chart.png" alt></p>]]></content>
      
      
      <categories>
          
          <category> 教程笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 大数据 </tag>
            
            <tag> R </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>R 语言教程</title>
      <link href="post/de0e67e.html"/>
      <url>post/de0e67e.html</url>
      
        <content type="html"><![CDATA[<h1 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h1><h2 id="R-的简介"><a href="#R-的简介" class="headerlink" title="R 的简介"></a>R 的简介</h2><ul><li>R 语言是用于统计分析，图形表示和报告的编程语言和软件环境。R 语言由 Ross Ihaka 和 Robert Gentleman 在新西兰奥克兰大学创建，目前由 R 语言开发核心团队开发。</li><li>R 语言的核心是解释计算机语言，其允许分支和循环以及使用函数的模块化编程。R 语言允许与以 C，C ++，.Net，Python 或 FORTRAN 语言编写的过程集成以提高效率。</li><li>R 语言在 GNU 通用公共许可证下免费提供，并为各种操作系统（如 Linux，Windows 和 Mac）提供预编译的二进制版本。</li><li>R 是一个在 GNU 风格的副本左侧的自由软件，GNU 项目的官方部分叫做 GNU S.</li></ul><h2 id="R-的演变"><a href="#R-的演变" class="headerlink" title="R 的演变"></a>R 的演变</h2><p>R 语言最初是由新西兰奥克兰奥克兰大学统计系的 Ross Ihaka 和 Robert Gentleman 写的。R 语言于 1993 年首次亮相。</p><ul><li>一大群人通过发送代码和错误报告对 R 做出了贡献。</li><li>自 1997 年年中以来，已经有一个核心组（R 核心团队）可以修改 R 源代码归档。</li></ul><h2 id="R-的特点"><a href="#R-的特点" class="headerlink" title="R 的特点"></a>R 的特点</h2><p>如前所述，R 语言是用于统计分析，图形表示和报告的编程语言和软件环境。以下是 R 语言的重要特点：</p><ul><li>R 语言是一种开发良好，简单有效的编程语言，包括条件，循环，用户定义的递归函数以及输入和输出设施。</li><li>R 语言具有有效的数据处理和存储设施，</li><li>R 语言提供了一套用于数组，列表，向量和矩阵计算的运算符。</li><li>R 语言为数据分析提供了大型，一致和集成的工具集合。</li><li>R 语言提供直接在计算机上或在纸张上打印的图形设施用于数据分析和显示。</li></ul><p>R 语言是世界上最广泛使用的统计编程语言。它是数据科学家的第一选择，并由一个充满活力和有才华的贡献者社区支持。</p><h1 id="基本语法"><a href="#基本语法" class="headerlink" title="基本语法"></a>基本语法</h1><p>根据需要，您可以在 R 语言命令提示符处编程，也可以使用 R 语言脚本文件编写程序。</p><h2 id="命令提示符"><a href="#命令提示符" class="headerlink" title="命令提示符"></a>命令提示符</h2><p>如果你已经配置好 R 语言环境，那么你只需要按一下的命令便可轻易开启命令提示符</p><p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">$ R<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><p>这将启动 R 语言解释器，你会得到一个提示 <code>&gt;</code> 在那里你可以开始输入你的程序，具体如下。</p><p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">&gt; myString &lt;- &quot;Hello, World!&quot;&gt; print(myString)[1] &quot;Hello, World!&quot;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></p><p>在这里，第一个语句先定义一个字符串变量 <code>myString</code>，并将 <code>Hello，World！</code> 赋值其中，第二句则使用 <code>print()</code> 语句将变量 <code>myString</code> 的内容进行打印。</p><h2 id="脚本文件"><a href="#脚本文件" class="headerlink" title="脚本文件"></a>脚本文件</h2><p>通常，您将通过在脚本文件中编写程序来执行编程，然后在命令提示符下使用 R 解释器（称为 <code>Rscript</code>）来执行这些脚本。所以让我们开始在一个命名为 <code>test.R</code> 的文本文件中编写下面的代码</p><p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"># My first program in R ProgrammingmyString &lt;- &quot;Hello, World!&quot;print(myString)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></p><p>将上述代码保存在 <code>test.R</code> 文件中，并在 Linux 命令提示符下执行，如下所示。即使您使用的是 Windows 或其他系统，语法也将保持不变。</p><p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">$ Rscript test.R <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><p>当我们运行上面的程序，它产生以下结果：<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[1] &quot;Hello, World!&quot;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><h2 id="注释"><a href="#注释" class="headerlink" title="注释"></a>注释</h2><p>注释能帮助您解释 R 语言程序中的脚本，它们在实际执行程序时会被解释器忽略。单个注释使用 <code>#</code> 在语句的开头写入，如下所示</p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r"><span class="token comment"># My first program in R Programming</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><p>R 语言不支持多行注释，但你可以使用一个小技巧，如下</p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r"><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token boolean">FALSE</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>   "This is a demo <span class="token keyword">for</span> multi<span class="token operator">-</span>line comments and it should be put inside either a single      OR double quote"<span class="token punctuation">&#125;</span>myString <span class="token operator">&lt;-</span> <span class="token string">"Hello, World!"</span>print<span class="token punctuation">(</span>myString<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p>虽然上面的注释将由 R 解释器执行，但它们不会干扰您的实际程序。但是你必须为内容加上单引号或双引号。</p><h1 id="数据类型"><a href="#数据类型" class="headerlink" title="数据类型"></a>数据类型</h1><p>通常，在使用任何编程语言进行编程时，您需要使用各种变量来存储各种信息。变量只是保留值的存储位置。这意味着，当你创建一个变量，你必须在内存中保留一些空间来存储它们。</p><p>您可能想存储各种数据类型的信息，如字符，宽字符，整数，浮点，双浮点，布尔等。基于变量的数据类型，操作系统分配内存并决定什么可以存储在保留内存中。</p><p>与其他编程语言（如 C 中的 C 和 Java）相反，变量不会声明为某种数据类型。变量分配有 R 对象，R 对象的数据类型变为变量的数据类型。尽管有很多类型的 R 对象，但经常使用的是：</p><ul><li><a href="#Vectors-向量">Vectors 向量</a></li><li><a href="#Lists-列表">Lists 列表</a></li><li><a href="#Matrices-矩阵">Matrices 矩阵</a></li><li><a href="#Arrays-数组">Arrays 数组</a></li><li><a href="#Factors-因子">Factors 因子</a></li><li><a href="#Data-Frames-数据框">Data Frames 数据框</a></li></ul><p>这些对象中最简单的是向量对象，并且这些原子向量有六种数据类型，也称为六类向量。其他 R 对象建立在原子向量之上。</p><div class="table-container"><table><thead><tr><th style="text-align:center">数据类型</th><th style="text-align:center">取值</th><th style="text-align:left">实例</th></tr></thead><tbody><tr><td style="text-align:center">Logical（逻辑型）</td><td style="text-align:center">TRUE, FALSE</td><td style="text-align:left"><code>v &lt;- TRUE</code> <br> <code>print(class(v))</code> <br> <code>[1] &quot;logical&quot;</code></td></tr><tr><td style="text-align:center">Numeric（数字）</td><td style="text-align:center">12.3，5，999</td><td style="text-align:left"><code>v &lt;- 23.5</code> <br> <code>print(class(v))</code> <br> <code>[1] &quot;numeric&quot;</code></td></tr><tr><td style="text-align:center">Integer（整型）</td><td style="text-align:center">2L，34L，0L</td><td style="text-align:left"><code>v &lt;- 2L</code> <br> <code>print(class(v))</code> <br> <code>[1] &quot;integer&quot;</code></td></tr><tr><td style="text-align:center">Complex（复合型）</td><td style="text-align:center">3 + 2i</td><td style="text-align:left"><code>v &lt;- 2+5i</code> <br> <code>print(class(v))</code> <br> <code>[1] &quot;complex&quot;</code></td></tr><tr><td style="text-align:center">Character（字符）</td><td style="text-align:center">&#39;a&#39; , &quot;good&quot;, &quot;TRUE&quot;, &#39;23.4&#39;</td><td style="text-align:left"><code>v &lt;- &quot;TRUE&quot;</code> <br> <code>print(class(v))</code> <br> <code>[1] &quot;character&quot;</code></td></tr><tr><td style="text-align:center">Raw（原型）</td><td style="text-align:center">&quot;Hello&quot; 被存储为 48 65 6c 6c 6f</td><td style="text-align:left"><code>v &lt;- charToRaw(&quot;Hello&quot;)</code> <br> <code>print(class(v))</code> <br> <code>[1] &quot;raw&quot;</code></td></tr></tbody></table></div><p>在 R 编程中，非常基本的数据类型是称为向量的 R 对象，其保存如上所示的不同类的元素。请注意，在 R 中，类的数量不仅限于上述六种类型。例如，我们可以使用许多原子向量并创建一个数组，其类将成为数组。</p><h2 id="Vectors-向量"><a href="#Vectors-向量" class="headerlink" title="Vectors 向量"></a>Vectors 向量</h2><p>当你想用多个元素创建向量时，你应该使用 <code>c()</code> 函数，这意味着将元素组合成一个向量。</p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r"><span class="token comment"># Create a vector.</span>apple <span class="token operator">&lt;-</span> c<span class="token punctuation">(</span><span class="token string">"red"</span><span class="token punctuation">,</span> <span class="token string">"green"</span><span class="token punctuation">,</span> <span class="token string">"yellow"</span><span class="token punctuation">)</span>print<span class="token punctuation">(</span>apple<span class="token punctuation">)</span><span class="token comment"># Get the class of the vector.</span>print<span class="token punctuation">(</span>class<span class="token punctuation">(</span>apple<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment"># 当我们执行上面的代码，它产生以下结果：</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token string">"red"</span>    <span class="token string">"green"</span>  <span class="token string">"yellow"</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token string">"character"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p>更多方法实例请点击查看 R 语言<a href="#向量">向量</a>章节。</p><h2 id="Lists-列表"><a href="#Lists-列表" class="headerlink" title="Lists 列表"></a>Lists 列表</h2><p>列表是一个 R 对象，它可以在其中包含许多不同类型的元素，如向量，函数甚至其中的另一个列表。</p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r"><span class="token comment"># Create a list.</span>list1 <span class="token operator">&lt;-</span> list<span class="token punctuation">(</span>c<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">21.3</span><span class="token punctuation">,</span> sin<span class="token punctuation">)</span><span class="token comment"># Print the list.</span>print<span class="token punctuation">(</span>list1<span class="token punctuation">)</span><span class="token comment"># 当我们执行上面的代码，它产生以下结果：</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token number">2</span> <span class="token number">5</span> <span class="token number">3</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token number">21.3</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token keyword">function</span> <span class="token punctuation">(</span>x<span class="token punctuation">)</span>  .Primitive<span class="token punctuation">(</span><span class="token string">"sin"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p>更多方法实例请点击查看 R 语言<a href="#列表">列表</a>章节。</p><h2 id="Matrices-矩阵"><a href="#Matrices-矩阵" class="headerlink" title="Matrices 矩阵"></a>Matrices 矩阵</h2><p>矩阵是二维矩形数据集。它可以使用矩阵函数的向量输入创建。</p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r"><span class="token comment"># Create a matrix.</span>M <span class="token operator">=</span> matrix<span class="token punctuation">(</span> c<span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">,</span> <span class="token string">'c'</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">,</span> <span class="token string">'a'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> nrow <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span> ncol <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">,</span> byrow <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">)</span>print<span class="token punctuation">(</span>M<span class="token punctuation">)</span><span class="token comment"># 当我们执行上面的代码，它产生以下结果：</span>     <span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token punctuation">]</span> <span class="token string">"a"</span>  <span class="token string">"a"</span>  <span class="token string">"b"</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token punctuation">]</span> <span class="token string">"c"</span>  <span class="token string">"b"</span>  <span class="token string">"a"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p>更多方法实例请点击查看 R 语言<a href="#矩阵">矩阵</a>章节。</p><h2 id="Arrays-数组"><a href="#Arrays-数组" class="headerlink" title="Arrays 数组"></a>Arrays 数组</h2><p>虽然矩阵被限制为二维，但阵列可以具有任何数量的维度。数组函数使用一个 <code>dim</code> 属性创建所需的维数。在下面的例子中，我们创建了一个包含两个元素的数组，每个元素为 <code>3x3</code> 个矩阵。</p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r"><span class="token comment"># Create an array.</span>a <span class="token operator">&lt;-</span> array<span class="token punctuation">(</span>c<span class="token punctuation">(</span><span class="token string">'green'</span><span class="token punctuation">,</span> <span class="token string">'yellow'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> dim <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>print<span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token comment"># 当我们执行上面的代码，它产生以下结果：</span><span class="token punctuation">,</span> <span class="token punctuation">,</span> <span class="token number">1</span>     <span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span>     <span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span>     <span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span>    <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token punctuation">]</span> <span class="token string">"green"</span>  <span class="token string">"yellow"</span> <span class="token string">"green"</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token punctuation">]</span> <span class="token string">"yellow"</span> <span class="token string">"green"</span>  <span class="token string">"yellow"</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token punctuation">]</span> <span class="token string">"green"</span>  <span class="token string">"yellow"</span> <span class="token string">"green"</span> <span class="token punctuation">,</span> <span class="token punctuation">,</span> <span class="token number">2</span>     <span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span>     <span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span>     <span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span>    <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token punctuation">]</span> <span class="token string">"yellow"</span> <span class="token string">"green"</span>  <span class="token string">"yellow"</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token punctuation">]</span> <span class="token string">"green"</span>  <span class="token string">"yellow"</span> <span class="token string">"green"</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token punctuation">]</span> <span class="token string">"yellow"</span> <span class="token string">"green"</span>  <span class="token string">"yellow"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p>更多方法实例请点击查看 R 语言<a href="#数组">数组</a>章节。</p><h2 id="Factors-因子"><a href="#Factors-因子" class="headerlink" title="Factors 因子"></a>Factors 因子</h2><p>因子是使用向量创建的 R 对象。它将向量与向量中元素的不同值一起存储为标签。标签总是字符，不管它在输入向量中是数字还是字符或布尔等。它们在统计建模中非常有用。使用 <code>factor()</code> 函数创建因子。<code>nlevels</code> 函数给出级别计数。</p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r"><span class="token comment"># Create a vector.</span>apple_colors <span class="token operator">&lt;-</span> c<span class="token punctuation">(</span><span class="token string">'green'</span><span class="token punctuation">,</span> <span class="token string">'green'</span><span class="token punctuation">,</span> <span class="token string">'yellow'</span><span class="token punctuation">,</span> <span class="token string">'red'</span><span class="token punctuation">,</span> <span class="token string">'red'</span><span class="token punctuation">,</span> <span class="token string">'red'</span><span class="token punctuation">,</span> <span class="token string">'green'</span><span class="token punctuation">)</span><span class="token comment"># Create a factor object.</span>factor_apple <span class="token operator">&lt;-</span> factor<span class="token punctuation">(</span>apple_colors<span class="token punctuation">)</span><span class="token comment"># Print the factor.</span>print<span class="token punctuation">(</span>factor_apple<span class="token punctuation">)</span>print<span class="token punctuation">(</span>nlevels<span class="token punctuation">(</span>factor_apple<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment"># 当我们执行上面的代码，它产生以下结果：</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> green  green  yellow  red   red   red   green Levels<span class="token operator">:</span> green red yellow<span class="token comment"># applying the nlevels function we can know the number of distinct values</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token number">3</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p>更多方法实例请点击查看 R 语言<a href="#因子">因子</a>章节。</p><h2 id="Data-Frames-数据框"><a href="#Data-Frames-数据框" class="headerlink" title="Data Frames 数据框"></a>Data Frames 数据框</h2><p>数据框是表格数据对象。与数据框中的矩阵不同，每列可以包含不同的数据模式。第一列可以是数字，而第二列可以是字符，第三列可以是逻辑的。它是等长度的向量的列表。使用 <code>data.frame()</code> 函数创建数据框。</p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r"><span class="token comment"># Create the data frame.</span>BMI <span class="token operator">&lt;-</span>  <span class="token operator">|</span> data.frame<span class="token punctuation">(</span>   gender <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token string">"Male"</span><span class="token punctuation">,</span> <span class="token string">"Male"</span><span class="token punctuation">,</span> <span class="token string">"Female"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>   height <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token number">152</span><span class="token punctuation">,</span> <span class="token number">171.5</span><span class="token punctuation">,</span> <span class="token number">165</span><span class="token punctuation">)</span><span class="token punctuation">,</span>   weight <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token number">81</span><span class="token punctuation">,</span> <span class="token number">93</span><span class="token punctuation">,</span> <span class="token number">78</span><span class="token punctuation">)</span><span class="token punctuation">,</span>   Age <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token number">42</span><span class="token punctuation">,</span> <span class="token number">38</span><span class="token punctuation">,</span> <span class="token number">26</span><span class="token punctuation">)</span><span class="token punctuation">)</span>print<span class="token punctuation">(</span>BMI<span class="token punctuation">)</span><span class="token comment"># 当我们执行上面的代码，它产生以下结果：</span>  gender height weight Age<span class="token number">1</span>   Male  <span class="token number">152.0</span>     <span class="token number">81</span>  <span class="token number">42</span><span class="token number">2</span>   Male  <span class="token number">171.5</span>     <span class="token number">93</span>  <span class="token number">38</span><span class="token number">3</span> Female  <span class="token number">165.0</span>     <span class="token number">78</span>  <span class="token number">26</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p>更多方法实例请点击查看 R 语言<a href="#数据框">数据框</a>章节。</p><h1 id="变量"><a href="#变量" class="headerlink" title="变量"></a>变量</h1><p>变量为我们提供了我们的程序可以操作的命名存储。R 语言中的变量可以存储原子向量，原子向量组或许多 <code>Robject</code> 的组合。有效的变量名称由字母，数字和点或下划线字符组成。变量名以字母或不以数字后跟的点开头。</p><div class="table-container"><table><thead><tr><th style="text-align:center">变量名</th><th style="text-align:center">合法性</th><th style="text-align:center">原因</th></tr></thead><tbody><tr><td style="text-align:center">var_name2.</td><td style="text-align:center">有效</td><td style="text-align:center">有字母，数字，点和下划线</td></tr><tr><td style="text-align:center">VAR_NAME％</td><td style="text-align:center">无效</td><td style="text-align:center">有字符&#39;％&#39;。只有点(.)和下划线允许的。</td></tr><tr><td style="text-align:center">2var_name</td><td style="text-align:center">无效</td><td style="text-align:center">以数字开头</td></tr><tr><td style="text-align:center">.var_name, var.name</td><td style="text-align:center">有效</td><td style="text-align:center">可以用一个点(.)，但启动点(.)，不应该后跟一个数字。</td></tr><tr><td style="text-align:center">.2var_name</td><td style="text-align:center">无效</td><td style="text-align:center">起始点后面是数字使其无效。</td></tr><tr><td style="text-align:center">_var_name</td><td style="text-align:center">无效</td><td style="text-align:center">开头_这是无效的</td></tr></tbody></table></div><p>可以使用向左，向右和等于运算符来为变量分配值。可以使用 <code>print()</code> 或 <code>cat()</code> 函数打印变量的值。<code>cat()</code> 函数将多个项目组合成连续打印输出。</p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r"><span class="token comment"># Assignment using equal operator.</span>var.<span class="token number">1</span> <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token comment"># Assignment using leftward operator.</span>var.<span class="token number">2</span> <span class="token operator">&lt;-</span> c<span class="token punctuation">(</span><span class="token string">"learn"</span><span class="token punctuation">,</span> <span class="token string">"R"</span><span class="token punctuation">)</span><span class="token comment"># Assignment using rightward operator.</span>c<span class="token punctuation">(</span><span class="token boolean">TRUE</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">-></span> var.<span class="token number">3</span>print<span class="token punctuation">(</span>var.<span class="token number">1</span><span class="token punctuation">)</span>cat <span class="token punctuation">(</span><span class="token string">"var.1 is "</span><span class="token punctuation">,</span> var.<span class="token number">1</span> <span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span>cat <span class="token punctuation">(</span><span class="token string">"var.2 is "</span><span class="token punctuation">,</span> var.<span class="token number">2</span> <span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span>cat <span class="token punctuation">(</span><span class="token string">"var.3 is "</span><span class="token punctuation">,</span> var.<span class="token number">3</span> <span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token comment"># 当我们执行上面的代码，它产生以下结果：</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token number">0</span> <span class="token number">1</span> <span class="token number">2</span> <span class="token number">3</span>var.<span class="token number">1</span> is  <span class="token number">0</span> <span class="token number">1</span> <span class="token number">2</span> <span class="token number">3</span> var.<span class="token number">2</span> is  learn R var.<span class="token number">3</span> is  <span class="token number">1</span> <span class="token number">1</span> <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p>变量的数据类型在 R 语言中，变量本身没有声明任何数据类型，而是获取分配给它的 R 对象的数据类型。所以 R 称为动态类型语言，这意味着我们可以在程序中使用同一个变量时，一次又一次地更改变量的数据类型。</p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r">var_x <span class="token operator">&lt;-</span> <span class="token string">"Hello"</span>cat<span class="token punctuation">(</span><span class="token string">"The class of var_x is "</span><span class="token punctuation">,</span> class<span class="token punctuation">(</span>var_x<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span>var_x <span class="token operator">&lt;-</span> <span class="token number">34.5</span>cat<span class="token punctuation">(</span><span class="token string">"  Now the class of var_x is "</span><span class="token punctuation">,</span> class<span class="token punctuation">(</span>var_x<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span>var_x <span class="token operator">&lt;-</span> <span class="token number">27L</span>cat<span class="token punctuation">(</span><span class="token string">"   Next the class of var_x becomes "</span><span class="token punctuation">,</span> class<span class="token punctuation">(</span>var_x<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token comment"># 当我们执行上面的代码，它产生以下结果：</span>The class of var_x is  character    Now the class of var_x is  numeric       Next the class of var_x becomes  integer<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h2 id="查找变量"><a href="#查找变量" class="headerlink" title="查找变量"></a>查找变量</h2><p>要知道工作空间中当前可用的所有变量，我们使用 <code>ls()</code> 函数。<code>ls()</code> 函数也可以使用模式来匹配变量名。</p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r">print<span class="token punctuation">(</span>ls<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment"># 当我们执行上面的代码，它产生以下结果：</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token string">"my var"</span>     <span class="token string">"my_new_var"</span> <span class="token string">"my_var"</span>     <span class="token string">"var.1"</span>      <span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span> <span class="token string">"var.2"</span>      <span class="token string">"var.3"</span>      <span class="token string">"var.name"</span>   <span class="token string">"var_name2."</span><span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span> <span class="token string">"var_x"</span>      <span class="token string">"varname"</span> <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p><strong>注意</strong> ：它是一个示例输出，取决于在您的环境中声明的变量。</p><p><code>ls()</code> 函数可以使用模式来匹配变量名。</p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r"><span class="token comment"># List the variables starting with the pattern "var".</span>print<span class="token punctuation">(</span>ls<span class="token punctuation">(</span>pattern <span class="token operator">=</span> <span class="token string">"var"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>   <span class="token comment"># 当我们执行上面的代码，它产生以下结果：</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token string">"my var"</span>     <span class="token string">"my_new_var"</span> <span class="token string">"my_var"</span>     <span class="token string">"var.1"</span>      <span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span> <span class="token string">"var.2"</span>      <span class="token string">"var.3"</span>      <span class="token string">"var.name"</span>   <span class="token string">"var_name2."</span><span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span> <span class="token string">"var_x"</span>      <span class="token string">"varname"</span>    <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p>以点 <code>.</code> 开头的变量被隐藏，它们可以使用 <code>ls()</code> 函数的 <code>all.names = TRUE</code> 参数列出。</p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r">print<span class="token punctuation">(</span>ls<span class="token punctuation">(</span>all.name <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment"># 当我们执行上面的代码，它产生以下结果：</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token string">".cars"</span>        <span class="token string">".Random.seed"</span> <span class="token string">".var_name"</span>    <span class="token string">".varname"</span>     <span class="token string">".varname2"</span>   <span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span> <span class="token string">"my var"</span>       <span class="token string">"my_new_var"</span>   <span class="token string">"my_var"</span>       <span class="token string">"var.1"</span>        <span class="token string">"var.2"</span>        <span class="token punctuation">[</span><span class="token number">11</span><span class="token punctuation">]</span><span class="token string">"var.3"</span>        <span class="token string">"var.name"</span>     <span class="token string">"var_name2."</span>   <span class="token string">"var_x"</span>  <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h2 id="删除变量"><a href="#删除变量" class="headerlink" title="删除变量"></a>删除变量</h2><p>可以使用 <code>rm()</code> 函数删除变量。下面我们删除变量 <code>var.3</code>。打印时，抛出变量错误的值。</p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r">rm<span class="token punctuation">(</span>var.<span class="token number">3</span><span class="token punctuation">)</span>print<span class="token punctuation">(</span>var.<span class="token number">3</span><span class="token punctuation">)</span> <span class="token comment"># 当我们执行上面的代码，它产生以下结果：</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token string">"var.3"</span>Error <span class="token keyword">in</span> print<span class="token punctuation">(</span>var.<span class="token number">3</span><span class="token punctuation">)</span> <span class="token operator">:</span> object <span class="token string">'var.3'</span> not found<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p>所有的变量可以通过使用 <code>rm()</code> 和 <code>ls()</code> 函数一起删除。</p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r">rm<span class="token punctuation">(</span>list <span class="token operator">=</span> ls<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>print<span class="token punctuation">(</span>ls<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment"># 当我们执行上面的代码，它产生以下结果：</span>character<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h1 id="运算符"><a href="#运算符" class="headerlink" title="运算符"></a>运算符</h1><p>运算符是一个符号，通知编译器执行特定的数学或逻辑操作。R 语言具有丰富的内置运算符，并提供以下类型的运算符。</p><h2 id="运算符的类型"><a href="#运算符的类型" class="headerlink" title="运算符的类型"></a>运算符的类型</h2><p>R 语言中拥有如下几种运算符类型：</p><ul><li><a href="#算术运算符">算术运算符</a></li><li><a href="#关系运算符">关系运算符</a></li><li><a href="#逻辑运算符">逻辑运算符</a></li><li><a href="#赋值运算符">赋值运算符</a></li><li><a href="#其他运算符">其他运算符</a></li></ul><h2 id="算术运算符"><a href="#算术运算符" class="headerlink" title="算术运算符"></a>算术运算符</h2><p>下表显示了 R 语言支持的算术运算符。操作符对向量的每个元素起作用。</p><div class="table-container"><table><thead><tr><th style="text-align:center">运算符</th><th style="text-align:center">描述</th><th style="text-align:left">实例</th></tr></thead><tbody><tr><td style="text-align:center">+</td><td style="text-align:center">两个向量相加</td><td style="text-align:left"><code>v &lt;- c(2, 5.5, 6)</code> <br> <code>t &lt;- c(8, 3, 4)</code> <br> <code>print(v+t)</code> <br> 它产生以下结果： <br> <code>[1] 10.0  8.5  10.0</code></td></tr><tr><td style="text-align:center">-</td><td style="text-align:center">两个向量相减</td><td style="text-align:left"><code>v &lt;- c(2, 5.5, 6)</code> <br> <code>t &lt;- c(8, 3, 4)</code> <br> <code>print(v-t)</code> <br> 它产生以下结果： <br> <code>[1] -6.0  2.5  2.0</code></td></tr><tr><td style="text-align:center">*</td><td style="text-align:center">两个向量相乘</td><td style="text-align:left"><code>v &lt;- c(2, 5.5, 6)</code> <br> <code>t &lt;- c(8, 3, 4)</code> <br> <code>print(v*t)</code> <br> 它产生以下结果： <br> <code>[1] 16.0 16.5 24.0</code></td></tr><tr><td style="text-align:center">/</td><td style="text-align:center">将第一个向量与第二个向量相除</td><td style="text-align:left"><code>v &lt;- c(2, 5.5, 6)</code> <br> <code>t &lt;- c(8, 3, 4)</code> <br> <code>print(v/t)</code> <br> 它产生以下结果： <br> <code>[1] 0.250000 1.833333 1.500000</code></td></tr><tr><td style="text-align:center">%%</td><td style="text-align:center">两个向量求余</td><td style="text-align:left"><code>v &lt;- c(2, 5.5, 6)</code> <br> <code>t &lt;- c(8, 3, 4)</code> <br> <code>print(v%%t)</code> <br> 它产生以下结果： <br> <code>[1] 2.0 2.5 2.0</code></td></tr><tr><td style="text-align:center">%/%</td><td style="text-align:center">两个向量相除求商</td><td style="text-align:left"><code>v &lt;- c(2, 5.5, 6)</code> <br> <code>t &lt;- c(8, 3, 4)</code> <br> <code>print(v%/%t)</code> <br> 它产生以下结果： <br> <code>[1] 0 1 1</code></td></tr><tr><td style="text-align:center">^</td><td style="text-align:center">将第二向量作为第一向量的指数</td><td style="text-align:left"><code>v &lt;- c(2, 5.5, 6)</code> <br> <code>t &lt;- c(8, 3, 4)</code> <br> <code>print(v^t)</code> <br> 它产生以下结果： <br> <code>[1]  256.000  166.375 1296.000</code></td></tr></tbody></table></div><h2 id="关系运算符"><a href="#关系运算符" class="headerlink" title="关系运算符"></a>关系运算符</h2><p>下表显示了 R 语言支持的关系运算符。将第一向量的每个元素与第二向量的相应元素进行比较。比较的结果是布尔值。</p><div class="table-container"><table><thead><tr><th style="text-align:center">运算符</th><th style="text-align:center">描述</th><th style="text-align:left">实例</th></tr></thead><tbody><tr><td style="text-align:center">&gt;</td><td style="text-align:center">检查第一向量的每个元素是否大于第二向量的相应元素。</td><td style="text-align:left"><code>v &lt;- c(2, 5.5, 6, 9)</code> <br> <code>t &lt;- c(8, 2.5, 14, 9)</code> <br> <code>print(v&gt;t)</code> <br> 它产生以下结果： <br> <code>[1] FALSE TRUE FALSE FALSE</code></td></tr><tr><td style="text-align:center">&lt;</td><td style="text-align:center">检查第一个向量的每个元素是否小于第二个向量的相应元素。</td><td style="text-align:left"><code>v &lt;- c(2, 5.5, 6, 9)</code> <br> <code>t &lt;- c(8, 2.5, 14, 9)</code> <br> <code>print(v &lt; t)</code> <br> 它产生以下结果： <br> <code>[1] TRUE FALSE TRUE FALSE</code></td></tr><tr><td style="text-align:center">==</td><td style="text-align:center">检查第一个向量的每个元素是否等于第二个向量的相应元素。</td><td style="text-align:left"><code>v &lt;- c(2, 5.5, 6, 9)</code> <br> <code>t &lt;- c(8, 2.5, 14, 9)</code> <br> <code>print(v == t)</code> <br> 它产生以下结果： <br> <code>[1] FALSE FALSE FALSE TRUE</code></td></tr><tr><td style="text-align:center">&lt;=</td><td style="text-align:center">检查第一向量的每个元素是否小于或等于第二向量的相应元素。</td><td style="text-align:left"><code>v &lt;- c(2, 5.5, 6, 9)</code> <br> <code>t &lt;- c(8, 2.5, 14, 9)</code> <br> <code>print(v&lt;=t)</code> <br> 它产生以下结果： <br> <code>[1] TRUE FALSE TRUE TRUE</code></td></tr><tr><td style="text-align:center">&gt;=</td><td style="text-align:center">检查第一向量的每个元素是否大于或等于第二向量的相应元素。</td><td style="text-align:left"><code>v &lt;- c(2, 5.5, 6, 9)</code> <br> <code>t &lt;- c(8, 2.5, 14, 9)</code> <br> <code>print(v&gt;=t)</code> <br> 它产生以下结果： <br> <code>[1] FALSE  TRUE FALSE  TRUE</code></td></tr><tr><td style="text-align:center">!=</td><td style="text-align:center">检查第一个向量的每个元素是否不等于第二个向量的相应元素。</td><td style="text-align:left"><code>v &lt;- c(2, 5.5, 6, 9</code> <br> <code>t &lt;- c(8, 2.5, 14, 9)</code> <br> <code>print(v!=t)</code> <br> 它产生以下结果： <br> <code>[1] TRUE TRUE TRUE FALSE</code></td></tr></tbody></table></div><h2 id="逻辑运算符"><a href="#逻辑运算符" class="headerlink" title="逻辑运算符"></a>逻辑运算符</h2><p>下表显示了 R 语言支持的逻辑运算符。它只适用于逻辑，数字或复杂类型的向量。所有大于 1 的数字被认为是逻辑值 <code>TRUE</code>。</p><p>将第一向量的每个元素与第二向量的相应元素进行比较。比较的结果是布尔值。</p><div class="table-container"><table><thead><tr><th style="text-align:center">运算符</th><th style="text-align:center">描述</th><th style="text-align:left">实例</th></tr></thead><tbody><tr><td style="text-align:center">&amp;</td><td style="text-align:center">它被称为元素逻辑 AND 运算符。<br> 它将第一向量的每个元素与第二向量的相应元素组合， <br> 并且如果两个元素都为 TRUE，则给出输出 TRUE。</td><td style="text-align:left"><code>v &lt;- c(3, 1, TRUE, 2+3i)</code> <br> <code>t &lt;- c(4, 1, FALSE, 2+3i)</code> <br> <code>print(v&amp;t)</code> <br> 它产生以下结果： <br> <code>[1] TRUE TRUE FALSE TRUE</code></td></tr><tr><td style="text-align:center">&amp;vert；</td><td style="text-align:center">它被称为元素逻辑或运算符。<br> 它将第一向量的每个元素与第二向量的相应元素组合， <br> 并且如果元素为真，则给出输出 TRUE。</td><td style="text-align:left"><code>v &lt;- c(3, 0, TRUE, 2+2i)</code> <br> <code>t &lt;- c(4, 0, FALSE, 2+3i)</code> <br> <code>print(v</code>&vert;<code>t)</code> <br> 它产生以下结果： <br> <code>[1] TRUE FALSE TRUE TRUE</code></td></tr><tr><td style="text-align:center">!</td><td style="text-align:center">它被称为逻辑非运算符。取得向量的每个元素，并给出相反的逻辑值。</td><td style="text-align:left"><code>v &lt;- c(3, 0, TRUE, 2+2i)</code> <br> <code>print(!v)</code> <br> 它产生以下结果： <br> <code>[1] FALSE TRUE FALSE FALSE</code></td></tr></tbody></table></div><p>逻辑运算符 <code>&amp;&amp;</code> 和 <code>||</code> 只考虑向量的第一个元素，给出单个元素的向量作为输出。</p><div class="table-container"><table><thead><tr><th style="text-align:center">运算符</th><th style="text-align:center">描述</th><th style="text-align:left">实例</th></tr></thead><tbody><tr><td style="text-align:center">&amp;&amp;</td><td style="text-align:center">称为逻辑 AND 运算符。取两个向量的第一个元素， <br> 并且只有两个都为TRUE时才给出TRUE。</td><td style="text-align:left"><code>v &lt;- c(3, 0, TRUE, 2+2i)</code> <br> <code>t &lt;- c(1, 3, TRUE, 2+3i)</code> <br> <code>print(v&amp;&amp;t)</code> <br> 它产生以下结果： <br> <code>[1] TRUE</code></td></tr><tr><td style="text-align:center">&vert;&amp;vert；</td><td style="text-align:center">称为逻辑 OR 运算符。取两个向量的第一个元素， <br> 如果其中一个为 TRUE，则给出 TRUE。</td><td style="text-align:left"><code>v &lt;- c(0, 0, TRUE, 2+2i)</code> <br> <code>t &lt;- c(0, 3, TRUE, 2+3i)</code> <br> <code>print(v</code>&vert;&vert;<code>t)</code> <br> 它产生以下结果： <br> <code>[1] FALSE</code></td></tr></tbody></table></div><h2 id="赋值运算符"><a href="#赋值运算符" class="headerlink" title="赋值运算符"></a>赋值运算符</h2><p>这些运算符用于向向量赋值。</p><div class="table-container"><table><thead><tr><th style="text-align:center">运算符</th><th style="text-align:center">描述</th><th style="text-align:left">实例</th></tr></thead><tbody><tr><td style="text-align:center">&lt;− <br> = <br> &lt;&lt;− <br></td><td style="text-align:center">称为左分配</td><td style="text-align:left"><code>v1 &lt;- c(3, 1, TRUE, 2+3i)</code> <br> <code>v2 &lt;&lt;- c(3, 1, TRUE, 2+3i)</code> <br> <code>v3 = c(3, 1, TRUE, 2+3i)</code> <br> <code>print(v1)</code> <br> <code>print(v2)</code> <br> <code>print(v3)</code> <br> 它产生以下结果： <br> <code>[1] 3+0i 1+0i 1+0i 2+3i</code> <br> <code>[1] 3+0i 1+0i 1+0i 2+3i</code> <br> <code>[1] 3+0i 1+0i 1+0i 2+3i</code></td></tr><tr><td style="text-align:center">-&gt; <br> -&gt;&gt;</td><td style="text-align:center">称为右分配</td><td style="text-align:left"><code>c(3, 1, TRUE, 2+3i) -&gt; v1</code> <br> <code>c(3, 1, TRUE, 2+3i) -&gt;&gt; v2</code> <br> <code>print(v1)</code> <br> <code>print(v2)</code> <br> 它产生以下结果： <br> <code>[1] 3+0i 1+0i 1+0i 2+3i</code> <br> <code>[1] 3+0i 1+0i 1+0i 2+3i</code></td></tr></tbody></table></div><h2 id="其他运算符"><a href="#其他运算符" class="headerlink" title="其他运算符"></a>其他运算符</h2><p>这些运算符用于特定目的，而不是一般的数学或逻辑计算。</p><div class="table-container"><table><thead><tr><th style="text-align:center">运算符</th><th style="text-align:center">描述</th><th style="text-align:left">实例</th></tr></thead><tbody><tr><td style="text-align:center">:</td><td style="text-align:center">冒号运算符。它为向量按顺序创建一系列数字。</td><td style="text-align:left"><code>v &lt;- 2:8</code> <br> <code>print(v)</code> <br> 它产生以下结果： <br> <code>[1] 2 3 4 5 6 7 8</code></td></tr><tr><td style="text-align:center">%in%</td><td style="text-align:center">此运算符用于标识元素是否属于向量。</td><td style="text-align:left"><code>v1 &lt;- 8</code> <br> <code>v2 &lt;- 12</code> <br> <code>t &lt;- 1:10</code> <br> <code>print(v1 %in% t)</code> <br> <code>print(v2 %in% t)</code> <br> 它产生以下结果： <br> <code>[1] TRUE</code> <br> <code>[1] FALSE</code></td></tr><tr><td style="text-align:center">%*%</td><td style="text-align:center">此运算符用于将矩阵与其转置相乘。</td><td style="text-align:left"><code>M = matrix(c(2, 6, 5, 1, 10, 4),</code> <br> <code>nrow = 2, ncol = 3, byrow = TRUE)</code> <br> <code>t = M %*% t(M)</code> <br> <code>print(t)</code> <br> 它产生以下结果： <br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<code>[,1] [,2]</code> <br> <code>[1,]</code>&nbsp;&nbsp;&nbsp;&nbsp;<code>65</code>&nbsp;&nbsp;&nbsp;&nbsp;<code>82</code> <br> <code>[2,]</code>&nbsp;&nbsp;&nbsp;&nbsp;<code>82</code>&nbsp;&nbsp;&nbsp;&nbsp;<code>117</code></td></tr></tbody></table></div><h1 id="包"><a href="#包" class="headerlink" title="包"></a>包</h1><p>R 语言的包是 R 函数，编译代码和样本数据的集合。它们存储在 R 语言环境中名为 <code>library</code> 的目录下。默认情况下，R 语言在安装期间安装一组软件包。随后添加更多包，当它们用于某些特定目的时。当我们启动 R 语言控制台时，默认情况下只有默认包可用。已经安装的其他软件包必须显式加载以供将要使用它们的 R 语言程序使用。</p><p>所有可用的 R 语言包都列在 <a href="https://cran.r-project.org/web/packages/available_packages_by_name.html">R 语言的包</a>。</p><p>下面是用于检查，验证和使用 R 包的命令列表。</p><h2 id="检查可用-R-语言的包"><a href="#检查可用-R-语言的包" class="headerlink" title="检查可用 R 语言的包"></a>检查可用 R 语言的包</h2><p>获取包含 R 包的库位置<pre class="line-numbers language-r" data-language="r"><code class="language-r">.libPaths<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment"># 当我们执行上面的代码，它产生以下结果。它可能会根据您的电脑的本地设置而有所不同。</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token string">"C:/Program Files/R/R-3.2.2/library"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h2 id="获取已安装的所有软件包列表"><a href="#获取已安装的所有软件包列表" class="headerlink" title="获取已安装的所有软件包列表"></a>获取已安装的所有软件包列表</h2><p><pre class="line-numbers language-r" data-language="r"><code class="language-r">library<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment"># 当我们执行上面的代码，它产生以下结果。它可能会根据您的电脑的本地设置而有所不同。</span>Packages <span class="token keyword">in</span> library ‘C<span class="token operator">:</span><span class="token operator">/</span>Program Files<span class="token operator">/</span>R<span class="token operator">/</span>R<span class="token operator">-</span><span class="token number">3.2</span><span class="token number">.2</span><span class="token operator">/</span>library’<span class="token operator">:</span>base                    The R Base Packageboot                    Bootstrap Functions <span class="token punctuation">(</span>Originally by Angelo Canty                        <span class="token keyword">for</span> S<span class="token punctuation">)</span>class                   Functions <span class="token keyword">for</span> Classificationcluster                 <span class="token string">"Finding Groups in Data"</span><span class="token operator">:</span> Cluster Analysis                        Extended Rousseeuw et al.codetools               Code Analysis Tools <span class="token keyword">for</span> Rcompiler                The R Compiler Package<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p>获取当前在 R 环境中加载的所有包</p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r">search<span class="token punctuation">(</span><span class="token punctuation">)</span>当我们执行上述代码时，它产生了以下结果。它会根据你的个人电脑的本地设置而异。<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token string">".GlobalEnv"</span>        <span class="token string">"package:stats"</span>     <span class="token string">"package:graphics"</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token string">"package:grDevices"</span> <span class="token string">"package:utils"</span>     <span class="token string">"package:datasets"</span><span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span> <span class="token string">"package:methods"</span>   <span class="token string">"Autoloads"</span>         <span class="token string">"package:base"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h2 id="安装一个新的软件包"><a href="#安装一个新的软件包" class="headerlink" title="安装一个新的软件包"></a>安装一个新的软件包</h2><p>有两种方法来添加新的 R 包。一个是直接从 CRAN 目录安装，另一个是将软件包下载到本地系统并手动安装它。</p><h3 id="直接从-CRAN-安装"><a href="#直接从-CRAN-安装" class="headerlink" title="直接从 CRAN 安装"></a>直接从 CRAN 安装</h3><p>以下命令直接从 CRAN 网页获取软件包，并将软件包安装在 R 环境中。可能会提示您选择最近的镜像。根据您的位置选择一个。</p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r">install.packages<span class="token punctuation">(</span><span class="token string">"Package Name"</span><span class="token punctuation">)</span><span class="token comment"># Install the package named "XML".</span>install.packages<span class="token punctuation">(</span><span class="token string">"XML"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></p><h3 id="手动安装包"><a href="#手动安装包" class="headerlink" title="手动安装包"></a>手动安装包</h3><p>转到链接 <a href="https://cran.r-project.org/web/packages/available_packages_by_name.html">R Packages</a> 下载所需的包。将包作为 .zip 文件保存在本地系统中的适当位置。</p><p>现在您可以运行以下命令在 R 环境中安装此软件包。</p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r">install.packages<span class="token punctuation">(</span>file_name_with_path<span class="token punctuation">,</span> repos <span class="token operator">=</span> <span class="token keyword">NULL</span><span class="token punctuation">,</span> type <span class="token operator">=</span> <span class="token string">"source"</span><span class="token punctuation">)</span><span class="token comment"># Install the package named "XML"</span>install.packages<span class="token punctuation">(</span><span class="token string">"E:/XML_3.98-1.3.zip"</span><span class="token punctuation">,</span> repos <span class="token operator">=</span> <span class="token keyword">NULL</span><span class="token punctuation">,</span> type <span class="token operator">=</span> <span class="token string">"source"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></p><h3 id="装载包到库中"><a href="#装载包到库中" class="headerlink" title="装载包到库中"></a>装载包到库中</h3><p>在包可以在代码中使用之前，必须将其加载到当前 R 环境中。您还需要加载先前已安装但在当前环境中不可用的软件包。</p><p>使用以下命令加载包：<pre class="line-numbers language-r" data-language="r"><code class="language-r">library<span class="token punctuation">(</span><span class="token string">"package Name"</span><span class="token punctuation">,</span> lib.loc <span class="token operator">=</span> <span class="token string">"path to library"</span><span class="token punctuation">)</span><span class="token comment"># Load the package named "XML"</span>install.packages<span class="token punctuation">(</span><span class="token string">"E:/XML_3.98-1.3.zip"</span><span class="token punctuation">,</span> repos <span class="token operator">=</span> <span class="token keyword">NULL</span><span class="token punctuation">,</span> type <span class="token operator">=</span> <span class="token string">"source"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></p><h1 id="决策"><a href="#决策" class="headerlink" title="决策"></a>决策</h1><p>决策结构要求程序员指定要由程序评估或测试的一个或多个条件，以及如果条件被确定为真则要执行的一个或多个语句，如果条件为假则执行其他语句。</p><p>R 提供以下类型的决策语句。</p><ul><li>if 语句</li><li>if ... else 语句</li><li>switch 语句</li></ul><h2 id="if-语句"><a href="#if-语句" class="headerlink" title="if 语句"></a>if 语句</h2><p>if 语句由一个布尔表达式后跟一个或多个语句组成。</p><p><strong>语法</strong></p><p>在 R 中创建 <code>if</code> 语句的基本语法是：</p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r"><span class="token keyword">if</span><span class="token punctuation">(</span>boolean_expression<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>   <span class="token comment"># statement(s) will execute if the boolean expression is true.</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></p><p>如果布尔表达式的计算结果为 <code>true</code>，那么 <code>if</code> 语句中的代码块将被执行。如果布尔表达式的计算结果为 <code>false</code>，那么第一组代码在if语句结束之后（在结束大括号之后）将被执行。</p><p><strong>流程图</strong></p><p><img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="/images/post/r_course/if.jpg" alt></p><p><strong>实例</strong></p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r">x <span class="token operator">&lt;-</span> <span class="token number">30L</span><span class="token keyword">if</span><span class="token punctuation">(</span>is.integer<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>   print<span class="token punctuation">(</span><span class="token string">"X is an Integer"</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token comment"># 当上面的代码被编译和执行时，它产生以下结果：</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token string">"X is an Integer"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h2 id="if-else-语句"><a href="#if-else-语句" class="headerlink" title="if...else 语句"></a>if...else 语句</h2><p><code>if</code> 语句后面可以是一个可选的 <code>else</code> 语句，当布尔表达式为 <code>false</code> 时执行。</p><p><strong>语法</strong></p><p>在 R 中创建 if ... else 语句的基本语法是：</p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r"><span class="token keyword">if</span><span class="token punctuation">(</span>boolean_expression<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>   <span class="token comment"># statement(s) will execute if the boolean expression is true.</span><span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>   <span class="token comment"># statement(s) will execute if the boolean expression is false.</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p>如果布尔表达式的计算结果为真，则将执行if代码块，否则将执行代码块。</p><p><strong>流程图</strong></p><p><img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="/images/post/r_course/if_else.jpg" alt></p><p><strong>实例</strong></p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r">x <span class="token operator">&lt;-</span> c<span class="token punctuation">(</span><span class="token string">"what"</span><span class="token punctuation">,</span> <span class="token string">"is"</span><span class="token punctuation">,</span> <span class="token string">"truth"</span><span class="token punctuation">)</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token string">"Truth"</span> <span class="token percent-operator operator">%in%</span> x<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>   print<span class="token punctuation">(</span><span class="token string">"Truth is found"</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>   print<span class="token punctuation">(</span><span class="token string">"Truth is not found"</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token comment"># 当上面的代码被编译和执行时，它产生以下结果：</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token string">"Truth is not found"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p>这里 <code>Truth</code> 和 <code>truth</code> 是两个不同的字符串。</p><p><strong>if ... else if ... else 语句</strong></p><p><code>if</code> 语句后面可以跟一个可选的 <code>else if ... else</code> 语句，这对于使用 <code>single if ... else if</code> 语句测试各种条件非常有用。</p><p>当使用 <code>if</code>，<code>else if</code>，<code>else</code> 语句有几点要记住：</p><ul><li>如果可以有零个或一个 <code>else</code>，它必须在任何其他 <code>if</code> 之后。</li><li>一个 <code>if</code> 可以有零个到许多个 <code>else if</code> 和它们必须在 <code>else</code> 之前。</li><li>一旦一个 <code>else</code> 如果成功，没有任何剩余的 <code>else if</code> 或 <code>else</code> 将被测试。</li></ul><p><strong>语法</strong></p><p>在 R 中创建 <code>if ... else if ... else</code>语句的基本语法是：</p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r"><span class="token keyword">if</span><span class="token punctuation">(</span>boolean_expression <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>   <span class="token operator">/</span><span class="token operator">/</span> Executes when the boolean expression <span class="token number">1</span> is true.<span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span> boolean_expression <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>   <span class="token operator">/</span><span class="token operator">/</span> Executes when the boolean expression <span class="token number">2</span> is true.<span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span> boolean_expression <span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>   <span class="token operator">/</span><span class="token operator">/</span> Executes when the boolean expression <span class="token number">3</span> is true.<span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>   <span class="token operator">/</span><span class="token operator">/</span> executes when none of the above condition is true.<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p><strong>实例</strong></p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r">x <span class="token operator">&lt;-</span> c<span class="token punctuation">(</span><span class="token string">"what"</span><span class="token punctuation">,</span> <span class="token string">"is"</span><span class="token punctuation">,</span> <span class="token string">"truth"</span><span class="token punctuation">)</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token string">"Truth"</span> <span class="token percent-operator operator">%in%</span> x<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>   print<span class="token punctuation">(</span><span class="token string">"Truth is found the first time"</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">"truth"</span> <span class="token percent-operator operator">%in%</span> x<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>   print<span class="token punctuation">(</span><span class="token string">"truth is found the second time"</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>   print<span class="token punctuation">(</span><span class="token string">"No truth found"</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token comment"># 当上面的代码被编译和执行时，它产生以下结果：</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token string">"truth is found the second time"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h2 id="switch-​语句"><a href="#switch-​语句" class="headerlink" title="switch ​语句"></a>switch ​语句</h2><p><code>switch</code> ​语句允许根据值列表测试变量的相等性。每个值都称为大小写，并且针对每种情况检查打开的变量。</p><p><strong>语法</strong></p><p>在 R 中创建 <code>​switch​</code> 语句的基本语法是：</p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r">switch<span class="token punctuation">(</span>expression<span class="token punctuation">,</span> case1<span class="token punctuation">,</span> case2<span class="token punctuation">,</span> case3<span class="token ellipsis">...</span>.<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><p>以下规则适用于 <code>​switch</code> ​语句：</p><ul><li>如果 <code>​expression​</code> 的值不是字符串，那么它被强制为整数。</li><li>在交换机中可以有任意数量的 <code>​case</code> ​语句。每个案例后面都跟要比较的值和冒号。</li><li>如果整数的值在 ​<code>1</code> ​和 ​<code>nargs() - 1</code>​（参数的最大数目）之间，则对 ​case ​条件的相应元素求值并返回结果。</li><li>如果表达式求值为字符串，那么该字符串与元素的名称匹配。</li><li>如果有多个匹配，则返回第一个匹配元素。</li><li>无默认参数可用。</li><li>在没有匹配的情况下，如果有一个未命名的元素...它的值被返回。（如果有多个这样的参数，则返回错误。）</li></ul><p><strong>流程图</strong></p><p><img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="/images/post/r_course/switch.jpg" alt></p><p><strong>实例 1</strong></p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r">x <span class="token operator">&lt;-</span> switch<span class="token punctuation">(</span>   <span class="token number">3</span><span class="token punctuation">,</span>   <span class="token string">"first"</span><span class="token punctuation">,</span>   <span class="token string">"second"</span><span class="token punctuation">,</span>   <span class="token string">"third"</span><span class="token punctuation">,</span>   <span class="token string">"fourth"</span><span class="token punctuation">)</span>print<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token comment"># 当上面的代码被编译和执行时，它产生以下结果：</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token string">"third"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p><strong>实例 2</strong></p><p><code>​runif()​</code> 函数用于生成从 ​<code>0</code> ​到 ​<code>1</code> ​区间范围内的服从正态分布的随机数：</p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r">switch<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token operator">*</span><span class="token number">3</span><span class="token punctuation">,</span> sd<span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span> runif<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment">#返回（2*3, sd(1:5), runif(3)）list中的第一个成分 </span>switch<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token operator">*</span><span class="token number">3</span><span class="token punctuation">,</span> sd<span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span> runif<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment">#返回第二个成分</span>switch<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token operator">*</span><span class="token number">3</span><span class="token punctuation">,</span> sd<span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span> runif<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment">#返回第三个成分</span><span class="token comment"># 当上面的代码被编译和执行时，它产生以下结果：</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token number">6</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token number">1.581139</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token number">0.31508117</span> <span class="token number">0.04610938</span> <span class="token number">0.19489747</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h1 id="循环"><a href="#循环" class="headerlink" title="循环"></a>循环</h1><p>可能有一种情况，当你需要执行一段代码几次。通常，顺序执行语句。首先执行函数中的第一个语句，然后执行第二个语句，依此类推。</p><p>编程语言提供允许更复杂的执行路径的各种控制结构。</p><p>循环语句允许我们多次执行一个语句或一组语句，以下是大多数编程语言中循环语句的一般形式</p><p><img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="/images/post/r_course/loop.jpg" alt></p><p><strong>循环控制语句</strong></p><p>循环控制语句从其正常序列改变执行。当执行离开作用域时，在该作用域中创建的所有自动对象都将被销毁。</p><p>R 语言支持以下控制语句。</p><ul><li>break</li><li>next</li></ul><h2 id="Repeat-语句"><a href="#Repeat-语句" class="headerlink" title="Repeat 语句"></a>Repeat 语句</h2><p><code>repeat</code> 循环重复执行相同的代码，直到满足停止条件。</p><p><strong>语法</strong></p><p>在R中创建Repeat循环的基本语法是：</p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r"><span class="token keyword">repeat</span> <span class="token punctuation">&#123;</span>    commands    <span class="token keyword">if</span><span class="token punctuation">(</span>condition<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token keyword">break</span>   <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p><strong>流程图</strong></p><p><img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="/images/post/r_course/repeat.jpg" alt></p><p><strong>实例</strong></p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r">v <span class="token operator">&lt;-</span> c<span class="token punctuation">(</span><span class="token string">"Hello"</span><span class="token punctuation">,</span> <span class="token string">"loop"</span><span class="token punctuation">)</span>cnt <span class="token operator">&lt;-</span> <span class="token number">2</span><span class="token keyword">repeat</span> <span class="token punctuation">&#123;</span>   print<span class="token punctuation">(</span>v<span class="token punctuation">)</span>   cnt <span class="token operator">&lt;-</span> cnt<span class="token operator">+</span><span class="token number">1</span>      <span class="token keyword">if</span><span class="token punctuation">(</span>cnt <span class="token operator">></span> <span class="token number">5</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token keyword">break</span>   <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token comment"># 当上面的代码被编译和执行时，它产生以下结果：</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token string">"Hello"</span> <span class="token string">"loop"</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token string">"Hello"</span> <span class="token string">"loop"</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token string">"Hello"</span> <span class="token string">"loop"</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token string">"Hello"</span> <span class="token string">"loop"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h2 id="while-语句"><a href="#while-语句" class="headerlink" title="while 语句"></a>while 语句</h2><p><code>while</code> 循环一次又一次地执行相同的代码，直到满足停止条件。</p><p><strong>语法</strong></p><p>在 R 中创建 <code>while</code> 循环的基本语法是：</p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r"><span class="token keyword">while</span> <span class="token punctuation">(</span>test_expression<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>   statement<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></p><p><strong>流程图</strong></p><p><img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="/images/post/r_course/while.jpg" alt></p><p><code>while</code> 循环的关键点是循环可能永远不会运行。当条件被测试并且结果为 <code>false</code> 时，循环体将被跳过，<code>while</code> 循环之后的第一条语句将被执行。</p><p><strong>实例</strong></p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r">v <span class="token operator">&lt;-</span> c<span class="token punctuation">(</span><span class="token string">"Hello"</span><span class="token punctuation">,</span><span class="token string">"while loop"</span><span class="token punctuation">)</span>cnt <span class="token operator">&lt;-</span> <span class="token number">2</span><span class="token keyword">while</span> <span class="token punctuation">(</span>cnt <span class="token operator">&lt;</span> <span class="token number">7</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>   print<span class="token punctuation">(</span>v<span class="token punctuation">)</span>   cnt <span class="token operator">=</span> cnt <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">&#125;</span><span class="token comment"># 当上面的代码被编译和执行时，它产生以下结果：</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token string">"Hello"</span>  <span class="token string">"while loop"</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token string">"Hello"</span>  <span class="token string">"while loop"</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token string">"Hello"</span>  <span class="token string">"while loop"</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token string">"Hello"</span>  <span class="token string">"while loop"</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token string">"Hello"</span>  <span class="token string">"while loop"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h2 id="for-语句"><a href="#for-语句" class="headerlink" title="for 语句"></a>for 语句</h2><p><code>for</code> 循环是一种重复控制结构，允许您有效地编写需要执行特定次数的循环。</p><p>R 的 <code>for</code> 循环是特别灵活的，因为它们不限于整数，或者输入中的偶数。我们可以传递字符向量，逻辑向量，列表或表达式。</p><p><strong>语法</strong></p><p>在 R 中创建一个 <code>for</code> 循环语句的基本语法是：</p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r"><span class="token keyword">for</span> <span class="token punctuation">(</span>变量 <span class="token keyword">in</span> 条件<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>   循环体<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></p><p><strong>流程图</strong></p><p><img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="/images/post/r_course/for.jpg" alt></p><p><strong>实例</strong></p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r">v <span class="token operator">&lt;-</span> LETTERS<span class="token punctuation">[</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token keyword">for</span> <span class="token punctuation">(</span> i <span class="token keyword">in</span> v<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>   print<span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token comment"># 当上面的代码被编译和执行时，它产生以下结果 </span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token string">"A"</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token string">"B"</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token string">"C"</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token string">"D"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h2 id="break-语句"><a href="#break-语句" class="headerlink" title="break 语句"></a>break 语句</h2><p>R 语言中的 <code>break</code> 语句有以下两种用法：</p><p>当在循环中遇到 <code>break</code> 语句时，循环立即终止，并且程序控制在循环之后的下一语句处恢复。它可以用于终止 <code>switch</code> 语句中的情况。语法在 R 中创建 <code>break</code> 语句的基本语法是：</p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r"><span class="token keyword">break</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><p><strong>流程图</strong></p><p><img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="/images/post/r_course/break.jpg" alt></p><p><strong>实例</strong></p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r">v <span class="token operator">&lt;-</span> c<span class="token punctuation">(</span><span class="token string">"Hello"</span><span class="token punctuation">,</span><span class="token string">"loop"</span><span class="token punctuation">)</span>cnt <span class="token operator">&lt;-</span> <span class="token number">2</span><span class="token keyword">repeat</span> <span class="token punctuation">&#123;</span>   print<span class="token punctuation">(</span>v<span class="token punctuation">)</span>   cnt <span class="token operator">&lt;-</span> cnt <span class="token operator">+</span> <span class="token number">1</span>   <span class="token keyword">if</span><span class="token punctuation">(</span>cnt <span class="token operator">></span> <span class="token number">5</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token keyword">break</span>   <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token comment"># 当上面的代码被编译和执行时，它产生以下结果：</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token string">"Hello"</span> <span class="token string">"loop"</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token string">"Hello"</span> <span class="token string">"loop"</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token string">"Hello"</span> <span class="token string">"loop"</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token string">"Hello"</span> <span class="token string">"loop"</span> <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h2 id="next-语句"><a href="#next-语句" class="headerlink" title="next 语句"></a>next 语句</h2><p>R 语言存在 <code>next</code> 语句，当我们想跳过循环的当前迭代而不终止它时便可使用 <code>next</code>。遇到 <code>next</code> 时，R 解析器跳过本次迭代，并开始循环的下一次迭代。</p><p><strong>语法</strong></p><p>在 R 中创建 <code>next</code> 语句的基本语法是：</p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r"><span class="token keyword">next</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><p><strong>流程图</strong></p><p><img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="/images/post/r_course/next.jpg" alt></p><p><strong>实例</strong></p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r">v <span class="token operator">&lt;-</span> LETTERS<span class="token punctuation">[</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token keyword">for</span> <span class="token punctuation">(</span> i <span class="token keyword">in</span> v<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">==</span> <span class="token string">"D"</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token keyword">next</span>   <span class="token punctuation">&#125;</span>   print<span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token comment">#当上面的代码被编译和执行时，它产生以下结果：</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token string">"A"</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token string">"B"</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token string">"C"</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token string">"E"</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token string">"F"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h1 id="数据重塑"><a href="#数据重塑" class="headerlink" title="数据重塑"></a>数据重塑</h1><p>R 语言中的数据重塑是关于改变数据被组织成行和列的方式。</p><p>大多数时间 R 语言中的数据处理是通过将输入数据作为数据框来完成的。很容易从数据框的行和列中提取数据，但是在某些情况下，我们需要的数据框格式与我们接收数据框的格式不同。R 语言具有许多函数，可以在数据框中拆分，合并和将行更改为列，反之亦然。</p><h2 id="数据框中加入列和行"><a href="#数据框中加入列和行" class="headerlink" title="数据框中加入列和行"></a>数据框中加入列和行</h2><p>我们可以使用 <code>cbind()</code> 函数连接多个向量来创建数据框。此外，我们可以使用 <code>rbind()</code> 函数合并两个数据框。</p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r"><span class="token comment"># Create vector objects.</span>city <span class="token operator">&lt;-</span> c<span class="token punctuation">(</span><span class="token string">"Tampa"</span><span class="token punctuation">,</span> <span class="token string">"Seattle"</span><span class="token punctuation">,</span> <span class="token string">"Hartford"</span><span class="token punctuation">,</span> <span class="token string">"Denver"</span><span class="token punctuation">)</span>state <span class="token operator">&lt;-</span> c<span class="token punctuation">(</span><span class="token string">"FL"</span><span class="token punctuation">,</span> <span class="token string">"WA"</span><span class="token punctuation">,</span> <span class="token string">"CT"</span><span class="token punctuation">,</span> <span class="token string">"CO"</span><span class="token punctuation">)</span>zipcode <span class="token operator">&lt;-</span> c<span class="token punctuation">(</span><span class="token number">33602</span><span class="token punctuation">,</span> <span class="token number">98104</span><span class="token punctuation">,</span> <span class="token number">06161</span><span class="token punctuation">,</span> <span class="token number">80294</span><span class="token punctuation">)</span><span class="token comment"># Combine above three vectors into one data frame.</span>addresses <span class="token operator">&lt;-</span> cbind<span class="token punctuation">(</span>city<span class="token punctuation">,</span> state<span class="token punctuation">,</span> zipcode<span class="token punctuation">)</span><span class="token comment"># Print a header.</span>cat<span class="token punctuation">(</span><span class="token string">"# # # # The First data frame"</span><span class="token punctuation">)</span><span class="token comment"># Print the data frame.</span>print<span class="token punctuation">(</span>addresses<span class="token punctuation">)</span><span class="token comment"># Create another data frame with similar columns</span>new.address <span class="token operator">&lt;-</span> data.frame<span class="token punctuation">(</span>   city <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token string">"Lowry"</span><span class="token punctuation">,</span> <span class="token string">"Charlotte"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>   state <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token string">"CO"</span><span class="token punctuation">,</span> <span class="token string">"FL"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>   zipcode <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token string">"80230"</span><span class="token punctuation">,</span> <span class="token string">"33949"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>   stringsAsFactors <span class="token operator">=</span> <span class="token boolean">FALSE</span><span class="token punctuation">)</span><span class="token comment"># Print a header.</span>cat<span class="token punctuation">(</span><span class="token string">"# # # The Second data frame"</span><span class="token punctuation">)</span><span class="token comment"># Print the data frame.</span>print<span class="token punctuation">(</span>new.address<span class="token punctuation">)</span><span class="token comment"># Combine rows form both the data frames.</span>all.addresses <span class="token operator">&lt;-</span> rbind<span class="token punctuation">(</span>addresses<span class="token punctuation">,</span> new.address<span class="token punctuation">)</span><span class="token comment"># Print a header.</span>cat<span class="token punctuation">(</span><span class="token string">"# # # The combined data frame"</span><span class="token punctuation">)</span><span class="token comment"># Print the result.</span>print<span class="token punctuation">(</span>all.addresses<span class="token punctuation">)</span><span class="token comment"># 当我们执行上面的代码，它产生以下结果：</span><span class="token comment"># # # # The First data frame</span>     city       state zipcode<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token punctuation">]</span> <span class="token string">"Tampa"</span>    <span class="token string">"FL"</span>  <span class="token string">"33602"</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token punctuation">]</span> <span class="token string">"Seattle"</span>  <span class="token string">"WA"</span>  <span class="token string">"98104"</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token punctuation">]</span> <span class="token string">"Hartford"</span> <span class="token string">"CT"</span>  <span class="token string">"6161"</span> <span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token punctuation">]</span> <span class="token string">"Denver"</span>   <span class="token string">"CO"</span>  <span class="token string">"80294"</span><span class="token comment"># # # The Second data frame</span>       city state zipcode<span class="token number">1</span>     Lowry    CO   <span class="token number">80230</span><span class="token number">2</span> Charlotte    FL   <span class="token number">33949</span><span class="token comment"># # # The combined data frame</span>       city state zipcode<span class="token number">1</span>     Tampa    FL   <span class="token number">33602</span><span class="token number">2</span>   Seattle    WA   <span class="token number">98104</span><span class="token number">3</span>  Hartford    CT    <span class="token number">6161</span><span class="token number">4</span>    Denver    CO   <span class="token number">80294</span><span class="token number">5</span>     Lowry    CO   <span class="token number">80230</span><span class="token number">6</span> Charlotte    FL   <span class="token number">33949</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h2 id="合并数据框"><a href="#合并数据框" class="headerlink" title="合并数据框"></a>合并数据框</h2><p>我们可以使用 <code>merge()</code> 函数合并两个数据框。数据框必须具有相同的列名称，在其上进行合并。</p><p>在下面的例子中，我们考虑使用 <code>library()</code> 函数加载 <code>MASS</code> 第三方包，使用 <code>MASS</code> 中有关 <code>Pima Indian Women</code> 的糖尿病的数据集。我们基于血压（bp）和体重指数（bmi）的值合并两个数据集。在选择这两列用于合并时，其中这两个变量的值在两个数据集中匹配的记录被组合在一起以形成单个数据框。</p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r">library<span class="token punctuation">(</span>MASS<span class="token punctuation">)</span>merged.Pima <span class="token operator">&lt;-</span> merge<span class="token punctuation">(</span>x <span class="token operator">=</span> Pima.te<span class="token punctuation">,</span> y <span class="token operator">=</span> Pima.tr<span class="token punctuation">,</span>   by.x <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token string">"bp"</span><span class="token punctuation">,</span> <span class="token string">"bmi"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>   by.y <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token string">"bp"</span><span class="token punctuation">,</span> <span class="token string">"bmi"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>print<span class="token punctuation">(</span>merged.Pima<span class="token punctuation">)</span>nrow<span class="token punctuation">(</span>merged.Pima<span class="token punctuation">)</span><span class="token comment"># 当我们执行上面的代码，它产生以下结果：</span>   bp  bmi npreg.x glu.x skin.x ped.x age.x type.x npreg.y glu.y skin.y ped.y age.y type.y<span class="token number">1</span>  <span class="token number">60</span> <span class="token number">33.8</span>       <span class="token number">1</span>   <span class="token number">117</span>     <span class="token number">23</span> <span class="token number">0.466</span>    <span class="token number">27</span>     No       <span class="token number">2</span>   <span class="token number">125</span>     <span class="token number">20</span> <span class="token number">0.088</span>    <span class="token number">31</span>     No<span class="token number">2</span>  <span class="token number">64</span> <span class="token number">29.7</span>       <span class="token number">2</span>    <span class="token number">75</span>     <span class="token number">24</span> <span class="token number">0.370</span>    <span class="token number">33</span>     No       <span class="token number">2</span>   <span class="token number">100</span>     <span class="token number">23</span> <span class="token number">0.368</span>    <span class="token number">21</span>     No<span class="token number">3</span>  <span class="token number">64</span> <span class="token number">31.2</span>       <span class="token number">5</span>   <span class="token number">189</span>     <span class="token number">33</span> <span class="token number">0.583</span>    <span class="token number">29</span>    Yes       <span class="token number">3</span>   <span class="token number">158</span>     <span class="token number">13</span> <span class="token number">0.295</span>    <span class="token number">24</span>     No<span class="token number">4</span>  <span class="token number">64</span> <span class="token number">33.2</span>       <span class="token number">4</span>   <span class="token number">117</span>     <span class="token number">27</span> <span class="token number">0.230</span>    <span class="token number">24</span>     No       <span class="token number">1</span>    <span class="token number">96</span>     <span class="token number">27</span> <span class="token number">0.289</span>    <span class="token number">21</span>     No<span class="token number">5</span>  <span class="token number">66</span> <span class="token number">38.1</span>       <span class="token number">3</span>   <span class="token number">115</span>     <span class="token number">39</span> <span class="token number">0.150</span>    <span class="token number">28</span>     No       <span class="token number">1</span>   <span class="token number">114</span>     <span class="token number">36</span> <span class="token number">0.289</span>    <span class="token number">21</span>     No<span class="token number">6</span>  <span class="token number">68</span> <span class="token number">38.5</span>       <span class="token number">2</span>   <span class="token number">100</span>     <span class="token number">25</span> <span class="token number">0.324</span>    <span class="token number">26</span>     No       <span class="token number">7</span>   <span class="token number">129</span>     <span class="token number">49</span> <span class="token number">0.439</span>    <span class="token number">43</span>    Yes<span class="token number">7</span>  <span class="token number">70</span> <span class="token number">27.4</span>       <span class="token number">1</span>   <span class="token number">116</span>     <span class="token number">28</span> <span class="token number">0.204</span>    <span class="token number">21</span>     No       <span class="token number">0</span>   <span class="token number">124</span>     <span class="token number">20</span> <span class="token number">0.254</span>    <span class="token number">36</span>    Yes<span class="token number">8</span>  <span class="token number">70</span> <span class="token number">33.1</span>       <span class="token number">4</span>    <span class="token number">91</span>     <span class="token number">32</span> <span class="token number">0.446</span>    <span class="token number">22</span>     No       <span class="token number">9</span>   <span class="token number">123</span>     <span class="token number">44</span> <span class="token number">0.374</span>    <span class="token number">40</span>     No<span class="token number">9</span>  <span class="token number">70</span> <span class="token number">35.4</span>       <span class="token number">9</span>   <span class="token number">124</span>     <span class="token number">33</span> <span class="token number">0.282</span>    <span class="token number">34</span>     No       <span class="token number">6</span>   <span class="token number">134</span>     <span class="token number">23</span> <span class="token number">0.542</span>    <span class="token number">29</span>    Yes<span class="token number">10</span> <span class="token number">72</span> <span class="token number">25.6</span>       <span class="token number">1</span>   <span class="token number">157</span>     <span class="token number">21</span> <span class="token number">0.123</span>    <span class="token number">24</span>     No       <span class="token number">4</span>    <span class="token number">99</span>     <span class="token number">17</span> <span class="token number">0.294</span>    <span class="token number">28</span>     No<span class="token number">11</span> <span class="token number">72</span> <span class="token number">37.7</span>       <span class="token number">5</span>    <span class="token number">95</span>     <span class="token number">33</span> <span class="token number">0.370</span>    <span class="token number">27</span>     No       <span class="token number">6</span>   <span class="token number">103</span>     <span class="token number">32</span> <span class="token number">0.324</span>    <span class="token number">55</span>     No<span class="token number">12</span> <span class="token number">74</span> <span class="token number">25.9</span>       <span class="token number">9</span>   <span class="token number">134</span>     <span class="token number">33</span> <span class="token number">0.460</span>    <span class="token number">81</span>     No       <span class="token number">8</span>   <span class="token number">126</span>     <span class="token number">38</span> <span class="token number">0.162</span>    <span class="token number">39</span>     No<span class="token number">13</span> <span class="token number">74</span> <span class="token number">25.9</span>       <span class="token number">1</span>    <span class="token number">95</span>     <span class="token number">21</span> <span class="token number">0.673</span>    <span class="token number">36</span>     No       <span class="token number">8</span>   <span class="token number">126</span>     <span class="token number">38</span> <span class="token number">0.162</span>    <span class="token number">39</span>     No<span class="token number">14</span> <span class="token number">78</span> <span class="token number">27.6</span>       <span class="token number">5</span>    <span class="token number">88</span>     <span class="token number">30</span> <span class="token number">0.258</span>    <span class="token number">37</span>     No       <span class="token number">6</span>   <span class="token number">125</span>     <span class="token number">31</span> <span class="token number">0.565</span>    <span class="token number">49</span>    Yes<span class="token number">15</span> <span class="token number">78</span> <span class="token number">27.6</span>      <span class="token number">10</span>   <span class="token number">122</span>     <span class="token number">31</span> <span class="token number">0.512</span>    <span class="token number">45</span>     No       <span class="token number">6</span>   <span class="token number">125</span>     <span class="token number">31</span> <span class="token number">0.565</span>    <span class="token number">49</span>    Yes<span class="token number">16</span> <span class="token number">78</span> <span class="token number">39.4</span>       <span class="token number">2</span>   <span class="token number">112</span>     <span class="token number">50</span> <span class="token number">0.175</span>    <span class="token number">24</span>     No       <span class="token number">4</span>   <span class="token number">112</span>     <span class="token number">40</span> <span class="token number">0.236</span>    <span class="token number">38</span>     No<span class="token number">17</span> <span class="token number">88</span> <span class="token number">34.5</span>       <span class="token number">1</span>   <span class="token number">117</span>     <span class="token number">24</span> <span class="token number">0.403</span>    <span class="token number">40</span>    Yes       <span class="token number">4</span>   <span class="token number">127</span>     <span class="token number">11</span> <span class="token number">0.598</span>    <span class="token number">28</span>     No<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token number">17</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p>有时，电子表格数据的格式很紧凑，可以给出每个主题的协变量，然后是该主题的所有观测值。R 的建函数需要在单个列中进行观察。考虑以下来自重复 <code>MRI</code> 脑测量的数据样本：</p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r">Status   Age    V1     V2     V3    V4     P <span class="token number">23646</span> <span class="token number">45190</span>  <span class="token number">50333</span>  <span class="token number">55166</span> <span class="token number">56271</span>    CC <span class="token number">26174</span> <span class="token number">35535</span>  <span class="token number">38227</span>  <span class="token number">37911</span> <span class="token number">41184</span>    CC <span class="token number">27723</span> <span class="token number">25691</span>  <span class="token number">25712</span>  <span class="token number">26144</span> <span class="token number">26398</span>    CC <span class="token number">27193</span> <span class="token number">30949</span>  <span class="token number">29693</span>  <span class="token number">29754</span> <span class="token number">30772</span>    CC <span class="token number">24370</span> <span class="token number">50542</span>  <span class="token number">51966</span>  <span class="token number">54341</span> <span class="token number">54273</span>    CC <span class="token number">28359</span> <span class="token number">58591</span>  <span class="token number">58803</span>  <span class="token number">59435</span> <span class="token number">61292</span>    CC <span class="token number">25136</span> <span class="token number">45801</span>  <span class="token number">45389</span>  <span class="token number">47197</span> <span class="token number">47126</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p>在每个主题上有两个协变量和多达四个测量值。数据从 Excel 导出为 <code>mr.csv</code> 文件。</p><p>我们可以使用堆栈来帮助操纵这些数据以给出单个响应。</p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r">zz <span class="token operator">&lt;-</span> read.csv<span class="token punctuation">(</span><span class="token string">"mr.csv"</span><span class="token punctuation">,</span> strip.white <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">)</span>zzz <span class="token operator">&lt;-</span> cbind<span class="token punctuation">(</span>zz<span class="token punctuation">[</span>gl<span class="token punctuation">(</span>nrow<span class="token punctuation">(</span>zz<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token operator">*</span>nrow<span class="token punctuation">(</span>zz<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> stack<span class="token punctuation">(</span>zz<span class="token punctuation">[</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token operator">:</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment"># 当我们执行上面的代码，它产生以下结果：</span>      Status   Age values indX1         P <span class="token number">23646</span>  <span class="token number">45190</span>  V1X2        CC <span class="token number">26174</span>  <span class="token number">35535</span>  V1X3        CC <span class="token number">27723</span>  <span class="token number">25691</span>  V1X4        CC <span class="token number">27193</span>  <span class="token number">30949</span>  V1X5        CC <span class="token number">24370</span>  <span class="token number">50542</span>  V1X6        CC <span class="token number">28359</span>  <span class="token number">58591</span>  V1X7        CC <span class="token number">25136</span>  <span class="token number">45801</span>  V1X11        P <span class="token number">23646</span>  <span class="token number">50333</span>  V2<span class="token ellipsis">...</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p>函数 <code>unstack</code> 的方向相反，可能对导出数据很有用。</p><p>另一种方法是使用函数重塑</p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r">reshape<span class="token punctuation">(</span>zz<span class="token punctuation">,</span> idvar<span class="token operator">=</span><span class="token string">"id"</span><span class="token punctuation">,</span> timevar<span class="token operator">=</span><span class="token string">"var"</span><span class="token punctuation">,</span> varying<span class="token operator">=</span>list<span class="token punctuation">(</span>c<span class="token punctuation">(</span><span class="token string">"V1"</span><span class="token punctuation">,</span> <span class="token string">"V2"</span><span class="token punctuation">,</span> <span class="token string">"V3"</span><span class="token punctuation">,</span> <span class="token string">"V4"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> direction<span class="token operator">=</span><span class="token string">"long"</span><span class="token punctuation">)</span><span class="token comment"># 当我们执行上面的代码，它产生以下结果：</span>    Status   Age var    V1 id<span class="token number">1.1</span>      P <span class="token number">23646</span>   <span class="token number">1</span> <span class="token number">45190</span>  <span class="token number">1</span><span class="token number">2.1</span>     CC <span class="token number">26174</span>   <span class="token number">1</span> <span class="token number">35535</span>  <span class="token number">2</span><span class="token number">3.1</span>     CC <span class="token number">27723</span>   <span class="token number">1</span> <span class="token number">25691</span>  <span class="token number">3</span><span class="token number">4.1</span>     CC <span class="token number">27193</span>   <span class="token number">1</span> <span class="token number">30949</span>  <span class="token number">4</span><span class="token number">5.1</span>     CC <span class="token number">24370</span>   <span class="token number">1</span> <span class="token number">50542</span>  <span class="token number">5</span><span class="token number">6.1</span>     CC <span class="token number">28359</span>   <span class="token number">1</span> <span class="token number">58591</span>  <span class="token number">6</span><span class="token number">7.1</span>     CC <span class="token number">25136</span>   <span class="token number">1</span> <span class="token number">45801</span>  <span class="token number">7</span><span class="token number">1.2</span>      P <span class="token number">23646</span>   <span class="token number">2</span> <span class="token number">50333</span>  <span class="token number">1</span><span class="token number">2.2</span>     CC <span class="token number">26174</span>   <span class="token number">2</span> <span class="token number">38227</span>  <span class="token number">2</span><span class="token ellipsis">...</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p>重塑函数的语法比堆栈更复杂，但可以用于 <code>long</code> 表单中不止一列的数据。如果 <code>direction=&quot;width&quot;</code>，重塑还可以执行相反的转换。</p><h1 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h1><p>函数是一组组合在一起以执行特定任务的语句。R 语言具有大量内置函数，用户可以创建自己的函数。</p><p>在 R 语言中，函数是一个对象，因此 R 语言解释器能够将控制传递给函数，以及函数完成动作所需的参数。</p><p>该函数依次执行其任务并将控制返回到解释器以及可以存储在其他对象中的任何结果。</p><h2 id="函数定义"><a href="#函数定义" class="headerlink" title="函数定义"></a>函数定义</h2><p>使用关键字函数创建 R 语言的函数。R 语言的函数定义的基本语法如下</p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r">function_name <span class="token operator">&lt;-</span> <span class="token keyword">function</span><span class="token punctuation">(</span>arg_1<span class="token punctuation">,</span> arg_2<span class="token punctuation">,</span> <span class="token ellipsis">...</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>   Function body<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></p><h2 id="函数组件"><a href="#函数组件" class="headerlink" title="函数组件"></a>函数组件</h2><p>函数的不同部分：</p><ul><li><strong>函数名称</strong>：这是函数的实际名称。它作为具有此名称的对象存储在 R 环境中。</li><li><strong>参数</strong>：参数是一个占位符。当函数被调用时，你传递一个值到参数。参数是可选的，也就是说，一个函数可能不包含参数。参数也可以有默认值。</li><li><strong>函数体</strong>：函数体包含定义函数的语句集合。</li><li><strong>返回值</strong>：函数的返回值是要评估的函数体中的最后一个表达式。</li></ul><p>R 语言有许多内置函数，可以在程序中直接调用而无需先定义它们。我们还可以创建和使用我们自己的函数，称为用户定义的函数。</p><h2 id="内置函数"><a href="#内置函数" class="headerlink" title="内置函数"></a>内置函数</h2><p>内置函数的简单示例是 <code>seq()</code>，<code>mean()</code>，<code>max()</code>，<code>sum(x)</code> 和 <code>paste(...)</code> 等。它们由用户编写的程序直接调用。您可以参考最广泛使用的 R 函数。</p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r"><span class="token comment"># Create a sequence of numbers from 32 to 44.</span>print<span class="token punctuation">(</span>seq<span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">44</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment"># Find mean of numbers from 25 to 82.</span>print<span class="token punctuation">(</span>mean<span class="token punctuation">(</span><span class="token number">25</span><span class="token operator">:</span><span class="token number">82</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment"># Find sum of numbers frm 41 to 68.</span>print<span class="token punctuation">(</span>sum<span class="token punctuation">(</span><span class="token number">41</span><span class="token operator">:</span><span class="token number">68</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment"># 当我们执行上面的代码，它产生以下结果：</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token number">32</span> <span class="token number">33</span> <span class="token number">34</span> <span class="token number">35</span> <span class="token number">36</span> <span class="token number">37</span> <span class="token number">38</span> <span class="token number">39</span> <span class="token number">40</span> <span class="token number">41</span> <span class="token number">42</span> <span class="token number">43</span> <span class="token number">44</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token number">53.5</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token number">1526</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h2 id="用户定义的函数"><a href="#用户定义的函数" class="headerlink" title="用户定义的函数"></a>用户定义的函数</h2><p>我们可以在 R 语言中创建用户定义的函数。它们特定于用户想要的，一旦创建，它们就可以像内置函数一样使用。下面是一个创建和使用函数的例子。</p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r"><span class="token comment"># Create a function to print squares of numbers in sequence.</span>new.<span class="token keyword">function</span> <span class="token operator">&lt;-</span> <span class="token keyword">function</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>   <span class="token keyword">for</span><span class="token punctuation">(</span>i <span class="token keyword">in</span> <span class="token number">1</span><span class="token operator">:</span>a<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      b <span class="token operator">&lt;-</span> i<span class="token operator">^</span><span class="token number">2</span>      print<span class="token punctuation">(</span>b<span class="token punctuation">)</span>   <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h2 id="调用函数"><a href="#调用函数" class="headerlink" title="调用函数"></a>调用函数</h2><p><pre class="line-numbers language-r" data-language="r"><code class="language-r"><span class="token comment"># Create a function to print squares of numbers in sequence.</span>new.<span class="token keyword">function</span> <span class="token operator">&lt;-</span> <span class="token keyword">function</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>   <span class="token keyword">for</span><span class="token punctuation">(</span>i <span class="token keyword">in</span> <span class="token number">1</span><span class="token operator">:</span>a<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      b <span class="token operator">&lt;-</span> i<span class="token operator">^</span><span class="token number">2</span>      print<span class="token punctuation">(</span>b<span class="token punctuation">)</span>   <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token comment"># Call the function new.function supplying 6 as an argument.</span>new.<span class="token keyword">function</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token comment"># 当我们执行上面的代码，它产生以下结果：</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token number">1</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token number">4</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token number">9</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token number">16</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h2 id="调用没有参数的函数"><a href="#调用没有参数的函数" class="headerlink" title="调用没有参数的函数"></a>调用没有参数的函数</h2><p><pre class="line-numbers language-r" data-language="r"><code class="language-r"><span class="token comment"># Create a function without an argument.</span>new.<span class="token keyword">function</span> <span class="token operator">&lt;-</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>   <span class="token keyword">for</span><span class="token punctuation">(</span>i <span class="token keyword">in</span> <span class="token number">1</span><span class="token operator">:</span><span class="token number">5</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      print<span class="token punctuation">(</span>i<span class="token operator">^</span><span class="token number">2</span><span class="token punctuation">)</span>   <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token comment"># Call the function without supplying an argument.</span>new.<span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment"># 当我们执行上面的代码，它产生以下结果：</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token number">1</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token number">4</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token number">9</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token number">16</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token number">25</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h2 id="使用参数值调用函数（按位置和名称）"><a href="#使用参数值调用函数（按位置和名称）" class="headerlink" title="使用参数值调用函数（按位置和名称）"></a>使用参数值调用函数（按位置和名称）</h2><p>函数调用的参数可以按照函数中定义的顺序提供，也可以以不同的顺序提供，但分配给参数的名称。</p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r"><span class="token comment"># Create a function with arguments.</span>new.<span class="token keyword">function</span> <span class="token operator">&lt;-</span> <span class="token keyword">function</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>   result <span class="token operator">&lt;-</span> a <span class="token operator">*</span> b <span class="token operator">+</span> c   print<span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token comment"># Call the function by position of arguments.</span>new.<span class="token keyword">function</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">)</span><span class="token comment"># Call the function by names of the arguments.</span>new.<span class="token keyword">function</span><span class="token punctuation">(</span>a <span class="token operator">=</span> <span class="token number">11</span><span class="token punctuation">,</span> b <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">,</span> c <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token comment"># 当我们执行上面的代码，它产生以下结果：</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token number">26</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token number">58</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h2 id="使用默认参数调用函数"><a href="#使用默认参数调用函数" class="headerlink" title="使用默认参数调用函数"></a>使用默认参数调用函数</h2><p>我们可以在函数定义中定义参数的值，并调用函数而不提供任何参数以获取默认结果。但是我们也可以通过提供参数的新值来获得非默认结果来调用这样的函数。</p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r"><span class="token comment"># Create a function with arguments.</span>new.<span class="token keyword">function</span> <span class="token operator">&lt;-</span> <span class="token keyword">function</span><span class="token punctuation">(</span>a <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">,</span> b <span class="token operator">=</span> <span class="token number">6</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>   result <span class="token operator">&lt;-</span> a <span class="token operator">*</span> b   print<span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token comment"># Call the function without giving any argument.</span>new.<span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment"># Call the function with giving new values of the argument.</span>new.<span class="token keyword">function</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token comment"># 当我们执行上面的代码，它产生以下结果：</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token number">18</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token number">45</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h2 id="函数的延迟计算"><a href="#函数的延迟计算" class="headerlink" title="函数的延迟计算"></a>函数的延迟计算</h2><p>对函数的参数进行延迟评估，这意味着它们只有在函数体需要时才进行评估。</p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r"><span class="token comment"># Create a function with arguments.</span>new.<span class="token keyword">function</span> <span class="token operator">&lt;-</span> <span class="token keyword">function</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>   print<span class="token punctuation">(</span>a<span class="token operator">^</span><span class="token number">2</span><span class="token punctuation">)</span>   print<span class="token punctuation">(</span>a<span class="token punctuation">)</span>   print<span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token comment"># Evaluate the function without supplying one of the arguments.</span>new.<span class="token keyword">function</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token comment"># 当我们执行上面的代码，它产生以下结果：</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token number">36</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token number">6</span>Error <span class="token keyword">in</span> print<span class="token punctuation">(</span>b<span class="token punctuation">)</span> <span class="token operator">:</span> argument <span class="token string">"b"</span> is missing<span class="token punctuation">,</span> with no default<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h1 id="字符串"><a href="#字符串" class="headerlink" title="字符串"></a>字符串</h1><p>在 R 语言中的单引号或双引号对中写入的任何值都被视为字符串。R 语言存储的每个字符串都在双引号内，即使是使用单引号创建的依旧如此。</p><h2 id="字符串构造规则"><a href="#字符串构造规则" class="headerlink" title="字符串构造规则"></a>字符串构造规则</h2><p>在字符串的开头和结尾的引号应该是两个双引号或两个单引号。它们不能被混合。</p><ul><li>双引号可以插入以单引号开头和结尾的字符串中。</li><li>单引号可以插入以双引号开头和结尾的字符串中。</li><li>双引号不能插入以双引号开头和结尾的字符串中。</li><li>单引号不能插入以单引号开头和结尾的字符串中。</li></ul><p><strong>有效字符串的示例</strong></p><p>以下示例阐明了在 R 语言中创建字符串的规则。</p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r">a <span class="token operator">&lt;-</span> <span class="token string">'Start and end with single quote'</span>print<span class="token punctuation">(</span>a<span class="token punctuation">)</span>b <span class="token operator">&lt;-</span> <span class="token string">"Start and end with double quotes"</span>print<span class="token punctuation">(</span>b<span class="token punctuation">)</span>c <span class="token operator">&lt;-</span> <span class="token string">"single quote ' in between double quotes"</span>print<span class="token punctuation">(</span>c<span class="token punctuation">)</span>d <span class="token operator">&lt;-</span> <span class="token string">'Double quotes " in between single quote'</span>print<span class="token punctuation">(</span>d<span class="token punctuation">)</span><span class="token comment"># 当我们执行上面的代码，它产生以下结果：</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token string">"Start and end with single quote"</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token string">"Start and end with double quotes"</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token string">"single quote ' in between double quote"</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token string">"Double quote "</span> <span class="token keyword">in</span> between single quote"<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p><strong>无效字符串的示例</strong></p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r">e <span class="token operator">&lt;-</span> 'Mixed quotes"print<span class="token punctuation">(</span>e<span class="token punctuation">)</span>f <span class="token operator">&lt;-</span> <span class="token string">'Single quote '</span> inside single quote'print<span class="token punctuation">(</span>f<span class="token punctuation">)</span>g <span class="token operator">&lt;-</span> <span class="token string">"Double quotes "</span> inside double quotes"print<span class="token punctuation">(</span>g<span class="token punctuation">)</span><span class="token comment"># 当我们运行脚本失败给下面的结果：</span><span class="token ellipsis">...</span><span class="token operator">:</span> unexpected INCOMPLETE_STRING<span class="token ellipsis">...</span>. unexpected symbol <span class="token number">1</span><span class="token operator">:</span> f <span class="token operator">&lt;-</span> <span class="token string">'Single quote '</span> insideunexpected symbol<span class="token number">1</span><span class="token operator">:</span> g <span class="token operator">&lt;-</span> <span class="token string">"Double quotes "</span> inside<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h2 id="字符串操作"><a href="#字符串操作" class="headerlink" title="字符串操作"></a>字符串操作</h2><h3 id="连接字符串"><a href="#连接字符串" class="headerlink" title="连接字符串"></a>连接字符串</h3><p>R 语言中的许多字符串使用 <code>paste()</code> 函数组合。它可以采取任何数量的参数组合在一起。</p><p><strong>语法</strong></p><p>函数的基本语法是：</p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r">paste<span class="token punctuation">(</span><span class="token ellipsis">...</span><span class="token punctuation">,</span> sep <span class="token operator">=</span> <span class="token string">" "</span><span class="token punctuation">,</span> collapse <span class="token operator">=</span> <span class="token keyword">NULL</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><p>以下是所使用的参数的说明：</p><ul><li><code>...</code>表示要组合的任意数量的自变量。</li><li><code>sep</code> 表示参数之间的任何分隔符。它是可选的。</li><li><code>collapse</code> 用于消除两个字符串之间的空格。但不是一个字符串的两个字内的空间。</li></ul><p><strong>实例</strong></p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r">a <span class="token operator">&lt;-</span> <span class="token string">"Hello"</span>b <span class="token operator">&lt;-</span> <span class="token string">'How'</span>c <span class="token operator">&lt;-</span> <span class="token string">"are you? "</span>print<span class="token punctuation">(</span>paste<span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c<span class="token punctuation">)</span><span class="token punctuation">)</span>print<span class="token punctuation">(</span>paste<span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c<span class="token punctuation">,</span> sep <span class="token operator">=</span> <span class="token string">"-"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>print<span class="token punctuation">(</span>paste<span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c<span class="token punctuation">,</span> sep <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">,</span> collapse <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment"># 当我们执行上面的代码，它产生以下结果：</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token string">"Hello How are you? "</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token string">"Hello-How-are you? "</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token string">"HelloHoware you? "</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h3 id="格式化数字和字符串"><a href="#格式化数字和字符串" class="headerlink" title="格式化数字和字符串"></a>格式化数字和字符串</h3><p>可以使用 <code>format()</code> 函数将数字和字符串格式化为特定样式。</p><p><strong>语法</strong></p><p>函数的基本语法是：</p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r">format<span class="token punctuation">(</span>x<span class="token punctuation">,</span> digits<span class="token punctuation">,</span> nsmall<span class="token punctuation">,</span> scientific<span class="token punctuation">,</span> width<span class="token punctuation">,</span> justify <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token string">"left"</span><span class="token punctuation">,</span> <span class="token string">"right"</span><span class="token punctuation">,</span> <span class="token string">"centre"</span><span class="token punctuation">,</span> <span class="token string">"none"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><p>以下是所使用的参数的说明：</p><ul><li><code>x</code> 是向量输入。</li><li><code>digits</code> 是显示的总位数。</li><li><code>nsmall</code> 是小数点右边的最小位数。</li><li><code>scientific</code> 设置为 <code>TRUE</code> 以科学记数法显示。</li><li><code>width</code> 指示通过在开始处填充空白来显示的最小宽度。</li><li><code>justify</code> 是字符串向左，右或中心的显示。</li></ul><p><strong>实例</strong></p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r"><span class="token comment"># Total number of digits displayed. Last digit rounded off.</span>result <span class="token operator">&lt;-</span> format<span class="token punctuation">(</span><span class="token number">23.123456789</span><span class="token punctuation">,</span> digits <span class="token operator">=</span> <span class="token number">9</span><span class="token punctuation">)</span>print<span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token comment"># Display numbers in scientific notation.</span>result <span class="token operator">&lt;-</span> format<span class="token punctuation">(</span>c<span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">13.14521</span><span class="token punctuation">)</span><span class="token punctuation">,</span> scientific <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">)</span>print<span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token comment"># The minimum number of digits to the right of the decimal point.</span>result <span class="token operator">&lt;-</span> format<span class="token punctuation">(</span><span class="token number">23.47</span><span class="token punctuation">,</span> nsmall <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">)</span>print<span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token comment"># Format treats everything as a string.</span>result <span class="token operator">&lt;-</span> format<span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span>print<span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token comment"># Numbers are padded with blank in the beginning for width.</span>result <span class="token operator">&lt;-</span> format<span class="token punctuation">(</span><span class="token number">13.7</span><span class="token punctuation">,</span> width <span class="token operator">=</span> <span class="token number">6</span><span class="token punctuation">)</span>print<span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token comment"># Left justify strings.</span>result <span class="token operator">&lt;-</span> format<span class="token punctuation">(</span><span class="token string">"Hello"</span><span class="token punctuation">,</span> width <span class="token operator">=</span> <span class="token number">8</span><span class="token punctuation">,</span> justify <span class="token operator">=</span> <span class="token string">"l"</span><span class="token punctuation">)</span>print<span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token comment"># Justfy string with center.</span>result <span class="token operator">&lt;-</span> format<span class="token punctuation">(</span><span class="token string">"Hello"</span><span class="token punctuation">,</span> width <span class="token operator">=</span> <span class="token number">8</span><span class="token punctuation">,</span> justify <span class="token operator">=</span> <span class="token string">"c"</span><span class="token punctuation">)</span>print<span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token comment"># 当我们执行上面的代码，它产生以下结果：</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token string">"23.1234568"</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token string">"6.000000e+00"</span> <span class="token string">"1.314521e+01"</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token string">"23.47000"</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token string">"6"</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token string">"  13.7"</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token string">"Hello   "</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token string">" Hello  "</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h3 id="计算字符串中的字符数"><a href="#计算字符串中的字符数" class="headerlink" title="计算字符串中的字符数"></a>计算字符串中的字符数</h3><p><code>nchar()</code> 函数可以计算字符串中包含空格的字符数。</p><p><strong>语法</strong></p><p>函数的基本语法是：</p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r">nchar<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><p>以下是所使用的参数的说明：</p><ul><li><code>x</code> 是向量输入。</li></ul><p><strong>实例</strong></p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r">result <span class="token operator">&lt;-</span> nchar<span class="token punctuation">(</span><span class="token string">"Count the number of characters"</span><span class="token punctuation">)</span>print<span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token comment"># 当我们执行上面的代码，它产生以下结果：</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token number">30</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h3 id="更改大小写"><a href="#更改大小写" class="headerlink" title="更改大小写"></a>更改大小写</h3><p>使用 <code>toupper()</code> 和 <code>tolower()</code> 函数可以改变字符串的字符的大小写。</p><p><strong>语法</strong></p><p>函数的基本语法是：</p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r">toupper<span class="token punctuation">(</span>x<span class="token punctuation">)</span>tolower<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></p><p>以下是所使用的参数的说明：</p><ul><li><code>x</code> 是向量输入。</li></ul><p><strong>实例</strong></p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r"><span class="token comment"># Changing to Upper case.</span>result <span class="token operator">&lt;-</span> toupper<span class="token punctuation">(</span><span class="token string">"Changing To Upper"</span><span class="token punctuation">)</span>print<span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token comment"># Changing to lower case.</span>result <span class="token operator">&lt;-</span> tolower<span class="token punctuation">(</span><span class="token string">"Changing To Lower"</span><span class="token punctuation">)</span>print<span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token comment"># 当我们执行上面的代码，它产生以下结果：</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token string">"CHANGING TO UPPER"</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token string">"changing to lower"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h3 id="提取字符串"><a href="#提取字符串" class="headerlink" title="提取字符串"></a>提取字符串</h3><p><code>substring()</code> 函数可以用于提取字符串的部分。</p><p><strong>语法</strong></p><p>函数的基本语法是：</p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r">substring<span class="token punctuation">(</span>x<span class="token punctuation">,</span> first<span class="token punctuation">,</span> last<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><p>以下是所使用的参数的说明：</p><ul><li><code>x</code> 是字符向量输入。</li><li><code>first</code> 是要提取的第一个字符的位置。</li><li><code>last</code> 是要提取的最后一个字符的位置。</li></ul><p><strong>实例</strong></p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r"><span class="token comment"># Extract characters from 5th to 7th position.</span>result <span class="token operator">&lt;-</span> substring<span class="token punctuation">(</span><span class="token string">"Extract"</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span>print<span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token comment"># 当我们执行上面的代码，它产生以下结果：</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token string">"act"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h1 id="向量"><a href="#向量" class="headerlink" title="向量"></a>向量</h1><p>向量是最基本的 R 语言数据对象，有六种类型的原子向量。它们是逻辑，整数，双精度，复杂，字符和原始。</p><h2 id="创建向量"><a href="#创建向量" class="headerlink" title="创建向量"></a>创建向量</h2><h3 id="单元素向量"><a href="#单元素向量" class="headerlink" title="单元素向量"></a>单元素向量</h3><p>即使在 R 语言中只写入一个值，它也将成为长度为 <code>1</code> 的向量，并且属于上述向量类型之一。</p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r"><span class="token comment"># Atomic vector of type character.</span>print<span class="token punctuation">(</span><span class="token string">"abc"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment"># Atomic vector of type double.</span>print<span class="token punctuation">(</span><span class="token number">12.5</span><span class="token punctuation">)</span><span class="token comment"># Atomic vector of type integer.</span>print<span class="token punctuation">(</span><span class="token number">63L</span><span class="token punctuation">)</span><span class="token comment"># Atomic vector of type logical.</span>print<span class="token punctuation">(</span><span class="token boolean">TRUE</span><span class="token punctuation">)</span><span class="token comment"># Atomic vector of type complex.</span>print<span class="token punctuation">(</span><span class="token number">2</span><span class="token operator">+</span><span class="token number">3i</span><span class="token punctuation">)</span><span class="token comment"># Atomic vector of type raw.</span>print<span class="token punctuation">(</span>charToRaw<span class="token punctuation">(</span><span class="token string">'hello'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment"># 当我们执行上面的代码，它产生以下结果：</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token string">"abc"</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token number">12.5</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token number">63</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token boolean">TRUE</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token number">2</span><span class="token operator">+</span><span class="token number">3i</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token number">68</span> <span class="token number">65</span> <span class="token number">6</span>c <span class="token number">6</span>c <span class="token number">6</span>f<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h3 id="多元素向量"><a href="#多元素向量" class="headerlink" title="多元素向量"></a>多元素向量</h3><p>对数值数据使用冒号运算符</p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r"><span class="token comment"># Creating a sequence from 5 to 13.</span>v <span class="token operator">&lt;-</span> <span class="token number">5</span><span class="token operator">:</span><span class="token number">13</span>print<span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token comment"># Creating a sequence from 6.6 to 12.6.</span>v <span class="token operator">&lt;-</span> <span class="token number">6.6</span><span class="token operator">:</span><span class="token number">12.6</span>print<span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token comment"># If the final element specified does not belong to the sequence then it is discarded.</span>v <span class="token operator">&lt;-</span> <span class="token number">3.8</span><span class="token operator">:</span><span class="token number">11.4</span>print<span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token comment"># 当我们执行上面的代码，它产生以下结果：</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>  <span class="token number">5</span>  <span class="token number">6</span>  <span class="token number">7</span>  <span class="token number">8</span>  <span class="token number">9</span> <span class="token number">10</span> <span class="token number">11</span> <span class="token number">12</span> <span class="token number">13</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>  <span class="token number">6.6</span>  <span class="token number">7.6</span>  <span class="token number">8.6</span>  <span class="token number">9.6</span> <span class="token number">10.6</span> <span class="token number">11.6</span> <span class="token number">12.6</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>  <span class="token number">3.8</span>  <span class="token number">4.8</span>  <span class="token number">5.8</span>  <span class="token number">6.8</span>  <span class="token number">7.8</span>  <span class="token number">8.8</span>  <span class="token number">9.8</span> <span class="token number">10.8</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p><strong>使用 <code>sequence (Seq.)</code> 序列运算符</strong></p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r"><span class="token comment"># Create vector with elements from 5 to 9 incrementing by 0.4.</span>print<span class="token punctuation">(</span>seq<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> by <span class="token operator">=</span> <span class="token number">0.4</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment"># 当我们执行上面的代码，它产生以下结果：</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token number">5.0</span> <span class="token number">5.4</span> <span class="token number">5.8</span> <span class="token number">6.2</span> <span class="token number">6.6</span> <span class="token number">7.0</span> <span class="token number">7.4</span> <span class="token number">7.8</span> <span class="token number">8.2</span> <span class="token number">8.6</span> <span class="token number">9.0</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p><strong>使用 <code>C()</code> 函数</strong></p><p>如果其中一个元素是字符，则非字符值被强制转换为字符类型。</p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r"><span class="token comment"># The logical and numeric values are converted to characters.</span>s <span class="token operator">&lt;-</span> c<span class="token punctuation">(</span><span class="token string">'apple'</span><span class="token punctuation">,</span> <span class="token string">'red'</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token boolean">TRUE</span><span class="token punctuation">)</span>print<span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token comment"># 当我们执行上面的代码，它产生以下结果：</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token string">"apple"</span> <span class="token string">"red"</span>  <span class="token string">"5"</span>  <span class="token string">"TRUE"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h2 id="访问向量元素"><a href="#访问向量元素" class="headerlink" title="访问向量元素"></a>访问向量元素</h2><p>使用索引访问向量的元素。<code>[]</code> 括号用于建立索引。索引从位置 <code>1</code> 开始。在索引中给出负值会丢弃，<code>TRUE</code>，<code>FALSE</code> 或 <code>0</code> 和 <code>1</code> 的元素，也可用于索引。</p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r"><span class="token comment"># Accessing vector elements using position.</span>t <span class="token operator">&lt;-</span> c<span class="token punctuation">(</span><span class="token string">"Sun"</span><span class="token punctuation">,</span> <span class="token string">"Mon"</span><span class="token punctuation">,</span> <span class="token string">"Tue"</span><span class="token punctuation">,</span> <span class="token string">"Wed"</span><span class="token punctuation">,</span> <span class="token string">"Thurs"</span><span class="token punctuation">,</span> <span class="token string">"Fri"</span><span class="token punctuation">,</span> <span class="token string">"Sat"</span><span class="token punctuation">)</span>u <span class="token operator">&lt;-</span> t<span class="token punctuation">[</span>c<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">]</span>print<span class="token punctuation">(</span>u<span class="token punctuation">)</span><span class="token comment"># Accessing vector elements using logical indexing.</span>v <span class="token operator">&lt;-</span> t<span class="token punctuation">[</span>c<span class="token punctuation">(</span><span class="token boolean">TRUE</span><span class="token punctuation">,</span> <span class="token boolean">FALSE</span><span class="token punctuation">,</span> <span class="token boolean">FALSE</span><span class="token punctuation">,</span> <span class="token boolean">FALSE</span><span class="token punctuation">,</span> <span class="token boolean">FALSE</span><span class="token punctuation">,</span> <span class="token boolean">TRUE</span><span class="token punctuation">,</span> <span class="token boolean">FALSE</span><span class="token punctuation">)</span><span class="token punctuation">]</span>print<span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token comment"># Accessing vector elements using negative indexing.</span>x <span class="token operator">&lt;-</span> t<span class="token punctuation">[</span>c<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">]</span>print<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token comment"># Accessing vector elements using 0/1 indexing.</span>y <span class="token operator">&lt;-</span> t<span class="token punctuation">[</span>c<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span>print<span class="token punctuation">(</span>y<span class="token punctuation">)</span><span class="token comment"># 当我们执行上面的代码，它产生以下结果：</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token string">"Mon"</span> <span class="token string">"Tue"</span> <span class="token string">"Fri"</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token string">"Sun"</span> <span class="token string">"Fri"</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token string">"Sun"</span> <span class="token string">"Tue"</span> <span class="token string">"Wed"</span> <span class="token string">"Fri"</span> <span class="token string">"Sat"</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token string">"Sun"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h2 id="向量操作"><a href="#向量操作" class="headerlink" title="向量操作"></a>向量操作</h2><h3 id="向量运算"><a href="#向量运算" class="headerlink" title="向量运算"></a>向量运算</h3><p>可以加，减，乘，除两个相同长度的向量，将结果作为向量输出。</p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r"><span class="token comment"># Create two vectors.</span>v1 <span class="token operator">&lt;-</span> c<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">)</span>v2 <span class="token operator">&lt;-</span> c<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token comment"># Vector addition.</span>add.result <span class="token operator">&lt;-</span> v1 <span class="token operator">+</span> v2print<span class="token punctuation">(</span>add.result<span class="token punctuation">)</span><span class="token comment"># Vector substraction.</span>sub.result <span class="token operator">&lt;-</span> v1 <span class="token operator">-</span> v2print<span class="token punctuation">(</span>sub.result<span class="token punctuation">)</span><span class="token comment"># Vector multiplication.</span>multi.result <span class="token operator">&lt;-</span> v1 <span class="token operator">*</span> v2print<span class="token punctuation">(</span>multi.result<span class="token punctuation">)</span><span class="token comment"># Vector division.</span>divi.result <span class="token operator">&lt;-</span> v1 <span class="token operator">/</span> v2print<span class="token punctuation">(</span>divi.result<span class="token punctuation">)</span><span class="token comment"># 当我们执行上面的代码，它产生以下结果：</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>  <span class="token number">7</span> <span class="token number">19</span>  <span class="token number">4</span> <span class="token number">13</span>  <span class="token number">1</span> <span class="token number">13</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">-</span><span class="token number">3</span>  <span class="token number">4</span> <span class="token operator">-</span><span class="token number">3</span> <span class="token operator">-</span><span class="token number">1</span>  <span class="token number">9</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token number">12</span> <span class="token number">88</span>  <span class="token number">0</span> <span class="token number">40</span>  <span class="token number">0</span> <span class="token number">22</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token number">0.7500000</span> <span class="token number">0.7272727</span>       <span class="token number">Inf</span> <span class="token number">0.6250000</span> <span class="token number">0.0000000</span> <span class="token number">5.5000000</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h3 id="向量元素回收"><a href="#向量元素回收" class="headerlink" title="向量元素回收"></a>向量元素回收</h3><p>如果我们对不等长的两个向量应用算术运算，则较短向量的元素被循环以完成操作。</p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r">v1 <span class="token operator">&lt;-</span> c<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">)</span>v2 <span class="token operator">&lt;-</span> c<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">)</span><span class="token comment"># V2 becomes c(4, 11, 4, 11, 4, 11)</span>add.result <span class="token operator">&lt;-</span> v1 <span class="token operator">+</span> v2print<span class="token punctuation">(</span>add.result<span class="token punctuation">)</span>sub.result <span class="token operator">&lt;-</span> v1 <span class="token operator">-</span> v2print<span class="token punctuation">(</span>sub.result<span class="token punctuation">)</span><span class="token comment"># 当我们执行上面的代码，它产生以下结果：</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>  <span class="token number">7</span> <span class="token number">19</span>  <span class="token number">8</span> <span class="token number">16</span>  <span class="token number">4</span> <span class="token number">22</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">-</span><span class="token number">3</span>  <span class="token number">0</span> <span class="token operator">-</span><span class="token number">6</span> <span class="token operator">-</span><span class="token number">4</span>  <span class="token number">0</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h3 id="向量元素排序"><a href="#向量元素排序" class="headerlink" title="向量元素排序"></a>向量元素排序</h3><p>向量中的元素可以使用 <code>sort()</code> 函数排序。</p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r">v <span class="token operator">&lt;-</span> c<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">304</span><span class="token punctuation">)</span><span class="token comment"># Sort the elements of the vector.</span>sort.result <span class="token operator">&lt;-</span> sort<span class="token punctuation">(</span>v<span class="token punctuation">)</span>print<span class="token punctuation">(</span>sort.result<span class="token punctuation">)</span><span class="token comment"># Sort the elements in the reverse order.</span>revsort.result <span class="token operator">&lt;-</span> sort<span class="token punctuation">(</span>v<span class="token punctuation">,</span> decreasing <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">)</span>print<span class="token punctuation">(</span>revsort.result<span class="token punctuation">)</span><span class="token comment"># Sorting character vectors.</span>v <span class="token operator">&lt;-</span> c<span class="token punctuation">(</span><span class="token string">"Red"</span><span class="token punctuation">,</span> <span class="token string">"Blue"</span><span class="token punctuation">,</span> <span class="token string">"yellow"</span><span class="token punctuation">,</span> <span class="token string">"violet"</span><span class="token punctuation">)</span>sort.result <span class="token operator">&lt;-</span> sort<span class="token punctuation">(</span>v<span class="token punctuation">)</span>print<span class="token punctuation">(</span>sort.result<span class="token punctuation">)</span><span class="token comment"># Sorting character vectors in reverse order.</span>revsort.result <span class="token operator">&lt;-</span> sort<span class="token punctuation">(</span>v<span class="token punctuation">,</span> decreasing <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">)</span>print<span class="token punctuation">(</span>revsort.result<span class="token punctuation">)</span><span class="token comment"># 当我们执行上面的代码，它产生以下结果：</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>  <span class="token operator">-</span><span class="token number">9</span>   <span class="token number">0</span>   <span class="token number">3</span>   <span class="token number">4</span>   <span class="token number">5</span>   <span class="token number">8</span>  <span class="token number">11</span> <span class="token number">304</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token number">304</span>  <span class="token number">11</span>   <span class="token number">8</span>   <span class="token number">5</span>   <span class="token number">4</span>   <span class="token number">3</span>   <span class="token number">0</span>  <span class="token operator">-</span><span class="token number">9</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token string">"Blue"</span>   <span class="token string">"Red"</span>    <span class="token string">"violet"</span> <span class="token string">"yellow"</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token string">"yellow"</span> <span class="token string">"violet"</span> <span class="token string">"Red"</span>    <span class="token string">"Blue"</span> <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h1 id="列表"><a href="#列表" class="headerlink" title="列表"></a>列表</h1><p>列表是 R 语言对象，它包含不同类型的元素，如数字，字符串，向量和其中的另一个列表。列表还可以包含矩阵或函数作为其元素。列表是使用 <code>list()</code> 函数创建的。</p><h2 id="创建列表"><a href="#创建列表" class="headerlink" title="创建列表"></a>创建列表</h2><p>以下是创建包含字符串，数字，向量和逻辑值的列表的示例</p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r"><span class="token comment"># Create a list containing strings, numbers, vectors and a logical values.</span>list_data <span class="token operator">&lt;-</span> list<span class="token punctuation">(</span><span class="token string">"Red"</span><span class="token punctuation">,</span> <span class="token string">"Green"</span><span class="token punctuation">,</span> c<span class="token punctuation">(</span><span class="token number">21</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">TRUE</span><span class="token punctuation">,</span> <span class="token number">51.23</span><span class="token punctuation">,</span> <span class="token number">119.1</span><span class="token punctuation">)</span>print<span class="token punctuation">(</span>list_data<span class="token punctuation">)</span><span class="token comment"># 当我们执行上面的代码，它产生以下结果：</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token string">"Red"</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token string">"Green"</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token number">21</span> <span class="token number">32</span> <span class="token number">11</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token boolean">TRUE</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token number">51.23</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token number">119.1</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h2 id="命名列表元素"><a href="#命名列表元素" class="headerlink" title="命名列表元素"></a>命名列表元素</h2><p>列表元素可以给出名称，并且可以使用这些名称访问它们。</p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r"><span class="token comment"># Create a list containing a vector, a matrix and a list.</span>list_data <span class="token operator">&lt;-</span> list<span class="token punctuation">(</span>c<span class="token punctuation">(</span><span class="token string">"Jan"</span><span class="token punctuation">,</span> <span class="token string">"Feb"</span><span class="token punctuation">,</span> <span class="token string">"Mar"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> matrix<span class="token punctuation">(</span>c<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">,</span> nrow <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> list<span class="token punctuation">(</span><span class="token string">"green"</span><span class="token punctuation">,</span> <span class="token number">12.3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment"># Give names to the elements in the list.</span>names<span class="token punctuation">(</span>list_data<span class="token punctuation">)</span> <span class="token operator">&lt;-</span> c<span class="token punctuation">(</span><span class="token string">"1st Quarter"</span><span class="token punctuation">,</span> <span class="token string">"A_Matrix"</span><span class="token punctuation">,</span> <span class="token string">"A Inner list"</span><span class="token punctuation">)</span><span class="token comment"># Show the list.</span>print<span class="token punctuation">(</span>list_data<span class="token punctuation">)</span><span class="token comment"># 当我们执行上面的代码，它产生以下结果：</span><span class="token operator">$</span>`<span class="token number">1</span>st_Quarter`<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token string">"Jan"</span> <span class="token string">"Feb"</span> <span class="token string">"Mar"</span><span class="token operator">$</span>A_Matrix     <span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token punctuation">]</span>    <span class="token number">3</span>    <span class="token number">5</span>   <span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token punctuation">]</span>    <span class="token number">9</span>    <span class="token number">1</span>    <span class="token number">8</span><span class="token operator">$</span>A_Inner_list<span class="token operator">$</span>A_Inner_list<span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token string">"green"</span><span class="token operator">$</span>A_Inner_list<span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token number">12.3</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h2 id="访问列表元素"><a href="#访问列表元素" class="headerlink" title="访问列表元素"></a>访问列表元素</h2><p>列表的元素可以通过列表中元素的索引访问。在命名列表的情况下，它也可以使用名称来访问。</p><p>我们继续使用在上面的例子：</p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r"><span class="token comment"># Create a list containing a vector, a matrix and a list.</span>list_data <span class="token operator">&lt;-</span> list<span class="token punctuation">(</span>c<span class="token punctuation">(</span><span class="token string">"Jan"</span><span class="token punctuation">,</span> <span class="token string">"Feb"</span><span class="token punctuation">,</span> <span class="token string">"Mar"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> matrix<span class="token punctuation">(</span>c<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">,</span> nrow <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> list<span class="token punctuation">(</span><span class="token string">"green"</span><span class="token punctuation">,</span> <span class="token number">12.3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment"># Give names to the elements in the list.</span>names<span class="token punctuation">(</span>list_data<span class="token punctuation">)</span> <span class="token operator">&lt;-</span> c<span class="token punctuation">(</span><span class="token string">"1st Quarter"</span><span class="token punctuation">,</span> <span class="token string">"A_Matrix"</span><span class="token punctuation">,</span> <span class="token string">"A Inner list"</span><span class="token punctuation">)</span><span class="token comment"># Access the first element of the list.</span>print<span class="token punctuation">(</span>list_data<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token comment"># Access the thrid element. As it is also a list, all its elements will be printed.</span>print<span class="token punctuation">(</span>list_data<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token comment"># Access the list element using the name of the element.</span>print<span class="token punctuation">(</span>list_data<span class="token operator">$</span>A_Matrix<span class="token punctuation">)</span><span class="token comment"># 当我们执行上面的代码，它产生以下结果：</span><span class="token operator">$</span>`<span class="token number">1</span>st_Quarter`<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token string">"Jan"</span> <span class="token string">"Feb"</span> <span class="token string">"Mar"</span><span class="token operator">$</span>A_Inner_list<span class="token operator">$</span>A_Inner_list<span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token string">"green"</span><span class="token operator">$</span>A_Inner_list<span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token number">12.3</span>     <span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token punctuation">]</span>    <span class="token number">3</span>    <span class="token number">5</span>   <span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token punctuation">]</span>    <span class="token number">9</span>    <span class="token number">1</span>    <span class="token number">8</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h2 id="操作列表元素"><a href="#操作列表元素" class="headerlink" title="操作列表元素"></a>操作列表元素</h2><p>我们可以添加，删除和更新列表元素，如下所示。我们只能在列表的末尾添加和删除元素。但我们可以更新任何元素。</p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r"><span class="token comment"># Create a list containing a vector, a matrix and a list.</span>list_data <span class="token operator">&lt;-</span> list<span class="token punctuation">(</span>c<span class="token punctuation">(</span><span class="token string">"Jan"</span><span class="token punctuation">,</span> <span class="token string">"Feb"</span><span class="token punctuation">,</span> <span class="token string">"Mar"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> matrix<span class="token punctuation">(</span>c<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">,</span> nrow <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> list<span class="token punctuation">(</span><span class="token string">"green"</span><span class="token punctuation">,</span> <span class="token number">12.3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment"># Give names to the elements in the list.</span>names<span class="token punctuation">(</span>list_data<span class="token punctuation">)</span> <span class="token operator">&lt;-</span> c<span class="token punctuation">(</span><span class="token string">"1st Quarter"</span><span class="token punctuation">,</span> <span class="token string">"A_Matrix"</span><span class="token punctuation">,</span> <span class="token string">"A Inner list"</span><span class="token punctuation">)</span><span class="token comment"># Add element at the end of the list.</span>list_data<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">&lt;-</span> <span class="token string">"New element"</span>print<span class="token punctuation">(</span>list_data<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token comment"># Remove the last element.</span>list_data<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">&lt;-</span> <span class="token keyword">NULL</span><span class="token comment"># Print the 4th Element.</span>print<span class="token punctuation">(</span>list_data<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token comment"># Update the 3rd Element.</span>list_data<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">&lt;-</span> <span class="token string">"updated element"</span>print<span class="token punctuation">(</span>list_data<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token comment"># 当我们执行上面的代码，它产生以下结果：</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token string">"New element"</span><span class="token operator">$</span><span class="token keyword">NULL</span><span class="token operator">$</span>`A Inner list`<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token string">"updated element"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h2 id="合并列表"><a href="#合并列表" class="headerlink" title="合并列表"></a>合并列表</h2><p>通过将所有列表放在一个 <code>list()</code> 函数中，您可以将许多列表合并到一个列表中。</p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r"><span class="token comment"># Create two lists.</span>list1 <span class="token operator">&lt;-</span> list<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>list2 <span class="token operator">&lt;-</span> list<span class="token punctuation">(</span><span class="token string">"Sun"</span><span class="token punctuation">,</span> <span class="token string">"Mon"</span><span class="token punctuation">,</span> <span class="token string">"Tue"</span><span class="token punctuation">)</span><span class="token comment"># Merge the two lists.</span>merged.list <span class="token operator">&lt;-</span> c<span class="token punctuation">(</span>list1<span class="token punctuation">,</span> list2<span class="token punctuation">)</span><span class="token comment"># Print the merged list.</span>print<span class="token punctuation">(</span>merged.list<span class="token punctuation">)</span><span class="token comment"># 当我们执行上面的代码，它产生以下结果：</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token number">1</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token number">2</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token number">3</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token string">"Sun"</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token string">"Mon"</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token string">"Tue"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h2 id="将列表转换为向量"><a href="#将列表转换为向量" class="headerlink" title="将列表转换为向量"></a>将列表转换为向量</h2><p>列表可以转换为向量，使得向量的元素可以用于进一步的操作。可以在将列表转换为向量之后应用对向量的所有算术运算。我们可以使用 <code>unlist()</code> 函数完成这个转换。它将列表作为输入并生成向量。</p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r"><span class="token comment"># Create lists.</span>list1 <span class="token operator">&lt;-</span> list<span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">5</span><span class="token punctuation">)</span>print<span class="token punctuation">(</span>list1<span class="token punctuation">)</span>list2 <span class="token operator">&lt;-</span>list<span class="token punctuation">(</span><span class="token number">10</span><span class="token operator">:</span><span class="token number">14</span><span class="token punctuation">)</span>print<span class="token punctuation">(</span>list2<span class="token punctuation">)</span><span class="token comment"># Convert the lists to vectors.</span>v1 <span class="token operator">&lt;-</span> unlist<span class="token punctuation">(</span>list1<span class="token punctuation">)</span>v2 <span class="token operator">&lt;-</span> unlist<span class="token punctuation">(</span>list2<span class="token punctuation">)</span>print<span class="token punctuation">(</span>v1<span class="token punctuation">)</span>print<span class="token punctuation">(</span>v2<span class="token punctuation">)</span><span class="token comment"># Now add the vectors</span>result <span class="token operator">&lt;-</span> v1 <span class="token operator">+</span> v2print<span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token comment"># 当我们执行上面的代码，它产生以下结果：</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token number">1</span> <span class="token number">2</span> <span class="token number">3</span> <span class="token number">4</span> <span class="token number">5</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token number">10</span> <span class="token number">11</span> <span class="token number">12</span> <span class="token number">13</span> <span class="token number">14</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token number">1</span> <span class="token number">2</span> <span class="token number">3</span> <span class="token number">4</span> <span class="token number">5</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token number">10</span> <span class="token number">11</span> <span class="token number">12</span> <span class="token number">13</span> <span class="token number">14</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token number">11</span> <span class="token number">13</span> <span class="token number">15</span> <span class="token number">17</span> <span class="token number">19</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h1 id="矩阵"><a href="#矩阵" class="headerlink" title="矩阵"></a>矩阵</h1><p>矩阵是其中元素以二维矩形布局布置的 R 对象。它们包含相同原子类型的元素。虽然我们可以创建一个只包含字符或只包含逻辑值的矩阵，但它们没有太多用处。我们使用包含数字元素的矩阵用于数学计算。</p><h2 id="创建矩阵"><a href="#创建矩阵" class="headerlink" title="创建矩阵"></a>创建矩阵</h2><p>R 语言中使用 <code>matrix()</code> 函数创建一个矩阵。</p><p><strong>语法</strong></p><p>在 R 语言中创建矩阵的基本语法是：</p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r">matrix<span class="token punctuation">(</span>data<span class="token punctuation">,</span> nrow<span class="token punctuation">,</span> ncol<span class="token punctuation">,</span> byrow<span class="token punctuation">,</span> dimnames<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><p>以下是所使用的参数的说明：</p><ul><li><code>data</code> 是成为矩阵的数据元素的输入向量。</li><li><code>nrow</code> 是要创建的行数。</li><li><code>ncol</code> 是要创建的列数。</li><li><code>byrow</code> 是一个逻辑线索。如果为 <code>TRUE</code>，则输入向量元素按行排列。</li><li><code>dimname</code> 是分配给行和列的名称。</li></ul><p><strong>实例</strong></p><p>创建一个以数字向量作为输入的矩阵</p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r"><span class="token comment"># Elements are arranged sequentially by row.</span>M <span class="token operator">&lt;-</span> matrix<span class="token punctuation">(</span>c<span class="token punctuation">(</span><span class="token number">3</span><span class="token operator">:</span><span class="token number">14</span><span class="token punctuation">)</span><span class="token punctuation">,</span> nrow <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">,</span> byrow <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">)</span>print<span class="token punctuation">(</span>M<span class="token punctuation">)</span><span class="token comment"># Elements are arranged sequentially by column.</span>N <span class="token operator">&lt;-</span> matrix<span class="token punctuation">(</span>c<span class="token punctuation">(</span><span class="token number">3</span><span class="token operator">:</span><span class="token number">14</span><span class="token punctuation">)</span><span class="token punctuation">,</span> nrow <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">,</span> byrow <span class="token operator">=</span> <span class="token boolean">FALSE</span><span class="token punctuation">)</span>print<span class="token punctuation">(</span>N<span class="token punctuation">)</span><span class="token comment"># Define the column and row names.</span>rownames <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token string">"row1"</span><span class="token punctuation">,</span> <span class="token string">"row2"</span><span class="token punctuation">,</span> <span class="token string">"row3"</span><span class="token punctuation">,</span> <span class="token string">"row4"</span><span class="token punctuation">)</span>colnames <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token string">"col1"</span><span class="token punctuation">,</span> <span class="token string">"col2"</span><span class="token punctuation">,</span> <span class="token string">"col3"</span><span class="token punctuation">)</span>P <span class="token operator">&lt;-</span> matrix<span class="token punctuation">(</span>c<span class="token punctuation">(</span><span class="token number">3</span><span class="token operator">:</span><span class="token number">14</span><span class="token punctuation">)</span><span class="token punctuation">,</span> nrow <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">,</span> byrow <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">,</span> dimnames <span class="token operator">=</span> list<span class="token punctuation">(</span>rownames<span class="token punctuation">,</span> colnames<span class="token punctuation">)</span><span class="token punctuation">)</span>print<span class="token punctuation">(</span>P<span class="token punctuation">)</span><span class="token comment"># 当我们执行上面的代码，它产生以下结果：</span>     <span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token punctuation">]</span>    <span class="token number">3</span>    <span class="token number">4</span>    <span class="token number">5</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token punctuation">]</span>    <span class="token number">6</span>    <span class="token number">7</span>    <span class="token number">8</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token punctuation">]</span>    <span class="token number">9</span>   <span class="token number">10</span>   <span class="token number">11</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token punctuation">]</span>   <span class="token number">12</span>   <span class="token number">13</span>   <span class="token number">14</span>     <span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token punctuation">]</span>    <span class="token number">3</span>    <span class="token number">7</span>   <span class="token number">11</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token punctuation">]</span>    <span class="token number">4</span>    <span class="token number">8</span>   <span class="token number">12</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token punctuation">]</span>    <span class="token number">5</span>    <span class="token number">9</span>   <span class="token number">13</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token punctuation">]</span>    <span class="token number">6</span>   <span class="token number">10</span>   <span class="token number">14</span>     col1 col2 col3row1    <span class="token number">3</span>    <span class="token number">4</span>    <span class="token number">5</span>row2    <span class="token number">6</span>    <span class="token number">7</span>    <span class="token number">8</span>row3    <span class="token number">9</span>   <span class="token number">10</span>   <span class="token number">11</span>row4   <span class="token number">12</span>   <span class="token number">13</span>   <span class="token number">14</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h2 id="访问矩阵的元素"><a href="#访问矩阵的元素" class="headerlink" title="访问矩阵的元素"></a>访问矩阵的元素</h2><p>可以通过使用元素的列和行索引来访问矩阵的元素。我们考虑上面的矩阵 <code>P</code> 找到下面的具体元素。</p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r"><span class="token comment"># Define the column and row names.</span>rownames <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token string">"row1"</span><span class="token punctuation">,</span> <span class="token string">"row2"</span><span class="token punctuation">,</span> <span class="token string">"row3"</span><span class="token punctuation">,</span> <span class="token string">"row4"</span><span class="token punctuation">)</span>colnames <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token string">"col1"</span><span class="token punctuation">,</span> <span class="token string">"col2"</span><span class="token punctuation">,</span> <span class="token string">"col3"</span><span class="token punctuation">)</span><span class="token comment"># Create the matrix.</span>P <span class="token operator">&lt;-</span> matrix<span class="token punctuation">(</span>c<span class="token punctuation">(</span><span class="token number">3</span><span class="token operator">:</span><span class="token number">14</span><span class="token punctuation">)</span><span class="token punctuation">,</span> nrow <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">,</span> byrow <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">,</span> dimnames <span class="token operator">=</span> list<span class="token punctuation">(</span>rownames<span class="token punctuation">,</span> colnames<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment"># Access the element at 3rd column and 1st row.</span>print<span class="token punctuation">(</span>P<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token comment"># Access the element at 2nd column and 4th row.</span>print<span class="token punctuation">(</span>P<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token comment"># Access only the  2nd row.</span>print<span class="token punctuation">(</span>P<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token comment"># Access only the 3rd column.</span>print<span class="token punctuation">(</span>P<span class="token punctuation">[</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token comment"># 当我们执行上面的代码，它产生以下结果：</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token number">5</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token number">13</span>col1 col2 col3    <span class="token number">6</span>    <span class="token number">7</span>    <span class="token number">8</span> row1 row2 row3 row4    <span class="token number">5</span>    <span class="token number">8</span>   <span class="token number">11</span>   <span class="token number">14</span> <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h2 id="矩阵计算"><a href="#矩阵计算" class="headerlink" title="矩阵计算"></a>矩阵计算</h2><p>使用 R 运算符对矩阵执行各种数学运算。操作的结果也是一个矩阵。</p><p>对于操作中涉及的矩阵，维度（行数和列数）应该相同。</p><h3 id="加法和减法"><a href="#加法和减法" class="headerlink" title="加法和减法"></a>加法和减法</h3><p><pre class="line-numbers language-r" data-language="r"><code class="language-r"><span class="token comment"># Create two 2x3 matrices.</span>matrix1 <span class="token operator">&lt;-</span> matrix<span class="token punctuation">(</span>c<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">,</span> nrow <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">)</span>print<span class="token punctuation">(</span>matrix1<span class="token punctuation">)</span>matrix2 <span class="token operator">&lt;-</span> matrix<span class="token punctuation">(</span>c<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span> nrow <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">)</span>print<span class="token punctuation">(</span>matrix2<span class="token punctuation">)</span><span class="token comment"># Add the matrices.</span>result <span class="token operator">&lt;-</span> matrix1 <span class="token operator">+</span> matrix2cat<span class="token punctuation">(</span><span class="token string">"Result of addition"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span>print<span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token comment"># Subtract the matrices</span>result <span class="token operator">&lt;-</span> matrix1 <span class="token operator">-</span> matrix2cat<span class="token punctuation">(</span><span class="token string">"Result of subtraction"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span>print<span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token comment"># 当我们执行上面的代码，它产生以下结果：</span>     <span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token punctuation">]</span>    <span class="token number">3</span>   <span class="token operator">-</span><span class="token number">1</span>    <span class="token number">2</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token punctuation">]</span>    <span class="token number">9</span>    <span class="token number">4</span>    <span class="token number">6</span>     <span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token punctuation">]</span>    <span class="token number">5</span>    <span class="token number">0</span>    <span class="token number">3</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token punctuation">]</span>    <span class="token number">2</span>    <span class="token number">9</span>    <span class="token number">4</span>Result of addition     <span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token punctuation">]</span>    <span class="token number">8</span>   <span class="token operator">-</span><span class="token number">1</span>    <span class="token number">5</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token punctuation">]</span>   <span class="token number">11</span>   <span class="token number">13</span>   <span class="token number">10</span>Result of subtraction     <span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token punctuation">]</span>   <span class="token operator">-</span><span class="token number">2</span>   <span class="token operator">-</span><span class="token number">1</span>   <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token punctuation">]</span>    <span class="token number">7</span>   <span class="token operator">-</span><span class="token number">5</span>    <span class="token number">2</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h3 id="乘法和除法"><a href="#乘法和除法" class="headerlink" title="乘法和除法"></a>乘法和除法</h3><p><pre class="line-numbers language-r" data-language="r"><code class="language-r"><span class="token comment"># Create two 2x3 matrices.</span>matrix1 <span class="token operator">&lt;-</span> matrix<span class="token punctuation">(</span>c<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">,</span> nrow <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">)</span>print<span class="token punctuation">(</span>matrix1<span class="token punctuation">)</span>matrix2 <span class="token operator">&lt;-</span> matrix<span class="token punctuation">(</span>c<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span> nrow <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">)</span>print<span class="token punctuation">(</span>matrix2<span class="token punctuation">)</span><span class="token comment"># Multiply the matrices.</span>result <span class="token operator">&lt;-</span> matrix1 <span class="token operator">*</span> matrix2cat<span class="token punctuation">(</span><span class="token string">"Result of multiplication"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span>print<span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token comment"># Divide the matrices</span>result <span class="token operator">&lt;-</span> matrix1 <span class="token operator">/</span> matrix2cat<span class="token punctuation">(</span><span class="token string">"Result of division"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span>print<span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token comment"># 当我们执行上面的代码，它产生以下结果：</span>     <span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token punctuation">]</span>    <span class="token number">3</span>   <span class="token operator">-</span><span class="token number">1</span>    <span class="token number">2</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token punctuation">]</span>    <span class="token number">9</span>    <span class="token number">4</span>    <span class="token number">6</span>     <span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token punctuation">]</span>    <span class="token number">5</span>    <span class="token number">0</span>    <span class="token number">3</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token punctuation">]</span>    <span class="token number">2</span>    <span class="token number">9</span>    <span class="token number">4</span>Result of multiplication      <span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token punctuation">]</span>   <span class="token number">15</span>    <span class="token number">0</span>    <span class="token number">6</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token punctuation">]</span>   <span class="token number">18</span>   <span class="token number">36</span>   <span class="token number">24</span>Result of division      <span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span>      <span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span>      <span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token punctuation">]</span>  <span class="token number">0.6</span>      <span class="token operator">-</span><span class="token number">Inf</span> <span class="token number">0.6666667</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token punctuation">]</span>  <span class="token number">4.5</span> <span class="token number">0.4444444</span> <span class="token number">1.5000000</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h1 id="数组"><a href="#数组" class="headerlink" title="数组"></a>数组</h1><p>数组是可以在两个以上维度中存储数据的 R 数据对象。</p><p>例如：如果我们创建一个维度 <code>(2，3，4)</code> 的数组，则它创建 <code>4</code> 个矩形矩阵，每个矩阵具有 <code>2</code> 行和 <code>3</code> 列。数组只能存储数据类型。</p><h2 id="创建数组"><a href="#创建数组" class="headerlink" title="创建数组"></a>创建数组</h2><p>使用 <code>array()</code> 函数创建数组。它使用向量作为输入，并使用 <code>dim</code> 参数中的值创建数组。</p><p><strong>实例</strong></p><p>以下示例创建一个由两个 <code>3x3</code> 矩阵组成的数组，每个矩阵具有 <code>3</code> 行和 <code>3</code> 列。</p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r"><span class="token comment"># Create two vectors of different lengths.</span>vector1 <span class="token operator">&lt;-</span> c<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>vector2 <span class="token operator">&lt;-</span> c<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">)</span><span class="token comment"># Take these vectors as input to the array.</span>result <span class="token operator">&lt;-</span> array<span class="token punctuation">(</span>c<span class="token punctuation">(</span>vector1<span class="token punctuation">,</span> vector2<span class="token punctuation">)</span><span class="token punctuation">,</span> dim <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>print<span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token comment"># 当我们执行上面的代码，它产生以下结果：</span><span class="token punctuation">,</span> <span class="token punctuation">,</span> <span class="token number">1</span>     <span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token punctuation">]</span>    <span class="token number">5</span>   <span class="token number">10</span>   <span class="token number">13</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token punctuation">]</span>    <span class="token number">9</span>   <span class="token number">11</span>   <span class="token number">14</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token punctuation">]</span>    <span class="token number">3</span>   <span class="token number">12</span>   <span class="token number">15</span><span class="token punctuation">,</span> <span class="token punctuation">,</span> <span class="token number">2</span>     <span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token punctuation">]</span>    <span class="token number">5</span>   <span class="token number">10</span>   <span class="token number">13</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token punctuation">]</span>    <span class="token number">9</span>   <span class="token number">11</span>   <span class="token number">14</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token punctuation">]</span>    <span class="token number">3</span>   <span class="token number">12</span>   <span class="token number">15</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h2 id="命名列和行"><a href="#命名列和行" class="headerlink" title="命名列和行"></a>命名列和行</h2><p>我们可以使用 <code>dimnames</code> 参数给数组中的行，列和矩阵命名。</p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r"><span class="token comment"># Create two vectors of different lengths.</span>vector1 <span class="token operator">&lt;-</span> c<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>vector2 <span class="token operator">&lt;-</span> c<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">)</span>column.names <span class="token operator">&lt;-</span> c<span class="token punctuation">(</span><span class="token string">"COL1"</span><span class="token punctuation">,</span> <span class="token string">"COL2"</span><span class="token punctuation">,</span> <span class="token string">"COL3"</span><span class="token punctuation">)</span>row.names <span class="token operator">&lt;-</span> c<span class="token punctuation">(</span><span class="token string">"ROW1"</span><span class="token punctuation">,</span> <span class="token string">"ROW2"</span><span class="token punctuation">,</span> <span class="token string">"ROW3"</span><span class="token punctuation">)</span>matrix.names <span class="token operator">&lt;-</span> c<span class="token punctuation">(</span><span class="token string">"Matrix1"</span><span class="token punctuation">,</span> <span class="token string">"Matrix2"</span><span class="token punctuation">)</span><span class="token comment"># Take these vectors as input to the array.</span>result <span class="token operator">&lt;-</span> array<span class="token punctuation">(</span>c<span class="token punctuation">(</span>vector1<span class="token punctuation">,</span> vector2<span class="token punctuation">)</span><span class="token punctuation">,</span> dim <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> dimnames <span class="token operator">=</span> list<span class="token punctuation">(</span>row.names<span class="token punctuation">,</span> column.names<span class="token punctuation">,</span> matrix.names<span class="token punctuation">)</span><span class="token punctuation">)</span>print<span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token comment"># 当我们执行上面的代码，它产生以下结果：</span><span class="token punctuation">,</span> <span class="token punctuation">,</span> Matrix1     COL1 COL2 COL3ROW1    <span class="token number">5</span>   <span class="token number">10</span>   <span class="token number">13</span>ROW2    <span class="token number">9</span>   <span class="token number">11</span>   <span class="token number">14</span>ROW3    <span class="token number">3</span>   <span class="token number">12</span>   <span class="token number">15</span><span class="token punctuation">,</span> <span class="token punctuation">,</span> Matrix2     COL1 COL2 COL3ROW1    <span class="token number">5</span>   <span class="token number">10</span>   <span class="token number">13</span>ROW2    <span class="token number">9</span>   <span class="token number">11</span>   <span class="token number">14</span>ROW3    <span class="token number">3</span>   <span class="token number">12</span>   <span class="token number">15</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h2 id="访问数组元素"><a href="#访问数组元素" class="headerlink" title="访问数组元素"></a>访问数组元素</h2><p><pre class="line-numbers language-r" data-language="r"><code class="language-r"><span class="token comment"># Create two vectors of different lengths.</span>vector1 <span class="token operator">&lt;-</span> c<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>vector2 <span class="token operator">&lt;-</span> c<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">)</span>column.names <span class="token operator">&lt;-</span> c<span class="token punctuation">(</span><span class="token string">"COL1"</span><span class="token punctuation">,</span> <span class="token string">"COL2"</span><span class="token punctuation">,</span> <span class="token string">"COL3"</span><span class="token punctuation">)</span>row.names <span class="token operator">&lt;-</span> c<span class="token punctuation">(</span><span class="token string">"ROW1"</span><span class="token punctuation">,</span> <span class="token string">"ROW2"</span><span class="token punctuation">,</span> <span class="token string">"ROW3"</span><span class="token punctuation">)</span>matrix.names <span class="token operator">&lt;-</span> c<span class="token punctuation">(</span><span class="token string">"Matrix1"</span><span class="token punctuation">,</span> <span class="token string">"Matrix2"</span><span class="token punctuation">)</span><span class="token comment"># Take these vectors as input to the array.</span>result <span class="token operator">&lt;-</span> array<span class="token punctuation">(</span>c<span class="token punctuation">(</span>vector1<span class="token punctuation">,</span> vector2<span class="token punctuation">)</span><span class="token punctuation">,</span> dim <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> dimnames <span class="token operator">=</span> list<span class="token punctuation">(</span>row.names<span class="token punctuation">,</span> column.names<span class="token punctuation">,</span> matrix.names<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment"># Print the third row of the second matrix of the array.</span>print<span class="token punctuation">(</span>result<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token comment"># Print the element in the 1st row and 3rd column of the 1st matrix.</span>print<span class="token punctuation">(</span>result<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token comment"># Print the 2nd Matrix.</span>print<span class="token punctuation">(</span>result<span class="token punctuation">[</span><span class="token punctuation">,</span> <span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token comment"># 当我们执行上面的代码，它产生以下结果：</span>COL1 COL2 COL3    <span class="token number">3</span>   <span class="token number">12</span>   <span class="token number">15</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token number">13</span>     COL1 COL2 COL3ROW1    <span class="token number">5</span>   <span class="token number">10</span>   <span class="token number">13</span>ROW2    <span class="token number">9</span>   <span class="token number">11</span>   <span class="token number">14</span>ROW3    <span class="token number">3</span>   <span class="token number">12</span>   <span class="token number">15</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h2 id="操作数组元素"><a href="#操作数组元素" class="headerlink" title="操作数组元素"></a>操作数组元素</h2><p>由于数组由多维构成矩阵，所以对数组元素的操作通过访问矩阵的元素来执行。</p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r"><span class="token comment"># Create two vectors of different lengths.</span>vector1 <span class="token operator">&lt;-</span> c<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>vector2 <span class="token operator">&lt;-</span> c<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">)</span><span class="token comment"># Take these vectors as input to the array.</span>array1 <span class="token operator">&lt;-</span> array<span class="token punctuation">(</span>c<span class="token punctuation">(</span>vector1<span class="token punctuation">,</span> vector2<span class="token punctuation">)</span><span class="token punctuation">,</span> dim <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment"># Create two vectors of different lengths.</span>vector3 <span class="token operator">&lt;-</span> c<span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>vector4 <span class="token operator">&lt;-</span> c<span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">)</span>array2 <span class="token operator">&lt;-</span> array<span class="token punctuation">(</span>c<span class="token punctuation">(</span>vector1<span class="token punctuation">,</span> vector2<span class="token punctuation">)</span><span class="token punctuation">,</span> dim <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment"># create matrices from these arrays.</span>matrix1 <span class="token operator">&lt;-</span> array1<span class="token punctuation">[</span><span class="token punctuation">,</span> <span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span>matrix2 <span class="token operator">&lt;-</span> array2<span class="token punctuation">[</span><span class="token punctuation">,</span> <span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token comment"># Add the matrices.</span>result <span class="token operator">&lt;-</span> matrix1 <span class="token operator">+</span> matrix2print<span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token comment"># 当我们执行上面的代码，它产生以下结果：</span>     <span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token punctuation">]</span>   <span class="token number">10</span>   <span class="token number">20</span>   <span class="token number">26</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token punctuation">]</span>   <span class="token number">18</span>   <span class="token number">22</span>   <span class="token number">28</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token punctuation">]</span>    <span class="token number">6</span>   <span class="token number">24</span>   <span class="token number">30</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h2 id="跨数组元素的计算"><a href="#跨数组元素的计算" class="headerlink" title="跨数组元素的计算"></a>跨数组元素的计算</h2><p>我们可以使用 <code>apply()</code> 函数在数组中的元素上进行计算。</p><p><strong>语法</strong></p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r">apply<span class="token punctuation">(</span>x<span class="token punctuation">,</span> margin<span class="token punctuation">,</span> fun<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><p>以下是所使用的参数的说明：</p><ul><li><code>x</code> 是一个数组。</li><li><code>margin</code> 是所使用的数据集的名称。</li><li><code>fun</code> 是要应用于数组元素的函数。</li></ul><p><strong>实例</strong></p><p>我们下面使用 <code>apply()</code> 函数计算所有矩阵中数组行中元素的总和。</p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r"><span class="token comment"># Create two vectors of different lengths.</span>vector1 <span class="token operator">&lt;-</span> c<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>vector2 <span class="token operator">&lt;-</span> c<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">)</span><span class="token comment"># Take these vectors as input to the array.</span>new.array <span class="token operator">&lt;-</span> array<span class="token punctuation">(</span>c<span class="token punctuation">(</span>vector1<span class="token punctuation">,</span> vector2<span class="token punctuation">)</span><span class="token punctuation">,</span> dim <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>print<span class="token punctuation">(</span>new.array<span class="token punctuation">)</span><span class="token comment"># Use apply to calculate the sum of the rows across all the matrices.</span>result <span class="token operator">&lt;-</span> apply<span class="token punctuation">(</span>new.array<span class="token punctuation">,</span> c<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> sum<span class="token punctuation">)</span>print<span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token comment"># 当我们执行上面的代码，它产生以下结果：</span><span class="token punctuation">,</span> <span class="token punctuation">,</span> <span class="token number">1</span>     <span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token punctuation">]</span>    <span class="token number">5</span>   <span class="token number">10</span>   <span class="token number">13</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token punctuation">]</span>    <span class="token number">9</span>   <span class="token number">11</span>   <span class="token number">14</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token punctuation">]</span>    <span class="token number">3</span>   <span class="token number">12</span>   <span class="token number">15</span><span class="token punctuation">,</span> <span class="token punctuation">,</span> <span class="token number">2</span>     <span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token punctuation">]</span>    <span class="token number">5</span>   <span class="token number">10</span>   <span class="token number">13</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token punctuation">]</span>    <span class="token number">9</span>   <span class="token number">11</span>   <span class="token number">14</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token punctuation">]</span>    <span class="token number">3</span>   <span class="token number">12</span>   <span class="token number">15</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token number">56</span> <span class="token number">68</span> <span class="token number">60</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h1 id="因子"><a href="#因子" class="headerlink" title="因子"></a>因子</h1><p>因子是用于对数据进行分类并将其存储为级别的数据对象。它们可以存储字符串和整数。它们在具有有限数量的唯一值的列中很有用。像 <code>男性</code>，<code>女性</code> 和 <code>True</code>，<code>False</code> 等。它们在统计建模的数据分析中很有用。</p><h2 id="创建因子"><a href="#创建因子" class="headerlink" title="创建因子"></a>创建因子</h2><p>使用 <code>factor()</code> 函数通过将向量作为输入创建因子。</p><p><strong>实例</strong></p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r"><span class="token comment"># Create a vector as input.</span>data <span class="token operator">&lt;-</span> c<span class="token punctuation">(</span><span class="token string">"East"</span><span class="token punctuation">,</span> <span class="token string">"West"</span><span class="token punctuation">,</span> <span class="token string">"East"</span><span class="token punctuation">,</span> <span class="token string">"North"</span><span class="token punctuation">,</span> <span class="token string">"North"</span><span class="token punctuation">,</span> <span class="token string">"East"</span><span class="token punctuation">,</span> <span class="token string">"West"</span><span class="token punctuation">,</span> <span class="token string">"West"</span><span class="token punctuation">,</span> <span class="token string">"West"</span><span class="token punctuation">,</span> <span class="token string">"East"</span><span class="token punctuation">,</span> <span class="token string">"North"</span><span class="token punctuation">)</span>print<span class="token punctuation">(</span>data<span class="token punctuation">)</span>print<span class="token punctuation">(</span>is.factor<span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment"># Apply the factor function.</span>factor_data <span class="token operator">&lt;-</span> factor<span class="token punctuation">(</span>data<span class="token punctuation">)</span>print<span class="token punctuation">(</span>factor_data<span class="token punctuation">)</span>print<span class="token punctuation">(</span>is.factor<span class="token punctuation">(</span>factor_data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment"># 当我们执行上面的代码，它产生以下结果：</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token string">"East"</span>  <span class="token string">"West"</span>  <span class="token string">"East"</span>  <span class="token string">"North"</span> <span class="token string">"North"</span> <span class="token string">"East"</span>  <span class="token string">"West"</span>  <span class="token string">"West"</span>  <span class="token string">"West"</span>  <span class="token string">"East"</span> <span class="token string">"North"</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token boolean">FALSE</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> East  West  East  North North East  West  West  West  East  NorthLevels<span class="token operator">:</span> East North West<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token boolean">TRUE</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h2 id="数据框的因子"><a href="#数据框的因子" class="headerlink" title="数据框的因子"></a>数据框的因子</h2><p>在创建具有文本数据列的任何数据框时，R 语言将文本列视为分类数据并在其上创建因子。</p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r"><span class="token comment"># Create the vectors for data frame.</span>height <span class="token operator">&lt;-</span> c<span class="token punctuation">(</span><span class="token number">132</span><span class="token punctuation">,</span> <span class="token number">151</span><span class="token punctuation">,</span> <span class="token number">162</span><span class="token punctuation">,</span> <span class="token number">139</span><span class="token punctuation">,</span> <span class="token number">166</span><span class="token punctuation">,</span> <span class="token number">147</span><span class="token punctuation">,</span> <span class="token number">122</span><span class="token punctuation">)</span>weight <span class="token operator">&lt;-</span> c<span class="token punctuation">(</span><span class="token number">48</span><span class="token punctuation">,</span> <span class="token number">49</span><span class="token punctuation">,</span> <span class="token number">66</span><span class="token punctuation">,</span> <span class="token number">53</span><span class="token punctuation">,</span> <span class="token number">67</span><span class="token punctuation">,</span> <span class="token number">52</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">)</span>gender <span class="token operator">&lt;-</span> c<span class="token punctuation">(</span><span class="token string">"male"</span><span class="token punctuation">,</span> <span class="token string">"male"</span><span class="token punctuation">,</span> <span class="token string">"female"</span><span class="token punctuation">,</span> <span class="token string">"female"</span><span class="token punctuation">,</span> <span class="token string">"male"</span><span class="token punctuation">,</span> <span class="token string">"female"</span><span class="token punctuation">,</span> <span class="token string">"male"</span><span class="token punctuation">)</span><span class="token comment"># Create the data frame.</span>input_data <span class="token operator">&lt;-</span> data.frame<span class="token punctuation">(</span>height<span class="token punctuation">,</span> weight<span class="token punctuation">,</span> gender<span class="token punctuation">)</span>print<span class="token punctuation">(</span>input_data<span class="token punctuation">)</span><span class="token comment"># Test if the gender column is a factor.</span>print<span class="token punctuation">(</span>is.factor<span class="token punctuation">(</span>input_data<span class="token operator">$</span>gender<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment"># Print the gender column so see the levels.</span>print<span class="token punctuation">(</span>input_data<span class="token operator">$</span>gender<span class="token punctuation">)</span><span class="token comment"># 当我们执行上面的代码，它产生以下结果：</span>  height weight gender<span class="token number">1</span>    <span class="token number">132</span>     <span class="token number">48</span>   male<span class="token number">2</span>    <span class="token number">151</span>     <span class="token number">49</span>   male<span class="token number">3</span>    <span class="token number">162</span>     <span class="token number">66</span> female<span class="token number">4</span>    <span class="token number">139</span>     <span class="token number">53</span> female<span class="token number">5</span>    <span class="token number">166</span>     <span class="token number">67</span>   male<span class="token number">6</span>    <span class="token number">147</span>     <span class="token number">52</span> female<span class="token number">7</span>    <span class="token number">122</span>     <span class="token number">40</span>   male<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token boolean">TRUE</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> male   male   female female male   female male  Levels<span class="token operator">:</span> female male<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h2 id="更改级别顺序"><a href="#更改级别顺序" class="headerlink" title="更改级别顺序"></a>更改级别顺序</h2><p>可以通过使用新的等级次序再次应用因子函数来改变因子中的等级的顺序。</p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r">data <span class="token operator">&lt;-</span> c<span class="token punctuation">(</span><span class="token string">"East"</span><span class="token punctuation">,</span> <span class="token string">"West"</span><span class="token punctuation">,</span> <span class="token string">"East"</span><span class="token punctuation">,</span> <span class="token string">"North"</span><span class="token punctuation">,</span> <span class="token string">"North"</span><span class="token punctuation">,</span> <span class="token string">"East"</span><span class="token punctuation">,</span> <span class="token string">"West"</span><span class="token punctuation">,</span> <span class="token string">"West"</span><span class="token punctuation">,</span> <span class="token string">"West"</span><span class="token punctuation">,</span> <span class="token string">"East"</span><span class="token punctuation">,</span> <span class="token string">"North"</span><span class="token punctuation">)</span><span class="token comment"># Create the factors</span>factor_data <span class="token operator">&lt;-</span> factor<span class="token punctuation">(</span>data<span class="token punctuation">)</span>print<span class="token punctuation">(</span>factor_data<span class="token punctuation">)</span><span class="token comment"># Apply the factor function with required order of the level.</span>new_order_data <span class="token operator">&lt;-</span> factor<span class="token punctuation">(</span>factor_data<span class="token punctuation">,</span> levels <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token string">"East"</span><span class="token punctuation">,</span> <span class="token string">"West"</span><span class="token punctuation">,</span> <span class="token string">"North"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>print<span class="token punctuation">(</span>new_order_data<span class="token punctuation">)</span><span class="token comment"># 当我们执行上面的代码，它产生以下结果：</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> East  West  East  North North East  West  West  West  East  NorthLevels<span class="token operator">:</span> East North West <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> East  West  East  North North East  West  West  West  East  NorthLevels<span class="token operator">:</span> East West North<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h2 id="生成因子级别"><a href="#生成因子级别" class="headerlink" title="生成因子级别"></a>生成因子级别</h2><p>我们可以使用 <code>gl()</code> 函数生成因子级别。它需要两个整数作为输入，指示每个级别有多少级别和多少次。</p><p><strong>语法</strong></p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r">gl<span class="token punctuation">(</span>n<span class="token punctuation">,</span> k<span class="token punctuation">,</span> labels<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><p>以下是所使用的参数的说明：</p><ul><li><code>n</code> 是给出级数的整数。</li><li><code>k</code> 是给出复制数目的整数。</li><li><code>labels</code> 是所得因子水平的标签向量。</li></ul><p><strong>实例</strong></p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r">v <span class="token operator">&lt;-</span> gl<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> labels <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token string">"Tampa"</span><span class="token punctuation">,</span> <span class="token string">"Seattle"</span><span class="token punctuation">,</span> <span class="token string">"Boston"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>print<span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token comment"># 当我们执行上面的代码，它产生以下结果：</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> Tampa   Tampa   Tampa   Tampa   Seattle Seattle Seattle Seattle Boston  Boston  Boston  Boston Levels<span class="token operator">:</span> Tampa Seattle Boston<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h1 id="数据框"><a href="#数据框" class="headerlink" title="数据框"></a>数据框</h1><p>数据框是表或二维阵列状结构，其中每一列包含一个变量的值，并且每一行包含来自每一列的一组值。</p><p>以下是数据框的特性。</p><ul><li>列名称应为非空。</li><li>行名称应该是唯一的。</li><li>存储在数据框中的数据可以是数字，因子或字符类型。</li><li>每个列应包含相同数量的数据项。</li></ul><h2 id="创建数据框"><a href="#创建数据框" class="headerlink" title="创建数据框"></a>创建数据框</h2><p><pre class="line-numbers language-r" data-language="r"><code class="language-r"><span class="token comment"># Create the data frame.</span>emp.data <span class="token operator">&lt;-</span> data.frame<span class="token punctuation">(</span>   emp_id <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    emp_name <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token string">"Rick"</span><span class="token punctuation">,</span> <span class="token string">"Dan"</span><span class="token punctuation">,</span> <span class="token string">"Michelle"</span><span class="token punctuation">,</span> <span class="token string">"Ryan"</span><span class="token punctuation">,</span> <span class="token string">"Gary"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    salary <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token number">623.3</span><span class="token punctuation">,</span> <span class="token number">515.2</span><span class="token punctuation">,</span> <span class="token number">611.0</span><span class="token punctuation">,</span> <span class="token number">729.0</span><span class="token punctuation">,</span> <span class="token number">843.25</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    start_date <span class="token operator">=</span> as.Date<span class="token punctuation">(</span>c<span class="token punctuation">(</span><span class="token string">"2012-01-01"</span><span class="token punctuation">,</span> <span class="token string">"2013-09-23"</span><span class="token punctuation">,</span> <span class="token string">"2014-11-15"</span><span class="token punctuation">,</span> <span class="token string">"2014-05-11"</span><span class="token punctuation">,</span> <span class="token string">"2015-03-27"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    stringsAsFactors <span class="token operator">=</span> <span class="token boolean">FALSE</span><span class="token punctuation">)</span><span class="token comment"># Print the data frame.</span>print<span class="token punctuation">(</span>emp.data<span class="token punctuation">)</span> <span class="token comment"># 当我们执行上面的代码，它产生以下结果：</span> emp_id    emp_name     salary     start_date<span class="token number">1</span>     <span class="token number">1</span>     Rick        <span class="token number">623.30</span>     <span class="token number">2012</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">01</span><span class="token number">2</span>     <span class="token number">2</span>     Dan         <span class="token number">515.20</span>     <span class="token number">2013</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">23</span><span class="token number">3</span>     <span class="token number">3</span>     Michelle    <span class="token number">611.00</span>     <span class="token number">2014</span><span class="token operator">-</span><span class="token number">11</span><span class="token operator">-</span><span class="token number">15</span><span class="token number">4</span>     <span class="token number">4</span>     Ryan        <span class="token number">729.00</span>     <span class="token number">2014</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">11</span><span class="token number">5</span>     <span class="token number">5</span>     Gary        <span class="token number">843.25</span>     <span class="token number">2015</span><span class="token operator">-</span><span class="token number">03</span><span class="token operator">-</span><span class="token number">27</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h2 id="获取数据框的结构"><a href="#获取数据框的结构" class="headerlink" title="获取数据框的结构"></a>获取数据框的结构</h2><p>通过使用 <code>str()</code> 函数可以看到数据框的结构。</p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r"><span class="token comment"># Create the data frame.</span>emp.data <span class="token operator">&lt;-</span> data.frame<span class="token punctuation">(</span>   emp_id <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    emp_name <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token string">"Rick"</span><span class="token punctuation">,</span> <span class="token string">"Dan"</span><span class="token punctuation">,</span> <span class="token string">"Michelle"</span><span class="token punctuation">,</span> <span class="token string">"Ryan"</span><span class="token punctuation">,</span> <span class="token string">"Gary"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    salary <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token number">623.3</span><span class="token punctuation">,</span> <span class="token number">515.2</span><span class="token punctuation">,</span> <span class="token number">611.0</span><span class="token punctuation">,</span> <span class="token number">729.0</span><span class="token punctuation">,</span> <span class="token number">843.25</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    start_date <span class="token operator">=</span> as.Date<span class="token punctuation">(</span>c<span class="token punctuation">(</span><span class="token string">"2012-01-01"</span><span class="token punctuation">,</span> <span class="token string">"2013-09-23"</span><span class="token punctuation">,</span> <span class="token string">"2014-11-15"</span><span class="token punctuation">,</span> <span class="token string">"2014-05-11"</span><span class="token punctuation">,</span> <span class="token string">"2015-03-27"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    stringsAsFactors <span class="token operator">=</span> <span class="token boolean">FALSE</span><span class="token punctuation">)</span><span class="token comment"># Get the structure of the data frame.</span>str<span class="token punctuation">(</span>emp.data<span class="token punctuation">)</span><span class="token comment"># 当我们执行上面的代码，它产生以下结果：</span><span class="token string">'data.frame'</span><span class="token operator">:</span><span class="token number">5</span> obs. of  <span class="token number">4</span> variables<span class="token operator">:</span> <span class="token operator">$</span> emp_id    <span class="token operator">:</span> int  <span class="token number">1</span> <span class="token number">2</span> <span class="token number">3</span> <span class="token number">4</span> <span class="token number">5</span> <span class="token operator">$</span> emp_name  <span class="token operator">:</span> chr  <span class="token string">"Rick"</span> <span class="token string">"Dan"</span> <span class="token string">"Michelle"</span> <span class="token string">"Ryan"</span> <span class="token ellipsis">...</span> <span class="token operator">$</span> salary    <span class="token operator">:</span> num  <span class="token number">623</span> <span class="token number">515</span> <span class="token number">611</span> <span class="token number">729</span> <span class="token number">843</span> <span class="token operator">$</span> start_date<span class="token operator">:</span> Date<span class="token punctuation">,</span> format<span class="token operator">:</span> <span class="token string">"2012-01-01"</span> <span class="token string">"2013-09-23"</span> <span class="token string">"2014-11-15"</span> <span class="token string">"2014-05-11"</span> <span class="token ellipsis">...</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h2 id="数据框中的数据摘要"><a href="#数据框中的数据摘要" class="headerlink" title="数据框中的数据摘要"></a>数据框中的数据摘要</h2><p>可以通过应用 <code>summary()</code> 函数获取数据的统计摘要和性质。</p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r"><span class="token comment"># Create the data frame.</span>emp.data <span class="token operator">&lt;-</span> data.frame<span class="token punctuation">(</span>   emp_id <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    emp_name <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token string">"Rick"</span><span class="token punctuation">,</span> <span class="token string">"Dan"</span><span class="token punctuation">,</span> <span class="token string">"Michelle"</span><span class="token punctuation">,</span> <span class="token string">"Ryan"</span><span class="token punctuation">,</span> <span class="token string">"Gary"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    salary <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token number">623.3</span><span class="token punctuation">,</span> <span class="token number">515.2</span><span class="token punctuation">,</span> <span class="token number">611.0</span><span class="token punctuation">,</span> <span class="token number">729.0</span><span class="token punctuation">,</span> <span class="token number">843.25</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    start_date <span class="token operator">=</span> as.Date<span class="token punctuation">(</span>c<span class="token punctuation">(</span><span class="token string">"2012-01-01"</span><span class="token punctuation">,</span> <span class="token string">"2013-09-23"</span><span class="token punctuation">,</span> <span class="token string">"2014-11-15"</span><span class="token punctuation">,</span> <span class="token string">"2014-05-11"</span><span class="token punctuation">,</span> <span class="token string">"2015-03-27"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    stringsAsFactors <span class="token operator">=</span> <span class="token boolean">FALSE</span><span class="token punctuation">)</span><span class="token comment"># Print the summary.</span>print<span class="token punctuation">(</span>summary<span class="token punctuation">(</span>emp.data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment"># 当我们执行上面的代码，它产生以下结果：</span>     emp_id    emp_name             salary        start_date         Min.   <span class="token operator">:</span><span class="token number">1</span>   Length<span class="token operator">:</span><span class="token number">5</span>           Min.   <span class="token operator">:</span><span class="token number">515.2</span>   Min.   <span class="token operator">:</span><span class="token number">2012</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">01</span>   <span class="token number">1</span>st Qu.<span class="token operator">:</span><span class="token number">2</span>   Class <span class="token operator">:</span>character   <span class="token number">1</span>st Qu.<span class="token operator">:</span><span class="token number">611.0</span>   <span class="token number">1</span>st Qu.<span class="token operator">:</span><span class="token number">2013</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">23</span>   Median <span class="token operator">:</span><span class="token number">3</span>   Mode  <span class="token operator">:</span>character   Median <span class="token operator">:</span><span class="token number">623.3</span>   Median <span class="token operator">:</span><span class="token number">2014</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">11</span>   Mean   <span class="token operator">:</span><span class="token number">3</span>                      Mean   <span class="token operator">:</span><span class="token number">664.4</span>   Mean   <span class="token operator">:</span><span class="token number">2014</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">14</span>   <span class="token number">3</span>rd Qu.<span class="token operator">:</span><span class="token number">4</span>                      <span class="token number">3</span>rd Qu.<span class="token operator">:</span><span class="token number">729.0</span>   <span class="token number">3</span>rd Qu.<span class="token operator">:</span><span class="token number">2014</span><span class="token operator">-</span><span class="token number">11</span><span class="token operator">-</span><span class="token number">15</span>   Max.   <span class="token operator">:</span><span class="token number">5</span>                      Max.   <span class="token operator">:</span><span class="token number">843.2</span>   Max.   <span class="token operator">:</span><span class="token number">2015</span><span class="token operator">-</span><span class="token number">03</span><span class="token operator">-</span><span class="token number">27</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h2 id="从数据框提取数据"><a href="#从数据框提取数据" class="headerlink" title="从数据框提取数据"></a>从数据框提取数据</h2><p>使用列名称从数据框中提取特定列。</p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r"><span class="token comment"># Create the data frame.</span>emp.data <span class="token operator">&lt;-</span> data.frame<span class="token punctuation">(</span>   emp_id <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    emp_name <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token string">"Rick"</span><span class="token punctuation">,</span> <span class="token string">"Dan"</span><span class="token punctuation">,</span> <span class="token string">"Michelle"</span><span class="token punctuation">,</span> <span class="token string">"Ryan"</span><span class="token punctuation">,</span> <span class="token string">"Gary"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    salary <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token number">623.3</span><span class="token punctuation">,</span> <span class="token number">515.2</span><span class="token punctuation">,</span> <span class="token number">611.0</span><span class="token punctuation">,</span> <span class="token number">729.0</span><span class="token punctuation">,</span> <span class="token number">843.25</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    start_date <span class="token operator">=</span> as.Date<span class="token punctuation">(</span>c<span class="token punctuation">(</span><span class="token string">"2012-01-01"</span><span class="token punctuation">,</span> <span class="token string">"2013-09-23"</span><span class="token punctuation">,</span> <span class="token string">"2014-11-15"</span><span class="token punctuation">,</span> <span class="token string">"2014-05-11"</span><span class="token punctuation">,</span> <span class="token string">"2015-03-27"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    stringsAsFactors <span class="token operator">=</span> <span class="token boolean">FALSE</span><span class="token punctuation">)</span><span class="token comment"># Extract Specific columns.</span>result <span class="token operator">&lt;-</span> data.frame<span class="token punctuation">(</span>emp.data<span class="token operator">$</span>emp_name<span class="token punctuation">,</span> emp.data<span class="token operator">$</span>salary<span class="token punctuation">)</span>print<span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token comment"># 当我们执行上面的代码，它产生以下结果：</span>  emp.data.emp_name emp.data.salary<span class="token number">1</span>              Rick          <span class="token number">623.30</span><span class="token number">2</span>               Dan          <span class="token number">515.20</span><span class="token number">3</span>          Michelle          <span class="token number">611.00</span><span class="token number">4</span>              Ryan          <span class="token number">729.00</span><span class="token number">5</span>              Gary          <span class="token number">843.25</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p>先提取前两行，然后提取所有列</p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r"><span class="token comment"># Create the data frame.</span>emp.data <span class="token operator">&lt;-</span> data.frame<span class="token punctuation">(</span>   emp_id <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    emp_name <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token string">"Rick"</span><span class="token punctuation">,</span> <span class="token string">"Dan"</span><span class="token punctuation">,</span> <span class="token string">"Michelle"</span><span class="token punctuation">,</span> <span class="token string">"Ryan"</span><span class="token punctuation">,</span> <span class="token string">"Gary"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    salary <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token number">623.3</span><span class="token punctuation">,</span> <span class="token number">515.2</span><span class="token punctuation">,</span> <span class="token number">611.0</span><span class="token punctuation">,</span> <span class="token number">729.0</span><span class="token punctuation">,</span> <span class="token number">843.25</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    start_date <span class="token operator">=</span> as.Date<span class="token punctuation">(</span>c<span class="token punctuation">(</span><span class="token string">"2012-01-01"</span><span class="token punctuation">,</span> <span class="token string">"2013-09-23"</span><span class="token punctuation">,</span> <span class="token string">"2014-11-15"</span><span class="token punctuation">,</span> <span class="token string">"2014-05-11"</span><span class="token punctuation">,</span> <span class="token string">"2015-03-27"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    stringsAsFactors <span class="token operator">=</span> <span class="token boolean">FALSE</span><span class="token punctuation">)</span><span class="token comment"># Extract first two rows.</span>result <span class="token operator">&lt;-</span> emp.data<span class="token punctuation">[</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token punctuation">]</span>print<span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token comment"># 当我们执行上面的代码，它产生以下结果：</span>  emp_id    emp_name   salary    start_date<span class="token number">1</span>      <span class="token number">1</span>     Rick      <span class="token number">623.3</span>     <span class="token number">2012</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">01</span><span class="token number">2</span>      <span class="token number">2</span>     Dan       <span class="token number">515.2</span>     <span class="token number">2013</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">23</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p>提取第 2 列和第 4 列，第 3 行和第 5 行</p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r"><span class="token comment"># Create the data frame.</span>emp.data <span class="token operator">&lt;-</span> data.frame<span class="token punctuation">(</span>   emp_id <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    emp_name <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token string">"Rick"</span><span class="token punctuation">,</span> <span class="token string">"Dan"</span><span class="token punctuation">,</span> <span class="token string">"Michelle"</span><span class="token punctuation">,</span> <span class="token string">"Ryan"</span><span class="token punctuation">,</span> <span class="token string">"Gary"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    salary <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token number">623.3</span><span class="token punctuation">,</span> <span class="token number">515.2</span><span class="token punctuation">,</span> <span class="token number">611.0</span><span class="token punctuation">,</span> <span class="token number">729.0</span><span class="token punctuation">,</span> <span class="token number">843.25</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    start_date <span class="token operator">=</span> as.Date<span class="token punctuation">(</span>c<span class="token punctuation">(</span><span class="token string">"2012-01-01"</span><span class="token punctuation">,</span> <span class="token string">"2013-09-23"</span><span class="token punctuation">,</span> <span class="token string">"2014-11-15"</span><span class="token punctuation">,</span> <span class="token string">"2014-05-11"</span><span class="token punctuation">,</span> <span class="token string">"2015-03-27"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    stringsAsFactors <span class="token operator">=</span> <span class="token boolean">FALSE</span><span class="token punctuation">)</span><span class="token comment"># Extract 3rd and 5th row with 2nd and 4th column.</span>result <span class="token operator">&lt;-</span> emp.data<span class="token punctuation">[</span>c<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span> c<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">]</span>print<span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token comment"># 当我们执行上面的代码，它产生以下结果：</span>  emp_name start_date<span class="token number">3</span> Michelle <span class="token number">2014</span><span class="token operator">-</span><span class="token number">11</span><span class="token operator">-</span><span class="token number">15</span><span class="token number">5</span>     Gary <span class="token number">2015</span><span class="token operator">-</span><span class="token number">03</span><span class="token operator">-</span><span class="token number">27</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h2 id="扩展数据框"><a href="#扩展数据框" class="headerlink" title="扩展数据框"></a>扩展数据框</h2><p>可以通过添加列和行来扩展数据框。</p><h3 id="添加列"><a href="#添加列" class="headerlink" title="添加列"></a>添加列</h3><p>只需使用新的列名称添加列向量。</p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r"><span class="token comment"># Create the data frame.</span>emp.data <span class="token operator">&lt;-</span> data.frame<span class="token punctuation">(</span>   emp_id <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    emp_name <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token string">"Rick"</span><span class="token punctuation">,</span> <span class="token string">"Dan"</span><span class="token punctuation">,</span> <span class="token string">"Michelle"</span><span class="token punctuation">,</span> <span class="token string">"Ryan"</span><span class="token punctuation">,</span> <span class="token string">"Gary"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    salary <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token number">623.3</span><span class="token punctuation">,</span> <span class="token number">515.2</span><span class="token punctuation">,</span> <span class="token number">611.0</span><span class="token punctuation">,</span> <span class="token number">729.0</span><span class="token punctuation">,</span> <span class="token number">843.25</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    start_date <span class="token operator">=</span> as.Date<span class="token punctuation">(</span>c<span class="token punctuation">(</span><span class="token string">"2012-01-01"</span><span class="token punctuation">,</span> <span class="token string">"2013-09-23"</span><span class="token punctuation">,</span> <span class="token string">"2014-11-15"</span><span class="token punctuation">,</span> <span class="token string">"2014-05-11"</span><span class="token punctuation">,</span> <span class="token string">"2015-03-27"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    stringsAsFactors <span class="token operator">=</span> <span class="token boolean">FALSE</span><span class="token punctuation">)</span><span class="token comment"># Add the "dept" coulmn.</span>emp.data<span class="token operator">$</span>dept <span class="token operator">&lt;-</span> c<span class="token punctuation">(</span><span class="token string">"IT"</span><span class="token punctuation">,</span> <span class="token string">"Operations"</span><span class="token punctuation">,</span> <span class="token string">"IT"</span><span class="token punctuation">,</span> <span class="token string">"HR"</span><span class="token punctuation">,</span> <span class="token string">"Finance"</span><span class="token punctuation">)</span>v <span class="token operator">&lt;-</span> emp.dataprint<span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token comment"># 当我们执行上面的代码，它产生以下结果：</span>  emp_id   emp_name    salary    start_date       dept<span class="token number">1</span>     <span class="token number">1</span>    Rick        <span class="token number">623.30</span>    <span class="token number">2012</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">01</span>       IT<span class="token number">2</span>     <span class="token number">2</span>    Dan         <span class="token number">515.20</span>    <span class="token number">2013</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">23</span>       Operations<span class="token number">3</span>     <span class="token number">3</span>    Michelle    <span class="token number">611.00</span>    <span class="token number">2014</span><span class="token operator">-</span><span class="token number">11</span><span class="token operator">-</span><span class="token number">15</span>       IT<span class="token number">4</span>     <span class="token number">4</span>    Ryan        <span class="token number">729.00</span>    <span class="token number">2014</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">11</span>       HR<span class="token number">5</span>     <span class="token number">5</span>    Gary        <span class="token number">843.25</span>    <span class="token number">2015</span><span class="token operator">-</span><span class="token number">03</span><span class="token operator">-</span><span class="token number">27</span>       Finance<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h3 id="添加行"><a href="#添加行" class="headerlink" title="添加行"></a>添加行</h3><p>要将更多行永久添加到现有数据框，我们需要引入与现有数据框相同结构的新行，并使用 <code>rbind()</code> 函数。</p><p>在下面的示例中，我们创建一个包含新行的数据框，并将其与现有数据框合并以创建最终数据框。</p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r"><span class="token comment"># Create the first data frame.</span>emp.data <span class="token operator">&lt;-</span> data.frame<span class="token punctuation">(</span>   emp_id <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    emp_name <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token string">"Rick"</span><span class="token punctuation">,</span> <span class="token string">"Dan"</span><span class="token punctuation">,</span> <span class="token string">"Michelle"</span><span class="token punctuation">,</span> <span class="token string">"Ryan"</span><span class="token punctuation">,</span> <span class="token string">"Gary"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    salary <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token number">623.3</span><span class="token punctuation">,</span> <span class="token number">515.2</span><span class="token punctuation">,</span> <span class="token number">611.0</span><span class="token punctuation">,</span> <span class="token number">729.0</span><span class="token punctuation">,</span> <span class="token number">843.25</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    start_date <span class="token operator">=</span> as.Date<span class="token punctuation">(</span>c<span class="token punctuation">(</span><span class="token string">"2012-01-01"</span><span class="token punctuation">,</span> <span class="token string">"2013-09-23"</span><span class="token punctuation">,</span> <span class="token string">"2014-11-15"</span><span class="token punctuation">,</span> <span class="token string">"2014-05-11"</span><span class="token punctuation">,</span> <span class="token string">"2015-03-27"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    dept <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token string">"IT"</span><span class="token punctuation">,</span> <span class="token string">"Operations"</span><span class="token punctuation">,</span> <span class="token string">"IT"</span><span class="token punctuation">,</span> <span class="token string">"HR"</span><span class="token punctuation">,</span> <span class="token string">"Finance"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>   stringsAsFactors <span class="token operator">=</span> <span class="token boolean">FALSE</span><span class="token punctuation">)</span><span class="token comment"># Create the second data frame</span>emp.newdata <span class="token operator">&lt;-</span> data.frame<span class="token punctuation">(</span>   emp_id <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token number">6</span><span class="token operator">:</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    emp_name <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token string">"Rasmi"</span><span class="token punctuation">,</span> <span class="token string">"Pranab"</span><span class="token punctuation">,</span> <span class="token string">"Tusar"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>   salary <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token number">578.0</span><span class="token punctuation">,</span> <span class="token number">722.5</span><span class="token punctuation">,</span> <span class="token number">632.8</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    start_date <span class="token operator">=</span> as.Date<span class="token punctuation">(</span>c<span class="token punctuation">(</span><span class="token string">"2013-05-21"</span><span class="token punctuation">,</span> <span class="token string">"2013-07-30"</span><span class="token punctuation">,</span> <span class="token string">"2014-06-17"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>   dept <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token string">"IT"</span><span class="token punctuation">,</span> <span class="token string">"Operations"</span><span class="token punctuation">,</span> <span class="token string">"Fianance"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>   stringsAsFactors <span class="token operator">=</span> <span class="token boolean">FALSE</span><span class="token punctuation">)</span><span class="token comment"># Bind the two data frames.</span>emp.finaldata <span class="token operator">&lt;-</span> rbind<span class="token punctuation">(</span>emp.data<span class="token punctuation">,</span> emp.newdata<span class="token punctuation">)</span>print<span class="token punctuation">(</span>emp.finaldata<span class="token punctuation">)</span><span class="token comment"># 当我们执行上面的代码，它产生以下结果：</span>  emp_id     emp_name    salary     start_date       dept<span class="token number">1</span>      <span class="token number">1</span>     Rick        <span class="token number">623.30</span>     <span class="token number">2012</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">01</span>       IT<span class="token number">2</span>      <span class="token number">2</span>     Dan         <span class="token number">515.20</span>     <span class="token number">2013</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">23</span>       Operations<span class="token number">3</span>      <span class="token number">3</span>     Michelle    <span class="token number">611.00</span>     <span class="token number">2014</span><span class="token operator">-</span><span class="token number">11</span><span class="token operator">-</span><span class="token number">15</span>       IT<span class="token number">4</span>      <span class="token number">4</span>     Ryan        <span class="token number">729.00</span>     <span class="token number">2014</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">11</span>       HR<span class="token number">5</span>      <span class="token number">5</span>     Gary        <span class="token number">843.25</span>     <span class="token number">2015</span><span class="token operator">-</span><span class="token number">03</span><span class="token operator">-</span><span class="token number">27</span>       Finance<span class="token number">6</span>      <span class="token number">6</span>     Rasmi       <span class="token number">578.00</span>     <span class="token number">2013</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">21</span>       IT<span class="token number">7</span>      <span class="token number">7</span>     Pranab      <span class="token number">722.50</span>     <span class="token number">2013</span><span class="token operator">-</span><span class="token number">07</span><span class="token operator">-</span><span class="token number">30</span>       Operations<span class="token number">8</span>      <span class="token number">8</span>     Tusar       <span class="token number">632.80</span>     <span class="token number">2014</span><span class="token operator">-</span><span class="token number">06</span><span class="token operator">-</span><span class="token number">17</span>       Fianance<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h1 id="自带数据集"><a href="#自带数据集" class="headerlink" title="自带数据集"></a>自带数据集</h1><p>使用以下命令可以查询 R 语言自带的数据集：</p><p><pre class="line-numbers language-r" data-language="r"><code class="language-r">data<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><h2 id="向量数据集"><a href="#向量数据集" class="headerlink" title="向量数据集"></a>向量数据集</h2><div class="table-container"><table><thead><tr><th style="text-align:center">数据集</th><th style="text-align:center">内容</th></tr></thead><tbody><tr><td style="text-align:center">euro</td><td style="text-align:center">欧元汇率，长度为 11，每个元素都有命名</td></tr><tr><td style="text-align:center">landmasses</td><td style="text-align:center">48 个陆地的面积，每个都有命名</td></tr><tr><td style="text-align:center">precip</td><td style="text-align:center">长度为 70 的命名向量</td></tr><tr><td style="text-align:center">rivers</td><td style="text-align:center">北美 141 条河流长度</td></tr><tr><td style="text-align:center">state.abb</td><td style="text-align:center">美国 50 个州的双字母缩写</td></tr><tr><td style="text-align:center">state.area</td><td style="text-align:center">美国 50 个州的面积</td></tr><tr><td style="text-align:center">state.name</td><td style="text-align:center">美国 50 个州的全称</td></tr></tbody></table></div><h2 id="因子数据集"><a href="#因子数据集" class="headerlink" title="因子数据集"></a>因子数据集</h2><div class="table-container"><table><thead><tr><th style="text-align:center">数据集</th><th style="text-align:center">内容</th></tr></thead><tbody><tr><td style="text-align:center">state.division</td><td style="text-align:center">美国 50 个州的分类，9 个类别</td></tr><tr><td style="text-align:center">state.region</td><td style="text-align:center">美国 50 个州的地理分类</td></tr></tbody></table></div><h2 id="矩阵、数组数据集"><a href="#矩阵、数组数据集" class="headerlink" title="矩阵、数组数据集"></a>矩阵、数组数据集</h2><div class="table-container"><table><thead><tr><th style="text-align:center">数据集</th><th style="text-align:center">内容</th></tr></thead><tbody><tr><td style="text-align:center">euro.cross</td><td style="text-align:center">11 种货币的汇率矩阵</td></tr><tr><td style="text-align:center">freeny</td><td style="text-align:center">每个季度影响收入四个因素的记录</td></tr><tr><td style="text-align:center">state.x77</td><td style="text-align:center">美国 50 个州的八个指标</td></tr><tr><td style="text-align:center">USPersonalExpenditure</td><td style="text-align:center">5 个年份在 5 个消费方向的数据</td></tr><tr><td style="text-align:center">VADeaths</td><td style="text-align:center">1940 年弗吉尼亚州死亡率（每千人）</td></tr><tr><td style="text-align:center">volcano</td><td style="text-align:center">某火山区的地理信息（10 米 × 10 米的网格）</td></tr><tr><td style="text-align:center">WorldPhones</td><td style="text-align:center">8 个区域在 7 个年份的电话总数</td></tr><tr><td style="text-align:center">iris3</td><td style="text-align:center">3 种鸢尾花形态数据</td></tr><tr><td style="text-align:center">Titanic</td><td style="text-align:center">泰坦尼克乘员统计</td></tr><tr><td style="text-align:center">UCBAdmissions</td><td style="text-align:center">伯克利分校 1973 年院系、录取和性别的频数</td></tr><tr><td style="text-align:center">crimtab</td><td style="text-align:center">3000 个男性罪犯左手中指长度和身高关系</td></tr><tr><td style="text-align:center">HairEyeColor</td><td style="text-align:center">592 人头发颜色、眼睛颜色和性别的频数</td></tr><tr><td style="text-align:center">occupationalStatus</td><td style="text-align:center">英国男性父子职业联系</td></tr></tbody></table></div><h2 id="类矩阵数据集"><a href="#类矩阵数据集" class="headerlink" title="类矩阵数据集"></a>类矩阵数据集</h2><div class="table-container"><table><thead><tr><th style="text-align:center">数据集</th><th style="text-align:center">内容</th></tr></thead><tbody><tr><td style="text-align:center">eurodist</td><td style="text-align:center">欧洲 12 个城市的距离矩阵，只有下三角部分</td></tr><tr><td style="text-align:center">Harman23.cor</td><td style="text-align:center">305 个女孩 8 个形态指标的相关系数矩阵</td></tr><tr><td style="text-align:center">Harman74.cor</td><td style="text-align:center">145 个儿童 24 个心理指标的相关系数矩阵</td></tr></tbody></table></div><h2 id="数据框数据集"><a href="#数据框数据集" class="headerlink" title="数据框数据集"></a>数据框数据集</h2><div class="table-container"><table><thead><tr><th style="text-align:center">数据集</th><th style="text-align:center">内容</th></tr></thead><tbody><tr><td style="text-align:center">airquality</td><td style="text-align:center">纽约 1973 年 5-9 月每日空气质量</td></tr><tr><td style="text-align:center">anscombe</td><td style="text-align:center">四组 x-y 数据，虽有相似的统计量，但实际数据差别较大</td></tr><tr><td style="text-align:center">attenu</td><td style="text-align:center">多个观测站对加利福尼亚 23 次地震的观测数据</td></tr><tr><td style="text-align:center">attitude</td><td style="text-align:center">30 个部门在七个方面的调查结果，调查结果是同一部门 35 个职员赞成的百分比</td></tr><tr><td style="text-align:center">beaver1</td><td style="text-align:center">一只海狸每 10 分钟的体温数据，共 114 条数据</td></tr><tr><td style="text-align:center">beaver2</td><td style="text-align:center">另一只海狸每 10 分钟的体温数据，共 100 条数据</td></tr><tr><td style="text-align:center">BOD</td><td style="text-align:center">随水质的提高，生化反应对氧的需求（mg/l）随时间（天）的变化</td></tr><tr><td style="text-align:center">cars</td><td style="text-align:center">1920 年代汽车速度对刹车距离的影响</td></tr><tr><td style="text-align:center">chickwts</td><td style="text-align:center">不同饮食种类对小鸡生长速度的影响</td></tr><tr><td style="text-align:center">esoph</td><td style="text-align:center">法国的一个食管癌病例对照研究</td></tr><tr><td style="text-align:center">faithful</td><td style="text-align:center">一个间歇泉的爆发时间和持续时间</td></tr><tr><td style="text-align:center">Formaldehyde</td><td style="text-align:center">两种方法测定甲醛浓度时分光光度计的读数</td></tr><tr><td style="text-align:center">Freeny</td><td style="text-align:center">每季度收入和其他四因素的记录</td></tr><tr><td style="text-align:center">dating from</td><td style="text-align:center">配对的病例对照数据，用于条件 logistic 回归</td></tr><tr><td style="text-align:center">InsectSprays</td><td style="text-align:center">使用不同杀虫剂时昆虫数目</td></tr><tr><td style="text-align:center">iris</td><td style="text-align:center">3 种鸢尾花形态数据</td></tr><tr><td style="text-align:center">LifeCycleSavings</td><td style="text-align:center">50 个国家的存款率</td></tr><tr><td style="text-align:center">longley</td><td style="text-align:center">强共线性的宏观经济数据</td></tr><tr><td style="text-align:center">morley</td><td style="text-align:center">光速测量试验数据</td></tr><tr><td style="text-align:center">mtcars</td><td style="text-align:center">32 辆汽车在 11 个指标上的数据</td></tr><tr><td style="text-align:center">OrchardSprays</td><td style="text-align:center">使用拉丁方设计研究不同喷雾剂对蜜蜂的影响</td></tr><tr><td style="text-align:center">PlantGrowth</td><td style="text-align:center">三种处理方式对植物产量的影响</td></tr><tr><td style="text-align:center">pressure</td><td style="text-align:center">温度和气压</td></tr><tr><td style="text-align:center">Puromycin</td><td style="text-align:center">两种细胞中辅因子浓度对酶促反应的影响</td></tr><tr><td style="text-align:center">quakes</td><td style="text-align:center">1000 次地震观测数据（震级 4）</td></tr><tr><td style="text-align:center">randu</td><td style="text-align:center">使用 FORTRAN 中的 RANDU 三个一组生成随机数字，共 400 组。</td></tr><tr><td style="text-align:center">rock</td><td style="text-align:center">48 块石头的形态数据</td></tr><tr><td style="text-align:center">sleep</td><td style="text-align:center">两药物的催眠效果</td></tr><tr><td style="text-align:center">stackloss</td><td style="text-align:center">化工厂将氨转为硝酸的数据</td></tr><tr><td style="text-align:center">swiss</td><td style="text-align:center">瑞士生育率和社会经济指标</td></tr><tr><td style="text-align:center">ToothGrowth</td><td style="text-align:center">VC 剂量和摄入方式对豚鼠牙齿的影响</td></tr><tr><td style="text-align:center">trees</td><td style="text-align:center">树木形态指标</td></tr><tr><td style="text-align:center">USArrests</td><td style="text-align:center">美国 50 个州的四个犯罪率指标</td></tr><tr><td style="text-align:center">USJudgeRatings</td><td style="text-align:center">43 名律师的 12 个评价指标</td></tr><tr><td style="text-align:center">warpbreaks</td><td style="text-align:center">织布机异常数据</td></tr><tr><td style="text-align:center">women</td><td style="text-align:center">15 名女性的身高和体重</td></tr></tbody></table></div><h2 id="列表数据集"><a href="#列表数据集" class="headerlink" title="列表数据集"></a>列表数据集</h2><div class="table-container"><table><thead><tr><th style="text-align:center">数据集</th><th style="text-align:center">内容</th></tr></thead><tbody><tr><td style="text-align:center">state.center</td><td style="text-align:center">美国 50 个州中心的经度和纬度</td></tr></tbody></table></div><h2 id="类数据框数据集"><a href="#类数据框数据集" class="headerlink" title="类数据框数据集"></a>类数据框数据集</h2><div class="table-container"><table><thead><tr><th style="text-align:center">数据集</th><th style="text-align:center">内容</th></tr></thead><tbody><tr><td style="text-align:center">ChickWeight</td><td style="text-align:center">饮食对鸡生长的影响</td></tr><tr><td style="text-align:center">CO2</td><td style="text-align:center">耐寒植物 CO2 摄取的差异</td></tr><tr><td style="text-align:center">DNase</td><td style="text-align:center">若干次试验中，DNase 浓度和光密度的关系</td></tr><tr><td style="text-align:center">Indometh</td><td style="text-align:center">某药物的药物动力学数据</td></tr><tr><td style="text-align:center">Loblolly</td><td style="text-align:center">火炬松的高度、年龄和种源</td></tr><tr><td style="text-align:center">Orange</td><td style="text-align:center">桔子树生长数据</td></tr><tr><td style="text-align:center">Theoph</td><td style="text-align:center">茶碱药动学数据</td></tr></tbody></table></div><h2 id="时间序列数据集"><a href="#时间序列数据集" class="headerlink" title="时间序列数据集"></a>时间序列数据集</h2><div class="table-container"><table><thead><tr><th style="text-align:center">数据集</th><th style="text-align:center">内容</th></tr></thead><tbody><tr><td style="text-align:center">airmiles</td><td style="text-align:center">美国 1937-1960 年客运里程营收（实际售出机位乘以飞行哩数）</td></tr><tr><td style="text-align:center">AirPassengers</td><td style="text-align:center">Box &amp; Jenkins 航空公司 1949-1960 年每月国际航线乘客数</td></tr><tr><td style="text-align:center">austres</td><td style="text-align:center">澳大利亚 1971-1994 每季度人口数（以千为单位）</td></tr><tr><td style="text-align:center">BJsales</td><td style="text-align:center">有关销售的一个时间序列</td></tr><tr><td style="text-align:center">BJsales.lead</td><td style="text-align:center">前一指标的先行指标（leading indicator）</td></tr><tr><td style="text-align:center">co2</td><td style="text-align:center">1959-1997 年每月大气 co2 浓度（ppm）</td></tr><tr><td style="text-align:center">discoveries</td><td style="text-align:center">1860-1959 年每年巨大发现或发明的个数</td></tr><tr><td style="text-align:center">ldeaths</td><td style="text-align:center">1974-1979 年英国每月支气管炎、肺气肿和哮喘的死亡率</td></tr><tr><td style="text-align:center">fdeaths</td><td style="text-align:center">前述死亡率的女性部分</td></tr><tr><td style="text-align:center">mdeaths</td><td style="text-align:center">前述死亡率的男性部分</td></tr><tr><td style="text-align:center">freeny.y</td><td style="text-align:center">每季度收入</td></tr><tr><td style="text-align:center">JohnsonJohnson</td><td style="text-align:center">1960-1980 年每季度 Johnson &amp; Johnson 股票的红利</td></tr><tr><td style="text-align:center">LakeHuron</td><td style="text-align:center">1875-1972 年某一湖泊水位的记录</td></tr><tr><td style="text-align:center">lh</td><td style="text-align:center">黄体生成素水平，10 分钟测量一次</td></tr><tr><td style="text-align:center">lynx</td><td style="text-align:center">1821-1934 年加拿大猞猁数据</td></tr><tr><td style="text-align:center">nhtemp</td><td style="text-align:center">1912-1971 年每年平均温度</td></tr><tr><td style="text-align:center">Nile</td><td style="text-align:center">1871-1970 尼罗河流量</td></tr><tr><td style="text-align:center">nottem</td><td style="text-align:center">1920-1939 每月大气温度</td></tr><tr><td style="text-align:center">presidents</td><td style="text-align:center">1945-1974 年每季度美国总统支持率</td></tr><tr><td style="text-align:center">UKDriverDeaths</td><td style="text-align:center">1969-1984 年每月英国司机死亡或严重伤害的数目</td></tr><tr><td style="text-align:center">sunspot.month</td><td style="text-align:center">1749-1997 每月太阳黑子数</td></tr><tr><td style="text-align:center">sunspot.year</td><td style="text-align:center">1700-1988 每年太阳黑子数</td></tr><tr><td style="text-align:center">sunspots</td><td style="text-align:center">1749-1983 每月太阳黑子数</td></tr><tr><td style="text-align:center">treering</td><td style="text-align:center">归一化的树木年轮数据</td></tr><tr><td style="text-align:center">UKgas</td><td style="text-align:center">1960-1986 每月英国天然气消耗</td></tr><tr><td style="text-align:center">USAccDeaths</td><td style="text-align:center">1973-1978 美国每月意外死亡人数</td></tr><tr><td style="text-align:center">uspop</td><td style="text-align:center">1790–1970 美国每十年一次的人口总数（百万为单位）</td></tr><tr><td style="text-align:center">WWWusage</td><td style="text-align:center">每分钟网络连接数</td></tr><tr><td style="text-align:center">Seatbelts</td><td style="text-align:center">多变量时间序列。和 UKDriverDeaths 时间段相同，反映更多因素。</td></tr><tr><td style="text-align:center">EuStockMarkets</td><td style="text-align:center">多变量时间序列。欧洲股市四个主要指标的每个工作日记录，共 1860 条记录。</td></tr></tbody></table></div>]]></content>
      
      
      <categories>
          
          <category> 教程笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 大数据 </tag>
            
            <tag> R </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MySQL 优化</title>
      <link href="post/d7961cf0.html"/>
      <url>post/d7961cf0.html</url>
      
        <content type="html"><![CDATA[<h1 id="优化三大方向"><a href="#优化三大方向" class="headerlink" title="优化三大方向"></a>优化三大方向</h1><ul><li>优化 MySQL 所在服务器内核（此优化一般由运维人员完成）。</li><li>对 MySQL 配置参数进行优化（my.cnf）此优化需要进行压力测试来进行参数调整。</li><li>对 SQL 语句以及表优化。</li></ul><h1 id="参数优化"><a href="#参数优化" class="headerlink" title="参数优化"></a>参数优化</h1><ol><li><p>MySQL 默认的最大连接数为 100，可以在 <code>mysql</code> 命令提示窗口使用以下命令查看</p><p> <pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">mysql<span class="token operator">></span> <span class="token keyword">SHOW</span> variables <span class="token operator">LIKE</span> <span class="token string">'max_connections'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p></li><li><p>查看当前访问 MySQL 的线程</p><p> <pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">mysql<span class="token operator">></span> <span class="token keyword">SHOW</span> processlist<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p></li><li><p>设置最大连接数</p><p> <pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">mysql<span class="token operator">></span> <span class="token keyword">SET</span> globle max_connections <span class="token operator">=</span> <span class="token number">5000</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><p> 最大可设置 <code>16384</code>，超过没用</p></li><li><p>查看当前被使用的 connections</p><p> <pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">mysql<span class="token operator">></span> <span class="token keyword">SHOW</span> <span class="token keyword">GLOBAL</span> <span class="token keyword">STATUS</span> <span class="token operator">LIKE</span> <span class="token string">'max_user_connections'</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p></li></ol><h1 id="性能优化"><a href="#性能优化" class="headerlink" title="性能优化"></a>性能优化</h1><ul><li><a href="#使用查询缓存优化查询">使用查询缓存优化查询</a></li><li><a href="#使用-EXPLAIN-关键字检测查询">使用 EXPLAIN 关键字检测查询</a></li><li><a href="#只要一行数据时使用-LIMIT-1">只要一行数据时使用 LIMIT 1</a></li><li><a href="#为搜索字段建立索引">为搜索字段建立索引</a></li><li><a href="#在-JOIN-表的时候使用相当类型的列并将其索引">在 JOIN 表的时候使用相当类型的列并将其索引</a></li><li><a href="#切记不要使用-ORDER-BY-RAND">切记不要使用 ORDER BY RAND()</a></li><li><a href="#避免使用-SELECT">避免使用 SELECT *</a></li><li><a href="#永远为每张表设置一个-ID-主键">永远为每张表设置一个 ID 主键</a></li><li><a href="#可以使用-ENUM-则不用-VARCHAR">可以使用 ENUM 则不用 VARCHAR</a></li><li><a href="#尽可能的不要赋值为-NULL">尽可能的不要赋值为 NULL</a></li><li><a href="#固定长度的表会更快">固定长度的表会更快</a></li><li><a href="#垂直分割">垂直分割</a></li><li><a href="#拆分大的-DELETE-或-INSERT-语句">拆分大的 DELETE 或 INSERT 语句</a></li><li><a href="#越小的列会越快">越小的列会越快</a></li><li><a href="#选择正确的存储引擎">选择正确的存储引擎</a></li><li><a href="#小心永久链接">小心永久链接</a></li></ul><h2 id="使用查询缓存优化查询"><a href="#使用查询缓存优化查询" class="headerlink" title="使用查询缓存优化查询"></a>使用查询缓存优化查询</h2><p>大多数的 MySQL 服务器都开启了查询缓存。这是提高性能最有效的方法之一，而且这是被 MySQL 引擎处理的。当有很多相同的查询被执行了多次的时候，这些查询结果会被放入一个缓存中，这样后续的相同查询就不用操作而直接访问缓存结果了。</p><p>这里最主要的问题是，对于我们程序员来说，这个事情是很容易被忽略的。因为我们某些查询语句会让 MySQL 不使用缓存，示例如下：</p><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> username <span class="token keyword">FROM</span> <span class="token keyword">user</span> <span class="token keyword">WHERE</span> signup_date <span class="token operator">>=</span> CURDATE<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">SELECT</span> username <span class="token keyword">FROM</span> <span class="token keyword">user</span> <span class="token keyword">WHERE</span> signup_date <span class="token operator">>=</span> <span class="token string">'2014-06-24'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></p><p>上面两条 SQL 语句的差别就是 <code>CURDATE()</code> ，MySQL 的查询缓存对这个函数不起作用。所以，像 <code>NOW()</code> 和 <code>RAND()</code> 或是其它的诸如此类的 SQL 函数都不会开启查询缓存，因为这些函数的返回是会不定的易变的。所以，你所需要的就是用一个变量来代替 MySQL 的函数，从而开启缓存。</p><h2 id="使用-EXPLAIN-关键字检测查询"><a href="#使用-EXPLAIN-关键字检测查询" class="headerlink" title="使用 EXPLAIN 关键字检测查询"></a>使用 EXPLAIN 关键字检测查询</h2><p>使用 <code>EXPLAIN</code> 关键字可以使我们知道 MySQL 是如何处理 SQL 语句的，这样可以帮助我们分析我们的查询语句或是表结构的性能瓶颈；<code>EXPLAIN</code> 的查询结果还会告诉我们索引主键是如何被利用的，数据表是如何被被搜索或排序的等等。语法格式是 <code>EXPLAIN + SELECT</code> 语句：</p><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">EXPLAIN</span> <span class="token keyword">SELECT</span> <span class="token operator">&lt;</span>字段名<span class="token operator">></span> <span class="token keyword">FROM</span> <span class="token operator">&lt;</span>表名<span class="token operator">></span> <span class="token keyword">WHERE</span> <span class="token operator">&lt;</span>表达式<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><p><img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="/images/post/mysql_optimization/explain_1.png" alt></p><p><img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="/images/post/mysql_optimization/explain_2.png" alt></p><p>我们可以看到，前一个结果显示搜索了 <code>7883</code> 行，而后一个只是搜索了两个表的 <code>9</code> 和 <code>16</code> 行。查看 <code>rows</code> 列可以让我们找到潜在的性能问题。 </p><h2 id="只要一行数据时使用-LIMIT-1"><a href="#只要一行数据时使用-LIMIT-1" class="headerlink" title="只要一行数据时使用 LIMIT 1"></a>只要一行数据时使用 LIMIT 1</h2><p>加上 <code>LIMIT 1</code> 可以增加性能。MySQL 数据库引擎会在查找到一条数据后停止搜索，而不是继续往后查询下一条符合条件的数据记录。</p><h2 id="为搜索字段建立索引"><a href="#为搜索字段建立索引" class="headerlink" title="为搜索字段建立索引"></a>为搜索字段建立索引</h2><p>索引不一定就是给主键或者是唯一的字段，如果在表中，有某个字段经常用来做搜索，需要将其建立索引。</p><p><strong>索引的有关操作如下：</strong></p><h3 id="创建索引"><a href="#创建索引" class="headerlink" title="创建索引"></a>创建索引</h3><p>在执行 <code>CREATE TABLE</code> 语句时可以创建索引，也可以单独用 <code>CREATE INDEX</code> 或 <code>ALTER TABLE</code> 来为表增加索引。</p><ol><li><p>ALTER TABLE</p><p> ALTER TABLE 用来创建普通索引、唯一索引、主键索引和全文索引</p><p> <pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> table_name <span class="token keyword">ADD</span> <span class="token keyword">INDEX</span> index_name <span class="token punctuation">(</span>column_list<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> table_name <span class="token keyword">ADD</span> <span class="token keyword">UNIQUE</span> <span class="token punctuation">(</span>column_list<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> table_name <span class="token keyword">ADD</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span>column_list<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> table_name <span class="token keyword">ADD</span> FULLTEXT <span class="token punctuation">(</span>column_list<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></p><p> 其中 <code>table_name</code> 是要增加索引名的表名，<code>column_list</code> 指出对哪些列进行索引，多列时各列之间使用半角逗号隔开。索引名 <code>index_name</code> 是可选的，如果不指定索引名称，MySQL 将根据第一个索引列自动指定索引名称，另外，<code>ALTER TABLE</code> 允许在单个语句中更改多个表，因此可以在同时创建多个索引。</p></li><li><p>CREATE INDEX</p><p> <code>CREATE INDEX</code> 可对表增加普通索引或唯一索引以及全文索引，但是不可以对表增加主键索引</p><p> <pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">INDEX</span> index_name <span class="token keyword">ON</span> table_name <span class="token punctuation">(</span>column_list<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">CREATE</span> <span class="token keyword">UNIQUE</span> index_name <span class="token keyword">ON</span> table_name <span class="token punctuation">(</span>column_list<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">CREATE</span> FULLTEXT index_name <span class="token keyword">ON</span> table_name <span class="token punctuation">(</span>column_list<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></p><p> <code>table_name</code>、<code>index_name</code> 和 <code>column_list</code> 具有与 <code>ALTER TABLE</code> 语句中相同的含义，索引名必须指定。另外，不能用 <code>CREATE INDEX</code> 语句创建 <code>PRIMARY KEY</code> 索引。</p></li></ol><h3 id="索引类型"><a href="#索引类型" class="headerlink" title="索引类型"></a>索引类型</h3><ul><li>普通索引（INDEX）：适用于 name、email 等一般属性</li><li>唯一索引（UNIQUE）：与普通索引类似，不同的是唯一索引要求索引字段值在表中是唯一的，这一点和主键索引类似，但是不同的是，唯一索引允许有空值。唯一索引一般适用于身份证号码、用户账号等不允许有重复的属性字段上。</li><li>主键索引（PRIMARY KEY）：其实就是主键，一般在建表时就指定了，不需要额外添加。</li><li>全文检索（FULLTEXT）：只适用于 <code>VARCHAR</code> 和 <code>TEXT</code> 类型的字段。</li></ul><p><strong>注意</strong>：全文索引和普通索引是有很大区别的，如果建立的是普通索引，一般会使用 <code>LIKE</code> 进行模糊查询，只会对查询内容前一部分有效，即只对前面不使用通配符的查询有效，如果前后都有通配符，普通索引将不会起作用。对于全文索引而言在查询时有自己独特的匹配方式，例如我们在对一篇文章的标题和内容进行全文索引时：</p><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> article <span class="token keyword">ADD</span> FULLTEXT <span class="token punctuation">(</span><span class="token string">'title'</span><span class="token punctuation">,</span> <span class="token string">'content'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment"># 在进行检索时就需要使用如下的语法进行检索：</span><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> article <span class="token keyword">WHERE</span> <span class="token keyword">MATCH</span><span class="token punctuation">(</span><span class="token string">'title'</span><span class="token punctuation">,</span> <span class="token string">'content'</span><span class="token punctuation">)</span> AGAINST <span class="token punctuation">(</span><span class="token string">'查询字符串'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></p><p><strong>在使用全文检索时的注意事项：</strong></p><p>MySQL 自带的全文索引只能用于数据库引擎为 <code>MyISAM</code> 的数据表，如果是其他数据引擎，则全文索引不会生效。此外，MySQL 自带的全文索引只能对英文进行全文检索，目前无法对中文进行全文检索。如果需要对包含中文在内的文本数据进行全文检索，我们需要采用 Sphinx/Coreseek 技术来处理中文。另外使用 MySQL 自带的全文索引时，如果查询字符串的长度过短将无法得到期望的搜索结果。MySQL 全文索引所能找到的词默认最小长度为 4 个字符。另外，如果查询的字符串包含停止词，那么该停止词将会被忽略。</p><h3 id="组合索引"><a href="#组合索引" class="headerlink" title="组合索引"></a>组合索引</h3><p>组合索引又称多列索引，就是建立索引时指定多个字段属性。有点类似于字典目录，比如查询 <code>guo</code> 这个拼音的字时，首先查找 <code>g</code> 字母，然后在 <code>g</code> 的检索范围内查询第二个字母为 <code>u</code> 的列表，最后在 <code>u</code> 的范围内查找最后一个字母为 <code>o</code> 的字。比如组合索引 <code>(a,b,c)</code>，<code>abc</code> 都是排好序的，在任意一段 <code>a</code> 的下面 <code>b</code> 都是排好序的，任何一段 <code>b</code> 下面 <code>c</code> 都是排好序的。</p><p>组合索引的生效原则是：从前往后依次使用生效，如果中间某个索引没有使用，那么断点前面的索引部分起作用，断点后面的索引没有起作用。</p><p>造成断点的原因：</p><ul><li>前边的任意一个索引没有参与查询，后边的全部不生效。</li><li>前边的任意一个索引字段参与的是范围查询，后面的不会生效。</li><li>断点跟索引字字段在SQL语句中的位置前后无关，只与是否存在有关。</li></ul><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> mytable <span class="token keyword">WHERE</span> a<span class="token operator">=</span><span class="token number">3</span> <span class="token operator">AND</span> b<span class="token operator">=</span><span class="token number">45</span> <span class="token operator">AND</span> c<span class="token operator">=</span><span class="token number">5</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token comment"># 这种三个索引顺序使用中间没有断点，全部发挥作用</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> mytable <span class="token keyword">WHERE</span> a<span class="token operator">=</span><span class="token number">3</span> <span class="token operator">AND</span> c<span class="token operator">=</span><span class="token number">5</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token comment"># 这种情况下 b 就是断点，a 发挥了效果，c 没有效果</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> mytable <span class="token keyword">WHERE</span> b<span class="token operator">=</span><span class="token number">3</span> <span class="token operator">AND</span> c<span class="token operator">=</span><span class="token number">4</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token comment"># 这种情况下 a 就是断点，在 a 后面的索引都没有发挥作用，这种写法联合索引没有发挥任何效果</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> mytable <span class="token keyword">WHERE</span> b<span class="token operator">=</span><span class="token number">45</span> <span class="token operator">AND</span> a<span class="token operator">=</span><span class="token number">3</span> <span class="token operator">AND</span> c<span class="token operator">=</span><span class="token number">5</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token comment"># 这个跟第一个一样，全部发挥作用，abc 只要用上了就行，跟写的顺序无关</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p><code>(a,b,c)</code> 三个列上加了联合索引（是联合索引，不是在每个列上单独加索引）而是建立了 <code>a</code>, <code>(a,b)</code>, <code>(a,b,c)</code>三个索引，另外 <code>(a,b,c)</code> 多列索引和 <code>(a,c,b)</code> 是不一样的。</p><p>具体实例可以说明：</p><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> mytable <span class="token keyword">WHERE</span> a<span class="token operator">=</span><span class="token number">3</span> <span class="token operator">AND</span> b<span class="token operator">=</span><span class="token number">5</span> <span class="token operator">AND</span> c<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">;</span><span class="token comment"># abc 三个索引都在 WHERE 条件里面用到了，而且都发挥了作用</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> mytable <span class="token keyword">WHERE</span> c<span class="token operator">=</span><span class="token number">4</span> <span class="token operator">AND</span> b<span class="token operator">=</span><span class="token number">6</span> <span class="token operator">AND</span> a<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">;</span><span class="token comment"># 这条语句为了说明 组合索引与在 SQL 中的位置先后无关，WHERE 里面的条件顺序在查询之前会被 MySQL 自动优化，效果跟上一句一样</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> mytable <span class="token keyword">WHERE</span> a<span class="token operator">=</span><span class="token number">3</span> <span class="token operator">AND</span> c<span class="token operator">=</span><span class="token number">7</span><span class="token punctuation">;</span><span class="token comment"># a 用到索引，b 没有用，所以 c 是没有用到索引效果的</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> mytable <span class="token keyword">WHERE</span> a<span class="token operator">=</span><span class="token number">3</span> <span class="token operator">AND</span> b<span class="token operator">></span><span class="token number">7</span> <span class="token operator">AND</span> c<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">;</span><span class="token comment"># a 用到了，b 也用到了，c 没有用到，这个地方 b 是范围值，也算断点，只不过自身用到了索引</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> mytable <span class="token keyword">WHERE</span> b<span class="token operator">=</span><span class="token number">3</span> <span class="token operator">AND</span> c<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">;</span><span class="token comment"># 因为 a 索引没有使用，所以这里 bc 都没有用上索引效果</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> mytable <span class="token keyword">WHERE</span> a<span class="token operator">></span><span class="token number">4</span> <span class="token operator">AND</span> b<span class="token operator">=</span><span class="token number">7</span> <span class="token operator">AND</span> c<span class="token operator">=</span><span class="token number">9</span><span class="token punctuation">;</span><span class="token comment"># a 用到了 b 没有使用，c 没有使用</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> mytable <span class="token keyword">WHERE</span> a<span class="token operator">=</span><span class="token number">3</span> <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> b<span class="token punctuation">;</span><span class="token comment"># a 用到了索引，b 在结果排序中也用到了索引的效果，前面说了，a 下面任意一段的 b 是排好序的</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> mytable <span class="token keyword">WHERE</span> a<span class="token operator">=</span><span class="token number">3</span> <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> c<span class="token punctuation">;</span><span class="token comment"># a 用到了索引，但是这个地方 c 没有发挥排序效果，因为中间断点了，使用 EXPLAIN 可以看到 filesort</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> mytable <span class="token keyword">WHERE</span> b<span class="token operator">=</span><span class="token number">3</span> <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> a<span class="token punctuation">;</span><span class="token comment"># b 没有用到索引，排序中 a 也没有发挥索引效果</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p><strong>注意</strong>：在查询时，MySQL 只能使用一个索引，如果建立的是多个单列的普通索引，在查询时会根据查询的索引字段，从中选择一个限制最严格的单例索引进行查询。别的索引都不会生效。</p><h3 id="查看索引"><a href="#查看索引" class="headerlink" title="查看索引"></a>查看索引</h3><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SHOW</span> <span class="token keyword">INDEX</span> <span class="token keyword">FROM</span> tblname<span class="token punctuation">;</span><span class="token keyword">SHOW</span> <span class="token keyword">KEYS</span> <span class="token keyword">FROM</span> tblname<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></p><h3 id="删除索引"><a href="#删除索引" class="headerlink" title="删除索引"></a>删除索引</h3><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">DORP <span class="token keyword">INDEX</span> IndexName <span class="token keyword">ON</span> tab_name；<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><p><strong>注意：不能使用索引的情况</strong></p><p>对于普通索引而言在使用 <code>LIKE</code> 进行通配符模糊查询时，如果首尾之间都使用了通配符，索引时无效的。</p><p>假设查询内容的关键词为 <code>abc</code>：</p><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> tab_name <span class="token keyword">WHERE</span> index_column <span class="token operator">LIKE</span> <span class="token string">'abc%'</span><span class="token punctuation">;</span> <span class="token comment"># 索引是有效的</span><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> tab_name <span class="token keyword">WHERE</span> index_column <span class="token operator">LIKE</span> <span class="token string">'%abc'</span><span class="token punctuation">;</span> <span class="token comment"># 索引是无效的</span><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> tab_name <span class="token keyword">WHERE</span> index_column <span class="token operator">LIKE</span> <span class="token string">'%abc%'</span><span class="token punctuation">;</span> <span class="token comment"># 索引是无效的</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></p><p>当检索的字段内容比较大而且检索内容前后部分都不确定的情况下，可以改为全文索引，并使用特定的检索方式。</p><h2 id="在-JOIN-表的时候使用相当类型的列并将其索引"><a href="#在-JOIN-表的时候使用相当类型的列并将其索引" class="headerlink" title="在 JOIN 表的时候使用相当类型的列并将其索引"></a>在 JOIN 表的时候使用相当类型的列并将其索引</h2><p>如果在程序中有很多 <code>JOIN</code> 查询，应该保证两个表中 <code>JOIN</code> 的字段时被建立过索引的。这样 MySQL 内部会启动优化 <code>JOIN</code> 的 SQL 语句的机制。</p><p><strong>注意</strong>：这些被用来 <code>JOIN</code> 的字段，应该是相同类型的。例如：如果要把 <code>DECIMAL</code> 字段和一个 <code>INT</code> 字段 <code>JOIN</code> 在一起，MySQL 就无法使用它们的索引。对于那些 <code>STRING</code> 类型，还需要有相同的字符集才行（两个表的字符集有可能不一样）。</p><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> company_name<span class="token keyword">FROM</span> users<span class="token keyword">LEFT</span> <span class="token keyword">JOIN</span> companies<span class="token keyword">ON</span> <span class="token punctuation">(</span>users<span class="token punctuation">.</span>state <span class="token operator">=</span> companies<span class="token punctuation">.</span>state<span class="token punctuation">)</span><span class="token keyword">WHERE</span> users<span class="token punctuation">.</span>id <span class="token operator">=</span> <span class="token string">"user_id"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p>两个 <code>state</code> 字段应该是被建过索引的，而且应该是相当的类型，相同的字符集。</p><h2 id="切记不要使用-ORDER-BY-RAND"><a href="#切记不要使用-ORDER-BY-RAND" class="headerlink" title="切记不要使用 ORDER BY RAND()"></a>切记不要使用 ORDER BY RAND()</h2><p>如果你真的想把返回的数据行打乱了，你有 N 种方法可以达到这个目的。这样使用只让你的数据库的性能呈指数级的下降。这里的问题是：MySQL 会不得不去执行 <code>RAND()</code> 函数（很耗 CPU 时间），而且这是为了每一行记录去记行，然后再对其排序。就算是你用了 <code>Limit 1</code> 也无济于事（因为要排序）。</p><h2 id="避免使用-SELECT"><a href="#避免使用-SELECT" class="headerlink" title="避免使用 SELECT *"></a>避免使用 SELECT *</h2><p>从数据库里读出越多的数据，那么查询就会变得越慢。并且，如果我们的数据库服务器和 web 服务器是两台独立的服务器的话，这还会增加网络传输的负载。所以，我们应该养成一个需要什么就取什么的好的习惯。</p><p><code>Hibernate</code> 性能方面就会差，它不用 <code>*</code>，但它将整个表的所有字段全查出来。</p><h2 id="永远为每张表设置一个-ID-主键"><a href="#永远为每张表设置一个-ID-主键" class="headerlink" title="永远为每张表设置一个 ID 主键"></a>永远为每张表设置一个 ID 主键</h2><p>我们应该为数据库里的每张表都设置一个 <code>ID</code> 做为其主键，而且最好的是一个 <code>INT</code> 型的（推荐使用 <code>UNSIGNED</code>），并设置上自动增加的 <code>AUTO_INCREMENT</code> 标志。就算是我们 <code>users</code> 表有一个主键叫 <code>email</code> 的字段，我们也别让它成为主键。使用 <code>VARCHAR</code> 类型来当主键会使用得性能下降。</p><p>另外，在我们的程序中，我们应该使用表的 <code>ID</code> 来构造我们的数据结构。而且，在 MySQL 数据引擎下，还有一些操作需要使用主键，在这些情况下，主键的性能和设置变得非常重要，比如，集群，分区 ...。在这里，只有一个情况是例外，那就是“关联表”的“外键”，也就是说，这个表的主键，通过若干个别的表的主键构成。我们把这个情况叫做“外键”。比如：有一个“学生表”有学生的 <code>ID</code>，有一个“课程表”有课程 <code>ID</code>，那么，“成绩表”就是“关联表”了，其关联了学生表和课程表，在成绩表中，学生 <code>ID</code> 和课程 <code>ID</code> 叫“外键”其共同组成主键。 </p><h2 id="可以使用-ENUM-则不用-VARCHAR"><a href="#可以使用-ENUM-则不用-VARCHAR" class="headerlink" title="可以使用 ENUM 则不用 VARCHAR"></a>可以使用 ENUM 则不用 VARCHAR</h2><p><code>ENUM</code> 类型是非常快和紧凑的。在实际上，其保存的是 <code>TINYINT</code>，但其外表上显示为字符串。这样一来，用这个字段来做一些选项列表变得相当的完美。如果我们有一个字段，比如“性别”，“国家”，“民族”，“状态”或“部门”，我们知道这些字段的取值是有限而且固定的，那么，我们应该使用 <code>ENUM</code> 而不是 <code>VARCHAR</code>。</p><h2 id="尽可能的不要赋值为-NULL"><a href="#尽可能的不要赋值为-NULL" class="headerlink" title="尽可能的不要赋值为 NULL"></a>尽可能的不要赋值为 NULL</h2><p>如果不是特殊情况，尽可能的不要使用 <code>NULL</code>。在 MySQL 中对于 INT 类型而言，<code>EMPTY</code> 是 <code>0</code>，而 <code>NULL</code> 是空值。而在 Oracle 中 <code>NULL</code> 和 <code>EMPTY</code> 的字符串是一样的。<code>NULL</code> 也需要占用存储空间，并且会使我们的程序判断时更加复杂。现实情况是很复杂的，依然会有些情况下，我们需要使用 <code>NULL</code> 值。</p><p>下面摘自MySQL 的文档：</p><blockquote><p>NULL columns require additional space in the row to record whether their values are NULL. For MyISAM tables, each NULL column takes one bit extra, rounded up to the nearest byte.</p></blockquote><h2 id="固定长度的表会更快"><a href="#固定长度的表会更快" class="headerlink" title="固定长度的表会更快"></a>固定长度的表会更快</h2><p>如果表中的所有字段都是“固定长度”的，整个表会被认为是 <code>static</code> 或 <code>fixed-length</code>。例如，表中没有如下类型的字段：<code>VARCHAR</code>，<code>TEXT</code>，<code>BLOB</code>。只要我们包括了其中一个这些字段，那么这个表就不是“固定长度静态表”了，这样，MySQL 引擎会用另一种方法来处理。</p><p>固定长度的表会提高性能，因为 MySQL 搜寻得会更快一些，因为这些固定的长度是很容易计算下一个数据的偏移量的，所以读取的自然也会很快。而如果字段不是定长的，那么，每一次要找下一条的话，需要程序找到主键。并且，固定长度的表也更容易被缓存和重建。不过，唯一的副作用是，固定长度的字段会浪费一些空间，因为定长的字段无论我们用不用，他都是要分配那么多的空间。另外在取出值的时候要使用 <code>trim</code> 去除空格。</p><h2 id="垂直分割"><a href="#垂直分割" class="headerlink" title="垂直分割"></a>垂直分割</h2><p>“垂直分割”是一种把数据库中的表按列变成几张表的方法，这样可以降低表的复杂度和字段的数目，从而达到优化的目的。</p><h2 id="拆分大的-DELETE-或-INSERT-语句"><a href="#拆分大的-DELETE-或-INSERT-语句" class="headerlink" title="拆分大的 DELETE 或 INSERT 语句"></a>拆分大的 DELETE 或 INSERT 语句</h2><p>如果我们需要在一个在线的网站上去执行一个大的 <code>DELETE</code> 或 <code>INSERT</code> 查询，我们需要非常小心，要避免我们的操作让我们的整个网站停止响应。因为这两个操作是会锁表的，表一锁住了，别的操作都进不来了。</p><p>Apache 会有很多的子进程或线程。所以，其工作起来相当有效率，而我们的服务器也不希望有太多的子进程，线程和数据库链接，这是极大的占服务器资源的事情，尤其是内存。如果我们把我们的表锁上一段时间，比如 30 秒钟，那么对于一个有很高访问量的站点来说，这 30 秒所积累的访问进程/线程，数据库链接，打开的文件数，可能不仅仅会让我们的 web 服务 Crash，还可能会让我们的整台服务器马上挂了。所以在使用时使用 <code>LIMIT</code> 控制数量操作记录的数量。</p><h2 id="越小的列会越快"><a href="#越小的列会越快" class="headerlink" title="越小的列会越快"></a>越小的列会越快</h2><p>对于大多数的数据库引擎来说，硬盘操作可能是最重大的瓶颈。所以，把我们的数据变得紧凑会对这种情况非常有帮助，因为这减少了对硬盘的访问。参看 MySQL 的文档 Storage Requirements 查看所有的数据类型。</p><p>如果一个表只会有几列（比如说字典表，配置表），那么，我们就没有理由使用 <code>INT</code> 来做主键，使用 <code>MEDIUMINT</code>, <code>SMALLINT</code> 或是更小的 <code>TINYINT</code> 会更经济一些。如果我们不需要记录时间，使用 <code>DATE</code> 要比 <code>DATETIME</code> 好得多。</p><h2 id="选择正确的存储引擎"><a href="#选择正确的存储引擎" class="headerlink" title="选择正确的存储引擎"></a>选择正确的存储引擎</h2><p>在 MySQL 中有两个存储引擎 <code>MyISAM</code> 和 <code>InnoDB</code>,每个引擎都有利有弊。</p><p><code>MyISAM</code> 适合于一些需要大量查询的应用，但是对于大量写操作的支持不是很好。甚至一个 <code>UPDATE</code> 语句就会进行锁表操作，这时读取这张表的所有进程都无法进行操作直至写操作完成。另外 <code>MyISAM</code> 对于 <code>SELECT COUNT(*)</code> 这类的计算是超快无比的。<code>InnoDB</code> 的趋势会是一个非常复杂的存储引擎，对于一些小的应用，它会比 <code>MyISAM</code> 还慢。它支持“行锁”，于是在写操作比较多的时候，会更优秀。并且，他还支持更多的高级应用，比如：事务。</p><p><code>MyISAM</code> 是 MySQL5.5 版本以前默认的存储引擎，基于传统的 <code>ISAM</code> 类型，支持 <code>B-Tree</code>，全文检索，但是不是事务安全的，而且不支持外键。不具有原子性。支持锁表。</p><p><code>InnoDB</code> 是事务型引擎，支持 <code>ACID</code> 事务（实现 4 种事务隔离机制）、回滚、崩溃恢复能力、行锁。以及提供与 Oracle 一致的不加锁的读取方式。<code>InnoDB</code> 存储表和索引在一个表空间中，表空间可以包含多个文件。</p><p><code>MyISAM</code> 和 <code>InnoDB</code> 比较，如下表格所示：</p><div class="table-container"><table><thead><tr><th style="text-align:center"></th><th style="text-align:center">MyISAM</th><th style="text-align:center">InnoDB</th></tr></thead><tbody><tr><td style="text-align:center">事务</td><td style="text-align:center">不支持</td><td style="text-align:center">支持</td></tr><tr><td style="text-align:center">数据行锁定</td><td style="text-align:center">不支持，只有表锁定</td><td style="text-align:center">支持</td></tr><tr><td style="text-align:center">外键约束</td><td style="text-align:center">不支持</td><td style="text-align:center">支持</td></tr><tr><td style="text-align:center">表空间大小</td><td style="text-align:center">相对小</td><td style="text-align:center">相对大</td></tr><tr><td style="text-align:center">全文索引</td><td style="text-align:center">支持</td><td style="text-align:center">不支持</td></tr><tr><td style="text-align:center">关注点</td><td style="text-align:center">性能（SELECT）</td><td style="text-align:center">事务</td></tr></tbody></table></div><p><strong>注意：</strong></p><ul><li>对于 Linux 版本的 MySQL 配置文件在 <code>/etc/my.cnf</code> 中</li><li>在 5.5 之后默认的存储引擎是 <code>INNODB</code></li><li>可以单独进行修改也可以在创建表时设置<p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> tab_name <span class="token keyword">ENGINE</span> <span class="token keyword">INNODB</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token keyword">IF</span> <span class="token operator">NOT</span> <span class="token keyword">EXISTS</span> tab_name<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></p></li></ul><h2 id="小心永久链接"><a href="#小心永久链接" class="headerlink" title="小心永久链接"></a>小心永久链接</h2><p>“永久链接”的目的是用来减少重新创建 MySQL 链接的次数。当一个链接被创建了，它会永远处在连接的状态，就算是数据库操作已经结束了。而且，自从我们的 Apache 开始重用它的子进程后——也就是说，下一次的 HTTP 请求会重用 Apache 的子进程，并重用相同的 MySQL 链接。 </p><p>而且，Apache 运行在极端并行的环境中，会创建很多很多的了进程。这就是为什么这种“永久链接”的机制工作不好的原因。在我们决定要使用“永久链接”之前，我们需要好好地考虑一下我们的整个系统的架构。</p>]]></content>
      
      
      <categories>
          
          <category> 教程笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 大数据 </tag>
            
            <tag> MySQL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MySQL 常用命令行</title>
      <link href="post/4bd4f98e.html"/>
      <url>post/4bd4f98e.html</url>
      
        <content type="html"><![CDATA[<h1 id="连接-MySQL"><a href="#连接-MySQL" class="headerlink" title="连接 MySQL"></a>连接 MySQL</h1><p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">mysql -h主机地址 -u用户名 -p用户密码<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><h2 id="连接到本机上的MySQL"><a href="#连接到本机上的MySQL" class="headerlink" title="连接到本机上的MySQL"></a>连接到本机上的MySQL</h2><p>首先打开 <code>DOS</code> 窗口，然后进入目录 <code>mysql\bin</code> ，再键入命令 <code>mysql -u root -p</code> 回车后提示你输密码。注意用户名前可以有空格也可以没有空格，但是密码前必须没有空格，否则让你重新输入密码。</p><p>如果刚安装好 MySQL，超级用户 <code>root</code> 是没有密码的。直接回车即可进入到 MySQL 中了，MySQL 的提示符是： <code>mysql&gt;</code></p><h2 id="连接到远程主机上的MySQL"><a href="#连接到远程主机上的MySQL" class="headerlink" title="连接到远程主机上的MySQL"></a>连接到远程主机上的MySQL</h2><p>假设远程主机的 IP 为：<code>110.110.110.110</code>，用户名为 <code>root</code>，密码为 <code>abcd123</code>。则键入以下命令：</p><p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">mysql -h 110.110.110.110 -u root -p abcd123;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><p><strong>注</strong>：<code>u</code> 与 <code>root</code> 之间可以不用加空格，其它也一样。</p><h2 id="退出MySQL命令。"><a href="#退出MySQL命令。" class="headerlink" title="退出MySQL命令。"></a>退出MySQL命令。</h2><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">exit</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><h1 id="修改密码"><a href="#修改密码" class="headerlink" title="修改密码"></a>修改密码</h1><p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">mysqladmin -u用户名 -p旧密码 password 新密码<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><ol><li><p>给 root 加个密码 ab12。</p><p> 首先在 <code>DOS</code> 下进入目录 <code>mysql\bin</code>。然后键入以下命令 <code>mysqladmin -u root -password ab12</code></p><p> <strong>注</strong>：因为开始时 <code>root</code> 没有密码，所以 <code>-p旧密码</code> 一项就可以省略了。</p></li></ol><ol><li><p>再将 root 的密码改为 def345。</p><p> <pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">mysqladmin -u root -p ab12 password def345<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p></li><li><p>增加新用户</p><p> <strong>注意</strong>：和上面不同，下面的因为是 MySQL 环境中的命令，所以后面都带一个分号作为命令结束符。</p><p> <pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">GRANT</span> <span class="token keyword">SELECT</span> <span class="token keyword">ON</span> 数据库<span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">TO</span> 用户名@登录主机 identified <span class="token keyword">BY</span> <span class="token string">"密码"</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><ol><li>增加一个用户 <code>test1</code> 密码为 <code>abc</code>，让他可以在任何主机上登录，并对所有数据库有查询、插入、修改、删除的权限。首先用 <code>root</code> 用户连入 MySQL，然后键入以下命令：</li></ol><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">GRANT</span> <span class="token keyword">SELECT</span><span class="token punctuation">,</span> <span class="token keyword">INSERT</span><span class="token punctuation">,</span> <span class="token keyword">UPDATE</span><span class="token punctuation">,</span> <span class="token keyword">DELETE</span> <span class="token keyword">ON</span> <span class="token operator">*</span><span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">TO</span> test1<span class="token variable">@"%"</span> Identified <span class="token keyword">BY</span> <span class="token string">"abc"</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><p>但增加的用户是十分危险的，你想如某个人知道 <code>test1</code> 的密码，那么他就可以在 internet 上的任何一台电脑上登录你的 MySQL 数据库并对你的数据可以为所欲为了，解决办法见 2。</p><ol><li>增加一个用户 <code>test2</code> 密码为 <code>abc</code>，让他只可以在 <code>localhost</code> 上登录，并可以对数据库 <code>mydb</code> 进行查询、插入、修改、删除的操作（localhost 指本地主机，即 MySQL 数据库所在的那台主机）。</li></ol><p>这样用户即使用知道 <code>test2</code> 的密码，他也无法从 internet 上直接访问数据库，只能通过MySQL 主机上的 web 页来访问了。</p><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">GRANT</span> <span class="token keyword">SELECT</span><span class="token punctuation">,</span> <span class="token keyword">INSERT</span><span class="token punctuation">,</span> <span class="token keyword">UPDATE</span><span class="token punctuation">,</span> <span class="token keyword">DELETE</span> <span class="token keyword">ON</span> mydb<span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">TO</span> test2<span class="token variable">@localhost</span> test2<span class="token variable">@localhost</span> identified <span class="token keyword">BY</span> <span class="token string">"abc"</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><p>如果你不想 <code>test2</code> 有密码，可以再打一个命令将密码消掉。</p><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">GRANT</span> <span class="token keyword">SELECT</span><span class="token punctuation">,</span> <span class="token keyword">INSERT</span><span class="token punctuation">,</span> <span class="token keyword">UPDATE</span><span class="token punctuation">,</span> <span class="token keyword">DELETE</span> <span class="token keyword">ON</span> mydb<span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">TO</span> test2<span class="token variable">@localhost</span> test2<span class="token variable">@localhost</span> identified <span class="token keyword">BY</span> <span class="token string">""</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><h1 id="数据库"><a href="#数据库" class="headerlink" title="数据库"></a>数据库</h1></li></ol><h2 id="创建数据库"><a href="#创建数据库" class="headerlink" title="创建数据库"></a>创建数据库</h2><ol><li><p>建立一个数据库</p><p> <pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">DATABASE</span> <span class="token operator">&lt;</span>数据库名<span class="token operator">></span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p></li><li><p>创建数据库并分配用户</p><p> <pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">DATABASE</span> <span class="token operator">&lt;</span>数据库名<span class="token operator">></span><span class="token punctuation">;</span><span class="token keyword">GRANT</span> <span class="token keyword">SELECT</span><span class="token punctuation">,</span> <span class="token keyword">INSERT</span><span class="token punctuation">,</span> <span class="token keyword">UPDATE</span><span class="token punctuation">,</span> <span class="token keyword">DELETE</span><span class="token punctuation">,</span> <span class="token keyword">CREATE</span><span class="token punctuation">,</span> <span class="token keyword">DROP</span><span class="token punctuation">,</span> <span class="token keyword">ALTER</span> <span class="token keyword">ON</span> 数据库名<span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">TO</span> 数据库名@登录主机 IDENTIFIED <span class="token keyword">BY</span> <span class="token string">'密码'</span><span class="token punctuation">;</span><span class="token keyword">SET</span> PASSWORD <span class="token keyword">FOR</span> <span class="token string">'数据库名'</span><span class="token variable">@'登录主机'</span> <span class="token operator">=</span> <span class="token string">'密码'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p> 依次执行 3 个命令完成数据库创建。</p><p> <strong>注意</strong>：“密码”和“数据库”是用户自己需要设置的。</p></li></ol><h2 id="显示数据库"><a href="#显示数据库" class="headerlink" title="显示数据库"></a>显示数据库</h2><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SHOW</span> <span class="token keyword">DATABASES</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><p><strong>注意</strong>：为了不再显示的时候乱码，要修改数据库默认编码。以下以 <code>GBK</code> 编码页面为例进行说明：</p><ol><li><p>修改 MySQL 的配置文件。</p><p> <code>my.ini</code> 文件里面修改 <code>default-character-set=gbk</code>。</p></li><li><p>代码运行时修改。</p></li></ol><ul><li><p>Java代码：</p><p>  <pre class="line-numbers language-java" data-language="java"><code class="language-java">jdbc<span class="token operator">:</span>mysql<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>localhost<span class="token operator">:</span><span class="token number">3306</span><span class="token operator">/</span>test<span class="token operator">?</span>useUnicode<span class="token operator">=</span><span class="token boolean">true</span><span class="token operator">&amp;</span>characterEncoding<span class="token operator">=</span>gbk<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p></li><li><p>PHP代码：</p><p>  <pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token function">header</span><span class="token punctuation">(</span><span class="token double-quoted-string string">"Content-Type:text/html;charset=gb2312"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p></li><li><p>C语言代码：</p><p>  <pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span> <span class="token function">mysql_set_character_set</span><span class="token punctuation">(</span> MySQL <span class="token operator">*</span> mysql<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span> csname<span class="token punctuation">)</span>；<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><p>  该函数用于为当前连接设置默认的字符集。字符串 <code>csname</code> 指定了 1 个有效的字符集名称。连接校对成为字符集的默认校对。该函数的工作方式与 <code>SET NAMES</code> 语句类似，但它还能设置 <code>charset</code> 的值，从而影响了由 <code>mysql_real_escape_string()</code> 设置的字符集。</p></li></ul><h2 id="删除数据库"><a href="#删除数据库" class="headerlink" title="删除数据库"></a>删除数据库</h2><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">DROP</span> <span class="token keyword">DATABASE</span> <span class="token operator">&lt;</span>数据库名<span class="token operator">></span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><ol><li><p>删除一个已经确定存在的数据库</p><p> <pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">mysql<span class="token operator">></span> <span class="token keyword">DROP</span> <span class="token keyword">DATABASE</span> drop_database<span class="token punctuation">;</span>  Query OK<span class="token punctuation">,</span> <span class="token number">0</span> <span class="token keyword">rows</span> affected <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></p></li><li><p>删除一个不确定存在的数据库</p><p> <pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">mysql<span class="token operator">></span> <span class="token keyword">DROP</span> <span class="token keyword">DATABASE</span> drop_database<span class="token punctuation">;</span>ERROR <span class="token number">1008</span> <span class="token punctuation">(</span>HY000<span class="token punctuation">)</span>: Can<span class="token string">'t drop database '</span>drop_database<span class="token string">'; database doesn'</span>t exist<span class="token comment">//发生错误，不能删除'drop_database'数据库，该数据库不存在。</span>mysql<span class="token operator">></span> <span class="token keyword">DROP</span> <span class="token keyword">DATABASE</span> <span class="token keyword">IF</span> <span class="token keyword">EXISTS</span> drop_database<span class="token punctuation">;</span>Query OK<span class="token punctuation">,</span> <span class="token number">0</span> <span class="token keyword">rows</span> affected<span class="token punctuation">,</span> <span class="token number">1</span> warning <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span><span class="token comment">//产生一个警告说明此数据库不存在</span>mysql<span class="token operator">></span> <span class="token keyword">CREATE</span> <span class="token keyword">DATABASE</span> drop_database<span class="token punctuation">;</span>Query OK<span class="token punctuation">,</span> <span class="token number">1</span> <span class="token keyword">row</span> affected <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>mysql<span class="token operator">></span> <span class="token keyword">DROP</span> <span class="token keyword">DATABASE</span> <span class="token keyword">IF</span> <span class="token keyword">EXISTS</span> drop_database<span class="token punctuation">;</span>Query OK<span class="token punctuation">,</span> <span class="token number">0</span> <span class="token keyword">rows</span> affected <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span><span class="token comment">//IF EXISTS 判断数据库是否存在，不存在也不产生错误</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h2 id="连接数据库"><a href="#连接数据库" class="headerlink" title="连接数据库"></a>连接数据库</h2></li></ol><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">mysql<span class="token operator">></span> <span class="token keyword">USE</span> <span class="token operator">&lt;</span>数据库名<span class="token operator">></span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><p>屏幕提示：<code>Database changed</code></p><p><code>USE</code> 语句可以通告 MySQL 把 <code>db_name</code> 数据库作为默认（当前）数据库使用，用于后续语句。</p><p>该数据库保持为默认数据库，直到语段的结尾，或者直到发布一个不同的 USE 语句：</p><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">mysql<span class="token operator">></span> <span class="token keyword">USE</span> db1<span class="token punctuation">;</span>mysql<span class="token operator">></span> <span class="token keyword">SELECT</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">FROM</span> mytable<span class="token punctuation">;</span>   <span class="token comment"># SELECT COUNT(*) FROM db1.mytable</span>mysql<span class="token operator">></span> <span class="token keyword">USE</span> db2<span class="token punctuation">;</span>mysql<span class="token operator">></span> <span class="token keyword">SELECT</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">FROM</span> mytable<span class="token punctuation">;</span>   <span class="token comment"># SELECT COUNT(*) FROM db2.mytable</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></p><p>使用 <code>USE</code> 语句为一个特定的当前的数据库做标记，不会阻碍您访问其它数据库中的表。</p><p>下面的例子可以从 <code>db1</code> 数据库访问作者表，并从 <code>db2</code> 数据库访问编辑表：</p><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">mysql<span class="token operator">></span> <span class="token keyword">USE</span> db1<span class="token punctuation">;</span>mysql<span class="token operator">></span> <span class="token keyword">SELECT</span> author_name<span class="token punctuation">,</span> editor_name <span class="token keyword">FROM</span> author<span class="token punctuation">,</span> db2<span class="token punctuation">.</span>editor <span class="token keyword">WHERE</span> author<span class="token punctuation">.</span>editor_id <span class="token operator">=</span> db2<span class="token punctuation">.</span>editor<span class="token punctuation">.</span>editor_id<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></p><h2 id="当前选择的数据库"><a href="#当前选择的数据库" class="headerlink" title="当前选择的数据库"></a>当前选择的数据库</h2><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">mysql<span class="token operator">></span> <span class="token keyword">SELECT</span> <span class="token keyword">DATABASE</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token operator">+</span><span class="token comment">------------+</span><span class="token operator">|</span> <span class="token keyword">DATABASE</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">------------+</span><span class="token operator">|</span> db1        <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">------------+</span><span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p>MySQL 中 <code>SELECT</code> 命令类似于其他编程语言里的 <code>print</code> 或者 <code>write</code>，你可以用它来显示一个字符串、数字、数学表达式的结果等等。</p><ol><li><p>显示MySQL的版本</p><p> <pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">mysql<span class="token operator">></span> <span class="token keyword">SELECT</span> VERSION<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token operator">+</span><span class="token comment">------------+</span><span class="token operator">|</span> VERSION<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">------------+</span><span class="token operator">|</span> <span class="token number">5.6</span><span class="token number">.45</span><span class="token operator">-</span>log <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">------------+</span><span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.01</span> sec<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p></li><li><p>显示当前时间</p><p> <pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">mysql<span class="token operator">></span> <span class="token keyword">SELECT</span> <span class="token function">NOW</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token operator">+</span><span class="token comment">---------------------+</span><span class="token operator">|</span> <span class="token function">NOW</span><span class="token punctuation">(</span><span class="token punctuation">)</span>               <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">---------------------+</span><span class="token operator">+</span><span class="token comment">---------------------+</span><span class="token operator">|</span> <span class="token number">2021</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">13</span> <span class="token number">20</span>:<span class="token number">05</span>:<span class="token number">07</span> <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">---------------------+</span><span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p></li><li><p>显示年月日</p><p> <pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">mysql<span class="token operator">></span> <span class="token keyword">SELECT</span> DAYOFMONTH<span class="token punctuation">(</span><span class="token keyword">CURRENT_DATE</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token operator">+</span><span class="token comment">--------------------------+</span><span class="token operator">|</span> DAYOFMONTH<span class="token punctuation">(</span><span class="token keyword">CURRENT_DATE</span><span class="token punctuation">)</span> <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">--------------------------+</span><span class="token operator">|</span>                       <span class="token number">13</span> <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">--------------------------+</span><span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>mysql<span class="token operator">></span> <span class="token keyword">SELECT</span> <span class="token keyword">MONTH</span><span class="token punctuation">(</span><span class="token keyword">CURRENT_DATE</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token operator">+</span><span class="token comment">---------------------+</span><span class="token operator">|</span> <span class="token keyword">MONTH</span><span class="token punctuation">(</span><span class="token keyword">CURRENT_DATE</span><span class="token punctuation">)</span> <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">---------------------+</span><span class="token operator">|</span>                   <span class="token number">1</span> <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">---------------------+</span><span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>mysql<span class="token operator">></span> <span class="token keyword">SELECT</span> <span class="token keyword">YEAR</span><span class="token punctuation">(</span><span class="token keyword">CURRENT_DATE</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token operator">+</span><span class="token comment">--------------------+</span><span class="token operator">|</span> <span class="token keyword">YEAR</span><span class="token punctuation">(</span><span class="token keyword">CURRENT_DATE</span><span class="token punctuation">)</span> <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">--------------------+</span><span class="token operator">|</span>               <span class="token number">2021</span> <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">--------------------+</span><span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.01</span> sec<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p></li><li><p>显示字符串</p><p> <pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">mysql<span class="token operator">></span> <span class="token keyword">SELECT</span> <span class="token string">"welcome to my blog!"</span><span class="token punctuation">;</span> <span class="token operator">+</span><span class="token comment">---------------------+</span><span class="token operator">|</span> welcome <span class="token keyword">to</span> my blog<span class="token operator">!</span> <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">---------------------+</span><span class="token operator">|</span> welcome <span class="token keyword">to</span> my blog<span class="token operator">!</span> <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">---------------------+</span><span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p></li><li><p>当计算器用</p><p> <pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">4</span> <span class="token operator">*</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">10</span> <span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">25</span><span class="token punctuation">;</span> <span class="token operator">+</span><span class="token comment">----------------------+</span><span class="token operator">|</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">4</span> <span class="token operator">*</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">10</span> <span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">25</span> <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">----------------------+</span><span class="token operator">|</span>              <span class="token number">26.6000</span> <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">----------------------+</span><span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p></li><li><p>串接字符串</p><p> <pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> CONCAT<span class="token punctuation">(</span>f_name<span class="token punctuation">,</span> <span class="token string">" "</span><span class="token punctuation">,</span> l_name<span class="token punctuation">)</span> <span class="token keyword">AS</span> Name <span class="token keyword">FROM</span> employee_data <span class="token keyword">WHERE</span> title <span class="token operator">=</span> <span class="token string">'Marketing Executive'</span><span class="token punctuation">;</span> <span class="token operator">+</span><span class="token comment">---------------+</span><span class="token operator">|</span> Name          <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">---------------+</span><span class="token operator">|</span> Monica Sehgal <span class="token operator">|</span><span class="token operator">|</span> Hal Simlai    <span class="token operator">|</span><span class="token operator">|</span> Joseph Irvine <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">---------------+</span><span class="token number">3</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p> <strong>注意</strong>：这里用到 <code>CONCAT()</code> 函数，用来把字符串连接起来。另外，我们还用到 <code>AS</code> 给结果列 <code>CONCAT(f_name, &quot; &quot;, l_name)</code> 起了个假名。</p></li></ol><h1 id="数据表"><a href="#数据表" class="headerlink" title="数据表"></a>数据表</h1><h2 id="创建数据表"><a href="#创建数据表" class="headerlink" title="创建数据表"></a>创建数据表</h2><p><pre class="line-numbers language-SQL" data-language="SQL"><code class="language-SQL">CREATE TABLE &lt;表名&gt; (&lt;字段名1&gt; &lt;类型1&gt; , ... , &lt;字段名n&gt; &lt;类型n&gt;);<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><p>以下为数据表的字段：</p><div class="table-container"><table><thead><tr><th style="text-align:center">字段名</th><th style="text-align:center">数字类型</th><th style="text-align:center">数据宽度</th><th style="text-align:center">是否为空</th><th style="text-align:center">是否主键</th><th style="text-align:center">自动增加</th><th style="text-align:center">默认值</th></tr></thead><tbody><tr><td style="text-align:center">id</td><td style="text-align:center">int</td><td style="text-align:center">4</td><td style="text-align:center">否</td><td style="text-align:center">PRIMARY KEY</td><td style="text-align:center">AUTO_INCREMENT</td><td style="text-align:center"></td></tr><tr><td style="text-align:center">name</td><td style="text-align:center">char</td><td style="text-align:center">20</td><td style="text-align:center">否</td><td style="text-align:center"></td><td style="text-align:center"></td><td style="text-align:center"></td></tr><tr><td style="text-align:center">sex</td><td style="text-align:center">int</td><td style="text-align:center">4</td><td style="text-align:center">否</td><td style="text-align:center"></td><td style="text-align:center"></td><td style="text-align:center">0</td></tr><tr><td style="text-align:center">degree</td><td style="text-align:center">double</td><td style="text-align:center">16</td><td style="text-align:center">是</td><td style="text-align:center"></td><td style="text-align:center"></td></tr></tbody></table></div><p>执行的 SQL 语句为：</p><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">mysql<span class="token operator">></span> <span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> MyClass<span class="token punctuation">(</span>     <span class="token operator">></span> id <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token punctuation">,</span>     <span class="token operator">></span> name <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>     <span class="token operator">></span> sex <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token string">'0'</span><span class="token punctuation">,</span>     <span class="token operator">></span> degree <span class="token keyword">double</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h2 id="删除数据表"><a href="#删除数据表" class="headerlink" title="删除数据表"></a>删除数据表</h2><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">DROP</span> <span class="token keyword">TABLE</span> <span class="token operator">&lt;</span>表名<span class="token operator">></span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><p>例如：删除表名为 MyClass 的表</p><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">DROP</span> <span class="token keyword">TABLE</span> MyClass<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><p><strong>注意</strong>：</p><ul><li><code>DROP TABLE</code> 用于取消一个或多个表。但必须有表的 <code>DROP</code> 权限。所有的表数据和表定义会被取消，所以使用本语句要小心。</li><li>对于一个带分区的表，<code>DROP TABLE</code> 会永久性地取消表定义，取消各分区，并取消储存在这些分区中的所有数据。<code>DROP TABLE</code> 还会取消与被取消的表有关联的分区定义（<code>.par</code>）文件。</li><li>对于不存在的表，使用 <code>IF EXISTS</code> 用于防止错误发生。当使用 <code>IF EXISTS</code> 时，对于每个不存在的表，会生成一个 <code>NOTE</code>。</li><li><code>RESTRICT</code> 和 <code>CASCADE</code> 可以使分区更容易。但目前，<code>RESTRICT</code> 和 <code>CASCADE</code> 不起作用。</li></ul><h2 id="插入数据"><a href="#插入数据" class="headerlink" title="插入数据"></a>插入数据</h2><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token operator">&lt;</span>表名<span class="token operator">></span> <span class="token punctuation">(</span><span class="token operator">&lt;</span>字段名<span class="token number">1</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span>字段名n <span class="token operator">></span><span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span>值<span class="token number">1</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">,</span>  值n <span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><p>例如：往表 <code>MyClass</code> 中插入二条记录, 这二条记录表示：编号为 <code>1</code> 的名为 <code>Tom</code> 的成绩为 <code>96.45</code>, 编号为 <code>2</code> 的名为 <code>Joan</code> 的成绩为 <code>82.99</code>，编号为 <code>3</code> 的名为 <code>Wang</code> 的成绩为 <code>96.5</code>。</p><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">mysql<span class="token operator">></span> <span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> MyClass<span class="token punctuation">(</span>id<span class="token punctuation">,</span> name<span class="token punctuation">,</span> degree<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'Tom'</span><span class="token punctuation">,</span> <span class="token number">96.45</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'Joan'</span><span class="token punctuation">,</span> <span class="token number">82.99</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">'Wang'</span><span class="token punctuation">,</span> <span class="token number">96.59</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><h2 id="查询表中的数据"><a href="#查询表中的数据" class="headerlink" title="查询表中的数据"></a>查询表中的数据</h2><ol><li><p>查询所有行命令：</p><p> <pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token operator">&lt;</span>字段<span class="token number">1</span><span class="token punctuation">,</span> 字段<span class="token number">2</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">></span> <span class="token keyword">FROM</span> <span class="token operator">&lt;</span>表名<span class="token operator">></span> <span class="token keyword">WHERE</span> <span class="token operator">&lt;</span>表达式<span class="token operator">></span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><p> <code>SELECT</code> 一般配合 <code>WHERE</code> 使用，以查询更精确更复杂的数据。</p><p> 例如：查看表 <code>MyClass</code> 中 <code>degree</code> 大于 <code>90</code> 的数据。</p><p> <pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">mysql<span class="token operator">></span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> MyClass <span class="token keyword">WHERE</span> degree <span class="token operator">></span> <span class="token number">90</span><span class="token punctuation">;</span><span class="token operator">+</span><span class="token comment">----+------+-----+--------+</span><span class="token operator">|</span> id <span class="token operator">|</span> name <span class="token operator">|</span> sex <span class="token operator">|</span> degree <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">----+------+-----+--------+</span><span class="token operator">|</span>  <span class="token number">1</span> <span class="token operator">|</span> Tom  <span class="token operator">|</span>   <span class="token number">0</span> <span class="token operator">|</span>  <span class="token number">96.45</span> <span class="token operator">|</span><span class="token operator">|</span>  <span class="token number">3</span> <span class="token operator">|</span> Wang <span class="token operator">|</span>   <span class="token number">0</span> <span class="token operator">|</span>  <span class="token number">96.59</span> <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">----+------+-----+--------+</span><span class="token number">3</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p></li><li><p>查询前几行数据 </p><p> 例如：查看表 <code>MyClass</code> 中前 <code>2</code> 行数据</p><p> <pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">mysql<span class="token operator">></span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> MyClass <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> id <span class="token keyword">LIMIT</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">;</span><span class="token operator">+</span><span class="token comment">----+------+-----+--------+</span><span class="token operator">|</span> id <span class="token operator">|</span> name <span class="token operator">|</span> sex <span class="token operator">|</span> degree <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">----+------+-----+--------+</span><span class="token operator">|</span>  <span class="token number">1</span> <span class="token operator">|</span> Tom  <span class="token operator">|</span>   <span class="token number">0</span> <span class="token operator">|</span>  <span class="token number">96.45</span> <span class="token operator">|</span><span class="token operator">|</span>  <span class="token number">2</span> <span class="token operator">|</span> Joan <span class="token operator">|</span>   <span class="token number">0</span> <span class="token operator">|</span>  <span class="token number">82.99</span> <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">----+------+-----+--------+</span><span class="token number">2</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h2 id="删除表中数据"><a href="#删除表中数据" class="headerlink" title="删除表中数据"></a>删除表中数据</h2></li></ol><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">DELETE</span> <span class="token keyword">FROM</span> <span class="token operator">&lt;</span>表名<span class="token operator">></span> <span class="token keyword">WHERE</span> <span class="token operator">&lt;</span>表达式<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><p>例如：删除表 <code>MyClass</code> 中编号为 <code>1</code> 的记录</p><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">mysql<span class="token operator">></span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> MyClass<span class="token punctuation">;</span><span class="token operator">+</span><span class="token comment">----+------+-----+--------+</span><span class="token operator">|</span> id <span class="token operator">|</span> name <span class="token operator">|</span> sex <span class="token operator">|</span> degree <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">----+------+-----+--------+</span><span class="token operator">|</span>  <span class="token number">1</span> <span class="token operator">|</span> Tom  <span class="token operator">|</span>   <span class="token number">0</span> <span class="token operator">|</span>  <span class="token number">96.45</span> <span class="token operator">|</span><span class="token operator">|</span>  <span class="token number">2</span> <span class="token operator">|</span> Joan <span class="token operator">|</span>   <span class="token number">0</span> <span class="token operator">|</span>  <span class="token number">82.99</span> <span class="token operator">|</span><span class="token operator">|</span>  <span class="token number">3</span> <span class="token operator">|</span> Wang <span class="token operator">|</span>   <span class="token number">0</span> <span class="token operator">|</span>  <span class="token number">96.59</span> <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">----+------+-----+--------+</span><span class="token number">3</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>mysql<span class="token operator">></span> <span class="token keyword">DELETE</span> <span class="token keyword">FROM</span> MyClass <span class="token keyword">WHERE</span> id <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>Query OK<span class="token punctuation">,</span> <span class="token number">1</span> <span class="token keyword">row</span> affected <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>mysql<span class="token operator">></span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> MyClass<span class="token punctuation">;</span><span class="token operator">+</span><span class="token comment">----+------+-----+--------+</span><span class="token operator">|</span> id <span class="token operator">|</span> name <span class="token operator">|</span> sex <span class="token operator">|</span> degree <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">----+------+-----+--------+</span><span class="token operator">|</span>  <span class="token number">2</span> <span class="token operator">|</span> Joan <span class="token operator">|</span>   <span class="token number">0</span> <span class="token operator">|</span>  <span class="token number">82.99</span> <span class="token operator">|</span><span class="token operator">|</span>  <span class="token number">3</span> <span class="token operator">|</span> Wang <span class="token operator">|</span>   <span class="token number">0</span> <span class="token operator">|</span>  <span class="token number">96.59</span> <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">----+------+-----+--------+</span><span class="token number">2</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h2 id="修改表中数据"><a href="#修改表中数据" class="headerlink" title="修改表中数据"></a>修改表中数据</h2><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">UPDATE</span> <span class="token operator">&lt;</span>表名<span class="token operator">></span> <span class="token keyword">SET</span> <span class="token operator">&lt;</span>字段<span class="token operator">></span> <span class="token operator">=</span> <span class="token operator">&lt;</span>新值<span class="token operator">></span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token keyword">WHERE</span> <span class="token operator">&lt;</span>表达式<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><p>例如：修改表 <code>MyClass</code> 中 <code>id</code> 为 <code>2</code> 的 <code>name</code> 为 <code>Mary</code>。</p><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">mysql<span class="token operator">></span> <span class="token keyword">UPDATE</span> MyClass <span class="token keyword">SET</span> name <span class="token operator">=</span> <span class="token string">'Mary'</span> <span class="token keyword">WHERE</span> id <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><ol><li><p>单表的 UPDATE 语句：</p><p> <pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">UPDATE</span> <span class="token punctuation">[</span>LOW_PRIORITY<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token keyword">IGNORE</span><span class="token punctuation">]</span> tbl_name <span class="token keyword">SET</span> col_name1<span class="token operator">=</span>expr1 <span class="token punctuation">[</span><span class="token punctuation">,</span> col_name2<span class="token operator">=</span>expr2 <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token keyword">WHERE</span> where_definition<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token keyword">ORDER</span> <span class="token keyword">BY</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token keyword">LIMIT</span> row_count<span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></p></li><li><p>多表的 UPDATE 语句：</p><p> <pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">UPDATE</span> <span class="token punctuation">[</span>LOW_PRIORITY<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token keyword">IGNORE</span><span class="token punctuation">]</span> table_references <span class="token keyword">SET</span> col_name1<span class="token operator">=</span>expr1 <span class="token punctuation">[</span><span class="token punctuation">,</span> col_name2<span class="token operator">=</span>expr2 <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token keyword">WHERE</span> where_definition<span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></p><p><strong>注意</strong>：<code>UPDATE</code> 语法可以用新值更新原有表行中的各列。SET 子句指示要修改哪些列和要给予哪些值。<code>WHERE</code> 子句指定应更新哪些行。如果没有 <code>WHERE</code> 子句，则更新所有的行。如果指定了 <code>ORDER BY</code> 子句，则按照被指定的顺序对行进行更新。<code>LIMIT</code> 子句用于给定一个限值，限制可以被更新的行的数目。</p></li></ol><h2 id="修改数据表"><a href="#修改数据表" class="headerlink" title="修改数据表"></a>修改数据表</h2><ol><li><p>增加字段</p><p> <pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> <span class="token operator">&lt;</span>表名<span class="token operator">></span> <span class="token keyword">ADD</span> <span class="token operator">&lt;</span>字段<span class="token operator">></span> <span class="token operator">&lt;</span>类型<span class="token operator">></span> <span class="token operator">&lt;</span>其他<span class="token operator">></span><span class="token punctuation">;</span> <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><p> <pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">mysql<span class="token operator">></span> <span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> MyClass <span class="token keyword">ADD</span> passtest <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token string">'0'</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p></li><li><p>增加索引</p><p> <pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> <span class="token operator">&lt;</span>表名<span class="token operator">></span> <span class="token keyword">ADD</span> <span class="token keyword">INDEX</span> <span class="token operator">&lt;</span>索引名<span class="token operator">></span><span class="token punctuation">(</span><span class="token operator">&lt;</span>字段名<span class="token number">1</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token operator">&lt;</span>字段名<span class="token number">2</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><p> <pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">mysql<span class="token operator">></span> <span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> employee <span class="token keyword">ADD</span> <span class="token keyword">INDEX</span> emp_name<span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p></li><li><p>增加主关键字的索引</p><p> <pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> <span class="token operator">&lt;</span>表名<span class="token operator">></span> <span class="token keyword">ADD</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token operator">&lt;</span>字段名<span class="token operator">></span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><p> <pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">mysql<span class="token operator">></span> <span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> employee <span class="token keyword">ADD</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p></li><li><p>增加唯一索引</p><p> <pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> <span class="token operator">&lt;</span>表名<span class="token operator">></span> <span class="token keyword">ADD</span> <span class="token keyword">UNIQUE</span> <span class="token operator">&lt;</span>索引名<span class="token operator">></span><span class="token punctuation">(</span><span class="token operator">&lt;</span>字段名<span class="token operator">></span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><p> <pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">mysql<span class="token operator">></span> <span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> employee <span class="token keyword">ADD</span> <span class="token keyword">UNIQUE</span> emp_name2<span class="token punctuation">(</span>cardnumber<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p></li><li><p>增加全文索引</p><p> <pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> <span class="token operator">&lt;</span>表名<span class="token operator">></span> <span class="token keyword">ADD</span> FULLTEXT <span class="token operator">&lt;</span>索引名<span class="token operator">></span><span class="token punctuation">(</span><span class="token operator">&lt;</span>字段名<span class="token operator">></span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><p> <pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">mysql<span class="token operator">></span> <span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> employee <span class="token keyword">ADD</span> FULLTEXT emp_name3<span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><p> <strong>注意</strong>：全文索引只能用于数据库引擎为 <code>MyISAM</code> 的数据表，只适用于 <code>VARCHAR</code> 和 <code>TEXT</code> 类型的字段，此外，MySQL 自带的全文索引只能对英文进行全文检索，目前无法对中文进行全文检索。</p></li><li><p>删除某个索引</p><p> <pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> <span class="token operator">&lt;</span>表名<span class="token operator">></span> <span class="token keyword">DROP</span> <span class="token keyword">INDEX</span> <span class="token operator">&lt;</span>索引名<span class="token operator">></span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><p> <pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">mysql<span class="token operator">></span><span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> employee <span class="token keyword">DROP</span> <span class="token keyword">INDEX</span> emp_name<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p></li><li><p>修改原字段名称及类型</p><p> <pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> <span class="token operator">&lt;</span>表名<span class="token operator">></span> CHANGE <span class="token operator">&lt;</span>旧字段名<span class="token operator">></span> <span class="token operator">&lt;</span>新字段名<span class="token operator">></span> <span class="token operator">&lt;</span>新字段类型<span class="token operator">></span> <span class="token operator">&lt;</span>其他<span class="token operator">></span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><p> <pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> employee CHANGE name full_name <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p></li><li><p>删除字段</p><p> <pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> <span class="token operator">&lt;</span>表名<span class="token operator">></span> <span class="token keyword">DROP</span> <span class="token operator">&lt;</span>字段名<span class="token operator">></span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><p> <pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> employee <span class="token keyword">DROP</span> address<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p></li><li><p>修改表名</p><p> <pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">RENAME</span> <span class="token keyword">TABLE</span> <span class="token operator">&lt;</span>原表名<span class="token operator">></span> <span class="token keyword">TO</span> <span class="token operator">&lt;</span>新表名<span class="token operator">></span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><p> <pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">mysql<span class="token operator">></span> <span class="token keyword">RENAME</span> <span class="token keyword">TABLE</span> MyClass <span class="token keyword">TO</span> YouClass<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><p> <strong>注意</strong>：</p><ul><li>当你执行 <code>RENAME</code> 时，你不能有任何锁定的表或活动的事务。你同样也必须有对原初表的 <code>ALTER</code> 和 <code>DROP</code> 权限，以及对新表的 <code>CREATE</code> 和 <code>INSERT</code> 权限。</li><li>如果在多表更名中，MySQL 遭遇到任何错误，它将对所有被更名的表进行倒退更名，将每件事务退回到最初状态。</li><li><code>RENAME TABLE</code> 在 MySQL 3.23.23 中被加入。</li></ul></li></ol><h1 id="备份数据库"><a href="#备份数据库" class="headerlink" title="备份数据库"></a>备份数据库</h1><p>命令在 <code>DOS</code> 的 <code>\mysql\bin</code> 目录下执行，导出文件默认是存在 <code>mysql\bin</code> 目录下。</p><h2 id="导出整个数据库"><a href="#导出整个数据库" class="headerlink" title="导出整个数据库"></a>导出整个数据库</h2><p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">mysqldump -u 用户名 -p&#39;密码&#39; 数据库名 &gt; 导出的文件名.sqlmysqldump -u 用户名 -p 数据库名 &gt; 导出的文件名.sqlEnter password: ******mysqldump -u root -p database_name &gt; outfile.sqlEnter password: ******<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h2 id="导出所有数据库"><a href="#导出所有数据库" class="headerlink" title="导出所有数据库"></a>导出所有数据库</h2><p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">mysqldump  -uroot -p --all-databases &gt; outfile.sqlmysqldump  -uroot -p -A &gt; outfile.sql<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></p><h2 id="导出一个数据库结构"><a href="#导出一个数据库结构" class="headerlink" title="导出一个数据库结构"></a>导出一个数据库结构</h2><p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">mysqldump -u root -p -d –add-drop-table database_name &gt; outfile.sql<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><p><code>-d</code> 没有数据, <code>–add-drop-table</code>在每个 <code>CREATE</code> 语句之前增加一个 <code>DROP TABLE</code></p><h2 id="带语言参数导出"><a href="#带语言参数导出" class="headerlink" title="带语言参数导出"></a>带语言参数导出</h2><p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">mysqldump -uroot -p –default-character-set&#x3D;latin1 –set-charset&#x3D;gbk –skip-opt database_name &gt; outfile.sql<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><h2 id="导出数据表"><a href="#导出数据表" class="headerlink" title="导出数据表"></a>导出数据表</h2><ol><li><p>导出数据表和表结构</p><p> <pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">mysqldump -u root -h 登录主机 -p&#39;密码&#39; -P端口号 数据库名 表名 &gt; 文件名.sql<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><p> 将特定数据库特定表中的数据和表格结构和数据全部返回。</p><p> <pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">mysqldump -u root -h localhost -p -P3306 database_name table &gt; table.sql<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p></li><li><p>导出表结构却不导出表数据</p><p> 只返回特定数据库特定表格的表格结构，不返回数据，添加 <code>-d</code> 命令参数。</p><p> <pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">mysqldump -u root -h localhost -p -P3306 -d database_name table &gt; table.sql<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p></li><li><p>导出表结构和满足 <code>WHERE</code> 条件的表数据</p><p> 只返回特定数据库中特定表的表格结构和满足特定条件的数据。</p><p> <pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">mysqldump -u root -h localhost -p -P3306 database_name table -where&#x3D;&quot;time&gt;&#39;2017-01-01&#39;&quot; &gt; table.sql<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p></li><li><p>导出数据却不导出表结构</p><p> 只返回特定数据库中特定表格的数据，不返回表格结构，添加 <code>-t</code> 命令参数。</p><p> <pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">mysqldump -u root -h localhost -p -t -P3306 database_name table &gt; table.sql<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><h2 id="导入-SQL-文件"><a href="#导入-SQL-文件" class="headerlink" title="导入 SQL 文件"></a>导入 SQL 文件</h2></li></ol><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">source <span class="token keyword">database</span><span class="token punctuation">.</span><span class="token keyword">sql</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p>]]></content>
      
      
      <categories>
          
          <category> 教程笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 大数据 </tag>
            
            <tag> MySQL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MySQL 教程</title>
      <link href="post/7f59cefa.html"/>
      <url>post/7f59cefa.html</url>
      
        <content type="html"><![CDATA[<h1 id="术语"><a href="#术语" class="headerlink" title="术语"></a>术语</h1><ul><li>数据库: 数据库是一些关联表的集合。</li><li>数据表: 表是数据的矩阵。在一个数据库中的表看起来像一个简单的电子表格。</li><li>列: 一列（数据元素）包含了相同类型的数据，例如邮政编码的数据。</li><li>行：一行（元组，或记录）是一组相关的数据，例如一条用户订阅的数据。</li><li>冗余：存储两倍数据，冗余降低了性能，但提高了数据的安全性。</li><li>主键：主键是唯一的。一个数据表中只能包含一个主键。你可以使用主键来查询数据。</li><li>外键：外键用于关联两个表。</li><li>复合键：复合键（组合键）将多个列作为一个索引键，一般用于复合索引。</li><li>索引：使用索引可快速访问数据库表中的特定信息。索引是对数据库表中一列或多列的值进行排序的一种结构。类似于书籍的目录。</li><li>参照完整性: 参照的完整性要求关系中不允许引用不存在的实体。与实体完整性是关系模型必须满足的完整性约束条件，目的是保证数据的一致性。</li></ul><h1 id="数据库"><a href="#数据库" class="headerlink" title="数据库"></a>数据库</h1><p>MySQL 是一个关系型数据库管理系统（RDBMS），由瑞典 MySQL AB 公司开发，目前属于 Oracle 公司。MySQL 是一种关联数据库管理系统，关联数据库将数据保存在不同的表中，而不是将所有数据放在一个大仓库内，这样就增加了速度并提高了灵活性。</p><ul><li>MySQL 是开源的，所以你不需要支付额外的费用。</li><li>MySQL 支持大型的数据库。可以处理拥有上千万条记录的大型数据库。</li><li>MySQL 使用标准的 SQL 数据语言形式。</li><li>MySQL 可以运行于多个系统上，并且支持多种语言。这些编程语言包括 C、C++、Python、Java、Perl、PHP、Eiffel、Ruby 和 Tcl 等。</li><li>MySQL 对PHP有很好的支持，PHP 是目前最流行的 Web 开发语言。</li><li>MySQL 支持大型数据库，支持 5000 万条记录的数据仓库，32 位系统表文件最大可支持 4GB，64 位系统支持最大的表文件为 8TB。</li><li>MySQL 是可以定制的，采用了 GPL 协议，你可以修改源码来开发自己的 MySQL 系统。</li></ul><h1 id="连接"><a href="#连接" class="headerlink" title="连接"></a>连接</h1><p>您可以使用 MySQL 二进制方式进入到 <code>mysql</code> 命令提示符下来连接 MySQL 数据库。</p><p>以下是在命令提示窗口中连接 MySQL 服务器的简单实例：</p><p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@host]# mysql -u root -pEnter password:******<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></p><p>在登录成功后会出现 <code>mysql&gt;</code> 命令提示窗口，你可以在上面执行任何 SQL 语句。</p><p>以上命令执行后，登录成功输出结果如下:</p><p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">Welcome to the MySQL monitor.  Commands end with ; or \g.Your MySQL connection id is 2854760 to server version: 5.0.9Type &#39;help;&#39; or &#39;\h&#39; for help. Type &#39;\c&#39; to clear the buffer.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></p><p>在以上实例中，我们使用了 <code>root</code> 用户登录到 MySQL 服务器，当然你也可以使用其他 MySQL 用户登录。</p><p>如果用户权限足够，任何用户都可以在 <code>mysql</code> 的命令提示窗口中进行 SQL 操作。</p><p>退出 <code>mysql&gt;</code> 命令提示窗口可以使用 <code>exit</code> 命令，如下所示：</p><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">mysql<span class="token operator">></span> <span class="token keyword">exit</span>Bye<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></p><h1 id="创建数据库"><a href="#创建数据库" class="headerlink" title="创建数据库"></a>创建数据库</h1><p>我们可以在登陆 MySQL 服务后，使用 <code>CREATE DATABASE</code> 命令创建数据库，语法如下：</p><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">DATABASE</span> 数据库名<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><h2 id="使用-CREATE-DATABASE-命令"><a href="#使用-CREATE-DATABASE-命令" class="headerlink" title="使用 CREATE DATABASE 命令"></a>使用 CREATE DATABASE 命令</h2><p>以下命令简单的演示了创建数据库的过程，数据名为 <code>TestDB</code>:</p><p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@host]# mysql -u root -pEnter password:******  # 登录后进入终端<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></p><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">mysql<span class="token operator">></span> <span class="token keyword">CREATE</span> <span class="token keyword">DATABASE</span> TestDB<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><h2 id="使用-mysqladmin-创建数据库"><a href="#使用-mysqladmin-创建数据库" class="headerlink" title="使用 mysqladmin 创建数据库"></a>使用 mysqladmin 创建数据库</h2><p>使用普通用户，你可能需要特定的权限来创建或者删除 MySQL 数据库。</p><p>所以我们这边使用 <code>root</code> 用户登录，<code>root</code> 用户拥有最高权限，可以使用 <code>mysql mysqladmin</code> 命令来创建数据库。</p><p>以下命令简单的演示了创建数据库的过程，数据名为 TestDB:</p><p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@host]# mysqladmin -u root -p CREATE TestDBEnter password:******<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></p><p>以上命令执行成功后会创建 MySQL 数据库 TestDB。</p><h1 id="删除数据库"><a href="#删除数据库" class="headerlink" title="删除数据库"></a>删除数据库</h1><p>使用普通用户登陆 MySQL 服务器，你可能需要特定的权限来创建或者删除 MySQL 数据库，所以我们这边使用 root 用户登录，root 用户拥有最高权限。</p><p>在删除数据库过程中，务必要十分谨慎，因为在执行删除命令后，所有数据将会消失。</p><h2 id="使用-DROP-DATABASE-命令"><a href="#使用-DROP-DATABASE-命令" class="headerlink" title="使用 DROP DATABASE 命令"></a>使用 DROP DATABASE 命令</h2><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">DROP</span> <span class="token keyword">DATABASE</span> <span class="token operator">&lt;</span>数据库名<span class="token operator">></span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><p>例如删除名为 <code>TestDB</code> 的数据库：</p><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">mysql<span class="token operator">></span> <span class="token keyword">DROP</span> <span class="token keyword">DATABASE</span> TestDB<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><h2 id="使用-mysqladmin-删除数据库"><a href="#使用-mysqladmin-删除数据库" class="headerlink" title="使用 mysqladmin 删除数据库"></a>使用 mysqladmin 删除数据库</h2><p>你也可以使用 <code>mysqladmin</code> 命令在终端来执行删除命令。</p><p>以下实例删除数据库 TestDB：</p><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token punctuation">[</span>root<span class="token variable">@host</span><span class="token punctuation">]</span><span class="token comment"># mysqladmin -u root -p DROP TestDB</span>Enter password:<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></p><p>执行以上删除数据库命令后，会出现一个提示框，来确认是否真的删除数据库：</p><p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">Dropping the database is potentially a very bad thing to do.Any data stored in the database will be destroyed.Do you really want to drop the &#39;TestDB&#39; database [y&#x2F;N] yDatabase &quot;TestDB&quot; dropped<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h1 id="选择数据库"><a href="#选择数据库" class="headerlink" title="选择数据库"></a>选择数据库</h1><p>在你连接到 MySQL 数据库后，可能有多个可以操作的数据库，所以你需要选择你要操作的数据库。</p><p>从命令提示窗口中选择MySQL数据库</p><p>在 <code>mysql&gt;</code> 提示窗口中可以很简单的选择特定的数据库。你可以使用SQL命令来选择指定的数据库。</p><p>以下实例选取了数据库 <code>TestDB</code>:</p><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token punctuation">[</span>root<span class="token variable">@host</span><span class="token punctuation">]</span><span class="token comment"># mysql -u root -p</span>Enter password:<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span>mysql<span class="token operator">></span> <span class="token keyword">use</span> TestDB<span class="token punctuation">;</span><span class="token keyword">Database</span> changedmysql<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p>执行以上命令后，你就已经成功选择了 TestDB 数据库，在后续的操作中都会在 TestDB 数据库中执行。</p><p>注意:所有的数据库名，表名，表字段都是区分大小写的。所以你在使用SQL命令时需要输入正确的名称。</p><h1 id="数据类型"><a href="#数据类型" class="headerlink" title="数据类型"></a>数据类型</h1><p>MySQL中定义数据字段的类型对你数据库的优化是非常重要的。</p><p>MySQL支持多种类型，大致可以分为三类：数值、日期/时间和字符串(字符)类型。</p><h2 id="数值类型"><a href="#数值类型" class="headerlink" title="数值类型"></a>数值类型</h2><p>MySQL支持所有标准SQL数值数据类型。</p><p>这些类型包括严格数值数据类型（<code>INTEGER</code>、<code>SMALLINT</code>、<code>DECIMAL</code> 和 <code>NUMERIC</code>），以及近似数值数据类型（<code>FLOAT</code>、<code>REAL</code> 和 <code>DOUBLE PRECISION</code>）。</p><p>关键字 <code>INT</code> 是 <code>INTEGER</code> 的同义词，关键字 <code>DEC</code> 是 <code>DECIMAL</code> 的同义词。</p><p>BIT 数据类型保存位字段值，并且支持 MyISAM、MEMORY、InnoDB 和 BDB 表。</p><p>作为 SQL 标准的扩展，MySQL 也支持整数类型 <code>TINYINT</code>、<code>MEDIUMINT</code> 和 <code>BIGINT</code>。下面的表显示了需要的每个整数类型的存储和范围。</p><div class="table-container"><table><thead><tr><th style="text-align:center">类型</th><th style="text-align:center">大小</th><th style="text-align:center">范围（有符号）</th><th style="text-align:center">范围（无符号）</th><th style="text-align:center">用途</th></tr></thead><tbody><tr><td style="text-align:center">TINYINT</td><td style="text-align:center">1 byte</td><td style="text-align:center">(-128，127)</td><td style="text-align:center">(0，255)</td><td style="text-align:center">小整数值</td></tr><tr><td style="text-align:center">SMALLINT</td><td style="text-align:center">2 bytes</td><td style="text-align:center">(-32 768，32 767)</td><td style="text-align:center">(0，65 535)</td><td style="text-align:center">大整数值</td></tr><tr><td style="text-align:center">MEDIUMINT</td><td style="text-align:center">3 bytes</td><td style="text-align:center">(-8 388 608，8 388 607)</td><td style="text-align:center">(0，16 777 215)</td><td style="text-align:center">大整数值</td></tr><tr><td style="text-align:center">INT或<br>INTEGER</td><td style="text-align:center">4 bytes</td><td style="text-align:center">(-2 147 483 648，2 147 483 647)</td><td style="text-align:center">(0，4 294 967 295)</td><td style="text-align:center">大整数值</td></tr><tr><td style="text-align:center">BIGINT</td><td style="text-align:center">8 bytes</td><td style="text-align:center">(-9 223 372 036 854 775 808，<br>9 223 372 036 854 775 807)</td><td style="text-align:center">(0，<br>18 446 744 073 709 551 615)</td><td style="text-align:center">极大整数值</td></tr><tr><td style="text-align:center">FLOAT</td><td style="text-align:center">4 bytes</td><td style="text-align:center">(-3.402 823 466 E+38，<br>-1.175 494 351 E-38)，<br>0，<br>(1.175 494 351 E-38，<br>3.402 823 466 351 E+38)</td><td style="text-align:center">0，<br>(1.175 494 351 E-38，<br>3.402 823 466 E+38)</td><td style="text-align:center">单精度浮点数值</td></tr><tr><td style="text-align:center">DOUBLE</td><td style="text-align:center">8 bytes</td><td style="text-align:center">(-1.797 693 134 862 315 7 E+308，<br>-2.225 073 858 507 201 4 E-308)，<br>0，<br>(2.225 073 858 507 201 4 E-308，<br>1.797 693 134 862 315 7 E+308)</td><td style="text-align:center">0，<br>(2.225 073 858 507 201 4 E-308，<br>1.797 693 134 862 315 7 E+308)</td><td style="text-align:center">双精度浮点数值</td></tr><tr><td style="text-align:center">DECIMAL</td><td style="text-align:center">DECIMAL(M, D)，<br>如果 M&gt;D，<br>为 M+2 ，否则为 D+2</td><td style="text-align:center">依赖于 M 和 D 的值</td><td style="text-align:center">依赖于 M 和 D 的值</td><td style="text-align:center">小数值</td></tr></tbody></table></div><h2 id="日期和时间类型"><a href="#日期和时间类型" class="headerlink" title="日期和时间类型"></a>日期和时间类型</h2><p>表示时间值的日期和时间类型为 <code>DATETIME</code>、<code>DATE</code>、<code>TIMESTAMP</code>、<code>TIME</code> 和 <code>YEAR</code>。</p><p>每个时间类型有一个有效值范围和一个“零”值，当指定不合法的 MySQL 不能表示的值时使用“零”值。</p><p><code>TIMESTAMP</code> 类型有专有的自动更新特性，将在后面描述。</p><div class="table-container"><table><thead><tr><th style="text-align:center">类型</th><th style="text-align:center">大小</th><th style="text-align:center">范围</th><th style="text-align:center">格式</th><th style="text-align:center">用途</th></tr></thead><tbody><tr><td style="text-align:center">DATE</td><td style="text-align:center">3 bytes</td><td style="text-align:center">1000-01-01 /<br> 9999-12-31</td><td style="text-align:center">YYYY-MM-DD</td><td style="text-align:center">日期值</td></tr><tr><td style="text-align:center">TIME</td><td style="text-align:center">3 bytes</td><td style="text-align:center">&#39;-838:59:59&#39; /<br>&#39;838:59:59&#39;</td><td style="text-align:center">HH:MM:SS</td><td style="text-align:center">时间值或持续时间</td></tr><tr><td style="text-align:center">YEAR</td><td style="text-align:center">1 bytes</td><td style="text-align:center">1901 / 2155</td><td style="text-align:center">YYYY</td><td style="text-align:center">年份值</td></tr><tr><td style="text-align:center">DATETIME</td><td style="text-align:center">8 bytes</td><td style="text-align:center">1000-01-01 00:00:00 /<br>9999-12-31 23:59:59</td><td style="text-align:center">YYYY-MM-DD HH:MM:SS</td><td style="text-align:center">混合日期和时间值</td></tr><tr><td style="text-align:center">TIMESTAMP</td><td style="text-align:center">4 bytes</td><td style="text-align:center">1970-01-01 00:00:00 /<br>结束时间是第 2147483647 秒，<br>北京时间 2038-1-19 11:14:07，<br>格林尼治时间 2038-1-19 03:14:07</td><td style="text-align:center">YYYYMMDD HHMMSS</td><td style="text-align:center">混合日期和时间值，时间戳</td></tr></tbody></table></div><h2 id="字符串类型"><a href="#字符串类型" class="headerlink" title="字符串类型"></a>字符串类型</h2><p>字符串类型指 <code>CHAR</code>、<code>VARCHAR</code>、<code>BINARY</code>、<code>VARBINARY</code>、<code>BLOB</code>、<code>TEXT</code>、<code>ENUM</code> 和 <code>SET</code>。该节描述了这些类型如何工作以及如何在查询中使用这些类型。</p><div class="table-container"><table><thead><tr><th style="text-align:center">类型</th><th style="text-align:center">大小</th><th style="text-align:center">用途</th></tr></thead><tbody><tr><td style="text-align:center">CHAR</td><td style="text-align:center">0-255 bytes</td><td style="text-align:center">定长字符串</td></tr><tr><td style="text-align:center">VARCHAR</td><td style="text-align:center">0-65535 bytes</td><td style="text-align:center">变长字符串</td></tr><tr><td style="text-align:center">TINYBLOB</td><td style="text-align:center">0-255 bytes</td><td style="text-align:center">不超过 255 个字符的二进制字符串</td></tr><tr><td style="text-align:center">TINYTEXT</td><td style="text-align:center">0-255 bytes</td><td style="text-align:center">短文本字符串</td></tr><tr><td style="text-align:center">BLOB</td><td style="text-align:center">0-65 535 bytes</td><td style="text-align:center">二进制形式的长文本数据</td></tr><tr><td style="text-align:center">TEXT</td><td style="text-align:center">0-65 535 bytes</td><td style="text-align:center">长文本数据</td></tr><tr><td style="text-align:center">MEDIUMBLOB</td><td style="text-align:center">0-16 777 215 bytes</td><td style="text-align:center">二进制形式的中等长度文本数据</td></tr><tr><td style="text-align:center">MEDIUMTEXT</td><td style="text-align:center">0-16 777 215 bytes</td><td style="text-align:center">中等长度文本数据</td></tr><tr><td style="text-align:center">LONGBLOB</td><td style="text-align:center">0-4 294 967 295 bytes</td><td style="text-align:center">二进制形式的极大文本数据</td></tr><tr><td style="text-align:center">LONGTEXT</td><td style="text-align:center">0-4 294 967 295 bytes</td><td style="text-align:center">极大文本数据</td></tr></tbody></table></div><p><strong>注意：</strong></p><ul><li><p><code>char(n)</code> 和 <code>varchar(n)</code> 中括号中 <code>n</code> 代表字符的个数，并不代表字节个数，比如 <code>CHAR(30)</code> 就可以存储 30 个字符。</p></li><li><p><code>CHAR</code> 和 <code>VARCHAR</code> 类型类似，但它们保存和检索的方式不同。它们的最大长度和是否尾部空格被保留等方面也不同。在存储或检索过程中不进行大小写转换。</p></li><li><p><code>BINARY</code> 和 <code>VARBINARY</code> 类似于 <code>CHAR</code> 和 <code>VARCHAR</code>，不同的是它们包含二进制字符串而不要非二进制字符串。也就是说，它们包含字节字符串而不是字符字符串。这说明它们没有字符集，并且排序和比较基于列值字节的数值值。</p></li><li><p><code>BLOB</code> 是一个二进制大对象，可以容纳可变数量的数据。有 4 种 <code>BLOB</code> 类型：<code>TINYBLOB</code>、<code>BLOB</code>、<code>MEDIUMBLOB</code> 和 <code>LONGBLOB</code>。它们区别在于可容纳存储范围不同。</p></li><li><p>有 4 种 <code>TEXT</code> 类型：<code>TINYTEXT</code>、<code>TEXT</code>、<code>MEDIUMTEXT</code> 和 <code>LONGTEXT</code>。对应的这 4 种 <code>BLOB</code> 类型，可存储的最大长度不同，可根据实际情况选择。</p></li></ul><h1 id="创建数据表"><a href="#创建数据表" class="headerlink" title="创建数据表"></a>创建数据表</h1><p>创建MySQL数据表需要以下信息：</p><ul><li>表名</li><li>表字段名</li><li>定义每个表字段</li></ul><h2 id="CREATE-TABLE-命令"><a href="#CREATE-TABLE-命令" class="headerlink" title="CREATE TABLE 命令"></a>CREATE TABLE 命令</h2><p>以下为创建 MySQL 数据表的 SQL 通用语法：</p><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> table_name <span class="token punctuation">(</span>column_name column_type<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><p>以下例子中我们将在 <code>TestDB</code> 数据库中创建数据表 <code>tbl</code>：</p><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token keyword">IF</span> <span class="token operator">NOT</span> <span class="token keyword">EXISTS</span> <span class="token punctuation">`</span>tbl<span class="token punctuation">`</span><span class="token punctuation">(</span>   <span class="token punctuation">`</span>id<span class="token punctuation">`</span> <span class="token keyword">INT</span> <span class="token keyword">UNSIGNED</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token punctuation">,</span>   <span class="token punctuation">`</span>title<span class="token punctuation">`</span> <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>   <span class="token punctuation">`</span>author<span class="token punctuation">`</span> <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">40</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>   <span class="token punctuation">`</span>submission_date<span class="token punctuation">`</span> <span class="token keyword">DATE</span><span class="token punctuation">,</span>   <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span> <span class="token punctuation">`</span>id<span class="token punctuation">`</span> <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p><strong>实例解析：</strong></p><ul><li>如果你不想字段为 <code>NULL</code> 可以设置字段的属性为 <code>NOT NULL</code>， 在操作数据库时如果输入该字段的数据为 <code>NULL</code>，就会报错。</li><li><code>AUTO_INCREMENT</code> 定义列为自增的属性，一般用于主键，数值会自动加 1。</li><li><code>PRIMARY KEY</code> 关键字用于定义列为主键。 您可以使用多列来定义主键，列间以逗号分隔。</li><li><code>ENGINE</code> 设置存储引擎，<code>CHARSET</code> 设置编码。</li></ul><h2 id="在命令提示窗口中创建表"><a href="#在命令提示窗口中创建表" class="headerlink" title="在命令提示窗口中创建表"></a>在命令提示窗口中创建表</h2><p>通过 <code>mysql&gt;</code> 命令窗口可以很简单的创建MySQL数据表。你可以使用 SQL 语句 <code>CREATE TABLE</code> 来创建数据表。</p><p>以下为创建数据表 tbl 实例:</p><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">mysql<span class="token operator">></span> <span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> tbl<span class="token punctuation">(</span>    <span class="token operator">-</span><span class="token operator">></span> id <span class="token keyword">INT</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token punctuation">,</span>    <span class="token operator">-</span><span class="token operator">></span> title <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>    <span class="token operator">-</span><span class="token operator">></span> author <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">40</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>    <span class="token operator">-</span><span class="token operator">></span> submission_date <span class="token keyword">DATE</span><span class="token punctuation">,</span>    <span class="token operator">-</span><span class="token operator">></span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span> id <span class="token punctuation">)</span>    <span class="token operator">-</span><span class="token operator">></span> <span class="token punctuation">)</span><span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8<span class="token punctuation">;</span>Query OK<span class="token punctuation">,</span> <span class="token number">0</span> <span class="token keyword">rows</span> affected <span class="token punctuation">(</span><span class="token number">0.16</span> sec<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p><strong>注意</strong>：MySQL 命令终止符为分号 <code>;</code> 。</p><h1 id="删除数据表"><a href="#删除数据表" class="headerlink" title="删除数据表"></a>删除数据表</h1><p>MySQL中删除数据表是非常容易操作的， 但是你再进行删除表操作时要非常小心，因为执行删除命令后所有数据都会消失。</p><h2 id="DROP-TABLE-命令"><a href="#DROP-TABLE-命令" class="headerlink" title="DROP TABLE 命令"></a>DROP TABLE 命令</h2><p>以下为删除MySQL数据表的通用语法：</p><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">DROP</span> <span class="token keyword">TABLE</span> table_name <span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><h2 id="在命令提示窗口中删除数据表"><a href="#在命令提示窗口中删除数据表" class="headerlink" title="在命令提示窗口中删除数据表"></a>在命令提示窗口中删除数据表</h2><p>在 <code>mysql&gt;</code> 命令提示窗口中删除数据表 SQL 语句为 DROP TABLE：</p><p>以下实例删除了数据表 <code>tbl</code>:</p><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">mysql<span class="token operator">></span> <span class="token keyword">DROP</span> <span class="token keyword">TABLE</span> tblQuery OK<span class="token punctuation">,</span> <span class="token number">0</span> <span class="token keyword">rows</span> affected <span class="token punctuation">(</span><span class="token number">0.8</span> sec<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></p><h1 id="插入数据"><a href="#插入数据" class="headerlink" title="插入数据"></a>插入数据</h1><p>MySQL 表中使用 <code>INSERT INTO</code> 语句来插入数据。</p><p>INSERT INTO 命令</p><p>以下为向 MySQL 数据表插入数据通用的 <code>INSERT INTO</code> 的 SQL 语法：</p><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> table_name <span class="token punctuation">(</span> field1<span class="token punctuation">,</span> field2<span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>fieldN <span class="token punctuation">)</span>                       <span class="token keyword">VALUES</span>                       <span class="token punctuation">(</span> value1<span class="token punctuation">,</span> value2<span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>valueN <span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></p><p>如果数据是字符型，必须使用单引号或者双引号，如：<code>&quot;value&quot;</code>。</p><h2 id="通过命令提示窗口插入数据"><a href="#通过命令提示窗口插入数据" class="headerlink" title="通过命令提示窗口插入数据"></a>通过命令提示窗口插入数据</h2><p>以下我们将使用 <code>INSERT INTO</code> 语句向 MySQL 数据表 <code>tbl</code> 插入数据</p><p>以下实例中我们将向 <code>tbl</code> 表插入三条数据:</p><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">mysql<span class="token operator">></span> <span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> tbl     <span class="token operator">-</span><span class="token operator">></span> <span class="token punctuation">(</span>title<span class="token punctuation">,</span> author<span class="token punctuation">,</span> submission_date<span class="token punctuation">)</span>    <span class="token operator">-</span><span class="token operator">></span> <span class="token keyword">VALUES</span>    <span class="token operator">-</span><span class="token operator">></span> <span class="token punctuation">(</span><span class="token string">"学习 PHP"</span><span class="token punctuation">,</span> <span class="token string">"PHP"</span><span class="token punctuation">,</span> <span class="token function">NOW</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>Query OK<span class="token punctuation">,</span> <span class="token number">1</span> <span class="token keyword">rows</span> affected<span class="token punctuation">,</span> <span class="token number">1</span> <span class="token keyword">warnings</span> <span class="token punctuation">(</span><span class="token number">0.01</span> sec<span class="token punctuation">)</span>mysql<span class="token operator">></span> <span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> tbl    <span class="token operator">-</span><span class="token operator">></span> <span class="token punctuation">(</span>title<span class="token punctuation">,</span> author<span class="token punctuation">,</span> submission_date<span class="token punctuation">)</span>    <span class="token operator">-</span><span class="token operator">></span> <span class="token keyword">VALUES</span>    <span class="token operator">-</span><span class="token operator">></span> <span class="token punctuation">(</span><span class="token string">"学习 MySQL"</span><span class="token punctuation">,</span> <span class="token string">"MySQL"</span><span class="token punctuation">,</span> <span class="token function">NOW</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>Query OK<span class="token punctuation">,</span> <span class="token number">1</span> <span class="token keyword">rows</span> affected<span class="token punctuation">,</span> <span class="token number">1</span> <span class="token keyword">warnings</span> <span class="token punctuation">(</span><span class="token number">0.01</span> sec<span class="token punctuation">)</span>mysql<span class="token operator">></span> <span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> tbl    <span class="token operator">-</span><span class="token operator">></span> <span class="token punctuation">(</span>title<span class="token punctuation">,</span> author<span class="token punctuation">,</span> submission_date<span class="token punctuation">)</span>    <span class="token operator">-</span><span class="token operator">></span> <span class="token keyword">VALUES</span>    <span class="token operator">-</span><span class="token operator">></span> <span class="token punctuation">(</span><span class="token string">"学习 JAVA"</span><span class="token punctuation">,</span> <span class="token string">"JAVA"</span><span class="token punctuation">,</span> <span class="token string">'2021-01-01'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>Query OK<span class="token punctuation">,</span> <span class="token number">1</span> <span class="token keyword">rows</span> affected <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>mysql<span class="token operator">></span> <span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> tbl    <span class="token operator">-</span><span class="token operator">></span> <span class="token punctuation">(</span>title<span class="token punctuation">,</span> author<span class="token punctuation">,</span> submission_date<span class="token punctuation">)</span>    <span class="token operator">-</span><span class="token operator">></span> <span class="token keyword">VALUES</span>    <span class="token operator">-</span><span class="token operator">></span> <span class="token punctuation">(</span><span class="token string">"学习 Python"</span><span class="token punctuation">,</span> <span class="token string">"Python"</span><span class="token punctuation">,</span> <span class="token string">'2021-01-01'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>Query OK<span class="token punctuation">,</span> <span class="token number">1</span> <span class="token keyword">rows</span> affected<span class="token punctuation">,</span> <span class="token number">1</span> <span class="token keyword">warnings</span> <span class="token punctuation">(</span><span class="token number">0.01</span> sec<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p><strong>注意</strong>：使用箭头标记 <code>-&gt;</code> 不是 SQL 语句的一部分，它仅仅表示一个新行，如果一条SQL语句太长，我们可以通过回车键来创建一个新行来编写 SQL 语句，SQL 语句的命令结束符为分号 <code>;</code>。</p><p>在以上实例中，我们并没有提供 <code>id</code> 的数据，因为该字段我们在创建表的时候已经设置它为 <code>AUTO_INCREMENT</code>(自动增加) 属性。 所以，该字段会自动递增而不需要我们去设置。实例中 <code>NOW()</code> 是一个 MySQL 函数，该函数返回日期和时间。</p><h1 id="查询数据"><a href="#查询数据" class="headerlink" title="查询数据"></a>查询数据</h1><h2 id="SELECT-命令"><a href="#SELECT-命令" class="headerlink" title="SELECT 命令"></a>SELECT 命令</h2><p>MySQL 数据库使用 <code>SELECT</code> 语句来查询数据。</p><p>以下为在 MySQL 数据库中查询数据通用的 SELECT 语法：</p><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> column_name<span class="token punctuation">,</span> column_name<span class="token keyword">FROM</span> table_name<span class="token punctuation">[</span><span class="token keyword">WHERE</span> Clause<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token keyword">LIMIT</span> N<span class="token punctuation">]</span><span class="token punctuation">[</span> <span class="token keyword">OFFSET</span> M<span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></p><ul><li>查询语句中你可以使用一个或者多个表，表之间使用逗号 <code>,</code> 分割，并使用 <code>WHERE</code> 语句来设定查询条件。</li><li><code>SELECT</code> 命令可以读取一条或者多条记录。</li><li>你可以使用星号 <code>*</code> 来代替其他字段，<code>SELECT</code> 语句会返回表的所有字段数据。</li><li>你可以使用 <code>WHERE</code> 语句来包含任何条件。</li><li>你可以使用 <code>LIMIT</code> 属性来设定返回的记录数。</li><li>你可以通过 <code>OFFSET</code> 指定 <code>SELECT</code> 语句开始查询的数据偏移量。默认情况下偏移量为 0。</li></ul><h2 id="在命令提示窗口中获取数据"><a href="#在命令提示窗口中获取数据" class="headerlink" title="在命令提示窗口中获取数据"></a>在命令提示窗口中获取数据</h2><p>以下实例我们将通过 <code>SELECT</code> 命令来获取数据表 <code>tbl</code> 的数据：</p><p>读取数据表：</p><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> tbl<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><p>输出结果：<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">mysql<span class="token operator">></span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> tbl<span class="token punctuation">;</span><span class="token operator">+</span><span class="token comment">----+-------------+--------+-----------------+</span><span class="token operator">|</span> id <span class="token operator">|</span> title       <span class="token operator">|</span> author <span class="token operator">|</span> submission_date <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">----+-------------+--------+-----------------+</span><span class="token operator">|</span>  <span class="token number">1</span> <span class="token operator">|</span> 学习 PHP    <span class="token operator">|</span> PHP    <span class="token operator">|</span> <span class="token number">2021</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">12</span>      <span class="token operator">|</span><span class="token operator">|</span>  <span class="token number">2</span> <span class="token operator">|</span> 学习 MySQL  <span class="token operator">|</span> MySQL  <span class="token operator">|</span> <span class="token number">2021</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">12</span>      <span class="token operator">|</span><span class="token operator">|</span>  <span class="token number">3</span> <span class="token operator">|</span> 学习 JAVA   <span class="token operator">|</span> JAVA   <span class="token operator">|</span> <span class="token number">2021</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">01</span>      <span class="token operator">|</span><span class="token operator">|</span>  <span class="token number">4</span> <span class="token operator">|</span> 学习 Python <span class="token operator">|</span> Python <span class="token operator">|</span> <span class="token number">2021</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">01</span>      <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">----+-------------+--------+-----------------+</span><span class="token number">4</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h1 id="WHERE-子句"><a href="#WHERE-子句" class="headerlink" title="WHERE 子句"></a>WHERE 子句</h1><h2 id="WHERE-子句语法"><a href="#WHERE-子句语法" class="headerlink" title="WHERE 子句语法"></a>WHERE 子句语法</h2><p>我们知道从 MySQL 表中使用 <code>SELECT</code> 语句来读取数据。</p><p>如需有条件地从表中选取数据，可将 <code>WHERE</code> 子句添加到 <code>SELECT</code> 语句中。</p><p>语法</p><p>以下是 <code>SELECT</code> 语句使用 <code>WHERE</code> 子句从数据表中读取数据的通用语法：</p><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> field1<span class="token punctuation">,</span> field2<span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>fieldN <span class="token keyword">FROM</span> table_name1<span class="token punctuation">,</span> table_name2<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">[</span><span class="token keyword">WHERE</span> condition1 <span class="token punctuation">[</span><span class="token operator">AND</span> <span class="token punctuation">[</span><span class="token operator">OR</span><span class="token punctuation">]</span><span class="token punctuation">]</span> condition2<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></p><ul><li>查询语句中你可以使用一个或者多个表，表之间使用逗号, 分割，并使用 <code>WHERE</code> 语句来设定查询条件。</li><li>你可以在 <code>WHERE</code> 子句中指定任何条件。</li><li>你可以使用 <code>AND</code> 或者 <code>OR</code> 指定一个或多个条件。</li><li><code>WHERE</code> 子句也可以运用于 SQL 的 <code>DELETE</code> 或者 <code>UPDATE</code> 命令。</li><li><code>WHERE</code> 子句类似于程序语言中的 <code>if</code> 条件，根据 MySQL 表中的字段值来读取指定的数据。</li></ul><p>以下为操作符列表，可用于 <code>WHERE</code> 子句中。</p><p>下表中实例假定 A 为 10, B 为 20</p><div class="table-container"><table><thead><tr><th style="text-align:center">操作符</th><th style="text-align:center">描述</th><th style="text-align:center">实例</th></tr></thead><tbody><tr><td style="text-align:center">=</td><td style="text-align:center">等号，检测两个值是否相等，<br>如果相等返回true</td><td style="text-align:center">(A = B) 返回false。</td></tr><tr><td style="text-align:center">&lt;&gt;, !=</td><td style="text-align:center">不等于，检测两个值是否相等，<br>如果不相等返回true</td><td style="text-align:center">(A != B) 返回 true。</td></tr><tr><td style="text-align:center">&gt;</td><td style="text-align:center">大于号，检测左边的值是否大于右边的值, <br>如果左边的值大于右边的值返回true</td><td style="text-align:center">(A &gt; B) 返回false。</td></tr><tr><td style="text-align:center">&lt;</td><td style="text-align:center">小于号，检测左边的值是否小于右边的值, <br>如果左边的值小于右边的值返回true</td><td style="text-align:center">(A &lt; B) 返回 true。</td></tr><tr><td style="text-align:center">&gt;=</td><td style="text-align:center">大于等于号，检测左边的值是否大于或等于右边的值, <br>如果左边的值大于或等于右边的值返回true</td><td style="text-align:center">(A &gt;= B) 返回false。</td></tr><tr><td style="text-align:center">&lt;=</td><td style="text-align:center">小于等于号，检测左边的值是否小于或等于右边的值, <br>如果左边的值小于或等于右边的值返回true</td><td style="text-align:center">(A &lt;= B) 返回 true。</td></tr></tbody></table></div><p>如果我们想在 MySQL 数据表中读取指定的数据，<code>WHERE</code> 子句是非常有用的。</p><p>使用主键来作为 <code>WHERE</code> 子句的条件查询是非常快速的。</p><p>如果给定的条件在表中没有任何匹配的记录，那么查询不会返回任何数据。</p><h2 id="BINARY-关键字"><a href="#BINARY-关键字" class="headerlink" title="BINARY 关键字"></a>BINARY 关键字</h2><p>MySQL 的 <code>WHERE</code> 子句的字符串比较是不区分大小写的。 你可以使用 <code>BINARY</code> 关键字来设定 <code>WHERE</code> 子句的字符串比较是区分大小写的。</p><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">mysql<span class="token operator">></span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> tbl <span class="token keyword">WHERE</span> <span class="token keyword">BINARY</span> author<span class="token operator">=</span><span class="token string">'mysql'</span><span class="token punctuation">;</span>Empty <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>mysql<span class="token operator">></span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> tbl <span class="token keyword">WHERE</span> <span class="token keyword">BINARY</span> author<span class="token operator">=</span><span class="token string">'MySQL'</span><span class="token punctuation">;</span><span class="token operator">+</span><span class="token comment">----+------------+--------+-----------------+</span><span class="token operator">|</span> id <span class="token operator">|</span> title      <span class="token operator">|</span> author <span class="token operator">|</span> submission_date <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">----+------------+--------+-----------------+</span><span class="token operator">|</span>  <span class="token number">2</span> <span class="token operator">|</span> 学习 MySQL <span class="token operator">|</span> MySQL  <span class="token operator">|</span> <span class="token number">2021</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">12</span>      <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">----+------------+--------+-----------------+</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p>实例中使用了 <code>BINARY</code> 关键字，是区分大小写的，所以 <code>author=&#39;mysql&#39;</code> 的查询条件是没有数据的。</p><h1 id="UPDATE-更新"><a href="#UPDATE-更新" class="headerlink" title="UPDATE 更新"></a>UPDATE 更新</h1><p>如果我们需要修改或更新 MySQL 中的数据，我们可以使用 <code>UPDATE</code> 命令来操作。</p><p>以下是 <code>UPDATE</code> 命令修改 MySQL 数据表数据的通用 SQL 语法：</p><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">UPDATE</span> table_name <span class="token keyword">SET</span> field1<span class="token operator">=</span>new<span class="token operator">-</span>value1<span class="token punctuation">,</span> field2<span class="token operator">=</span>new<span class="token operator">-</span>value2<span class="token punctuation">[</span><span class="token keyword">WHERE</span> Clause<span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></p><ul><li>你可以同时更新一个或多个字段。</li><li>你可以在 <code>WHERE</code> 子句中指定任何条件。</li><li>你可以在一个单独表中同时更新数据。</li><li>当你需要更新数据表中指定行的数据时 <code>WHERE</code> 子句是非常有用的。</li></ul><p>在命令提示窗口中更新数据</p><p>以下我们将在 <code>UPDATE</code> 命令使用 <code>WHERE</code> 子句来更新 <code>tbl</code> 表中指定的数据：</p><p>以下实例将更新数据表中 <code>id</code> 为 <code>3</code> 的 <code>title</code> 字段值：</p><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">mysql<span class="token operator">></span> <span class="token keyword">UPDATE</span> tbl <span class="token keyword">SET</span> title<span class="token operator">=</span><span class="token string">'学习 C++'</span> <span class="token keyword">WHERE</span> id <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>Query OK<span class="token punctuation">,</span> <span class="token number">1</span> <span class="token keyword">rows</span> affected <span class="token punctuation">(</span><span class="token number">0.01</span> sec<span class="token punctuation">)</span> mysql<span class="token operator">></span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> tbl <span class="token keyword">WHERE</span> id <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span><span class="token operator">+</span><span class="token comment">----+----------+--------+-----------------+</span><span class="token operator">|</span> id <span class="token operator">|</span> title    <span class="token operator">|</span> author <span class="token operator">|</span> submission_date <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">----+----------+--------+-----------------+</span><span class="token operator">|</span>  <span class="token number">3</span> <span class="token operator">|</span> 学习 C<span class="token operator">+</span><span class="token operator">+</span> <span class="token operator">|</span> JAVA   <span class="token operator">|</span> <span class="token number">2021</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">01</span>      <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">----+----------+--------+-----------------+</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p>从结果上看，<code>id</code> 为 <code>3</code> 的 <code>title</code> 已被修改。</p><h1 id="DELETE-语句"><a href="#DELETE-语句" class="headerlink" title="DELETE 语句"></a>DELETE 语句</h1><h2 id="DELETE-FROM-命令"><a href="#DELETE-FROM-命令" class="headerlink" title="DELETE FROM 命令"></a>DELETE FROM 命令</h2><p>你可以使用 SQL 的 <code>DELETE FROM</code> 命令来删除 MySQL 数据表中的记录。</p><p>以下是 SQL DELETE 语句从 MySQL 数据表中删除数据的通用语法：</p><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">DELETE</span> <span class="token keyword">FROM</span> table_name <span class="token punctuation">[</span><span class="token keyword">WHERE</span> Clause<span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><ul><li>如果没有指定 <code>WHERE</code> 子句，MySQL 表中的所有记录将被删除。</li><li>你可以在 <code>WHERE</code> 子句中指定任何条件</li><li>您可以在单个表中一次性删除记录。</li></ul><p>当你想删除数据表中指定的记录时 <code>WHERE</code> 子句是非常有用的。</p><h2 id="在命令提示窗口中删除数据"><a href="#在命令提示窗口中删除数据" class="headerlink" title="在命令提示窗口中删除数据"></a>在命令提示窗口中删除数据</h2><p>这里我们将在 <code>DELETE</code> 命令中使用 <code>WHERE</code> 子句来删除 MySQL 数据表 tbl 所选的数据。</p><p>以下实例将删除 tbl 表中 id 为3 的记录：</p><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">mysql<span class="token operator">></span> <span class="token keyword">DELETE</span> <span class="token keyword">FROM</span> tbl <span class="token keyword">WHERE</span> id<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">;</span>Query OK<span class="token punctuation">,</span> <span class="token number">1</span> <span class="token keyword">row</span> affected <span class="token punctuation">(</span><span class="token number">0.23</span> sec<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></p><h2 id="多表连接删除"><a href="#多表连接删除" class="headerlink" title="多表连接删除"></a>多表连接删除</h2><p>在 MySQL 中可以同时删除两个表以上的数据：</p><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">DELETE</span> orders<span class="token punctuation">,</span> items <span class="token keyword">FROM</span> orders<span class="token punctuation">,</span> items <span class="token keyword">WHERE</span> orders<span class="token punctuation">.</span>userid <span class="token operator">=</span> items<span class="token punctuation">.</span>userid <span class="token operator">AND</span> orders<span class="token punctuation">.</span>orderid <span class="token operator">=</span> items<span class="token punctuation">.</span>orderid <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></p><h1 id="LIKE-子句"><a href="#LIKE-子句" class="headerlink" title="LIKE 子句"></a>LIKE 子句</h1><p>我们知道在 MySQL 中使用 <code>SELECT</code> 命令来读取数据， 同时我们可以在 <code>SELECT</code> 语句中使用 <code>WHERE</code> 子句来获取指定的记录。</p><p><code>WHERE</code> 子句中可以使用等号 <code>=</code> 来设定获取数据的条件，如 <code>author = &#39;MySQL&#39;</code>。</p><p>但是有时候我们需要获取 <code>author</code> 字段含有 <code>P</code> 字符的所有记录，这时我们就需要在 <code>WHERE</code> 子句中使用 <code>LIKE</code> 子句。</p><p><code>LIKE</code> 子句中使用百分号 <code>%</code> 字符来表示任意字符，类似于 <code>UNIX</code> 或正则表达式中的星号 <code>*</code>。</p><p>如果没有使用百分号 <code>%</code>, <code>LIKE</code> 子句与等号 = 的效果是一样的。</p><h2 id="LIKE-子句语法"><a href="#LIKE-子句语法" class="headerlink" title="LIKE 子句语法"></a>LIKE 子句语法</h2><p>以下是 SELECT 语句使用 <code>LIKE</code> 子句从数据表中读取数据的通用语法：</p><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> field1<span class="token punctuation">,</span> field2<span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>fieldN <span class="token keyword">FROM</span> table_name<span class="token keyword">WHERE</span> field1 <span class="token operator">LIKE</span> condition1 <span class="token punctuation">[</span><span class="token operator">AND</span> <span class="token punctuation">[</span><span class="token operator">OR</span><span class="token punctuation">]</span><span class="token punctuation">]</span> filed2 <span class="token operator">=</span> <span class="token string">'somevalue'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></p><ul><li>你可以在 <code>WHERE</code> 子句中指定任何条件。</li><li>你可以在 <code>WHERE</code> 子句中使用 <code>LIKE</code> 子句。</li><li>你可以使用 <code>LIKE</code> 子句代替等号 <code>=</code>。</li><li><code>LIKE</code> 通常与 <code>%</code> 一同使用，类似于一个元字符的搜索。</li><li>你可以使用 <code>AND</code> 或者 <code>OR</code> 指定一个或多个条件。</li><li>你可以在 <code>DELETE</code> 或 <code>UPDATE</code> 命令中使用 <code>WHERE...LIKE</code> 子句来指定条件。</li></ul><h2 id="在命令提示符中使用-LIKE-子句"><a href="#在命令提示符中使用-LIKE-子句" class="headerlink" title="在命令提示符中使用 LIKE 子句"></a>在命令提示符中使用 LIKE 子句</h2><p>以下我们将在 <code>SELECT</code> 命令中使用 <code>WHERE...LIKE</code> 子句来从 MySQL 数据表 <code>tbl</code> 中读取数据。</p><p>以下是我们将 <code>tbl</code> 表中获取 <code>author</code> 字段中以 P 为开头的所有记录：</p><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">mysql<span class="token operator">></span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> tbl  <span class="token keyword">WHERE</span> author <span class="token operator">LIKE</span> <span class="token string">'P%'</span><span class="token punctuation">;</span><span class="token operator">+</span><span class="token comment">----+-------------+--------+-----------------+</span><span class="token operator">|</span> id <span class="token operator">|</span> title       <span class="token operator">|</span> author <span class="token operator">|</span> submission_date <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">----+-------------+--------+-----------------+</span><span class="token operator">|</span>  <span class="token number">1</span> <span class="token operator">|</span> 学习 PHP    <span class="token operator">|</span> PHP    <span class="token operator">|</span> <span class="token number">2021</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">12</span>      <span class="token operator">|</span><span class="token operator">|</span>  <span class="token number">4</span> <span class="token operator">|</span> 学习 Python <span class="token operator">|</span> Python <span class="token operator">|</span> <span class="token number">2021</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">01</span>      <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">----+-------------+--------+-----------------+</span><span class="token number">2</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h1 id="UNION-操作符"><a href="#UNION-操作符" class="headerlink" title="UNION 操作符"></a>UNION 操作符</h1><p>下面为大家介绍 MySQL <code>UNION</code> 操作符的语法和实例。</p><p>MySQL <code>UNION</code> 操作符用于连接两个以上的 <code>SELECT</code> 语句的结果组合到一个结果集合中。多个 <code>SELECT</code> 语句会删除重复的数据。</p><h2 id="UNION-操作符语法"><a href="#UNION-操作符语法" class="headerlink" title="UNION 操作符语法"></a>UNION 操作符语法</h2><p>MySQL <code>UNION</code> 操作符语法格式：</p><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> expression1<span class="token punctuation">,</span> expression2<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> expression_n<span class="token keyword">FROM</span> <span class="token keyword">tables</span><span class="token punctuation">[</span><span class="token keyword">WHERE</span> conditions<span class="token punctuation">]</span><span class="token keyword">UNION</span> <span class="token punctuation">[</span><span class="token keyword">ALL</span> <span class="token operator">|</span> <span class="token keyword">DISTINCT</span><span class="token punctuation">]</span><span class="token keyword">SELECT</span> expression1<span class="token punctuation">,</span> expression2<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> expression_n<span class="token keyword">FROM</span> <span class="token keyword">tables</span><span class="token punctuation">[</span><span class="token keyword">WHERE</span> conditions<span class="token punctuation">]</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p>参数</p><ul><li><strong>expression1, expression2, ... expression_n</strong>: 要检索的列。</li><li><strong>tables</strong>: 要检索的数据表。</li><li><strong>WHERE conditions</strong>: 可选，检索条件。</li><li><strong>DISTINCT</strong>: 可选，删除结果集中重复的数据。默认情况下 <code>UNION</code> 操作符已经删除了重复数据，所以 <code>DISTINCT</code> 修饰符对结果没啥影响。</li><li><strong>ALL</strong>: 可选，返回所有结果集，包含重复数据。</li></ul><p>演示数据库</p><p>下面是选自 <code>Websites</code> 表的数据：</p><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">mysql<span class="token operator">></span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> Websites<span class="token punctuation">;</span><span class="token operator">+</span><span class="token comment">----+--------------+---------------------------+-------+---------+</span><span class="token operator">|</span> id <span class="token operator">|</span> name         <span class="token operator">|</span> url                       <span class="token operator">|</span> alexa <span class="token operator">|</span> country <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">----+--------------+---------------------------+-------+---------+</span><span class="token operator">|</span> <span class="token number">1</span>  <span class="token operator">|</span> Google       <span class="token operator">|</span> https:<span class="token comment">//www.google.cm/    | 1     | USA     |</span><span class="token operator">|</span> <span class="token number">2</span>  <span class="token operator">|</span> 淘宝          <span class="token operator">|</span> https:<span class="token comment">//www.taobao.com/   | 13    | CN      |</span><span class="token operator">|</span> <span class="token number">3</span>  <span class="token operator">|</span> 微博          <span class="token operator">|</span> https:<span class="token comment">//weibo.com/         | 20    | CN      |</span><span class="token operator">|</span> <span class="token number">4</span>  <span class="token operator">|</span> Facebook     <span class="token operator">|</span> https:<span class="token comment">//www.facebook.com/ | 3     | USA     |</span><span class="token operator">|</span> <span class="token number">5</span>  <span class="token operator">|</span> stackoverflow <span class="token operator">|</span> https:<span class="token comment">//stackoverflow.com/ |   0 | IND     |</span><span class="token operator">+</span><span class="token comment">----+---------------+---------------------------+-------+---------+</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p>下面是 <code>apps</code> 表的数据：</p><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">mysql<span class="token operator">></span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> apps<span class="token punctuation">;</span><span class="token operator">+</span><span class="token comment">----+------------+-------------------------+---------+</span><span class="token operator">|</span> id <span class="token operator">|</span> app_name   <span class="token operator">|</span> url                     <span class="token operator">|</span> country <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">----+------------+-------------------------+---------+</span><span class="token operator">|</span>  <span class="token number">1</span> <span class="token operator">|</span> QQ APP     <span class="token operator">|</span> https:<span class="token comment">//im.qq.com/       | CN      |</span><span class="token operator">|</span>  <span class="token number">2</span> <span class="token operator">|</span> 微博 APP <span class="token operator">|</span> https:<span class="token comment">//weibo.com/       | CN      |</span><span class="token operator">|</span>  <span class="token number">3</span> <span class="token operator">|</span> 淘宝 APP <span class="token operator">|</span> https:<span class="token comment">//www.taobao.com/ | CN      |</span><span class="token operator">+</span><span class="token comment">----+------------+-------------------------+---------+</span><span class="token number">3</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h2 id="在命令提示符中使用-UNION-操作符"><a href="#在命令提示符中使用-UNION-操作符" class="headerlink" title="在命令提示符中使用 UNION 操作符"></a>在命令提示符中使用 UNION 操作符</h2><p>下面的 SQL 语句从 <code>Websites</code> 和 <code>apps</code> 表中选取所有不同的 <code>country</code>（只有不同的值），执行 SQL 输出结果如下：</p><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">mysql<span class="token operator">></span> <span class="token keyword">SELECT</span> country <span class="token keyword">FROM</span> Websites    <span class="token operator">-</span><span class="token operator">></span> <span class="token keyword">UNION</span>    <span class="token operator">-</span><span class="token operator">></span> <span class="token keyword">SELECT</span> country <span class="token keyword">FROM</span> apps    <span class="token operator">-</span><span class="token operator">></span> <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> country<span class="token punctuation">;</span><span class="token operator">+</span><span class="token comment">---------+</span><span class="token operator">|</span> country <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">---------+</span><span class="token operator">|</span>  CN     <span class="token operator">|</span><span class="token operator">|</span>  IND    <span class="token operator">|</span><span class="token operator">|</span>  USA    <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">---------+</span><span class="token number">3</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p><strong>注释</strong>：<code>UNION</code> 不能用于列出两个表中所有的 <code>country</code>。如果一些网站和 APP 来自同一个国家，每个国家只会列出一次。<code>UNION</code> 只会选取不同的值。请使用 <code>UNION ALL</code> 来选取重复的值。</p><h2 id="在命令提示符中使用-UNION-ALL-操作符"><a href="#在命令提示符中使用-UNION-ALL-操作符" class="headerlink" title="在命令提示符中使用 UNION ALL 操作符"></a>在命令提示符中使用 UNION ALL 操作符</h2><p>下面的 SQL 语句使用 <code>UNION ALL</code> 从 <code>Websites</code> 和 <code>apps</code> 表中选取所有的 <code>country</code>（有重复的值）：</p><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">mysql<span class="token operator">></span> <span class="token keyword">SELECT</span> country <span class="token keyword">FROM</span> Websites    <span class="token operator">-</span><span class="token operator">></span> <span class="token keyword">UNION</span> <span class="token keyword">ALL</span>    <span class="token operator">-</span><span class="token operator">></span> <span class="token keyword">SELECT</span> country <span class="token keyword">FROM</span> apps    <span class="token operator">-</span><span class="token operator">></span> <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> country<span class="token punctuation">;</span><span class="token operator">+</span><span class="token comment">---------+</span><span class="token operator">|</span> country <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">---------+</span><span class="token operator">|</span>  CN     <span class="token operator">|</span><span class="token operator">|</span>  CN     <span class="token operator">|</span><span class="token operator">|</span>  CN     <span class="token operator">|</span><span class="token operator">|</span>  CN     <span class="token operator">|</span><span class="token operator">|</span>  IND    <span class="token operator">|</span><span class="token operator">|</span>  USA    <span class="token operator">|</span><span class="token operator">|</span>  USA    <span class="token operator">|</span><span class="token operator">|</span>  USA    <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">---------+</span><span class="token number">8</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.01</span> sec<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p><strong>带有 <code>WHERE</code> 的 <code>UNION ALL</code></strong></p><p>下面的 SQL 语句使用 <code>UNION ALL</code> 从 <code>Websites</code> 和 <code>apps</code> 表中选取所有的中国(CN)的数据（有重复的值）：</p><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">mysql<span class="token operator">></span> <span class="token keyword">SELECT</span> country<span class="token punctuation">,</span> name <span class="token keyword">FROM</span> Websites    <span class="token operator">-</span><span class="token operator">></span> <span class="token keyword">WHERE</span> country<span class="token operator">=</span><span class="token string">'CN'</span>    <span class="token operator">-</span><span class="token operator">></span> <span class="token keyword">UNION</span> <span class="token keyword">ALL</span>    <span class="token operator">-</span><span class="token operator">></span> <span class="token keyword">SELECT</span> country<span class="token punctuation">,</span> app_name <span class="token keyword">FROM</span> apps    <span class="token operator">-</span><span class="token operator">></span> <span class="token keyword">WHERE</span> country<span class="token operator">=</span><span class="token string">'CN'</span>    <span class="token operator">-</span><span class="token operator">></span> <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> country<span class="token punctuation">;</span><span class="token operator">+</span><span class="token comment">---------+------------+</span><span class="token operator">|</span> country <span class="token operator">|</span> name       <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">---------+------------+</span><span class="token operator">|</span> CN      <span class="token operator">|</span> 淘宝       <span class="token operator">|</span><span class="token operator">|</span> CN      <span class="token operator">|</span> QQ APP     <span class="token operator">|</span><span class="token operator">|</span> CN      <span class="token operator">|</span> 微博 APP   <span class="token operator">|</span><span class="token operator">|</span> CN      <span class="token operator">|</span> 微博       <span class="token operator">|</span><span class="token operator">|</span> CN      <span class="token operator">|</span> 淘宝 APP   <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">---------+------------+</span><span class="token number">5</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.03</span> sec<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h1 id="排序语句"><a href="#排序语句" class="headerlink" title="排序语句"></a>排序语句</h1><p>我们知道从 MySQL 表中使用 <code>SELECT</code> 语句来读取数据。</p><p>如果我们需要对读取的数据进行排序，我们就可以使用 MySQL 的 <code>ORDER BY</code> 子句来设定你想按哪个字段哪种方式来进行排序，再返回搜索结果。</p><h2 id="ORDER-BY-子句语法"><a href="#ORDER-BY-子句语法" class="headerlink" title="ORDER BY 子句语法"></a>ORDER BY 子句语法</h2><p>以下是 <code>SELECT</code> 语句使用 <code>ORDER BY</code> 子句将查询数据排序后再返回数据：</p><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> field1<span class="token punctuation">,</span> field2<span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>fieldN <span class="token keyword">FROM</span> table_name1<span class="token punctuation">,</span> table_name2<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token keyword">ORDER</span> <span class="token keyword">BY</span> field1 <span class="token punctuation">[</span><span class="token keyword">ASC</span> <span class="token punctuation">[</span><span class="token keyword">DESC</span><span class="token punctuation">]</span><span class="token punctuation">[</span>默认 <span class="token keyword">ASC</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>field2<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token keyword">ASC</span> <span class="token punctuation">[</span><span class="token keyword">DESC</span><span class="token punctuation">]</span><span class="token punctuation">[</span>默认 <span class="token keyword">ASC</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></p><ul><li>你可以使用任何字段来作为排序的条件，从而返回排序后的查询结果。</li><li>你可以设定多个字段来排序。</li><li>你可以使用 <code>ASC</code> 或 <code>DESC</code> 关键字来设置查询结果是按升序或降序排列。默认情况下，它是按升序排列。</li><li>你可以添加 <code>WHERE...LIKE</code> 子句来设置条件。</li></ul><h2 id="在命令提示符中使用-ORDER-BY-子句"><a href="#在命令提示符中使用-ORDER-BY-子句" class="headerlink" title="在命令提示符中使用 ORDER BY 子句"></a>在命令提示符中使用 ORDER BY 子句</h2><p>以下将在 <code>SELECT</code> 语句中使用 <code>ORDER BY</code> 子句来读取 MySQL 数据表 <code>tbl</code> 中的数据：</p><p>尝试以下实例，结果将按升序及降序排列。</p><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">mysql<span class="token operator">></span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> tbl <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> submission_date <span class="token keyword">ASC</span><span class="token punctuation">;</span><span class="token operator">+</span><span class="token comment">----+-------------+--------+-----------------+</span><span class="token operator">|</span> id <span class="token operator">|</span> title       <span class="token operator">|</span> author <span class="token operator">|</span> submission_date <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">----+-------------+--------+-----------------+</span><span class="token operator">|</span>  <span class="token number">3</span> <span class="token operator">|</span> 学习 C<span class="token operator">+</span><span class="token operator">+</span>    <span class="token operator">|</span> JAVA   <span class="token operator">|</span> <span class="token number">2021</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">01</span>      <span class="token operator">|</span><span class="token operator">|</span>  <span class="token number">4</span> <span class="token operator">|</span> 学习 Python <span class="token operator">|</span> Python <span class="token operator">|</span> <span class="token number">2021</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">01</span>      <span class="token operator">|</span><span class="token operator">|</span>  <span class="token number">1</span> <span class="token operator">|</span> 学习 PHP    <span class="token operator">|</span> PHP    <span class="token operator">|</span> <span class="token number">2021</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">12</span>      <span class="token operator">|</span><span class="token operator">|</span>  <span class="token number">2</span> <span class="token operator">|</span> 学习 MySQL  <span class="token operator">|</span> MySQL  <span class="token operator">|</span> <span class="token number">2021</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">12</span>      <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">----+-------------+--------+-----------------+</span><span class="token number">4</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>mysql<span class="token operator">></span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> tbl <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> submission_date <span class="token keyword">DESC</span><span class="token punctuation">;</span><span class="token operator">+</span><span class="token comment">----+-------------+--------+-----------------+</span><span class="token operator">|</span> id <span class="token operator">|</span> title       <span class="token operator">|</span> author <span class="token operator">|</span> submission_date <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">----+-------------+--------+-----------------+</span><span class="token operator">|</span>  <span class="token number">1</span> <span class="token operator">|</span> 学习 PHP    <span class="token operator">|</span> PHP    <span class="token operator">|</span> <span class="token number">2021</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">12</span>      <span class="token operator">|</span><span class="token operator">|</span>  <span class="token number">2</span> <span class="token operator">|</span> 学习 MySQL  <span class="token operator">|</span> MySQL  <span class="token operator">|</span> <span class="token number">2021</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">12</span>      <span class="token operator">|</span><span class="token operator">|</span>  <span class="token number">3</span> <span class="token operator">|</span> 学习 C<span class="token operator">+</span><span class="token operator">+</span>    <span class="token operator">|</span> JAVA   <span class="token operator">|</span> <span class="token number">2021</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">01</span>      <span class="token operator">|</span><span class="token operator">|</span>  <span class="token number">4</span> <span class="token operator">|</span> 学习 Python <span class="token operator">|</span> Python <span class="token operator">|</span> <span class="token number">2021</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">01</span>      <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">----+-------------+--------+-----------------+</span><span class="token number">4</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h1 id="分组语句"><a href="#分组语句" class="headerlink" title="分组语句"></a>分组语句</h1><p>GROUP BY 语句根据一个或多个列对结果集进行分组。</p><h2 id="GROUP-BY-子句语法"><a href="#GROUP-BY-子句语法" class="headerlink" title="GROUP BY 子句语法"></a>GROUP BY 子句语法</h2><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> column_name<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>column_name<span class="token punctuation">)</span><span class="token keyword">FROM</span> table_name<span class="token keyword">WHERE</span> column_name operator <span class="token keyword">value</span><span class="token keyword">GROUP</span> <span class="token keyword">BY</span> column_name<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></p><p>本章节实例使用到了以下表结构及数据，使用前我们可以先将以下数据导入数据库中。</p><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">DROP</span> <span class="token keyword">TABLE</span> <span class="token keyword">IF</span> <span class="token keyword">EXISTS</span> <span class="token punctuation">`</span>employee_tbl<span class="token punctuation">`</span><span class="token punctuation">;</span><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token punctuation">`</span>employee_tbl<span class="token punctuation">`</span> <span class="token punctuation">(</span>  <span class="token punctuation">`</span>id<span class="token punctuation">`</span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>  <span class="token punctuation">`</span>name<span class="token punctuation">`</span> <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token string">''</span><span class="token punctuation">,</span>  <span class="token punctuation">`</span><span class="token keyword">date</span><span class="token punctuation">`</span> <span class="token keyword">datetime</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>  <span class="token punctuation">`</span>singin<span class="token punctuation">`</span> <span class="token keyword">tinyint</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token string">'0'</span> <span class="token keyword">COMMENT</span> <span class="token string">'登录次数'</span><span class="token punctuation">,</span>  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>id<span class="token punctuation">`</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8<span class="token punctuation">;</span><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token punctuation">`</span>employee_tbl<span class="token punctuation">`</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'1'</span><span class="token punctuation">,</span> <span class="token string">'小明'</span><span class="token punctuation">,</span> <span class="token string">'2016-04-22 15:25:33'</span><span class="token punctuation">,</span> <span class="token string">'1'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">'2'</span><span class="token punctuation">,</span> <span class="token string">'小王'</span><span class="token punctuation">,</span> <span class="token string">'2016-04-20 15:25:47'</span><span class="token punctuation">,</span> <span class="token string">'3'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">'3'</span><span class="token punctuation">,</span> <span class="token string">'小丽'</span><span class="token punctuation">,</span> <span class="token string">'2016-04-19 15:26:02'</span><span class="token punctuation">,</span> <span class="token string">'2'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">'4'</span><span class="token punctuation">,</span> <span class="token string">'小王'</span><span class="token punctuation">,</span> <span class="token string">'2016-04-07 15:26:14'</span><span class="token punctuation">,</span> <span class="token string">'4'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">'5'</span><span class="token punctuation">,</span> <span class="token string">'小明'</span><span class="token punctuation">,</span> <span class="token string">'2016-04-11 15:26:40'</span><span class="token punctuation">,</span> <span class="token string">'4'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">'6'</span><span class="token punctuation">,</span> <span class="token string">'小明'</span><span class="token punctuation">,</span> <span class="token string">'2016-04-04 15:26:54'</span><span class="token punctuation">,</span> <span class="token string">'2'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p>导入成功后，执行以下 SQL 语句：</p><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">mysql<span class="token operator">></span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> employee_tbl<span class="token punctuation">;</span><span class="token operator">+</span><span class="token comment">----+------+---------------------+--------+</span><span class="token operator">|</span> id <span class="token operator">|</span> name <span class="token operator">|</span> <span class="token keyword">date</span>                <span class="token operator">|</span> singin <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">----+------+---------------------+--------+</span><span class="token operator">|</span>  <span class="token number">1</span> <span class="token operator">|</span> 小明 <span class="token operator">|</span> <span class="token number">2016</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">22</span> <span class="token number">15</span>:<span class="token number">25</span>:<span class="token number">33</span> <span class="token operator">|</span>      <span class="token number">1</span> <span class="token operator">|</span><span class="token operator">|</span>  <span class="token number">2</span> <span class="token operator">|</span> 小王 <span class="token operator">|</span> <span class="token number">2016</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">20</span> <span class="token number">15</span>:<span class="token number">25</span>:<span class="token number">47</span> <span class="token operator">|</span>      <span class="token number">3</span> <span class="token operator">|</span><span class="token operator">|</span>  <span class="token number">3</span> <span class="token operator">|</span> 小丽 <span class="token operator">|</span> <span class="token number">2016</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">19</span> <span class="token number">15</span>:<span class="token number">26</span>:<span class="token number">02</span> <span class="token operator">|</span>      <span class="token number">2</span> <span class="token operator">|</span><span class="token operator">|</span>  <span class="token number">4</span> <span class="token operator">|</span> 小王 <span class="token operator">|</span> <span class="token number">2016</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">07</span> <span class="token number">15</span>:<span class="token number">26</span>:<span class="token number">14</span> <span class="token operator">|</span>      <span class="token number">4</span> <span class="token operator">|</span><span class="token operator">|</span>  <span class="token number">5</span> <span class="token operator">|</span> 小明 <span class="token operator">|</span> <span class="token number">2016</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">11</span> <span class="token number">15</span>:<span class="token number">26</span>:<span class="token number">40</span> <span class="token operator">|</span>      <span class="token number">4</span> <span class="token operator">|</span><span class="token operator">|</span>  <span class="token number">6</span> <span class="token operator">|</span> 小明 <span class="token operator">|</span> <span class="token number">2016</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">04</span> <span class="token number">15</span>:<span class="token number">26</span>:<span class="token number">54</span> <span class="token operator">|</span>      <span class="token number">2</span> <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">----+------+---------------------+--------+</span><span class="token number">6</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p>接下来我们使用 <code>GROUP BY</code> 语句 将数据表按名字进行分组，并统计每个人有多少条记录：</p><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">mysql<span class="token operator">></span> <span class="token keyword">SELECT</span> name<span class="token punctuation">,</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">FROM</span> employee_tbl <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> name<span class="token punctuation">;</span><span class="token operator">+</span><span class="token comment">------+----------+</span><span class="token operator">|</span> name <span class="token operator">|</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">------+----------+</span><span class="token operator">|</span> 小丽 <span class="token operator">|</span>        <span class="token number">1</span> <span class="token operator">|</span><span class="token operator">|</span> 小明 <span class="token operator">|</span>        <span class="token number">3</span> <span class="token operator">|</span><span class="token operator">|</span> 小王 <span class="token operator">|</span>        <span class="token number">2</span> <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">------+----------+</span><span class="token number">3</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.01</span> sec<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h2 id="使用-WITH-ROLLUP"><a href="#使用-WITH-ROLLUP" class="headerlink" title="使用 WITH ROLLUP"></a>使用 WITH ROLLUP</h2><p><code>WITH ROLLUP</code> 可以实现在分组统计数据基础上再进行相同的统计（SUM, AVG, COUNT…）。</p><p>例如我们将以上的数据表按名字进行分组，再统计每个人登录的次数：</p><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">mysql<span class="token operator">></span> <span class="token keyword">SELECT</span> name<span class="token punctuation">,</span> <span class="token function">SUM</span><span class="token punctuation">(</span>singin<span class="token punctuation">)</span> <span class="token keyword">AS</span> singin_count <span class="token keyword">FROM</span> employee_tbl <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> name <span class="token keyword">WITH ROLLUP</span><span class="token punctuation">;</span><span class="token operator">+</span><span class="token comment">------+--------------+</span><span class="token operator">|</span> name <span class="token operator">|</span> singin_count <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">------+--------------+</span><span class="token operator">|</span> 小丽 <span class="token operator">|</span>            <span class="token number">2</span> <span class="token operator">|</span><span class="token operator">|</span> 小明 <span class="token operator">|</span>            <span class="token number">7</span> <span class="token operator">|</span><span class="token operator">|</span> 小王 <span class="token operator">|</span>            <span class="token number">7</span> <span class="token operator">|</span><span class="token operator">|</span> <span class="token boolean">NULL</span> <span class="token operator">|</span>           <span class="token number">16</span> <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">------+--------------+</span><span class="token number">4</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p>其中记录 <code>NULL</code> 表示所有人的登录次数。</p><p>我们可以使用 <code>COALESCE</code> 来设置一个可以取代 <code>NUll</code> 的名称</p><p> <strong> COALESCE 语法：</strong></p><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token keyword">COALESCE</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c<span class="token punctuation">)</span> <span class="token keyword">FROM</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><p>参数说明：如果 <code>a == NULL</code>，则选择 <code>b</code>；如果<code>b == NULL</code>，则选择 <code>c</code>；如果 <code>a != NULL</code>，则选择<code>a</code>；如果 <code>a</code> <code>b</code> <code>c</code> 都为 <code>NULL</code> ，则返回为 <code>NULL</code>（没意义）。</p><p>以下实例中如果名字为空我们使用总数代替：</p><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">mysql<span class="token operator">></span> <span class="token keyword">SELECT</span> <span class="token keyword">COALESCE</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> <span class="token string">'总数'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">SUM</span><span class="token punctuation">(</span>singin<span class="token punctuation">)</span> <span class="token keyword">AS</span> singin_count <span class="token keyword">FROM</span> employee_tbl <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> name <span class="token keyword">WITH ROLLUP</span><span class="token punctuation">;</span><span class="token operator">+</span><span class="token comment">------------------------+--------------+</span><span class="token operator">|</span> <span class="token keyword">COALESCE</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> <span class="token string">'总数'</span><span class="token punctuation">)</span> <span class="token operator">|</span> singin_count <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">------------------------+--------------+</span><span class="token operator">|</span> 小丽                   <span class="token operator">|</span>            <span class="token number">2</span> <span class="token operator">|</span><span class="token operator">|</span> 小明                   <span class="token operator">|</span>            <span class="token number">7</span> <span class="token operator">|</span><span class="token operator">|</span> 小王                   <span class="token operator">|</span>            <span class="token number">7</span> <span class="token operator">|</span><span class="token operator">|</span> 总数                   <span class="token operator">|</span>           <span class="token number">16</span> <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">------------------------+--------------+</span><span class="token number">4</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h1 id="JOIN"><a href="#JOIN" class="headerlink" title="JOIN"></a>JOIN</h1><p>在前几章节中，我们已经学会了如何在一张表中读取数据，这是相对简单的，但是在真正的应用中经常需要从多个数据表中读取数据。</p><p>本章节将向大家介绍如何使用 MySQL 的 <code>JOIN</code> 在两个或多个表中查询数据。</p><p>你可以在 <code>SELECT</code>、<code>UPDATE</code> 和 <code>DELETE</code> 语句中使用 MySQL 的 <code>JOIN</code> 来联合多表查询。</p><p>JOIN 按照功能大致分为如下三类：</p><ul><li><strong>INNER JOIN（内连接或等值连接）</strong>：获取两个表中字段匹配关系的记录。</li><li><strong>LEFT JOIN（左连接）</strong>：获取左表所有记录，即使右表没有对应匹配的记录。</li><li><strong>RIGHT JOIN（右连接）</strong>： 与 <code>LEFT JOIN</code> 相反，用于获取右表所有记录，即使左表没有对应匹配的记录。</li></ul><h2 id="INNER-JOIN"><a href="#INNER-JOIN" class="headerlink" title="INNER JOIN"></a>INNER JOIN</h2><p>我们在 <code>testDB</code> 数据库中有两张表 <code>tcount_tbl</code> 和 <code>tbl</code>。两张数据表数据如下：</p><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">mysql<span class="token operator">></span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> tcount_tbl<span class="token punctuation">;</span><span class="token operator">+</span><span class="token comment">--------+-------+</span><span class="token operator">|</span> author <span class="token operator">|</span> count <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">--------+-------+</span><span class="token operator">|</span> JAVA   <span class="token operator">|</span>    <span class="token number">10</span> <span class="token operator">|</span><span class="token operator">|</span> MySQL  <span class="token operator">|</span>    <span class="token number">20</span> <span class="token operator">|</span><span class="token operator">|</span> C<span class="token operator">+</span><span class="token operator">+</span>    <span class="token operator">|</span>    <span class="token number">30</span> <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">--------+-------+</span><span class="token number">3</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span> mysql<span class="token operator">></span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> tbl<span class="token punctuation">;</span><span class="token operator">+</span><span class="token comment">----+-------------+--------+-----------------+</span><span class="token operator">|</span> id <span class="token operator">|</span> title       <span class="token operator">|</span> author <span class="token operator">|</span> submission_date <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">----+-------------+--------+-----------------+</span><span class="token operator">|</span>  <span class="token number">1</span> <span class="token operator">|</span> 学习 PHP    <span class="token operator">|</span> PHP    <span class="token operator">|</span> <span class="token number">2021</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">12</span>      <span class="token operator">|</span><span class="token operator">|</span>  <span class="token number">2</span> <span class="token operator">|</span> 学习 MySQL  <span class="token operator">|</span> MySQL  <span class="token operator">|</span> <span class="token number">2021</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">12</span>      <span class="token operator">|</span><span class="token operator">|</span>  <span class="token number">3</span> <span class="token operator">|</span> 学习 C<span class="token operator">+</span><span class="token operator">+</span>    <span class="token operator">|</span> JAVA   <span class="token operator">|</span> <span class="token number">2021</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">01</span>      <span class="token operator">|</span><span class="token operator">|</span>  <span class="token number">4</span> <span class="token operator">|</span> 学习 Python <span class="token operator">|</span> Python <span class="token operator">|</span> <span class="token number">2021</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">01</span>      <span class="token operator">|</span><span class="token operator">|</span>  <span class="token number">5</span> <span class="token operator">|</span> MySQL 教程  <span class="token operator">|</span> MySQL  <span class="token operator">|</span> <span class="token number">2021</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">12</span>      <span class="token operator">|</span><span class="token operator">|</span>  <span class="token number">6</span> <span class="token operator">|</span> JAVA 教程   <span class="token operator">|</span> JAVA   <span class="token operator">|</span> <span class="token number">2021</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">12</span>      <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">----+-------------+--------+-----------------+</span><span class="token number">6</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p>接下来我们就使用 <code>MySQL</code> 的<code>INNER JOIN</code> (也可以省略 <code>INNER</code> 使用 <code>JOIN</code>，效果一样)来连接以上两张表来读取 <code>tbl</code> 表中所有 <code>author</code> 字段在 <code>tcount_tbl</code> 表对应的 <code>count</code> 字段值：</p><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">mysql<span class="token operator">></span>  <span class="token keyword">SELECT</span> a<span class="token punctuation">.</span>id<span class="token punctuation">,</span> a<span class="token punctuation">.</span>author<span class="token punctuation">,</span> b<span class="token punctuation">.</span>count <span class="token keyword">FROM</span> tbl a <span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> tcount_tbl b <span class="token keyword">ON</span> a<span class="token punctuation">.</span>author <span class="token operator">=</span> b<span class="token punctuation">.</span>author<span class="token punctuation">;</span><span class="token operator">+</span><span class="token comment">----+--------+-------+</span><span class="token operator">|</span> id <span class="token operator">|</span> author <span class="token operator">|</span> count <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">----+--------+-------+</span><span class="token operator">|</span>  <span class="token number">2</span> <span class="token operator">|</span> MySQL  <span class="token operator">|</span>    <span class="token number">20</span> <span class="token operator">|</span><span class="token operator">|</span>  <span class="token number">3</span> <span class="token operator">|</span> JAVA   <span class="token operator">|</span>    <span class="token number">10</span> <span class="token operator">|</span><span class="token operator">|</span>  <span class="token number">5</span> <span class="token operator">|</span> MySQL  <span class="token operator">|</span>    <span class="token number">20</span> <span class="token operator">|</span><span class="token operator">|</span>  <span class="token number">6</span> <span class="token operator">|</span> JAVA   <span class="token operator">|</span>    <span class="token number">10</span> <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">----+--------+-------+</span><span class="token number">4</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p>以上 SQL 语句等价于以下 <code>WHERE</code> 子句：</p><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">mysql<span class="token operator">></span> <span class="token keyword">SELECT</span> a<span class="token punctuation">.</span>id<span class="token punctuation">,</span> a<span class="token punctuation">.</span>author<span class="token punctuation">,</span> b<span class="token punctuation">.</span>count <span class="token keyword">FROM</span> tbl a<span class="token punctuation">,</span> tcount_tbl b <span class="token keyword">WHERE</span> a<span class="token punctuation">.</span>author <span class="token operator">=</span> b<span class="token punctuation">.</span>author<span class="token punctuation">;</span><span class="token operator">+</span><span class="token comment">----+--------+-------+</span><span class="token operator">|</span> id <span class="token operator">|</span> author <span class="token operator">|</span> count <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">----+--------+-------+</span><span class="token operator">|</span>  <span class="token number">2</span> <span class="token operator">|</span> MySQL  <span class="token operator">|</span>    <span class="token number">20</span> <span class="token operator">|</span><span class="token operator">|</span>  <span class="token number">3</span> <span class="token operator">|</span> JAVA   <span class="token operator">|</span>    <span class="token number">10</span> <span class="token operator">|</span><span class="token operator">|</span>  <span class="token number">5</span> <span class="token operator">|</span> MySQL  <span class="token operator">|</span>    <span class="token number">20</span> <span class="token operator">|</span><span class="token operator">|</span>  <span class="token number">6</span> <span class="token operator">|</span> JAVA   <span class="token operator">|</span>    <span class="token number">10</span> <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">----+--------+-------+</span><span class="token number">4</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h2 id="LEFT-JOIN"><a href="#LEFT-JOIN" class="headerlink" title="LEFT JOIN"></a>LEFT JOIN</h2><p>MySQL <code>LEFT JOIN</code> 与 <code>JOIN</code> 有所不同。 <code>LEFT JOIN</code> 会读取左边数据表的全部数据，即便右边表无对应数据。</p><p>尝试以下实例，以 <code>tbl</code> 为左表，<code>tcount_tbl</code> 为右表，理解 <code>LEFT JOIN</code> 的应用：</p><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">mysql<span class="token operator">></span> <span class="token keyword">SELECT</span> a<span class="token punctuation">.</span>id<span class="token punctuation">,</span> a<span class="token punctuation">.</span>author<span class="token punctuation">,</span> b<span class="token punctuation">.</span>count <span class="token keyword">FROM</span> tbl a <span class="token keyword">LEFT</span> <span class="token keyword">JOIN</span> tcount_tbl b <span class="token keyword">ON</span> a<span class="token punctuation">.</span>author <span class="token operator">=</span> b<span class="token punctuation">.</span>author<span class="token punctuation">;</span><span class="token operator">+</span><span class="token comment">----+--------+-------+</span><span class="token operator">|</span> id <span class="token operator">|</span> author <span class="token operator">|</span> count <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">----+--------+-------+</span><span class="token operator">|</span>  <span class="token number">3</span> <span class="token operator">|</span> JAVA   <span class="token operator">|</span>    <span class="token number">10</span> <span class="token operator">|</span><span class="token operator">|</span>  <span class="token number">6</span> <span class="token operator">|</span> JAVA   <span class="token operator">|</span>    <span class="token number">10</span> <span class="token operator">|</span><span class="token operator">|</span>  <span class="token number">2</span> <span class="token operator">|</span> MySQL  <span class="token operator">|</span>    <span class="token number">20</span> <span class="token operator">|</span><span class="token operator">|</span>  <span class="token number">5</span> <span class="token operator">|</span> MySQL  <span class="token operator">|</span>    <span class="token number">20</span> <span class="token operator">|</span><span class="token operator">|</span>  <span class="token number">1</span> <span class="token operator">|</span> PHP    <span class="token operator">|</span>  <span class="token boolean">NULL</span> <span class="token operator">|</span><span class="token operator">|</span>  <span class="token number">4</span> <span class="token operator">|</span> Python <span class="token operator">|</span>  <span class="token boolean">NULL</span> <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">----+--------+-------+</span><span class="token number">6</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p>以上实例中使用了 <code>LEFT JOIN</code>，该语句会读取左边的数据表 <code>tbl</code> 的所有选取的字段数据，即便在右侧表 <code>tcount_tbl</code> 中 没有对应的 <code>author</code> 字段值。</p><h2 id="RIGHT-JOIN"><a href="#RIGHT-JOIN" class="headerlink" title="RIGHT JOIN"></a>RIGHT JOIN</h2><p>MySQL <code>RIGHT JOIN</code> 会读取右边数据表的全部数据，即便左边边表无对应数据。</p><p>尝试以下实例，以 <code>tbl</code> 为左表，<code>tcount_tbl</code> 为右表，理解 <code>RIGHT JOIN</code> 的应用：</p><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">mysql<span class="token operator">></span> <span class="token keyword">SELECT</span> a<span class="token punctuation">.</span>id<span class="token punctuation">,</span> a<span class="token punctuation">.</span>author<span class="token punctuation">,</span> b<span class="token punctuation">.</span>count <span class="token keyword">FROM</span> tbl a <span class="token keyword">RIGHT</span> <span class="token keyword">JOIN</span> tcount_tbl b <span class="token keyword">ON</span> a<span class="token punctuation">.</span>author <span class="token operator">=</span> b<span class="token punctuation">.</span>author<span class="token punctuation">;</span><span class="token operator">+</span><span class="token comment">------+--------+-------+</span><span class="token operator">|</span> id   <span class="token operator">|</span> author <span class="token operator">|</span> count <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">------+--------+-------+</span><span class="token operator">|</span>    <span class="token number">2</span> <span class="token operator">|</span> MySQL  <span class="token operator">|</span>    <span class="token number">20</span> <span class="token operator">|</span><span class="token operator">|</span>    <span class="token number">3</span> <span class="token operator">|</span> JAVA   <span class="token operator">|</span>    <span class="token number">10</span> <span class="token operator">|</span><span class="token operator">|</span>    <span class="token number">5</span> <span class="token operator">|</span> MySQL  <span class="token operator">|</span>    <span class="token number">20</span> <span class="token operator">|</span><span class="token operator">|</span>    <span class="token number">6</span> <span class="token operator">|</span> JAVA   <span class="token operator">|</span>    <span class="token number">10</span> <span class="token operator">|</span><span class="token operator">|</span> <span class="token boolean">NULL</span> <span class="token operator">|</span> <span class="token boolean">NULL</span>   <span class="token operator">|</span>    <span class="token number">30</span> <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">------+--------+-------+</span><span class="token number">5</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p>以上实例中使用了 <code>RIGHT JOIN</code>，该语句会读取右边的数据表 <code>tcount_tbl</code> 的所有选取的字段数据，即便在左侧表 <code>tbl</code> 中没有对应的 <code>author</code> 字段值。</p><h1 id="NULL-值处理"><a href="#NULL-值处理" class="headerlink" title="NULL 值处理"></a>NULL 值处理</h1><p>我们已经知道 MySQL 使用 <code>SELECT</code> 命令及 <code>WHERE</code> 子句来读取数据表中的数据,但是当提供的查询条件字段为 NULL 时，该命令可能就无法正常工作。</p><h2 id="NULL-值运算符"><a href="#NULL-值运算符" class="headerlink" title="NULL 值运算符"></a>NULL 值运算符</h2><p>为了处理这种情况，MySQL 提供了三大运算符:</p><ul><li><strong>IS NULL</strong>: 当列的值是 <code>NULL</code>，此运算符返回 <code>true</code>。</li><li><strong>IS NOT NULL</strong>: 当列的值不为 <code>NULL</code>, 运算符返回 <code>true</code>。</li><li><strong>&lt;=&gt;</strong>: 比较操作符（不同于 <code>=</code> 运算符），当比较的两个值相等或者都为 <code>NULL</code> 时返回 <code>true</code>。</li></ul><p>关于 <code>NULL</code> 的条件比较运算是比较特殊的。你不能使用 <code>= NULL</code> 或 <code>!= NULL</code> 在列中查找 <code>NULL</code> 值 。</p><p>在 MySQL 中，<code>NULL</code> 值与任何其它值的比较（即使是 <code>NULL</code>）永远返回 <code>NULL</code>，即 <code>NULL = NULL</code> 返回 <code>NULL</code>。</p><p>MySQL 中处理 <code>NULL</code> 使用 <code>IS NULL</code> 和 <code>IS NOT NULL</code> 运算符。</p><p><strong>注意：</strong></p><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token operator">*</span><span class="token punctuation">,</span> columnName1 <span class="token operator">+</span> IFNULL<span class="token punctuation">(</span>columnName2<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">FROM</span> tableName<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><p><code>columnName1</code>，<code>columnName2</code> 为 <code>int</code> 型，当 <code>columnName2</code> 中，有值为 <code>NULL</code> 时，<code>columnName1 + columnName2 = NULL</code>，<code>IFNULL(columnName2, 0)</code> 把 <code>columnName2</code> 中 <code>NULL</code> 值转为 <code>0</code>。</p><h2 id="在命令提示符中使用-NULL-值"><a href="#在命令提示符中使用-NULL-值" class="headerlink" title="在命令提示符中使用 NULL 值"></a>在命令提示符中使用 NULL 值</h2><p>以下实例中假设数据库 <code>TestDB</code> 中的表 <code>tbl</code> 含有两列 <code>author</code> 和 <code>count</code>, <code>count</code> 中设置插入 <code>NULL</code> 值。</p><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">mysql<span class="token operator">></span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> tbl<span class="token punctuation">;</span><span class="token operator">+</span><span class="token comment">---------------+--------------+</span><span class="token operator">|</span> author <span class="token operator">|</span> count <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">---------------+--------------+</span><span class="token operator">|</span> TestDB        <span class="token operator">|</span> <span class="token boolean">NULL</span>         <span class="token operator">|</span><span class="token operator">|</span> Google        <span class="token operator">|</span> <span class="token boolean">NULL</span>         <span class="token operator">|</span><span class="token operator">|</span> FK            <span class="token operator">|</span> <span class="token number">20</span>           <span class="token operator">|</span><span class="token operator">|</span> Baidu         <span class="token operator">|</span> <span class="token number">20</span>           <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">---------------+--------------+</span><span class="token number">4</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.01</span> sec<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p>以下实例中你可以看到 <code>=</code> 和 <code>!=</code> 运算符是不起作用的：</p><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">mysql<span class="token operator">></span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> tbl <span class="token keyword">WHERE</span> count <span class="token operator">=</span> <span class="token boolean">NULL</span><span class="token punctuation">;</span>Empty <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>mysql<span class="token operator">></span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> tbl <span class="token keyword">WHERE</span> count <span class="token operator">!=</span> <span class="token boolean">NULL</span><span class="token punctuation">;</span>Empty <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.01</span> sec<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></p><p>查找数据表中 <code>tbl</code> 列是否为 <code>NULL</code>，必须使用 <code>IS NULL</code> 和 <code>IS NOT NULL</code>，如下实例：</p><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">mysql<span class="token operator">></span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> tbl <span class="token keyword">WHERE</span> count <span class="token operator">IS</span> <span class="token boolean">NULL</span><span class="token punctuation">;</span><span class="token operator">+</span><span class="token comment">--------+-------+</span><span class="token operator">|</span> author <span class="token operator">|</span> count <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">--------+-------+</span><span class="token operator">|</span> TestDB <span class="token operator">|</span> <span class="token boolean">NULL</span>  <span class="token operator">|</span><span class="token operator">|</span> Google <span class="token operator">|</span> <span class="token boolean">NULL</span>  <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">---- ---+-------+</span><span class="token number">2</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.01</span> sec<span class="token punctuation">)</span>mysql<span class="token operator">></span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> tbl <span class="token keyword">WHERE</span> count <span class="token operator">IS</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">;</span><span class="token operator">+</span><span class="token comment">--------+-------+</span><span class="token operator">|</span> author <span class="token operator">|</span> count <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">--------+-------+</span><span class="token operator">|</span> FK     <span class="token operator">|</span> <span class="token number">20</span>    <span class="token operator">|</span><span class="token operator">|</span> Baidu  <span class="token operator">|</span> <span class="token number">20</span>    <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">--------+-------+</span><span class="token number">2</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.01</span> sec<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h1 id="正则表达式"><a href="#正则表达式" class="headerlink" title="正则表达式"></a>正则表达式</h1><p>在前面的章节我们已经了解到 MySQL 可以通过 <code>LIKE</code> 子句来进行模糊匹配。</p><p>MySQL 同样也支持其他正则表达式的匹配， MySQL 中使用 <code>REGEXP</code> 操作符来进行正则表达式匹配。</p><p>下表中的正则模式可应用于 <code>REGEXP</code> 操作符中。</p><div class="table-container"><table><thead><tr><th style="text-align:center">模式</th><th style="text-align:center">描述</th></tr></thead><tbody><tr><td style="text-align:center">^</td><td style="text-align:center">匹配输入字符串的开始位置。<br>如果设置了 RegExp 对象的 Multiline 属性，<code>^</code> 也匹配 <code>\n</code> 或 <code>\r</code> 之后的位置。</td></tr><tr><td style="text-align:center">$</td><td style="text-align:center">匹配输入字符串的结束位置。<br>如果设置了 RegExp 对象的 Multiline 属性，<code>$</code> 也匹配 <code>\n</code> 或 <code>\r</code> 之前的位置。</td></tr><tr><td style="text-align:center">.</td><td style="text-align:center">匹配除 <code>\n</code> 之外的任何单个字符。<br>要匹配包括 <code>\n</code> 在内的任何字符，请使用像 <code>[.\n]</code> 的模式。</td></tr><tr><td style="text-align:center">[...]</td><td style="text-align:center">字符集合。匹配所包含的任意一个字符。<br>例如，<code>[abc]</code> 可以匹配 <code>plain</code> 中的 <code>a</code>。</td></tr><tr><td style="text-align:center"><html>[^...]</html></td><td style="text-align:center">负值字符集合。匹配未包含的任意字符。<br>例如，<code>[\^abc]</code> 可以匹配 <code>plain</code> 中的<code>p</code>。</td></tr><tr><td style="text-align:center">p1&vert;p2&vert;p3</td><td style="text-align:center">匹配 p1 或 p2 或 p3。<br>例如，<code>z</code>&vert;<code>food</code> 能匹配 <code>z</code> 或 <code>food</code>。<code>(z</code>&vert;<code>f)ood</code> 则匹配 <code>zood</code> 或 <code>food</code>。</td></tr><tr><td style="text-align:center">*</td><td style="text-align:center">匹配前面的子表达式零次或多次。<br>例如，<code>zo*</code> 能匹配 <code>z</code> 以及 <code>zoo</code>。<code>*</code> 等价于{0,}。</td></tr><tr><td style="text-align:center">+</td><td style="text-align:center">匹配前面的子表达式一次或多次。<br>例如，<code>zo+</code> 能匹配 <code>zo</code> 以及 <code>zoo</code>，但不能匹配 <code>z</code>。<code>+</code> 等价于 <code>&#123;1,&#125;</code>。</td></tr><tr><td style="text-align:center">{n}</td><td style="text-align:center"><code>n</code> 是一个非负整数。匹配确定的 <code>n</code> 次。<br>例如，<code>o&#123;2&#125;</code> 不能匹配 <code>Bob</code> 中的 <code>o</code>，但是能匹配 <code>food</code> 中的两个 <code>o</code>。</td></tr><tr><td style="text-align:center">{n, m}</td><td style="text-align:center"><code>m</code> 和 <code>n</code> 均为非负整数，其中 <code>n &lt;= m</code>。<br>最少匹配 <code>n</code> 次且最多匹配 <code>m</code> 次。</td></tr></tbody></table></div><p>了解以上的正则需求后，我们就可以根据自己的需求来编写带有正则表达式的 SQL 语句。以下我们将列出几个小实例（表名：<code>person_tbl</code>）来加深我们的理解：</p><p>查找 <code>name</code> 字段中以 <code>st</code> 为开头的所有数据：</p><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">mysql<span class="token operator">></span> <span class="token keyword">SELECT</span> name <span class="token keyword">FROM</span> person_tbl <span class="token keyword">WHERE</span> name <span class="token operator">REGEXP</span> <span class="token string">'^st'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><p>查找 <code>name</code> 字段中以 <code>ok</code> 为结尾的所有数据：</p><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">mysql<span class="token operator">></span> <span class="token keyword">SELECT</span> name <span class="token keyword">FROM</span> person_tbl <span class="token keyword">WHERE</span> name <span class="token operator">REGEXP</span> <span class="token string">'ok$'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><p>查找 <code>name</code> 字段中包含 <code>mar</code> 字符串的所有数据：</p><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">mysql<span class="token operator">></span> <span class="token keyword">SELECT</span> name <span class="token keyword">FROM</span> person_tbl <span class="token keyword">WHERE</span> name <span class="token operator">REGEXP</span> <span class="token string">'mar'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><p>查找 <code>name</code> 字段中以元音字符开头或以 <code>ok</code> 字符串结尾的所有数据：</p><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">mysql<span class="token operator">></span> <span class="token keyword">SELECT</span> name <span class="token keyword">FROM</span> person_tbl <span class="token keyword">WHERE</span> name <span class="token operator">REGEXP</span> <span class="token string">'^[aeiou]|ok$'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><h1 id="ALTER-命令"><a href="#ALTER-命令" class="headerlink" title="ALTER 命令"></a>ALTER 命令</h1><p>当我们需要修改数据表名或者修改数据表字段时，就需要使用到 <code>ALTER</code> 命令。</p><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">mysql<span class="token operator">></span> <span class="token keyword">SHOW</span> <span class="token keyword">COLUMNS</span> <span class="token keyword">FROM</span> testalter_tbl<span class="token punctuation">;</span><span class="token operator">+</span><span class="token comment">-------+---------+------+-----+---------+-------+</span><span class="token operator">|</span> Field <span class="token operator">|</span> <span class="token keyword">Type</span>    <span class="token operator">|</span> <span class="token boolean">Null</span> <span class="token operator">|</span> <span class="token keyword">Key</span> <span class="token operator">|</span> <span class="token keyword">Default</span> <span class="token operator">|</span> Extra <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">-------+---------+------+-----+---------+-------+</span><span class="token operator">|</span> i     <span class="token operator">|</span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">|</span> YES  <span class="token operator">|</span>     <span class="token operator">|</span> <span class="token boolean">NULL</span>    <span class="token operator">|</span>       <span class="token operator">|</span><span class="token operator">|</span> c     <span class="token operator">|</span> <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">|</span> YES  <span class="token operator">|</span>     <span class="token operator">|</span> <span class="token boolean">NULL</span>    <span class="token operator">|</span>       <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">-------+---------+------+-----+---------+-------+</span><span class="token number">2</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h2 id="删除，添加或修改表字段"><a href="#删除，添加或修改表字段" class="headerlink" title="删除，添加或修改表字段"></a>删除，添加或修改表字段</h2><p>如下命令使用了 <code>ALTER</code> 命令及 <code>DROP</code> 子句来删除以上创建表的 <code>i</code> 字段：</p><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">mysql<span class="token operator">></span> <span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> testalter_tbl  <span class="token keyword">DROP</span> i<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><p>如果数据表中只剩余一个字段则无法使用 <code>DROP</code> 来删除字段。</p><p>MySQL 中使用 <code>ADD</code> 子句来向数据表中添加列，如下实例在表 <code>testalter_tbl</code> 中添加 <code>i</code> 字段，并定义数据类型:</p><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">mysql<span class="token operator">></span> <span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> testalter_tbl <span class="token keyword">ADD</span> i <span class="token keyword">INT</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><p>执行以上命令后，<code>i</code> 字段会自动添加到数据表字段的末尾。</p><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">mysql<span class="token operator">></span> <span class="token keyword">SHOW</span> <span class="token keyword">COLUMNS</span> <span class="token keyword">FROM</span> testalter_tbl<span class="token punctuation">;</span><span class="token operator">+</span><span class="token comment">-------+---------+------+-----+---------+-------+</span><span class="token operator">|</span> Field <span class="token operator">|</span> <span class="token keyword">Type</span>    <span class="token operator">|</span> <span class="token boolean">Null</span> <span class="token operator">|</span> <span class="token keyword">Key</span> <span class="token operator">|</span> <span class="token keyword">Default</span> <span class="token operator">|</span> Extra <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">-------+---------+------+-----+---------+-------+</span><span class="token operator">|</span> c     <span class="token operator">|</span> <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">|</span> YES  <span class="token operator">|</span>     <span class="token operator">|</span> <span class="token boolean">NULL</span>    <span class="token operator">|</span>       <span class="token operator">|</span><span class="token operator">|</span> i     <span class="token operator">|</span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">|</span> YES  <span class="token operator">|</span>     <span class="token operator">|</span> <span class="token boolean">NULL</span>    <span class="token operator">|</span>       <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">-------+---------+------+-----+---------+-------+</span><span class="token number">2</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p>如果你需要指定新增字段的位置，可以使用 MySQL 提供的关键字 <code>FIRST</code> (设定位第一列)， <code>AFTER</code> 字段名（设定位于某个字段之后）。</p><p>尝试以下 <code>ALTER TABLE</code> 语句, 在执行成功后，使用 <code>SHOW COLUMNS</code> 查看表结构的变化：</p><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> testalter_tbl <span class="token keyword">DROP</span> i<span class="token punctuation">;</span><span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> testalter_tbl <span class="token keyword">ADD</span> i <span class="token keyword">INT</span> <span class="token keyword">FIRST</span><span class="token punctuation">;</span><span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> testalter_tbl <span class="token keyword">DROP</span> i<span class="token punctuation">;</span><span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> testalter_tbl <span class="token keyword">ADD</span> i <span class="token keyword">INT</span> <span class="token keyword">AFTER</span> c<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></p><p><code>FIRST</code> 和 <code>AFTER</code> 关键字可用于 <code>ADD</code> 与 <code>MODIFY</code> 子句，所以如果你想重置数据表字段的位置就需要先使用 <code>DROP</code> 删除字段然后使用 <code>ADD</code> 来添加字段并设置位置。</p><h2 id="修改字段类型及名称"><a href="#修改字段类型及名称" class="headerlink" title="修改字段类型及名称"></a>修改字段类型及名称</h2><p>如果需要修改字段类型及名称, 你可以在 <code>ALTER</code> 命令中使用 <code>MODIFY</code> 或 <code>CHANGE</code> 子句 。</p><p>例如，把字段 <code>c</code> 的类型从 <code>CHAR(1)</code> 改为 <code>CHAR(10)</code>，可以执行以下命令:</p><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">mysql<span class="token operator">></span> <span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> testalter_tbl <span class="token keyword">MODIFY</span> c <span class="token keyword">CHAR</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><p>使用 <code>CHANGE</code> 子句, 语法有很大的不同。 在 <code>CHANGE</code> 关键字之后，紧跟着的是你要修改的字段名，然后指定新字段名及类型。尝试如下实例：</p><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">mysql<span class="token operator">></span> <span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> testalter_tbl CHANGE i j <span class="token keyword">BIGINT</span><span class="token punctuation">;</span>mysql<span class="token operator">></span> <span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> testalter_tbl CHANGE j j <span class="token keyword">INT</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></p><h2 id="ALTER-TABLE-对-NULL-值和默认值的影响"><a href="#ALTER-TABLE-对-NULL-值和默认值的影响" class="headerlink" title="ALTER TABLE 对 NULL 值和默认值的影响"></a>ALTER TABLE 对 NULL 值和默认值的影响</h2><p>当你修改字段时，你可以指定是否包含值或者是否设置默认值。</p><p>以下实例，指定字段 <code>j</code> 为 <code>NOT NULL</code> 且默认值为 <code>100</code> 。</p><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">mysql<span class="token operator">></span> <span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> testalter_tbl     <span class="token operator">-</span><span class="token operator">></span> <span class="token keyword">MODIFY</span> j <span class="token keyword">BIGINT</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token number">100</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></p><p>如果你不设置默认值，MySQL会自动设置该字段默认为 <code>NULL</code>。</p><h2 id="修改字段默认值"><a href="#修改字段默认值" class="headerlink" title="修改字段默认值"></a>修改字段默认值</h2><p>你可以使用 <code>ALTER</code> 来修改字段的默认值，尝试以下实例：</p><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">mysql<span class="token operator">></span> <span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> testalter_tbl <span class="token keyword">ALTER</span> i <span class="token keyword">SET</span> <span class="token keyword">DEFAULT</span> <span class="token number">1000</span><span class="token punctuation">;</span>mysql<span class="token operator">></span> <span class="token keyword">SHOW</span> <span class="token keyword">COLUMNS</span> <span class="token keyword">FROM</span> testalter_tbl<span class="token punctuation">;</span><span class="token operator">+</span><span class="token comment">-------+---------+------+-----+---------+-------+</span><span class="token operator">|</span> Field <span class="token operator">|</span> <span class="token keyword">Type</span>    <span class="token operator">|</span> <span class="token boolean">Null</span> <span class="token operator">|</span> <span class="token keyword">Key</span> <span class="token operator">|</span> <span class="token keyword">Default</span> <span class="token operator">|</span> Extra <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">-------+---------+------+-----+---------+-------+</span><span class="token operator">|</span> c     <span class="token operator">|</span> <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">|</span> YES  <span class="token operator">|</span>     <span class="token operator">|</span> <span class="token boolean">NULL</span>    <span class="token operator">|</span>       <span class="token operator">|</span><span class="token operator">|</span> i     <span class="token operator">|</span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">|</span> YES  <span class="token operator">|</span>     <span class="token operator">|</span> <span class="token number">1000</span>    <span class="token operator">|</span>       <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">-------+---------+------+-----+---------+-------+</span><span class="token number">2</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p>你也可以使用 <code>ALTER</code> 命令及 <code>DROP</code> 子句来删除字段的默认值，如下实例：</p><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">mysql<span class="token operator">></span> <span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> testalter_tbl <span class="token keyword">ALTER</span> i <span class="token keyword">DROP</span> <span class="token keyword">DEFAULT</span><span class="token punctuation">;</span>mysql<span class="token operator">></span> <span class="token keyword">SHOW</span> <span class="token keyword">COLUMNS</span> <span class="token keyword">FROM</span> testalter_tbl<span class="token punctuation">;</span><span class="token operator">+</span><span class="token comment">-------+---------+------+-----+---------+-------+</span><span class="token operator">|</span> Field <span class="token operator">|</span> <span class="token keyword">Type</span>    <span class="token operator">|</span> <span class="token boolean">Null</span> <span class="token operator">|</span> <span class="token keyword">Key</span> <span class="token operator">|</span> <span class="token keyword">Default</span> <span class="token operator">|</span> Extra <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">-------+---------+------+-----+---------+-------+</span><span class="token operator">|</span> c     <span class="token operator">|</span> <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">|</span> YES  <span class="token operator">|</span>     <span class="token operator">|</span> <span class="token boolean">NULL</span>    <span class="token operator">|</span>       <span class="token operator">|</span><span class="token operator">|</span> i     <span class="token operator">|</span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">|</span> YES  <span class="token operator">|</span>     <span class="token operator">|</span> <span class="token boolean">NULL</span>    <span class="token operator">|</span>       <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">-------+---------+------+-----+---------+-------+</span><span class="token number">2</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>Changing a <span class="token keyword">Table</span> <span class="token keyword">Type</span>:<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p>修改数据表类型，可以使用 <code>ALTER</code> 命令及 <code>TYPE</code> 子句来完成。尝试以下实例，我们将表 <code>testalter_tbl</code> 的类型修改为 <code>MyISAM</code>：</p><p>注意：查看数据表类型可以使用 <code>SHOW TABLE STATUS</code> 语句，并使用 <code>\G</code> 格式化输出。</p><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">mysql<span class="token operator">></span> <span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> testalter_tbl <span class="token keyword">ENGINE</span> <span class="token operator">=</span> MyISAM<span class="token punctuation">;</span>mysql<span class="token operator">></span> <span class="token keyword">SHOW</span> <span class="token keyword">TABLE</span> <span class="token keyword">STATUS</span> <span class="token operator">LIKE</span> <span class="token string">'testalter_tbl'</span> \G<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span> <span class="token number">1.</span> <span class="token keyword">row</span> <span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span>           Name: testalter_tbl           <span class="token keyword">Type</span>: MyISAM     Row_format: <span class="token keyword">Fixed</span>           <span class="token keyword">Rows</span>: <span class="token number">0</span> Avg_row_length: <span class="token number">0</span>    Data_length: <span class="token number">0</span>Max_data_length: <span class="token number">25769803775</span>   Index_length: <span class="token number">1024</span>      Data_free: <span class="token number">0</span> <span class="token keyword">Auto_increment</span>: <span class="token boolean">NULL</span>    Create_time: <span class="token number">2007</span><span class="token operator">-</span><span class="token number">06</span><span class="token operator">-</span><span class="token number">03</span> <span class="token number">08</span>:<span class="token number">04</span>:<span class="token number">36</span>    Update_time: <span class="token number">2007</span><span class="token operator">-</span><span class="token number">06</span><span class="token operator">-</span><span class="token number">03</span> <span class="token number">08</span>:<span class="token number">04</span>:<span class="token number">36</span>     Check_time: <span class="token boolean">NULL</span> Create_options:        <span class="token keyword">Comment</span>:<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h2 id="修改表名"><a href="#修改表名" class="headerlink" title="修改表名"></a>修改表名</h2><p>如果需要修改数据表的名称，可以在 <code>ALTER TABLE</code> 语句中使用 <code>RENAME</code> 子句来实现。</p><p>尝试以下实例将数据表 <code>testalter_tbl</code> 重命名为 <code>alter_tbl</code>：</p><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">mysql<span class="token operator">></span> <span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> testalter_tbl <span class="token keyword">RENAME</span> <span class="token keyword">TO</span> alter_tbl<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><p><code>ALTER</code> 命令还可以用来创建及删除 MySQL 数据表的索引，该功能我们会在接下来的章节中介绍。</p><h1 id="事务"><a href="#事务" class="headerlink" title="事务"></a>事务</h1><p>MySQL 事务主要用于处理操作量大，复杂度高的数据。比如说，在人员管理系统中，你删除一个人员，你既需要删除人员的基本资料，也要删除和该人员相关的信息，如信箱，文章等等，这样，这些数据库操作语句就构成一个事务。</p><ul><li>在 MySQL 中只有使用了 <code>InnoDB</code> 数据库引擎的数据库或表才支持事务。</li><li>事务处理可以用来维护数据库的完整性，保证成批的 SQL 语句要么全部执行，要么全部不执行。</li><li>事务用来管理 <code>INSERT</code>，<code>UPDATE</code>, <code>DELETE</code> 语句。</li></ul><p>一般来说，事务是必须满足 4 个条件（<code>ACID</code>）：原子性（Atomicity，或称不可分割性）、一致性（Consistency）、隔离性（Isolation，又称独立性）、持久性（Durability）。</p><ul><li>原子性：一个事务（transaction）中的所有操作，要么全部完成，要么全部不完成，不会结束在中间某个环节。事务在执行过程中发生错误，会被回滚（Rollback）到事务开始前的状态，就像这个事务从来没有执行过一样。</li><li>一致性：在事务开始之前和事务结束以后，数据库的完整性没有被破坏。这表示写入的资料必须完全符合所有的预设规则，这包含资料的精确度、串联性以及后续数据库可以自发性地完成预定的工作。</li><li>隔离性：数据库允许多个并发事务同时对其数据进行读写和修改的能力，隔离性可以防止多个事务并发执行时由于交叉执行而导致数据的不一致。事务隔离分为不同级别，包括读未提交（Read uncommitted）、读提交（read committed）、可重复读（repeatable read）和串行化（Serializable）。</li><li>持久性：事务处理结束后，对数据的修改就是永久的，即便系统故障也不会丢失。</li></ul><p>在 MySQL 命令行的默认设置下，事务都是自动提交的，即执行 SQL 语句后就会马上执行 <code>COMMIT</code> 操作。因此要显式地开启一个事务务须使用命令 <code>BEGIN</code> 或 <code>START TRANSACTION</code>，或者执行命令 <code>SET AUTOCOMMIT=0</code>，用来禁止使用当前会话的自动提交。</p><p>事务控制语句：</p><ul><li><code>BEGIN</code> 或 <code>START TRANSACTION</code> 显式地开启一个事务；</li><li><code>COMMIT</code> 也可以使用 <code>COMMIT WORK</code>，不过二者是等价的。<code>COMMIT</code> 会提交事务，并使已对数据库进行的所有修改成为永久性的；</li><li><code>ROLLBACK</code> 也可以使用 <code>ROLLBACK WORK</code>，不过二者是等价的。回滚会结束用户的事务，并撤销正在进行的所有未提交的修改；</li><li><code>SAVEPOINT identifier</code>，<code>SAVEPOINT</code> 允许在事务中创建一个保存点，一个事务中可以有多个 <code>SAVEPOINT</code>；</li><li><code>RELEASE SAVEPOINT identifier</code> 删除一个事务的保存点，当没有指定的保存点时，执行该语句会抛出一个异常；</li><li><code>ROLLBACK TO identifier</code> 把事务回滚到标记点；</li><li><code>SET TRANSACTION</code> 用来设置事务的隔离级别。<code>InnoDB</code> 存储引擎提供事务的隔离级别有<code>READ UNCOMMITTED</code>、<code>READ COMMITTED</code>、<code>REPEATABLE READ</code> 和 <code>SERIALIZABLE</code>。</li></ul><p>MYSQL 事务处理主要有两种方法：</p><ol><li><p>用 <code>BEGIN</code>，<code>ROLLBACK</code>，<code>COMMIT</code> 来实现</p><ul><li><code>BEGIN</code>：开始一个事务</li><li><code>ROLLBACK</code>：事务回滚</li><li><code>COMMIT</code>：事务确认</li></ul></li><li><p>直接用 <code>SET</code> 来改变 MySQL 的自动提交模式:</p><ul><li><code>SET AUTOCOMMIT=0</code>：禁止自动提交</li><li><code>SET AUTOCOMMIT=1</code>：开启自动提交</li></ul></li></ol><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">mysql<span class="token operator">></span> <span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> transaction_test<span class="token punctuation">(</span> id <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">engine</span><span class="token operator">=</span><span class="token keyword">innodb</span><span class="token punctuation">;</span>  <span class="token comment"># 创建数据表</span>Query OK<span class="token punctuation">,</span> <span class="token number">0</span> <span class="token keyword">rows</span> affected <span class="token punctuation">(</span><span class="token number">0.04</span> sec<span class="token punctuation">)</span>mysql<span class="token operator">></span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> transaction_test<span class="token punctuation">;</span>Empty <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.01</span> sec<span class="token punctuation">)</span>mysql<span class="token operator">></span> <span class="token keyword">BEGIN</span><span class="token punctuation">;</span>  <span class="token comment"># 开始事务</span>Query OK<span class="token punctuation">,</span> <span class="token number">0</span> <span class="token keyword">rows</span> affected <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>mysql<span class="token operator">></span> <span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> transaction_test <span class="token keyword">VALUE</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>Query OK<span class="token punctuation">,</span> <span class="token number">1</span> <span class="token keyword">rows</span> affected <span class="token punctuation">(</span><span class="token number">0.01</span> sec<span class="token punctuation">)</span>mysql<span class="token operator">></span> <span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> transaction_test <span class="token keyword">VALUE</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>Query OK<span class="token punctuation">,</span> <span class="token number">1</span> <span class="token keyword">rows</span> affected <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>mysql<span class="token operator">></span> <span class="token keyword">COMMIT</span><span class="token punctuation">;</span>  <span class="token comment"># 提交事务</span>Query OK<span class="token punctuation">,</span> <span class="token number">0</span> <span class="token keyword">rows</span> affected <span class="token punctuation">(</span><span class="token number">0.01</span> sec<span class="token punctuation">)</span>mysql<span class="token operator">></span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> transaction_test<span class="token punctuation">;</span><span class="token operator">+</span><span class="token comment">------+</span><span class="token operator">|</span> id   <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">------+</span><span class="token operator">|</span> <span class="token number">5</span>    <span class="token operator">|</span><span class="token operator">|</span> <span class="token number">6</span>    <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">------+</span><span class="token number">2</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.01</span> sec<span class="token punctuation">)</span>mysql<span class="token operator">></span> <span class="token keyword">BEGIN</span><span class="token punctuation">;</span>  <span class="token comment"># 开始事务</span>Query OK<span class="token punctuation">,</span> <span class="token number">0</span> <span class="token keyword">rows</span> affected <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>mysql<span class="token operator">></span> <span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> transaction_test <span class="token keyword">VALUE</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">;</span>Query OK<span class="token punctuation">,</span> <span class="token number">1</span> <span class="token keyword">rows</span> affected <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>mysql<span class="token operator">></span> <span class="token keyword">rollback</span><span class="token punctuation">;</span>  <span class="token comment"># 回滚</span>Query OK<span class="token punctuation">,</span> <span class="token number">0</span> <span class="token keyword">rows</span> affected <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>mysql<span class="token operator">></span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> transaction_test<span class="token punctuation">;</span>  <span class="token comment"># 因为回滚所以数据没有插入</span><span class="token operator">+</span><span class="token comment">------+</span><span class="token operator">|</span> id   <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">------+</span><span class="token operator">|</span> <span class="token number">5</span>    <span class="token operator">|</span><span class="token operator">|</span> <span class="token number">6</span>    <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">------+</span><span class="token number">2</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.01</span> sec<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h1 id="索引"><a href="#索引" class="headerlink" title="索引"></a>索引</h1><p>MySQL 索引的建立对于 MySQL 的高效运行是很重要的，索引可以大大提高 MySQL 的检索速度。</p><p>打个比方，如果合理的设计且使用索引的 MySQL 是一辆兰博基尼的话，那么没有设计和使用索引的 MySQL 就是一个人力三轮车。</p><p>拿汉语字典的目录页（索引）打比方，我们可以按拼音、笔画、偏旁部首等排序的目录（索引）快速查找到需要的字。</p><p>索引分单列索引和组合索引。单列索引，即一个索引只包含单个列，一个表可以有多个单列索引，但这不是组合索引。组合索引，即一个索引包含多个列。</p><p>创建索引时，你需要确保该索引是应用在 SQL 查询语句的条件（一般作为 <code>WHERE</code> 子句的条件）。</p><p>实际上，索引也是一张表，该表保存了主键与索引字段，并指向实体表的记录。</p><p>上面都在说使用索引的好处，但过多的使用索引将会造成滥用。因此索引也会有它的缺点：虽然索引大大提高了查询速度，同时却会降低更新表的速度，如对表进行 <code>INSERT</code>、<code>UPDATE</code> 和 <code>DELETE</code>。因为更新表时，MySQL 不仅要保存数据，还要保存一下索引文件。</p><p>建立索引会占用磁盘空间的索引文件。</p><h2 id="普通索引"><a href="#普通索引" class="headerlink" title="普通索引"></a>普通索引</h2><h3 id="创建索引"><a href="#创建索引" class="headerlink" title="创建索引"></a>创建索引</h3><p>这是最基本的索引，它没有任何限制。它有以下几种创建方式：</p><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">INDEX</span> indexName <span class="token keyword">ON</span> table_name <span class="token punctuation">(</span>column_name<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><p>如果是 <code>CHAR</code>，<code>VARCHAR</code> 类型，<code>length</code> 可以小于字段实际长度；如果是 <code>BLOB</code> 和 <code>TEXT</code> 类型，必须指定 <code>length</code>。</p><h3 id="修改表结构-添加索引"><a href="#修改表结构-添加索引" class="headerlink" title="修改表结构(添加索引)"></a>修改表结构(添加索引)</h3><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">ALTER</span> <span class="token keyword">table</span> tableName <span class="token keyword">ADD</span> <span class="token keyword">INDEX</span> indexName<span class="token punctuation">(</span>columnName<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><h3 id="创建表的时候直接指定"><a href="#创建表的时候直接指定" class="headerlink" title="创建表的时候直接指定"></a>创建表的时候直接指定</h3><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> mytable<span class="token punctuation">(</span>  ID <span class="token keyword">INT</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>username <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span><span class="token keyword">INDEX</span> <span class="token punctuation">[</span>indexName<span class="token punctuation">]</span> <span class="token punctuation">(</span>username<span class="token punctuation">(</span>length<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h3 id="删除索引的语法"><a href="#删除索引的语法" class="headerlink" title="删除索引的语法"></a>删除索引的语法</h3><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">DROP</span> <span class="token keyword">INDEX</span> <span class="token punctuation">[</span>indexName<span class="token punctuation">]</span> <span class="token keyword">ON</span> mytable<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><h2 id="唯一索引"><a href="#唯一索引" class="headerlink" title="唯一索引"></a>唯一索引</h2><p>它与前面的普通索引类似，不同的就是：索引列的值必须唯一，但允许有空值。如果是组合索引，则列值的组合必须唯一。它有以下几种创建方式：</p><h3 id="创建索引-1"><a href="#创建索引-1" class="headerlink" title="创建索引"></a>创建索引</h3><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">UNIQUE</span> <span class="token keyword">INDEX</span> indexName <span class="token keyword">ON</span> mytable<span class="token punctuation">(</span>username<span class="token punctuation">(</span>length<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><h3 id="修改表结构"><a href="#修改表结构" class="headerlink" title="修改表结构"></a>修改表结构</h3><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">ALTER</span> <span class="token keyword">table</span> mytable <span class="token keyword">ADD</span> <span class="token keyword">UNIQUE</span> <span class="token punctuation">[</span>indexName<span class="token punctuation">]</span> <span class="token punctuation">(</span>username<span class="token punctuation">(</span>length<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><h3 id="创建表的时候直接指定-1"><a href="#创建表的时候直接指定-1" class="headerlink" title="创建表的时候直接指定"></a>创建表的时候直接指定</h3><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> mytable<span class="token punctuation">(</span>ID <span class="token keyword">INT</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>username <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span><span class="token keyword">UNIQUE</span> <span class="token punctuation">[</span>indexName<span class="token punctuation">]</span> <span class="token punctuation">(</span>username<span class="token punctuation">(</span>length<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h2 id="使用ALTER-命令添加和删除索引"><a href="#使用ALTER-命令添加和删除索引" class="headerlink" title="使用ALTER 命令添加和删除索引"></a>使用ALTER 命令添加和删除索引</h2><p>有四种方式来添加数据表的索引：</p><ul><li><code>ALTER TABLE tbl_name ADD PRIMARY KEY (column_list)</code>：该语句添加一个主键，这意味着索引值必须是唯一的，且不能为 <code>NULL</code>。</li><li><code>ALTER TABLE tbl_name ADD UNIQUE index_name (column_list)</code>：这条语句创建索引的值必须是唯一的（除了 <code>NULL</code> 外，<code>NULL</code> 可能会出现多次）。</li><li><code>ALTER TABLE tbl_name ADD INDEX index_name (column_list)</code>：添加普通索引，索引值可出现多次。</li><li><code>ALTER TABLE tbl_name ADD FULLTEXT index_name (column_list)</code>：该语句指定了索引为 <code>FULLTEXT</code>，用于全文索引。</li></ul><p>以下实例为在表中添加索引。</p><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">mysql<span class="token operator">></span> <span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> testalter_tbl <span class="token keyword">ADD</span> <span class="token keyword">INDEX</span> <span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><p>你还可以在 <code>ALTER</code> 命令中使用 <code>DROP</code> 子句来删除索引。尝试以下实例删除索引:</p><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">mysql<span class="token operator">></span> <span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> testalter_tbl <span class="token keyword">DROP</span> <span class="token keyword">INDEX</span> c<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><h2 id="使用-ALTER-命令添加和删除主键"><a href="#使用-ALTER-命令添加和删除主键" class="headerlink" title="使用 ALTER 命令添加和删除主键"></a>使用 ALTER 命令添加和删除主键</h2><p>主键作用于列上（可以一个列或多个列联合主键），添加主键索引时，你需要确保该主键默认不为空（<code>NOT NULL</code>）。实例如下：</p><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">mysql<span class="token operator">></span> <span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> testalter_tbl <span class="token keyword">MODIFY</span> i <span class="token keyword">INT</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">;</span>mysql<span class="token operator">></span> <span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> testalter_tbl <span class="token keyword">ADD</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></p><p>你也可以使用 <code>ALTER</code> 命令删除主键：</p><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">mysql<span class="token operator">></span> <span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> testalter_tbl <span class="token keyword">DROP</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><p>删除主键时只需指定 <code>PRIMARY KEY</code>，但在删除索引时，你必须知道索引名。</p><h2 id="显示索引信息"><a href="#显示索引信息" class="headerlink" title="显示索引信息"></a>显示索引信息</h2><p>你可以使用 <code>SHOW INDEX</code> 命令来列出表中的相关的索引信息。可以通过添加 <code>\G</code> 来格式化输出信息。</p><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">mysql<span class="token operator">></span> <span class="token keyword">SHOW</span> <span class="token keyword">INDEX</span> <span class="token keyword">FROM</span> table_name<span class="token punctuation">;</span> \G<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><h1 id="临时表"><a href="#临时表" class="headerlink" title="临时表"></a>临时表</h1><p>MySQL 临时表在我们需要保存一些临时数据时是非常有用的。临时表只在当前连接可见，当关闭连接时，MySQL 会自动删除表并释放所有空间。</p><p>临时表在 MySQL 3.23 版本中添加，如果你的 MySQL 版本低于 3.23 版本就无法使用 MySQL 的临时表。不过现在一般很少有再使用这么低版本的 MySQL 数据库服务了。</p><p>MySQL 临时表只在当前连接可见，如果你使用 PHP 脚本来创建 MySQL 临时表，那每当 PHP 脚本执行完成后，该临时表也会自动销毁。</p><p>如果你使用了其他 MySQL 客户端程序连接 MySQL 数据库服务器来创建临时表，那么只有在关闭客户端程序时才会销毁临时表，当然你也可以手动销毁。</p><h2 id="创建-MySQL-临时表"><a href="#创建-MySQL-临时表" class="headerlink" title="创建 MySQL 临时表"></a>创建 MySQL 临时表</h2><p>以下展示了使用 <code>TEMPORARY</code> 关键字创建 MySQL 临时表的简单实例：</p><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">mysql<span class="token operator">></span> <span class="token keyword">CREATE</span> <span class="token keyword">TEMPORARY</span> <span class="token keyword">TABLE</span> SalesSummary <span class="token punctuation">(</span>    <span class="token operator">-</span><span class="token operator">></span> product_name <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>    <span class="token operator">-</span><span class="token operator">></span> total_sales <span class="token keyword">DECIMAL</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token number">0.00</span><span class="token punctuation">,</span>    <span class="token operator">-</span><span class="token operator">></span> avg_unit_price <span class="token keyword">DECIMAL</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token number">0.00</span><span class="token punctuation">,</span>    <span class="token operator">-</span><span class="token operator">></span> total_units_sold <span class="token keyword">INT</span> <span class="token keyword">UNSIGNED</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>Query OK<span class="token punctuation">,</span> <span class="token number">0</span> <span class="token keyword">rows</span> affected <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>mysql<span class="token operator">></span> <span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> SalesSummary    <span class="token operator">-</span><span class="token operator">></span> <span class="token punctuation">(</span>product_name<span class="token punctuation">,</span> total_sales<span class="token punctuation">,</span> avg_unit_price<span class="token punctuation">,</span> total_units_sold<span class="token punctuation">)</span>    <span class="token operator">-</span><span class="token operator">></span> <span class="token keyword">VALUES</span>    <span class="token operator">-</span><span class="token operator">></span> <span class="token punctuation">(</span><span class="token string">'cucumber'</span><span class="token punctuation">,</span> <span class="token number">100.25</span><span class="token punctuation">,</span> <span class="token number">90</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>mysql<span class="token operator">></span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> SalesSummary<span class="token punctuation">;</span><span class="token operator">+</span><span class="token comment">--------------+-------------+----------------+------------------+</span><span class="token operator">|</span> product_name <span class="token operator">|</span> total_sales <span class="token operator">|</span> avg_unit_price <span class="token operator">|</span> total_units_sold <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">--------------+-------------+----------------+------------------+</span><span class="token operator">|</span> cucumber     <span class="token operator">|</span>      <span class="token number">100.25</span> <span class="token operator">|</span>          <span class="token number">90.00</span> <span class="token operator">|</span>                <span class="token number">2</span> <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">--------------+-------------+----------------+------------------+</span><span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p>用查询直接创建临时表：</p><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TEMPORARY</span> <span class="token keyword">TABLE</span> 临时表名 <span class="token keyword">AS</span><span class="token punctuation">(</span>    <span class="token keyword">SELECT</span> <span class="token operator">*</span>  <span class="token keyword">FROM</span> 旧的表名<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></p><p>当你使用 <code>SHOW TABLES</code> 命令显示数据表列表时，你将无法看到 <code>SalesSummary</code> 表。</p><p>如果你退出当前 MySQL 会话，再使用 <code>SELECT</code> 命令来读取原先创建的临时表数据，那你会发现数据库中没有该表的存在，因为在你退出时该临时表已经被销毁了。</p><h2 id="删除-MySQL-临时表"><a href="#删除-MySQL-临时表" class="headerlink" title="删除 MySQL 临时表"></a>删除 MySQL 临时表</h2><p>默认情况下，当你断开与数据库的连接后，临时表就会自动被销毁。当然你也可以在当前 MySQL 会话使用 <code>DROP TABLE</code> 命令来手动删除临时表。</p><p>以下是手动删除临时表的实例：</p><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">mysql<span class="token operator">></span> <span class="token keyword">CREATE</span> <span class="token keyword">TEMPORARY</span> <span class="token keyword">TABLE</span> SalesSummary <span class="token punctuation">(</span>    <span class="token operator">-</span><span class="token operator">></span> product_name <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>    <span class="token operator">-</span><span class="token operator">></span> total_sales <span class="token keyword">DECIMAL</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token number">0.00</span><span class="token punctuation">,</span>    <span class="token operator">-</span><span class="token operator">></span> avg_unit_price <span class="token keyword">DECIMAL</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token number">0.00</span><span class="token punctuation">,</span>    <span class="token operator">-</span><span class="token operator">></span> total_units_sold <span class="token keyword">INT</span> <span class="token keyword">UNSIGNED</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token number">0</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">;</span>Query OK<span class="token punctuation">,</span> <span class="token number">0</span> <span class="token keyword">rows</span> affected <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>mysql<span class="token operator">></span> <span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> SalesSummary    <span class="token operator">-</span><span class="token operator">></span> <span class="token punctuation">(</span>product_name<span class="token punctuation">,</span> total_sales<span class="token punctuation">,</span> avg_unit_price<span class="token punctuation">,</span> total_units_sold<span class="token punctuation">)</span>    <span class="token operator">-</span><span class="token operator">></span> <span class="token keyword">VALUES</span>    <span class="token operator">-</span><span class="token operator">></span> <span class="token punctuation">(</span><span class="token string">'cucumber'</span><span class="token punctuation">,</span> <span class="token number">100.25</span><span class="token punctuation">,</span> <span class="token number">90</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>mysql<span class="token operator">></span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> SalesSummary<span class="token punctuation">;</span><span class="token operator">+</span><span class="token comment">--------------+-------------+----------------+------------------+</span><span class="token operator">|</span> product_name <span class="token operator">|</span> total_sales <span class="token operator">|</span> avg_unit_price <span class="token operator">|</span> total_units_sold <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">--------------+-------------+----------------+------------------+</span><span class="token operator">|</span> cucumber     <span class="token operator">|</span>      <span class="token number">100.25</span> <span class="token operator">|</span>          <span class="token number">90.00</span> <span class="token operator">|</span>                <span class="token number">2</span> <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">--------------+-------------+----------------+------------------+</span><span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>mysql<span class="token operator">></span> <span class="token keyword">DROP</span> <span class="token keyword">TABLE</span> SalesSummary<span class="token punctuation">;</span>mysql<span class="token operator">></span>  <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> SalesSummary<span class="token punctuation">;</span>ERROR <span class="token number">1146</span>: <span class="token keyword">Table</span> <span class="token string">'TestDB.SalesSummary'</span> doesn't exist<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h1 id="复制表"><a href="#复制表" class="headerlink" title="复制表"></a>复制表</h1><p>如果我们需要完全的复制 MySQL 的数据表，包括表的结构，索引，默认值等。如果仅仅使用<code>CREATE TABLE ... SELECT</code> 命令，是无法实现的。</p><p>完整的复制 MySQL 数据表的步骤如下：</p><ol><li>使用 <code>SHOW CREATE TABLE</code> 命令获取创建数据表（<code>CREATE TABLE</code>）语句，该语句包含了原数据表的结构，索引等。</li><li>复制以下命令显示的SQL语句，修改数据表名，并执行 SQL 语句，通过以上命令将完全的复制数据表结构。</li><li>如果你想复制表的内容，你就可以使用 <code>INSERT INTO ... SELECT</code> 语句来实现。</li></ol><p>尝试以下实例来复制表 <code>tbl</code>。</p><ol><li><p>获取数据表的完整结构。</p><p> <pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">mysql<span class="token operator">></span> <span class="token keyword">SHOW</span> <span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> tbl \G<span class="token punctuation">;</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span> <span class="token number">1.</span> <span class="token keyword">row</span> <span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span>      <span class="token keyword">Table</span>: tbl<span class="token keyword">Create</span> <span class="token keyword">Table</span>: <span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token punctuation">`</span>tbl<span class="token punctuation">`</span> <span class="token punctuation">(</span>  <span class="token punctuation">`</span>id<span class="token punctuation">`</span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">auto_increment</span><span class="token punctuation">,</span>  <span class="token punctuation">`</span>title<span class="token punctuation">`</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">default</span> <span class="token string">''</span><span class="token punctuation">,</span>  <span class="token punctuation">`</span>author<span class="token punctuation">`</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">40</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">default</span> <span class="token string">''</span><span class="token punctuation">,</span>  <span class="token punctuation">`</span>submission_date<span class="token punctuation">`</span> <span class="token keyword">date</span> <span class="token keyword">default</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span>  <span class="token punctuation">(</span><span class="token punctuation">`</span>id<span class="token punctuation">`</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token keyword">UNIQUE</span> <span class="token keyword">KEY</span> <span class="token punctuation">`</span>AUTHOR_INDEX<span class="token punctuation">`</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>author<span class="token punctuation">`</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span> <span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>ERROR:<span class="token keyword">No</span> query specified<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p></li><li><p>修改SQL语句的数据表名，并执行SQL语句。</p><p> <pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">mysql<span class="token operator">></span> <span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token punctuation">`</span>clone_tbl<span class="token punctuation">`</span> <span class="token punctuation">(</span>  <span class="token operator">-</span><span class="token operator">></span> <span class="token punctuation">`</span>id<span class="token punctuation">`</span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">auto_increment</span><span class="token punctuation">,</span>  <span class="token operator">-</span><span class="token operator">></span> <span class="token punctuation">`</span>title<span class="token punctuation">`</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">default</span> <span class="token string">''</span><span class="token punctuation">,</span>  <span class="token operator">-</span><span class="token operator">></span> <span class="token punctuation">`</span>author<span class="token punctuation">`</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">40</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">default</span> <span class="token string">''</span><span class="token punctuation">,</span>  <span class="token operator">-</span><span class="token operator">></span> <span class="token punctuation">`</span>submission_date<span class="token punctuation">`</span> <span class="token keyword">date</span> <span class="token keyword">default</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>  <span class="token operator">-</span><span class="token operator">></span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span>  <span class="token punctuation">(</span><span class="token punctuation">`</span>id<span class="token punctuation">`</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token operator">-</span><span class="token operator">></span> <span class="token keyword">UNIQUE</span> <span class="token keyword">KEY</span> <span class="token punctuation">`</span>AUTHOR_INDEX<span class="token punctuation">`</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>author<span class="token punctuation">`</span><span class="token punctuation">)</span>  <span class="token operator">-</span><span class="token operator">></span> <span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span><span class="token punctuation">;</span>Query OK<span class="token punctuation">,</span> <span class="token number">0</span> <span class="token keyword">rows</span> affected <span class="token punctuation">(</span><span class="token number">1.80</span> sec<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p></li><li><p>执行完第二步骤后，你将在数据库中创建新的克隆表 clone_tbl。 如果你想拷贝数据表的数据你可以使用 INSERT INTO... SELECT 语句来实现。</p><p> <pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">mysql<span class="token operator">></span> <span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> clone_tbl <span class="token punctuation">(</span>id<span class="token punctuation">,</span>    <span class="token operator">-</span><span class="token operator">></span>                        title<span class="token punctuation">,</span>    <span class="token operator">-</span><span class="token operator">></span>                        author<span class="token punctuation">,</span>    <span class="token operator">-</span><span class="token operator">></span>                        submission_date<span class="token punctuation">)</span>    <span class="token operator">-</span><span class="token operator">></span> <span class="token keyword">SELECT</span> id<span class="token punctuation">,</span>title<span class="token punctuation">,</span> author<span class="token punctuation">,</span> submission_date    <span class="token operator">-</span><span class="token operator">></span> <span class="token keyword">FROM</span> tbl<span class="token punctuation">;</span>Query OK<span class="token punctuation">,</span> <span class="token number">3</span> <span class="token keyword">rows</span> affected <span class="token punctuation">(</span><span class="token number">0.07</span> sec<span class="token punctuation">)</span>Records: <span class="token number">3</span>  Duplicates: <span class="token number">0</span>  <span class="token keyword">Warnings</span>: <span class="token number">0</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p>执行以上步骤后，你将完整的复制表，包括表结构及表数据。</p></li></ol><p><strong>另一种完整复制表的方法:</strong></p><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> targetTable <span class="token operator">LIKE</span> sourceTable<span class="token punctuation">;</span><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> targetTable <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> sourceTable<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></p><p><strong>可以拷贝一个表中其中的一些字段:</strong></p><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> newadmin <span class="token keyword">AS</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> username<span class="token punctuation">,</span> password <span class="token keyword">FROM</span> admin<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><p><strong>可以将新建的表的字段改名:</strong></p><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> newadmin <span class="token keyword">AS</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> id<span class="token punctuation">,</span> username <span class="token keyword">AS</span> uname<span class="token punctuation">,</span> password <span class="token keyword">AS</span> pass <span class="token keyword">FROM</span> admin<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><p><strong>可以拷贝一部分数据:</strong></p><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> newadmin <span class="token keyword">AS</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> admin <span class="token keyword">WHERE</span> <span class="token keyword">LEFT</span><span class="token punctuation">(</span>username<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token string">'s'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><p><strong>可以在创建表的同时定义表中的字段信息:</strong></p><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> newadmin <span class="token punctuation">(</span>id <span class="token keyword">INTEGER</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> admin<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><h1 id="元数据"><a href="#元数据" class="headerlink" title="元数据"></a>元数据</h1><ul><li>查询结果信息：<code>SELECT</code>，<code>UPDATE</code> 或 <code>DELETE</code> 语句影响的记录数。</li><li>数据库和数据表的信息：包含了数据库及数据表的结构信息。</li><li>MySQL 服务器信息：包含了数据库服务器的当前状态，版本号等。</li></ul><p>在 MySQL 的命令提示符中，我们可以很容易的获取以上服务器信息。</p><h2 id="获取服务器元数据"><a href="#获取服务器元数据" class="headerlink" title="获取服务器元数据"></a>获取服务器元数据</h2><p>以下命令语句可以在 MySQL 的命令提示符使用，也可以在脚本中使用。</p><div class="table-container"><table><thead><tr><th style="text-align:center">命令</th><th style="text-align:center">描述</th></tr></thead><tbody><tr><td style="text-align:center">SELECT VERSION( )</td><td style="text-align:center">服务器版本信息</td></tr><tr><td style="text-align:center">SELECT DATABASE( )</td><td style="text-align:center">当前数据库名（或者返回空）</td></tr><tr><td style="text-align:center">SELECT USER( )</td><td style="text-align:center">当前用户名</td></tr><tr><td style="text-align:center">SHOW STATUS</td><td style="text-align:center">服务器状态</td></tr><tr><td style="text-align:center">SHOW VARIABLES</td><td style="text-align:center">服务器配置变量</td></tr></tbody></table></div><h1 id="序列使用"><a href="#序列使用" class="headerlink" title="序列使用"></a>序列使用</h1><p>MySQL 序列是一组整数：<code>1, 2, 3, ...</code>，由于一张数据表只能有一个字段自增主键，如果你想实现其他字段也实现自动增加，就可以使用 MySQL 序列来实现。</p><h2 id="使用-AUTO-INCREMENT"><a href="#使用-AUTO-INCREMENT" class="headerlink" title="使用 AUTO_INCREMENT"></a>使用 AUTO_INCREMENT</h2><p>MySQL 中最简单使用序列的方法就是使用 <code>AUTO_INCREMENT</code> 来定义列。</p><p>以下实例中创建了数据表 <code>insect</code>，<code>insect</code> 表中 <code>id</code> 无需指定值可实现自动增长。</p><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">mysql<span class="token operator">></span> <span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> insect    <span class="token operator">-</span><span class="token operator">></span> <span class="token punctuation">(</span>    <span class="token operator">-</span><span class="token operator">></span> id <span class="token keyword">INT</span> <span class="token keyword">UNSIGNED</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token punctuation">,</span>    <span class="token operator">-</span><span class="token operator">></span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token operator">-</span><span class="token operator">></span> name <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span> <span class="token comment"># type of insect</span>    <span class="token operator">-</span><span class="token operator">></span> <span class="token keyword">date</span> <span class="token keyword">DATE</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span> <span class="token comment"># date collected</span>    <span class="token operator">-</span><span class="token operator">></span> origin <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token comment"># where collected</span><span class="token punctuation">)</span><span class="token punctuation">;</span>Query OK<span class="token punctuation">,</span> <span class="token number">0</span> <span class="token keyword">rows</span> affected <span class="token punctuation">(</span><span class="token number">0.02</span> sec<span class="token punctuation">)</span>mysql<span class="token operator">></span> <span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> insect <span class="token punctuation">(</span>id<span class="token punctuation">,</span> name<span class="token punctuation">,</span> <span class="token keyword">date</span><span class="token punctuation">,</span> origin<span class="token punctuation">)</span> <span class="token keyword">VALUES</span>    <span class="token operator">-</span><span class="token operator">></span> <span class="token punctuation">(</span><span class="token boolean">NULL</span><span class="token punctuation">,</span> <span class="token string">'housefly'</span><span class="token punctuation">,</span> <span class="token string">'2001-09-10'</span><span class="token punctuation">,</span> <span class="token string">'kitchen'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token operator">-</span><span class="token operator">></span> <span class="token punctuation">(</span><span class="token boolean">NULL</span><span class="token punctuation">,</span> <span class="token string">'millipede'</span><span class="token punctuation">,</span> <span class="token string">'2001-09-10'</span><span class="token punctuation">,</span> <span class="token string">'driveway'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token operator">-</span><span class="token operator">></span> <span class="token punctuation">(</span><span class="token boolean">NULL</span><span class="token punctuation">,</span> <span class="token string">'grasshopper'</span><span class="token punctuation">,</span> <span class="token string">'2001-09-10'</span><span class="token punctuation">,</span> <span class="token string">'front yard'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>Query OK<span class="token punctuation">,</span> <span class="token number">3</span> <span class="token keyword">rows</span> affected <span class="token punctuation">(</span><span class="token number">0.02</span> sec<span class="token punctuation">)</span>Records: <span class="token number">3</span>  Duplicates: <span class="token number">0</span>  <span class="token keyword">Warnings</span>: <span class="token number">0</span>mysql<span class="token operator">></span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> insect <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> id<span class="token punctuation">;</span><span class="token operator">+</span><span class="token comment">----+-------------+------------+------------+</span><span class="token operator">|</span> id <span class="token operator">|</span> name        <span class="token operator">|</span> <span class="token keyword">date</span>       <span class="token operator">|</span> origin     <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">----+-------------+------------+------------+</span><span class="token operator">|</span>  <span class="token number">1</span> <span class="token operator">|</span> housefly    <span class="token operator">|</span> <span class="token number">2001</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">10</span> <span class="token operator">|</span> kitchen    <span class="token operator">|</span><span class="token operator">|</span>  <span class="token number">2</span> <span class="token operator">|</span> millipede   <span class="token operator">|</span> <span class="token number">2001</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">10</span> <span class="token operator">|</span> driveway   <span class="token operator">|</span><span class="token operator">|</span>  <span class="token number">3</span> <span class="token operator">|</span> grasshopper <span class="token operator">|</span> <span class="token number">2001</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">10</span> <span class="token operator">|</span> front yard <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">----+-------------+------------+------------+</span><span class="token number">3</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h2 id="获取AUTO-INCREMENT值"><a href="#获取AUTO-INCREMENT值" class="headerlink" title="获取AUTO_INCREMENT值"></a>获取AUTO_INCREMENT值</h2><p>在 MySQL 的客户端中你可以使用 SQL 中的 <code>LAST_INSERT_ID( )</code> 函数来获取最后的插入表中的自增列的值。</p><h2 id="重置序列"><a href="#重置序列" class="headerlink" title="重置序列"></a>重置序列</h2><p>如果你删除了数据表中的多条记录，并希望对剩下数据的 <code>AUTO_INCREMENT</code> 列进行重新排列，那么你可以通过删除自增的列，然后重新添加来实现。不过该操作要非常小心，如果在删除的同时又有新记录添加，有可能会出现数据混乱。操作如下所示：</p><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">mysql<span class="token operator">></span> <span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> insect <span class="token keyword">DROP</span> id<span class="token punctuation">;</span>mysql<span class="token operator">></span> <span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> insect    <span class="token operator">-</span><span class="token operator">></span> <span class="token keyword">ADD</span> id <span class="token keyword">INT</span> <span class="token keyword">UNSIGNED</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span> <span class="token keyword">FIRST</span><span class="token punctuation">,</span>    <span class="token operator">-</span><span class="token operator">></span> <span class="token keyword">ADD</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></p><h2 id="设置序列的开始值"><a href="#设置序列的开始值" class="headerlink" title="设置序列的开始值"></a>设置序列的开始值</h2><p>一般情况下序列的开始值为 1，但如果你需要指定一个开始值 100，那我们可以通过以下语句来实现：</p><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">mysql<span class="token operator">></span> <span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> insect    <span class="token operator">-</span><span class="token operator">></span> <span class="token punctuation">(</span>    <span class="token operator">-</span><span class="token operator">></span> id <span class="token keyword">INT</span> <span class="token keyword">UNSIGNED</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token punctuation">,</span>    <span class="token operator">-</span><span class="token operator">></span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token operator">-</span><span class="token operator">></span> name <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>    <span class="token operator">-</span><span class="token operator">></span> <span class="token keyword">date</span> <span class="token keyword">DATE</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>    <span class="token operator">-</span><span class="token operator">></span> origin <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">)</span><span class="token keyword">engine</span><span class="token operator">=</span><span class="token keyword">innodb</span> <span class="token keyword">auto_increment</span><span class="token operator">=</span><span class="token number">100</span> <span class="token keyword">charset</span><span class="token operator">=</span>utf8<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p>或者你也可以在表创建成功后，通过以下语句来实现：</p><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">mysql<span class="token operator">></span> <span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> t <span class="token keyword">AUTO_INCREMENT</span> <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><h1 id="处理重复数据"><a href="#处理重复数据" class="headerlink" title="处理重复数据"></a>处理重复数据</h1><p>有些 MySQL 数据表中可能存在重复的记录，有些情况我们允许重复数据的存在，但有时候我们也需要删除这些重复的数据。</p><p>本章节我们将为大家介绍如何防止数据表出现重复数据及如何删除数据表中的重复数据。</p><h2 id="防止表中出现重复数据"><a href="#防止表中出现重复数据" class="headerlink" title="防止表中出现重复数据"></a>防止表中出现重复数据</h2><p>你可以在 MySQL 数据表中设置指定的字段为 <code>PRIMARY KEY</code>（主键） 或者 <code>UNIQUE</code>（唯一） 索引来保证数据的唯一性。</p><p>让我们尝试一个实例：下表中无索引及主键，所以该表允许出现多条重复记录。</p><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> person_tbl<span class="token punctuation">(</span>    first_name <span class="token keyword">CHAR</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    last_name <span class="token keyword">CHAR</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    sex <span class="token keyword">CHAR</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p>如果你想设置表中字段 <code>first_name</code>，<code>last_name</code> 数据不能重复，你可以设置双主键模式来设置数据的唯一性，如果你设置了双主键，那么那个键的默认值不能为 <code>NULL</code>，可设置为 <code>NOT NULL</code>。如下所示：</p><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> person_tbl<span class="token punctuation">(</span>   first_name <span class="token keyword">CHAR</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>   last_name <span class="token keyword">CHAR</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>   sex <span class="token keyword">CHAR</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span>   <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span>last_name<span class="token punctuation">,</span> first_name<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p>如果我们设置了唯一索引，那么在插入重复数据时，SQL 语句将无法执行成功，并抛出错误。</p><p><code>INSERT IGNORE INTO</code> 与 <code>INSERT INTO</code> 的区别就是 <code>INSERT IGNORE INTO</code> 会忽略数据库中已经存在的数据，如果数据库没有数据，就插入新的数据，如果有数据的话就跳过这条数据。这样就可以保留数据库中已经存在数据，达到在间隙中插入数据的目的。</p><p>以下实例使用了 <code>INSERT IGNORE INTO</code>，执行后不会出错，也不会向数据表中插入重复数据：</p><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">mysql<span class="token operator">></span> <span class="token keyword">INSERT</span> <span class="token keyword">IGNORE</span> <span class="token keyword">INTO</span> person_tbl <span class="token punctuation">(</span>last_name<span class="token punctuation">,</span> first_name<span class="token punctuation">)</span>    <span class="token operator">-</span><span class="token operator">></span> <span class="token keyword">VALUES</span><span class="token punctuation">(</span> <span class="token string">'Jay'</span><span class="token punctuation">,</span> <span class="token string">'Thomas'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>Query OK<span class="token punctuation">,</span> <span class="token number">1</span> <span class="token keyword">row</span> affected <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>mysql<span class="token operator">></span> <span class="token keyword">INSERT</span> <span class="token keyword">IGNORE</span> <span class="token keyword">INTO</span> person_tbl <span class="token punctuation">(</span>last_name<span class="token punctuation">,</span> first_name<span class="token punctuation">)</span>    <span class="token operator">-</span><span class="token operator">></span> <span class="token keyword">VALUES</span><span class="token punctuation">(</span> <span class="token string">'Jay'</span><span class="token punctuation">,</span> <span class="token string">'Thomas'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>Query OK<span class="token punctuation">,</span> <span class="token number">0</span> <span class="token keyword">rows</span> affected <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p><code>INSERT IGNORE INTO</code> 当插入数据时，在设置了记录的唯一性后，如果插入重复数据，将不返回错误，只以警告形式返回。而 <code>REPLACE INTO</code> 如果存在 <code>PRIMARY</code> 或 <code>UNIQUE</code> 相同的记录，则先删除掉。再插入新记录。</p><p>另一种设置数据的唯一性方法是添加一个 <code>UNIQUE</code> 索引，如下所示：</p><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> person_tbl<span class="token punctuation">(</span>   first_name <span class="token keyword">CHAR</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>   last_name <span class="token keyword">CHAR</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>   sex <span class="token keyword">CHAR</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span>   <span class="token keyword">UNIQUE</span> <span class="token punctuation">(</span>last_name<span class="token punctuation">,</span> first_name<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h2 id="统计重复数据"><a href="#统计重复数据" class="headerlink" title="统计重复数据"></a>统计重复数据</h2><p>以下我们将统计表中 <code>first_name</code> 和 <code>last_name</code> 的重复记录数：</p><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">mysql<span class="token operator">></span> <span class="token keyword">SELECT</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">as</span> repetitions<span class="token punctuation">,</span> last_name<span class="token punctuation">,</span> first_name    <span class="token operator">-</span><span class="token operator">></span> <span class="token keyword">FROM</span> person_tbl    <span class="token operator">-</span><span class="token operator">></span> <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> last_name<span class="token punctuation">,</span> first_name    <span class="token operator">-</span><span class="token operator">></span> <span class="token keyword">HAVING</span> repetitions <span class="token operator">></span> <span class="token number">1</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></p><p>以上查询语句将返回 <code>person_tbl</code> 表中重复的记录数。一般情况下，查询重复的值，请执行以下操作：</p><ul><li>确定哪一列包含的值可能会重复。</li><li>在列选择列表使用 <code>COUNT(*)</code> 列出的那些列。</li><li>在 <code>GROUP BY</code> 子句中列出的列。</li><li><code>HAVING</code> 子句设置重复数大于1。</li></ul><h2 id="过滤重复数据"><a href="#过滤重复数据" class="headerlink" title="过滤重复数据"></a>过滤重复数据</h2><p>如果你需要读取不重复的数据可以在 <code>SELECT</code> 语句中使用 <code>DISTINCT</code> 关键字来过滤重复数据。</p><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">mysql<span class="token operator">></span> <span class="token keyword">SELECT</span> <span class="token keyword">DISTINCT</span> last_name<span class="token punctuation">,</span> first_name    <span class="token operator">-</span><span class="token operator">></span> <span class="token keyword">FROM</span> person_tbl<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></p><p>你也可以使用 <code>GROUP BY</code> 来读取数据表中不重复的数据：</p><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">mysql<span class="token operator">></span> <span class="token keyword">SELECT</span> last_name<span class="token punctuation">,</span> first_name    <span class="token operator">-</span><span class="token operator">></span> <span class="token keyword">FROM</span> person_tbl    <span class="token operator">-</span><span class="token operator">></span> <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> <span class="token punctuation">(</span>last_name<span class="token punctuation">,</span> first_name<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></p><h2 id="删除重复数据"><a href="#删除重复数据" class="headerlink" title="删除重复数据"></a>删除重复数据</h2><p>如果你想删除数据表中的重复数据，你可以使用以下的 SQL 语句：</p><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">mysql<span class="token operator">></span> <span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> tmp    <span class="token operator">-</span><span class="token operator">></span> <span class="token keyword">SELECT</span> last_name<span class="token punctuation">,</span> first_name<span class="token punctuation">,</span> sex    <span class="token operator">-</span><span class="token operator">></span> <span class="token keyword">FROM</span> person_tbl    <span class="token operator">-</span><span class="token operator">></span> <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> <span class="token punctuation">(</span>last_name<span class="token punctuation">,</span> first_name<span class="token punctuation">,</span> sex<span class="token punctuation">)</span><span class="token punctuation">;</span>mysql<span class="token operator">></span> <span class="token keyword">DROP</span> <span class="token keyword">TABLE</span> person_tbl<span class="token punctuation">;</span>mysql<span class="token operator">></span> <span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> tmp <span class="token keyword">RENAME</span> <span class="token keyword">TO</span> person_tbl<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p>当然你也可以在数据表中添加 <code>INDEX</code>（索引） 和 <code>PRIMARY KEY</code>（主键）这种简单的方法来删除表中的重复记录。方法如下：</p><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">mysql<span class="token operator">></span> <span class="token keyword">ALTER</span> <span class="token keyword">IGNORE</span> <span class="token keyword">TABLE</span> person_tbl    <span class="token operator">-</span><span class="token operator">></span> <span class="token keyword">ADD</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span>last_name<span class="token punctuation">,</span> first_name<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></p><h1 id="及-SQL-注入"><a href="#及-SQL-注入" class="headerlink" title="及 SQL 注入"></a>及 SQL 注入</h1><p>如果您通过网页获取用户输入的数据并将其插入一个 MySQL 数据库，那么就有可能发生 SQL 注入安全的问题。</p><p>本章节将为大家介绍如何防止 SQL 注入，并通过脚本来过滤 SQL 中注入的字符。</p><p>所谓 SQL 注入，就是通过把 SQL 命令插入到 Web 表单递交或输入域名或页面请求的查询字符串，最终达到欺骗服务器执行恶意的 SQL 命令。</p><p>我们永远不要信任用户的输入，我们必须认定用户输入的数据都是不安全的，我们都需要对用户输入的数据进行过滤处理。</p><p>以下实例中，输入的用户名必须为字母、数字及下划线的组合，且用户名长度为 8 到 20 个字符之间：</p><p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">if (preg_match(&quot;&#x2F;^\w&#123;8, 20&#125;$&#x2F;&quot;, $_GET[&#39;username&#39;], $matches))&#123;   $result &#x3D; mysqli_query($conn, &quot;SELECT * FROM users                           WHERE username&#x3D;$matches[0]&quot;);&#125; else &#123;   echo &quot;username 输入异常&quot;;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p>让我们看下在没有过滤特殊字符时，出现的 SQL 情况：</p><p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token comment">// 设定 $name 中插入了我们不需要的SQL语句</span><span class="token variable">$name</span> <span class="token operator">=</span> <span class="token double-quoted-string string">"Qadir'; DELETE FROM users;"</span><span class="token punctuation">;</span><span class="token function">mysqli_query</span><span class="token punctuation">(</span><span class="token variable">$conn</span><span class="token punctuation">,</span> <span class="token double-quoted-string string">"SELECT * FROM users WHERE name='<span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token variable">$name</span><span class="token punctuation">&#125;</span></span>'"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></p><p>以上的注入语句中，我们没有对 <code>$name</code> 的变量进行过滤，<code>$name</code> 中插入了我们不需要的 SQL 语句，将删除 <code>users</code> 表中的所有数据。</p><p>在 PHP 中的 <code>mysqli_query()</code> 是不允许执行多个 SQL 语句的，但是在 <code>SQLite</code> 和 <code>PostgreSQL</code> 是可以同时执行多条 SQL 语句的，所以我们对这些用户的数据需要进行严格的验证。</p><p><strong>防止SQL注入，我们需要注意以下几个要点：</strong></p><ol><li>永远不要信任用户的输入。对用户的输入进行校验，可以通过正则表达式，或限制长度；对单引号和 双&quot;-&quot;进行转换等。</li><li>永远不要使用动态拼装sql，可以使用参数化的sql或者直接使用存储过程进行数据查询存取。</li><li>永远不要使用管理员权限的数据库连接，为每个应用使用单独的权限有限的数据库连接。</li><li>不要把机密信息直接存放，加密或者hash掉密码和敏感的信息。</li><li>应用的异常信息应该给出尽可能少的提示，最好使用自定义的错误信息对原始错误信息进行包装</li><li>SQL 注入的检测方法一般采取辅助软件或网站平台来检测，软件一般采用 SQL 注入检测工具jsky，网站平台就有亿思网站安全平台检测工具。MDCSOFT SCAN 等。采用 MDCSOFT-IPS 可以有效的防御 SQL 注入，XSS 攻击等。</li></ol><h2 id="防止SQL注入"><a href="#防止SQL注入" class="headerlink" title="防止SQL注入"></a>防止SQL注入</h2><p>在脚本语言，如 Perl 和 PHP 你可以对用户输入的数据进行转义从而来防止 SQL 注入。</p><p>PHP 的 MySQL 扩展提供了 <code>mysqli_real_escape_string()</code> 函数来转义特殊的输入字符。</p><p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">get_magic_quotes_gpc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token variable">$name</span> <span class="token operator">=</span> <span class="token function">stripslashes</span><span class="token punctuation">(</span><span class="token variable">$name</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token variable">$name</span> <span class="token operator">=</span> <span class="token function">mysqli_real_escape_string</span><span class="token punctuation">(</span><span class="token variable">$conn</span><span class="token punctuation">,</span> <span class="token variable">$name</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token function">mysqli_query</span><span class="token punctuation">(</span><span class="token variable">$conn</span><span class="token punctuation">,</span> <span class="token double-quoted-string string">"SELECT * FROM users WHERE name='<span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token variable">$name</span><span class="token punctuation">&#125;</span></span>'"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h2 id="LIKE-语句中的注入"><a href="#LIKE-语句中的注入" class="headerlink" title="LIKE 语句中的注入"></a>LIKE 语句中的注入</h2><p><code>LIKE</code> 查询时，如果用户输入的值有 <code>_</code> 和 <code>%</code>，则会出现这种情况：用户本来只是想查询 <code>abcd_</code>，查询结果中却有 <code>abcd_</code>、<code>abcde</code>、<code>abcdf</code> 等等；用户要查询 <code>30%</code>（注：百分之三十）时也会出现问题。</p><p>在PHP脚本中我们可以使用 <code>addcslashes()</code> 函数来处理以上情况，如下实例：</p><p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token variable">$sub</span> <span class="token operator">=</span> <span class="token function">addcslashes</span><span class="token punctuation">(</span><span class="token function">mysqli_real_escape_string</span><span class="token punctuation">(</span><span class="token variable">$conn</span><span class="token punctuation">,</span> <span class="token double-quoted-string string">"%something_"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token double-quoted-string string">"%_"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// $sub == \%something\_</span> <span class="token function">mysqli_query</span><span class="token punctuation">(</span><span class="token variable">$conn</span><span class="token punctuation">,</span> <span class="token double-quoted-string string">"SELECT * FROM messages WHERE subject LIKE '<span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token variable">$sub</span><span class="token punctuation">&#125;</span></span>%'"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></p><p><code>addcslashes()</code> 函数在指定的字符前添加反斜杠。</p><p>语法格式:</p><p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token function">addcslashes</span><span class="token punctuation">(</span>string<span class="token punctuation">,</span> characters<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><h1 id="导出数据"><a href="#导出数据" class="headerlink" title="导出数据"></a>导出数据</h1><p>MySQL 中你可以使用 <code>SELECT...INTO OUTFILE</code> 语句来简单的导出数据到文本文件上。</p><h2 id="使用-SELECT-INTO-OUTFILE-语句导出数据"><a href="#使用-SELECT-INTO-OUTFILE-语句导出数据" class="headerlink" title="使用 SELECT ... INTO OUTFILE 语句导出数据"></a>使用 SELECT ... INTO OUTFILE 语句导出数据</h2><p>以下实例中我们将数据表 <code>tbl</code> 数据导出到 <code>/tmp/TestDB.txt</code> 文件中:</p><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">mysql<span class="token operator">></span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> tbl     <span class="token operator">-</span><span class="token operator">></span> <span class="token keyword">INTO</span> <span class="token keyword">OUTFILE</span> <span class="token string">'/tmp/TestDB.txt'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></p><p>你可以通过命令选项来设置数据输出的指定格式，以下实例为导出 <code>CSV</code> 格式：</p><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">mysql<span class="token operator">></span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> passwd <span class="token keyword">INTO</span> <span class="token keyword">OUTFILE</span> <span class="token string">'/tmp/TestDB.txt'</span>    <span class="token operator">-</span><span class="token operator">></span> <span class="token keyword">FIELDS</span> <span class="token keyword">TERMINATED</span> <span class="token keyword">BY</span> <span class="token string">','</span> <span class="token keyword">ENCLOSED</span> <span class="token keyword">BY</span> <span class="token string">'"'</span>    <span class="token operator">-</span><span class="token operator">></span> <span class="token keyword">LINES</span> <span class="token keyword">TERMINATED</span> <span class="token keyword">BY</span> <span class="token string">'\r\n'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></p><p>在下面的例子中，生成一个文件，各值用逗号隔开。这种格式可以被许多程序使用。</p><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> a<span class="token operator">+</span>b <span class="token keyword">INTO</span> <span class="token keyword">OUTFILE</span> <span class="token string">'/tmp/result.text'</span><span class="token keyword">FIELDS</span> <span class="token keyword">TERMINATED</span> <span class="token keyword">BY</span> <span class="token string">','</span> <span class="token keyword">OPTIONALLY</span> <span class="token keyword">ENCLOSED</span> <span class="token keyword">BY</span> <span class="token string">'"'</span><span class="token keyword">LINES</span> <span class="token keyword">TERMINATED</span> <span class="token keyword">BY</span> <span class="token string">'\n'</span><span class="token keyword">FROM</span> <span class="token keyword">table</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></p><p><strong><code>SELECT ... INTO OUTFILE</code> 语句有以下属性:</strong></p><ul><li><code>LOAD DATA INFILE</code> 是 <code>SELECT ... INTO OUTFILE</code> 的逆操作，<code>SELECT</code> 句法。为了将一个数据库的数据写入一个文件，使用 <code>SELECT ... INTO OUTFILE</code>；为了将文件读回数据库，使用 <code>LOAD DATA INFILE</code>。</li><li><code>SELECT...INTO OUTFILE &#39;file_name&#39;</code> 形式的 <code>SELECT</code> 可以把被选择的行写入一个文件中。该文件被创建到服务器主机上，因此您必须拥有 <code>FILE</code> 权限，才能使用此语法。</li><li>输出不能是一个已存在的文件。防止文件数据被篡改。</li><li>你需要有一个登陆服务器的账号来检索文件。否则 <code>SELECT ... INTO OUTFILE</code> 不会起任何作用。</li><li>在 <code>UNIX</code> 中，该文件被创建后是可读的，权限由 MySQL 服务器所拥有。这意味着，虽然你就可以读取该文件，但可能无法将其删除。</li></ul><h2 id="导出表作为原始数据"><a href="#导出表作为原始数据" class="headerlink" title="导出表作为原始数据"></a>导出表作为原始数据</h2><p><code>mysqldump</code> 是 MySQL 用于转存储数据库的实用程序。它主要产生一个 SQL 脚本，其中包含从头重新创建数据库所必需的命令 <code>CREATE TABLE INSERT</code> 等。</p><p>使用 <code>mysqldump</code> 导出数据需要使用 <code>--tab</code> 选项来指定导出文件指定的目录，该目标必须是可写的。</p><p>以下实例将数据表 <code>tbl</code> 导出到 <code>/tmp</code> 目录中：</p><p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">$ mysqldump -u root -p --no-create-info --tab&#x3D;&#x2F;tmp TestDB tblpassword ******<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></p><h2 id="导出-SQL-格式的数据"><a href="#导出-SQL-格式的数据" class="headerlink" title="导出 SQL 格式的数据"></a>导出 SQL 格式的数据</h2><p>导出 SQL 格式的数据到指定文件，如下所示：</p><p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">$ mysqldump -u root -p TestDB tbl &gt; dump.txtpassword ******<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></p><p>以上命令创建的文件内容如下：</p><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token comment">-- MySQL dump 8.23</span><span class="token comment">--</span><span class="token comment">-- Host: localhost    Database: TestDB</span><span class="token comment">---------------------------------------------------------</span><span class="token comment">-- Server version       3.23.58</span><span class="token comment">--</span><span class="token comment">-- Table structure for table `tbl`</span><span class="token comment">--</span><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> tbl <span class="token punctuation">(</span>  id <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">auto_increment</span><span class="token punctuation">,</span>  title <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">default</span> <span class="token string">''</span><span class="token punctuation">,</span>  author <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">40</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">default</span> <span class="token string">''</span><span class="token punctuation">,</span>  submission_date <span class="token keyword">date</span> <span class="token keyword">default</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span>  <span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token keyword">UNIQUE</span> <span class="token keyword">KEY</span> AUTHOR_INDEX <span class="token punctuation">(</span>author<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">TYPE</span><span class="token operator">=</span>MyISAM<span class="token punctuation">;</span><span class="token comment">--</span><span class="token comment">-- Dumping data for table `tbl`</span><span class="token comment">--</span><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> tbl        <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">'Learn PHP'</span><span class="token punctuation">,</span><span class="token string">'John Poul'</span><span class="token punctuation">,</span><span class="token string">'2007-05-24'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> tbl        <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">'Learn MySQL'</span><span class="token punctuation">,</span><span class="token string">'Abdul S'</span><span class="token punctuation">,</span><span class="token string">'2007-05-24'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> tbl        <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token string">'JAVA Tutorial'</span><span class="token punctuation">,</span><span class="token string">'Sanjay'</span><span class="token punctuation">,</span><span class="token string">'2007-05-06'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p>如果你需要导出整个数据库的数据，可以使用以下命令：</p><p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">$ mysqldump -u root -p TestDB &gt; database_dump.txtpassword ******<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></p><p>如果需要备份所有数据库，可以使用以下命令：</p><p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">$ mysqldump -u root -p --all-databases &gt; database_dump.txtpassword ******<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></p><p><code>--all-databases</code> 选项在 MySQL 3.23.12 及以后版本加入。</p><p>该方法可用于实现数据库的备份策略。</p><h2 id="将数据表及数据库拷贝至其他主机"><a href="#将数据表及数据库拷贝至其他主机" class="headerlink" title="将数据表及数据库拷贝至其他主机"></a>将数据表及数据库拷贝至其他主机</h2><p>如果你需要将数据拷贝至其他的 MySQL 服务器上, 你可以在 <code>mysqldump</code> 命令中指定数据库名及数据表。</p><p>在源主机上执行以下命令，将数据备份至 <code>dump.txt</code> 文件中:</p><p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">$ mysqldump -u root -p database_name table_name &gt; dump.txtpassword *****<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></p><p>如果完整备份数据库，则无需使用特定的表名称。</p><p>如果你需要将备份的数据库导入到 MySQL 服务器中，可以使用以下命令，使用以下命令你需要确认数据库已经创建：</p><p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">$ mysql -u root -p database_name &lt; dump.txtpassword *****<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></p><p>你也可以使用以下命令将导出的数据直接导入到远程的服务器上，但请确保两台服务器是相通的，是可以相互访问的：</p><p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">$ mysqldump -u root -p database_name \       | mysql -h other-host.com database_name<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></p><p>以上命令中使用了管道来将导出的数据导入到指定的远程主机上。</p><h1 id="导入数据"><a href="#导入数据" class="headerlink" title="导入数据"></a>导入数据</h1><h2 id="mysql-命令导入"><a href="#mysql-命令导入" class="headerlink" title="mysql 命令导入"></a>mysql 命令导入</h2><p>使用 <code>mysql</code> 命令导入语法格式为：</p><p><code>mysql -u用户名 -p密码 &lt; 要导入的数据库数据(TestDB.sql)</code></p><p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">$ mysql -uroot -p123456 &lt; TestDB.sql<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><p>以上命令将将备份的整个数据库 <code>TestDB.sql</code> 导入。</p><h2 id="source-命令导入"><a href="#source-命令导入" class="headerlink" title="source 命令导入"></a>source 命令导入</h2><p><code>source</code> 命令导入数据库需要先登录到数库终端：</p><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">mysql<span class="token operator">></span> <span class="token keyword">CREATE</span> <span class="token keyword">DATABASE</span> abc<span class="token punctuation">;</span>      <span class="token comment"># 创建数据库</span>mysql<span class="token operator">></span> <span class="token keyword">USE</span> abc<span class="token punctuation">;</span>                  <span class="token comment"># 使用已创建的数据库 </span>mysql<span class="token operator">></span> <span class="token keyword">SET</span> names utf8<span class="token punctuation">;</span>           <span class="token comment"># 设置编码</span>mysql<span class="token operator">></span> source <span class="token operator">/</span>home<span class="token operator">/</span>abc<span class="token operator">/</span>abc<span class="token punctuation">.</span><span class="token keyword">sql</span>  <span class="token comment"># 导入备份数据库</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></p><h2 id="使用-LOAD-DATA-导入数据"><a href="#使用-LOAD-DATA-导入数据" class="headerlink" title="使用 LOAD DATA 导入数据"></a>使用 LOAD DATA 导入数据</h2><p>MySQL 中提供了<code>LOAD DATA INFILE</code> 语句来插入数据。 以下实例中将从当前目录中读取文件 <code>dump.txt</code>，将该文件中的数据插入到当前数据库的 <code>mytbl</code> 表中。</p><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">mysql<span class="token operator">></span> <span class="token keyword">LOAD</span> <span class="token keyword">DATA</span> <span class="token keyword">LOCAL</span> <span class="token keyword">INFILE</span> <span class="token string">'dump.txt'</span> <span class="token keyword">INTO</span> <span class="token keyword">TABLE</span> mytbl<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><p>如果指定 <code>LOCAL</code> 关键词，则表明从客户主机上按路径读取文件。如果没有指定，则文件在服务器上按路径读取文件。</p><p>你能明确地在 <code>LOAD DATA</code> 语句中指出列值的分隔符和行尾标记，但是默认标记是定位符和换行符。</p><p>两个命令的 <code>FIELDS</code> 和 <code>LINES</code> 子句的语法是一样的。两个子句都是可选的，但是如果两个同时被指定，<code>FIELDS</code> 子句必须出现在 <code>LINES</code> 子句之前。</p><p>如果用户指定一个 <code>FIELDS</code> 子句，它的子句（<code>TERMINATED BY</code>、<code>[OPTIONALLY] ENCLOSED BY</code> 和 <code>ESCAPED BY</code>）也是可选的，不过，用户必须至少指定它们中的一个。</p><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">mysql<span class="token operator">></span> <span class="token keyword">LOAD</span> <span class="token keyword">DATA</span> <span class="token keyword">LOCAL</span> <span class="token keyword">INFILE</span> <span class="token string">'dump.txt'</span> <span class="token keyword">INTO</span> <span class="token keyword">TABLE</span> mytbl    <span class="token operator">-</span><span class="token operator">></span> <span class="token keyword">FIELDS</span> <span class="token keyword">TERMINATED</span> <span class="token keyword">BY</span> <span class="token string">':'</span>    <span class="token operator">-</span><span class="token operator">></span> <span class="token keyword">LINES</span> <span class="token keyword">TERMINATED</span> <span class="token keyword">BY</span> <span class="token string">'\r\n'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></p><p><code>LOAD DATA</code> 默认情况下是按照数据文件中列的顺序插入数据的，如果数据文件中的列与插入表中的列不一致，则需要指定列的顺序。</p><p>如，在数据文件中的列顺序是 <code>a, b, c</code>，但在插入表的列顺序为 <code>b, c, a</code>，则数据导入语法如下：</p><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">mysql<span class="token operator">></span> <span class="token keyword">LOAD</span> <span class="token keyword">DATA</span> <span class="token keyword">LOCAL</span> <span class="token keyword">INFILE</span> <span class="token string">'dump.txt'</span>     <span class="token operator">-</span><span class="token operator">></span> <span class="token keyword">INTO</span> <span class="token keyword">TABLE</span> mytbl <span class="token punctuation">(</span>b<span class="token punctuation">,</span> c<span class="token punctuation">,</span> a<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></p><h2 id="使用-mysqlimport-导入数据"><a href="#使用-mysqlimport-导入数据" class="headerlink" title="使用 mysqlimport 导入数据"></a>使用 mysqlimport 导入数据</h2><p><code>mysqlimport</code> 客户端提供了 <code>LOAD DATA INFILEQL</code> 语句的一个命令行接口。<code>mysqlimport</code> 的大多数选项直接对应 <code>LOAD DATA INFILE</code> 子句。</p><p>从文件 <code>dump.txt</code> 中将数据导入到 <code>mytbl</code> 数据表中, 可以使用以下命令：</p><p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">$ mysqlimport -u root -p --local mytbl dump.txtpassword *****<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></p><p><code>mysqlimport</code> 命令可以指定选项来设置指定格式,命令语句格式如下：</p><p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">$ mysqlimport -u root -p --local --fields-terminated-by&#x3D;&quot;:&quot; \   --lines-terminated-by&#x3D;&quot;\r\n&quot;  mytbl dump.txtpassword *****<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></p><p><code>mysqlimport</code> 语句中使用 <code>--columns</code> 选项来设置列的顺序：</p><p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">$ mysqlimport -u root -p --local --columns&#x3D;b,c,a \    mytbl dump.txtpassword *****<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></p><p><strong>mysqlimport 的常用选项介绍</strong></p><div class="table-container"><table><thead><tr><th style="text-align:center">选项</th><th style="text-align:center">功能</th></tr></thead><tbody><tr><td style="text-align:center">-d or --delete</td><td style="text-align:center">新数据导入数据表中之前删除数据数据表中的所有信息</td></tr><tr><td style="text-align:center">-f or --force</td><td style="text-align:center">不管是否遇到错误，mysqlimport 将强制继续插入数据</td></tr><tr><td style="text-align:center">-i or --ignore</td><td style="text-align:center">mysqlimport 跳过或者忽略那些有相同唯一关键字的行，<br>导入文件中的数据将被忽略。</td></tr><tr><td style="text-align:center">-l or -lock-tables</td><td style="text-align:center">数据被插入之前锁住表，这样就防止了在更新数据库时，<br>用户的查询和更新受到影响。</td></tr><tr><td style="text-align:center">-r or -replace</td><td style="text-align:center">这个选项与 -i 选项的作用相反；<br>此选项将替代表中有相同唯一关键字的记录。</td></tr><tr><td style="text-align:center">--fields -enclosed -by=char</td><td style="text-align:center">指定文本文件中数据的记录时以什么括起的，<br>很多情况下数据以双引号括起。<br>默认的情况下数据是没有被字符括起的。</td></tr><tr><td style="text-align:center">--fields -terminated -by=char</td><td style="text-align:center">指定各个数据的值之间的分隔符，在句号分隔的文件中，分隔符是句号。<br>可以用此选项指定数据之间的分隔符。默认的分隔符是跳格符（Tab）</td></tr><tr><td style="text-align:center">--lines -terminated -by=str</td><td style="text-align:center">此选项指定文本文件中行与行之间数据的分隔字符串或者字符。<br>默认的情况下 mysqlimport 以 newline 为行分隔符。<br>您可以选择用一个字符串来替代一个单个的字符： 一个新行或者一个回车。</td></tr></tbody></table></div><p><code>mysqlimport</code> 命令常用的选项还有 <code>-v</code> 显示版本（version），<code>-p</code> 提示输入密码（password）等。</p><h1 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h1><h2 id="字符串函数"><a href="#字符串函数" class="headerlink" title="字符串函数"></a>字符串函数</h2><div class="table-container"><table><thead><tr><th style="text-align:center">函数</th><th style="text-align:center">描述</th><th style="text-align:center">实例</th></tr></thead><tbody><tr><td style="text-align:center">ASCII(s)</td><td style="text-align:center">返回字符串 s 的第一个字符的 ASCII 码。</td><td style="text-align:center">返回 CustomerName 字段第一个字母的 ASCII 码： <br> <code>SELECT ASCII(CustomerName) AS NumCodeOfFirstChar FROM Customers;</code></td></tr><tr><td style="text-align:center">CHAR_LENGTH(s)</td><td style="text-align:center">返回字符串 s 的字符数</td><td style="text-align:center">返回字符串 GOOGLE 的字符数： <br> <code>SELECT CHAR_LENGTH(&quot;GOOGLE&quot;) AS LengthOfString;</code></td></tr><tr><td style="text-align:center">CHARACTER_LENGTH(s)</td><td style="text-align:center">返回字符串 s 的字符数</td><td style="text-align:center">返回字符串 GOOGLE 的字符数： <br> <code>SELECT CHARACTER_LENGTH(&quot;GOOGLE&quot;) AS LengthOfString;</code></td></tr><tr><td style="text-align:center">CONCAT(s1, s2 ... sn)</td><td style="text-align:center">字符串 s1, s2 等多个字符串合并为一个字符串</td><td style="text-align:center">合并多个字符串： <br> <code>SELECT CONCAT(&quot;SQL &quot;, &quot;Baidu &quot;, &quot;Google &quot;, &quot;Facebook&quot;) AS ConcatenatedString;</code></td></tr><tr><td style="text-align:center">CONCAT_WS(x, s1, s2 ... sn)</td><td style="text-align:center">同 CONCAT(s1, s2, ...) 函数，但是每个字符串之间要加上 x，x 可以是分隔符</td><td style="text-align:center">合并多个字符串，并添加分隔符s： <br> <code>SELECT CONCAT_WS(&quot;-&quot;, &quot;SQL&quot;, &quot;Tutorial&quot;, &quot;is&quot;, &quot;fun!&quot;)AS ConcatenatedString;</code></td></tr><tr><td style="text-align:center">FIELD(s, s1, s2 ...)</td><td style="text-align:center">返回第一个字符串 s 在字符串列表(s1, s2 ...)中的位置</td><td style="text-align:center">返回字符串 c 在列表值中的位置： <br> <code>SELECT FIELD(&quot;c&quot;, &quot;a&quot;, &quot;b&quot;, &quot;c&quot;, &quot;d&quot;, &quot;e&quot;);  -- 3</code></td></tr><tr><td style="text-align:center">FIND_IN_SET(s1, s2)</td><td style="text-align:center">返回在字符串s2中与s1匹配的字符串的位置</td><td style="text-align:center">返回字符串 c 在指定字符串中的位置： <br> <code>SELECT FIND_IN_SET(&quot;c&quot;, &quot;a,b,c,d,e&quot;);  -- 5</code></td></tr><tr><td style="text-align:center">FORMAT(x, n)</td><td style="text-align:center">函数可以将数字 x 进行格式化 &quot;#,###.##&quot;, 将 x 保留到小数点后 n 位，最后一位四舍五入。</td><td style="text-align:center">格式化数字 &quot;#,###.##&quot; 形式： <br> <code>SELECT FORMAT(250500.5634, 2);  -- 250,500.56</code></td></tr><tr><td style="text-align:center">INSERT(s1, x, len, s2)</td><td style="text-align:center">字符串 s2 替换 s1 的 x 位置开始长度为 len 的字符串</td><td style="text-align:center">从字符串第一个位置开始的 6 个字符替换为 baidu： <br> <code>SELECT INSERT(&quot;google.com&quot;, 1, 6, &quot;baidu&quot;);  -- baidu.com</code></td></tr><tr><td style="text-align:center">LOCATE(s1, s)</td><td style="text-align:center">从字符串 s 中获取 s1 的开始位置</td><td style="text-align:center">获取 b 在字符串 abc 中的位置： <br> <code>SELECT LOCATE(&#39;st&#39;, &#39;myteststring&#39;);  -- 5</code> <br> 返回字符串 abc 中 b 的位置： <br> <code>SELECT LOCATE(&#39;b&#39;, &#39;abc&#39;);  -- 2</code></td></tr><tr><td style="text-align:center">LCASE(s)</td><td style="text-align:center">将字符串 s 的所有字母变成小写字母</td><td style="text-align:center">字符串 GOOGLE 转换为小写： <br> <code>SELECT LCASE(&#39;GOOGLE&#39;);  -- google</code></td></tr><tr><td style="text-align:center">LEFT(s, n)</td><td style="text-align:center">返回字符串 s 的前 n 个字符</td><td style="text-align:center">返回字符串 GOOGLE 中的前两个字符： <br> <code>SELECT LEFT(&#39;GOOGLE&#39;, 2);  -- GO</code></td></tr><tr><td style="text-align:center">LOWER(s)</td><td style="text-align:center">将字符串 s 的所有字母变成小写字母：</td><td style="text-align:center">字符串 GOOGLE 转换为小写： <br> <code>SELECT LOWER(&#39;GOOGLE&#39;);  -- google</code></td></tr><tr><td style="text-align:center">LPAD(s1, len, s2)</td><td style="text-align:center">在字符串 s1 的开始处填充字符串 s2，使字符串长度达到 len</td><td style="text-align:center">将字符串 xx 填充到 abc 字符串的开始处： <br> <code>SELECT LPAD(&#39;abc&#39;, 5,&#39;xx&#39;);  -- xxabc</code></td></tr><tr><td style="text-align:center">LTRIM(s)</td><td style="text-align:center">去掉字符串 s 开始处的空格</td><td style="text-align:center">去掉字符串 GOOGLE 开始处的空格： <br> <code>SELECT LTRIM(&quot;    GOOGLE&quot;) AS LeftTrimmedString;-- GOOGLE</code></td></tr><tr><td style="text-align:center">MID(s, n, len)</td><td style="text-align:center">从字符串 s 的 n 位置截取长度为 len 的子字符串，同 SUBSTRING(s, n, len)</td><td style="text-align:center">从字符串 GOOGLE 中的第 2 个位置截取 3个 字符： <br> <code>SELECT MID(&quot;GOOGLE&quot;, 2, 3) AS ExtractString;  -- OOG</code></td></tr><tr><td style="text-align:center">POSITION(s1 IN s)</td><td style="text-align:center">从字符串 s 中获取 s1 的开始位置</td><td style="text-align:center">返回字符串 abc 中 b 的位置： <br> <code>SELECT POSITION(&#39;b&#39; in &#39;abc&#39;);  -- 2</code></td></tr><tr><td style="text-align:center">REPEAT(s, n)</td><td style="text-align:center">将字符串 s 重复 n 次</td><td style="text-align:center">将字符串 GOOGLE 重复三次： <br> <code>SELECT REPEAT(&#39;GOOGLE&#39;, 3);  -- GOOGLEGOOGLEGOOGLE</code></td></tr><tr><td style="text-align:center">REPLACE(s, s1, s2)</td><td style="text-align:center">将字符串 s2 替代字符串 s 中的字符串 s1</td><td style="text-align:center">将字符串 abc 中的字符 a 替换为字符 x： <br> <code>SELECT REPLACE(&#39;abc&#39;,&#39;a&#39;,&#39;x&#39;);  -- xbc</code></td></tr><tr><td style="text-align:center">REVERSE(s)</td><td style="text-align:center">将字符串s的顺序反过来</td><td style="text-align:center">将字符串 abc 的顺序反过来： <br> <code>SELECT REVERSE(&#39;abc&#39;);  -- cba</code></td></tr><tr><td style="text-align:center">RIGHT(s, n)</td><td style="text-align:center">返回字符串 s 的后 n 个字符</td><td style="text-align:center">返回字符串 GOOGLE 的后两个字符： <br> <code>SELECT RIGHT(&#39;GOOGLE&#39;, 2);  -- LE</code></td></tr><tr><td style="text-align:center">RPAD(s1, len, s2)</td><td style="text-align:center">在字符串 s1 的结尾处添加字符串 s2，使字符串的长度达到 len</td><td style="text-align:center">将字符串 xx 填充到 abc 字符串的结尾处： <br> <code>SELECT RPAD(&#39;abc&#39;, 5,&#39;xx&#39;);  -- abcxx</code></td></tr><tr><td style="text-align:center">RTRIM(s)</td><td style="text-align:center">去掉字符串 s 结尾处的空格</td><td style="text-align:center">去掉字符串 GOOGLE 的末尾空格： <br> <code>SELECT RTRIM(&quot;GOOGLE     &quot;) AS RightTrimmedString;  -- GOOGLE</code></td></tr><tr><td style="text-align:center">SPACE(n)</td><td style="text-align:center">返回 n 个空格</td><td style="text-align:center">返回 10 个空格： <br> <code>SELECT SPACE(10);</code></td></tr><tr><td style="text-align:center">STRCMP(s1, s2)</td><td style="text-align:center">比较字符串 s1 和 s2，如果 s1 与 s2 相等返回 0 ，如果 s1&gt;s2 返回 1，如果 s1&lt;s2 返回 -1</td><td style="text-align:center">比较字符串： <br> <code>SELECT STRCMP(&quot;GOOGLE&quot;, &quot;GOOGLE&quot;);  -- 0</code></td></tr><tr><td style="text-align:center">SUBSTR(s, start, length)</td><td style="text-align:center">从字符串 s 的 start 位置截取长度为 length 的子字符串</td><td style="text-align:center">从字符串 GOOGLE 中的第 2 个位置截取 3 个 字符： <br> <code>SELECT SUBSTR(&quot;GOOGLE&quot;, 2, 3) AS ExtractString;  -- OOG</code></td></tr><tr><td style="text-align:center">SUBSTRING(s, start, length)</td><td style="text-align:center">从字符串 s 的 start 位置截取长度为 length 的子字符串</td><td style="text-align:center">从字符串 GOOGLE 中的第 2 个位置截取 3 个字符： <br> <code>SELECT SUBSTRING(&quot;GOOGLE&quot;, 2, 3) AS ExtractString;  -- OOG</code></td></tr><tr><td style="text-align:center">SUBSTRING_INDEX(s, delimiter, number)</td><td style="text-align:center">返回从字符串 s 的第 number 个出现的分隔符 delimiter 之后的子串。 <br> 如果 number 是正数，返回第 number 个字符左边的字符串。 <br> 如果 number 是负数，返回第(number 的绝对值(从右边数))个字符右边的字符串。</td><td style="text-align:center"><code>SELECT SUBSTRING_INDEX(&#39;a*b&#39;, &#39;*&#39;, 1);  -- a</code> <br> <code>SELECT SUBSTRING_INDEX(&#39;a*b&#39;, &#39;*&#39;, -1);  -- b</code> <br> <code>SELECT SUBSTRING_INDEX(SUBSTRING_INDEX(&#39;a*b*c*d*e&#39;, &#39;*&#39;, 3), &#39;*&#39;, -1);  -- c</code></td></tr><tr><td style="text-align:center">TRIM(s)</td><td style="text-align:center">去掉字符串 s 开始和结尾处的空格</td><td style="text-align:center">去掉字符串 GOOGLE 的首尾空格： <br> <code>SELECT TRIM(&#39;    GOOGLE    &#39;) AS TrimmedString;</code></td></tr><tr><td style="text-align:center">UCASE(s)</td><td style="text-align:center">将字符串转换为大写</td><td style="text-align:center">将字符串 google 转换为大写： <br> <code>SELECT UCASE(&quot;google&quot;);  -- GOOGLE</code></td></tr><tr><td style="text-align:center">UPPER(s)</td><td style="text-align:center">将字符串转换为大写</td><td style="text-align:center">将字符串 google 转换为大写： <br> <code>SELECT UPPER(&quot;google&quot;);  -- GOOGLE</code></td></tr></tbody></table></div><h2 id="数字函数"><a href="#数字函数" class="headerlink" title="数字函数"></a>数字函数</h2><div class="table-container"><table><thead><tr><th style="text-align:center">函数名</th><th style="text-align:center">描述</th><th style="text-align:center">实例</th></tr></thead><tbody><tr><td style="text-align:center">ABS(x)</td><td style="text-align:center">返回 x 的绝对值</td><td style="text-align:center"><code>SELECT ABS(-1);  -- 返回1</code></td></tr><tr><td style="text-align:center">ACOS(x)</td><td style="text-align:center">求 x 的反余弦值（参数是弧度）</td><td style="text-align:center"><code>SELECT ACOS(0.25);</code></td></tr><tr><td style="text-align:center">ASIN(x)</td><td style="text-align:center">求反正弦值（参数是弧度）</td><td style="text-align:center"><code>SELECT ASIN(0.25);</code></td></tr><tr><td style="text-align:center">ATAN(x)</td><td style="text-align:center">求反正切值（参数是弧度）</td><td style="text-align:center"><code>SELECT ATAN(2.5);</code></td></tr><tr><td style="text-align:center">ATAN2(n, m)</td><td style="text-align:center">求反正切值（参数是弧度）</td><td style="text-align:center"><code>SELECT ATAN2(-0.8, 2);</code></td></tr><tr><td style="text-align:center">AVG(expression)</td><td style="text-align:center">返回一个表达式的平均值，expression 是一个字段</td><td style="text-align:center">返回 Products 表中 Price 字段的平均值： <br> <code>SELECT AVG(Price) AS AveragePrice FROM Products;</code></td></tr><tr><td style="text-align:center">CEIL(x)</td><td style="text-align:center">返回大于或等于 x 的最小整数</td><td style="text-align:center"><code>SELECT CEIL(1.5);  -- 返回2</code></td></tr><tr><td style="text-align:center">CEILING(x)</td><td style="text-align:center">返回大于或等于 x 的最小整数</td><td style="text-align:center"><code>SELECT CEILING(1.5);  -- 返回2</code></td></tr><tr><td style="text-align:center">COS(x)</td><td style="text-align:center">求余弦值（参数是弧度）</td><td style="text-align:center"><code>SELECT COS(2);</code></td></tr><tr><td style="text-align:center">COT(x)</td><td style="text-align:center">求余切值（参数是弧度）</td><td style="text-align:center"><code>SELECT COT(6);</code></td></tr><tr><td style="text-align:center">COUNT(expression)</td><td style="text-align:center">返回查询的记录总数，expression 参数是一个字段或者 * 号</td><td style="text-align:center">返回 Products 表中 products 字段总共有多少条记录： <br> <code>SELECT COUNT(ProductID) AS NumberOfProducts FROM Products;</code></td></tr><tr><td style="text-align:center">DEGREES(x)</td><td style="text-align:center">将弧度转换为角度</td><td style="text-align:center"><code>SELECT DEGREES(3.1415926535898);  -- 180</code></td></tr><tr><td style="text-align:center">n DIV m</td><td style="text-align:center">整除，n 为被除数，m 为除数</td><td style="text-align:center">计算 10 除于 5： <br> <code>SELECT 10 DIV 5;  -- 2</code></td></tr><tr><td style="text-align:center">EXP(x)</td><td style="text-align:center">返回 e 的 x 次方</td><td style="text-align:center">计算 e 的三次方： <br> <code>SELECT EXP(3);  -- 20.085536923188</code></td></tr><tr><td style="text-align:center">FLOOR(x)</td><td style="text-align:center">返回小于或等于 x 的最大整数</td><td style="text-align:center">小于或等于 1.5 的整数： <br> <code>SELECT FLOOR(1.5);  -- 返回1</code></td></tr><tr><td style="text-align:center">GREATEST(expr1, expr2, expr3, ...)</td><td style="text-align:center">返回列表中的最大值</td><td style="text-align:center">返回以下数字列表中的最大值： <br> <code>SELECT GREATEST(3, 12, 34, 8, 25);  -- 34</code> <br> 返回以下字符串列表中的最大值： <br> <code>SELECT GREATEST(&quot;Google&quot;, &quot;Baidu&quot;, &quot;Apple&quot;);  -- Google</code></td></tr><tr><td style="text-align:center">LEAST(expr1, expr2, expr3, ...)</td><td style="text-align:center">返回列表中的最小值</td><td style="text-align:center">返回以下数字列表中的最小值： <br> <code>SELECT LEAST(3, 12, 34, 8, 25);  -- 3</code> <br> 返回以下字符串列表中的最小值： <br> <code>SELECT LEAST(&quot;Google&quot;, &quot;Baidu&quot;, &quot;Apple&quot;);  -- Apple</code></td></tr><tr><td style="text-align:center">LN(x)</td><td style="text-align:center">返回数字 x 的自然对数，以 e 为底。</td><td style="text-align:center">返回 2 的自然对数： <br> <code>SELECT LN(2);  -- 0.6931471805599453</code></td></tr><tr><td style="text-align:center">LOG(x) 或 LOG(base, x)</td><td style="text-align:center">返回自然对数（以 e 为底的对数）， <br> 如果带有 base 参数，则 base 为指定带底数。</td><td style="text-align:center"><code>SELECT LOG(20.085536923188);  -- 3</code> <br> <code>SELECT LOG(2, 4);  -- 2</code></td></tr><tr><td style="text-align:center">LOG10(x)</td><td style="text-align:center">返回以 10 为底的对数</td><td style="text-align:center"><code>SELECT LOG10(100);  -- 2</code></td></tr><tr><td style="text-align:center">LOG2(x)</td><td style="text-align:center">返回以 2 为底的对数</td><td style="text-align:center">返回以 2 为底 6 的对数： <br> <code>SELECT LOG2(6);  -- 2.584962500721156</code></td></tr><tr><td style="text-align:center">MAX(expression)</td><td style="text-align:center">返回字段 expression 中的最大值</td><td style="text-align:center">返回数据表 Products 中字段 Price 的最大值： <br> <code>SELECT MAX(Price) AS LargestPrice FROM Products;</code></td></tr><tr><td style="text-align:center">MIN(expression)</td><td style="text-align:center">返回字段 expression 中的最小值</td><td style="text-align:center">返回数据表 Products 中字段 Price 的最小值： <br> <code>SELECT MIN(Price) AS MinPrice FROM Products;</code></td></tr><tr><td style="text-align:center">MOD(x,y)</td><td style="text-align:center">返回 x 除以 y 以后的余数</td><td style="text-align:center">5 除于 2 的余数： <br> <code>SELECT MOD(5, 2);  -- 1</code></td></tr><tr><td style="text-align:center">PI()</td><td style="text-align:center">返回圆周率(3.141593）</td><td style="text-align:center"><code>SELECT PI();  --3.141593</code></td></tr><tr><td style="text-align:center">POW(x,y)</td><td style="text-align:center">返回 x 的 y 次方</td><td style="text-align:center">2 的 3 次方： <br> <code>SELECT POW(2, 3);  -- 8</code></td></tr><tr><td style="text-align:center">POWER(x,y)</td><td style="text-align:center">返回 x 的 y 次方</td><td style="text-align:center">2 的 3 次方： <br> <code>SELECT POWER(2, 3);  -- 8</code></td></tr><tr><td style="text-align:center">RADIANS(x)</td><td style="text-align:center">将角度转换为弧度</td><td style="text-align:center">180 度转换为弧度： <br> <code>SELECT RADIANS(180);  -- 3.1415926535898</code></td></tr><tr><td style="text-align:center">RAND()</td><td style="text-align:center">返回 0 到 1 的随机数</td><td style="text-align:center"><code>SELECT RAND();  --0.93099315644334</code></td></tr><tr><td style="text-align:center">ROUND(x)</td><td style="text-align:center">返回离 x 最近的整数,四舍五入</td><td style="text-align:center"><code>SELECT ROUND(1.23456);  --1</code></td></tr><tr><td style="text-align:center">SIGN(x)</td><td style="text-align:center">返回 x 的符号，x 是负数、0、 正数分别返回 -1、0 和 1</td><td style="text-align:center"><code>SELECT SIGN(-10);  -- (-1)</code></td></tr><tr><td style="text-align:center">SIN(x)</td><td style="text-align:center">求正弦值（参数是弧度）</td><td style="text-align:center"><code>SELECT SIN(RADIANS(30));  -- 0.5</code></td></tr><tr><td style="text-align:center">SQRT(x)</td><td style="text-align:center">返回x的平方根</td><td style="text-align:center">25 的平方根： <br> <code>SELECT SQRT(25);  -- 5</code></td></tr><tr><td style="text-align:center">SUM(expression)</td><td style="text-align:center">返回指定字段的总和</td><td style="text-align:center">计算 OrderDetails 表中字段 Quantity 的总和： <br> <code>SELECT SUM(Quantity) AS TotalItemsOrdered FROM OrderDetails;</code></td></tr><tr><td style="text-align:center">TAN(x)</td><td style="text-align:center">求正切值（参数是弧度）</td><td style="text-align:center"><code>SELECT TAN(1.75);  -- (-5.52037992250933)</code></td></tr><tr><td style="text-align:center">TRUNCATE(x, y)</td><td style="text-align:center">返回数值 x 保留到小数点后 y 位的值（与 ROUND 最大的区别是不会进行四舍五入）</td><td style="text-align:center"><code>SELECT TRUNCATE(1.23456, 3);  -- 1.234</code></td></tr></tbody></table></div><h2 id="日期函数"><a href="#日期函数" class="headerlink" title="日期函数"></a>日期函数</h2><div class="table-container"><table><thead><tr><th style="text-align:center">函数名</th><th style="text-align:center">描述</th><th style="text-align:center">实例</th></tr></thead><tbody><tr><td style="text-align:center">ADDDATE(d, n)</td><td style="text-align:center">计算起始日期 d 加上 n 天的日期</td><td style="text-align:center"><code>SELECT ADDDATE(&quot;2017-06-15&quot;, INTERVAL 10 DAY);  --2017-06-25</code></td></tr><tr><td style="text-align:center">ADDTIME(t, n)</td><td style="text-align:center">n 是一个时间表达式，时间 t 加上时间表达式 n</td><td style="text-align:center">加 5 秒： <br> <code>SELECT ADDTIME(&#39;2011-11-11 11:11:11&#39;, 5);  --2011-11-11 11:11:16</code> <br> 添加 2 小时, 10 分钟, 5 秒： <br> <code>SELECT ADDTIME(&quot;2020-06-15 09:34:21&quot;, &quot;2:10:5&quot;);  -- 2020-06-15 11:44:26</code></td></tr><tr><td style="text-align:center">CURDATE()</td><td style="text-align:center">返回当前日期</td><td style="text-align:center"><code>SELECT CURDATE();  -- 2018-09-19</code></td></tr><tr><td style="text-align:center">CURRENT_DATE()</td><td style="text-align:center">返回当前日期</td><td style="text-align:center"><code>SELECT CURRENT_DATE();  -- 2018-09-19</code></td></tr><tr><td style="text-align:center">CURRENT_TIME</td><td style="text-align:center">返回当前时间</td><td style="text-align:center"><code>SELECT CURRENT_TIME();  -- 19:59:02</code></td></tr><tr><td style="text-align:center">CURRENT_TIMESTAMP()</td><td style="text-align:center">返回当前日期和时间</td><td style="text-align:center"><code>SELECT CURRENT_TIMESTAMP();  -- 2018-09-19 20:57:43</code></td></tr><tr><td style="text-align:center">CURTIME()</td><td style="text-align:center">返回当前时间</td><td style="text-align:center"><code>SELECT CURTIME();  -- 19:59:02</code></td></tr><tr><td style="text-align:center">DATE()</td><td style="text-align:center">从日期或日期时间表达式中提取日期值</td><td style="text-align:center"><code>SELECT DATE(&quot;2017-06-15&quot;);  -- 2017-06-15</code></td></tr><tr><td style="text-align:center">DATEDIFF(d1, d2)</td><td style="text-align:center">计算日期 d1 和 d2 之间相隔的天数</td><td style="text-align:center"><code>SELECT DATEDIFF(&#39;2001-01-01&#39;, &#39;2001-02-02&#39;);  -- (-32)</code></td></tr><tr><td style="text-align:center">DATE_ADD(d，INTERVAL expr type)</td><td style="text-align:center">计算起始日期 d 加上一个时间段后的日期</td><td style="text-align:center"><code>SELECT ADDDATE(&#39;2011-11-11 11:11:11&#39;, 1);  -- 2011-11-12 11:11:11（默认是天）</code> <br> <code>SELECT ADDDATE(&#39;2011-11-11 11:11:11&#39;, INTERVAL 5 MINUTE);  -- 2011-11-11 11:16:11 （TYPE的取值与上面那个列出来的函数类似）</code></td></tr><tr><td style="text-align:center">DATE_FORMAT(d, f)</td><td style="text-align:center">按表达式 f 的要求显示日期 d</td><td style="text-align:center"><code>SELECT DATE_FORMAT(&#39;2011-11-11 11:11:11&#39;,&#39;%Y-%m-%d %r&#39;);  -- 2011-11-11 11:11:11 AM</code></td></tr><tr><td style="text-align:center">DATE_SUB(date, INTERVAL expr type)</td><td style="text-align:center">函数从日期减去指定的时间间隔。</td><td style="text-align:center">Orders 表中 OrderDate 字段减去 2 天： <br> <code>SELECT OrderId, DATE_SUB(OrderDate,INTERVAL 2 DAY) AS OrderPayDate FROM Orders;</code></td></tr><tr><td style="text-align:center">DAY(d)</td><td style="text-align:center">返回日期值 d 的日期部分</td><td style="text-align:center"><code>SELECT DAY(&quot;2017-06-15&quot;);  -- 15</code></td></tr><tr><td style="text-align:center">DAYNAME(d)</td><td style="text-align:center">返回日期 d 是星期几，如 Monday, Tuesday</td><td style="text-align:center"><code>SELECT DAYNAME(&#39;2011-11-11 11:11:11&#39;);  --Friday</code></td></tr><tr><td style="text-align:center">DAYOFMONTH(d)</td><td style="text-align:center">计算日期 d 是本月的第几天</td><td style="text-align:center"><code>SELECT DAYOFMONTH(&#39;2011-11-11 11:11:11&#39;);  --11</code></td></tr><tr><td style="text-align:center">DAYOFWEEK(d)</td><td style="text-align:center">日期 d 今天是星期几，1 星期日，2 星期一，以此类推</td><td style="text-align:center"><code>SELECT DAYOFWEEK(&#39;2011-11-11 11:11:11&#39;);  --6</code></td></tr><tr><td style="text-align:center">DAYOFYEAR(d)</td><td style="text-align:center">计算日期 d 是本年的第几天</td><td style="text-align:center"><code>SELECT DAYOFYEAR(&#39;2011-11-11 11:11:11&#39;);  --315</code></td></tr><tr><td style="text-align:center">EXTRACT(type FROM d)</td><td style="text-align:center">从日期 d 中获取指定的值，type 指定返回的值。 <br> type可取值为： <br> MICROSECOND <br> SECOND <br> MINUTE <br> HOUR <br> DAY <br> WEEK <br> MONTH <br> QUARTER <br> YEAR <br> SECOND_MICROSECOND <br> MINUTE_MICROSECOND <br> MINUTE_SECOND <br> HOUR_MICROSECOND <br> HOUR_SECOND <br> HOUR_MINUTE <br> DAY_MICROSECOND <br> DAY_SECOND <br> DAY_MINUTE <br> DAY_HOUR <br> YEAR_MONTH</td><td style="text-align:center"><code>SELECT EXTRACT(MINUTE FROM &#39;2011-11-11 11:11:11&#39;);  -- 11</code></td></tr><tr><td style="text-align:center">FROM_DAYS(n)</td><td style="text-align:center">计算从 0000 年 1 月 1 日开始 n 天后的日期</td><td style="text-align:center"><code>SELECT FROM_DAYS(1111);  -- 0003-01-16</code></td></tr><tr><td style="text-align:center">HOUR(t)</td><td style="text-align:center">返回 t 中的小时值</td><td style="text-align:center"><code>SELECT HOUR(&#39;1:2:3&#39;);  -- 1</code></td></tr><tr><td style="text-align:center">LAST_DAY(d)</td><td style="text-align:center">返回给给定日期的那一月份的最后一天</td><td style="text-align:center"><code>SELECT LAST_DAY(&quot;2017-06-20&quot;);  -- 2017-06-30</code></td></tr><tr><td style="text-align:center">LOCALTIME()</td><td style="text-align:center">返回当前日期和时间</td><td style="text-align:center"><code>SELECT LOCALTIME();  -- 2018-09-19 20:57:43</code></td></tr><tr><td style="text-align:center">LOCALTIMESTAMP()</td><td style="text-align:center">返回当前日期和时间</td><td style="text-align:center"><code>SELECT LOCALTIMESTAMP();  -- 2018-09-19 20:57:43</code></td></tr><tr><td style="text-align:center">MAKEDATE(year, day-of-year)</td><td style="text-align:center">基于给定参数年份 year 和所在年中的天数序号 day-of-year 返回一个日期</td><td style="text-align:center"><code>SELECT MAKEDATE(2017, 3);  -- 2017-01-03</code></td></tr><tr><td style="text-align:center">MAKETIME(hour, minute, second)</td><td style="text-align:center">组合时间，参数分别为小时、分钟、秒</td><td style="text-align:center"><code>SELECT MAKETIME(11, 35, 4);  -- 11:35:04</code></td></tr><tr><td style="text-align:center">MICROSECOND(date)</td><td style="text-align:center">返回日期参数所对应的微秒数</td><td style="text-align:center"><code>SELECT MICROSECOND(&quot;2017-06-20 09:34:00.000023&quot;);  -- 23</code></td></tr><tr><td style="text-align:center">MINUTE(t)</td><td style="text-align:center">返回 t 中的分钟值</td><td style="text-align:center"><code>SELECT MINUTE(&#39;1:2:3&#39;);  -- 2</code></td></tr><tr><td style="text-align:center">MONTHNAME(d)</td><td style="text-align:center">返回日期当中的月份名称，如 November</td><td style="text-align:center"><code>SELECT MONTHNAME(&#39;2011-11-11 11:11:11&#39;);  -- November</code></td></tr><tr><td style="text-align:center">MONTH(d)</td><td style="text-align:center">返回日期d中的月份值，1 到 12</td><td style="text-align:center"><code>SELECT MONTH(&#39;2011-11-11 11:11:11&#39;);  --11</code></td></tr><tr><td style="text-align:center">NOW()</td><td style="text-align:center">返回当前日期和时间</td><td style="text-align:center"><code>SELECT NOW();  -- 2018-09-19 20:57:43</code></td></tr><tr><td style="text-align:center">PERIOD_ADD(period, number)</td><td style="text-align:center">为 年-月 组合日期添加一个时段</td><td style="text-align:center"><code>SELECT PERIOD_ADD(201703, 5);  -- 201708</code></td></tr><tr><td style="text-align:center">PERIOD_DIFF(period1, period2)</td><td style="text-align:center">返回两个时段之间的月份差值</td><td style="text-align:center"><code>SELECT PERIOD_DIFF(201710, 201703);  -- 7</code></td></tr><tr><td style="text-align:center">QUARTER(d)</td><td style="text-align:center">返回日期d是第几季节，返回 1 到 4</td><td style="text-align:center"><code>SELECT QUARTER(&#39;2011-11-11 11:11:11&#39;);  -- 4</code></td></tr><tr><td style="text-align:center">SECOND(t)</td><td style="text-align:center">返回 t 中的秒钟值</td><td style="text-align:center"><code>SELECT SECOND(&#39;1:2:3&#39;);  -- 3</code></td></tr><tr><td style="text-align:center">SEC_TO_TIME(s)</td><td style="text-align:center">将以秒为单位的时间 s 转换为时分秒的格式</td><td style="text-align:center"><code>SELECT SEC_TO_TIME(4320);  -- 01:12:00</code></td></tr><tr><td style="text-align:center">STR_TO_DATE(string, format_mask)</td><td style="text-align:center">将字符串转变为日期</td><td style="text-align:center"><code>SELECT STR_TO_DATE(&quot;August 10 2017&quot;, &quot;%M %d %Y&quot;);  -- 2017-08-10</code></td></tr><tr><td style="text-align:center">SUBDATE(d, n)</td><td style="text-align:center">日期 d 减去 n 天后的日期</td><td style="text-align:center"><code>SELECT SUBDATE(&#39;2011-11-11 11:11:11&#39;, 1);  --2011-11-10 11:11:11 (默认是天)</code></td></tr><tr><td style="text-align:center">SUBTIME(t, n)</td><td style="text-align:center">时间 t 减去 n 秒的时间</td><td style="text-align:center"><code>SELECT SUBTIME(&#39;2011-11-11 11:11:11&#39;, 5);  --2011-11-11 11:11:06 (秒)</code></td></tr><tr><td style="text-align:center">SYSDATE()</td><td style="text-align:center">返回当前日期和时间</td><td style="text-align:center"><code>SELECT SYSDATE();  -- 2018-09-19 20:57:43</code></td></tr><tr><td style="text-align:center">TIME(expression)</td><td style="text-align:center">提取传入表达式的时间部分</td><td style="text-align:center"><code>SELECT TIME(&quot;19:30:10&quot;);  -- 19:30:10</code></td></tr><tr><td style="text-align:center">TIME_FORMAT(t, f)</td><td style="text-align:center">按表达式 f 的要求显示时间 t</td><td style="text-align:center"><code>SELECT TIME_FORMAT(&#39;11:11:11&#39;, &#39;%r&#39;);  -- 11:11:11 AM</code></td></tr><tr><td style="text-align:center">TIME_TO_SEC(t)</td><td style="text-align:center">将时间 t 转换为秒</td><td style="text-align:center"><code>SELECT TIME_TO_SEC(&#39;1:12:00&#39;);  -- 4320</code></td></tr><tr><td style="text-align:center">TIMEDIFF(time1, time2)</td><td style="text-align:center">计算时间差值</td><td style="text-align:center"><code>SELECT TIMEDIFF(&quot;13:10:11&quot;, &quot;13:10:10&quot;);  -- 00:00:01</code></td></tr><tr><td style="text-align:center">TIMESTAMP(expression, interval)</td><td style="text-align:center">单个参数时，函数返回日期或日期时间表达式；有2个参数时，将参数加和</td><td style="text-align:center"><code>SELECT TIMESTAMP(&quot;2017-07-23&quot;, &quot;13:10:11&quot;);  -- 2017-07-23 13:10:11</code></td></tr><tr><td style="text-align:center">TO_DAYS(d)</td><td style="text-align:center">计算日期 d 距离 0000 年 1 月 1 日的天数</td><td style="text-align:center"><code>SELECT TO_DAYS(&#39;0001-01-01 01:01:01&#39;);  -- 366</code></td></tr><tr><td style="text-align:center">WEEK(d)</td><td style="text-align:center">计算日期 d 是本年的第几个星期，范围是 0 到 53</td><td style="text-align:center"><code>SELECT WEEK(&#39;2011-11-11 11:11:11&#39;);  -- 45</code></td></tr><tr><td style="text-align:center">WEEKDAY(d)</td><td style="text-align:center">日期 d 是星期几，0 表示星期一，1 表示星期二</td><td style="text-align:center"><code>SELECT WEEKDAY(&quot;2017-06-15&quot;);  -- 3</code></td></tr><tr><td style="text-align:center">WEEKOFYEAR(d)</td><td style="text-align:center">计算日期 d 是本年的第几个星期，范围是 0 到 53</td><td style="text-align:center"><code>SELECT WEEKOFYEAR(&#39;2011-11-11 11:11:11&#39;);  -- 45</code></td></tr><tr><td style="text-align:center">YEAR(d)</td><td style="text-align:center">返回年份</td><td style="text-align:center"><code>SELECT YEAR(&quot;2017-06-15&quot;);  -- 2017</code></td></tr><tr><td style="text-align:center">YEARWEEK(date, mode)</td><td style="text-align:center">返回年份及第几周（0 到 53），mode 中 0 表示周天，1表示周一，以此类推</td><td style="text-align:center"><code>SELECT YEARWEEK(&quot;2017-06-15&quot;);  -- 201724</code></td></tr></tbody></table></div><h2 id="高级函数"><a href="#高级函数" class="headerlink" title="高级函数"></a>高级函数</h2><div class="table-container"><table><thead><tr><th style="text-align:center">函数名</th><th style="text-align:center">描述</th><th style="text-align:center">实例</th></tr></thead><tbody><tr><td style="text-align:center">BIN(x)</td><td style="text-align:center">返回 x 的二进制编码</td><td style="text-align:center">15 的 2 进制编码： <br> <code>SELECT BIN(15);  -- 1111</code></td></tr><tr><td style="text-align:center">BINARY(s)</td><td style="text-align:center">将字符串 s 转换为二进制字符串</td><td style="text-align:center"><code>SELECT BINARY &quot;GOOGLE&quot;;  -- GOOGLE</code></td></tr><tr><td style="text-align:center">CASE expression <br> WHEN condition1 THEN result1 <br> WHEN condition2 THEN result2 <br> ... <br> WHEN conditionN THEN resultN <br> ELSE result</td><td style="text-align:center">END &vert; CASE 表示函数开始，END 表示函数结束。 <br> 如果 condition1 成立，则返回 result1,  <br> 如果 condition2 成立，则返回 result2， <br> 当全部不成立则返回 result，而当有一个成立之后，后面的就不执行了。</td><td style="text-align:center"><code>SELECT CASE</code> <br> <code>WHEN 1 &gt; 0</code> <br> <code>THEN &#39;1 &gt; 0&#39;</code> <br> <code>WHEN 2 &gt; 0</code> <br> <code>THEN &#39;2 &gt; 0&#39;</code> <br> <code>ELSE &#39;3 &gt; 0&#39;</code> <br> <code>END</code> <br> <code>-- 1 &gt; 0</code></td></tr><tr><td style="text-align:center">CAST(x AS type)</td><td style="text-align:center">转换数据类型</td><td style="text-align:center">字符串日期转换为日期： <br> <code>SELECT CAST(&quot;2017-08-29&quot; AS DATE);  -- 2017-08-29</code></td></tr><tr><td style="text-align:center">COALESCE(expr1, expr2, ...., expr_n)</td><td style="text-align:center">返回参数中的第一个非空表达式（从左向右）</td><td style="text-align:center"><code>SELECT COALESCE(NULL, NULL, NULL, &#39;baidu.com&#39;, NULL, &#39;google.com&#39;);  -- baidu.com</code></td></tr><tr><td style="text-align:center">CONNECTION_ID()</td><td style="text-align:center">返回唯一的连接 ID</td><td style="text-align:center"><code>SELECT CONNECTION_ID();  -- 4292835</code></td></tr><tr><td style="text-align:center">CONV(x, f1, f2)</td><td style="text-align:center">返回 f1 进制数变成 f2 进制数</td><td style="text-align:center"><code>SELECT CONV(15, 10, 2);  -- 1111</code></td></tr><tr><td style="text-align:center">CONVERT(s USING cs)</td><td style="text-align:center">函数将字符串 s 的字符集变成 cs</td><td style="text-align:center"><code>SELECT CHARSET(&#39;ABC&#39;)  --utf-8</code> <br> <code>SELECT CHARSET(CONVERT(&#39;ABC&#39; USING gbk))  --gbk</code></td></tr><tr><td style="text-align:center">CURRENT_USER()</td><td style="text-align:center">返回当前用户</td><td style="text-align:center"><code>SELECT CURRENT_USER();  -- root@localhost</code></td></tr><tr><td style="text-align:center">DATABASE()</td><td style="text-align:center">返回当前数据库名</td><td style="text-align:center"><code>SELECT DATABASE();  -- testdb</code></td></tr><tr><td style="text-align:center">IF(expr, v1, v2)</td><td style="text-align:center">如果表达式 expr 成立，返回结果 v1；否则，返回结果 v2。</td><td style="text-align:center"><code>SELECT IF(1 &gt; 0,&#39;正确&#39;,&#39;错误&#39;)  --正确</code></td></tr><tr><td style="text-align:center">IFNULL(v1, v2)</td><td style="text-align:center">如果 v1 的值不为 NULL，则返回 v1，否则返回 v2。</td><td style="text-align:center"><code>SELECT IFNULL(NULL, &#39;Hello Word&#39;)  --Hello Word</code></td></tr><tr><td style="text-align:center">ISNULL(expression)</td><td style="text-align:center">判断表达式是否为 NULL</td><td style="text-align:center"><code>SELECT ISNULL(NULL);  --1</code></td></tr><tr><td style="text-align:center">LAST_INSERT_ID()</td><td style="text-align:center">返回最近生成的 AUTO_INCREMENT 值</td><td style="text-align:center"><code>SELECT LAST_INSERT_ID();  --6</code></td></tr><tr><td style="text-align:center">NULLIF(expr1, expr2)</td><td style="text-align:center">比较两个字符串，如果字符串 expr1 与 expr2 相等 返回 NULL，否则返回 expr1</td><td style="text-align:center"><code>SELECT NULLIF(25, 25);  --</code></td></tr><tr><td style="text-align:center">SESSION_USER()</td><td style="text-align:center">返回当前用户</td><td style="text-align:center"><code>SELECT SESSION_USER();  -- root@localhost</code></td></tr><tr><td style="text-align:center">SYSTEM_USER()</td><td style="text-align:center">返回当前用户</td><td style="text-align:center"><code>SELECT SYSTEM_USER();  -- root@localhost</code></td></tr><tr><td style="text-align:center">USER()</td><td style="text-align:center">返回当前用户</td><td style="text-align:center"><code>SELECT USER();  -- root@localhost</code></td></tr><tr><td style="text-align:center">VERSION()</td><td style="text-align:center">返回数据库的版本号</td><td style="text-align:center"><code>SELECT VERSION()  -- 5.6.34</code></td></tr></tbody></table></div><h1 id="运算符"><a href="#运算符" class="headerlink" title="运算符"></a>运算符</h1><p>本章节我们主要介绍 MySQL 的运算符及运算符的优先级。 MySQL 主要有以下几种运算符：</p><ul><li>算术运算符</li><li>比较运算符</li><li>逻辑运算符</li><li>位运算符</li></ul><h2 id="算术运算符"><a href="#算术运算符" class="headerlink" title="算术运算符"></a>算术运算符</h2><p>MySQL 支持的算术运算符包括:</p><div class="table-container"><table><thead><tr><th style="text-align:center">运算符</th><th style="text-align:center">作用</th></tr></thead><tbody><tr><td style="text-align:center">+</td><td style="text-align:center">加法</td></tr><tr><td style="text-align:center">-</td><td style="text-align:center">减法</td></tr><tr><td style="text-align:center">*</td><td style="text-align:center">乘法</td></tr><tr><td style="text-align:center">/ 或 DIV</td><td style="text-align:center">除法</td></tr><tr><td style="text-align:center">% 或 MOD</td><td style="text-align:center">取余</td></tr></tbody></table></div><p>在除法运算和模运算中，如果除数为0，将是非法除数，返回结果为NULL。</p><ol><li><p>加</p><p> <pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">mysql<span class="token operator">></span> <span class="token keyword">SELECT</span> <span class="token number">1</span><span class="token operator">+</span><span class="token number">2</span><span class="token punctuation">;</span><span class="token operator">+</span><span class="token comment">-----+</span><span class="token operator">|</span> <span class="token number">1</span><span class="token operator">+</span><span class="token number">2</span> <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">-----+</span><span class="token operator">|</span>   <span class="token number">3</span> <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">-----+</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p></li><li><p>减</p><p> <pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">mysql<span class="token operator">></span> <span class="token keyword">SELECT</span> <span class="token number">1</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">;</span><span class="token operator">+</span><span class="token comment">-----+</span><span class="token operator">|</span> <span class="token number">1</span><span class="token operator">-</span><span class="token number">2</span> <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">-----+</span><span class="token operator">|</span>  <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">-----+</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p></li><li><p>乘</p><p> <pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">mysql<span class="token operator">></span> <span class="token keyword">SELECT</span> <span class="token number">2</span><span class="token operator">*</span><span class="token number">3</span><span class="token punctuation">;</span><span class="token operator">+</span><span class="token comment">-----+</span><span class="token operator">|</span> <span class="token number">2</span><span class="token operator">*</span><span class="token number">3</span> <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">-----+</span><span class="token operator">|</span>   <span class="token number">6</span> <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">-----+</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p></li><li><p>除</p><p> <pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">mysql<span class="token operator">></span> <span class="token keyword">SELECT</span> <span class="token number">2</span><span class="token operator">/</span><span class="token number">3</span><span class="token punctuation">;</span><span class="token operator">+</span><span class="token comment">--------+</span><span class="token operator">|</span> <span class="token number">2</span><span class="token operator">/</span><span class="token number">3</span>    <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">--------+</span><span class="token operator">|</span> <span class="token number">0.6667</span> <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">--------+</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p></li><li><p>商</p><p> <pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">mysql<span class="token operator">></span> <span class="token keyword">SELECT</span> <span class="token number">10</span> <span class="token operator">DIV</span> <span class="token number">4</span><span class="token punctuation">;</span><span class="token operator">+</span><span class="token comment">----------+</span><span class="token operator">|</span> <span class="token number">10</span> <span class="token operator">DIV</span> <span class="token number">4</span> <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">----------+</span><span class="token operator">|</span>        <span class="token number">2</span> <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">----------+</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p></li><li><p>取余</p><p> <pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">mysql<span class="token operator">></span> <span class="token keyword">SELECT</span> <span class="token number">10</span> MOD <span class="token number">4</span><span class="token punctuation">;</span><span class="token operator">+</span><span class="token comment">----------+</span><span class="token operator">|</span> <span class="token number">10</span> MOD <span class="token number">4</span> <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">----------+</span><span class="token operator">|</span>        <span class="token number">2</span> <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">----------+</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p></li></ol><h2 id="比较运算符"><a href="#比较运算符" class="headerlink" title="比较运算符"></a>比较运算符</h2><p><code>SELECT</code> 语句中的条件语句经常要使用比较运算符。通过这些比较运算符，可以判断表中的哪些记录是符合条件的。比较结果为真，则返回 <code>1</code>，为假则返回 <code>0</code>，比较结果不确定则返回 <code>NULL</code>。</p><div class="table-container"><table><thead><tr><th style="text-align:center">符号</th><th style="text-align:center">描述</th><th style="text-align:center">备注</th></tr></thead><tbody><tr><td style="text-align:center">=</td><td style="text-align:center">等于</td><td style="text-align:center"></td></tr><tr><td style="text-align:center">&lt;&gt;, !=</td><td style="text-align:center">不等于</td><td style="text-align:center"></td></tr><tr><td style="text-align:center">&gt;</td><td style="text-align:center">大于</td><td style="text-align:center"></td></tr><tr><td style="text-align:center">&lt;</td><td style="text-align:center">小于</td><td style="text-align:center"></td></tr><tr><td style="text-align:center">&lt;=</td><td style="text-align:center">小于等于</td><td style="text-align:center"></td></tr><tr><td style="text-align:center">&gt;=</td><td style="text-align:center">大于等于</td><td style="text-align:center"></td></tr><tr><td style="text-align:center">BETWEEN</td><td style="text-align:center">在两值之间</td><td style="text-align:center">&gt;=min &amp;&amp; &lt;=max</td></tr><tr><td style="text-align:center">NOT BETWEEN</td><td style="text-align:center">不在两值之间</td><td style="text-align:center"></td></tr><tr><td style="text-align:center">IN</td><td style="text-align:center">在集合中</td><td style="text-align:center"></td></tr><tr><td style="text-align:center">NOT IN</td><td style="text-align:center">不在集合中</td><td style="text-align:center"></td></tr><tr><td style="text-align:center">&lt;=&gt;</td><td style="text-align:center">严格比较两个 NULL 值是否相等</td><td style="text-align:center">两个操作码均为 NULL 时，其所得值为 1； <br> 而当一个操作码为 NULL 时，其所得值为 0</td></tr><tr><td style="text-align:center">LIKE</td><td style="text-align:center">模糊匹配</td><td style="text-align:center"></td></tr><tr><td style="text-align:center">REGEXP 或 RLIKE</td><td style="text-align:center">正则式匹配</td><td style="text-align:center">&nbsp;</td></tr><tr><td style="text-align:center">IS NULL</td><td style="text-align:center">为空</td><td style="text-align:center">&nbsp;</td></tr><tr><td style="text-align:center">IS NOT NULL</td><td style="text-align:center">不为空</td><td style="text-align:center">&nbsp;</td></tr></tbody></table></div><ol><li><p>等于</p><p> <pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">mysql<span class="token operator">></span> <span class="token keyword">SELECT</span> <span class="token number">2</span><span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">;</span><span class="token operator">+</span><span class="token comment">-----+</span><span class="token operator">|</span> <span class="token number">2</span><span class="token operator">=</span><span class="token number">3</span> <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">-----+</span><span class="token operator">|</span>   <span class="token number">0</span> <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">-----+</span>mysql<span class="token operator">></span> <span class="token keyword">SELECT</span> <span class="token boolean">NULL</span> <span class="token operator">=</span> <span class="token boolean">NULL</span><span class="token punctuation">;</span><span class="token operator">+</span><span class="token comment">-------------+</span><span class="token operator">|</span> <span class="token boolean">NULL</span> <span class="token operator">=</span> <span class="token boolean">NULL</span> <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">-------------+</span><span class="token operator">|</span>        <span class="token boolean">NULL</span> <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">-------------+</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p></li><li><p>不等于</p><p> <pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">mysql<span class="token operator">></span> <span class="token keyword">SELECT</span> <span class="token number">2</span><span class="token operator">&lt;></span><span class="token number">3</span><span class="token punctuation">;</span><span class="token operator">+</span><span class="token comment">------+</span><span class="token operator">|</span> <span class="token number">2</span><span class="token operator">&lt;></span><span class="token number">3</span> <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">------+</span><span class="token operator">|</span>    <span class="token number">1</span> <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">------+</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p></li><li><p>安全等于</p><p> 与 <code>=</code> 的区别在于当两个操作码均为 <code>NULL</code> 时，其所得值为 <code>1</code> 而不为 <code>NULL</code>，而当一个操作码为 <code>NULL</code> 时，其所得值为 <code>0</code> 而不为 <code>NULL</code>。</p><p> <pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">mysql<span class="token operator">></span> <span class="token keyword">SELECT</span> <span class="token number">2</span><span class="token operator">&lt;=></span><span class="token number">3</span><span class="token punctuation">;</span><span class="token operator">+</span><span class="token comment">-------+</span><span class="token operator">|</span> <span class="token number">2</span><span class="token operator">&lt;=></span><span class="token number">3</span> <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">-------+</span><span class="token operator">|</span>     <span class="token number">0</span> <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">-------+</span>mysql<span class="token operator">></span> <span class="token keyword">SELECT</span> <span class="token boolean">NULL</span><span class="token operator">=</span><span class="token boolean">NULL</span><span class="token punctuation">;</span><span class="token operator">+</span><span class="token comment">-----------+</span><span class="token operator">|</span> <span class="token boolean">NULL</span><span class="token operator">=</span><span class="token boolean">NULL</span> <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">-----------+</span><span class="token operator">|</span>      <span class="token boolean">NULL</span> <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">-----------+</span>mysql<span class="token operator">></span> <span class="token keyword">SELECT</span> <span class="token boolean">NULL</span><span class="token operator">&lt;=></span><span class="token boolean">NULL</span><span class="token punctuation">;</span><span class="token operator">+</span><span class="token comment">-------------+</span><span class="token operator">|</span> <span class="token boolean">NULL</span><span class="token operator">&lt;=></span><span class="token boolean">NULL</span> <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">-------------+</span><span class="token operator">|</span>           <span class="token number">1</span> <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">-------------+</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p></li><li><p>小于</p><p> <pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">mysql<span class="token operator">></span> <span class="token keyword">SELECT</span> <span class="token number">2</span><span class="token operator">&lt;</span><span class="token number">3</span><span class="token punctuation">;</span><span class="token operator">+</span><span class="token comment">-----+</span><span class="token operator">|</span> <span class="token number">2</span><span class="token operator">&lt;</span><span class="token number">3</span> <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">-----+</span><span class="token operator">|</span>   <span class="token number">1</span> <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">-----+</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p></li><li><p>小于等于</p><p> <pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">mysql<span class="token operator">></span> <span class="token keyword">SELECT</span> <span class="token number">2</span><span class="token operator">&lt;=</span><span class="token number">3</span><span class="token punctuation">;</span><span class="token operator">+</span><span class="token comment">------+</span><span class="token operator">|</span> <span class="token number">2</span><span class="token operator">&lt;=</span><span class="token number">3</span> <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">------+</span><span class="token operator">|</span>    <span class="token number">1</span> <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">------+</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p></li><li><p>大于</p><p> <pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">mysql<span class="token operator">></span> <span class="token keyword">SELECT</span> <span class="token number">2</span><span class="token operator">></span><span class="token number">3</span><span class="token punctuation">;</span><span class="token operator">+</span><span class="token comment">-----+</span><span class="token operator">|</span> <span class="token number">2</span><span class="token operator">></span><span class="token number">3</span> <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">-----+</span><span class="token operator">|</span>   <span class="token number">0</span> <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">-----+</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p></li><li><p>大于等于</p><p> <pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">mysql<span class="token operator">></span> <span class="token keyword">SELECT</span> <span class="token number">2</span><span class="token operator">>=</span><span class="token number">3</span><span class="token punctuation">;</span><span class="token operator">+</span><span class="token comment">------+</span><span class="token operator">|</span> <span class="token number">2</span><span class="token operator">>=</span><span class="token number">3</span> <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">------+</span><span class="token operator">|</span>    <span class="token number">0</span> <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">------+</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p></li><li><p>BETWEEN</p><p> <pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">mysql<span class="token operator">></span> <span class="token keyword">SELECT</span> <span class="token number">5</span> <span class="token operator">BETWEEN</span> <span class="token number">1</span> <span class="token operator">AND</span> <span class="token number">10</span><span class="token punctuation">;</span><span class="token operator">+</span><span class="token comment">--------------------+</span><span class="token operator">|</span> <span class="token number">5</span> <span class="token operator">BETWEEN</span> <span class="token number">1</span> <span class="token operator">AND</span> <span class="token number">10</span> <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">--------------------+</span><span class="token operator">|</span>                  <span class="token number">1</span> <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">--------------------+</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p></li><li><p>IN</p><p> <pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">mysql<span class="token operator">></span> <span class="token keyword">SELECT</span> <span class="token number">5</span> <span class="token operator">IN</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token operator">+</span><span class="token comment">------------------+</span><span class="token operator">|</span> <span class="token number">5</span> <span class="token operator">IN</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span> <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">----------------------+</span><span class="token operator">|</span>                    <span class="token number">1</span> <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">----------------------+</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p></li><li><p>NOT IN</p><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">mysql<span class="token operator">></span> <span class="token keyword">SELECT</span> <span class="token number">5</span> <span class="token operator">NOT</span> <span class="token operator">IN</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token operator">+</span><span class="token comment">--------------------------+</span><span class="token operator">|</span> <span class="token number">5</span> <span class="token operator">NOT</span> <span class="token operator">IN</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span> <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">--------------------------+</span><span class="token operator">|</span>                        <span class="token number">0</span> <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">--------------------------+</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p></li><li><p>IS NULL</p><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">mysql<span class="token operator">></span> <span class="token keyword">SELECT</span> <span class="token boolean">NULL</span> <span class="token operator">IS</span> <span class="token boolean">NULL</span><span class="token punctuation">;</span><span class="token operator">+</span><span class="token comment">--------------+</span><span class="token operator">|</span> <span class="token boolean">NULL</span> <span class="token operator">IS</span> <span class="token boolean">NULL</span> <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">--------------+</span><span class="token operator">|</span>            <span class="token number">1</span> <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">--------------+</span>mysql<span class="token operator">></span> <span class="token keyword">SELECT</span> <span class="token string">'a'</span> <span class="token operator">IS</span> <span class="token boolean">NULL</span><span class="token punctuation">;</span><span class="token operator">+</span><span class="token comment">-------------+</span><span class="token operator">|</span> <span class="token string">'a'</span> <span class="token operator">IS</span> <span class="token boolean">NULL</span> <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">-------------+</span><span class="token operator">|</span>           <span class="token number">0</span> <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">-------------+</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p></li><li><p>IS NOT NULL</p><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">mysql<span class="token operator">></span> <span class="token keyword">SELECT</span> <span class="token boolean">NULL</span> <span class="token operator">IS</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">;</span><span class="token operator">+</span><span class="token comment">------------------+</span><span class="token operator">|</span> <span class="token boolean">NULL</span> <span class="token operator">IS</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">------------------+</span><span class="token operator">|</span>                <span class="token number">0</span> <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">------------------+</span>mysql<span class="token operator">></span> <span class="token keyword">SELECT</span> <span class="token string">'a'</span> <span class="token operator">IS</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">;</span><span class="token operator">+</span><span class="token comment">-----------------+</span><span class="token operator">|</span> <span class="token string">'a'</span> <span class="token operator">IS</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">-----------------+</span><span class="token operator">|</span>               <span class="token number">1</span> <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">-----------------+</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p></li><li><p>LIKE</p><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">mysql<span class="token operator">></span> <span class="token keyword">SELECT</span> <span class="token string">'12345'</span> <span class="token operator">LIKE</span> <span class="token string">'12%'</span><span class="token punctuation">;</span><span class="token operator">+</span><span class="token comment">--------------------+</span><span class="token operator">|</span> <span class="token string">'12345'</span> <span class="token operator">LIKE</span> <span class="token string">'12%'</span> <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">--------------------+</span><span class="token operator">|</span>                  <span class="token number">1</span> <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">--------------------+</span>mysql<span class="token operator">></span> <span class="token keyword">SELECT</span> <span class="token string">'12345'</span> <span class="token operator">LIKE</span> <span class="token string">'12_'</span><span class="token punctuation">;</span><span class="token operator">+</span><span class="token comment">--------------------+</span><span class="token operator">|</span> <span class="token string">'12345'</span> <span class="token operator">LIKE</span> <span class="token string">'12_'</span> <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">--------------------+</span><span class="token operator">|</span>                  <span class="token number">0</span> <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">--------------------+</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p></li><li><p>REGEXP</p><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">mysql<span class="token operator">></span> <span class="token keyword">SELECT</span> <span class="token string">'beijing'</span> <span class="token operator">REGEXP</span> <span class="token string">'jing'</span><span class="token punctuation">;</span><span class="token operator">+</span><span class="token comment">-------------------------+</span><span class="token operator">|</span> <span class="token string">'beijing'</span> <span class="token operator">REGEXP</span> <span class="token string">'jing'</span> <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">-------------------------+</span><span class="token operator">|</span>                       <span class="token number">1</span> <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">-------------------------+</span>mysql<span class="token operator">></span> <span class="token keyword">SELECT</span> <span class="token string">'beijing'</span> <span class="token operator">REGEXP</span> <span class="token string">'xi'</span><span class="token punctuation">;</span><span class="token operator">+</span><span class="token comment">-----------------------+</span><span class="token operator">|</span> <span class="token string">'beijing'</span> <span class="token operator">REGEXP</span> <span class="token string">'xi'</span> <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">-----------------------+</span><span class="token operator">|</span>                     <span class="token number">0</span> <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">-----------------------+</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p></li></ol><h2 id="逻辑运算符"><a href="#逻辑运算符" class="headerlink" title="逻辑运算符"></a>逻辑运算符</h2><p>逻辑运算符用来判断表达式的真假。如果表达式是真，结果返回 <code>1</code>。如果表达式是假，结果返回 <code>0</code>。</p><div class="table-container"><table><thead><tr><th style="text-align:center">运算符号</th><th style="text-align:center">作用</th></tr></thead><tbody><tr><td style="text-align:center">NOT 或 !</td><td style="text-align:center">逻辑非</td></tr><tr><td style="text-align:center">AND</td><td style="text-align:center">逻辑与</td></tr><tr><td style="text-align:center">OR</td><td style="text-align:center">逻辑或</td></tr><tr><td style="text-align:center">XOR</td><td style="text-align:center">逻辑异或</td></tr></tbody></table></div><ol><li><p>与</p><p> <pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">mysql<span class="token operator">></span> <span class="token keyword">SELECT</span> <span class="token number">2</span> <span class="token operator">AND</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token operator">+</span><span class="token comment">---------+</span><span class="token operator">|</span> <span class="token number">2</span> <span class="token operator">AND</span> <span class="token number">0</span> <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">---------+</span><span class="token operator">|</span>       <span class="token number">0</span> <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">---------+</span><span class="token operator">+</span><span class="token comment">---------+</span>mysql<span class="token operator">></span> <span class="token keyword">SELECT</span> <span class="token number">2</span> <span class="token operator">AND</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token operator">+</span><span class="token comment">---------+</span><span class="token operator">+</span><span class="token comment">---------+</span><span class="token operator">|</span> <span class="token number">2</span> <span class="token operator">AND</span> <span class="token number">1</span> <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">---------+</span><span class="token operator">|</span>       <span class="token number">1</span> <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">---------+</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p></li><li><p>或</p><p> <pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">mysql<span class="token operator">></span> <span class="token keyword">SELECT</span> <span class="token number">2</span> <span class="token operator">OR</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token operator">+</span><span class="token comment">--------+</span><span class="token operator">|</span> <span class="token number">2</span> <span class="token operator">OR</span> <span class="token number">0</span> <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">--------+</span><span class="token operator">|</span>      <span class="token number">1</span> <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">--------+</span>mysql<span class="token operator">></span> <span class="token keyword">SELECT</span> <span class="token number">2</span> <span class="token operator">OR</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token operator">+</span><span class="token comment">--------+</span><span class="token operator">|</span> <span class="token number">2</span> <span class="token operator">OR</span> <span class="token number">1</span> <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">--------+</span><span class="token operator">|</span>      <span class="token number">1</span> <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">--------+</span>mysql<span class="token operator">></span> <span class="token keyword">SELECT</span> <span class="token number">0</span> <span class="token operator">OR</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token operator">+</span><span class="token comment">--------+</span><span class="token operator">|</span> <span class="token number">0</span> <span class="token operator">OR</span> <span class="token number">0</span> <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">--------+</span><span class="token operator">|</span>      <span class="token number">0</span> <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">--------+</span>mysql<span class="token operator">></span> <span class="token keyword">SELECT</span> <span class="token number">1</span> <span class="token operator">||</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token operator">+</span><span class="token comment">--------+</span><span class="token operator">|</span> <span class="token number">1</span> <span class="token operator">||</span> <span class="token number">0</span> <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">--------+</span><span class="token operator">|</span>      <span class="token number">1</span> <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">--------+</span>mysql<span class="token operator">></span> <span class="token keyword">SELECT</span> <span class="token boolean">NULL</span> <span class="token operator">OR</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token operator">+</span><span class="token comment">-----------+</span><span class="token operator">|</span> <span class="token boolean">NULL</span> <span class="token operator">OR</span> <span class="token number">1</span> <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">-----------+</span><span class="token operator">|</span>         <span class="token number">1</span> <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">-----------+</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p></li><li><p>非</p><p> <pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">mysql<span class="token operator">></span> <span class="token keyword">SELECT</span> <span class="token operator">NOT</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token operator">+</span><span class="token comment">-------+</span><span class="token operator">|</span> <span class="token operator">NOT</span> <span class="token number">1</span> <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">-------+</span><span class="token operator">|</span>     <span class="token number">0</span> <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">-------+</span>mysql<span class="token operator">></span> <span class="token keyword">SELECT</span> <span class="token operator">!</span><span class="token number">0</span><span class="token punctuation">;</span><span class="token operator">+</span><span class="token comment">----+</span><span class="token operator">|</span> <span class="token operator">!</span><span class="token number">0</span> <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">----+</span><span class="token operator">|</span>  <span class="token number">1</span> <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">----+</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p></li><li><p>异或</p><p> <pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">mysql<span class="token operator">></span> <span class="token keyword">SELECT</span> <span class="token number">1</span> <span class="token operator">XOR</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token operator">+</span><span class="token comment">---------+</span><span class="token operator">|</span> <span class="token number">1</span> <span class="token operator">XOR</span> <span class="token number">1</span> <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">---------+</span><span class="token operator">|</span>       <span class="token number">0</span> <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">---------+</span>mysql<span class="token operator">></span> <span class="token keyword">SELECT</span> <span class="token number">0</span> <span class="token operator">XOR</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token operator">+</span><span class="token comment">---------+</span><span class="token operator">|</span> <span class="token number">0</span> <span class="token operator">XOR</span> <span class="token number">0</span> <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">---------+</span><span class="token operator">|</span>       <span class="token number">0</span> <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">---------+</span>mysql<span class="token operator">></span> <span class="token keyword">SELECT</span> <span class="token number">1</span> <span class="token operator">XOR</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token operator">+</span><span class="token comment">---------+</span><span class="token operator">|</span> <span class="token number">1</span> <span class="token operator">XOR</span> <span class="token number">0</span> <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">---------+</span><span class="token operator">|</span>       <span class="token number">1</span> <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">---------+</span>mysql<span class="token operator">></span> <span class="token keyword">SELECT</span> <span class="token boolean">NULL</span> <span class="token operator">XOR</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token operator">+</span><span class="token comment">------------+</span><span class="token operator">|</span> <span class="token boolean">NULL</span> <span class="token operator">XOR</span> <span class="token number">1</span> <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">------------+</span><span class="token operator">|</span>       <span class="token boolean">NULL</span> <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">------------+</span>mysql<span class="token operator">></span> <span class="token keyword">SELECT</span> <span class="token number">1</span> <span class="token operator">^</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token operator">+</span><span class="token comment">-------+</span><span class="token operator">|</span> <span class="token number">1</span> <span class="token operator">^</span> <span class="token number">0</span> <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">-------+</span><span class="token operator">|</span>     <span class="token number">1</span> <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">-------+</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p></li></ol><h2 id="位运算符"><a href="#位运算符" class="headerlink" title="位运算符"></a>位运算符</h2><p>位运算符是在二进制数上进行计算的运算符。位运算会先将操作数变成二进制数，进行位运算。然后再将计算结果从二进制数变回十进制数。</p><div class="table-container"><table><thead><tr><th style="text-align:center">运算符号</th><th style="text-align:center">作用</th></tr></thead><tbody><tr><td style="text-align:center">&amp;</td><td style="text-align:center">按位与</td></tr><tr><td style="text-align:center">&vert;</td><td style="text-align:center">按位或</td></tr><tr><td style="text-align:center">^</td><td style="text-align:center">按位异或</td></tr><tr><td style="text-align:center">!</td><td style="text-align:center">取反</td></tr><tr><td style="text-align:center">&lt;&lt;</td><td style="text-align:center">左移</td></tr><tr><td style="text-align:center">&gt;&gt;</td><td style="text-align:center">右移</td></tr></tbody></table></div><ol><li><p>按位与</p><p> <pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">mysql<span class="token operator">></span> <span class="token keyword">SELECT</span> <span class="token number">3</span><span class="token operator">&amp;</span><span class="token number">5</span><span class="token punctuation">;</span><span class="token operator">+</span><span class="token comment">-----+</span><span class="token operator">|</span> <span class="token number">3</span><span class="token operator">&amp;</span><span class="token number">5</span> <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">-----+</span><span class="token operator">|</span>   <span class="token number">1</span> <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">-----+</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p></li><li><p>按位或</p><p> <pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">mysql<span class="token operator">></span> <span class="token keyword">SELECT</span> <span class="token number">3</span><span class="token operator">|</span><span class="token number">5</span><span class="token punctuation">;</span><span class="token operator">+</span><span class="token comment">-----+</span><span class="token operator">|</span> <span class="token number">3</span><span class="token operator">|</span><span class="token number">5</span> <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">-----+</span><span class="token operator">|</span>   <span class="token number">7</span> <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">-----+</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p></li><li><p>按位异或</p><p> <pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">mysql<span class="token operator">></span> <span class="token keyword">SELECT</span> <span class="token number">3</span><span class="token operator">^</span><span class="token number">5</span><span class="token punctuation">;</span><span class="token operator">+</span><span class="token comment">-----+</span><span class="token operator">|</span> <span class="token number">3</span><span class="token operator">^</span><span class="token number">5</span> <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">-----+</span><span class="token operator">|</span>   <span class="token number">6</span> <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">-----+</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p></li><li><p>按位取反</p><p> <pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">mysql<span class="token operator">></span> <span class="token keyword">SELECT</span> <span class="token operator">~</span><span class="token number">18446744073709551612</span><span class="token punctuation">;</span><span class="token operator">+</span><span class="token comment">-----------------------+</span><span class="token operator">|</span> <span class="token operator">~</span><span class="token number">18446744073709551612</span> <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">-----------------------+</span><span class="token operator">|</span>                     <span class="token number">3</span> <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">-----------------------+</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p></li><li><p>按位右移</p><p> <pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">mysql<span class="token operator">></span> <span class="token keyword">SELECT</span> <span class="token number">3</span><span class="token operator">>></span><span class="token number">1</span><span class="token punctuation">;</span><span class="token operator">+</span><span class="token comment">------+</span><span class="token operator">|</span> <span class="token number">3</span><span class="token operator">>></span><span class="token number">1</span> <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">------+</span><span class="token operator">|</span>    <span class="token number">1</span> <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">------+</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p></li><li><p>按位左移</p><p> <pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">mysql<span class="token operator">></span> <span class="token keyword">SELECT</span> <span class="token number">3</span><span class="token operator">&lt;&lt;</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token operator">+</span><span class="token comment">------+</span><span class="token operator">|</span> <span class="token number">3</span><span class="token operator">&lt;&lt;</span><span class="token number">1</span> <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">------+</span><span class="token operator">|</span>    <span class="token number">6</span> <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">------+</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p></li></ol><h2 id="运算符优先级"><a href="#运算符优先级" class="headerlink" title="运算符优先级"></a>运算符优先级</h2><p>最低优先级为： <code>:=</code>。</p><div class="table-container"><table><thead><tr><th style="text-align:center">优先级顺序</th><th style="text-align:center">运算符</th></tr></thead><tbody><tr><td style="text-align:center">1</td><td style="text-align:center">:=</td></tr><tr><td style="text-align:center">2</td><td style="text-align:center">&vert;&vert;, OR, XOR</td></tr><tr><td style="text-align:center">3</td><td style="text-align:center">&amp;&amp;, AND</td></tr><tr><td style="text-align:center">4</td><td style="text-align:center">NOT</td></tr><tr><td style="text-align:center">5</td><td style="text-align:center">BETWEEN, CASE, WHEN, THEN, ELSE</td></tr><tr><td style="text-align:center">6</td><td style="text-align:center">=, &lt;=&gt;, &gt;=, &gt;, &lt;=, &lt;, &lt;&gt;, !=, IS, LIKE, REGEXP, IN</td></tr><tr><td style="text-align:center">7</td><td style="text-align:center">&vert;</td></tr><tr><td style="text-align:center">8</td><td style="text-align:center">&amp;</td></tr><tr><td style="text-align:center">9</td><td style="text-align:center">&lt;&lt;, &gt;&gt;</td></tr><tr><td style="text-align:center">10</td><td style="text-align:center">-, +</td></tr><tr><td style="text-align:center">11</td><td style="text-align:center">*, /, DIV, %, MOD</td></tr><tr><td style="text-align:center">12</td><td style="text-align:center">^</td></tr><tr><td style="text-align:center">13</td><td style="text-align:center">- (一元减号)，~ (一元比特反转)</td></tr><tr><td style="text-align:center">14</td><td style="text-align:center">!</td></tr></tbody></table></div><h1 id="关键字"><a href="#关键字" class="headerlink" title="关键字"></a>关键字</h1><h2 id="关键字汇总"><a href="#关键字汇总" class="headerlink" title="关键字汇总"></a>关键字汇总</h2><div class="table-container"><table><thead><tr><th style="text-align:center">关键字</th><th style="text-align:center">关键字</th><th style="text-align:center">关键字</th></tr></thead><tbody><tr><td style="text-align:center">ADD</td><td style="text-align:center">ALL</td><td style="text-align:center">ALTER</td></tr><tr><td style="text-align:center">ANALYZE</td><td style="text-align:center">AND</td><td style="text-align:center">AS</td></tr><tr><td style="text-align:center">ASC</td><td style="text-align:center">ASENSITIVE</td><td style="text-align:center">BEFORE</td></tr><tr><td style="text-align:center">BETWEEN</td><td style="text-align:center">BIGINT</td><td style="text-align:center">BINARY</td></tr><tr><td style="text-align:center">BLOB</td><td style="text-align:center">BOTH</td><td style="text-align:center">BY</td></tr><tr><td style="text-align:center">CALL</td><td style="text-align:center">CASCADE</td><td style="text-align:center">CASE</td></tr><tr><td style="text-align:center">CHANGE</td><td style="text-align:center">CHAR</td><td style="text-align:center">CHARACTER</td></tr><tr><td style="text-align:center">CHECK</td><td style="text-align:center">COLLATE</td><td style="text-align:center">COLUMN</td></tr><tr><td style="text-align:center">CONDITION</td><td style="text-align:center">CONNECTION</td><td style="text-align:center">CONSTRAINT</td></tr><tr><td style="text-align:center">CONTINUE</td><td style="text-align:center">CONVERT</td><td style="text-align:center">CREATE</td></tr><tr><td style="text-align:center">CROSS</td><td style="text-align:center">CURRENT_DATE</td><td style="text-align:center">CURRENT_TIME</td></tr><tr><td style="text-align:center">CURRENT_TIMESTAMP</td><td style="text-align:center">CURRENT_USER</td><td style="text-align:center">CURSOR</td></tr><tr><td style="text-align:center">DATABASE</td><td style="text-align:center">DATABASES</td><td style="text-align:center">DAY_HOUR</td></tr><tr><td style="text-align:center">DAY_MICROSECOND</td><td style="text-align:center">DAY_MINUTE</td><td style="text-align:center">DAY_SECOND</td></tr><tr><td style="text-align:center">DEC</td><td style="text-align:center">DECIMAL</td><td style="text-align:center">DECLARE</td></tr><tr><td style="text-align:center">DEFAULT</td><td style="text-align:center">DELAYED</td><td style="text-align:center">DELETE</td></tr><tr><td style="text-align:center">DESC</td><td style="text-align:center">DESCRIBE</td><td style="text-align:center">DETERMINISTIC</td></tr><tr><td style="text-align:center">DISTINCT</td><td style="text-align:center">DISTINCTROW</td><td style="text-align:center">DIV</td></tr><tr><td style="text-align:center">DOUBLE</td><td style="text-align:center">DROP</td><td style="text-align:center">DUAL</td></tr><tr><td style="text-align:center">EACH</td><td style="text-align:center">ELSE</td><td style="text-align:center">ELSEIF</td></tr><tr><td style="text-align:center">ENCLOSED</td><td style="text-align:center">ESCAPED</td><td style="text-align:center">EXISTS</td></tr><tr><td style="text-align:center">EXIT</td><td style="text-align:center">EXPLAIN</td><td style="text-align:center">FALSE</td></tr><tr><td style="text-align:center">FETCH</td><td style="text-align:center">FLOAT</td><td style="text-align:center">FLOAT4</td></tr><tr><td style="text-align:center">FLOAT8</td><td style="text-align:center">FOR</td><td style="text-align:center">FORCE</td></tr><tr><td style="text-align:center">FOREIGN</td><td style="text-align:center">FROM</td><td style="text-align:center">FULLTEXT</td></tr><tr><td style="text-align:center">GOTO</td><td style="text-align:center">GRANT</td><td style="text-align:center">GROUP</td></tr><tr><td style="text-align:center">HAVING</td><td style="text-align:center">HIGH_PRIORITY</td><td style="text-align:center">HOUR_MICROSECOND</td></tr><tr><td style="text-align:center">HOUR_MINUTE</td><td style="text-align:center">HOUR_SECOND</td><td style="text-align:center">IF</td></tr><tr><td style="text-align:center">IGNORE</td><td style="text-align:center">IN</td><td style="text-align:center">INDEX</td></tr><tr><td style="text-align:center">INFILE</td><td style="text-align:center">INNER</td><td style="text-align:center">INOUT</td></tr><tr><td style="text-align:center">INSENSITIVE</td><td style="text-align:center">INSERT</td><td style="text-align:center">INT</td></tr><tr><td style="text-align:center">INT1</td><td style="text-align:center">INT2</td><td style="text-align:center">INT3</td></tr><tr><td style="text-align:center">INT4</td><td style="text-align:center">INT8</td><td style="text-align:center">INTEGER</td></tr><tr><td style="text-align:center">INTERVAL</td><td style="text-align:center">INTO</td><td style="text-align:center">IS</td></tr><tr><td style="text-align:center">ITERATE</td><td style="text-align:center">JOIN</td><td style="text-align:center">KEY</td></tr><tr><td style="text-align:center">KEYS</td><td style="text-align:center">KILL</td><td style="text-align:center">LABEL</td></tr><tr><td style="text-align:center">LEADING</td><td style="text-align:center">LEAVE</td><td style="text-align:center">LEFT</td></tr><tr><td style="text-align:center">LIKE</td><td style="text-align:center">LIMIT</td><td style="text-align:center">LINEAR</td></tr><tr><td style="text-align:center">LINES</td><td style="text-align:center">LOAD</td><td style="text-align:center">LOCALTIME</td></tr><tr><td style="text-align:center">LOCALTIMESTAMP</td><td style="text-align:center">LOCK</td><td style="text-align:center">LONG</td></tr><tr><td style="text-align:center">LONGBLOB</td><td style="text-align:center">LONGTEXT</td><td style="text-align:center">LOOP</td></tr><tr><td style="text-align:center">LOW_PRIORITY</td><td style="text-align:center">MATCH</td><td style="text-align:center">MEDIUMBLOB</td></tr><tr><td style="text-align:center">MEDIUMINT</td><td style="text-align:center">MEDIUMTEXT</td><td style="text-align:center">MIDDLEINT</td></tr><tr><td style="text-align:center">MINUTE_MICROSECOND</td><td style="text-align:center">MINUTE_SECOND</td><td style="text-align:center">MOD</td></tr><tr><td style="text-align:center">MODIFIES</td><td style="text-align:center">NATURAL</td><td style="text-align:center">NOT</td></tr><tr><td style="text-align:center">NO_WRITE_TO_BINLOG</td><td style="text-align:center">NULL</td><td style="text-align:center">NUMERIC</td></tr><tr><td style="text-align:center">ON</td><td style="text-align:center">OPTIMIZE</td><td style="text-align:center">OPTION</td></tr><tr><td style="text-align:center">OPTIONALLY</td><td style="text-align:center">OR ORDER</td><td style="text-align:center">&nbsp;</td></tr><tr><td style="text-align:center">OUT</td><td style="text-align:center">OUTER</td><td style="text-align:center">OUTFILE</td></tr><tr><td style="text-align:center">PRECISION</td><td style="text-align:center">PRIMARY</td><td style="text-align:center">PROCEDURE</td></tr><tr><td style="text-align:center">PURGE</td><td style="text-align:center">RAID0</td><td style="text-align:center">RANGE</td></tr><tr><td style="text-align:center">READ</td><td style="text-align:center">READS</td><td style="text-align:center">REAL</td></tr><tr><td style="text-align:center">REFERENCES</td><td style="text-align:center">REGEXP</td><td style="text-align:center">RELEASE</td></tr><tr><td style="text-align:center">RENAME</td><td style="text-align:center">REPEAT</td><td style="text-align:center">REPLACE</td></tr><tr><td style="text-align:center">REQUIRE</td><td style="text-align:center">RESTRICT</td><td style="text-align:center">RETURN</td></tr><tr><td style="text-align:center">REVOKE</td><td style="text-align:center">RIGHT</td><td style="text-align:center">RLIKE</td></tr><tr><td style="text-align:center">SCHEMA</td><td style="text-align:center">SCHEMAS</td><td style="text-align:center">SECOND_MICROSECOND</td></tr><tr><td style="text-align:center">SELECT</td><td style="text-align:center">SENSITIVE</td><td style="text-align:center">SEPARATOR</td></tr><tr><td style="text-align:center">SET</td><td style="text-align:center">SHOW</td><td style="text-align:center">SMALLINT</td></tr><tr><td style="text-align:center">SPATIAL</td><td style="text-align:center">SPECIFIC</td><td style="text-align:center">SQL</td></tr><tr><td style="text-align:center">SQLEXCEPTION</td><td style="text-align:center">SQLSTATE</td><td style="text-align:center">SQLWARNING</td></tr><tr><td style="text-align:center">SQL_BIG_RESULT</td><td style="text-align:center">SQL_CALC_FOUND_ROWS</td><td style="text-align:center">SQL_SMALL_RESULT</td></tr><tr><td style="text-align:center">SSL</td><td style="text-align:center">STARTING</td><td style="text-align:center">STRAIGHT_JOIN</td></tr><tr><td style="text-align:center">TABLE</td><td style="text-align:center">TERMINATED</td><td style="text-align:center">THEN</td></tr><tr><td style="text-align:center">TINYBLOB</td><td style="text-align:center">TINYINT</td><td style="text-align:center">TINYTEXT</td></tr><tr><td style="text-align:center">TO</td><td style="text-align:center">TRAILING</td><td style="text-align:center">TRIGGER</td></tr><tr><td style="text-align:center">TRUE</td><td style="text-align:center">UNDO</td><td style="text-align:center">UNION</td></tr><tr><td style="text-align:center">UNIQUE</td><td style="text-align:center">UNLOCK</td><td style="text-align:center">UNSIGNED</td></tr><tr><td style="text-align:center">UPDATE</td><td style="text-align:center">USAGE</td><td style="text-align:center">USE</td></tr><tr><td style="text-align:center">USING</td><td style="text-align:center">UTC_DATE</td><td style="text-align:center">UTC_TIME</td></tr><tr><td style="text-align:center">UTC_TIMESTAMP</td><td style="text-align:center">VALUES</td><td style="text-align:center">VARBINARY</td></tr><tr><td style="text-align:center">VARCHAR</td><td style="text-align:center">VARCHARACTER</td><td style="text-align:center">VARYING</td></tr><tr><td style="text-align:center">WHEN</td><td style="text-align:center">WHERE</td><td style="text-align:center">WHILE</td></tr><tr><td style="text-align:center">WITH</td><td style="text-align:center">WRITE</td><td style="text-align:center">X509</td></tr><tr><td style="text-align:center">XOR</td><td style="text-align:center">YEAR_MONTH</td><td style="text-align:center">ZEROFILL</td></tr></tbody></table></div><h2 id="执行顺序"><a href="#执行顺序" class="headerlink" title="执行顺序"></a>执行顺序</h2><p>在 SQL 语句中每个关键字都会按照顺序往下执行，而每一步操作，会生成一个虚拟表，最后的虚拟表就是最终结果。</p><p>基本 SQL 语句如下：</p><p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token keyword">SELECT</span> <span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">)</span><span class="token keyword">DISTINCT</span> <span class="token operator">&lt;</span>select_list<span class="token operator">></span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token keyword">FROM</span> <span class="token operator">&lt;</span>left_table<span class="token operator">></span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token operator">&lt;</span>join_type<span class="token operator">></span> <span class="token keyword">JOIN</span> <span class="token operator">&lt;</span>right_table<span class="token operator">></span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token keyword">ON</span> <span class="token operator">&lt;</span>join_condition<span class="token operator">></span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token keyword">WHERE</span> <span class="token operator">&lt;</span>where_condition<span class="token operator">></span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token keyword">GROUP</span> <span class="token keyword">BY</span> <span class="token operator">&lt;</span>group_by_list<span class="token operator">></span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token keyword">WITH</span>&#123;CUBE<span class="token operator">|</span>ROLLUP&#125;<span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token keyword">HAVING</span> <span class="token operator">&lt;</span>having_condition<span class="token operator">></span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token keyword">ORDER</span> <span class="token keyword">BY</span> <span class="token operator">&lt;</span>order_by_list<span class="token operator">></span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span><span class="token keyword">LIMIT</span> <span class="token operator">&lt;</span>limit_number<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p>执行顺序：</p><ol><li>FROM： 对 <code>FROM</code> 左边的表和右边的表计算笛卡尔积，产生虚表 <code>VT1</code>；</li><li>ON： 对虚拟表 <code>VT1</code> 进行 <code>ON</code> 筛选，只有那些符合条件的行才会被记录在虚拟表 <code>VT2</code> 中；</li><li>JOIN：如果是 <code>OUT JOIN</code>，那么将保留表中（如左表或者右表）未匹配的行作为外部行添加到虚拟表 <code>VT2</code> 中，从而产生虚拟表 <code>VT3</code>；</li><li>WHERE：对虚拟表 <code>VT3</code> 进行 <code>WHERE</code> 条件过滤，只有符合的记录才会被放入到虚拟表 VT4；</li><li>GROUP BY：根据 <code>GROUP BY</code> 子句中的列，对虚拟表 <code>VT4</code> 进行分组操作，产生虚拟表 <code>VT5</code>；</li><li>CUBE | ROLLUP：对虚拟表 <code>VT5</code> 进行 <code>CUBE</code> 或者 <code>ROLLUP</code> 操作，产生虚拟表 <code>VT6</code>；</li><li>HAVING：对虚拟表 <code>VT6</code> 进行 <code>HAVING</code> 条件过滤，只有符合的记录才会被插入到虚拟表 <code>VT7</code> 中；</li><li>SELECT：执行 <code>SELECT</code> 操作，选择指定的列，插入到虚拟表 <code>VT8</code> 中；</li><li>DISTINCT：对虚拟表 <code>VT8</code> 中的记录进行去重，产生虚拟表 <code>VT9</code>；</li><li>ORDER BY：将虚拟表 <code>VT9</code> 中的记录按照进行排序操作，产生虚拟表 <code>VT10</code>；</li><li>LIMIT：取出指定行的记录，产生虚拟表 <code>VT11</code>，并将结果返回。</li></ol>]]></content>
      
      
      <categories>
          
          <category> 教程笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 大数据 </tag>
            
            <tag> MySQL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>大数据精选清单</title>
      <link href="post/fc3d946f.html"/>
      <url>post/fc3d946f.html</url>
      
        <content type="html"><![CDATA[<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>精选的大数据工具、框架、资源和其他清单。</p><blockquote><p>本文翻译自：<a href="https://github.com/onurakpolat/awesome-bigdata">Awesome Big Data</a><br>灵感来自：<a href="https://github.com/ziadoz/awesome-php">awesome-php</a> &amp; <a href="https://github.com/vinta/awesome-python">awesome-python</a> &amp; <a href="https://github.com/Sdogruyol/awesome-ruby">awesome-ruby</a> &amp; <a href="http://hadoopecosystemtable.github.io/">hadoopecosystemtable</a> &amp; <a href="http://usefulstuff.io/big-data/">big-data</a></p></blockquote><h1 id="关系型数据库"><a href="#关系型数据库" class="headerlink" title="关系型数据库"></a>关系型数据库</h1><ul><li><a href="https://www.mysql.com/">MySQL</a> - 世界上最流行的开源数据库。</li><li><a href="https://www.postgresql.org/">PostgreSQL</a> - 世界上最先进的开源数据库。</li><li><a href="http://www.oracle.com/us/corporate/features/database-12c/index.html">Oracle Database</a> - 对象关系数据库管理系统。</li><li><a href="http://www.teradata.com/products-and-services/teradata-database/">Teradata</a> - 高性能 MPP 数据仓库平台。</li></ul><h1 id="框架"><a href="#框架" class="headerlink" title="框架"></a>框架</h1><ul><li><a href="https://github.com/facebook/bistro">Bistro</a> - 用于批处理和流分析的通用数据处理引擎。它基于一种新的数据模型，该模型通过函数来表示数据，并通过列操作来处理数据，而不仅仅使用 MapReduce 或 SQL 等传统方法来设置操作。</li><li><a href="https://www.ibm.com/analytics/us/en/technology/stream-computing/">IBM Streams</a> - 分布式处理和实时分析平台。可以和大数据生态系统中的许多流行技术（Kafka、HDFS、Spark 等）集成。</li><li><a href="http://hadoop.apache.org/">Apache Hadoop</a> - 分布式处理框架。集成了 MapReduce（并行处理）、YARN（作业调度）和 HDFS（分布式文件系统）。</li><li><a href="https://github.com/caskdata/tigon">Tigon</a> - 高吞吐的实时流处理框架。</li><li><a href="http://pachyderm.io/">Pachyderm</a> - Pachyderm 是一个基于 Docker 和 Kubernetes 的数据存储平台，可以用在重复的数据处理和分析场景。</li><li><a href="https://github.com/polyaxon/polyaxon">Polyaxon</a> - 一个可复制、可扩展的机器学习和深度学习平台。</li></ul><h1 id="分布式编程"><a href="#分布式编程" class="headerlink" title="分布式编程"></a>分布式编程</h1><ul><li><a href="https://github.com/addthis/hydra">AddThis Hydra</a> - 分布式数据处理和存储系统，最初由 AddThis 开发。</li><li><a href="http://databricks.github.io/simr/">AMPLab SIMR</a> - 在 Hadoop MapReduce v1 上运行 Spark。</li><li><a href="https://apex.apache.org/">Apache APEX</a> - 用于大数据流和批处理的统一企业平台。</li><li><a href="https://beam.apache.org/">Apache Beam</a> - 用于定义和执行数据处理工作流的统一模型和一组特定于语言的 sdk。</li><li><a href="http://crunch.apache.org/">Apache Crunch</a> - 一个简单的 Java API，用于处理 Join 和数据聚合之类的任务，这些任务在普通 MapReduce 上实现起来很繁琐。</li><li><a href="http://incubator.apache.org/projects/datafu.html">Apache DataFu</a> - 由 LinkedIn 为 Hadoop 和 Pig 开发的用户定义函数的集合。</li><li><a href="http://flink.apache.org/">Apache Flink</a> - 分布式处理引擎框架，用于在无界和有界数据流上进行有状态计算。</li><li><a href="http://gearpump.apache.org/">Apache Gearpump</a> - 基于 Akka 的实时大数据流引擎。</li><li><a href="http://gora.apache.org/">Apache Gora</a> - 内存数据模型和持久性框架。</li><li><a href="http://hama.apache.org/">Apache Hama</a> - BSP（Bulk Synchronous Parallel）计算框架。</li><li><a href="https://wiki.apache.org/hadoop/MapReduce/">Apache MapReduce</a> - 在集群上使用并行分布式算法处理大型数据集的编程模型。</li><li><a href="https://pig.apache.org/">Apache Pig</a> - 用于表达 Hadoop 数据分析程序的高级语言。</li><li><a href="http://reef.apache.org/">Apache REEF</a> - 用来简化和统一低层大数据系统的保留性评估执行框架。</li><li><a href="http://incubator.apache.org/projects/s4.html">Apache S4</a> - 一个常规用途的、分布式的、可伸缩的、容错的、可插入式的平台，主要用于处理连续的数据流。</li><li><a href="http://spark.apache.org/">Apache Spark</a> - 快速、通用的大规模数据处理引擎。</li><li><a href="https://spark.apache.org/docs/latest/streaming-programming-guide.html">Apache Spark Streaming</a> - 实时流处理引擎，属于 Spark 的一部分。</li><li><a href="http://storm.apache.org">Apache Storm</a> - Twitter 开发的，可在 YARN 上进行流处理的框架。</li><li><a href="http://samza.apache.org/">Apache Samza</a> - 基于 Kafka 和 YARN 的流处理的框架。</li><li><a href="http://tez.apache.org/">Apache Tez</a> - 基于 YARN 的，可执行复杂 DAG（有向无环图）任务的应用程序框架。</li><li><a href="https://incubator.apache.org/projects/twill.html">Apache Twill</a> - YARN 上的抽象，减少了开发分布式应用程序的复杂性。</li><li><a href="http://bigflow.cloud/en/index.html">Baidu Bigflow</a> - 一个允许编写分布式计算程序的接口，它提供了许多简单、灵活、强大的 API 来轻松处理任何规模的数据。</li><li><a href="http://cascalog.org/">Cascalog</a> - 数据处理和查询库。</li><li><a href="http://vldbarc.org/pvldb/vldb2010/pvldb_vol3/I08.pdf">Cheetah</a> - MapReduce 之上的高性能，用户自定义数据仓库。</li><li><a href="http://www.cascading.org/">Concurrent Cascading</a> - Hadoop 上的数据管理 / 分析框架。</li><li><a href="https://github.com/damballa/parkour">Damballa Parkour</a> - 为 Clojure 开发的 MapReduce 库。</li><li><a href="https://github.com/datasalt/pangool">Datasalt Pangool</a> - 可替代 MapReduce 范式。</li><li><a href="https://www.datatorrent.com/">DataTorrent StrAM</a> - 实时计算引擎，旨在以一种尽可能畅通的方式支持分布式、异步、实时的内存大数据计算，同时最小化开销和对性能的影响。</li><li><a href="https://www.facebook.com/notes/facebook-engineering/under-the-hood-scheduling-mapreduce-jobs-more-efficiently-with-corona/10151142560538920">Facebook Corona</a> - Hadoop 的增强，可以消除单点故障。</li><li><a href="http://peregrine_mapreduce.bitbucket.org/">Facebook Peregrine</a> - Map Reduce 框架。</li><li><a href="https://www.facebook.com/notes/facebook-engineering/under-the-hood-data-diving-with-scuba/10150599692628920">Facebook Scuba</a> - 分布式内存数据存储。</li><li><a href="https://googledevelopers.blogspot.it/2014/06/cloud-platform-at-google-io-new-big.html">Google Dataflow</a> - 创建数据管道来帮助我们摄取、转换和分析数据。</li><li><a href="https://research.google.com/archive/mapreduce.html">Google MapReduce</a> - Map Reduce 框架。</li><li><a href="https://research.google.com/pubs/pub41378.html">Google MillWheel</a> - 容错流处理框架。</li><li><a href="https://www.ibm.com/analytics/us/en/technology/stream-computing/">IBM Streams</a> - 用于分布式处理和实时分析的平台。 提供开箱即用的高级分析工具包，如地理空间、时间序列等。</li><li><a href="https://code.google.com/p/jaql/">JAQL</a> - 声明式编程语言，用于处理结构化、半结构化和非结构化数据。</li><li><a href="http://kitesdk.org/docs/current/">Kite</a> - 一组库、工具、示例和文档，重点在于简化在 Hadoop 生态系统之上构建系统的过程。</li><li><a href="http://druid.io/">Metamarkets Druid</a> - 用于实时分析大型数据集的框架。</li><li><a href="https://github.com/Netflix/PigPen">Netflix PigPen</a> - 是 Clojure 语音的 Map-Reduce，可以编译到 Apache Pig 或者 Cascading 中。</li><li><a href="http://discoproject.org/">Nokia Disco</a> - 诺基亚开发的 MapReduce 框架。</li><li><a href="http://www.onyxplatform.org/">Onyx</a> - 云的分布式计算。</li><li><a href="https://medium.com/@Pinterest_Engineering/pinlater-an-asynchronous-job-execution-system-b8664cb8aa7d">Pinterest Pinlater</a> - 异步作业执行系统。</li><li><a href="http://crs4.github.io/pydoop/">Pydoop</a> - 用 Python 编写，并采用 MapReduce 和 HDFS 技术对 Hadoop 进行扩展的 API。</li><li><a href="https://github.com/ray-project/ray">Ray</a> - 用于构建和运行分布式应用程序的快速而简单的框架。</li><li><a href="http://blueflood.io/">Rackerlabs Blueflood</a> - 多租户分布式度量处理系统。</li><li><a href="https://github.com/skale-me/skale-engine">Skale</a> - NodeJS 上的高性能分布式数据处理框架。</li><li><a href="http://stratosphere.eu/">Stratosphere</a> - 通用集群计算框架。</li><li><a href="https://streamdrill.com/">Streamdrill</a> - Streamdrill 在计算不同时间窗口上的事件流活动非常有用，并找出最活跃的时间窗口。</li><li><a href="https://github.com/IBMStreams/streamsx.topology">streamsx.topology</a> - 用于在 Java，Python 或 Scala 中构建 IBM Streams 应用程序的库。</li><li><a href="https://github.com/UnderstandLingBV/Tuktu">Tuktu</a> - 易于使用的批处理和流式计算平台，可以使用 Scala，Akka 和 Play 构建。</li><li><a href="https://github.com/twitter/heron">Twitter Heron</a> - 由 Twitter 开发的一个实时、分布式、容错的流处理引擎，主要用于代替 Storm。</li><li><a href="https://github.com/twitter/scalding">Twitter Scalding</a> - 用于 Map Reduce 作业的 Scala 库，基于 Cascading 构建。</li><li><a href="https://github.com/twitter/summingbird">Twitter Summingbird</a> - Summingbird 是一个类库，它允许我们编写看起来像原生 Scala 或 Java 集合转换的 MapReduce 程序，并在许多着名的分布式 MapReduce 平台上执行，包括 Storm 和 Scalding，由 Twitter 开发。</li><li><a href="https://blog.twitter.com/engineering/en_us/a/2014/tsar-a-timeseries-aggregator.html">Twitter TSAR</a> - Twitter 开发的时间序列聚合器。</li><li><a href="http://www.wallaroolabs.com/community">Wallaroo</a> - 超快弹性数据处理引擎，可以使有状态、分析、流处理和事件驱动的 AI 应用程序能够快速投入生产，而无需考虑规模。它为开发人员提供了几种语言的 API 来实现他们的自定义业务逻辑。</li></ul><h1 id="分布式文件系统"><a href="#分布式文件系统" class="headerlink" title="分布式文件系统"></a>分布式文件系统</h1><ul><li><a href="https://github.com/linkedin/ambry">Ambry</a> - 分布式对象存储，支持存储数万亿个小的不可变对象或者数十亿个大对象。</li><li><a href="http://hadoop.apache.org/">Apache HDFS</a> - 提供对应用程序数据的高吞吐量访问的分布式文件系统。</li><li><a href="http://kudu.apache.org/">Apache Kudu</a> - Hadoop 的存储层可实现对数据的快速分析。</li><li><a href="https://www.beegfs.io/content/">BeeGFS</a> - 之前称为 FhGFS，是一种并行分布式文件系统。</li><li><a href="http://ceph.com/ceph-storage/file-system/">Ceph Filesystem</a> -一个支持POSIX接口的文件系统。</li><li><a href="http://disco.readthedocs.org/en/latest/howto/ddfs.html">Disco DDFS</a> - 分布式文件系统。</li><li><a href="https://www.facebook.com/note.php?note_id=76191543919">Facebook Haystack</a> - 对象存储系统。</li><li><a href="http://static.googleusercontent.com/media/research.google.com/en//archive/gfs-sosp2003.pdf">Google GFS</a> - 分布式文件系统。</li><li><a href="http://static.googleusercontent.com/media/research.google.reverse-proxy.org/en/us/university/relations/facultysummit2010/storage_architecture_and_challenges.pdf">Google Colossus</a> - 分布式文件系统（GFS2）。</li><li><a href="https://research.google.com/pubs/pub36971.html">Google Megastore</a> - 可扩展、高可用的存储。</li><li><a href="https://www.gridgain.com/">GridGain</a> - GGFS，Hadoop 兼容的内存文件系统。</li><li><a href="http://wiki.lustre.org/">Lustre file system</a> - 高性能分布式文件系统。</li><li><a href="https://hadoop.apache.org/docs/current/hadoop-azure-datalake/index.html">Microsoft Azure Data Lake Store</a> - Azure 上兼容 HDFS 的存储。</li><li><a href="https://www.quantcast.com/about-us/quantcast-file-system/">Quantcast File System QFS</a> - 开源分布式文件系统。</li><li><a href="http://gluster.org/">Red Hat GlusterFS</a> - 横向扩展网络附加的存储文件系统。</li><li><a href="https://github.com/chrislusf/seaweedfs">Seaweed-FS</a> - 简单且高度可伸缩的分布式文件系统。</li><li><a href="http://www.alluxio.org/">Alluxio</a> - 开源的基于内存的分布式存储系统。</li><li><a href="https://www.tahoe-lafs.org/trac/tahoe-lafs">Tahoe-LAFS</a> - 去中心化的云存储系统。</li><li><a href="https://github.com/baidu/bfs">Baidu File System</a> - 分布式文件系统。</li></ul><h1 id="分布式索引"><a href="#分布式索引" class="headerlink" title="分布式索引"></a>分布式索引</h1><ul><li><a href="https://github.com/pilosa/pilosa">Pilosa</a> - 开源的分布式位图索引，极大地加速了跨多个大规模数据集的查询。</li></ul><h1 id="文档数据模型"><a href="#文档数据模型" class="headerlink" title="文档数据模型"></a>文档数据模型</h1><ul><li><a href="https://www.actian.com/data-management/ingres-sql-rdbms/">Actian Versant</a> - 面向对象的商业数据库管理系统。</li><li><a href="https://crate.io/">Crate Data</a> - 是一个开源的大规模可扩展数据存储，它不需要任何管理。</li><li><a href="http://www.infoq.com/news/2014/06/facebook-apollo">Facebook Apollo</a> - Facebook 的类似于 Paxos 的 NoSQL 数据库。</li><li><a href="http://comsysto.github.io/jumbodb/">jumboDB</a> - 基于 Hadoop 的面向文档的数据存储。</li><li><a href="https://engineering.linkedin.com/data">LinkedIn Espresso</a> - 可水平扩展的面向文档 NoSQL 数据存储。</li><li><a href="http://www.marklogic.com/">MarkLogic</a> - 模式无关的企业 NoSQL 数据库技术。</li><li><a href="https://azure.microsoft.com/en-us/services/cosmos-db/">Microsoft Azure DocumentDB</a> - NoSQL 云数据库服务，支持 MongoDB 协议</li><li><a href="https://www.mongodb.com/">MongoDB</a> - 面向文档的数据库系统。</li><li><a href="https://ravendb.net/">RavenDB</a> - 支持事务的开源文档数据库。</li><li><a href="https://rethinkdb.com/">RethinkDB</a> - 支持表 join 和 group by 等查询的文档数据库。</li></ul><h1 id="Key-Map-数据模型"><a href="#Key-Map-数据模型" class="headerlink" title="Key Map 数据模型"></a>Key Map 数据模型</h1><p><strong>注意</strong>: 业界存在一些术语混淆，存在两种不同的东西被称为“列式数据库”。这里列出的一些是围绕“键 - 映射”数据模型构建的分布式持久性数据库：所有数据都有一个(可能是组合的)键，键值对的映射与之关联。在某些系统中，多个这样的值映射可以与一个键关联，这些映射称为“列族”（值映射键称为“列”）。</p><p>另一种也称为“列式数据库”的技术，特点是它在磁盘或内存中如何存储数据。这些系统将所有行的相同列值数据存储在一起。因此，需要做更多的工作来获得给定键的所有列，但是需要更少的工作来获得给定列的所有值。</p><p>前一种在这里称为“键映射数据模型”。这些和 <a href="#Key-value-数据模型">Key-value 数据模型</a> 存储之间的界限相当模糊。</p><p>后者更多地是关于存储格式而不是数据模型，这些数据库我们把它归到 <a href="#列式数据库">列式数据库</a> 里面去了。</p><p>你可以到 Prof. Daniel Abadi 的博文：<a href="http://dbmsmusings.blogspot.com/2010/03/distinguishing-two-major-types-of_29.html">Distinguishing two major types of Column Stores</a>。</p><ul><li><a href="http://accumulo.apache.org/">Apache Accumulo</a> - 构建在 Hadoop 之上的分布式键值存储系统。</li><li><a href="http://cassandra.apache.org/">Apache Cassandra</a> - 受 BigTable 启发的、面向列的分布式数据存储。</li><li><a href="http://hbase.apache.org/">Apache HBase</a> - 受 BigTable 启发的、面向列的分布式数据存储。</li><li><a href="https://github.com/baidu/tera">Baidu Tera</a> - 受 BigTable 启发的一种大型分布式表格存储系统，具有高性能、可伸缩等存储特点，最初的设计是为了管理万亿量级的超链和网页信息。</li><li><a href="https://code.facebook.com/posts/321111638043166/hydrabase-the-evolution-of-hbase-facebook/">Facebook HydraBase</a> - 由 Facebook 开发的 HBase 演化版本。</li><li><a href="http://static.googleusercontent.com/media/research.google.com/en//archive/bigtable-osdi06.pdf">Google BigTable</a> - 面向列的分布式数据存储。</li><li><a href="https://cloud.google.com/datastore/docs/concepts/overview">Google Cloud Datastore</a> - 一个完全托管的无模式数据库，用于在 BigTable 上存储非关系数据。</li><li><a href="http://www.hypertable.org/">Hypertable</a> - 受 BigTable 启发的、面向列的分布式数据存储。</li><li><a href="https://github.com/infinidb/infinidb/">InfiniDB</a> - 通过 MySQL 接口访问，并使用大规模并行处理来并行化查询。</li><li><a href="https://github.com/caskdata/tephra">Tephra</a> - 使 HBase 支持事务</li><li><a href="https://blog.twitter.com/engineering/en_us/a/2014/manhattan-our-real-time-multi-tenant-distributed-database-for-twitter-scale.html">Twitter Manhattan</a> - Twitter 开发的实时、多租户分布式数据库。</li><li><a href="http://www.scylladb.com/">ScyllaDB</a> - 使用 C++ 编写的面向列的分布式数据存储，完全兼容 Apache Cassandra。</li></ul><h1 id="Key-value-数据模型"><a href="#Key-value-数据模型" class="headerlink" title="Key-value 数据模型"></a>Key-value 数据模型</h1><ul><li><a href="http://www.aerospike.com/">Aerospike</a> - 一个分布式，高可用的 K-V 类型的 NOSQL 数据库。提供类似传统数据库的ACID操作。</li><li><a href="https://aws.amazon.com/dynamodb/">Amazon DynamoDB</a> - 分布式 key/value 存储，Dynamo 论文的实现。</li><li><a href="https://open.dgraph.io/post/badger/">Badger</a> - 一个快速、简单、高效和持久的键值存储，是用 Go 编写。</li><li><a href="https://github.com/boltdb/bolt">Bolt</a> - 可在 Go 语言中使用的嵌入式键值数据库。</li><li><a href="https://github.com/Bobris/BTDB">BTDB</a> - .Net 中的 Key Value 数据库，包含 Object DB Layer，RPC，dynamic IL 等等。</li><li><a href="https://github.com/tidwall/buntdb">BuntDB</a> - Go 语言的一个快速，可嵌入，基于内存的 key/value 数据库，支持自定义索引和地理空间。</li><li><a href="https://github.com/cbd/edis">Edis</a> - 协议兼容 Redis 的数据库，可替代 Redis。</li><li><a href="https://github.com/nathanmarz/elephantdb">ElephantDB</a> - 专门用于从 Hadoop 导出数据的分布式数据库。</li><li><a href="https://geteventstore.com/">EventStore</a> - 分布式时间序列数据库。</li><li><a href="https://github.com/griddb/griddb_nosql">GridDB</a> - 一款高度可扩展的 NoSQL 数据库，非常适用于物联网和大数据领域，还具有高可靠性和高性能这些特性。</li><li><a href="https://github.com/rescrv/HyperDex">HyperDex</a> - 可扩展的下一代键值和文档存储，具有多种功能，包括一致性，容错性和高性能。</li><li><a href="https://ignite.apache.org/index.html">Ignite</a> - 分布式内存网格数据库，具有可持久化，分布式事务，分布式计算等特点，此外还支持丰富的键值存储以及SQL语法。</li><li><a href="https://github.com/linkedin-sna/sna-page/tree/master/krati">LinkedIn Krati</a> - 一个简单的持久化数据存储，具有非常低的延迟和高吞吐量。</li><li><a href="http://www.project-voldemort.com/voldemort/">Linkedin Voldemort</a> - 分布式 key/value 存储系统。</li><li><a href="http://www.oracle.com/technetwork/database/database-technologies/nosqldb/overview/index.html">Oracle NoSQL Database</a> - Oracle 公司开发的分布式 key/value 存储系统。</li><li><a href="https://redis.io/">Redis</a> - 一个开源（BSD许可）的，内存中的数据结构存储系统，它可以用作数据库、缓存和消息中间件。</li><li><a href="https://github.com/basho/riak">Riak</a> - 去中心化的数据库存储。</li><li><a href="https://github.com/twitter/storehaus">Storehaus</a> - Twitter 开发的用于异步 key/value 存储的类库。</li><li><a href="https://github.com/tidwall/summitdb">SummitDB</a> - 基于内存的 NoSQL 键/值数据库，具有磁盘持久性，并支持 Raft 一致性算法。</li><li><a href="https://github.com/tarantool/tarantool">Tarantool</a> - 一个高效的 NoSQL 数据库和一个 Lua 应用服务器。</li><li><a href="https://github.com/pingcap/tikv">TiKV</a> - 一个基于 Rust 的分布式键值数据库，并受谷歌 Spanner 和 HBase 的启发。</li><li><a href="https://github.com/tidwall/tile38">Tile38</a> - 具有空间索引和实时地理围栏的地理位置数据库。支持各种对象类型，包括纬度/经度点，边界框，XYZ切片，Geohashes 和 GeoJSON。</li><li><a href="https://github.com/Treode/store">TreodeDB</a> - key-value 存储，支持数据副本、分片以及提供原子多行写。</li></ul><h1 id="图数据模型"><a href="#图数据模型" class="headerlink" title="图数据模型"></a>图数据模型</h1><ul><li><a href="http://www.agensgraph.com/">AgensGraph</a> - 基于 PostgreSQL 的新一代多模型图数据库。</li><li><a href="http://giraph.apache.org/">Apache Giraph</a> - 一个可伸缩的分布式迭代图处理系统，基于 Hadoop 平台，灵感来自 BSP (bulk synchronous parallel) 和 Google 的 Pregel。</li><li><a href="http://spark.apache.org/docs/0.7.3/bagel-programming-guide.html">Apache Spark Bagel</a> - Bagel 是谷歌 Pregel 图处理框架的 Spark 实现，支持基本的图形计算、组合器（combiners）和聚合器（aggregators）。目前已经被 GraphX 替代，在 Spark 2.0.0 版本已经被移除。</li><li><a href="https://www.arangodb.com/">ArangoDB</a> - 多模型分布式数据库。</li><li><a href="https://github.com/dgraph-io/dgraph">DGraph</a> - 一个可伸缩的、分布式的、低延迟的、高吞吐量的图数据库，旨在提供谷歌生产级别的规模和吞吐量，具有足够低的延迟，可以在 TB 级的结构化数据上为实时用户查询提供服务。</li><li><a href="https://github.com/krotik/eliasdb">EliasDB</a> - 一个轻量级的基于图的数据库，不需要任何第三方库。</li><li><a href="https://www.facebook.com/notes/facebook-engineering/tao-the-power-of-the-graph/10151525983993920">Facebook TAO</a> - TAO 是 Facebook 广泛使用的分布式数据存储，用于存储和服务社交图。</li><li><a href="https://github.com/gchq/Gaffer">GCHQ Gaffer</a> - Gaffer 是 GCHQ（英国政府通讯总部）于 2015 年 12 月 14 日在 GitHub 上公布的第一个开源项目，Gaffer 是个大规模图形数据库，可以方便存储大规模图的框架，节点和边界有数据统计，比如计数，直方图和草图。这些统计数据是时间窗口的节点和边界属性，可以根据时间动态更新。</li><li><a href="https://github.com/cayleygraph/cayley">Google Cayley</a> - 开源的图数据库。</li><li><a href="http://kowshik.github.io/JPregel/pregel_paper.pdf">Google Pregel</a> - 图处理框架。</li><li><a href="https://turi.com/products/create/docs/">GraphLab PowerGraph</a> - 包含 C++ 实现的 GraphLab API 以及一组基于GraphLab API 构建的高性能机器学习和数据挖掘工具包。</li><li><a href="https://amplab.cs.berkeley.edu/publication/graphx-grades/">GraphX</a> - 一个分布式图处理框架，它是基于 Spark 平台提供对图计算和图挖掘简洁易用的而丰富的接口，极大的方便了对分布式图处理的需求。</li><li><a href="https://github.com/tinkerpop/gremlin">Gremlin</a> - 图遍历语言。</li><li><a href="https://github.com/paulhoule/infovore">Infovore</a> - 一个 Map/Reduce 框架，用来处理大量的 RDF 数据集，注入 Freebase 和 DBpedia，基于 Hadoop 构建。</li><li><a href="https://01.org/graphbuilder/">Intel GraphBuilder</a> - 基于 Hadoop 构造的大型图工具。</li><li><a href="http://janusgraph.org">JanusGraph</a> - 开源分布式图形数据库，后端存储可以选择多种组件包括 Bigtable、HBase、Cassandra 等，同时索引后端也可以选择很多种，包括 Elasticsearch、Solr、Lucene 等。</li><li><a href="https://www.blazegraph.com/mapgraph-technology/">MapGraph</a> - 一个高级的 API 用于快速开发基于 GPU 的高性能图形分析应用。</li><li><a href="https://github.com/Microsoft/GraphEngine">Microsoft Graph Engine</a> - 一个基于内存的分布式大规模图数据处理引擎，能够帮助用户更方便地构建实时查询应用和高吞吐量离线分析平台。在此之前，它在学术界更广为人之的名称是 Trinity。</li><li><a href="https://neo4j.com/">Neo4j</a> - 一个高性能的 NOSQL图数据库，完全由 Java 实现。</li><li><a href="http://orientdb.com/">OrientDB</a> - 文档图形数据库。</li><li><a href="https://github.com/xslogic/phoebus">Phoebus</a> - 大型图处理框架。</li><li><a href="http://thinkaurelius.github.io/titan/">Titan</a> - 建立在 Cassandra 之上的分布式图数据库。</li><li><a href="https://github.com/twitter-archive/flockdb">Twitter FlockDB</a> - 分布式图数据库。</li><li><a href="https://nodexl.codeplex.com/">NodeXL</a> - Microsoft® Excel® 2007，2010，2013 和 2016 免费开源的模板，可以很容易的探索网络图。</li></ul><h1 id="列式数据库"><a href="#列式数据库" class="headerlink" title="列式数据库"></a>列式数据库</h1><p><strong>注意</strong>：请读一下 <a href="#Key-value-数据模型">Key-value 数据模型</a> 章节的说明。</p><ul><li><a href="http://the-paper-trail.org/blog/columnar-storage/">Columnar Storage</a> - 解释什么是列式存储，以及我们什么时候需要它。</li><li><a href="http://www.actian.com/">Actian Vector</a> - 面向列的分析数据库。</li><li><a href="http://db.lcs.mit.edu/projects/cstore/">C-Store</a> - 面向列的 DBMS。</li><li><a href="https://clickhouse.yandex/">ClickHouse</a> - 一个开源的列式数据库（DBMS），主要用于在线分析处理查询（OLAP）。</li><li><a href="http://eventql.io/">EventQL</a> - 为大规模事件收集和分析而构建的分布式、面向列的数据库。</li><li><a href="https://www.monetdb.org/">MonetDB</a> - 列式存储数据库。</li><li><a href="http://parquet.apache.org/">Parquet</a> - 灵感来自于2010年 Google 发表的 Dremel 论文，是一种列式存储格式，与语言、平台无关，并且不需要和任何一种数据处理框架绑定。</li><li><a href="https://pivotal.io/pivotal-greenplum">Pivotal Greenplum</a> - 为特定目的而构建的专用分析数据仓库，它提供了一个列式存储引擎和一个传统的基于行的引擎。</li><li><a href="https://www.vertica.com/">Vertica</a> - 设计用于管理大量快速增长的数据，提供非常快的查询性能。</li><li><a href="http://sqream.com/">SQream DB</a> - 以色列大数据公司开发的跑在 GPU 上的大数据数据库，设计用于分析和数据仓库，使用 ANSI-92 SQL，适用于10TB到1PB的数据集。</li><li><a href="https://cloud.google.com/bigquery/what-is-bigquery">Google BigQuery</a> - Google 推出的一项 Web 服务，该服务让开发者可以使用 Google 的架构来运行 SQL 语句对超级大的数据库进行操作。</li><li><a href="https://aws.amazon.com/redshift/">Amazon Redshift</a> - 一个支持 SQL 查询的、快速、可扩展的列式存储数据库，它支持 PB 级的数量查询，是适用于企业级的数据仓库。</li><li><a href="https://github.com/shunfei/indexr">IndexR</a> - 一个开源的大数据存储格式，于 2017 年 1 月初正式开源，旨在通过添加索引、优化编码方式、提高 IO 效率等各种优化方式来提高计算层和存储层的数据交换效率，从而提升整体性能。</li><li><a href="https://github.com/cswinter/LocustDB">LocustDB</a> - 一个大规模并行且高性能的分析数据库 (Analytics Database)，可快速处理你的所有数据，目前处于实验性阶段。</li></ul><h1 id="NewSQL-数据库"><a href="#NewSQL-数据库" class="headerlink" title="NewSQL 数据库"></a>NewSQL 数据库</h1><ul><li><a href="http://www.actian.com/products/operational-databases/">Actian Ingres</a> - 商业支持，开源 SQL 关系数据库管理系统。</li><li><a href="https://github.com/biokoda/actordb">ActorDB</a> - 分布式的 SQL 数据库，可实现可伸缩的 K/V 存储系统。ActorDB 基于 Actor 计算模型，与传统的集中式数据库不同，ActorDB 由任意数量的被成为 actor 的独立和并发 SQL 数据库组成。</li><li><a href="http://aws.amazon.com/redshift/">Amazon RedShift</a> - 基于 PostgreSQL 的数据仓库服务。</li><li><a href="https://github.com/probcomp/BayesDB">BayesDB</a> - 一个贝叶斯数据库，内建贝叶斯查询语言 BQL，用户无需统计方面知识即可解决一些基本的科学数据问题</li><li><a href="http://bedrockdb.com/">Bedrock</a> - 构建在 SQLite 之上的简单、模块化、网络化、分布式事务层。</li><li><a href="https://www.citusdata.com/">CitusDB</a> - 通过分片和副本扩展 PostgreSQL。</li><li><a href="https://github.com/cockroachdb/cockroach">Cockroach</a> - 可伸缩、地理复制、事务性数据存储。</li><li><a href="https://github.com/bloomberg/comdb2">Comdb2</a> - 一个基于乐观并发控制技术的集群 RDBMS。</li><li><a href="http://www.datomic.com/">Datomic</a> - 分布式数据库旨在支持可伸缩、灵活和智能的应用程序。</li><li><a href="https://foundationdb.com/">FoundationDB</a> - 分布式数据库，受 F1 启发。</li><li><a href="https://research.google.com/pubs/pub41344.html">Google F1</a> - 构建在 Spanner 之上的分布式 SQL 数据库。</li><li><a href="https://research.google.com/archive/spanner.html">Google Spanner</a> - Google的全球级的分布式数据库，具有可扩展，多版本，全球分布式、同步复制等特性。</li><li><a href="http://hstore.cs.brown.edu/">H-Store</a> - 一个实验性的数据库管理系统。它专为驻线交易处理应用程序（OLTP）而设计。</li><li><a href="https://github.com/VCNC/haeinsa">Haeinsa</a> - Haeinsa 是 HBase 可线性扩展的多行，多表事务库。使用两阶段锁定和乐观并发控制来实现事务。 事务的隔离级别是可序列化的。基于 Percolator 实现。</li><li><a href="https://www.percona.com/doc/percona-server/5.5/performance/handlersocket.html">HandlerSocket</a> - MySQL/MariaDB 的 NoSQL 插件。</li><li><a href="http://www.infinisql.org/">InfiniSQL</a> - 无限扩展的 RDBMS.</li><li><a href="https://github.com/rayokota/kareldb">KarelDB</a> - 由 Apache Kafka 支持的关系数据库。</li><li><a href="https://www.mapd.com/">Map-D</a> - GPU 内存数据库，大数据分析可视化平台。</li><li><a href="http://www.memsql.com/">MemSQL</a> - 一款内存数据库，它通过将数据存在内存中，将 SQL 语句预编译为 C++ 而获得极速执行效率。</li><li><a href="http://www.nuodb.com/">NuoDB</a> - 符合 SQL/ACID 的分布式数据库。</li><li><a href="http://www.oracle.com/technetwork/database/database-technologies/timesten/overview/index.html">Oracle TimesTen in-Memory Database</a> - 基于内存的关系数据库管理系统，具有持久性和可恢复性。</li><li><a href="http://gemfirexd.docs.pivotal.io/latest/">Pivotal GemFire XD</a> - 低延迟、基于内存、分布式 SQL 数据存储。为内存表数据提供 SQL 接口，可在 HDFS 中持久存储。</li><li><a href="https://hana.sap.com/abouthana.html">SAP HANA</a> - 基于内存、面向列、关系数据库管理系统。</li><li><a href="http://senseidb.github.io/sensei/">SenseiDB</a> - 分布式、实时、半结构化的数据库。</li><li><a href="http://skydb.io/">Sky</a> - 用于灵活、高性能的行为数据分析的数据库。</li><li><a href="http://www.symmetricds.org/">SymmetricDS</a> - 用于文件和数据库同步的开源软件。</li><li><a href="https://github.com/pingcap/tidb">TiDB</a> - 一款定位于在线事务处理/在线分析处理的融合型数据库产品，实现了一键水平伸缩，强一致性的多副本数据安全，分布式事务，实时 OLAP 等重要特性。受 Google F1 启发。</li><li><a href="https://www.voltdb.com/">VoltDB</a> - 声称是最快的内存数据库。</li><li><a href="https://github.com/YugaByte/yugabyte-db">yugabyteDB</a> - 与 PostgreSQL 兼容的开源，高性能，分布式SQL数据库。</li></ul><h1 id="时间序列数据库"><a href="#时间序列数据库" class="headerlink" title="时间序列数据库"></a>时间序列数据库</h1><ul><li><a href="http://axibase.com/products/axibase-time-series-database/">Axibase Time Series Database</a> - 基于 HBase 的时间序列数据库，内置可视化、规则引擎和 SQL 支持。</li><li><a href="http://chronix.io/">Chronix</a> - 一种时间序列存储器，用于存储高度压缩的时间序列，并支持快速访问数据。</li><li><a href="http://square.github.io/cube/">Cube</a> - 使用 MongoDB 来存储时间序列数据。</li><li><a href="https://spotify.github.io/heroic/#!/index">Heroic</a> - 基于 Cassandra 和 Elasticsearch 的可扩展时间序列数据库。</li><li><a href="https://www.influxdata.com/">InfluxDB</a> - 分布式时间序列数据库。</li><li><a href="https://www.circonus.com/irondb/">IronDB</a> - 可扩展、通用时间序列数据库。</li><li><a href="https://github.com/kairosdb/kairosdb">Kairosdb</a> - 和 OpenTSDB 类似，但是构建在 Cassandra 之上。</li><li><a href="http://m3db.github.io/m3/m3db/">M3DB</a> - 一个分布式时间序列数据库，可用于长期存储实时指标。</li><li><a href="https://opennms.github.io/newts/">Newts</a> - 基于 Apache Cassandra 的时间序列数据库。</li><li><a href="https://github.com/taosdata/TDengine/">TDengine</a> - 使用 IoT 的独特功能的 C 语言中的时间序列数据库，以提高读 / 写吞吐量并减少存储数据所需的空间。</li><li><a href="http://opentsdb.net">OpenTSDB</a> - 构建在 HBase 之上的分布式时间序列数据库。</li><li><a href="https://prometheus.io/">Prometheus</a> - 时间序列数据库和服务监控系统。</li><li><a href="https://github.com/facebookincubator/beringei">Beringei</a> - Facebook 的内存时间序列数据库。</li><li><a href="http://traildb.io/">TrailDB</a> - 用于存储和查询一系列事件的有效工具。</li><li><a href="https://github.com/druid-io/druid/">Druid</a> - MetaMarket 公司研发，专为海量数据集上的做高性能 OLAP (OnLine Analysis Processing)而设计的数据存储和分析系统</li><li><a href="http://basho.com/products/riak-ts/">Riak-TS</a> - 唯一专为物联网和时间序列数据优化的企业级 NoSQL 时间序列数据库。</li><li><a href="https://github.com/akumuli/Akumuli">Akumuli</a> - 一个数值型时间序列数据库，可以存储、处理时序列数据。</li><li><a href="https://github.com/Pardot/Rhombus">Rhombus</a> - ACassandra 的时间序列对象存储。</li><li><a href="https://github.com/dalmatinerdb/dalmatinerdb">Dalmatiner DB</a> - 快速分布式度量数据库</li><li><a href="https://github.com/rackerlabs/blueflood">Blueflood</a> - 一种用于摄取和处理时间序列数据的分布式系统。</li><li><a href="https://github.com/NationalSecurityAgency/timely">Timely</a> - 一个时间序列数据库应用程序，它提供了基于 Accumulo 和 Grafana 的对时间序列数据的安全访问。</li><li><a href="https://github.com/transceptor-technology/siridb-server">SiriDB</a> - 具有集群功能的高扩展性、健壮性和快速的开源时间序列数据库。</li><li><a href="https://github.com/improbable-eng/thanos">Thanos</a> - 一组组件，可以使用多个 Prometheus 部署创建具有无限存储容量的高可用度量系统。</li><li><a href="https://github.com/VictoriaMetrics/VictoriaMetrics">VictoriaMetrics</a> - 与 Prometheus 兼容的快速，可扩展的开源 TSDB，包括单节点和群集版本。</li></ul><h1 id="类-SQL-处理系统"><a href="#类-SQL-处理系统" class="headerlink" title="类 SQL 处理系统"></a>类 SQL 处理系统</h1><ul><li><a href="http://www.actian.com/analytic-database/vectorh-sql-hadoop">Actian SQL for Hadoop</a> - 高性能交互式 SQL，可以利用它访问 Hadoop 上的数据。</li><li><a href="http://drill.apache.org/">Apache Drill</a> - 一个低延迟的分布式海量数据交互式查询引擎，使用 ANSI SQL 兼容语法，本质上是一个分布式的 MPP 查询层。目的在于支持更广泛的数据源，数据格式，以及查询语言。受 Google的Dremel 启发。</li><li><a href="https://cwiki.apache.org/confluence/display/Hive/HCatalog">Apache HCatalog</a> - Hadoop 的表存储管理工具。</li><li><a href="http://hive.apache.org/">Apache Hive</a> - 基于 Hadoop 的一个数据仓库工具，可以将结构化数据文件映射为一张数据库表，并提供类 SQL 查询功能。</li><li><a href="http://calcite.apache.org/">Apache Calcite</a> - 一款开源 SQL 解析工具，可以将各种 SQL 语句解析成抽象语法术AST(Abstract Syntax Tree)，之后通过操作 AST 就可以把 SQL 中所要表达的算法与关系体现在具体代码之中。</li><li><a href="http://phoenix.apache.org/index.html">Apache Phoenix</a> - 构建在 HBase 之上的关系型数据库层，可以对 HBase 中的数据进行低延迟访问。</li><li><a href="http://www.teradata.com/products-and-services/Teradata-Aster/teradata-aster-database">Aster Database</a> - 类 SQL 分析处理。</li><li><a href="https://www.cloudera.com/products/apache-hadoop/impala.html">Cloudera Impala</a> - 实时交互 SQL 大数据查询工具，受 Dremel 启发。</li><li><a href="http://www.cascading.org/projects/lingual/">Concurrent Lingual</a> - Cascading 上的 SQL 查询语言。</li><li><a href="http://www.datasalt.com/products/splout-sql/">Datasalt Splout SQL</a> - 针对大数据集的完整 SQL 查询引擎。</li><li><a href="https://www.dremio.com/">Dremio</a> - 一个基于Apache Arrow的开源，类似SQL的数据服务平台。</li><li><a href="https://prestodb.io/">Facebook PrestoDB</a> - 分布式 SQL 查询引擎。</li><li><a href="https://research.google.com/pubs/pub36632.html">Google BigQuery</a> - Google 推出的一项 Web 服务，该服务让开发者可以使用 Google 的架构来运行 SQL 语句对超级大的数据库进行操作，是 Dremel 的实现。</li><li><a href="https://www.pipelinedb.com/">PipelineDB</a> - 一个开源的关系数据库，它可以在实时流数据上执行 SQL 查询，并将结果增量地存储在表中。</li><li><a href="https://pivotal.io/pivotal-hdb">Pivotal HDB</a> - Hadoop 上的类 SQL 数据仓库系统。</li><li><a href="http://rainstor.com/products/rainstor-database/">RainstorDB</a> - 用于存储 PB 级结构化和半结构化数据量的数据库。</li><li><a href="https://github.com/apache/spark/tree/master/sql">Spark Catalyst</a> - Apache Spark 的查询优化框架。</li><li><a href="https://databricks.com/blog/2014/03/26/spark-sql-manipulating-structured-data-using-spark-2.html">SparkSQL</a> - 使用 Spark 操作结构化的数据。</li><li><a href="https://www.splicemachine.com/">Splice Machine</a> - 兼具了 SQL 和 NoSQL 的各自优势，且能对操作型和分析型应用进行实时处理，具有 ACID 特性。</li><li><a href="https://hortonworks.com/innovation/stinger/">Stinger</a> - 由 Hortonworks 开发的一个彻底提升 Hive 效率的工具。</li><li><a href="http://tajo.apache.org/">Tajo</a> - Hadoop 之上的分布式数据仓库系统。</li><li><a href="https://wiki.trafodion.org/wiki/index.php/Main_Page">Trafodion</a> - 由惠普开发并开源的基于 Hadoop 平台的事务数据库引擎。提供了一个基于 Hadoop 平台的交易型 SQL 引擎，是一个擅长处理交易型负载的 Hadoop 大数据解决方案。</li></ul><h1 id="数据采集"><a href="#数据采集" class="headerlink" title="数据采集"></a>数据采集</h1><ul><li><a href="https://aws.amazon.com/kinesis/">Amazon Kinesis</a> - 一种在 AWS 上流式处理数据的平台，让您可以轻松地加载和分析流数据，同时还可让您根据具体需求来构建自定义流数据应用程序。</li><li><a href="https://aws.amazon.com/glue/">Amazon Web Services Glue</a> -  一项完全托管的提取、转换和加载（ETL）服务，让用户能够轻松准备和加载数据进行分析。</li><li><a href="http://chukwa.apache.org/">Apache Chukwa</a> - 数据采集系统。</li><li><a href="http://flume.apache.org/">Apache Flume</a> - 一个分布式的、可靠的、易用的系统，可以有效地将来自很多不同源系统的大量日志数据收集、汇总或者转移到一个数据中心存储。</li><li><a href="http://kafka.apache.org/">Apache Kafka</a> - 分布式发布订阅消息系统。</li><li><a href="https://nifi.apache.org/">Apache NiFi</a> - 一个易用、强大、可靠的数据处理与分发系统</li><li><a href="http://sqoop.apache.org/">Apache Sqoop</a> - 一款开源的工具，主要用于在 Hadoop/Hive 与传统的数据库（MySQL、Oracle...）间进行数据的传递</li><li><a href="http://www.embulk.org">Embulk</a> - 开源的批量数据加载器，帮助在各种数据库、存储、文件格式和云服务之间传输数据。</li><li><a href="https://github.com/facebookarchive/scribe">Facebook Scribe</a> - 流日志数据聚合器。</li><li><a href="http://www.fluentd.org">Fluentd</a> - 用于收集事件和日志的工具。</li><li><a href="https://research.google.com/pubs/pub41318.html">Google Photon</a> - 地理分布式系统，用于实时连接多个连续流动的数据流，具有高可伸缩性和低延迟。</li><li><a href="https://github.com/mozilla-services/heka">Heka</a> - 开源流处理系统。</li><li><a href="https://github.com/sonalgoyal/hiho">HIHO</a> - 用于将不同数据源的数据和 Hadoop 进行连接的框架。</li><li><a href="https://github.com/papertrail/kestrel">Kestrel</a> - 分布式消息队列系统。</li><li><a href="https://engineering.linkedin.com/data">LinkedIn Databus</a> - LinkedIn 开源的一个低延迟、可靠的、支持事务的、保持一致性的数据变更抓取系统。</li><li><a href="https://github.com/linkedin/kamikaze">LinkedIn Kamikaze</a> - 一种实用工具包，对 document lists 提供一系列的实现。</li><li><a href="https://github.com/linkedin/white-elephant">LinkedIn White Elephant</a> - 一个 Hadoop 日志收集器和展示器，它提供了用户角度的 Hadoop 集群可视化。</li><li><a href="https://www.elastic.co/products/logstash">Logstash</a> - 一个开源的日志收集管理工具，可以采集来自不同数据源的数据，并对数据进行处理后输出到多种输出源。</li><li><a href="https://github.com/Netflix/suro">Netflix Suro</a> - Netflix 开源的一款工具，它能够在数据被发送到不同的数据平台（如 Hadoop、Elasticsearch）之前，收集不同应用服务器上的事件数据。</li><li><a href="https://github.com/pinterest/secor">Pinterest Secor</a> - 实现 Kafka 日志持久性的服务</li><li><a href="https://github.com/linkedin/gobblin">Linkedin Gobblin</a> - 一套分布式数据集成框架，旨在简化大数据集成工作当中的各类常见任务，具体包括数据流与批量生态系统的提取、复制、组织与生命周期管理。</li><li><a href="https://github.com/skizzehq/skizze">Skizze</a> - 一种概率数据结构服务和存储。</li><li><a href="https://github.com/streamsets/datacollector">StreamSets Data Collector</a> - 使用一个简单的 IDE 来连续大数据摄取基础设施。</li><li><a href="https://github.com/apache/incubator-pulsar">Yahoo Pulsar</a> - 由 Yahoo 开发并开源的一个企业级的发布订阅消息系统。</li><li><a href="https://www.alooma.com/integrations/mysql">Alooma</a> - 实时的数据管道服务，支持将 MySQL 等数据源的数据移动到数据仓库中。</li></ul><h1 id="服务编程"><a href="#服务编程" class="headerlink" title="服务编程"></a>服务编程</h1><ul><li><a href="http://akka.io/">Akka Toolkit</a> - 基于 Actor 模型，提供了一个用于构建可扩展的（Scalable）、弹性的（Resilient）、快速响应的（Responsive）应用程序的平台。</li><li><a href="http://avro.apache.org/">Apache Avro</a> - 数据序列化系统。</li><li><a href="http://curator.apache.org/">Apache Curator</a> - 为 Apache ZooKeeper 开发的类库。</li><li><a href="http://karaf.apache.org/">Apache Karaf</a> - Apache 旗下的一个开源项目，同时也是一个基于 OSGi 的运行环境，Karaf 提供了一个轻量级的 OSGi 容器，可以用于部署各种组件，应用程序。</li><li><a href="http://thrift.apache.org//">Apache Thrift</a> - Facebook 开源的跨语言的 RPC 通信框架。</li><li><a href="http://zookeeper.apache.org/">Apache Zookeeper</a> - 一个分布式应用程序协调服务。</li><li><a href="https://research.google.com/archive/chubby.html">Google Chubby</a> - 一个分布式锁服务，Chubby 底层一致性实现就是以 Paxos 为基础的</li><li><a href="https://github.com/Hydrospheredata/mist">Hydrosphere Mist</a> - 一个将 Apache Spark 分析任务和机器学习模型转换为实时、批处理或反应性 web 服务的服务。</li><li><a href="https://engineering.linkedin.com/data">Linkedin Norbert</a> - 集群管理系统。</li><li><a href="https://github.com/mara/data-integration">Mara</a> - 一个轻量级的自定义ETL框架。</li><li><a href="https://www.open-mpi.org/">OpenMPI</a> - 消息传递框架。</li><li><a href="https://www.serf.io/">Serf</a> - 去中心化的服务发现和编排解决方案。</li><li><a href="https://github.com/spotify/luigi">Spotify Luigi</a> - 用于构建批处理作业的复杂管道的 Python 包。它处理依赖项解析、工作流管理、可视化、处理故障、命令行集成等等。</li><li><a href="https://github.com/spring-projects/spring-xd">Spring XD</a> - 用于数据摄取、实时分析、批处理和数据导出的分布式和可扩展系统。</li><li><a href="https://github.com/twitter/elephant-bird">Twitter Elephant Bird</a> - 用于处理 LZOP 压缩数据的库。</li><li><a href="https://twitter.github.io/finagle/">Twitter Finagle</a> - JVM的异步网络堆栈。</li></ul><h1 id="调度"><a href="#调度" class="headerlink" title="调度"></a>调度</h1><ul><li><a href="https://github.com/apache/incubator-airflow">Apache Airflow</a> - Airbnb 开源的一个用 Python 编写的工作流管理平台。</li><li><a href="http://aurora.apache.org/">Apache Aurora</a> - 长期运行服务和计划作业的 Mesos 框架。</li><li><a href="http://falcon.apache.org/">Apache Falcon</a> - 数据管理框架。</li><li><a href="http://oozie.apache.org/">Apache Oozie</a> - 工作流作业调度器。</li><li><a href="https://docs.microsoft.com/en-us/azure/data-factory/data-factory-introduction">Azure Data Factory</a> - 可大规模简化 ETL 的混合数据集成服务</li><li><a href="http://mesos.github.io/chronos/">Chronos</a> - 分布式和容错调度器。</li><li><a href="https://azkaban.github.io/">Linkedin Azkaban</a> - 批处理工作流作业调度程序。</li><li><a href="https://github.com/ottogroup/schedoscope">Schedoscope</a> - 用于 Hadoop 作业的敏捷调度 Scala DSL。</li><li><a href="https://github.com/radlab/sparrow">Sparrow</a> - 调度平台。</li></ul><h1 id="机器学习"><a href="#机器学习" class="headerlink" title="机器学习"></a>机器学习</h1><ul><li><a href="https://studio.azureml.net/">Azure ML Studio</a> - 基于云的 R、Python 机器学习平台。</li><li><a href="https://github.com/harthur/brain">brain</a> - JavaScript 中的神经网络。</li><li><a href="https://github.com/OryxProject/oryx">Oryx</a> - 实时大规模机器学习。</li><li><a href="http://www.cascading.org/projects/pattern/">Concurrent Pattern</a> - Cascading 上的机器学习框架。</li><li><a href="https://github.com/karpathy/convnetjs">convnetjs</a> - Javascript 中的深入学习，可以在浏览器中训练卷积神经网络（或普通神经网络）。</li><li><a href="https://github.com/deeplearning4j/DataVec">DataVec</a> - 一个用于 Java 和 Scala 深度学习的矢量化和数据预处理库。Deeplearning4j生态系统的一部分。</li><li><a href="https://github.com/deeplearning4j">Deeplearning4j</a> - 美国 AI 创业公司 Skymind 开源并维护的一个基于 Java/JVM 的深度学习框架，可使用 CPU 或 GPU 运行。</li><li><a href="https://github.com/danielsdeleo/Decider">Decider</a> - Ruby中灵活且可扩展的机器学习。</li><li><a href="http://www.heatonresearch.com/encog/">ENCOG</a> - 支持多种高级算法的机器学习框架，以及支持规范化和处理数据的类。</li><li><a href="http://www.etcml.com/">etcML</a> - 在线免费文本分析工具是由美国的斯坦福大学计算机教授开发的基于成熟的文本分析引擎</li><li><a href="https://github.com/etsy/Conjecture">Etsy Conjecture</a> - Scalding 中可扩展的机器学习。</li><li><a href="https://github.com/gojek/feast">Feast</a> - 用于管理、发现和访问机器学习特性的特性存储库。Feast 为模型训练和模型服务提供了一致的特征数据视图。</li><li><a href="https://dato.com/products/create/">GraphLab Create</a> - Python 中的机器学习平台，包含大量 ML 工具包、数据工程和部署工具。</li><li><a href="https://github.com/h2oai/h2o-3/">H2O</a> - 使用 Hadoop、R 和 Python 进行统计、机器学习和数学运行时。</li><li><a href="https://github.com/benedekrozemberczki/karateclub">Karate Club</a> - 用于图形结构化数据的 Python 无监督机器学习库。</li><li><a href="https://github.com/fchollet/keras">Keras</a> - 一个高层神经网络 API，Keras 由纯 Python 编写而成并基 Tensorflow、Theano 以及 CNTK 后端。受 Torch 启发。</li><li><a href="https://github.com/johnsonc/lambdo">Lambdo</a> - 是一个工作流引擎，通过将一个分析管道、特征工程和机器学习、模型训练和预测结合起来，通过用户定义（Python）函数实现表填充和列评估，大大简化了数据处理和分析。</li><li><a href="http://mahout.apache.org/">Mahout</a> - 是 Apache Software Foundation（ASF）旗下的一个开源项目，提供一些可扩展的机器学习领域经典算法的实现，旨在帮助开发人员更加方便快捷地创建智能应用程序。</li><li><a href="http://www.mlbase.org/">MLbase</a> - 是Spark生态圈的一部分，专注于机器学习，包含三个组件：MLlib、MLI、ML Optimizer。</li><li><a href="https://github.com/nikolaypavlov/MLPNeuralNet">MLPNeuralNet</a> - 一个针对 iOS 和 Mac OS 系统的快速多层感知神经网络库，可通过已训练的神经网络预测新实例。</li><li><a href="https://github.com/ml-tooling/ml-workspace">ML Workspace</a> - 基于 Web 的多合一 IDE，专门用于机器学习和数据科学。</li><li><a href="http://moa.cms.waikato.ac.nz">MOA</a> - 实时进行大数据流挖掘和大规模机器学习。</li><li><a href="https://monkeylearn.com/">MonkeyLearn</a> - 让文本挖掘变得很容易，可以从文本中提取和分类数据。</li><li><a href="https://github.com/deeplearning4j/nd4j">ND4J</a> - JVM 的矩阵库，可以认为是 Java 中的 Numpy。</li><li><a href="https://github.com/numenta/nupic">nupic</a> - 一个实现了HTM学习算法的机器智能平台。</li><li><a href="http://predictionio.incubator.apache.org/index.html">PredictionIO</a> - 面向开发人员和数据科学家的开源机器学习服务，构建在 Hadoop，Mahout 和 Cascading 之上。</li><li><a href="https://github.com/deeplearning4j/rl4j">RL4J</a> - 一个与 Deeplearning4j 集成的强化学习框架。</li><li><a href="http://samoa.incubator.apache.org/">SAMOA</a> - 分布式流数据机器学习框架。</li><li><a href="https://github.com/scikit-learn/scikit-learn">scikit-learn</a> - 专门面向机器学习的 Python 开源框架，实现了各种成熟的算法。</li><li><a href="http://spark.apache.org/docs/0.9.0/mllib-guide.html">Spark MLlib</a> - 使用 Spark 实现一些常见的机器学习算法和实用程序，包括分类、回归、聚类、协同过滤、降维以及底层优化。</li><li><a href="https://users.soe.ucsc.edu/~niejiazhong/slides/chandra.pdf">Sibyl</a> - 谷歌大型机器学习系统。</li><li><a href="https://github.com/tensorflow/tensorflow">TensorFlow</a> - 一个采用数据流图（data flow graphs），用于数值计算的开源软件库。</li><li><a href="https://github.com/theano">Theano</a> - 蒙特利尔大学支持的以 Python 为核心的机器学习类库。</li><li><a href="https://github.com/torch">Torch</a> - 一个基于 BSD License 的开源的机器学习的框架。</li><li><a href="https://github.com/amplab/velox-modelserver">Velox</a> - 服务于机器学习预测的系统。</li><li><a href="https://github.com/JohnLangford/vowpal_wabbit/wiki">Vowpal Wabbit</a> - 由微软和雅虎赞助的学习系统。</li><li><a href="http://www.cs.waikato.ac.nz/ml/weka/">WEKA</a> - 一套机器学习软件。</li><li><a href="https://github.com/BIDData/BIDMach">BidMach</a> - CPU 和 GPU 加速库的机器学习库。</li></ul><h1 id="基准"><a href="#基准" class="headerlink" title="基准"></a>基准</h1><ul><li><a href="https://issues.apache.org/jira/browse/MAPREDUCE-3561">Apache Hadoop Benchmarking</a> - 测试 Hadoop 性能的微基准测试。</li><li><a href="https://github.com/SWIMProjectUCB/SWIM/wiki">Berkeley SWIM Benchmark</a> - 真实大数据工作负载基准。</li><li><a href="https://github.com/intel-hadoop/HiBench">Intel HiBench</a> - Hadoop 基准套件。</li><li><a href="https://issues.apache.org/jira/browse/MAPREDUCE-5116">PUMA Benchmarking</a> - MapReduce 应用程序的基准测试套件。</li><li><a href="http://yahoohadoop.tumblr.com/post/98294079296/gridmix3-emulating-production-workload-for">Yahoo Gridmix3</a> - 来自 Yahoo 工程师团队的 Hadoop 集群基准测试。</li><li><a href="https://github.com/deeplearning4j/dl4j-benchmark">Deeplearning4j Benchmarks</a> - 对流行的模型和配置进行基准测试，并输出性能和版本统计信息。</li></ul><h1 id="安全"><a href="#安全" class="headerlink" title="安全"></a>安全</h1><ul><li><a href="http://ranger.apache.org/">Apache Ranger</a> - 一个用在 Hadoop 平台上并提供操作、监控、管理综合数据安全的框架。</li><li><a href="http://eagle.apache.org/">Apache Eagle</a> - 由 eBay 公司开源的一个识别大数据平台上的安全和性能问题的开源解决方案。</li><li><a href="http://knox.apache.org/">Apache Knox Gateway</a> - Hadoop 集群中用于数据处理的 REST API 网关。</li><li><a href="http://incubator.apache.org/projects/sentry.html">Apache Sentry</a> - 为 Hadoop 集群中的元数据和数据存储提供集中、细粒度的访问控制。</li><li><a href="https://github.com/kotobukki/BDA/">BDA</a> - Hadoop 和 Spark 的漏洞检测器。</li></ul><h1 id="系统部署"><a href="#系统部署" class="headerlink" title="系统部署"></a>系统部署</h1><ul><li><a href="http://ambari.apache.org/">Apache Ambari</a> - 一个集中部署、管理、监控Hadoop 分布式集群的工具。</li><li><a href="http://bigtop.apache.org//">Apache Bigtop</a> - 一个针对基础设施工程师和数据科学家的开源项目，旨在全面打包、测试和配置领先的开源大数据组件 / 项目，包括但不限于 Hadoop、HBase 和 Spark 。</li><li><a href="http://helix.apache.org/">Apache Helix</a> - 集群管理框架。</li><li><a href="http://mesos.apache.org/">Apache Mesos</a> - 一个类似于 YARN 的集群管理器，提供了有效的、跨分布式应用或框架的资源隔离和共享，可以运行 Hadoop、MPI、Hypertable、Spark。</li><li><a href="https://github.com/apache/incubator-slider">Apache Slider</a> - 是一个 YARN 应用程序，用于在 YARN 上部署现有的分布式应用程序。</li><li><a href="http://whirr.apache.org/">Apache Whirr</a> - 运行云服务的一组 Java 类库。</li><li><a href="https://hortonworks.com/hadoop/yarn/">Apache YARN</a> - 集群管理系统。</li><li><a href="http://brooklyncentral.github.io/">Brooklyn</a> - 简化应用程序部署和管理的库。</li><li><a href="http://buildoop.github.io/">Buildoop</a> - 类似于 Apache BigTop，基于 Groovy 语言开发。</li><li><a href="http://gethue.com/">Cloudera HUE</a> - 用于与 Hadoop 交互的 Web 应用程序。</li><li><a href="http://www.wired.com/2012/08/facebook-prism/">Facebook Prism</a> - 多数据中心复制系统。</li><li><a href="https://www.wired.com/2013/03/google-borg-twitter-mesos/all/">Google Borg</a> - Google 的内部大型集群管理系统。</li><li><a href="https://www.youtube.com/watch?v=0ZFMlO98Jkc">Google Omega</a> - Google 内部第三代的集群管理框架。</li><li><a href="https://hortonworks.com/blog/introducing-hoya-hbase-on-yarn/">Hortonworks HOYA</a> - 可以在 YARN 上部署 HBase 集群的应用程序。</li><li><a href="https://kubernetes.io/">Kubernetes</a> - Google 团队发起并维护的基于 Docker 的开源容器集群管理系统。</li><li><a href="https://github.com/mesosphere/marathon">Marathon</a> - 一个 Mesos 框架，能够支持运行长服务。</li></ul><h1 id="应用程序"><a href="#应用程序" class="headerlink" title="应用程序"></a>应用程序</h1><ul><li><a href="https://github.com/etsy/411">411</a> - 一个 Web 应用程序，用于通过计划搜索 Elasticsearch 而产生的警报管理。</li><li><a href="https://github.com/adobe-research/spindle">Adobe spindle</a> - 使用 Scala、Spark 和 Parquet 进行 web 分析的下一代系统。</li><li><a href="http://metron.apache.org/">Apache Metron</a> - 一个集成了各种开源大数据技术的平台，以提供用于安全监视和分析的集中式工具。</li><li><a href="http://nutch.apache.org/">Apache Nutch</a> - 开源 web 爬虫程序</li><li><a href="http://oodt.apache.org/">Apache OODT</a> - NASA 开源的用于做数据管理的系统。</li><li><a href="https://tika.apache.org/">Apache Tika</a> - 使用 Java 编写的内容检测和分析框架。</li><li><a href="https://github.com/salesforce/Argus">Argus</a> - 时序监控报警平台。</li><li><a href="https://github.com/uber/AthenaX">AthenaX</a> - 一个流分析平台，允许用户使用结构化查询语言（SQL）运行生产质量的大规模流分析。</li><li><a href="https://github.com/Netflix/atlas">Atlas</a> - 用于管理维度时间序列数据的系统。</li><li><a href="https://count.ly/">Countly</a> - 基于 Node.js 和 MongoDB 的开源移动和 web 分析平台。</li><li><a href="https://www.dominodatalab.com/">Domino</a> - 运行、扩展、共享和部署模型，不需要任何基础设施。</li><li><a href="http://www.eclipse.org/birt/">Eclipse BIRT</a> - 基于 Elasticsearch 的报告系统。</li><li><a href="https://github.com/Yelp/elastalert">ElastAert</a> - 为 ES 打造的报警监控工具。</li><li><a href="https://github.com/Codecademy/EventHub">Eventhub</a> - 开源事件分析平台。</li><li><a href="https://github.com/allegro/hermes">Hermes</a> - 构建在 Kafka 之上的异步消息代理。</li><li><a href="http://hipi.cs.virginia.edu/">HIPI Library</a> - 使用 Hadoop 的 MapReduce 来执行图像处理任务的 API。</li><li><a href="https://www.splunk.com/en_us/download/hunk.html">Hunk</a> - Hadoop 的分析工具。</li><li><a href="http://opensource.indeedeng.io/imhotep/">Imhotep</a> - 大型分析平台。</li><li><a href="https://www.indicative.com/">Indicative</a> - Web 和移动分析工具，具有数据仓库（AWS，BigQuery）集成。</li><li><a href="https://jupyter.org/">Jupyter</a> - 基于网页的用于交互计算的应用程序。其可被应用于全过程计算：开发、文档编写、运行代码和展示结果。</li><li><a href="http://madlib.incubator.apache.org/community/">MADlib</a> - RDBMS 的数据处理库，用于分析数据。</li><li><a href="https://github.com/influxdata/kapacitor">Kapacitor</a> - 用于对时间序列数据进行处理、监视和警报的开源框架。</li><li><a href="http://kylin.apache.org/">Kylin</a> - 一个开源的分布式分析引擎，提供 Hadoop/Spark 之上的 SQL 查询接口及多维分析（OLAP）能力以支持超大规模数据，最初由 eBay Inc. 开发并贡献至开源社区，能在亚秒内查询巨大的 Hive 表。</li><li><a href="https://github.com/pivotalsoftware/PivotalR">PivotalR</a> - 支持在 Pivotal HD/HAWQ 以及 PostgreSQL 上运行 R。</li><li><a href="https://github.com/rakam-io/rakam">Rakam</a> - 开源实时自定义分析平台，由 PostgreSQL，Kinesis 和 PrestoDB 提供支持。</li><li><a href="https://www.qubole.com/">Qubole</a> - 能够自动扩展 Hadoop 集群以及内置的链接器。</li><li><a href="https://sense.io/">Sense</a> - 数据科学和大数据分析的云平台。</li><li><a href="https://github.com/SnappyDataInc/snappydata">SnappyData</a> - 一个统一 OLTP + OLAP + 流式写入 的内存分布式数据库。</li><li><a href="https://github.com/snowplow/snowplow">Snowplow</a> - 由 Hadoop，Kinesis，Redshift 和 Postgres 支持的企业级 Web 和事件分析。</li><li><a href="http://amplab-extras.github.io/SparkR-pkg/">SparkR</a> - 用于 Spark 的 R 前端。</li><li><a href="https://www.splunk.com/">Splunk</a> - 一款成熟的商业化日志处理分析产品。</li><li><a href="https://www.sumologic.com/">Sumo Logic</a> - 基于云的日志处理分析产品。</li><li><a href="http://www.talend.com/products/big-data/">Talend</a> - YARN、Hadoop、HBASE、Hive、HCatalog 和 Pig 的统一开源环境。</li><li><a href="https://warp.one//">Warp</a> - 大数据示例查询工具（OS X 应用）。</li></ul><h1 id="搜索引擎和框架"><a href="#搜索引擎和框架" class="headerlink" title="搜索引擎和框架"></a>搜索引擎和框架</h1><ul><li><a href="http://lucene.apache.org/">Apache Lucene</a> - 一套用于全文检索和搜索的开放源码程序库。</li><li><a href="http://lucene.apache.org/solr/">Apache Solr</a> - 是 Apache Lucene 项目的开源企业搜索平台。其主要功能包括全文检索、命中标示、分面搜索、动态聚类、数据库集成，以及富文本（如Word、PDF）的处理。</li><li><a href="https://github.com/strapdata/elassandra">Elassandra</a> - 是 ElasticSearch 的一个分支，经过修改，可以作为 Apache Cassandra 的插件运行，具有可扩展和灵活的点对点架构。</li><li><a href="https://www.elastic.co/">ElasticSearch</a> - 一个基于 Lucene 库的搜索引擎。它提供了一个分布式、支持多租户的全文搜索引擎，具有 HTTP Web 接口和无模式 JSON 文档。</li><li><a href="https://www.enigma.com/">Enigma.io</a> – 免费增值的 Web 应用程序，用于对 Web 上抓取的海量数据集进行浏览，过滤，分析，搜索和导出。</li><li><a href="https://www.facebook.com/publications/219621248185635/">Facebook Unicorn</a> - 社交图搜索平台。</li><li><a href="https://googleblog.blogspot.it/2010/06/our-new-search-index-caffeine.html">Google Caffeine</a> - 一个高性能、出色的缓存类库</li><li><a href="https://research.google.com/pubs/pub36726.html">Google Percolator</a> - 由 Google 公司开发的、为大数据集群进行增量处理更新的系统，主要用于 google 网页搜索索引服务。</li><li><a href="https://blogs.apache.org/hbase/entry/coprocessor_introduction">HBase Coprocessor</a> - HBase 的协处理器，Percolator 的实现。</li><li><a href="http://ngdata.github.io/hbase-indexer/">Lily HBase Indexer</a> - 一款快速、简单的 HBase 的内容检索方案，它可以帮助你在 Solr 中建立 HBase 的数据索引，从而通过 Solr 进行数据检索。</li><li><a href="http://senseidb.github.io/bobo/">LinkedIn Bobo</a> - 完全用 Java 编写的 Faceted Search 实现，是 Apache Lucene 的扩展。</li><li><a href="https://github.com/linkedin/cleo">LinkedIn Cleo</a> - 一个灵活的软件库，用于处理一些预输入和自动完成的搜索功能。</li><li><a href="https://engineering.linkedin.com/search/did-you-mean-galene">LinkedIn Galene</a> - LinkedIn 的搜索架构。</li><li><a href="https://github.com/senseidb/zoie">LinkedIn Zoie</a> - 一个用 Java 编写的实时搜索/索引系统。</li><li><a href="http://mg4j.di.unimi.it/">MG4J</a> - MG4J（Managing Gigabytes for Java）是一个用 Java 编写的大型文档集合的全文搜索引擎，它是高度可定制的，高性能的，并提供了最先进的功能和新的研究算法。</li><li><a href="http://sphinxsearch.com/">Sphinx Search Server</a> - 全文搜索引擎。</li><li><a href="http://vespa.ai/">Vespa</a> - 在大型数据集上进行低延迟计算的引擎。它存储和索引数据，以便可以在服务时执行对数据的查询，选择和处理</li><li><a href="https://github.com/facebookresearch/faiss">Facebook Faiss</a> - 用于高效相似性搜索和密集向量聚类的库。 它包含的算法可搜索任意大小的向量集，最多可搜索到不适合 RAM 的向量。 它还包含用于评估和参数调整的支持代码。Faiss 用 C++ 编写，带有完整的 Python/numpy 包装器。</li><li><a href="https://github.com/spotify/annoy">Annoy</a> - 具有 Python 绑定的 C++库，用于搜索空间中接近给定查询点的点。 它还会创建大型的基于文件的只读数据结构，这些数据结构被映射到内存中，以便许多进程可以共享相同的数据。</li></ul><h1 id="MySQL-分支和发展"><a href="#MySQL-分支和发展" class="headerlink" title="MySQL 分支和发展"></a>MySQL 分支和发展</h1><ul><li><a href="https://aws.amazon.com/rds/">Amazon RDS</a> - AWS 的 MySQL 数据库。</li><li><a href="http://www.drizzle.org/">Drizzle</a> - MySQL 6.0的发展。</li><li><a href="https://cloud.google.com/sql/docs/">Google Cloud SQL</a> - Google 云中的 MySQL 数据库。</li><li><a href="https://mariadb.org/">MariaDB</a> - MySQL 的一个分支，采用GPL授权许可。目的是完全兼容 MySQL，包括 API 和命令行。</li><li><a href="https://www.mysql.com/products/cluster/">MySQL Cluster</a> - 使用 NDB 集群存储引擎实现 MySQL 集群。</li><li><a href="https://www.percona.com/software/mysql-database/percona-server">Percona Server</a> - MySQL 增强版，可以替代它。</li><li><a href="https://github.com/renecannao/proxysql">ProxySQL</a> - MySQL 的高性能代理。</li><li><a href="https://www.percona.com/">TokuDB</a> - MySQL 和 MariaDB 的存储引擎。</li><li><a href="http://webscalesql.org/">WebScaleSQL</a> - Facebook、 Google、Twitter 和 Linkedin 四家公司的MySQL 团队发起的 MySQL 开源组织，旨在改进 MySQL 在规模和性能等方面的问题。</li></ul><h1 id="PostgreSQL-分支和发展"><a href="#PostgreSQL-分支和发展" class="headerlink" title="PostgreSQL 分支和发展"></a>PostgreSQL 分支和发展</h1><ul><li><a href="http://db.cs.yale.edu/hadoopdb/hadoopdb.html">HadoopDB</a> - MapReduce 和 DBMS 的混合体。</li><li><a href="http://www-01.ibm.com/software/data/netezza/">IBM Netezza</a> - 高性能数据仓库设备。</li><li><a href="http://www.postgres-xl.org/">Postgres-XL</a> - 可伸缩的基于 PostgreSQL 的开源数据库集群。</li><li><a href="http://www-users.cs.umn.edu/~sarwat/RecDB/">RecDB</a> - 完全在 PostgreSQL 内部构建的开源推荐引擎。</li><li><a href="http://www.stormdb.com/community/stado">Stado</a> - 仅针对数据仓库和数据集市应用程序的开源 MPP 数据库系统。</li><li><a href="https://www.scribd.com/doc/3159239/70-Everest-PGCon-RT">Yahoo Everest</a> - 由 PostgreSQL 派生的 PB 级数据库 / MPP。</li><li><a href="http://www.timescale.com/">TimescaleDB</a> - 针对快速摄取和复杂查询而优化的开源时间序列数据库。</li><li><a href="https://www.pipelinedb.com/">PipelineDB</a> - 开源的流式数据库，基于 PostgreSQL 数据库改造的，允许我们通过 SQL 的方式，对数据流做操作，并把操作结果储存起来。</li></ul><h1 id="Memcached-分支和发展"><a href="#Memcached-分支和发展" class="headerlink" title="Memcached 分支和发展"></a>Memcached 分支和发展</h1><ul><li><a href="https://www.facebook.com/notes/facebook-engineering/mcdipper-a-key-value-cache-for-flash-storage/10151347090423920">Facebook McDipper</a> - 用于闪存的 key/value 缓存，设计目的在于提高闪存存储的使用效率。</li><li><a href="https://www.facebook.com/notes/facebook-engineering/scaling-memcache-at-facebook/10151411410803920">Facebook Memcached</a> - Memcache 的分支。</li><li><a href="https://github.com/twitter/twemproxy">Twemproxy</a> - 一个快速、轻量级的 memcached 和 redis 代理。</li><li><a href="https://github.com/twitter/fatcache">Twitter Fatcache</a> - 用于闪存的 key/value 缓存。</li><li><a href="https://github.com/twitter/twemcache">Twitter Twemcache</a> - Memcache 的分支。</li></ul><h1 id="嵌入式数据库"><a href="#嵌入式数据库" class="headerlink" title="嵌入式数据库"></a>嵌入式数据库</h1><ul><li><a href="http://www.actian.com/products/operational-databases/">Actian PSQL</a> - 由 Pervasive Software 开发的符合 ACID 的 DBMS，针对嵌入应用程序进行了优化。</li><li><a href="https://www.oracle.com/database/berkeley-db/index.html">BerkeleyDB</a> - 可为 key/value 数据提供高性能的嵌入式数据库。</li><li><a href="https://github.com/krestenkrab/hanoidb">HanoiDB</a> - Erlang LSM BTree 存储。</li><li><a href="https://github.com/google/leveldb">LevelDB</a> - Google 开源的持久化KV单机数据库，具有很高的随机写，顺序读/写性能。</li><li><a href="https://symas.com/mdb/">LMDB</a> - 由 Symas 开发的基于 Btree-based 的高性能 mmap key-value 数据库。</li><li><a href="http://rocksdb.org/">RocksDB</a> - Facebook 公司基于 LevelDB 开发的一款开源嵌入式数据库引擎。</li></ul><h1 id="商业智能"><a href="#商业智能" class="headerlink" title="商业智能"></a>商业智能</h1><ul><li><a href="https://www.bimeanalytics.com/?lang=en">BIME Analytics</a> - 商业智能云平台。</li><li><a href="https://github.com/ankane/blazer">Blazer</a> - 使商业智能变得简单。</li><li><a href="https://chartio.com">Chartio</a> - 商业智能平台，可以可视化和浏览我们的数据。</li><li><a href="https://www.datapine.com/">datapine</a> - 自助式商业智能工具。</li><li><a href="https://www.gooddata.com/">GoodData</a> - 商业智能和大数据分析软件。</li><li><a href="https://www.jaspersoft.com/">Jaspersoft</a> - 强大的商业智能套件。</li><li><a href="https://www.jedox.com/en/">Jedox Palo</a> - 可定制的商业智能平台.</li><li><a href="https://jethro.io/">Jethrodata</a> - 交互式大数据分析。</li><li><a href="https://intermix.io/">intermix.io</a> - Amazon Redshift 的性能监控</li><li><a href="https://github.com/metabase/metabase">Metabase</a> - 一个简单、开源的方式，通过给公司成员提问，从得到的数据中进行分析、学习。</li><li><a href="http://www.microsoft.com/en-us/server-cloud/solutions/business-intelligence/default.aspx">Microsoft</a> - 商业智能软件及平台。</li><li><a href="https://www.microstrategy.com/">Microstrategy</a> - 用于商业智能、移动智能和网络应用程序的软件平台。</li><li><a href="https://numeracy.co/">Numeracy</a> - 快速，干净的 SQL 客户端和商业智能。</li><li><a href="http://www.pentaho.com/">Pentaho</a> - 商业智能平台。</li><li><a href="http://www.qlik.com/us/">Qlik</a> - 商业智能及分析平台。</li><li><a href="https://redash.io/">Redash</a> - 开源商业智能平台，支持多个数据源和计划查询。</li><li><a href="https://www.meteorite.bi/">Saiku Analytics</a> - 开源分析平台。</li><li><a href="https://www.knowage-suite.com/">Knowage</a> - 开源商业智能平台。 前 <a href="http://www.spagobi.org/">SpagoBi</a>。</li><li><a href="http://sparklinedata.com/">SparklineData SNAP</a> - 基于 Apache Spark 的商业智能平台。</li><li><a href="https://www.tableau.com/">Tableau</a> - 商业智能平台。</li><li><a href="https://www.zoomdata.com/">Zoomdata</a> - 大数据分析平台。</li></ul><h1 id="数据可视化"><a href="#数据可视化" class="headerlink" title="数据可视化"></a>数据可视化</h1><ul><li><a href="https://github.com/airbnb/airpal">Airpal</a> - PrestoDB 的 Web UI。</li><li><a href="http://www.anychart.com">AnyChart</a> - 一套灵活的 JavaScript（HTML5）库，可满足您的所有数据可视化需求。</li><li><a href="https://github.com/samizdatco/arbor">Arbor</a> - 一个使用 web workers 和 jQuery 创建的图可视化库。</li><li><a href="https://github.com/LucidWorks/banana">Banana</a> - 可视化存储在 Solr 中的日志和带时间戳的数据，是 Kibana 的一部分。</li><li><a href="https://github.com/ufukomer/bloomery">Bloomery</a> - Impala 的 Web UI。</li><li><a href="http://bokeh.pydata.org/en/latest/">Bokeh</a> - 一个 Python 交互式可视化库，支持现代化 Web 浏览器，提供非常完美的展示功能。</li><li><a href="http://c3js.org/">C3</a> - 基于 D3 的可重用图表库。</li><li><a href="https://github.com/CartoDB/cartodb">CartoDB</a> - 开源的云上地理空间数据库，允许存储和可视化 web 上的数据。使用 CartoDB 可以快速创建基于地图的可视化效果。</li><li><a href="http://chartd.co/">chartd</a> - 响应式、视网膜兼容图表，仅需要一个 img 标签。</li><li><a href="http://www.chartjs.org/">Chart.js</a> - 一套开源、简单、干净并且有吸引力的基于 HTML5 技术的 JavaScript 图表工具。</li><li><a href="https://github.com/gionkunz/chartist-js">Chartist.js</a> - 非常简单而且实用的 JavaScript 前端图表生成器。</li><li><a href="http://square.github.io/crossfilter/">Crossfilter</a> -  一个 JavaScript 库，用于在 JavaScript 中制作交互式的仪表板，可以与 dc.js 、d3.js 一起工作。</li><li><a href="https://github.com/square/cubism">Cubism</a> - 用于时间序列可视化的 JavaScript 库。</li><li><a href="http://cytoscape.github.io/">Cytoscape</a> - 一个专注于网络可视化和分析的开源软件。</li><li><a href="http://dc-js.github.io/dc.js/">DC.js</a> - 一个用于网页作图、生成互动图形的 JavaScript 函数库。</li><li><a href="https://d3js.org/">D3</a> - 目前最流行的数据可视化库之一，小型，灵活，高效的数据可视化库，用来创建和操作基于数据的交互式文档。</li><li><a href="https://github.com/CSNW/d3.compose">D3.compose</a> - 由可重复使用的图表和组件组成复杂的、数据驱动的可视化文件。</li><li><a href="http://d3plus.org">D3Plus</a> - d3.js 的一组相当强大的可重用图表和样式。</li><li><a href="https://devexpress.github.io/devextreme-reactive/react/chart/">DevExtreme React Chart</a> - 基于高性能插件的 React 图表，用于 Bootstrap 和 Material Design。</li><li><a href="https://github.com/ecomfe/echarts">ECharts</a> - 一款由百度前端技术部开发的，基于Javascript 的数据可视化图表库，提供直观，生动，可交互，可个性化定制的数据可视化图表。</li><li><a href="https://github.com/HumbleSoftware/envisionjs">Envisionjs</a> - 一个基于 HTML5 技术的数据可视化库。</li><li><a href="https://metrictools.org/">FnordMetric</a> - 一个开源的 Web 应用，可用于创建实时仪表板，方便可视化任何数据。</li><li><a href="https://frappe.io/charts">Frappe Charts</a> - 一个受 Github 启发的轻量级 SVG 图表库，它不依赖任何类库和框架。</li><li><a href="https://github.com/Freeboard/freeboard">Freeboard</a> - 让用户创建他们自己的用来监控物联网部署的仪表盘，该代码在 GitHub上免费提供，你可以通过这些仪表板展示跟踪空气质量、住宅电器、酿酒情况和实时环境条件变化。</li><li><a href="https://github.com/gephi/gephi">Gephi</a> - 一款开源免费跨平台基于 JVM 的网络分析领域的数据可视化处理软件。</li><li><a href="https://developers.google.com/chart/">Google Charts</a> - 一种交互式 Web 服务，可根据用户提供的数据创建图形图表。</li><li><a href="https://grafana.com/">Grafana</a> - 一个跨平台的开源的度量分析和可视化工具，可以通过将采集的数据查询然后可视化的展示，并及时通知。</li><li><a href="http://graphiteapp.org/">Graphite</a> - 一款开源的监控绘图工具。</li><li><a href="https://www.highcharts.com/">Highcharts</a> - 兼容 IE6+、完美支持移动端、图表类型丰富、方便快捷的 HTML5 交互性图表库。</li><li><a href="http://ipython.org/">IPython</a> - 一种基于 Python 的交互式解释器。相较于原生的 Python Shell，IPython 提供了更为强大的编辑和交互功能。</li><li><a href="https://www.elastic.co/products/kibana">Kibana</a> - Elasticsearch 的开源数据可视化插件。</li><li><a href="http://lumify.io/">Lumify</a> - 开源大数据分析可视化平台。</li><li><a href="https://github.com/matplotlib/matplotlib">Matplotlib</a> - Python 编程语言及其数值数学扩展包 Numpy 的可视化操作界面。</li><li><a href="https://metricsgraphicsjs.org/">Metricsgraphic.js</a> - 一个建立在 D3 基础上，为可视化和时间序列化的数据而优化的库。</li><li><a href="http://nvd3.org/">NVD3</a> - d3.js 的图表组件。</li><li><a href="https://github.com/benpickles/peity">Peity</a> - 渐进式 SVG 条形图，折线图和饼图。</li><li><a href="https://plot.ly/">Plot.ly</a> - Plotly 为个人和协作提供在线图形，分析和统计工具，以及 Python，R，MATLAB，Perl，Julia，Arduino 和 REST 的科学图形库。</li><li><a href="https://github.com/plotly/plotly.js">Plotly.js</a> - 一个开源的交互式 JavaScript 图形库，建立在 d3.js 和 webgl 之上，并支持 20 多种类型的交互式图表。</li><li><a href="https://github.com/okfn/recline">Recline</a> - 简单而强大的库，可以使用纯 Javascript 和 HTML 构建数据应用程序。</li><li><a href="https://github.com/getredash/redash">Redash</a> - 查询和可视化数据的开源平台。</li><li><a href="http://recharts.org/">ReCharts</a> - 一个基于React组件的可组合图表库。</li><li><a href="http://shiny.rstudio.com/">Shiny</a> - R 的 Web 应用程序框架。</li><li><a href="https://github.com/jacomyal/sigma.js">Sigma.js</a> - 专门用于图形绘制的 JavaScript 库。</li><li><a href="https://github.com/apache/incubator-superset">Superset</a> - 由 Airbnb 开发并开源一个数据探索和可视化平台，设计用来提供直观的，可视化的，交互式的分析体验。</li><li><a href="https://github.com/vega/vega">Vega</a> - 一个可视化的语法。</li><li><a href="https://github.com/ZEPL/zeppelin">Zeppelin</a> - 一个基于 Web 的 notebook，提供交互数据分析和可视化。</li><li><a href="https://www.zingchart.com/">Zing Charts</a> - 一个功能强大的 JavaScript 图表。</li></ul><h1 id="物联网与传感器"><a href="#物联网与传感器" class="headerlink" title="物联网与传感器"></a>物联网与传感器</h1><ul><li><a href="http://edgent.apache.org/">Apache Edgent (Incubating)</a> - 一种编程模型和具有微内核风格的运行时，可嵌入到网关和小型的物联网设备中。</li><li><a href="https://azure.microsoft.com/en-us/services/iot-hub/">Azure IoT Hub</a> - 托管服务，支持 IoT 设备与 Azure 之间的双向通信。</li><li><a href="https://www.tempoiq.com/">TempoIQ</a> - 基于云计算的传感器分析。</li><li><a href="http://2lemetry.com/">2lemetry</a> - 物联网平台。</li><li><a href="https://www.pubnub.com/">Pubnub</a> - 数据流网络。</li><li><a href="https://www.thingworx.com/">ThingWorx</a> - 可用于查找数据来源，使数据与情境相关，合成数据，同时协调流程，以提供强大的 Web、移动和 AR 体验的平台。</li><li><a href="https://ifttt.com/">IFTTT</a> - 一个新生的网络服务平台，通过其他不同平台的条件来决定是否执行下一条命令。</li><li><a href="https://evrythng.com/">Evrything</a>- 使产品智能化。</li><li><a href="https://github.com/marty90/netlytics/">NetLytics</a> - 用于在Spark上处理网络数据的分析平台。</li></ul><h1 id="阅读材料"><a href="#阅读材料" class="headerlink" title="阅读材料"></a>阅读材料</h1><ul><li><a href="https://amplab.cs.berkeley.edu/benchmark/">Big Data Benchmark</a> - Redshift，Hive，Shark，Impala 和 Stiger/Tez的基准。</li><li><a href="https://kkovacs.eu/cassandra-vs-mongodb-vs-couchdb-vs-redis">NoSQL Comparison</a> - Cassandra，MongoDB，CouchDB，Redis，Riak，HBase，Couchbase，Neo4j，Hypertable，ElasticSearch，Accumulo，VoltDB 和 Scalaris 的比较。</li><li><a href="https://www.datadoghq.com/blog/monitoring-kafka-performance-metrics?ref=awesome">Monitoring Kafka performance</a> - 监视 Apache Kafka 的指南，包括度量收集的本地方法。</li><li><a href="https://www.datadoghq.com/blog/monitor-hadoop-metrics?ref=awesome">Monitoring Hadoop performance</a> - 监视 Hadoop 的指南，概述了 Hadoop 体系结构以及度量收集的本机方法。</li><li><a href="https://www.datadoghq.com/blog/how-to-monitor-cassandra-performance-metrics/?ref=awesome">Monitoring Cassandra performance</a> - 监控 Cassandra 的指南，包括度量收集的本地方法。</li></ul><h1 id="论文"><a href="#论文" class="headerlink" title="论文"></a>论文</h1><h2 id="2015-2016"><a href="#2015-2016" class="headerlink" title="2015 - 2016"></a>2015 - 2016</h2><ul><li><a href="http://www.vldb.org/pvldb/vol8/p1804-ching.pdf">2015</a> - <strong>Facebook</strong> - One Trillion Edges: Graph Processing at Facebook-Scale.</li></ul><h2 id="2013-2014"><a href="#2013-2014" class="headerlink" title="2013 - 2014"></a>2013 - 2014</h2><ul><li><a href="http://infolab.stanford.edu/~ullman/mmds/book.pdf">2014</a> - <strong>Stanford</strong> - Mining of Massive Datasets.</li><li><a href="https://amplab.cs.berkeley.edu/wp-content/uploads/2013/03/eurosys13-paper83.pdf">2013</a> - <strong>AMPLab</strong> - Presto: Distributed Machine Learning and Graph Processing with Sparse Matrices.</li><li><a href="https://amplab.cs.berkeley.edu/wp-content/uploads/2013/01/dmx1.pdf">2013</a> - <strong>AMPLab</strong> - MLbase: A Distributed Machine-learning System.</li><li><a href="https://amplab.cs.berkeley.edu/wp-content/uploads/2013/02/shark_sigmod2013.pdf">2013</a> - <strong>AMPLab</strong> - Shark: SQL and Rich Analytics at Scale.</li><li><a href="https://amplab.cs.berkeley.edu/wp-content/uploads/2013/05/grades-graphx_with_fonts.pdf">2013</a> - <strong>AMPLab</strong> - GraphX: A Resilient Distributed Graph System on Spark.</li><li><a href="http://static.googleusercontent.com/media/research.google.com/en//pubs/archive/40671.pdf">2013</a> - <strong>Google</strong> - HyperLogLog in Practice: Algorithmic Engineering of a State of The Art Cardinality Estimation Algorithm.</li><li><a href="http://research.microsoft.com/pubs/200169/now-vldb.pdf">2013</a> - <strong>Microsoft</strong> - Scalable Progressive Analytics on Big Data in the Cloud.</li><li><a href="http://static.druid.io/docs/druid.pdf">2013</a> - <strong>Metamarkets</strong> - Druid: A Real-time Analytical Data Store.</li><li><a href="http://db.disi.unitn.eu/pages/VLDBProgram/pdf/industry/p764-rae.pdf">2013</a> - <strong>Google</strong> - Online, Asynchronous Schema Change in F1.</li><li><a href="http://static.googleusercontent.com/media/research.google.com/en/us/pubs/archive/41344.pdf">2013</a> - <strong>Google</strong> - F1: A Distributed SQL Database That Scales.</li><li><a href="http://db.disi.unitn.eu/pages/VLDBProgram/pdf/industry/p734-akidau.pdf">2013</a> - <strong>Google</strong> - MillWheel: Fault-Tolerant Stream Processing at Internet Scale.</li><li><a href="http://db.disi.unitn.eu/pages/VLDBProgram/pdf/industry/p767-wiener.pdf">2013</a> - <strong>Facebook</strong> - Scuba: Diving into Data at Facebook.</li><li><a href="http://db.disi.unitn.eu/pages/VLDBProgram/pdf/industry/p871-curtiss.pdf">2013</a> - <strong>Facebook</strong> - Unicorn: A System for Searching the Social Graph.</li><li><a href="https://www.usenix.org/system/files/conference/nsdi13/nsdi13-final170_update.pdf">2013</a> - <strong>Facebook</strong> - Scaling Memcache at Facebook.</li></ul><h2 id="2011-2012"><a href="#2011-2012" class="headerlink" title="2011 - 2012"></a>2011 - 2012</h2><ul><li><a href="http://vldb.org/pvldb/vol5/p1771_georgelee_vldb2012.pdf">2012</a> - <strong>Twitter</strong> - The Unified Logging Infrastructurefor Data Analytics at Twitter.</li><li><a href="https://amplab.cs.berkeley.edu/wp-content/uploads/2013/04/blinkdb_vldb12_demo.pdf">2012</a> - <strong>AMPLab</strong> - Blink and It’s Done: Interactive Queries on Very Large Data.</li><li><a href="https://www.usenix.org/system/files/login/articles/zaharia.pdf">2012</a> - <strong>AMPLab</strong> - Fast and Interactive Analytics over Hadoop Data with Spark.</li><li><a href="https://amplab.cs.berkeley.edu/wp-content/uploads/2012/03/mod482-xin1.pdf">2012</a> - <strong>AMPLab</strong> - Shark: Fast Data Analysis Using Coarse-grained Distributed Memory.</li><li><a href="https://www.usenix.org/legacy/event/nsdi11/tech/full_papers/Bolosky.pdf">2012</a> - <strong>Microsoft</strong> - Paxos Replicated State Machines as the Basis of a High-Performance Data Store.</li><li><a href="http://research.microsoft.com/pubs/178045/ppaoxs-paper29.pdf">2012</a> - <strong>Microsoft</strong> - Paxos Made Parallel.</li><li><a href="https://arxiv.org/pdf/1203.5485.pdf">2012</a> - <strong>AMPLab</strong> - BlinkDB: Queries with Bounded Errors and Bounded Response Times on Very Large Data.</li><li><a href="http://vldb.org/pvldb/vol5/p1436_alexanderhall_vldb2012.pdf">2012</a> - <strong>Google</strong> - Processing a trillion cells per mouse click.</li><li><a href="http://static.googleusercontent.com/media/research.google.com/en//archive/spanner-osdi2012.pdf">2012</a> - <strong>Google</strong> - Spanner: Google’s Globally-Distributed Database.</li><li><a href="https://amplab.cs.berkeley.edu/wp-content/uploads/2011/06/euro118-ananthanarayanan.pdf">2011</a> - <strong>AMPLab</strong> - Scarlett: Coping with Skewed Popularity Content in MapReduce Clusters.</li><li><a href="https://amplab.cs.berkeley.edu/wp-content/uploads/2011/06/Mesos-A-Platform-for-Fine-Grained-Resource-Sharing-in-the-Data-Center.pdf">2011</a> - <strong>AMPLab</strong> - Mesos: A Platform for Fine-Grained Resource Sharing in the Data Center.</li><li><a href="http://static.googleusercontent.com/media/research.google.com/en//pubs/archive/36971.pdf">2011</a> - <strong>Google</strong> - Megastore: Providing Scalable, Highly Available Storage for Interactive Services.</li></ul><h2 id="2001-2010"><a href="#2001-2010" class="headerlink" title="2001 - 2010"></a>2001 - 2010</h2><ul><li><a href="https://www.usenix.org/legacy/event/osdi10/tech/full_papers/Beaver.pdf">2010</a> - <strong>Facebook</strong> - Finding a needle in Haystack: Facebook’s photo storage.</li><li><a href="https://amplab.cs.berkeley.edu/wp-content/uploads/2011/06/Spark-Cluster-Computing-with-Working-Sets.pdf">2010</a> - <strong>AMPLab</strong> - Spark: Cluster Computing with Working Sets.</li><li><a href="http://kowshik.github.io/JPregel/pregel_paper.pdf">2010</a> - <strong>Google</strong> - Pregel: A System for Large-Scale Graph Processing.</li><li><a href="http://static.googleusercontent.com/media/research.google.com/en//pubs/archive/36726.pdf">2010</a> - <strong>Google</strong> - Large-scale Incremental Processing Using Distributed Transactions and Notiﬁcations base of Percolator and Caffeine.</li><li><a href="http://static.googleusercontent.com/media/research.google.com/en//pubs/archive/36632.pdf">2010</a> - <strong>Google</strong> - Dremel: Interactive Analysis of Web-Scale Datasets.</li><li><a href="http://leoneu.github.io/">2010</a> - <strong>Yahoo</strong> - S4: Distributed Stream Computing Platform.</li><li><a href="http://www.cs.umd.edu/~abadi/papers/hadoopdb.pdf">2009</a> - HadoopDB: An Architectural Hybrid of MapReduce and DBMS Technologies for Analytical Workloads.    </li><li><a href="https://cwiki.apache.org/confluence/download/attachments/120729877/chukwa_cca08.pdf?version=1&amp;modificationDate=1562667399000&amp;api=v2">2008</a> - <strong>AMPLab</strong> - Chukwa: A large-scale monitoring system.</li><li><a href="http://www.read.seas.harvard.edu/~kohler/class/cs239-w08/decandia07dynamo.pdf">2007</a> - <strong>Amazon</strong> - Dynamo: Amazon’s Highly Available Key-value Store.</li><li><a href="http://static.googleusercontent.com/media/research.google.com/en//archive/chubby-osdi06.pdf">2006</a> - <strong>Google</strong> - The Chubby lock service for loosely-coupled distributed systems.</li><li><a href="http://static.googleusercontent.com/external_content/untrusted_dlcp/research.google.com/en//archive/bigtable-osdi06.pdf">2006</a> - <strong>Google</strong> - Bigtable: A Distributed Storage System for Structured Data.</li><li><a href="http://static.googleusercontent.com/media/research.google.com/en//archive/mapreduce-osdi04.pdf">2004</a> - <strong>Google</strong> - MapReduce: Simplied Data Processing on Large Clusters.</li><li><a href="http://static.googleusercontent.com/media/research.google.com/en//archive/gfs-sosp2003.pdf">2003</a> - <strong>Google</strong> - The Google File System.</li></ul><h1 id="视频"><a href="#视频" class="headerlink" title="视频"></a>视频</h1><ul><li><a href="https://www.manning.com/livevideo/spark-in-motion">Spark in Motion</a> - Spark in Motion 教你如何使用 Spark 进行批处理和流数据分析。</li><li><a href="https://www.manning.com/livevideo/machine-learning-data-science-and-deep-learning-with-python">Machine Learning, Data Science and Deep Learning with Python </a> - LiveVideo 教程涵盖了机器学习，Tensorflow，人工智能和神经网络。</li></ul><h1 id="书籍"><a href="#书籍" class="headerlink" title="书籍"></a>书籍</h1><h2 id="数据流"><a href="#数据流" class="headerlink" title="数据流"></a>数据流</h2><ul><li><a href="https://www.manning.com/books/data-science-at-scale-with-python-and-dask">Data Science at Scale with Python and Dask</a> - 使用 Python 和 Dask 进行大规模数据科学教学，将教您如何构建可处理大量数据的分布式数据项目。</li><li><a href="https://www.manning.com/books/streaming-data">Streaming Data</a> - 介绍了流数据和实时数据系统的概念和要求。</li><li><a href="https://www.manning.com/books/storm-applied">Storm Applied</a> - 将 Apache Storm 用于与处理和分析实时数据流相关的实际任务的实用指南。</li><li><a href="http://www.cambridge.org/us/academic/subjects/engineering/communications-and-signal-processing/fundamentals-stream-processing-application-design-systems-and-analytics">Fundamentals of Stream Processing: Application Design, Systems, and Analytics</a> - 该指南结合了流处理中的基本构建块和新兴研究，非常适合应用程序设计人员，系统构建人员，分析开发人员以及该领域的学生和研究人员。</li><li><a href="http://www.springer.com/us/book/9780387710020">Stream Data Processing: A Quality of Service Perspective</a> - 提出了适用于流和复杂事件处理的新范例。</li><li><a href="https://www.manning.com/books/event-streams-in-action">Unified Log Processing</a> - 统一日志处理是在企业中实施事件流（Kafka 或 Kinesis）的统一日志的实用指南</li><li><a href="https://www.manning.com/books/kafka-streams-in-action">Kafka Streams in Action</a> - 在 Kafka 平台的数据上实现流处理所需的一切知识，可以集中精力从数据中获取更多信息，而无需花费时间或精力。</li><li><a href="https://www.manning.com/books/big-data">Big Data</a> - 教您使用一种架构来构建大数据系统，该架构利用了群集硬件以及专门用于捕获和分析 Web 规模数据的新工具。</li><li><a href="https://www.manning.com/books/spark-in-action">Spark in Action</a> &amp; <a href="https://www.manning.com/books/spark-in-action-second-edition">Spark in Action 2nd Ed.</a> - 教您使用Spark有效处理批处理和流式数据所需的理论和技能。 完全更新为Spark 2.0。</li><li><a href="https://www.manning.com/books/kafka-in-action">Kafka in Action</a> - 快速介绍与Kafka合作的各个方面的信息，您需要真正利用它的好处。</li><li><a href="https://www.manning.com/books/fusion-in-action">Fusion in Action</a> - 教您建立功能齐全的数据分析管道，包括文档和数据搜索以及分布式数据集群。</li><li><a href="https://www.manning.com/books/reactive-data-handling">Reactive Data Handling</a> - Reactive Data Handling 是由 Manuel Bernhardt 选择的五个精选章节的集合，向您介绍构建能够处理大数据负载实时处理的反应式应用程序。</li></ul><h2 id="分布式系统"><a href="#分布式系统" class="headerlink" title="分布式系统"></a>分布式系统</h2><ul><li><a href="http://book.mixu.net/distsys/">Distributed Systems for fun and profit</a> - 分布式系统理论。 包括有关时间和顺序，复制和不可能结果的部分。</li></ul><h2 id="图论"><a href="#图论" class="headerlink" title="图论"></a>图论</h2><ul><li><a href="https://www.manning.com/books/graph-powered-machine-learning">Graph-Powered Machine Learning</a> - Alessandro Negro 结合图论和模型来改善机器学习项目。</li></ul><h2 id="数据可视化-1"><a href="#数据可视化-1" class="headerlink" title="数据可视化"></a>数据可视化</h2><ul><li><a href="https://www.youtube.com/watch?v=5Zg-C8AAIGg">The beauty of data visualization</a></li><li><a href="https://www.youtube.com/watch?v=R-oiKt7bUU8">Designing Data Visualizations with Noah Iliinsky</a></li><li><a href="https://www.youtube.com/watch?v=jbkSRLYSojo">Hans Rosling&#39;s 200 Countries, 200 Years, 4 Minutes</a></li><li><a href="https://www.youtube.com/watch?v=qTEchen97rQ">Ice Bucket Challenge Data Visualization</a></li></ul><h1 id="其他清单"><a href="#其他清单" class="headerlink" title="其他清单"></a>其他清单</h1><ul><li>Other awesome lists <a href="https://github.com/bayandin/awesome-awesomeness">awesome-awesomeness</a>.</li><li>Even more lists <a href="https://github.com/sindresorhus/awesome">awesome</a>.</li><li>Another list? <a href="https://github.com/jnv/lists">list</a>.</li><li>WTF! <a href="https://github.com/t3chnoboy/awesome-awesome-awesome">awesome-awesome-awesome</a>.</li><li>Analytics <a href="https://github.com/onurakpolat/awesome-analytics">awesome-analytics</a>.</li><li>Public Datasets <a href="https://github.com/awesomedata/awesome-public-datasets">awesome-public-datasets</a>.</li><li>Graph Classification <a href="https://github.com/benedekrozemberczki/awesome-graph-classification">awesome-graph-classification</a>.</li><li>Network Embedding <a href="https://github.com/chihming/awesome-network-embedding">awesome-network-embedding</a>.</li><li>Community Detection <a href="https://github.com/benedekrozemberczki/awesome-community-detection">awesome-community-detection</a>.</li><li>Decision Tree Papers <a href="https://github.com/benedekrozemberczki/awesome-decision-tree-papers">awesome-decision-tree-papers</a>.</li><li>Fraud Detection Papers <a href="https://github.com/benedekrozemberczki/awesome-fraud-detection-papers">awesome-fraud-detection-papers</a>.</li><li>Gradient Boosting Papers <a href="https://github.com/benedekrozemberczki/awesome-gradient-boosting-papers">awesome-gradient-boosting-papers</a>.</li><li>Monte Carlo Tree Search Papers <a href="https://github.com/benedekrozemberczki/awesome-monte-carlo-tree-search-papers">awesome-monte-carlo-tree-search-papers</a>.</li><li>Kafka <a href="https://github.com/monksy/awesome-kafka">awesome-kafka</a>.</li></ul>]]></content>
      
      
      <categories>
          
          <category> 教程笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 大数据 </tag>
            
            <tag> 文档 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>在 Hexo 中插入 ECharts 动态图表</title>
      <link href="post/6f565d8c.html"/>
      <url>post/6f565d8c.html</url>
      
        <content type="html"><![CDATA[<h1 id="ECharts-简介"><a href="#ECharts-简介" class="headerlink" title="ECharts 简介"></a>ECharts 简介</h1><p><a href="https://echarts.apache.org/">ECharts</a> 是一个使用 JavaScript 实现的开源可视化库，可以流畅的运行在 PC 和移动设备上，兼容当前绝大部分浏览器（Chrome，Firefox，Safari，IE8/9/10/11等），底层依赖矢量图形库 ZRender，提供直观，交互丰富，可高度个性化定制的数据可视化图表。它提供了常规的折线图、柱状图、散点图、饼图、K线图，用于统计的盒形图，用于地理数据可视化的地图、热力图、线图，用于关系数据可视化的关系图、treemap、旭日图，多维数据可视化的平行坐标，还有用于 BI 的漏斗图，仪表盘，并且支持图与图之间的混搭。</p><h1 id="Hexo-中的-ECharts"><a href="#Hexo-中的-ECharts" class="headerlink" title="Hexo 中的 ECharts"></a>Hexo 中的 ECharts</h1><p>ECharts 的 Hexo 插件目前有三个版本，分别为：</p><ul><li><a href="https://github.com/zhoulvjun/hexo-tag-echarts">hexo-tag-echarts</a><ul><li>需要手动引入 ECharts.js</li></ul></li><li><a href="https://github.com/kchen0x/hexo-tag-echarts3">hexo-tag-echarts3</a><ul><li>自动引入 <a href="https://cdn.bootcss.com/echarts/3.8.0/echarts.min.js">https://cdn.bootcss.com/echarts/3.8.0/echarts.min.js</a></li></ul></li><li><a href="https://github.com/gyx138/hexo-tag-echarts4">hexo-tag-echarts4</a><ul><li>自动引入 <a href="https://cdn.bootcss.com/echarts/4.3.0/echarts.min.js">https://cdn.bootcss.com/echarts/4.3.0/echarts.min.js</a></li></ul></li></ul><p>本文使用的是 Hexo 的 ECharts 插件 <a href="https://github.com/zhoulvjun/hexo-tag-echarts">hexo-tag-echarts</a>，只需要在 Hexo 文档中引入一次 ECharts.js 就可以渲染整个页面的图表了。插件的安装和使用非常的简单，只需要进入博客目录，然后打开命令行，用 <code>npm</code> 安装一下：</p><p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">npm install hexo-tag-echarts --save<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><p>之后在文章内使用 <code>echarts</code> 的 <code>tag</code> 就可以了</p><p><pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown">&#123;% echarts 400 '90%' %&#125;\\TODO echarts option goes here&#123;% endecharts %&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></p><p>其中 <code>echarts</code> 是标签名，<code>endecharts</code> 是结束标签，不需要更改，<code>400</code> 是图表容器的高度，默认是按正常比例缩放的，<code>&#39;90%&#39;</code> 是图表容器的相对宽度，默认是 <code>100%</code>。在标签之间的部分，需要自己填充的图表数据和属性，更多自定义属性可以查看 <a href="https://echarts.apache.org/zh/option.html#title">ECharts 配置项文档</a>。</p><h1 id="图表示例"><a href="#图表示例" class="headerlink" title="图表示例"></a>图表示例</h1><p>现在你已经基本学会了在 Hexo 中插入 ECharts 图表了，下面再展示一些基本的图表，更多炫酷的图表可以自己去尝试一下。</p><h2 id="折线图"><a href="#折线图" class="headerlink" title="折线图"></a>折线图</h2><p><pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown">&#123;% echarts 400 '90%' %&#125;&#123;    tooltip: &#123;        trigger: 'axis'    &#125;,    xAxis: &#123;        type: 'category',        data: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun']    &#125;,    yAxis: &#123;        type: 'value'    &#125;,    series: [&#123;        data: [820, 932, 901, 934, 1290, 1330, 1320],        type: 'line'    &#125;]&#125;;&#123;% endecharts %&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p>显示效果如下所示：</p><p><div id="echarts7684" style="width: 90%;height: 400px;margin: 0 auto"></div><script type="text/javascript">        // 基于准备好的dom，初始化echarts实例        var myChart = echarts.init(document.getElementById('echarts7684'));        // 指定图表的配置项和数据        var option = {    tooltip: {        trigger: 'axis'    },    xAxis: {        type: 'category',        data: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun']    },    yAxis: {        type: 'value'    },    series: [{        data: [820, 932, 901, 934, 1290, 1330, 1320],        type: 'line'    }]};        // 使用刚指定的配置项和数据显示图表。        myChart.setOption(option);</script></p><h2 id="柱状图、条形图"><a href="#柱状图、条形图" class="headerlink" title="柱状图、条形图"></a>柱状图、条形图</h2><p><pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown">&#123;% echarts 400 '90%' %&#125;&#123;    tooltip: &#123;&#125;,    xAxis: &#123;        type: 'category',        data: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun']    &#125;,    yAxis: &#123;        type: 'value'    &#125;,    series: [&#123;        data: [120, 200, 150, 80, 70, 110, 130],        type: 'bar'    &#125;]&#125;;&#123;% endecharts %&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p>显示效果如下所示：</p><p><div id="echarts6466" style="width: 90%;height: 400px;margin: 0 auto"></div><script type="text/javascript">        // 基于准备好的dom，初始化echarts实例        var myChart = echarts.init(document.getElementById('echarts6466'));        // 指定图表的配置项和数据        var option = {    tooltip: {},    xAxis: {        type: 'category',        data: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun']    },    yAxis: {        type: 'value'    },    series: [{        data: [120, 200, 150, 80, 70, 110, 130],        type: 'bar'    }]};        // 使用刚指定的配置项和数据显示图表。        myChart.setOption(option);</script></p><h2 id="环形图、饼状图"><a href="#环形图、饼状图" class="headerlink" title="环形图、饼状图"></a>环形图、饼状图</h2><p><pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown">&#123;% echarts 400 '90%' %&#125;&#123;    tooltip: &#123;        trigger: 'item',        formatter: '&#123;a&#125; <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">/></span></span>&#123;b&#125;: &#123;c&#125; (&#123;d&#125;%)'    &#125;,    legend: &#123;        orient: 'vertical',        left: 10,        data: ['直接访问', '邮件营销', '联盟广告', '视频广告', '搜索引擎']    &#125;,    series: [        &#123;            name: '访问来源',            type: 'pie',            radius: ['50%', '70%'],            avoidLabelOverlap: false,            label: &#123;                show: false,                position: 'center'            &#125;,            emphasis: &#123;                label: &#123;                    show: true,                    fontSize: '30',                    fontWeight: 'bold'                &#125;            &#125;,            labelLine: &#123;                show: false            &#125;,            data: [                &#123;value: 335, name: '直接访问'&#125;,                &#123;value: 310, name: '邮件营销'&#125;,                &#123;value: 234, name: '联盟广告'&#125;,                &#123;value: 135, name: '视频广告'&#125;,                &#123;value: 1548, name: '搜索引擎'&#125;            ]        &#125;    ]&#125;;&#123;% endecharts %&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p>显示效果如下所示：</p><p><div id="echarts4946" style="width: 90%;height: 400px;margin: 0 auto"></div><script type="text/javascript">        // 基于准备好的dom，初始化echarts实例        var myChart = echarts.init(document.getElementById('echarts4946'));        // 指定图表的配置项和数据        var option = {    tooltip: {        trigger: 'item',        formatter: '{a} <br/>{b}: {c} ({d}%)'    },    legend: {        orient: 'vertical',        left: 10,        data: ['直接访问', '邮件营销', '联盟广告', '视频广告', '搜索引擎']    },    series: [        {            name: '访问来源',            type: 'pie',            radius: ['50%', '70%'],            avoidLabelOverlap: false,            label: {                show: false,                position: 'center'            },            emphasis: {                label: {                    show: true,                    fontSize: '30',                    fontWeight: 'bold'                }            },            labelLine: {                show: false            },            data: [                {value: 335, name: '直接访问'},                {value: 310, name: '邮件营销'},                {value: 234, name: '联盟广告'},                {value: 135, name: '视频广告'},                {value: 1548, name: '搜索引擎'}            ]        }    ]};        // 使用刚指定的配置项和数据显示图表。        myChart.setOption(option);</script></p><h2 id="散点图"><a href="#散点图" class="headerlink" title="散点图"></a>散点图</h2><p><pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown">&#123;% echarts 400 '90%' %&#125;&#123;    tooltip: &#123;&#125;,    xAxis: &#123;&#125;,    yAxis: &#123;&#125;,    series: [&#123;        symbolSize: 20,        data: [            [10.0, 8.04],            [8.0, 6.95],            [13.0, 7.58],            [9.0, 8.81],            [11.0, 8.33],            [14.0, 9.96],            [6.0, 7.24],            [4.0, 4.26],            [12.0, 10.84],            [7.0, 4.82],            [5.0, 5.68]        ],        type: 'scatter'    &#125;]&#125;;&#123;% endecharts %&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p>显示效果如下所示：<div id="echarts1906" style="width: 90%;height: 400px;margin: 0 auto"></div><script type="text/javascript">        // 基于准备好的dom，初始化echarts实例        var myChart = echarts.init(document.getElementById('echarts1906'));        // 指定图表的配置项和数据        var option = {    tooltip: {},    xAxis: {},    yAxis: {},    series: [{        symbolSize: 20,        data: [            [10.0, 8.04],            [8.0, 6.95],            [13.0, 7.58],            [9.0, 8.81],            [11.0, 8.33],            [14.0, 9.96],            [6.0, 7.24],            [4.0, 4.26],            [12.0, 10.84],            [7.0, 4.82],            [5.0, 5.68]        ],        type: 'scatter'    }]};        // 使用刚指定的配置项和数据显示图表。        myChart.setOption(option);</script></p><h2 id="雷达图"><a href="#雷达图" class="headerlink" title="雷达图"></a>雷达图</h2><p><pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown">&#123;% echarts 400 '90%' %&#125;&#123;    tooltip: &#123;&#125;,    legend: &#123;        data: ['预算分配（Allocated Budget）', '实际开销（Actual Spending）']    &#125;,    radar: &#123;        name: &#123;            textStyle: &#123;                color: '#fff',                backgroundColor: '#999',                borderRadius: 3,                padding: [3, 5]            &#125;        &#125;,        indicator: [            &#123; name: '销售（sales）', max: 6500&#125;,            &#123; name: '管理（Administration）', max: 16000&#125;,            &#123; name: '信息技术（Information Techology）', max: 30000&#125;,            &#123; name: '客服（Customer Support）', max: 38000&#125;,            &#123; name: '研发（Development）', max: 52000&#125;,            &#123; name: '市场（Marketing）', max: 25000&#125;        ]    &#125;,    series: [&#123;        name: '预算 vs 开销（Budget vs spending）',        type: 'radar',        data: [            &#123;                value: [4300, 10000, 28000, 35000, 50000, 19000],                name: '预算分配（Allocated Budget）'            &#125;,            &#123;                value: [5000, 14000, 28000, 31000, 42000, 21000],                name: '实际开销（Actual Spending）'            &#125;        ]    &#125;]&#125;;&#123;% endecharts %&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p>显示效果如下所示：</p><p><div id="echarts9728" style="width: 90%;height: 400px;margin: 0 auto"></div><script type="text/javascript">        // 基于准备好的dom，初始化echarts实例        var myChart = echarts.init(document.getElementById('echarts9728'));        // 指定图表的配置项和数据        var option = {    tooltip: {},    legend: {        data: ['预算分配（Allocated Budget）', '实际开销（Actual Spending）']    },    radar: {        name: {            textStyle: {                color: '#fff',                backgroundColor: '#999',                borderRadius: 3,                padding: [3, 5]            }        },        indicator: [            { name: '销售（sales）', max: 6500},            { name: '管理（Administration）', max: 16000},            { name: '信息技术（Information Techology）', max: 30000},            { name: '客服（Customer Support）', max: 38000},            { name: '研发（Development）', max: 52000},            { name: '市场（Marketing）', max: 25000}        ]    },    series: [{        name: '预算 vs 开销（Budget vs spending）',        type: 'radar',        data: [            {                value: [4300, 10000, 28000, 35000, 50000, 19000],                name: '预算分配（Allocated Budget）'            },            {                value: [5000, 14000, 28000, 31000, 42000, 21000],                name: '实际开销（Actual Spending）'            }        ]    }]};        // 使用刚指定的配置项和数据显示图表。        myChart.setOption(option);</script></p><h2 id="关系图"><a href="#关系图" class="headerlink" title="关系图"></a>关系图</h2><p><pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown">&#123;% echarts 400 '90%' %&#125;&#123;    tooltip: &#123;&#125;,    series: [        &#123;            type: 'graph',            layout: 'none',            symbolSize: 50,            label: &#123;                show: true            &#125;,            edgeSymbol: ['circle', 'arrow'],            edgeSymbolSize: [4, 10],            edgeLabel: &#123;                fontSize: 20            &#125;,            data: [&#123;                name: '节点1',                x: 300,                y: 300            &#125;, &#123;                name: '节点2',                x: 800,                y: 300            &#125;, &#123;                name: '节点3',                x: 550,                y: 100            &#125;, &#123;                name: '节点4',                x: 550,                y: 500            &#125;],            links: [&#123;                source: 0,                target: 1,                symbolSize: [5, 20],                label: &#123;                    show: true                &#125;,                lineStyle: &#123;                    width: 5,                    curveness: 0.2                &#125;            &#125;, &#123;                source: '节点2',                target: '节点1',                label: &#123;                    show: true                &#125;,                lineStyle: &#123;                    curveness: 0.2                &#125;            &#125;, &#123;                source: '节点1',                target: '节点3'            &#125;, &#123;                source: '节点2',                target: '节点3'            &#125;, &#123;                source: '节点2',                target: '节点4'            &#125;, &#123;                source: '节点1',                target: '节点4'            &#125;],            lineStyle: &#123;                opacity: 0.9,                width: 2,                curveness: 0            &#125;        &#125;    ]&#125;;&#123;% endecharts %&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p>显示效果如下所示：</p><p><div id="echarts5074" style="width: 90%;height: 400px;margin: 0 auto"></div><script type="text/javascript">        // 基于准备好的dom，初始化echarts实例        var myChart = echarts.init(document.getElementById('echarts5074'));        // 指定图表的配置项和数据        var option = {    tooltip: {},    series: [        {            type: 'graph',            layout: 'none',            symbolSize: 50,            label: {                show: true            },            edgeSymbol: ['circle', 'arrow'],            edgeSymbolSize: [4, 10],            edgeLabel: {                fontSize: 20            },            data: [{                name: '节点1',                x: 300,                y: 300            }, {                name: '节点2',                x: 800,                y: 300            }, {                name: '节点3',                x: 550,                y: 100            }, {                name: '节点4',                x: 550,                y: 500            }],            links: [{                source: 0,                target: 1,                symbolSize: [5, 20],                label: {                    show: true                },                lineStyle: {                    width: 5,                    curveness: 0.2                }            }, {                source: '节点2',                target: '节点1',                label: {                    show: true                },                lineStyle: {                    curveness: 0.2                }            }, {                source: '节点1',                target: '节点3'            }, {                source: '节点2',                target: '节点3'            }, {                source: '节点2',                target: '节点4'            }, {                source: '节点1',                target: '节点4'            }],            lineStyle: {                opacity: 0.9,                width: 2,                curveness: 0            }        }    ]};        // 使用刚指定的配置项和数据显示图表。        myChart.setOption(option);</script></p><h2 id="矩形树图"><a href="#矩形树图" class="headerlink" title="矩形树图"></a>矩形树图</h2><p><pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown">&#123;% echarts 400 '90%' %&#125;&#123;    tooltip: &#123;&#125;,    series: [&#123;        type: 'treemap',        data: [&#123;            name: 'nodeA',            // First tree            value: 10,            children: [&#123;                name: 'nodeAa',       // First leaf of first tree                value: 4            &#125;, &#123;                name: 'nodeAb',       // Second leaf of first tree                value: 6            &#125;]        &#125;, &#123;            name: 'nodeB',            // Second tree            value: 20,            children: [&#123;                name: 'nodeBa',       // Son of first tree                value: 20,                children: [&#123;                    name: 'nodeBa1',  // Granson of first tree                    value: 20                &#125;]            &#125;]        &#125;]    &#125;]&#125;;&#123;% endecharts %&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p>显示效果如下所示：</p><p><div id="echarts3456" style="width: 90%;height: 400px;margin: 0 auto"></div><script type="text/javascript">        // 基于准备好的dom，初始化echarts实例        var myChart = echarts.init(document.getElementById('echarts3456'));        // 指定图表的配置项和数据        var option = {    tooltip: {},    series: [{        type: 'treemap',        data: [{            name: 'nodeA',            // First tree            value: 10,            children: [{                name: 'nodeAa',       // First leaf of first tree                value: 4            }, {                name: 'nodeAb',       // Second leaf of first tree                value: 6            }]        }, {            name: 'nodeB',            // Second tree            value: 20,            children: [{                name: 'nodeBa',       // Son of first tree                value: 20,                children: [{                    name: 'nodeBa1',  // Granson of first tree                    value: 20                }]            }]        }]    }]};        // 使用刚指定的配置项和数据显示图表。        myChart.setOption(option);</script></p><h2 id="旭日图"><a href="#旭日图" class="headerlink" title="旭日图"></a>旭日图</h2><p><pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown">&#123;% echarts 400 '90%' %&#125;&#123;    tooltip: &#123;&#125;,    series: &#123;        type: 'sunburst',        data: [&#123;            name: 'Grandpa',            children: [&#123;                name: 'Uncle Leo',                value: 15,                children: [&#123;                    name: 'Cousin Jack',                    value: 2                &#125;, &#123;                    name: 'Cousin Mary',                    value: 5,                    children: [&#123;                        name: 'Jackson',                        value: 2                    &#125;]                &#125;, &#123;                    name: 'Cousin Ben',                    value: 4                &#125;]            &#125;, &#123;                name: 'Father',                value: 10,                children: [&#123;                    name: 'Me',                    value: 5                &#125;, &#123;                    name: 'Brother Peter',                    value: 1                &#125;]            &#125;]        &#125;, &#123;            name: 'Nancy',            children: [&#123;                name: 'Uncle Nike',                children: [&#123;                    name: 'Cousin Betty',                    value: 1                &#125;, &#123;                    name: 'Cousin Jenny',                    value: 2                &#125;]            &#125;]        &#125;],        radius: [0, '90%'],        label: &#123;            rotate: 'radial'        &#125;    &#125;&#125;;&#123;% endecharts %&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p>显示效果如下所示：</p><p><div id="echarts5755" style="width: 90%;height: 700px;margin: 0 auto"></div><script type="text/javascript">        // 基于准备好的dom，初始化echarts实例        var myChart = echarts.init(document.getElementById('echarts5755'));        // 指定图表的配置项和数据        var option = {    tooltip: {},    series: {        type: 'sunburst',        data: [{            name: 'Grandpa',            children: [{                name: 'Uncle Leo',                value: 15,                children: [{                    name: 'Cousin Jack',                    value: 2                }, {                    name: 'Cousin Mary',                    value: 5,                    children: [{                        name: 'Jackson',                        value: 2                    }]                }, {                    name: 'Cousin Ben',                    value: 4                }]            }, {                name: 'Father',                value: 10,                children: [{                    name: 'Me',                    value: 5                }, {                    name: 'Brother Peter',                    value: 1                }]            }]        }, {            name: 'Nancy',            children: [{                name: 'Uncle Nike',                children: [{                    name: 'Cousin Betty',                    value: 1                }, {                    name: 'Cousin Jenny',                    value: 2                }]            }]        }],        radius: [0, '90%'],        label: {            rotate: 'radial'        }    }};        // 使用刚指定的配置项和数据显示图表。        myChart.setOption(option);</script></p><h2 id="平行坐标系"><a href="#平行坐标系" class="headerlink" title="平行坐标系"></a>平行坐标系</h2><p><pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown">&#123;% echarts 400 '90%' %&#125;&#123;    parallelAxis: [        &#123;dim: 0, name: 'Price'&#125;,        &#123;dim: 1, name: 'Net Weight'&#125;,        &#123;dim: 2, name: 'Amount'&#125;,        &#123;            dim: 3,            name: 'Score',            type: 'category',            data: ['Excellent', 'Good', 'OK', 'Bad']        &#125;    ],    series: &#123;        type: 'parallel',        lineStyle: &#123;            width: 4        &#125;,        data: [            [12.99, 100, 82, 'Good'],            [9.99, 80, 77, 'OK'],            [20, 120, 60, 'Excellent']        ]    &#125;&#125;;&#123;% endecharts %&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p>显示效果如下所示：</p><p><div id="echarts6640" style="width: 90%;height: 400px;margin: 0 auto"></div><script type="text/javascript">        // 基于准备好的dom，初始化echarts实例        var myChart = echarts.init(document.getElementById('echarts6640'));        // 指定图表的配置项和数据        var option = {    parallelAxis: [        {dim: 0, name: 'Price'},        {dim: 1, name: 'Net Weight'},        {dim: 2, name: 'Amount'},        {            dim: 3,            name: 'Score',            type: 'category',            data: ['Excellent', 'Good', 'OK', 'Bad']        }    ],    series: {        type: 'parallel',        lineStyle: {            width: 4        },        data: [            [12.99, 100, 82, 'Good'],            [9.99, 80, 77, 'OK'],            [20, 120, 60, 'Excellent']        ]    }};        // 使用刚指定的配置项和数据显示图表。        myChart.setOption(option);</script></p><h2 id="桑基图"><a href="#桑基图" class="headerlink" title="桑基图"></a>桑基图</h2><p><pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown">&#123;% echarts 400 '90%'&#125;&#123;    tooltip: &#123;&#125;,    series: &#123;        type: 'sankey',        layout: 'none',        focusNodeAdjacency: 'allEdges',        data: [&#123;            name: 'a'        &#125;, &#123;            name: 'b'        &#125;, &#123;            name: 'a1'        &#125;, &#123;            name: 'a2'        &#125;, &#123;            name: 'b1'        &#125;, &#123;            name: 'c'        &#125;],        links: [&#123;            source: 'a',            target: 'a1',            value: 5        &#125;, &#123;            source: 'a',            target: 'a2',            value: 3        &#125;, &#123;            source: 'b',            target: 'b1',            value: 8        &#125;, &#123;            source: 'a',            target: 'b1',            value: 3        &#125;, &#123;            source: 'b1',            target: 'a1',            value: 1        &#125;, &#123;            source: 'b1',            target: 'c',            value: 2        &#125;]    &#125;&#125;;&#123;% endecharts %&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p>显示效果如下所示：</p><p><div id="echarts8290" style="width: 90%;height: 400px;margin: 0 auto"></div><script type="text/javascript">        // 基于准备好的dom，初始化echarts实例        var myChart = echarts.init(document.getElementById('echarts8290'));        // 指定图表的配置项和数据        var option = {    tooltip: {},    series: {        type: 'sankey',        layout: 'none',        focusNodeAdjacency: 'allEdges',        data: [{            name: 'a'        }, {            name: 'b'        }, {            name: 'a1'        }, {            name: 'a2'        }, {            name: 'b1'        }, {            name: 'c'        }],        links: [{            source: 'a',            target: 'a1',            value: 5        }, {            source: 'a',            target: 'a2',            value: 3        }, {            source: 'b',            target: 'b1',            value: 8        }, {            source: 'a',            target: 'b1',            value: 3        }, {            source: 'b1',            target: 'a1',            value: 1        }, {            source: 'b1',            target: 'c',            value: 2        }]    }};        // 使用刚指定的配置项和数据显示图表。        myChart.setOption(option);</script></p><h2 id="漏斗图"><a href="#漏斗图" class="headerlink" title="漏斗图"></a>漏斗图</h2><p><pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown">&#123;% echarts 400 '90%'&#125;&#123;    tooltip: &#123;        trigger: 'item',        formatter: "&#123;a&#125; <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">/></span></span>&#123;b&#125; : &#123;c&#125;%"    &#125;,    legend: &#123;        data: ['展现','点击','访问','咨询','订单']    &#125;,    series: [        &#123;            name:'漏斗图',            type:'funnel',            left: '10%',            top: 60,            //x2: 80,            bottom: 60,            width: '80%',            // height: &#123;totalHeight&#125; - y - y2,            min: 0,            max: 100,            minSize: '0%',            maxSize: '100%',            sort: 'descending',            gap: 2,            label: &#123;                show: true,                position: 'inside'            &#125;,            labelLine: &#123;                length: 10,                lineStyle: &#123;                    width: 1,                    type: 'solid'                &#125;            &#125;,            itemStyle: &#123;                borderColor: '#fff',                borderWidth: 1            &#125;,            data: [                &#123;value: 60, name: '访问'&#125;,                &#123;value: 40, name: '咨询'&#125;,                &#123;value: 20, name: '订单'&#125;,                &#123;value: 80, name: '点击'&#125;,                &#123;value: 100, name: '展现'&#125;            ]        &#125;    ]&#125;;&#123;% endecharts %&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p>显示效果如下所示：</p><p><div id="echarts3159" style="width: 90%;height: 400px;margin: 0 auto"></div><script type="text/javascript">        // 基于准备好的dom，初始化echarts实例        var myChart = echarts.init(document.getElementById('echarts3159'));        // 指定图表的配置项和数据        var option = {    tooltip: {        trigger: 'item',        formatter: "{a} <br/>{b} : {c}%"    },    legend: {        data: ['展现','点击','访问','咨询','订单']    },    series: [        {            name:'漏斗图',            type:'funnel',            left: '10%',            top: 60,            //x2: 80,            bottom: 60,            width: '80%',            // height: {totalHeight} - y - y2,            min: 0,            max: 100,            minSize: '0%',            maxSize: '100%',            sort: 'descending',            gap: 2,            label: {                show: true,                position: 'inside'            },            labelLine: {                length: 10,                lineStyle: {                    width: 1,                    type: 'solid'                }            },            itemStyle: {                borderColor: '#fff',                borderWidth: 1            },            data: [                {value: 60, name: '访问'},                {value: 40, name: '咨询'},                {value: 20, name: '订单'},                {value: 80, name: '点击'},                {value: 100, name: '展现'}            ]        }    ]};        // 使用刚指定的配置项和数据显示图表。        myChart.setOption(option);</script></p><h2 id="仪表盘"><a href="#仪表盘" class="headerlink" title="仪表盘"></a>仪表盘</h2><p><pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown">&#123;% echarts 400 '90%'&#125;&#123;    tooltip: &#123;        formatter: '&#123;a&#125; <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">/></span></span>&#123;b&#125; : &#123;c&#125;%'    &#125;,    series: [        &#123;            name: '业务指标',            type: 'gauge',            detail: &#123;formatter: '&#123;value&#125;%'&#125;,            data: [&#123;value: 88.88, name: '完成率'&#125;]        &#125;    ]&#125;;&#123;% endecharts %&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p>显示效果如下所示：</p><p><div id="echarts2723" style="width: 90%;height: 400px;margin: 0 auto"></div><script type="text/javascript">        // 基于准备好的dom，初始化echarts实例        var myChart = echarts.init(document.getElementById('echarts2723'));        // 指定图表的配置项和数据        var option = {    tooltip: {        formatter: '{a} <br/>{b} : {c}%'    },    series: [        {            name: '业务指标',            type: 'gauge',            detail: {formatter: '{value}%'},            data: [{value: 88.88, name: '完成率'}]        }    ]};        // 使用刚指定的配置项和数据显示图表。        myChart.setOption(option);</script></p><h1 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h1><p>如果你想了解更多，可以查看 ECharts 的 <a href="https://echarts.apache.org/en/index.html">英文文档</a> 或者 <a href="https://echarts.apache.org/zh/index.html">中文文档</a>，更多的实例和属性设置都可以找到，也可以在 ECharts 官网配置好图表属性后再引入到自己的 Hexo 文档中。</p>]]></content>
      
      
      <categories>
          
          <category> 教程笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Hexo </tag>
            
            <tag> ECharts </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>在 Hexo 中插入 Chart 动态图表</title>
      <link href="post/a6e75a2b.html"/>
      <url>post/a6e75a2b.html</url>
      
        <content type="html"><![CDATA[<p><div class="note info simple"><p>文章来源：<br>  作者: <a href="https://github.com/Shen-Yu">Shen-Yu</a><br>  链接: <a href="https://shen-yu.gitee.io/2020/chartjs/">https://shen-yu.gitee.io/2020/chartjs/</a><br>  来源: <a href="https://shen-yu.gitee.io/">岛</a><br>  著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。</p></div></p><h1 id="Chartjs-简介"><a href="#Chartjs-简介" class="headerlink" title="Chartjs 简介"></a>Chartjs 简介</h1><p><a href="https://chartjs.bootcss.com/">Chartjs</a> 是一款简单优雅的数据可视化工具，对比其他图表库如 <a href="https://echarts.apache.org/">ECharts</a>、<a href="https://www.highcharts.com/">Highcharts</a>、<a href="https://c3js.org/">C3</a>、<a href="http://www.flotcharts.org/">Flot</a>、<a href="https://www.amcharts.com/javascript-charts/">amCharts</a> 等，它的画面效果、动态效果都更精致，它的 <a href="https://chartjs.bootcss.com/">文档首页</a> 就透出一股小清新，基于 HTML5 Canvas，它拥有更好的性能且响应式，基本满足了一般数据展示的需要，包括折线图，条形图，饼图，散点图，雷达图，极地图，甜甜圈图等。</p><h1 id="Hexo-中的-Chartjs"><a href="#Hexo-中的-Chartjs" class="headerlink" title="Hexo 中的 Chartjs"></a>Hexo 中的 Chartjs</h1><p>为了方便在 Hexo 中使用这么漂亮的图表库，我自己写了一个 Hexo 的 <a href="https://github.com/Shen-Yu/hexo-tag-chart">Chartjs</a> 插件。插件的安装和使用非常的简单，只需要进入博客目录，然后打开命令行，用 <code>npm</code> 安装一下：</p><p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">npm install hexo-tag-chart --save<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><p>之后在文章内使用 <code>chart</code> 的 <code>tag</code> 就可以了</p><p><pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown">&#123;% chart 90% 300 %&#125;\\TODO option goes here&#123;% endchart %&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></p><p>其中 <code>chart</code> 是标签名，<code>endchart</code> 是结束标签，不需要更改，<code>90%</code> 是图表容器的相对宽度，默认是 <code>100%</code>，<code>300</code> 是图表容器的高度，默认是按正常比例缩放的，你可以通过设置 <code>options</code> 里面的 <code>aspectRatio</code> 属性来调整宽高比例，另外还有许多属性可以自定义，你可以查看 <a href="https://chartjs.bootcss.com/docs/">官方文档</a>。在标签之间的部分，需要自己填充的图表数据和属性。</p><h1 id="图表示例"><a href="#图表示例" class="headerlink" title="图表示例"></a>图表示例</h1><p>现在你已经基本学会了在 Hexo 中插入 Chart 图表了，下面再展示一些基本的图表，更多炫酷的图表可以自己去尝试一下。</p><h2 id="柱状图、条形图"><a href="#柱状图、条形图" class="headerlink" title="柱状图、条形图"></a>柱状图、条形图</h2><p><pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown">&#123;% chart 90% 300 %&#125;&#123;  type: 'bar',  data: &#123;    labels: ['January', 'February', 'March', 'April', 'May', 'June', 'July'],    datasets: [&#123;      label: 'First Dataset',      data: [65, 59, 80, 81, 56, 55, 40],      fill: false,      backgroundColor: ['rgba(255, 99, 132, 0.5)', 'rgba(255, 159, 64, 0.5)', 'rgba(255, 205, 86, 0.5)', 'rgba(75, 192, 192, 0.5)', 'rgba(54, 162, 235, 0.5)', 'rgba(153, 102, 255, 0.5)', 'rgba(201, 203, 207, 0.5)'],      borderColor: ['rgb(255, 99, 132)', 'rgb(255, 159, 64)', 'rgb(255, 205, 86)', 'rgb(75, 192, 192)', 'rgb(54, 162, 235)', 'rgb(153, 102, 255)', 'rgb(201, 203, 207)'],      borderWidth: 1    &#125;]  &#125;,  options: &#123;    scales: &#123;      yAxes: [&#123;        ticks: &#123;          beginAtZero: true        &#125;      &#125;]    &#125;  &#125;&#125;&#123;% endchart %&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p>显示效果如下所示：</p><p><div style="width: 90%;margin: 0 auto">    <canvas id="chart9411" style="height: 300px"></canvas></div><script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.3/dist/Chart.min.js"></script><script type="text/javascript">    var ctx = document.getElementById('chart9411').getContext('2d');    var options = {  type: 'bar',  data: {    labels: ['January', 'February', 'March', 'April', 'May', 'June', 'July'],    datasets: [{      label: 'First Dataset',      data: [65, 59, 80, 81, 56, 55, 40],      fill: false,      backgroundColor: ['rgba(255, 99, 132, 0.5)', 'rgba(255, 159, 64, 0.5)', 'rgba(255, 205, 86, 0.5)', 'rgba(75, 192, 192, 0.5)', 'rgba(54, 162, 235, 0.5)', 'rgba(153, 102, 255, 0.5)', 'rgba(201, 203, 207, 0.5)'],      borderColor: ['rgb(255, 99, 132)', 'rgb(255, 159, 64)', 'rgb(255, 205, 86)', 'rgb(75, 192, 192)', 'rgb(54, 162, 235)', 'rgb(153, 102, 255)', 'rgb(201, 203, 207)'],      borderWidth: 1    }]  },  options: {    scales: {      yAxes: [{        ticks: {          beginAtZero: true        }      }]    }  }};    new Chart(ctx, options);</script></p><h2 id="折线图"><a href="#折线图" class="headerlink" title="折线图"></a>折线图</h2><p><pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown">&#123;% chart 90% 300 %&#125;&#123;  type: 'line',  data: &#123;    labels: ['January', 'February', 'March', 'April', 'May', 'June', 'July'],    datasets: [&#123;      label: 'First dataset',      backgroundColor: 'rgb(255, 99, 132)',      borderColor: 'rgb(255, 99, 132)',      data: [0, 10, 5, 2, 20, 30, 45]      &#125;]  &#125;,  options: &#123;    responsive: true,    title: &#123;    display: true,    text: 'Chart.js Line Chart'    &#125;  &#125;&#125;&#123;% endchart %&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p>显示效果如下所示：</p><p><div style="width: 90%;margin: 0 auto">    <canvas id="chart6810" style="height: 300px"></canvas></div><script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.3/dist/Chart.min.js"></script><script type="text/javascript">    var ctx = document.getElementById('chart6810').getContext('2d');    var options = {  type: 'line',  data: {    labels: ['January', 'February', 'March', 'April', 'May', 'June', 'July'],    datasets: [{      label: 'First dataset',      backgroundColor: 'rgb(255, 99, 132)',      borderColor: 'rgb(255, 99, 132)',      data: [0, 10, 5, 2, 20, 30, 45]      }]  },  options: {    responsive: true,    title: {    display: true,    text: 'Chart.js Line Chart'    }  }};    new Chart(ctx, options);</script></p><h2 id="环形图、饼状图"><a href="#环形图、饼状图" class="headerlink" title="环形图、饼状图"></a>环形图、饼状图</h2><p><pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown">&#123;% chart 90% 300 %&#125;&#123;  type: 'pie',  data: &#123;    labels: ['Red', 'Blue', 'Yellow'],    datasets: [&#123;      label: 'First Dataset',      data: [300, 50, 100],      backgroundColor: ['rgb(255, 99, 132)', 'rgb(54, 162, 235)', 'rgb(255, 205, 86)']    &#125;]  &#125;&#125;&#123;% endchart %&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p>显示效果如下所示：</p><p><div style="width: 90%;margin: 0 auto">    <canvas id="chart4597" style="height: 300px"></canvas></div><script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.3/dist/Chart.min.js"></script><script type="text/javascript">    var ctx = document.getElementById('chart4597').getContext('2d');    var options = {  type: 'pie',  data: {    labels: ['Red', 'Blue', 'Yellow'],    datasets: [{      label: 'First Dataset',      data: [300, 50, 100],      backgroundColor: ['rgb(255, 99, 132)', 'rgb(54, 162, 235)', 'rgb(255, 205, 86)']    }]  }};    new Chart(ctx, options);</script></p><h2 id="雷达图"><a href="#雷达图" class="headerlink" title="雷达图"></a>雷达图</h2><p><pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown">&#123;% chart 90% 300 %&#125;&#123;  type: 'radar',  data: &#123;    labels: ['Eating', 'Drinking', 'Sleeping', 'Designing', 'Coding', 'Cycling', 'Running'],    datasets: [&#123;      label: 'First Dataset',      data: [65, 59, 90, 81, 56, 55, 40],      fill: true,      backgroundColor: 'rgba(255, 99, 132, 0.2)',      borderColor: 'rgb(255, 99, 132)',      pointBackgroundColor: 'rgb(255, 99, 132)',      pointBorderColor: '#fff',      pointHoverBackgroundColor: '#fff',      pointHoverBorderColor: 'rgb(255, 99, 132)'    &#125;, &#123;      label: 'Second Dataset',      data: [28, 48, 40, 19, 96, 27, 100],      fill: true,      backgroundColor: 'rgba(54, 162, 235, 0.2)',      borderColor: 'rgb(54, 162, 235)',      pointBackgroundColor: 'rgb(54, 162, 235)',      pointBorderColor: '#fff',      pointHoverBackgroundColor: '#fff',      pointHoverBorderColor: 'rgb(54, 162, 235)'    &#125;]  &#125;,  options: &#123;    elements: &#123;      line: &#123;        tension: 0,        borderWidth: 3      &#125;    &#125;  &#125;&#125;&#123;% endchart %&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p>显示效果如下所示：</p><p><div style="width: 90%;margin: 0 auto">    <canvas id="chart7582" style="height: 300px"></canvas></div><script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.3/dist/Chart.min.js"></script><script type="text/javascript">    var ctx = document.getElementById('chart7582').getContext('2d');    var options = {  type: 'radar',  data: {    labels: ['Eating', 'Drinking', 'Sleeping', 'Designing', 'Coding', 'Cycling', 'Running'],    datasets: [{      label: 'First Dataset',      data: [65, 59, 90, 81, 56, 55, 40],      fill: true,      backgroundColor: 'rgba(255, 99, 132, 0.2)',      borderColor: 'rgb(255, 99, 132)',      pointBackgroundColor: 'rgb(255, 99, 132)',      pointBorderColor: '#fff',      pointHoverBackgroundColor: '#fff',      pointHoverBorderColor: 'rgb(255, 99, 132)'    }, {      label: 'Second Dataset',      data: [28, 48, 40, 19, 96, 27, 100],      fill: true,      backgroundColor: 'rgba(54, 162, 235, 0.2)',      borderColor: 'rgb(54, 162, 235)',      pointBackgroundColor: 'rgb(54, 162, 235)',      pointBorderColor: '#fff',      pointHoverBackgroundColor: '#fff',      pointHoverBorderColor: 'rgb(54, 162, 235)'    }]  },  options: {    elements: {      line: {        tension: 0,        borderWidth: 3      }    }  }};    new Chart(ctx, options);</script></p><h2 id="气泡图"><a href="#气泡图" class="headerlink" title="气泡图"></a>气泡图</h2><p><pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown">&#123;% chart 90% 300 %&#125;&#123;  type: 'bubble',  data: &#123;    datasets: [&#123;      label: 'First Dataset',      data: [&#123;        x: 20,        y: 30,        r: 6      &#125;, &#123;        x: 25,        y: 20,        r: 8      &#125;, &#123;        x: 32,        y: 6,        r: 7      &#125;, &#123;        x: 35,        y: 26,        r: 9      &#125;, &#123;        x: 40,        y: 10,        r: 5      &#125;],      backgroundColor: 'rgb(255, 99, 132)'    &#125;]  &#125;&#125;&#123;% endchart %&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p>显示效果如下所示：</p><p><div style="width: 90%;margin: 0 auto">    <canvas id="chart6642" style="height: 300px"></canvas></div><script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.3/dist/Chart.min.js"></script><script type="text/javascript">    var ctx = document.getElementById('chart6642').getContext('2d');    var options = {  type: 'bubble',  data: {    datasets: [{      label: 'First Dataset',      data: [{        x: 20,        y: 30,        r: 6      }, {        x: 25,        y: 20,        r: 8      }, {        x: 32,        y: 6,        r: 7      }, {        x: 35,        y: 26,        r: 9      }, {        x: 40,        y: 10,        r: 5      }],      backgroundColor: 'rgb(255, 99, 132)'    }]  }};    new Chart(ctx, options);</script></p><h2 id="散点图"><a href="#散点图" class="headerlink" title="散点图"></a>散点图</h2><p><pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown">&#123;% chart 90% 300 %&#125;&#123;  type: 'scatter',  data: &#123;    labels: ['January', 'February', 'March', 'April', 'May', 'June', 'July'],    datasets: [&#123;      label: 'First dataset',      borderColor: 'rgb(255, 99, 132)',      backgroundColor: 'rgb(255, 99, 132)',      data: [&#123;        x: 12,        y: 45,      &#125;, &#123;        x: 12,        y: 13,      &#125;, &#123;        x: 56,        y: 3,      &#125;, &#123;        x: 5,        y: 87,      &#125;, &#123;        x: 43,        y: 76,      &#125;, &#123;        x: 34,        y: 8,      &#125;, &#123;        x: 9,        y: 53,      &#125;]    &#125;, &#123;      label: 'Second dataset',      borderColor: 'rgb(54, 162, 235)',      backgroundColor: 'rgb(54, 162, 235)',      data: [&#123;        x: 56,        y: 12,      &#125;, &#123;        x: 7,        y: 12,      &#125;, &#123;        x: 87,        y: 24,      &#125;, &#123;        x: 34,        y: 45,      &#125;, &#123;        x: 65,        y: 27,      &#125;, &#123;        x: 8,        y: 37,      &#125;, &#123;        x: 24,        y: 89,      &#125;]    &#125;],    options: &#123;      title: &#123;        display: true,        text: 'Chart.js Scatter Chart'      &#125;,    &#125;  &#125;&#125;&#123;% endchart %&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p>显示效果如下所示：</p><p><div style="width: 90%;margin: 0 auto">    <canvas id="chart7660" style="height: 300px"></canvas></div><script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.3/dist/Chart.min.js"></script><script type="text/javascript">    var ctx = document.getElementById('chart7660').getContext('2d');    var options = {  type: 'scatter',  data: {    labels: ['January', 'February', 'March', 'April', 'May', 'June', 'July'],    datasets: [{      label: 'First dataset',      borderColor: 'rgb(255, 99, 132)',      backgroundColor: 'rgb(255, 99, 132)',      data: [{        x: 12,        y: 45,      }, {        x: 12,        y: 13,      }, {        x: 56,        y: 3,      }, {        x: 5,        y: 87,      }, {        x: 43,        y: 76,      }, {        x: 34,        y: 8,      }, {        x: 9,        y: 53,      }]    }, {      label: 'Second dataset',      borderColor: 'rgb(54, 162, 235)',      backgroundColor: 'rgb(54, 162, 235)',      data: [{        x: 56,        y: 12,      }, {        x: 7,        y: 12,      }, {        x: 87,        y: 24,      }, {        x: 34,        y: 45,      }, {        x: 65,        y: 27,      }, {        x: 8,        y: 37,      }, {        x: 24,        y: 89,      }]    }],    options: {      title: {        display: true,        text: 'Chart.js Scatter Chart'      },    }  }};    new Chart(ctx, options);</script></p><h2 id="混合图"><a href="#混合图" class="headerlink" title="混合图"></a>混合图</h2><p><pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown">&#123;% chart 90% 300 %&#125;&#123;  type: 'bar',  data: &#123;    labels: ['January', 'February', 'March', 'April'],    datasets: [&#123;      label: 'Bar Dataset',      data: [10, 20, 30, 40],      borderColor: 'rgb(255, 99, 132)',      backgroundColor: 'rgba(255, 99, 132)'    &#125;, &#123;      label: 'Line Dataset',      data: [20, 30, 40, 50],      type: 'line',      fill: false,      borderColor: 'rgb(54, 162, 235)'    &#125;]  &#125;,  options: &#123;    scales: &#123;      yAxes: [&#123;        ticks: &#123;          beginAtZero: true        &#125;      &#125;]    &#125;  &#125;&#125;&#123;% endchart %&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p>显示效果如下所示：</p><p><div style="width: 90%;margin: 0 auto">    <canvas id="chart3722" style="height: 300px"></canvas></div><script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.3/dist/Chart.min.js"></script><script type="text/javascript">    var ctx = document.getElementById('chart3722').getContext('2d');    var options = {  type: 'bar',  data: {    labels: ['January', 'February', 'March', 'April'],    datasets: [{      label: 'Bar Dataset',      data: [10, 20, 30, 40],      borderColor: 'rgb(255, 99, 132)',      backgroundColor: 'rgba(255, 99, 132)'    }, {      label: 'Line Dataset',      data: [20, 30, 40, 50],      type: 'line',      fill: false,      borderColor: 'rgb(54, 162, 235)'    }]  },  options: {    scales: {      yAxes: [{        ticks: {          beginAtZero: true        }      }]    }  }};    new Chart(ctx, options);</script></p><h1 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h1><p>如果你想了解更多，<a href="https://www.chartjs.org/">官方文档</a> 是不二之选。如果你英语不好，那么可以看看 <a href="https://chartjs.bootcss.com/">中文文档</a>，所有的例子和属性都能在里面找到，祝你玩得开心。</p>]]></content>
      
      
      <categories>
          
          <category> 教程笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Hexo </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Markdown 基本语法</title>
      <link href="post/c894e39a.html"/>
      <url>post/c894e39a.html</url>
      
        <content type="html"><![CDATA[<h1 id="Markdown-应用"><a href="#Markdown-应用" class="headerlink" title="Markdown 应用"></a>Markdown 应用</h1><ul><li>Markdown 是一种轻量级标记语言，它允许人们使用易读易写的纯文本格式编写文档。</li><li>Markdown 语言在 2004 由约翰·格鲁伯（英语：John Gruber）创建。</li><li>Markdown 编写的文档可以导出 HTML、Word、图像、PDF、Epub 等多种格式的文档。</li><li>Markdown 编写的文档后缀为 .md 或 .markdown。</li></ul><p>Markdown 能被使用来撰写电子书，如：Gitbook。</p><p>当前许多网站都广泛使用 Markdown 来撰写帮助文档或是用于论坛上发表消息。例如：GitHub、简书、reddit、Diaspora、Stack Exchange、OpenStreetMap 、SourceForge 等。</p><h1 id="Markdown-标题"><a href="#Markdown-标题" class="headerlink" title="Markdown 标题"></a>Markdown 标题</h1><p>Markdown 标题有两种格式。</p><ol><li><p>使用 <code>=</code> 和 <code>-</code> 标记一级和二级标题</p><p>= 和 - 标记语法格式如下：</p><p><pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown"><span class="token title important">一级标题<span class="token punctuation">=======</span></span><span class="token title important">二级标题<span class="token punctuation">-------</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p><!-- 显示效果如下所示：> 一级标题> =======> 二级标题> ------- --></p></li><li><p>使用 <code>#</code> 号标记</p><p>使用 <code>#</code> 号克表示 1-6 级标题，一级标题对应一个 <code>#</code> 号，二级标题对应两个 <code>#</code> 号，以此类推。</p><p> <pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown"><span class="token title important"><span class="token punctuation">#</span> 一级标题</span><span class="token title important"><span class="token punctuation">##</span> 二级标题</span><span class="token title important"><span class="token punctuation">###</span> 三级标题</span><span class="token title important"><span class="token punctuation">####</span> 四级标题</span><span class="token title important"><span class="token punctuation">#####</span> 五级标题</span><span class="token title important"><span class="token punctuation">######</span> 六级标题</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p> <!-- 显示效果如下所示：> # 一级标题> ## 二级标题> ### 三级标题> #### 四级标题> ##### 五级标题> ###### 六级标题 --></p></li></ol><h1 id="Markdown-段落"><a href="#Markdown-段落" class="headerlink" title="Markdown 段落"></a>Markdown 段落</h1><h2 id="段落"><a href="#段落" class="headerlink" title="段落"></a>段落</h2><p>Markdown 段落没有特殊的格式，直接编写文字就好，段落的换行是使用两个空格以上加上回车。</p><p><pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown">Markdown<span class="token url">[<span class="token content">空格</span>][<span class="token variable">空格</span>]</span>[回车]Markdown<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></p><p>当然也可以在段落后面使用一个空行表示重新开始一个段落</p><p><pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown">Markdown[空行]Markdown<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></p><p>还可以使用 <code>&lt;br/&gt;</code> 实现强制换行</p><p>显示效果如下所示：</p><blockquote><p>Markdown<br>Markdown</p></blockquote><h2 id="字体"><a href="#字体" class="headerlink" title="字体"></a>字体</h2><p>Markdown 可以使用以下几种字体：</p><p><pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown"><span class="token italic"><span class="token punctuation">*</span><span class="token content">斜体文本</span><span class="token punctuation">*</span></span><span class="token italic"><span class="token punctuation">_</span><span class="token content">斜体文本</span><span class="token punctuation">_</span></span><span class="token bold"><span class="token punctuation">**</span><span class="token content">粗体文本</span><span class="token punctuation">**</span></span><span class="token bold"><span class="token punctuation">__</span><span class="token content">粗体文本</span><span class="token punctuation">__</span></span><span class="token bold"><span class="token punctuation">**</span><span class="token content"><span class="token italic"><span class="token punctuation">*</span><span class="token content">斜粗体文本</span><span class="token punctuation">*</span></span></span><span class="token punctuation">**</span></span><span class="token bold"><span class="token punctuation">__</span><span class="token content"><span class="token italic"><span class="token punctuation">_</span><span class="token content">斜粗体文本</span><span class="token punctuation">_</span></span></span><span class="token punctuation">__</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p>显示效果如下所示：</p><blockquote><p><em>斜体文本</em><br><em>斜体文本</em>  </p><p><strong>粗体文本</strong><br><strong>粗体文本</strong></p><p><strong><em>斜粗体文本</em></strong><br><strong><em>斜粗体文本</em></strong></p></blockquote><h2 id="分隔线"><a href="#分隔线" class="headerlink" title="分隔线"></a>分隔线</h2><p>可以在一行中使用三个以上的星号 <code>*</code>、减号 <code>-</code>、底线 <code>_</code> 来建立一个分隔线，行内不能有其他东西，也可以在星号 <code>*</code>、减号 <code>-</code>、底线 <code>_</code> 中间插入空格。下面每种写法都可以建立分隔线：</p><p><pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown"><span class="token hr punctuation">---</span><span class="token hr punctuation">***</span>___<span class="token hr punctuation">- - -</span><span class="token hr punctuation">* * *</span><span class="token italic"><span class="token punctuation">_</span><span class="token content"> </span><span class="token punctuation">_</span></span> _<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p>显示效果如下所示：</p><blockquote><hr><hr><hr><hr><hr><hr></blockquote><h2 id="删除线"><a href="#删除线" class="headerlink" title="删除线"></a>删除线</h2><p>如果段落上的文字要添加删除线，只需要在文字的两端加上两个波浪线 <code>~~</code> 即可：</p><p><pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown">正常文本<span class="token strike"><span class="token punctuation">~~</span><span class="token content">删除文本</span><span class="token punctuation">~~</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></p><p>显示效果如下所示：</p><blockquote><p>正常文本<br><del>删除文本</del></p></blockquote><h2 id="下划线"><a href="#下划线" class="headerlink" title="下划线"></a>下划线</h2><p>下划线可以通过 HTML 的 <code>&lt;u&gt;</code> 标签来实现：</p><p><pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>u</span><span class="token punctuation">></span></span>下划线文本<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>u</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><p>显示效果如下所示：</p><blockquote><p><u>下划线文本</u></p></blockquote><h2 id="脚注"><a href="#脚注" class="headerlink" title="脚注"></a>脚注</h2><p>脚注是对文本的补充说明，Markdown 脚注的格式如下：</p><p><pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown">[^ 要脚注的文本]Markdown[^ Markdown]  [^ Markdown ]：一种轻量级标记语言<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></p><p>显示效果如下所示：</p><blockquote><p>Markdown<sup><a href="#fn_ Markdown" id="reffn_ Markdown"> Markdown</a></sup>。</p><blockquote id="fn_ Markdown"><sup> Markdown</sup>. 一种轻量级标记语言<a href="#reffn_ Markdown" title="Jump back to footnote [ Markdown] in the text."> &#8617;</a></blockquote></blockquote><h1 id="Markdown-列表"><a href="#Markdown-列表" class="headerlink" title="Markdown 列表"></a>Markdown 列表</h1><p>Markdown 支持有序列表和无序列表。</p><p>无序列表使用星号 <code>*</code>、加号 <code>+</code>、减号 <code>-</code> 作为列表标记，这些标记后面都要添加一个空格，然后再填写内容：</p><p><pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown"><span class="token list punctuation">*</span> 第一项<span class="token list punctuation">*</span> 第二项<span class="token list punctuation">*</span> 第三项<span class="token list punctuation">+</span> 第一项<span class="token list punctuation">+</span> 第二项<span class="token list punctuation">+</span> 第三项<span class="token list punctuation">-</span> 第一项<span class="token list punctuation">-</span> 第二项<span class="token list punctuation">-</span> 第三项<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p>显示效果如下所示：</p><blockquote><ul><li>第一项</li><li>第二项</li><li>第三项</li></ul><ul><li>第一项</li><li>第二项</li><li>第三项</li></ul><ul><li>第一项</li><li>第二项</li><li>第三项</li></ul></blockquote><p>有序列表使用数字并加上 <code>.</code> 号来表示，如：</p><p><pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown"><span class="token list punctuation">1.</span> 第一项<span class="token list punctuation">2.</span> 第二项<span class="token list punctuation">3.</span> 第三项<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></p><p>显示效果如下所示：</p><blockquote><ol><li>第一项</li><li>第二项</li><li>第三项</li></ol></blockquote><p>列表嵌套只需要在子列表中的选项前面添加四个空格即可：</p><p><pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown"><span class="token list punctuation">1.</span> 第一项：  <span class="token list punctuation">-</span> 第一项嵌套的第一个元素  <span class="token list punctuation">-</span> 第一项嵌套的第二个元素<span class="token list punctuation">2.</span> 第二项：  <span class="token list punctuation">1.</span> 第二项嵌套的第一个元素  <span class="token list punctuation">2.</span> 第二项嵌套的第二个元素<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p>显示效果如下所示：</p><blockquote><ol><li>第一项：<ul><li>第一项嵌套的第一个元素</li><li>第一项嵌套的第二个元素</li></ul></li><li>第二项：<ol><li>第二项嵌套的第一个元素</li><li>第二项嵌套的第二个元素</li></ol></li></ol></blockquote><h1 id="Markdown-区块"><a href="#Markdown-区块" class="headerlink" title="Markdown 区块"></a>Markdown 区块</h1><p>Markdown 区块引用是在段落开头使用 <code>&gt;</code> 符号，然后后面紧跟一个空格符号：</p><p><pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown"><span class="token blockquote punctuation">></span> 区块引用<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><p>显示效果如下所示：</p><blockquote><p>区块引用</p></blockquote><p>另外区块是可以嵌套的，一个 <code>&gt;</code> 符号是最外层，两个 <code>&gt;</code> 符号是第一层嵌套，以此类推：</p><p><pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown"><span class="token blockquote punctuation">></span> 最外层<span class="token blockquote punctuation">> ></span> 第一层嵌套<span class="token blockquote punctuation">> > ></span> 第二层嵌套<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></p><p>显示效果如下所示：</p><blockquote><p>最外层</p><blockquote><p>第一层嵌套</p><blockquote><p>第二层嵌套</p></blockquote></blockquote></blockquote><p><br></p><p><strong>区块中使用列表</strong></p><p>区块中使用列表实例如下：</p><p><pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown"><span class="token blockquote punctuation">></span> 区块中使用列表<span class="token blockquote punctuation">></span> <span class="token list punctuation">1.</span> 第一项<span class="token blockquote punctuation">></span> <span class="token list punctuation">2.</span> 第二项<span class="token blockquote punctuation">></span> <span class="token list punctuation">+</span> 第一项<span class="token blockquote punctuation">></span> <span class="token list punctuation">+</span> 第二项<span class="token blockquote punctuation">></span> <span class="token list punctuation">+</span> 第三项<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p>显示效果如下所示：</p><blockquote><p>区块中使用列表</p><ol><li>第一项</li><li>第二项</li></ol><ul><li>第一项</li><li>第二项</li><li>第三项</li></ul></blockquote><p><br></p><p><strong>列表中使用区块</strong></p><p>如果要在列表项目内放进区块，那么就需要在 <code>&gt;</code> 前添加四个空格的缩进。</p><p>区块中使用列表实例如下：</p><p><pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown"><span class="token list punctuation">*</span> 第一项    > 列表中使用区块<span class="token list punctuation">*</span> 第二项<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></p><p>显示效果如下所示：</p><ul><li>第一项<blockquote><p>列表中使用区块</p></blockquote></li><li>第二项</li></ul><h1 id="Markdown-代码"><a href="#Markdown-代码" class="headerlink" title="Markdown 代码"></a>Markdown 代码</h1><p>如果是段落上的一个函数或片段的代码可以用反引号 <code>` </code> 或用三个反引号 <code>``` </code> 把它包起来例如：</p><p><pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown"><span class="token code keyword">` print `</span> 函数<span class="token code keyword">``` print ``</span>` 函数<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></p><p>显示效果如下所示：</p><blockquote><p><code>print</code> 函数<br><code>print</code> 函数</p></blockquote><p><br></p><p><strong>代码区块</strong></p><p>代码区块使用 4 个空格或者一个制表符（Tab 键）：</p><p><pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown"><span class="token url">[<span class="token content">空格</span>][<span class="token variable">空格</span>]</span><span class="token url">[<span class="token content">空格</span>][<span class="token variable">空格</span>]</span>print("Hello");[Tab]print("World");<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></p><p>显示效果如下所示：</p><blockquote><p>   print(&quot;Hello&quot;);<br>   print(&quot;World&quot;);</p></blockquote><p>你也可以用 <code>``` </code> 包裹一段代码，并指定一种语言（也可以不指定）：</p><p><pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown"><span class="token url">[<span class="token content">```</span>][<span class="token variable">javascript</span>]</span>$(document).ready(function () &#123;    alert('Hello World');&#125;);[```]<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p>显示效果如下所示：</p><blockquote><p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token function">$</span><span class="token punctuation">(</span>document<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ready</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'Hello World'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></p><h1 id="Markdown-链接"><a href="#Markdown-链接" class="headerlink" title="Markdown 链接"></a>Markdown 链接</h1></blockquote><p>链接语法格式如下：</p><p><pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown"><span class="token url">[<span class="token content">链接名称</span>](链接地址)</span>或者<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>链接地址</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></p><p>显示效果如下所示：</p><blockquote><p><a href="https://www.baidu.com/">Baidu</a><br>或者<br><a href="https://www.baidu.com/">https://www.baidu.com/</a></p></blockquote><p><br></p><p><strong>高级链接</strong></p><p>我们可以通过变量来设置一个链接，变量赋值在文档末尾进行：</p><p><pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown">这个链接用 Google 作为网址变量 <span class="token url">[<span class="token content">Google</span>][<span class="token variable">Google</span>]</span>然后在文档的结尾为变量赋值（网址）<span class="token url-reference url"><span class="token punctuation">[</span><span class="token variable">Google</span><span class="token punctuation">]</span><span class="token punctuation">:</span> http://www.google.com/</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></p><p>显示效果如下所示：</p><blockquote><p>这个链接用 Google 作为网址变量 [Google][Google]<br>然后在文档的结尾为变量赋值（网址）</p><p>  [Google]: <a href="http://www.google.com/">http://www.google.com/</a></p></blockquote><h1 id="Markdown-图片"><a href="#Markdown-图片" class="headerlink" title="Markdown 图片"></a>Markdown 图片</h1><p>Markdown 图片语法格式如下：</p><p><pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown"><span class="token url">![<span class="token content">alt 属性文本</span>](图片地址)</span><span class="token url">![<span class="token content">alt 属性文本</span>](图片地址 <span class="token string">"可选标题"</span>)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></p><ul><li>开头一个感叹号 <code>!</code></li><li>接着一个方括号，里面放上图片的替代文字</li><li>接着一个普通括号，里面放上图片的网址，最后还可以用引号包住并加上选择性的 <code>title</code> 属性的文字。</li></ul><p>使用实例：</p><p><pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown"><span class="token url">![<span class="token content">图标</span>](https://www.baidu.com/img/flexible/logo/pc/result.png)</span><span class="token url">![<span class="token content">图标</span>](https://www.baidu.com/img/flexible/logo/pc/result.png <span class="token string">"Baidu"</span>)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></p><p>显示效果如下所示：</p><blockquote><p><img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="https://www.baidu.com/img/flexible/logo/pc/result.png" alt="图标"><br><img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="https://www.baidu.com/img/flexible/logo/pc/result.png" alt="图标" title="Baidu"></p></blockquote><p>当然，也可以像网址那样对图片网址使用变量:</p><p><pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown">这个链接用 Baidu 作为网址变量 <span class="token url">[<span class="token content">Baidu</span>][<span class="token variable">Baidu</span>]</span>。然后在文档的结尾为变量赋值（网址）<span class="token url-reference url"><span class="token punctuation">[</span><span class="token variable">Baidu</span><span class="token punctuation">]</span><span class="token punctuation">:</span> https://www.baidu.com/img/flexible/logo/pc/result.png</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></p><p>显示效果如下所示：</p><blockquote><p>这个链接用 Baidu 作为网址变量 [Baidu][Baidu]。<br>然后在文档的结尾为变量赋值（网址）</p><p>[Baidu]: <a href="https://www.baidu.com/img/flexible/logo/pc/result.png">https://www.baidu.com/img/flexible/logo/pc/result.png</a></p></blockquote><p>Markdown 还没有办法指定图片的高度与宽度，如果你需要的话，你可以使用普通的 <code>&lt;img&gt;</code> 标签。</p><p><pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://www.baidu.com/img/flexible/logo/pc/result.png<span class="token punctuation">"</span></span> <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>30%<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><p>显示效果如下所示：</p><blockquote><p><img src= "https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/images/user/loading.gif" data-lazy-src="https://www.baidu.com/img/flexible/logo/pc/result.png" width="30%"></p></blockquote><h1 id="Markdown-表格"><a href="#Markdown-表格" class="headerlink" title="Markdown 表格"></a>Markdown 表格</h1><p>Markdown 制作表格使用 <code>|</code> 来分隔不同的单元格，使用 <code>-</code> 来分隔表头和其他行。</p><p>语法格式如下：</p><p><pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown"><span class="token table"><span class="token table-header-row"><span class="token punctuation">|</span><span class="token table-header important"> 表头 </span><span class="token punctuation">|</span><span class="token table-header important"> 表头 </span><span class="token punctuation">|</span></span><span class="token table-line"><span class="token punctuation">|</span> <span class="token punctuation">----</span> <span class="token punctuation">|</span> <span class="token punctuation">----</span> <span class="token punctuation">|</span></span><span class="token table-data-rows"><span class="token punctuation">|</span><span class="token table-data"> 单元格 </span><span class="token punctuation">|</span><span class="token table-data"> 单元格 </span><span class="token punctuation">|</span><span class="token punctuation">|</span><span class="token table-data"> 单元格 </span><span class="token punctuation">|</span><span class="token table-data"> 单元格 </span><span class="token punctuation">|</span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></p><p>显示效果如下所示：</p><blockquote><div class="table-container"><table><thead><tr><th>表头</th><th>表头</th></tr></thead><tbody><tr><td>单元格</td><td>单元格</td></tr><tr><td>单元格</td><td>单元格</td></tr></tbody></table></div></blockquote><p><br></p><p><strong>对齐方式</strong></p><p>我们可以设置表格的对齐方式：</p><ul><li><code>-:</code> 设置内容和标题栏居右对齐。</li><li><code>:-</code> 设置内容和标题栏居左对齐。</li><li><code>:-:</code> 设置内容和标题栏居中对齐。</li></ul><p>实例如下：</p><p><pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown"><span class="token table"><span class="token table-header-row"><span class="token punctuation">|</span><span class="token table-header important"> 左对齐 </span><span class="token punctuation">|</span><span class="token table-header important"> 居中对齐 </span><span class="token punctuation">|</span><span class="token table-header important"> 右对齐 </span><span class="token punctuation">|</span></span><span class="token table-line"><span class="token punctuation">|</span> <span class="token punctuation">:-----</span><span class="token punctuation">|</span> <span class="token punctuation">:----:</span> <span class="token punctuation">|</span> <span class="token punctuation">----:</span> <span class="token punctuation">|</span></span><span class="token table-data-rows"><span class="token punctuation">|</span><span class="token table-data"> 单元格 </span><span class="token punctuation">|</span><span class="token table-data"> 单元格 </span><span class="token punctuation">|</span><span class="token table-data"> 单元格 </span><span class="token punctuation">|</span><span class="token punctuation">|</span><span class="token table-data"> 单元格 </span><span class="token punctuation">|</span><span class="token table-data"> 单元格 </span><span class="token punctuation">|</span><span class="token table-data"> 单元格 </span><span class="token punctuation">|</span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></p><p>显示效果如下所示：</p><blockquote><div class="table-container"><table><thead><tr><th style="text-align:left">左对齐</th><th style="text-align:center">居中对齐</th><th style="text-align:right">右对齐</th></tr></thead><tbody><tr><td style="text-align:left">单元格</td><td style="text-align:center">单元格</td><td style="text-align:right">单元格</td></tr><tr><td style="text-align:left">单元格</td><td style="text-align:center">单元格</td><td style="text-align:right">单元格</td></tr></tbody></table></div></blockquote><h1 id="Markdown-高级技巧"><a href="#Markdown-高级技巧" class="headerlink" title="Markdown 高级技巧"></a>Markdown 高级技巧</h1><h2 id="支持的-HTML-元素"><a href="#支持的-HTML-元素" class="headerlink" title="支持的 HTML 元素"></a>支持的 HTML 元素</h2><p>不在 Markdown 涵盖范围之内的标签，都可以直接在文档里面用 HTML 撰写。</p><p>目前支持的 HTML 元素有：<code>&lt;kbd&gt;</code> <code>&lt;b&gt;</code> <code>&lt;i&gt;</code> <code>&lt;em&gt;</code> <code>&lt;sup&gt;</code> <code>&lt;sub&gt;</code> <code>&lt;br&gt;</code> 等 ，如：</p><p><pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown">普通文本：使用 Ctrl+Alt+Del 重启电脑HTML文本：使用 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>kbd</span><span class="token punctuation">></span></span>Ctrl<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>kbd</span><span class="token punctuation">></span></span>+<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>kbd</span><span class="token punctuation">></span></span>Alt<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>kbd</span><span class="token punctuation">></span></span>+<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>kbd</span><span class="token punctuation">></span></span>Del<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>kbd</span><span class="token punctuation">></span></span> 重启电脑<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></p><p>显示效果如下所示：</p><blockquote><p>普通文本：使用 Ctrl+Alt+Del 重启电脑<br>HTML文本：使用 <kbd>Ctrl</kbd>+<kbd>Alt</kbd>+<kbd>Del</kbd> 重启电脑</p></blockquote><h2 id="转义"><a href="#转义" class="headerlink" title="转义"></a>转义</h2><p>Markdown 使用了很多特殊符号来表示特定的意义，如果需要显示特定的符号则需要使用转义字符，Markdown 使用反斜杠转义特殊字符：</p><p><pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown"><span class="token bold"><span class="token punctuation">**</span><span class="token content">文本加粗</span><span class="token punctuation">**</span></span> \*\* 正常显示星号 \*\*<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></p><p>显示效果如下所示：</p><blockquote><p><strong>文本加粗</strong><br>** 正常显示星号 **</p></blockquote><p>Markdown 支持以下这些符号前面加上反斜杠来帮助插入普通的符号：</p><p><pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown">\   反斜线`   反引号<span class="token list punctuation">*</span>   星号_   下划线&#123;&#125;  花括号[]  方括号()  小括号<span class="token title important"><span class="token punctuation">#</span>   井字号</span><span class="token list punctuation">+</span>   加号<span class="token list punctuation">-</span>   减号.   英文句点!   感叹号<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h2 id="公式"><a href="#公式" class="headerlink" title="公式"></a>公式</h2><p>当你需要在编辑器中插入数学公式时，可以使用两个美元符号<code>$$</code>包裹 <code>TeX</code> 或 <code>LaTeX</code> 格式的数学公式来实现。提交后，问答和文章页会根据需要加载 <code>Mathjax</code> 对数学公式进行渲染。如：</p><p><pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown">$$\mathbf&#123;V&#125;_1 \times \mathbf&#123;V&#125;_2 =  \begin&#123;vmatrix&#125; \mathbf&#123;i&#125; &amp; \mathbf&#123;j&#125; &amp; \mathbf&#123;k&#125; \\\frac&#123;\partial X&#125;&#123;\partial u&#125; &amp;  \frac&#123;\partial Y&#125;&#123;\partial u&#125; &amp; 0 \\\frac&#123;\partial X&#125;&#123;\partial v&#125; &amp;  \frac&#123;\partial Y&#125;&#123;\partial v&#125; &amp; 0 \\\end&#123;vmatrix&#125;$&#123;$tep1&#125;&#123;\style&#123;visibility:hidden&#125;&#123;(x+1)(x+1)&#125;&#125;$$<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p>显示效果如下所示：</p><blockquote><script type="math/tex; mode=display">\mathbf{V}_1 \times \mathbf{V}_2 =  \begin{vmatrix} \mathbf{i} & \mathbf{j} & \mathbf{k} \\\frac{\partial X}{\partial u} &  \frac{\partial Y}{\partial u} & 0 \\\frac{\partial X}{\partial v} &  \frac{\partial Y}{\partial v} & 0 \\\end{vmatrix}${$tep1}{\style{visibility:hidden}{(x+1)(x+1)}}</script></blockquote><h2 id="流程图"><a href="#流程图" class="headerlink" title="流程图"></a>流程图</h2><ol><li><p>横向流程图源码格式：</p><p><pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown"><span class="token url">[<span class="token content">```</span>][<span class="token variable">mermaid</span>]</span>graph LRA[方形] -->B(圆角)    B --> C&#123;条件a&#125;    C -->|a=1| D[结果1]    C -->|a=2| E[结果2]    F[横向流程图][```]<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p>显示效果如下所示：</p><p><pre class="mermaid">  graph LRA[方形] -->B(圆角)   B --> C{条件a}   C -->|a=1| D[结果1]   C -->|a=2| E[结果2]   F[横向流程图]</pre></p></li><li><p>竖向流程图源码格式：</p><p><pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown"><span class="token url">[<span class="token content">```</span>][<span class="token variable">mermaid</span>]</span>graph TDA[方形] --> B(圆角)    B --> C&#123;条件a&#125;    C --> |a=1| D[结果1]    C --> |a=2| E[结果2]    F[竖向流程图][```]<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p>显示效果如下所示：</p><p><pre class="mermaid">  graph TDA[方形] --> B(圆角)   B --> C{条件a}   C --> |a=1| D[结果1]   C --> |a=2| E[结果2]   F[竖向流程图]</pre></p></li><li><p>标准流程图源码格式：</p><p><pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown"><span class="token url">[<span class="token content">```</span>][<span class="token variable">flow</span>]</span>st=>start: 开始框op=>operation: 处理框cond=>condition: 判断框(是或否?)sub1=>subroutine: 子流程io=>inputoutput: 输入输出框e=>end: 结束框st->op->condcond(yes)->io->econd(no)->sub1(right)->op[```]<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p>显示效果如下所示：</p><p><div id="flowchart-0" class="flow-chart"></div></p></li><li><p>标准流程图源码格式（横向）：</p><p><pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown"><span class="token url">[<span class="token content">```</span>][<span class="token variable">flow</span>]</span>st=>start: 开始框op=>operation: 处理框cond=>condition: 判断框(是或否?)sub1=>subroutine: 子流程io=>inputoutput: 输入输出框e=>end: 结束框st(right)->op(right)->condcond(yes)->io(bottom)->econd(no)->sub1(right)->op[```]<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p>显示效果如下所示：</p><p><div id="flowchart-1" class="flow-chart"></div></p></li></ol><h2 id="时序图-顺序图"><a href="#时序图-顺序图" class="headerlink" title="时序图(顺序图)"></a>时序图(顺序图)</h2><ol><li><p>UML时序图源码样例：</p><p><pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown"><span class="token url">[<span class="token content">```</span>][<span class="token variable">sequence</span>]</span>对象A->对象B: 对象B你好吗?（请求）Note right of 对象B: 对象B的描述Note left of 对象A: 对象A的描述(提示)对象B-->对象A: 我很好(响应)对象A->对象B: 你真的好吗？[```]<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p>显示效果如下所示：</p><p><div id="sequence-0"></div></p></li><li><p>UML时序图源码复杂样例：</p><p><pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown"><span class="token url">[<span class="token content">```</span>][<span class="token variable">sequence</span>]</span>Title: 标题：复杂使用对象A->对象B: 对象B你好吗?（请求）Note right of 对象B: 对象B的描述Note left of 对象A: 对象A的描述(提示)对象B-->对象A: 我很好(响应)对象B->小三: 你好吗小三-->>对象A: 对象B找我了对象A->对象B: 你真的好吗？Note over 小三, 对象B: 我们是朋友participant CNote right of C: 没人陪我玩[```]<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p>显示效果如下所示：</p><p><div id="sequence-1"></div></p></li><li><p>UML标准时序图样例：</p><p><pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown"><span class="token url">[<span class="token content">```</span>][<span class="token variable">mermaid</span>]</span>%% 时序图例子，-> 直线，-->虚线，->>实线箭头  sequenceDiagram    participant 张三    participant 李四    张三->王五: 王五你好吗？    loop 健康检查        王五->王五: 与疾病战斗    end    Note right of 王五: 合理 食物 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">/></span></span>看医生...    李四-->>张三: 很好!    王五->李四: 你怎么样?    李四-->王五: 很好![```]<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p>显示效果如下所示：</p><p><pre class="mermaid">  %% 时序图例子，-> 直线，-->虚线，->>实线箭头 sequenceDiagram   participant 张三   participant 李四   张三->王五: 王五你好吗？   loop 健康检查       王五->王五: 与疾病战斗   end   Note right of 王五: 合理 食物 <br>看医生...   李四-->>张三: 很好!   王五->李四: 你怎么样?   李四-->王五: 很好!</pre></p></li></ol><h2 id="甘特图"><a href="#甘特图" class="headerlink" title="甘特图"></a>甘特图</h2><p>甘特图样例：</p><p><pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown"><span class="token url">[<span class="token content">```</span>][<span class="token variable">mermaid</span>]</span>%% 语法示例  gantt  dateFormat YYYY-MM-DD  title 软件开发甘特图  section 设计    需求: done, des1, 2014-01-06, 2014-01-08    原型: active, des2, 2014-01-09, 3d    UI设计: des3, after des2, 5d    未来任务: des4, after des3, 5d  section 开发    理解需求: crit, done, 2014-01-06, 24h    设计框架: crit, done, after des2, 2d    开发: crit, active, 3d    未来任务: crit, 5d    玩耍: 2d  section 测试    功能测试: active, a1, after des3, 3d    压力测试: after a1, 20h    测试报告: 48h[```]<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><p>显示效果如下所示：</p><p><code>mermaid%% 语法示例  gantt  dateFormat YYYY-MM-DD  title 软件开发甘特图  section 设计    需求: done, des1, 2014-01-06, 2014-01-08    原型: active, des2, 2014-01-09, 3d    UI设计: des3, after des2, 5d    未来任务: des4, after des3, 5d  section 开发    理解需求: crit, done, 2014-01-06, 24h    设计框架: crit, done, after des2, 2d    开发: crit, active, 3d    未来任务: crit, 5d    玩耍: 2d  section 测试    功能测试: active, a1, after des3, 3d    压力测试: after a1, 20h    测试报告: 48h</code><script src="https://cdnjs.cloudflare.com/ajax/libs/raphael/2.2.7/raphael.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/flowchart/1.6.5/flowchart.min.js"></script><textarea id="flowchart-0-code" style="display: none">  st=>start: 开始框  op=>operation: 处理框  cond=>condition: 判断框(是或否?)  sub1=>subroutine: 子流程  io=>inputoutput: 输入输出框  e=>end: 结束框  st->op->cond  cond(yes)->io->e  cond(no)->sub1(right)->op</textarea><textarea id="flowchart-0-options" style="display: none">{"theme":"simple","scale":1,"line-width":2,"line-length":50,"text-margin":10,"font-size":12}</textarea><script>  var code = document.getElementById("flowchart-0-code").value;  var options = JSON.parse(decodeURIComponent(document.getElementById("flowchart-0-options").value));  var diagram = flowchart.parse(code);  diagram.drawSVG("flowchart-0", options);</script><textarea id="flowchart-1-code" style="display: none">  st=>start: 开始框  op=>operation: 处理框  cond=>condition: 判断框(是或否?)  sub1=>subroutine: 子流程  io=>inputoutput: 输入输出框  e=>end: 结束框  st(right)->op(right)->cond  cond(yes)->io(bottom)->e  cond(no)->sub1(right)->op</textarea><textarea id="flowchart-1-options" style="display: none">{"theme":"simple","scale":1,"line-width":2,"line-length":50,"text-margin":10,"font-size":12}</textarea><script>  var code = document.getElementById("flowchart-1-code").value;  var options = JSON.parse(decodeURIComponent(document.getElementById("flowchart-1-options").value));  var diagram = flowchart.parse(code);  diagram.drawSVG("flowchart-1", options);</script><script src="https://cdnjs.cloudflare.com/ajax/libs/webfont/1.6.27/webfontloader.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/snap.svg/0.4.1/snap.svg-min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.8.3/underscore-min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/js-sequence-diagrams/1.0.6/sequence-diagram-min.js"></script><textarea id="sequence-0-code" style="display: none">  对象A->对象B: 对象B你好吗?（请求）  Note right of 对象B: 对象B的描述  Note left of 对象A: 对象A的描述(提示)  对象B-->对象A: 我很好(响应)  对象A->对象B: 你真的好吗？</textarea><textarea id="sequence-0-options" style="display: none">{"theme":"simple","scale":1,"line-width":2,"line-length":50,"text-margin":10,"font-size":12}</textarea><script>  var code = document.getElementById("sequence-0-code").value;  var options = JSON.parse(decodeURIComponent(document.getElementById("sequence-0-options").value));  var diagram = Diagram.parse(code);  diagram.drawSVG("sequence-0", options);</script><textarea id="sequence-1-code" style="display: none">  Title: 标题：复杂使用  对象A->对象B: 对象B你好吗?（请求）  Note right of 对象B: 对象B的描述  Note left of 对象A: 对象A的描述(提示)  对象B-->对象A: 我很好(响应)  对象B->小三: 你好吗  小三-->>对象A: 对象B找我了  对象A->对象B: 你真的好吗？  Note over 小三, 对象B: 我们是朋友  participant C  Note right of C: 没人陪我玩</textarea><textarea id="sequence-1-options" style="display: none">{"theme":"simple","scale":1,"line-width":2,"line-length":50,"text-margin":10,"font-size":12}</textarea><script>  var code = document.getElementById("sequence-1-code").value;  var options = JSON.parse(decodeURIComponent(document.getElementById("sequence-1-options").value));  var diagram = Diagram.parse(code);  diagram.drawSVG("sequence-1", options);</script></p>]]></content>
      
      
      <categories>
          
          <category> 教程笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Markdown </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Front-matter</title>
      <link href="post/31e4c77c.html"/>
      <url>post/31e4c77c.html</url>
      
        <content type="html"><![CDATA[<h1 id="Page-Front-matter"><a href="#Page-Front-matter" class="headerlink" title="Page Front-matter"></a>Page Front-matter</h1><div class="table-container"><table><thead><tr><th>写法</th><th>解释</th></tr></thead><tbody><tr><td>title</td><td>【必需】页面标题</td></tr><tr><td>date</td><td>【必需】页面创建日期</td></tr><tr><td>type</td><td>【必需】标签、分类和友情链接三个页面需要配置</td></tr><tr><td>updated</td><td>【必需】标签、分类和友情链接三个页面需要配置</td></tr><tr><td>description</td><td>【可选】页面描述</td></tr><tr><td>keywords</td><td>【可选】页面关键字</td></tr><tr><td>comments</td><td>【可选】显示页面评论模块 (默认 true)</td></tr><tr><td>top_img</td><td>【可选】页面顶部图片</td></tr><tr><td>mathjax</td><td>【可选】显示 mathjax (当设置mathjax 的 per_page: false 时，才需要配置，默认 false)</td></tr><tr><td>katex</td><td>【可选】显示 katex (当设置 katex 的 per_page: false 时，才需要配置，默认 false)</td></tr><tr><td>aside</td><td>【可选】显示侧边栏 (默认 true)</td></tr><tr><td>aplayer</td><td>【可选】在需要的页面加载 aplayer 的 js 和 css</td></tr><tr><td>highlight_shrink</td><td>【可选】配置代码框是否展开 (true/false) (默认为设置中 highlight_shrink 的配置)</td></tr></tbody></table></div><h1 id="Post-Front-matter"><a href="#Post-Front-matter" class="headerlink" title="Post Front-matter"></a>Post Front-matter</h1><div class="table-container"><table><thead><tr><th>写法</th><th>解释</th></tr></thead><tbody><tr><td>title</td><td>【必需】文章标题</td></tr><tr><td>date</td><td>【必需】文章创建日期</td></tr><tr><td>updated</td><td>【可选】文章更新日期</td></tr><tr><td>tags</td><td>【可选】文章标签</td></tr><tr><td>categories</td><td>【可选】文章分类</td></tr><tr><td>keywords</td><td>【可选】文章关键字</td></tr><tr><td>description</td><td>【可选】文章描述</td></tr><tr><td>top_img</td><td>【可选】文章顶部图片</td></tr><tr><td>cover</td><td>【可选】文章缩略图 (如果没有设置 top_img，文章页顶部将显示缩略图，可设为 false/图片地址/留空)</td></tr><tr><td>comments</td><td>【可选】显示文章评论模块 (默认 true)</td></tr><tr><td>toc</td><td>【可选】显示文章 TOC (默认为设置中 toc 的 enable 配置)</td></tr><tr><td>toc_number</td><td>【可选】显示 toc_number (默认为设置中 toc 的 number 配置)</td></tr><tr><td>copyright</td><td>【可选】显示文章版权模块 (默认为设置中 post_copyright 的 enable 配置)</td></tr><tr><td>copyright_author</td><td>【可选】文章版权模块的文章作者</td></tr><tr><td>copyright_author_href</td><td>【可选】文章版权模块的文章作者链接</td></tr><tr><td>copyright_url</td><td>【可选】文章版权模块的文章版权链接</td></tr><tr><td>copyright_info</td><td>【可选】文章版权模块的版权声明文字</td></tr><tr><td>mathjax</td><td>【可选】显示 mathjax (当设置 mathjax 的 per_page: false 时，才需要配置，默认 false)</td></tr><tr><td>katex</td><td>【可选】显示 katex (当设置 katex 的 per_page: false 时，才需要配置，默认 false)</td></tr><tr><td>aplayer</td><td>【可选】在需要的页面加载 aplayer 的 js 和 css</td></tr><tr><td>highlight_shrink</td><td>【可选】配置代码框是否展开 (true/false) (默认为设置中 highlight_shrink 的配置)</td></tr><tr><td>aside</td><td>【可选】显示侧边栏 (默认 true)</td></tr></tbody></table></div>]]></content>
      
      
      <categories>
          
          <category> 教程笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Hexo </tag>
            
            <tag> Butterfly </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hello Hexo</title>
      <link href="post/a1751c09.html"/>
      <url>post/a1751c09.html</url>
      
        <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">$ hexo new &quot;My New Post&quot;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><p>More info: <a href="https://hexo.io/docs/writing.html">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">$ hexo server<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">$ hexo generate<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><p>More info: <a href="https://hexo.io/docs/generating.html">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">$ hexo deploy<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><p>More info: <a href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>]]></content>
      
      
      <categories>
          
          <category> 教程笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Hexo </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
