<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>MySQL 优化 | Eurkon</title><meta name="keywords" content="教程,数据库,MySQL"><meta name="author" content="Huang Yuhang,eurkon@foxmail.com"><meta name="copyright" content="Huang Yuhang"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="优化三大方向 优化 MySQL 所在服务器内核（此优化一般由运维人员完成）。 对 MySQL 配置参数进行优化（my.cnf）此优化需要进行压力测试来进行参数调整。 对 SQL 语句以及表优化。  参数优化 MySQL 默认的最大连接数为 100，可以在 mysql 命令提示窗口使用以下命令查看  1mysql&gt; SHOW variables LIKE &amp;#x27;max_connectio">
<meta property="og:type" content="article">
<meta property="og:title" content="MySQL 优化">
<meta property="og:url" content="https://eurkon.gitee.io/posts/a4e7cc3968dd.html">
<meta property="og:site_name" content="Eurkon">
<meta property="og:description" content="优化三大方向 优化 MySQL 所在服务器内核（此优化一般由运维人员完成）。 对 MySQL 配置参数进行优化（my.cnf）此优化需要进行压力测试来进行参数调整。 对 SQL 语句以及表优化。  参数优化 MySQL 默认的最大连接数为 100，可以在 mysql 命令提示窗口使用以下命令查看  1mysql&gt; SHOW variables LIKE &amp;#x27;max_connectio">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://eurkon.gitee.io/images/cover/mysql_optimization.jpg">
<meta property="article:published_time" content="2021-01-14T05:32:11.000Z">
<meta property="article:modified_time" content="2021-01-27T11:51:15.609Z">
<meta property="article:author" content="Huang Yuhang">
<meta property="article:tag" content="教程">
<meta property="article:tag" content="数据库">
<meta property="article:tag" content="MySQL">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://eurkon.gitee.io/images/cover/mysql_optimization.jpg"><link rel="shortcut icon" href="/images/user/favicon.png"><link rel="canonical" href="https://eurkon.gitee.io/posts/a4e7cc3968dd"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//hm.baidu.com"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta name="google-site-verification" content="N2wcnlAQOlJ2jspDYyibhqUqCHHOCpvSlbVkhZG9fZw"/><meta name="msvalidate.01" content="F299EA4E7AD0E2B28FDF4E0EA94879BA"/><meta name="baidu-site-verification" content="code-EvNTQv5FqO"/><meta name="360-site-verification" content="82885fa1c62057f33a080b43ac12456c"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?fe4b6fd58b051190a1e0890917094ccc";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: {"defaultEncoding":1,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":50,"languages":{"author":"作者: Huang Yuhang","link":"链接: ","source":"来源: Eurkon","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#121212","position":"bottom-left"},
  source: {
    jQuery: 'https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js',
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
    },
    fancybox: {
      js: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js',
      css: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2021-01-27 19:51:15'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const fontSizeVal = saveToLocal.get('global-font-size')
    if (fontSizeVal !== undefined) {
      document.documentElement.style.setProperty('--global-font-size', fontSizeVal + 'px')
    }
    })(window)</script><link rel="stylesheet" href="https://cdn.bootcss.com/highlight.js/9.15.10/styles/dracula.min.css"><link rel="stylesheet" href="/css/custom.css"><meta name="generator" content="Hexo 5.3.0"></head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="author-avatar"><img class="avatar-img" src="/images/user/avatar.png" onerror="onerror=null;src='/images/sys/friend_404.gif'" alt="avatar"/></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">文章</div><div class="length-num">13</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">标签</div><div class="length-num">8</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/categories/"><div class="headline">分类</div><div class="length-num">6</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 娱乐</span><i class="fas fa-chevron-down expand hide"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/books/"><i class="fa-fw fas fa-book"></i><span> 书籍</span></a></li><li><a class="site-page" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page" href="/images/"><i class="fa-fw fas fa-images"></i><span> 图库</span></a></li><li><a class="site-page" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li><li><a class="site-page" href="/games/"><i class="fa-fw fas fa-gamepad"></i><span> 游戏</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/stars/"><i class="fa-fw fas fa-star"></i><span> 收藏</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/images/cover/mysql_optimization.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">Eurkon</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 娱乐</span><i class="fas fa-chevron-down expand hide"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/books/"><i class="fa-fw fas fa-book"></i><span> 书籍</span></a></li><li><a class="site-page" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page" href="/images/"><i class="fa-fw fas fa-images"></i><span> 图库</span></a></li><li><a class="site-page" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li><li><a class="site-page" href="/games/"><i class="fa-fw fas fa-gamepad"></i><span> 游戏</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/stars/"><i class="fa-fw fas fa-star"></i><span> 收藏</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">MySQL 优化</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2021-01-14T05:32:11.000Z" title="发表于 2021-01-14 13:32:11">2021-01-14</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2021-01-27T11:51:15.609Z" title="更新于 2021-01-27 19:51:15">2021-01-27</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/">数据库</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">5,309</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>20分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="优化三大方向"><a href="#优化三大方向" class="headerlink" title="优化三大方向"></a>优化三大方向</h1><ul>
<li>优化 MySQL 所在服务器内核（此优化一般由运维人员完成）。</li>
<li>对 MySQL 配置参数进行优化（my.cnf）此优化需要进行压力测试来进行参数调整。</li>
<li>对 SQL 语句以及表优化。</li>
</ul>
<h1 id="参数优化"><a href="#参数优化" class="headerlink" title="参数优化"></a>参数优化</h1><ol>
<li><p>MySQL 默认的最大连接数为 100，可以在 <code>mysql</code> 命令提示窗口使用以下命令查看</p>
<p> <figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql&gt; SHOW variables LIKE &#x27;max_connections&#x27;;<br></code></pre></td></tr></table></figure></p>
</li>
<li><p>查看当前访问 MySQL 的线程</p>
<p> <figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql&gt; SHOW processlist;<br></code></pre></td></tr></table></figure></p>
</li>
<li><p>设置最大连接数</p>
<p> <figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql&gt; SET globle max_connections = 5000;<br></code></pre></td></tr></table></figure>
</p>
<p> 最大可设置 <code>16384</code>，超过没用</p>
</li>
</ol>
<ol>
<li><p>查看当前被使用的 connections</p>
<p> <figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql&gt; SHOW GLOBAL STATUS LIKE &#x27;max_user_connections&#x27;<br></code></pre></td></tr></table></figure>
</p>
<h1 id="性能优化"><a href="#性能优化" class="headerlink" title="性能优化"></a>性能优化</h1><ul>
<li><a href="#使用查询缓存优化查询">使用查询缓存优化查询</a></li>
<li><a href="#使用-EXPLAIN-关键字检测查询">使用 EXPLAIN 关键字检测查询</a></li>
<li><a href="#只要一行数据时使用-LIMIT-1">只要一行数据时使用 LIMIT 1</a></li>
<li><a href="#为搜索字段建立索引">为搜索字段建立索引</a></li>
<li><a href="#在-JOIN-表的时候使用相当类型的列并将其索引">在 JOIN 表的时候使用相当类型的列并将其索引</a></li>
<li><a href="#切记不要使用-ORDER-BY-RAND">切记不要使用 ORDER BY RAND()</a></li>
<li><a href="#避免使用-SELECT">避免使用 SELECT *</a></li>
<li><a href="#永远为每张表设置一个-ID-主键">永远为每张表设置一个 ID 主键</a></li>
<li><a href="#可以使用-ENUM-则不用-VARCHAR">可以使用 ENUM 则不用 VARCHAR</a></li>
<li><a href="#尽可能的不要赋值为-NULL">尽可能的不要赋值为 NULL</a></li>
<li><a href="#固定长度的表会更快">固定长度的表会更快</a></li>
<li><a href="#垂直分割">垂直分割</a></li>
<li><a href="#拆分大的-DELETE-或-INSERT-语句">拆分大的 DELETE 或 INSERT 语句</a></li>
<li><a href="#越小的列会越快">越小的列会越快</a></li>
<li><a href="#选择正确的存储引擎">选择正确的存储引擎</a></li>
<li><a href="#小心永久链接">小心永久链接</a></li>
</ul>
</li>
</ol>
<h2 id="使用查询缓存优化查询"><a href="#使用查询缓存优化查询" class="headerlink" title="使用查询缓存优化查询"></a>使用查询缓存优化查询</h2><p>大多数的 MySQL 服务器都开启了查询缓存。这是提高性能最有效的方法之一，而且这是被 MySQL 引擎处理的。当有很多相同的查询被执行了多次的时候，这些查询结果会被放入一个缓存中，这样后续的相同查询就不用操作而直接访问缓存结果了。</p>
<p>这里最主要的问题是，对于我们程序员来说，这个事情是很容易被忽略的。因为我们某些查询语句会让 MySQL 不使用缓存，示例如下：</p>
<p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> username <span class="hljs-keyword">FROM</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">WHERE</span> signup_date &gt;= <span class="hljs-keyword">CURDATE</span>()<br><span class="hljs-keyword">SELECT</span> username <span class="hljs-keyword">FROM</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">WHERE</span> signup_date &gt;= <span class="hljs-string">&#x27;2014-06-24&#x27;</span><br></code></pre></td></tr></table></figure>
</p>
<p>上面两条 SQL 语句的差别就是 <code>CURDATE()</code> ，MySQL 的查询缓存对这个函数不起作用。所以，像 <code>NOW()</code> 和 <code>RAND()</code> 或是其它的诸如此类的 SQL 函数都不会开启查询缓存，因为这些函数的返回是会不定的易变的。所以，你所需要的就是用一个变量来代替 MySQL 的函数，从而开启缓存。</p>
<h2 id="使用-EXPLAIN-关键字检测查询"><a href="#使用-EXPLAIN-关键字检测查询" class="headerlink" title="使用 EXPLAIN 关键字检测查询"></a>使用 EXPLAIN 关键字检测查询</h2><p>使用 <code>EXPLAIN</code> 关键字可以使我们知道 MySQL 是如何处理 SQL 语句的，这样可以帮助我们分析我们的查询语句或是表结构的性能瓶颈；<code>EXPLAIN</code> 的查询结果还会告诉我们索引主键是如何被利用的，数据表是如何被被搜索或排序的等等。语法格式是 <code>EXPLAIN + SELECT</code> 语句：</p>
<p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">EXPLAIN</span> <span class="hljs-keyword">SELECT</span> &lt;字段名&gt; <span class="hljs-keyword">FROM</span> &lt;表名&gt; <span class="hljs-keyword">WHERE</span> &lt;表达式&gt;<br></code></pre></td></tr></table></figure>
</p>
<p><img src="/images/post/mysql_optimization/explain_1.png" alt></p>
<p><img src="/images/post/mysql_optimization/explain_2.png" alt></p>
<p>我们可以看到，前一个结果显示搜索了 <code>7883</code> 行，而后一个只是搜索了两个表的 <code>9</code> 和 <code>16</code> 行。查看 <code>rows</code> 列可以让我们找到潜在的性能问题。 </p>
<h2 id="只要一行数据时使用-LIMIT-1"><a href="#只要一行数据时使用-LIMIT-1" class="headerlink" title="只要一行数据时使用 LIMIT 1"></a>只要一行数据时使用 LIMIT 1</h2><p>加上 <code>LIMIT 1</code> 可以增加性能。MySQL 数据库引擎会在查找到一条数据后停止搜索，而不是继续往后查询下一条符合条件的数据记录。</p>
<h2 id="为搜索字段建立索引"><a href="#为搜索字段建立索引" class="headerlink" title="为搜索字段建立索引"></a>为搜索字段建立索引</h2><p>索引不一定就是给主键或者是唯一的字段，如果在表中，有某个字段经常用来做搜索，需要将其建立索引。</p>
<p><strong>索引的有关操作如下：</strong></p>
<h3 id="创建索引"><a href="#创建索引" class="headerlink" title="创建索引"></a>创建索引</h3><p>在执行 <code>CREATE TABLE</code> 语句时可以创建索引，也可以单独用 <code>CREATE INDEX</code> 或 <code>ALTER TABLE</code> 来为表增加索引。</p>
<ol>
<li><p>ALTER TABLE</p>
<p> ALTER TABLE 用来创建普通索引、唯一索引、主键索引和全文索引</p>
<p> <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> table_name <span class="hljs-keyword">ADD</span> <span class="hljs-keyword">INDEX</span> index_name (column_list);<br><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> table_name <span class="hljs-keyword">ADD</span> <span class="hljs-keyword">UNIQUE</span> (column_list);<br><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> table_name <span class="hljs-keyword">ADD</span> PRIMARY <span class="hljs-keyword">KEY</span> (column_list);<br><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> table_name <span class="hljs-keyword">ADD</span> FULLTEXT (column_list);<br></code></pre></td></tr></table></figure>
</p>
<p> 其中 <code>table_name</code> 是要增加索引名的表名，<code>column_list</code> 指出对哪些列进行索引，多列时各列之间使用半角逗号隔开。索引名 <code>index_name</code> 是可选的，如果不指定索引名称，MySQL 将根据第一个索引列自动指定索引名称，另外，<code>ALTER TABLE</code> 允许在单个语句中更改多个表，因此可以在同时创建多个索引。</p>
</li>
<li><p>CREATE INDEX</p>
<p> <code>CREATE INDEX</code> 可对表增加普通索引或唯一索引以及全文索引，但是不可以对表增加主键索引</p>
<p> <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">INDEX</span> index_name <span class="hljs-keyword">ON</span> table_name (column_list);<br><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">UNIQUE</span> index_name <span class="hljs-keyword">ON</span> table_name (column_list);<br><span class="hljs-keyword">CREATE</span> FULLTEXT index_name <span class="hljs-keyword">ON</span> table_name (column_list);<br></code></pre></td></tr></table></figure>
</p>
<p> <code>table_name</code>、<code>index_name</code> 和 <code>column_list</code> 具有与 <code>ALTER TABLE</code> 语句中相同的含义，索引名必须指定。另外，不能用 <code>CREATE INDEX</code> 语句创建 <code>PRIMARY KEY</code> 索引。</p>
</li>
</ol>
<h3 id="索引类型"><a href="#索引类型" class="headerlink" title="索引类型"></a>索引类型</h3><ul>
<li>普通索引（INDEX）：适用于 name、email 等一般属性</li>
<li>唯一索引（UNIQUE）：与普通索引类似，不同的是唯一索引要求索引字段值在表中是唯一的，这一点和主键索引类似，但是不同的是，唯一索引允许有空值。唯一索引一般适用于身份证号码、用户账号等不允许有重复的属性字段上。</li>
<li>主键索引（PRIMARY KEY）：其实就是主键，一般在建表时就指定了，不需要额外添加。</li>
<li>全文检索（FULLTEXT）：只适用于 <code>VARCHAR</code> 和 <code>TEXT</code> 类型的字段。</li>
</ul>
<p><strong>注意</strong>：全文索引和普通索引是有很大区别的，如果建立的是普通索引，一般会使用like进行模糊查询，只会对查询内容前一部分有效，即只对前面不使用通配符的查询有效，如果前后都有通配符，普通索引将不会起作用。对于全文索引而言在查询时有自己独特的匹配方式，例如我们在对一篇文章的标题和内容进行全文索引时：</p>
<p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> article <span class="hljs-keyword">ADD</span> FULLTEXT (<span class="hljs-string">&#x27;title&#x27;</span>, <span class="hljs-string">&#x27;content&#x27;</span>); <br><span class="hljs-comment"># 在进行检索时就需要使用如下的语法进行检索：</span><br><span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> article <span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">MATCH</span>(<span class="hljs-string">&#x27;title&#x27;</span>, <span class="hljs-string">&#x27;content&#x27;</span>) AGAINST (<span class="hljs-string">&#x27;查询字符串&#x27;</span>);<br></code></pre></td></tr></table></figure>
</p>
<p><strong>在使用全文检索时的注意事项：</strong></p>
<p>MySQL 自带的全文索引只能用于数据库引擎为 <code>MYISAM</code> 的数据表，如果是其他数据引擎，则全文索引不会生效。此外，MySQL 自带的全文索引只能对英文进行全文检索，目前无法对中文进行全文检索。如果需要对包含中文在内的文本数据进行全文检索，我们需要采用 Sphinx/Coreseek 技术来处理中文。另外使用 MySQL 自带的全文索引时，如果查询字符串的长度过短将无法得到期望的搜索结果。MySQL 全文索引所能找到的词默认最小长度为 4 个字符。另外，如果查询的字符串包含停止词，那么该停止词将会被忽略。</p>
<h3 id="组合索引"><a href="#组合索引" class="headerlink" title="组合索引"></a>组合索引</h3><p>组合索引又称多列索引，就是建立索引时指定多个字段属性。有点类似于字典目录，比如查询 <code>guo</code> 这个拼音的字时，首先查找 <code>g</code> 字母，然后在 <code>g</code> 的检索范围内查询第二个字母为 <code>u</code> 的列表，最后在 <code>u</code> 的范围内查找最后一个字母为 <code>o</code> 的字。比如组合索引 <code>(a,b,c)</code>，<code>abc</code> 都是排好序的，在任意一段 <code>a</code> 的下面 <code>b</code> 都是排好序的，任何一段 <code>b</code> 下面 <code>c</code> 都是排好序的。</p>
<p>组合索引的生效原则是：从前往后依次使用生效，如果中间某个索引没有使用，那么断点前面的索引部分起作用，断点后面的索引没有起作用。</p>
<p>造成断点的原因：</p>
<ul>
<li>前边的任意一个索引没有参与查询，后边的全部不生效。</li>
<li>前边的任意一个索引字段参与的是范围查询，后面的不会生效。</li>
<li>断点跟索引字字段在SQL语句中的位置前后无关，只与是否存在有关。</li>
</ul>
<p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sql">(0) <span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> mytable <span class="hljs-keyword">WHERE</span> a=<span class="hljs-number">3</span> <span class="hljs-keyword">AND</span> b=<span class="hljs-number">45</span> <span class="hljs-keyword">AND</span> c=<span class="hljs-number">5</span> ...<br><span class="hljs-comment"># 这种三个索引顺序使用中间没有断点，全部发挥作用</span><br>(<span class="hljs-number">1</span>) <span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> mytable <span class="hljs-keyword">WHERE</span> a=<span class="hljs-number">3</span> <span class="hljs-keyword">AND</span> c=<span class="hljs-number">5</span> ...<br><span class="hljs-comment"># 这种情况下 b 就是断点，a 发挥了效果，c 没有效果</span><br>(<span class="hljs-number">2</span>) <span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> mytable <span class="hljs-keyword">WHERE</span> b=<span class="hljs-number">3</span> <span class="hljs-keyword">AND</span> c=<span class="hljs-number">4</span> ...<br><span class="hljs-comment"># 这种情况下 a 就是断点，在 a 后面的索引都没有发挥作用，这种写法联合索引没有发挥任何效果</span><br>(<span class="hljs-number">3</span>) <span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> mytable <span class="hljs-keyword">WHERE</span> b=<span class="hljs-number">45</span> <span class="hljs-keyword">AND</span> a=<span class="hljs-number">3</span> <span class="hljs-keyword">AND</span> c=<span class="hljs-number">5</span> ...<br><span class="hljs-comment"># 这个跟第一个一样，全部发挥作用，abc 只要用上了就行，跟写的顺序无关</span><br></code></pre></td></tr></table></figure>
</p>
<p><code>(a,b,c)</code> 三个列上加了联合索引（是联合索引，不是在每个列上单独加索引）而是建立了 <code>a</code>, <code>(a,b)</code>, <code>(a,b,c)</code>三个索引，另外 <code>(a,b,c)</code> 多列索引和 <code>(a,c,b)</code> 是不一样的。</p>
<p>具体实例可以说明：</p>
<p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs sql">(0) <span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> mytable <span class="hljs-keyword">WHERE</span> a=<span class="hljs-number">3</span> <span class="hljs-keyword">AND</span> b=<span class="hljs-number">5</span> <span class="hljs-keyword">AND</span> c=<span class="hljs-number">4</span>;<br><span class="hljs-comment"># abc三个索引都在where条件里面用到了，而且都发挥了作用</span><br>(1) <span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> mytable <span class="hljs-keyword">WHERE</span> c=<span class="hljs-number">4</span> <span class="hljs-keyword">AND</span> b=<span class="hljs-number">6</span> <span class="hljs-keyword">AND</span> a=<span class="hljs-number">3</span>;<br><span class="hljs-comment"># 这条语句为了说明 组合索引与在 SQL 中的位置先后无关，WHERE 里面的条件顺序在查询之前会被 MySQL 自动优化，效果跟上一句一样</span><br>(2) <span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> mytable <span class="hljs-keyword">WHERE</span> a=<span class="hljs-number">3</span> <span class="hljs-keyword">AND</span> c=<span class="hljs-number">7</span>;<br><span class="hljs-comment"># a 用到索引，b 没有用，所以 c 是没有用到索引效果的</span><br>(3) <span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> mytable <span class="hljs-keyword">WHERE</span> a=<span class="hljs-number">3</span> <span class="hljs-keyword">AND</span> b&gt;<span class="hljs-number">7</span> <span class="hljs-keyword">AND</span> c=<span class="hljs-number">3</span>;<br><span class="hljs-comment"># a 用到了，b 也用到了，c 没有用到，这个地方 b 是范围值，也算断点，只不过自身用到了索引</span><br>(4) <span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> mytable <span class="hljs-keyword">WHERE</span> b=<span class="hljs-number">3</span> <span class="hljs-keyword">AND</span> c=<span class="hljs-number">4</span>;<br><span class="hljs-comment"># 因为 a 索引没有使用，所以这里 bc 都没有用上索引效果</span><br>(5) <span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> mytable <span class="hljs-keyword">WHERE</span> a&gt;<span class="hljs-number">4</span> <span class="hljs-keyword">AND</span> b=<span class="hljs-number">7</span> <span class="hljs-keyword">AND</span> c=<span class="hljs-number">9</span>;<br><span class="hljs-comment"># a 用到了 b 没有使用，c 没有使用</span><br>(6) <span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> mytable <span class="hljs-keyword">WHERE</span> a=<span class="hljs-number">3</span> <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> b;<br><span class="hljs-comment"># a 用到了索引，b 在结果排序中也用到了索引的效果，前面说了，a 下面任意一段的 b 是排好序的</span><br>(7) <span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> mytable <span class="hljs-keyword">WHERE</span> a=<span class="hljs-number">3</span> <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> c;<br><span class="hljs-comment"># a 用到了索引，但是这个地方 c 没有发挥排序效果，因为中间断点了，使用 EXPLAIN 可以看到 filesort</span><br>(8) <span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> mytable <span class="hljs-keyword">WHERE</span> b=<span class="hljs-number">3</span> <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> a;<br><span class="hljs-comment"># b 没有用到索引，排序中 a 也没有发挥索引效果</span><br></code></pre></td></tr></table></figure>
</p>
<p><strong>注意</strong>：在查询时，MySQL 只能使用一个索引，如果建立的是多个单列的普通索引，在查询时会根据查询的索引字段，从中选择一个限制最严格的单例索引进行查询。别的索引都不会生效。</p>
<h3 id="查看索引"><a href="#查看索引" class="headerlink" title="查看索引"></a>查看索引</h3><p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SHOW</span> <span class="hljs-keyword">INDEX</span> <span class="hljs-keyword">FROM</span> tblname;<br><span class="hljs-keyword">SHOW</span> <span class="hljs-keyword">KEYS</span> <span class="hljs-keyword">FROM</span> tblname;<br></code></pre></td></tr></table></figure>
</p>
<h3 id="删除索引"><a href="#删除索引" class="headerlink" title="删除索引"></a>删除索引</h3><p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">DORP INDEX IndexName ON tab_name；<br></code></pre></td></tr></table></figure>
</p>
<p><strong>注意：不能使用索引的情况</strong></p>
<p>对于普通索引而言在使用 <code>LIKE</code> 进行通配符模糊查询时，如果首尾之间都使用了通配符，索引时无效的。</p>
<p>假设查询内容的关键词为 <code>abc</code>：</p>
<p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> tab_name <span class="hljs-keyword">WHERE</span> index_column <span class="hljs-keyword">LIKE</span> <span class="hljs-string">&#x27;abc%&#x27;</span>; <span class="hljs-comment"># 索引是有效的</span><br><span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> tab_name <span class="hljs-keyword">WHERE</span> index_column <span class="hljs-keyword">LIKE</span> <span class="hljs-string">&#x27;%abc&#x27;</span>; <span class="hljs-comment"># 索引是无效的</span><br><span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> tab_name <span class="hljs-keyword">WHERE</span> index_column <span class="hljs-keyword">LIKE</span> <span class="hljs-string">&#x27;%abc%&#x27;</span>; <span class="hljs-comment"># 索引是无效的</span><br></code></pre></td></tr></table></figure>
</p>
<p>当检索的字段内容比较大而且检索内容前后部分都不确定的情况下，可以改为全文索引，并使用特定的检索方式。</p>
<h2 id="在-JOIN-表的时候使用相当类型的列并将其索引"><a href="#在-JOIN-表的时候使用相当类型的列并将其索引" class="headerlink" title="在 JOIN 表的时候使用相当类型的列并将其索引"></a>在 JOIN 表的时候使用相当类型的列并将其索引</h2><p>如果在程序中有很多 <code>JOIN</code> 查询，应该保证两个表中 <code>JOIN</code> 的字段时被建立过索引的。这样 MySQL 内部会启动优化 <code>JOIN</code> 的 SQL 语句的机制。</p>
<p><strong>注意</strong>：这些被用来 <code>JOIN</code> 的字段，应该是相同类型的。例如：如果要把 <code>DECIMAL</code> 字段和一个 <code>INT</code> 字段 <code>JOIN</code> 在一起，MySQL 就无法使用它们的索引。对于那些 <code>STRING</code> 类型，还需要有相同的字符集才行（两个表的字符集有可能不一样）。</p>
<p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> company_name<br><span class="hljs-keyword">FROM</span> <span class="hljs-keyword">users</span><br><span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">JOIN</span> companies<br><span class="hljs-keyword">ON</span> (users.state = companies.state)<br><span class="hljs-keyword">WHERE</span> users.id = <span class="hljs-string">&quot;user_id&quot;</span><br></code></pre></td></tr></table></figure>
</p>
<p>两个 <code>state</code> 字段应该是被建过索引的，而且应该是相当的类型，相同的字符集。</p>
<h2 id="切记不要使用-ORDER-BY-RAND"><a href="#切记不要使用-ORDER-BY-RAND" class="headerlink" title="切记不要使用 ORDER BY RAND()"></a>切记不要使用 ORDER BY RAND()</h2><p>如果你真的想把返回的数据行打乱了，你有 N 种方法可以达到这个目的。这样使用只让你的数据库的性能呈指数级的下降。这里的问题是：MySQL 会不得不去执行 <code>RAND()</code> 函数（很耗 CPU 时间），而且这是为了每一行记录去记行，然后再对其排序。就算是你用了 <code>Limit 1</code> 也无济于事（因为要排序） </p>
<h2 id="避免使用-SELECT"><a href="#避免使用-SELECT" class="headerlink" title="避免使用 SELECT *"></a>避免使用 SELECT *</h2><p>从数据库里读出越多的数据，那么查询就会变得越慢。并且，如果我们的数据库服务器和 web 服务器是两台独立的服务器的话，这还会增加网络传输的负载。所以，我们应该养成一个需要什么就取什么的好的习惯。</p>
<p><code>Hibernate</code> 性能方面就会差，它不用 <code>*</code>，但它将整个表的所有字段全查出来 </p>
<p>优点：开发速度快</p>
<h2 id="永远为每张表设置一个-ID-主键"><a href="#永远为每张表设置一个-ID-主键" class="headerlink" title="永远为每张表设置一个 ID 主键"></a>永远为每张表设置一个 ID 主键</h2><p>我们应该为数据库里的每张表都设置一个 <code>ID</code> 做为其主键，而且最好的是一个 <code>INT</code> 型的（推荐使用 <code>UNSIGNED</code>），并设置上自动增加的 <code>AUTO_INCREMENT</code> 标志。就算是我们 <code>users</code> 表有一个主键叫 <code>email</code> 的字段，我们也别让它成为主键。使用 <code>VARCHAR</code> 类型来当主键会使用得性能下降。</p>
<p>另外，在我们的程序中，我们应该使用表的 <code>ID</code> 来构造我们的数据结构。而且，在 MySQL 数据引擎下，还有一些操作需要使用主键，在这些情况下，主键的性能和设置变得非常重要，比如，集群，分区 ...。在这里，只有一个情况是例外，那就是“关联表”的“外键”，也就是说，这个表的主键，通过若干个别的表的主键构成。我们把这个情况叫做“外键”。比如：有一个“学生表”有学生的 <code>ID</code>，有一个“课程表”有课程 <code>ID</code>，那么，“成绩表”就是“关联表”了，其关联了学生表和课程表，在成绩表中，学生 <code>ID</code> 和课程 <code>ID</code> 叫“外键”其共同组成主键。 </p>
<h2 id="可以使用-ENUM-则不用-VARCHAR"><a href="#可以使用-ENUM-则不用-VARCHAR" class="headerlink" title="可以使用 ENUM 则不用 VARCHAR"></a>可以使用 ENUM 则不用 VARCHAR</h2><p><code>ENUM</code> 类型是非常快和紧凑的。在实际上，其保存的是 <code>TINYINT</code>，但其外表上显示为字符串。这样一来，用这个字段来做一些选项列表变得相当的完美。如果我们有一个字段，比如“性别”，“国家”，“民族”，“状态”或“部门”，我们知道这些字段的取值是有限而且固定的，那么，我们应该使用 <code>ENUM</code> 而不是 <code>VARCHAR</code>。</p>
<h2 id="尽可能的不要赋值为-NULL"><a href="#尽可能的不要赋值为-NULL" class="headerlink" title="尽可能的不要赋值为 NULL"></a>尽可能的不要赋值为 NULL</h2><p>如果不是特殊情况，尽可能的不要使用 <code>NULL</code>。在 MySQL 中对于 INT 类型而言，<code>EMPTY</code> 是 <code>0</code>，而 <code>NULL</code> 是空值。而在 Oracle 中 <code>NULL</code> 和 <code>EMPTY</code> 的字符串是一样的。<code>NULL</code> 也需要占用存储空间，并且会使我们的程序判断时更加复杂。现实情况是很复杂的，依然会有些情况下，我们需要使用 <code>NULL</code> 值。</p>
<p>下面摘自MySQL 的文档：</p>
<blockquote>
<p>NULL columns require additional space in the row to record whether their values are NULL. For MyISAM tables, each NULL column takes one bit extra, rounded up to the nearest byte.</p>
</blockquote>
<h2 id="固定长度的表会更快"><a href="#固定长度的表会更快" class="headerlink" title="固定长度的表会更快"></a>固定长度的表会更快</h2><p>如果表中的所有字段都是“固定长度”的，整个表会被认为是 <code>static</code> 或 <code>fixed-length</code>。例如，表中没有如下类型的字段：<code>VARCHAR</code>，<code>TEXT</code>，<code>BLOB</code>。只要我们包括了其中一个这些字段，那么这个表就不是“固定长度静态表”了，这样，MySQL 引擎会用另一种方法来处理。</p>
<p>固定长度的表会提高性能，因为 MySQL 搜寻得会更快一些，因为这些固定的长度是很容易计算下一个数据的偏移量的，所以读取的自然也会很快。而如果字段不是定长的，那么，每一次要找下一条的话，需要程序找到主键。并且，固定长度的表也更容易被缓存和重建。不过，唯一的副作用是，固定长度的字段会浪费一些空间，因为定长的字段无论我们用不用，他都是要分配那么多的空间。另外在取出值的时候要使用 <code>trim</code> 去除空格。</p>
<h2 id="垂直分割"><a href="#垂直分割" class="headerlink" title="垂直分割"></a>垂直分割</h2><p>“垂直分割”是一种把数据库中的表按列变成几张表的方法，这样可以降低表的复杂度和字段的数目，从而达到优化的目的。</p>
<h2 id="拆分大的-DELETE-或-INSERT-语句"><a href="#拆分大的-DELETE-或-INSERT-语句" class="headerlink" title="拆分大的 DELETE 或 INSERT 语句"></a>拆分大的 DELETE 或 INSERT 语句</h2><p>如果我们需要在一个在线的网站上去执行一个大的 <code>DELETE</code> 或 <code>INSERT</code> 查询，我们需要非常小心，要避免我们的操作让我们的整个网站停止响应。因为这两个操作是会锁表的，表一锁住了，别的操作都进不来了。</p>
<p>Apache 会有很多的子进程或线程。所以，其工作起来相当有效率，而我们的服务器也不希望有太多的子进程，线程和数据库链接，这是极大的占服务器资源的事情，尤其是内存。如果我们把我们的表锁上一段时间，比如 30 秒钟，那么对于一个有很高访问量的站点来说，这 30 秒所积累的访问进程/线程，数据库链接，打开的文件数，可能不仅仅会让我们的 web 服务 Crash，还可能会让我们的整台服务器马上挂了。所以在使用时使用 <code>LIMIT</code> 控制数量操作记录的数量。</p>
<h2 id="越小的列会越快"><a href="#越小的列会越快" class="headerlink" title="越小的列会越快"></a>越小的列会越快</h2><p>对于大多数的数据库引擎来说，硬盘操作可能是最重大的瓶颈。所以，把我们的数据变得紧凑会对这种情况非常有帮助，因为这减少了对硬盘的访问。参看 MySQL 的文档 Storage Requirements 查看所有的数据类型。</p>
<p>如果一个表只会有几列（比如说字典表，配置表），那么，我们就没有理由使用 <code>INT</code> 来做主键，使用 <code>MEDIUMINT</code>, <code>SMALLINT</code> 或是更小的 <code>TINYINT</code> 会更经济一些。如果我们不需要记录时间，使用 <code>DATE</code> 要比 <code>DATETIME</code> 好得多。</p>
<h2 id="选择正确的存储引擎"><a href="#选择正确的存储引擎" class="headerlink" title="选择正确的存储引擎"></a>选择正确的存储引擎</h2><p>在 MySQL 中有两个存储引擎 <code>MyISAM</code> 和 <code>InnoDB</code>,每个引擎都有利有弊。</p>
<p><code>MyISAM</code> 适合于一些需要大量查询的应用，但是对于大量写操作的支持不是很好。甚至一个 <code>UPDATE</code> 语句就会进行锁表操作，这时读取这张表的所有进程都无法进行操作直至写操作完成。另外 <code>MyISAM</code> 对于 <code>SELECT COUNT(*)</code> 这类的计算是超快无比的。<code>InnoDB</code> 的趋势会是一个非常复杂的存储引擎，对于一些小的应用，它会比 <code>MyISAM</code> 还慢。它支持“行锁”，于是在写操作比较多的时候，会更优秀。并且，他还支持更多的高级应用，比如：事务。</p>
<p><code>MyISAM</code> 是 MySQL5.5 版本以前默认的存储引擎，基于传统的 <code>ISAM</code> 类型，支持 <code>B-Tree</code>，全文检索，但是不是事务安全的，而且不支持外键。不具有原子性。支持锁表。</p>
<p><code>InnoDB</code> 是事务型引擎，支持 <code>ACID</code> 事务（实现 4 种事务隔离机制）、回滚、崩溃恢复能力、行锁。以及提供与 Oracle 一致的不加锁的读取方式。<code>InnoDB</code> 存储表和索引在一个表空间中，表空间可以包含多个文件。</p>
<p><code>MyISAM</code> 和 <code>InnoDB</code> 比较，如下表格所示：</p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center"></th>
<th style="text-align:center">MyISAM</th>
<th style="text-align:center">InnoDB</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">事务</td>
<td style="text-align:center">不支持</td>
<td style="text-align:center">支持</td>
</tr>
<tr>
<td style="text-align:center">数据行锁定</td>
<td style="text-align:center">不支持，只有表锁定</td>
<td style="text-align:center">支持</td>
</tr>
<tr>
<td style="text-align:center">外键约束</td>
<td style="text-align:center">不支持</td>
<td style="text-align:center">支持</td>
</tr>
<tr>
<td style="text-align:center">表空间大小</td>
<td style="text-align:center">相对小</td>
<td style="text-align:center">相对大</td>
</tr>
<tr>
<td style="text-align:center">全文索引</td>
<td style="text-align:center">支持</td>
<td style="text-align:center">不支持</td>
</tr>
<tr>
<td style="text-align:center">关注点</td>
<td style="text-align:center">性能（SELECT）</td>
<td style="text-align:center">事务</td>
</tr>
</tbody>
</table>
</div>
<p><strong>注意：</strong></p>
<ul>
<li>对于 Linux 版本的 MySQL 配置文件在 <code>/etc/my.cnf</code> 中</li>
<li>在5.5之后默认的存储引擎是 <code>INNODB</code></li>
<li>可以单独进行修改也可以在创建表时设置<p>  <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> tab_name <span class="hljs-keyword">ENGINE</span> <span class="hljs-keyword">INNODB</span>;<br></code></pre></td></tr></table></figure>
</p>
<p>  <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-keyword">IF</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">EXISTS</span> tab_name(<br>  <br>) <span class="hljs-keyword">ENGINE</span>=<span class="hljs-keyword">InnoDB</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">CHARSET</span>=utf8;<br></code></pre></td></tr></table></figure>
</p>
<h2 id="小心永久链接"><a href="#小心永久链接" class="headerlink" title="小心永久链接"></a>小心永久链接</h2></li>
</ul>
<p>“永久链接”的目的是用来减少重新创建 MySQL 链接的次数。当一个链接被创建了，它会永远处在连接的状态，就算是数据库操作已经结束了。而且，自从我们的 Apache开始重用它的子进程后——也就是说，下一次的 HTTP 请求会重用 Apache 的子进程，并重用相同的 MySQL 链接。 </p>
<p>而且，Apache 运行在极端并行的环境中，会创建很多很多的了进程。这就是为什么这种“永久链接”的机制工作不好的原因。在我们决定要使用“永久链接”之前，我们需要好好地考虑一下我们的整个系统的架构。</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:eurkon@foxmail.com">Huang Yuhang</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://eurkon.gitee.io/posts/a4e7cc3968dd.html">https://eurkon.gitee.io/posts/a4e7cc3968dd.html</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://eurkon.gitee.io" target="_blank">Eurkon</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E6%95%99%E7%A8%8B/">教程</a><a class="post-meta__tags" href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/">数据库</a><a class="post-meta__tags" href="/tags/MySQL/">MySQL</a></div><div class="post_share"><div class="social-share" data-image="/images/cover/mysql_optimization.jpg" data-sites="facebook,twitter,wechat,weibo,qq,qzone,douban,linkedin,google"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button button--animated"><i class="fas fa-qrcode"></i> 打赏</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/images/user/wechat.jpg" target="_blank"><img class="post-qr-code-img" src="/images/user/wechat.jpg" alt="微信"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="/images/user/alipay.jpg" target="_blank"><img class="post-qr-code-img" src="/images/user/alipay.jpg" alt="支付宝"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/posts/dd734f1bc020.html"><img class="prev-cover" src="/images/cover/r_course.png" onerror="onerror=null;src='/images/sys/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">R 语言教程</div></div></a></div><div class="next-post pull-right"><a href="/posts/6d5525a3e63a.html"><img class="next-cover" src="/images/cover/mysql_command.png" onerror="onerror=null;src='/images/sys/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">MySQL 常用命令行</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span> 相关推荐</span></div><div class="relatedPosts-list"><div><a href="/posts/6d5525a3e63a.html" title="MySQL 常用命令行"><img class="cover" src="/images/cover/mysql_command.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-01-13</div><div class="title">MySQL 常用命令行</div></div></a></div><div><a href="/posts/c4c9e18a584e.html" title="MySQL 教程"><img class="cover" src="/images/cover/mysql_course.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-01-09</div><div class="title">MySQL 教程</div></div></a></div><div><a href="/posts/8d9b83ec68a2.html" title="Front-matter"><img class="cover" src="/images/cover/front-matter.svg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-01-02</div><div class="title">Front-matter</div></div></a></div><div><a href="/posts/a0d8f49a1662.html" title="Hello Hexo"><img class="cover" src="/images/user/background.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-01-01</div><div class="title">Hello Hexo</div></div></a></div><div><a href="/posts/a45d2f68fa5a.html" title="在 Hexo 中插入 Chart 动态图表"><img class="cover" src="/images/cover/hexo_chartjs.svg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-01-04</div><div class="title">在 Hexo 中插入 Chart 动态图表</div></div></a></div><div><a href="/posts/d047a1af351e.html" title="Markdown 基本语法"><img class="cover" src="/images/cover/markdown_grammar.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-01-03</div><div class="title">Markdown 基本语法</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div><div id="comment-switch"><span class="first-comment">Valine</span><span class="switch-btn"></span><span class="second-comment">Twikoo</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div><div><div id="twikoo-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-info-avatar is-center"><img class="avatar-img" src="/images/user/avatar.png" onerror="this.onerror=null;this.src='/images/sys/friend_404.gif'" alt="avatar"/><div class="author-info__name">Huang Yuhang</div><div class="author-info__description"></div></div><div class="card-info-data"><div class="card-info-data-item is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">13</div></a></div><div class="card-info-data-item is-center"><a href="/tags/"><div class="headline">标签</div><div class="length-num">8</div></a></div><div class="card-info-data-item is-center"><a href="/categories/"><div class="headline">分类</div><div class="length-num">6</div></a></div></div><a class="button--animated" id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/Eurkon"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/Eurkon" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:eurkon@foxmail.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn card-announcement-animation"></i><span>公告</span></div><div class="announcement_content">Hello Eurkon</div></div><div class="card-widget card_history"><div class="card-content"><div class="item-headline"><i class="fas fa-clock fa-spin"></i><span>那年今天</span></div><div id="history-news" style="height:100px;overflow:hidden"><div id="history-card"></div></div></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BC%98%E5%8C%96%E4%B8%89%E5%A4%A7%E6%96%B9%E5%90%91"><span class="toc-number">1.</span> <span class="toc-text">优化三大方向</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8F%82%E6%95%B0%E4%BC%98%E5%8C%96"><span class="toc-number">2.</span> <span class="toc-text">参数优化</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96"><span class="toc-number">3.</span> <span class="toc-text">性能优化</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E6%9F%A5%E8%AF%A2%E7%BC%93%E5%AD%98%E4%BC%98%E5%8C%96%E6%9F%A5%E8%AF%A2"><span class="toc-number">3.1.</span> <span class="toc-text">使用查询缓存优化查询</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-EXPLAIN-%E5%85%B3%E9%94%AE%E5%AD%97%E6%A3%80%E6%B5%8B%E6%9F%A5%E8%AF%A2"><span class="toc-number">3.2.</span> <span class="toc-text">使用 EXPLAIN 关键字检测查询</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%AA%E8%A6%81%E4%B8%80%E8%A1%8C%E6%95%B0%E6%8D%AE%E6%97%B6%E4%BD%BF%E7%94%A8-LIMIT-1"><span class="toc-number">3.3.</span> <span class="toc-text">只要一行数据时使用 LIMIT 1</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%BA%E6%90%9C%E7%B4%A2%E5%AD%97%E6%AE%B5%E5%BB%BA%E7%AB%8B%E7%B4%A2%E5%BC%95"><span class="toc-number">3.4.</span> <span class="toc-text">为搜索字段建立索引</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E7%B4%A2%E5%BC%95"><span class="toc-number">3.4.1.</span> <span class="toc-text">创建索引</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B4%A2%E5%BC%95%E7%B1%BB%E5%9E%8B"><span class="toc-number">3.4.2.</span> <span class="toc-text">索引类型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%84%E5%90%88%E7%B4%A2%E5%BC%95"><span class="toc-number">3.4.3.</span> <span class="toc-text">组合索引</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E7%B4%A2%E5%BC%95"><span class="toc-number">3.4.4.</span> <span class="toc-text">查看索引</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E7%B4%A2%E5%BC%95"><span class="toc-number">3.4.5.</span> <span class="toc-text">删除索引</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9C%A8-JOIN-%E8%A1%A8%E7%9A%84%E6%97%B6%E5%80%99%E4%BD%BF%E7%94%A8%E7%9B%B8%E5%BD%93%E7%B1%BB%E5%9E%8B%E7%9A%84%E5%88%97%E5%B9%B6%E5%B0%86%E5%85%B6%E7%B4%A2%E5%BC%95"><span class="toc-number">3.5.</span> <span class="toc-text">在 JOIN 表的时候使用相当类型的列并将其索引</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%87%E8%AE%B0%E4%B8%8D%E8%A6%81%E4%BD%BF%E7%94%A8-ORDER-BY-RAND"><span class="toc-number">3.6.</span> <span class="toc-text">切记不要使用 ORDER BY RAND()</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%81%BF%E5%85%8D%E4%BD%BF%E7%94%A8-SELECT"><span class="toc-number">3.7.</span> <span class="toc-text">避免使用 SELECT *</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B0%B8%E8%BF%9C%E4%B8%BA%E6%AF%8F%E5%BC%A0%E8%A1%A8%E8%AE%BE%E7%BD%AE%E4%B8%80%E4%B8%AA-ID-%E4%B8%BB%E9%94%AE"><span class="toc-number">3.8.</span> <span class="toc-text">永远为每张表设置一个 ID 主键</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%AF%E4%BB%A5%E4%BD%BF%E7%94%A8-ENUM-%E5%88%99%E4%B8%8D%E7%94%A8-VARCHAR"><span class="toc-number">3.9.</span> <span class="toc-text">可以使用 ENUM 则不用 VARCHAR</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B0%BD%E5%8F%AF%E8%83%BD%E7%9A%84%E4%B8%8D%E8%A6%81%E8%B5%8B%E5%80%BC%E4%B8%BA-NULL"><span class="toc-number">3.10.</span> <span class="toc-text">尽可能的不要赋值为 NULL</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%BA%E5%AE%9A%E9%95%BF%E5%BA%A6%E7%9A%84%E8%A1%A8%E4%BC%9A%E6%9B%B4%E5%BF%AB"><span class="toc-number">3.11.</span> <span class="toc-text">固定长度的表会更快</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9E%82%E7%9B%B4%E5%88%86%E5%89%B2"><span class="toc-number">3.12.</span> <span class="toc-text">垂直分割</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8B%86%E5%88%86%E5%A4%A7%E7%9A%84-DELETE-%E6%88%96-INSERT-%E8%AF%AD%E5%8F%A5"><span class="toc-number">3.13.</span> <span class="toc-text">拆分大的 DELETE 或 INSERT 语句</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%B6%8A%E5%B0%8F%E7%9A%84%E5%88%97%E4%BC%9A%E8%B6%8A%E5%BF%AB"><span class="toc-number">3.14.</span> <span class="toc-text">越小的列会越快</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%80%89%E6%8B%A9%E6%AD%A3%E7%A1%AE%E7%9A%84%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E"><span class="toc-number">3.15.</span> <span class="toc-text">选择正确的存储引擎</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B0%8F%E5%BF%83%E6%B0%B8%E4%B9%85%E9%93%BE%E6%8E%A5"><span class="toc-number">3.16.</span> <span class="toc-text">小心永久链接</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/posts/40f4a302ee92.html" title="R 语言统计分析"><img src="/images/cover/r_statistics.jpg" onerror="this.onerror=null;this.src='/images/sys/404.jpg'" alt="R 语言统计分析"/></a><div class="content"><a class="title" href="/posts/40f4a302ee92.html" title="R 语言统计分析">R 语言统计分析</a><time datetime="2021-01-22T02:10:41.000Z" title="发表于 2021-01-22 10:10:41">2021-01-22</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/63c85d3a2495.html" title="R 语言数据接口"><img src="/images/cover/r_data_interface.png" onerror="this.onerror=null;this.src='/images/sys/404.jpg'" alt="R 语言数据接口"/></a><div class="content"><a class="title" href="/posts/63c85d3a2495.html" title="R 语言数据接口">R 语言数据接口</a><time datetime="2021-01-21T05:52:32.000Z" title="发表于 2021-01-21 13:52:32">2021-01-21</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/4cc96057705e.html" title="R 语言图表"><img src="/images/cover/r_chart.jpg" onerror="this.onerror=null;this.src='/images/sys/404.jpg'" alt="R 语言图表"/></a><div class="content"><a class="title" href="/posts/4cc96057705e.html" title="R 语言图表">R 语言图表</a><time datetime="2021-01-20T08:04:45.000Z" title="发表于 2021-01-20 16:04:45">2021-01-20</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/dd734f1bc020.html" title="R 语言教程"><img src="/images/cover/r_course.png" onerror="this.onerror=null;this.src='/images/sys/404.jpg'" alt="R 语言教程"/></a><div class="content"><a class="title" href="/posts/dd734f1bc020.html" title="R 语言教程">R 语言教程</a><time datetime="2021-01-18T08:20:11.000Z" title="发表于 2021-01-18 16:20:11">2021-01-18</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/a4e7cc3968dd.html" title="MySQL 优化"><img src="/images/cover/mysql_optimization.jpg" onerror="this.onerror=null;this.src='/images/sys/404.jpg'" alt="MySQL 优化"/></a><div class="content"><a class="title" href="/posts/a4e7cc3968dd.html" title="MySQL 优化">MySQL 优化</a><time datetime="2021-01-14T05:32:11.000Z" title="发表于 2021-01-14 13:32:11">2021-01-14</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2021 By Huang Yuhang</div><div class="footer_custom_text"><p id="badges"><a target="_blank" href="https://hexo.io/" rel="external nofollow noopener noreferrer" style="margin-inline: 5px;" one-link-mark="yes"><img title="博客框架Hexo" class="entered loaded" src="https://img.shields.io/badge/Frame-Hexo-blue?style=flat&amp;logo=hexo" data-ll-status="loaded"></a><a target="_blank" href="https://butterfly.js.org/" rel="external nofollow noopener noreferrer" style="margin-inline: 5px;" one-link-mark="yes"><img title="博客主题Butterfly" class="entered loaded" src="https://img.shields.io/badge/Theme-Butterfly-6513df?style=flat&amp;logo=bitdefender" data-ll-status="loaded"></a><a target="_blank" href="https://www.jsdelivr.com/" rel="external nofollow noopener noreferrer" style="margin-inline: 5px;" one-link-mark="yes"><img title="本站使用JsDelivr为静态资源提供CDN加速" class="entered loaded" src="https://img.shields.io/badge/CDN-jsDelivr-orange?style=flat&amp;logo=jsDelivr" data-ll-status="loaded"></a><a target="_blank" href="https://github.com/" rel="external nofollow noopener noreferrer" style="margin-inline: 5px;" one-link-mark="yes"><img title="本站项目由GitHub托管" class="entered loaded" src="https://img.shields.io/badge/Source-Github-d021d6?style=flat&amp;logo=GitHub" data-ll-status="loaded"></a><a target="_blank" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" rel="external nofollow noopener noreferrer" style="margin-inline: 5px;" one-link-mark="yes"><img title="本站采用创作共用-署名-非商业性-相同方式共享4.0版国际许可协议" class="entered loaded" src="https://img.shields.io/badge/Copyright-BY--NC--SA%204.0-d42328?style=flat&amp;logo=Claris" data-ll-status="loaded"></a></p></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="font-plus" type="button" title="放大字体"><i class="fas fa-plus"></i></button><button id="font-minus" type="button" title="缩小字体"><i class="fas fa-minus"></i></button><button id="translateLink" type="button" title="简繁转换">简</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div></div><hr/><div id="local-search-results"></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/vue@2.6.11"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script>if (document.getElementsByClassName('mermaid').length) {
  if (window.mermaidJsLoad) mermaid.init()
  else {
    getScript('https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js').then(() => {
      window.mermaidJsLoad = true
      mermaid.initialize({
        theme: 'dark',
      })
      true && mermaid.init()
    })
  }
}</script><script>function loadValine () {
  function initValine () {
    let initData = {
      el: '#vcomment',
      appId: 'mdK10Ra28S4hiWnWAgbmFnt2-MdYXbMMI',
      appKey: 'rCmzIVxuQwj4k6b5R7wP42VR',
      placeholder: '请留下您的昵称和邮箱，我会尽快回复...',
      avatar: 'monsterid',
      meta: 'nick,mail,link'.split(','),
      pageSize: '8',
      lang: 'zh-CN',
      recordIP: true,
      serverURLs: 'https://mdk10ra2.api.lncldglobal.com',
      emojiCDN: 'https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/valine/',
      emojiMaps: {"1":"bilibiliHotKey/1.jpg","2":"bilibiliHotKey/2.jpg","3":"bilibiliHotKey/3.jpg","4":"bilibiliHotKey/4.jpg","5":"bilibiliHotKey/5.jpg","6":"bilibiliHotKey/6.jpg","7":"bilibiliHotKey/7.jpg","8":"bilibiliHotKey/8.jpg","9":"bilibiliHotKey/9.jpg","10":"bilibiliHotKey/10.jpg","11":"bilibiliHotKey/11.jpg","12":"bilibiliHotKey/12.jpg","13":"bilibiliHotKey/13.jpg","14":"bilibiliHotKey/14.jpg","15":"bilibiliHotKey/15.jpg","16":"bilibiliHotKey/16.jpg","17":"bilibiliHotKey/17.jpg","18":"bilibiliHotKey/18.jpg","19":"bilibiliHotKey/19.jpg","20":"bilibiliHotKey/20.jpg","21":"bilibiliHotKey/21.jpg","22":"bilibiliHotKey/22.jpg","23":"bilibiliHotKey/23.jpg","24":"bilibiliHotKey/24.jpg","25":"bilibiliHotKey/25.jpg","26":"bilibiliHotKey/26.jpg","27":"bilibiliHotKey/27.jpg","28":"bilibiliHotKey/28.jpg","29":"bilibiliHotKey/29.jpg","30":"bilibiliHotKey/30.jpg","31":"bilibiliHotKey/31.jpg","32":"bilibiliHotKey/32.jpg","不出所料":"alu/不出所料.png","不说话":"alu/不说话.png","不高兴":"alu/不高兴.png","中刀":"alu/中刀.png","中指":"alu/中指.png","中枪":"alu/中枪.png","亲亲":"alu/亲亲.png","便便":"alu/便便.png","内伤":"alu/内伤.png","击掌":"alu/击掌.png","口水":"alu/口水.png","吐":"alu/吐.png","吐舌":"alu/吐舌.png","吐血倒地":"alu/吐血倒地.png","呲牙":"alu/呲牙.png","咽气":"alu/咽气.png","哭泣":"alu/哭泣.png","喜极而泣":"alu/喜极而泣.png","喷水":"alu/喷水.png","喷血":"alu/喷血.png","坐等":"alu/坐等.png","害羞":"alu/害羞.png","小眼睛":"alu/小眼睛.png","尴尬":"alu/尴尬.png","得意":"alu/得意.png","惊喜":"alu/惊喜.png","想一想":"alu/想一想.png","愤怒":"alu/愤怒.png","扇耳光":"alu/扇耳光.png","投降":"alu/投降.png","抠鼻":"alu/抠鼻.png","抽烟":"alu/抽烟.png","无奈":"alu/无奈.png","无所谓":"alu/无所谓.png","无语":"alu/无语.png","暗地观察":"alu/暗地观察.png","期待":"alu/期待.png","欢呼":"alu/欢呼.png","汗":"alu/汗.png","深思":"alu/深思.png","狂汗":"alu/狂汗.png","献花":"alu/献花.png","献黄瓜":"alu/献黄瓜.png","皱眉":"alu/皱眉.png","看不见":"alu/看不见.png","看热闹":"alu/看热闹.png","瞅你":"alu/瞅你.png","肿包":"alu/肿包.png","脸红":"alu/脸红.png","蜡烛":"alu/蜡烛.png","装大款":"alu/装大款.png","观察":"alu/观察.png","赞一个":"alu/赞一个.png","邪恶":"alu/邪恶.png","锁眉":"alu/锁眉.png","长草":"alu/长草.png","阴暗":"alu/阴暗.png","高兴":"alu/高兴.png","黑线":"alu/黑线.png","鼓掌":"alu/鼓掌.png","[tv_doge]":"bilibilitv/[tv_doge].png","[tv_亲亲]":"bilibilitv/[tv_亲亲].png","[tv_偷笑]":"bilibilitv/[tv_偷笑].png","[tv_再见]":"bilibilitv/[tv_再见].png","[tv_冷漠]":"bilibilitv/[tv_冷漠].png","[tv_发怒]":"bilibilitv/[tv_发怒].png","[tv_发财]":"bilibilitv/[tv_发财].png","[tv_可爱]":"bilibilitv/[tv_可爱].png","[tv_吐血]":"bilibilitv/[tv_吐血].png","[tv_呆]":"bilibilitv/[tv_呆].png","[tv_呕吐]":"bilibilitv/[tv_呕吐].png","[tv_困]":"bilibilitv/[tv_困].png","[tv_坏笑]":"bilibilitv/[tv_坏笑].png","[tv_大佬]":"bilibilitv/[tv_大佬].png","[tv_大哭]":"bilibilitv/[tv_大哭].png","[tv_委屈]":"bilibilitv/[tv_委屈].png","[tv_害羞]":"bilibilitv/[tv_害羞].png","[tv_尴尬]":"bilibilitv/[tv_尴尬].png","[tv_微笑]":"bilibilitv/[tv_微笑].png","[tv_思考]":"bilibilitv/[tv_思考].png","[tv_惊吓]":"bilibilitv/[tv_惊吓].png","[tv_打脸]":"bilibilitv/[tv_打脸].png","[tv_抓狂]":"bilibilitv/[tv_抓狂].png","[tv_抠鼻]":"bilibilitv/[tv_抠鼻].png","[tv_斜眼笑]":"bilibilitv/[tv_斜眼笑].png","[tv_无奈]":"bilibilitv/[tv_无奈].png","[tv_晕]":"bilibilitv/[tv_晕].png","[tv_流汗]":"bilibilitv/[tv_流汗].png","[tv_流泪]":"bilibilitv/[tv_流泪].png","[tv_流鼻血]":"bilibilitv/[tv_流鼻血].png","[tv_点赞]":"bilibilitv/[tv_点赞].png","[tv_生气]":"bilibilitv/[tv_生气].png","[tv_生病]":"bilibilitv/[tv_生病].png","[tv_疑问]":"bilibilitv/[tv_疑问].png","[tv_白眼]":"bilibilitv/[tv_白眼].png","[tv_皱眉]":"bilibilitv/[tv_皱眉].png","[tv_目瞪口呆]":"bilibilitv/[tv_目瞪口呆].png","[tv_睡着]":"bilibilitv/[tv_睡着].png","[tv_笑哭]":"bilibilitv/[tv_笑哭].png","[tv_腼腆]":"bilibilitv/[tv_腼腆].png","[tv_色]":"bilibilitv/[tv_色].png","[tv_调侃]":"bilibilitv/[tv_调侃].png","[tv_调皮]":"bilibilitv/[tv_调皮].png","[tv_鄙视]":"bilibilitv/[tv_鄙视].png","[tv_闭嘴]":"bilibilitv/[tv_闭嘴].png","[tv_难过]":"bilibilitv/[tv_难过].png","[tv_馋]":"bilibilitv/[tv_馋].png","[tv_鬼脸]":"bilibilitv/[tv_鬼脸].png","[tv_黑人问号]":"bilibilitv/[tv_黑人问号].png","[tv_鼓掌]":"bilibilitv/[tv_鼓掌].png","emotion_001":"dingtalk/emotion_001.png","emotion_002":"dingtalk/emotion_002.png","emotion_003":"dingtalk/emotion_003.png","emotion_004":"dingtalk/emotion_004.png","emotion_005":"dingtalk/emotion_005.png","emotion_006":"dingtalk/emotion_006.png","emotion_007":"dingtalk/emotion_007.png","emotion_008":"dingtalk/emotion_008.png","emotion_009":"dingtalk/emotion_009.png","emotion_010":"dingtalk/emotion_010.png","emotion_011":"dingtalk/emotion_011.png","emotion_012":"dingtalk/emotion_012.png","emotion_013":"dingtalk/emotion_013.png","emotion_014":"dingtalk/emotion_014.png","emotion_015":"dingtalk/emotion_015.png","emotion_016":"dingtalk/emotion_016.png","emotion_017":"dingtalk/emotion_017.png","emotion_018":"dingtalk/emotion_018.png","emotion_019":"dingtalk/emotion_019.png","emotion_020":"dingtalk/emotion_020.png","emotion_021":"dingtalk/emotion_021.png","emotion_022":"dingtalk/emotion_022.png","emotion_023":"dingtalk/emotion_023.png","emotion_024":"dingtalk/emotion_024.png","emotion_025":"dingtalk/emotion_025.png","emotion_026":"dingtalk/emotion_026.png","emotion_027":"dingtalk/emotion_027.png","emotion_028":"dingtalk/emotion_028.png","emotion_029":"dingtalk/emotion_029.png","emotion_030":"dingtalk/emotion_030.png","emotion_031":"dingtalk/emotion_031.png","emotion_032":"dingtalk/emotion_032.png","emotion_033":"dingtalk/emotion_033.png","emotion_034":"dingtalk/emotion_034.png","emotion_035":"dingtalk/emotion_035.png","emotion_036":"dingtalk/emotion_036.png","emotion_037":"dingtalk/emotion_037.png","emotion_038":"dingtalk/emotion_038.png","emotion_039":"dingtalk/emotion_039.png","emotion_040":"dingtalk/emotion_040.png","emotion_041":"dingtalk/emotion_041.png","emotion_042":"dingtalk/emotion_042.png","emotion_043":"dingtalk/emotion_043.png","emotion_044":"dingtalk/emotion_044.png","emotion_045":"dingtalk/emotion_045.png","emotion_046":"dingtalk/emotion_046.png","emotion_047":"dingtalk/emotion_047.png","emotion_048":"dingtalk/emotion_048.png","emotion_049":"dingtalk/emotion_049.png","emotion_050":"dingtalk/emotion_050.png","emotion_051":"dingtalk/emotion_051.png","emotion_052":"dingtalk/emotion_052.png","emotion_053":"dingtalk/emotion_053.png","emotion_054":"dingtalk/emotion_054.png","emotion_055":"dingtalk/emotion_055.png","emotion_056":"dingtalk/emotion_056.png","emotion_057":"dingtalk/emotion_057.png","emotion_058":"dingtalk/emotion_058.png","emotion_059":"dingtalk/emotion_059.png","emotion_060":"dingtalk/emotion_060.png","emotion_061":"dingtalk/emotion_061.png","emotion_063":"dingtalk/emotion_063.png","emotion_064":"dingtalk/emotion_064.png","emotion_066":"dingtalk/emotion_066.png","emotion_067":"dingtalk/emotion_067.png","emotion_068":"dingtalk/emotion_068.png","emotion_069":"dingtalk/emotion_069.png","emotion_070":"dingtalk/emotion_070.png","emotion_071":"dingtalk/emotion_071.png","emotion_072":"dingtalk/emotion_072.png","emotion_073":"dingtalk/emotion_073.png","emotion_074":"dingtalk/emotion_074.png","emotion_075":"dingtalk/emotion_075.png","emotion_076":"dingtalk/emotion_076.png","emotion_077":"dingtalk/emotion_077.png","emotion_078":"dingtalk/emotion_078.png","emotion_079":"dingtalk/emotion_079.png","emotion_080":"dingtalk/emotion_080.png","emotion_081":"dingtalk/emotion_081.png","emotion_082":"dingtalk/emotion_082.png","emotion_083":"dingtalk/emotion_083.png","emotion_084":"dingtalk/emotion_084.png","emotion_085":"dingtalk/emotion_085.png","emotion_086":"dingtalk/emotion_086.png","emotion_087":"dingtalk/emotion_087.png","emotion_088":"dingtalk/emotion_088.png","emotion_089":"dingtalk/emotion_089.png","emotion_090":"dingtalk/emotion_090.png","emotion_091":"dingtalk/emotion_091.png","emotion_092":"dingtalk/emotion_092.png","emotion_093":"dingtalk/emotion_093.png","emotion_094":"dingtalk/emotion_094.png","emotion_095":"dingtalk/emotion_095.png","emotion_096":"dingtalk/emotion_096.png","emotion_097":"dingtalk/emotion_097.png","emotion_098":"dingtalk/emotion_098.png","emotion_099":"dingtalk/emotion_099.png","emotion_100":"dingtalk/emotion_100.png","emotion_101":"dingtalk/emotion_101.png","emotion_102":"dingtalk/emotion_102.png","emotion_103":"dingtalk/emotion_103.png","emotion_104":"dingtalk/emotion_104.png","emotion_105":"dingtalk/emotion_105.png","emotion_106":"dingtalk/emotion_106.png","emotion_107":"dingtalk/emotion_107.png","emotion_108":"dingtalk/emotion_108.png","emotion_109":"dingtalk/emotion_109.png","emotion_110":"dingtalk/emotion_110.png","emotion_111":"dingtalk/emotion_111.png","emotion_112":"dingtalk/emotion_112.png","emotion_113":"dingtalk/emotion_113.png","emotion_114":"dingtalk/emotion_114.png","emotion_115":"dingtalk/emotion_115.png","emotion_116":"dingtalk/emotion_116.png","emotion_117":"dingtalk/emotion_117.png","emotion_119":"dingtalk/emotion_119.png","emotion_120":"dingtalk/emotion_120.png","emotion_121":"dingtalk/emotion_121.png","emotion_122":"dingtalk/emotion_122.png","emotion_123":"dingtalk/emotion_123.png","emotion_124":"dingtalk/emotion_124.png","emotion_125":"dingtalk/emotion_125.png","emotion_126":"dingtalk/emotion_126.png","emotion_127":"dingtalk/emotion_127.png","emotion_128":"dingtalk/emotion_128.png","emotion_130":"dingtalk/emotion_130.png","emotion_131":"dingtalk/emotion_131.png","emotion_132":"dingtalk/emotion_132.png","emotion_133":"dingtalk/emotion_133.png","emotion_134":"dingtalk/emotion_134.png","emotion_135":"dingtalk/emotion_135.png","emotion_136":"dingtalk/emotion_136.png","emotion_137":"dingtalk/emotion_137.png","emotion_138":"dingtalk/emotion_138.png","emotion_139":"dingtalk/emotion_139.png","emotion_140":"dingtalk/emotion_140.png","emotion_141":"dingtalk/emotion_141.png","emotion_142":"dingtalk/emotion_142.png","emotion_143":"dingtalk/emotion_143.png","emotion_144":"dingtalk/emotion_144.png","emotion_145":"dingtalk/emotion_145.png","emotion_146":"dingtalk/emotion_146.png","emotion_148":"dingtalk/emotion_148.png","emotion_149":"dingtalk/emotion_149.png","emotion_150":"dingtalk/emotion_150.png","emotion_151":"dingtalk/emotion_151.png","emotion_152":"dingtalk/emotion_152.png","emotion_153":"dingtalk/emotion_153.png","emotion_154":"dingtalk/emotion_154.png","emotion_155":"dingtalk/emotion_155.png","emotion_156":"dingtalk/emotion_156.png","emotion_157":"dingtalk/emotion_157.png","emotion_158":"dingtalk/emotion_158.png","emotion_159":"dingtalk/emotion_159.png","emotion_160":"dingtalk/emotion_160.png","emotion_161":"dingtalk/emotion_161.png","emotion_162":"dingtalk/emotion_162.png","emotion_163":"dingtalk/emotion_163.png","emotion_164":"dingtalk/emotion_164.png","emotion_165":"dingtalk/emotion_165.png","emotion_166":"dingtalk/emotion_166.png","emotion_167":"dingtalk/emotion_167.png","emotion_168":"dingtalk/emotion_168.png","emotion_169":"dingtalk/emotion_169.png","emotion_170":"dingtalk/emotion_170.png","emotion_171":"dingtalk/emotion_171.png","emotion_172":"dingtalk/emotion_172.png","emotion_173":"dingtalk/emotion_173.png","emotion_174":"dingtalk/emotion_174.png","emotion_175":"dingtalk/emotion_175.png","emotion_176":"dingtalk/emotion_176.png","emotion_177":"dingtalk/emotion_177.png","emotion_178":"dingtalk/emotion_178.png","emotion_179":"dingtalk/emotion_179.png","emotion_180":"dingtalk/emotion_180.png","emotion_181":"dingtalk/emotion_181.png","emotion_182":"dingtalk/emotion_182.png","emotion_184":"dingtalk/emotion_184.png","emotion_185":"dingtalk/emotion_185.png","emotion_186":"dingtalk/emotion_186.png","emotion_187":"dingtalk/emotion_187.png","emotion_188":"dingtalk/emotion_188.png","emotion_189":"dingtalk/emotion_189.png","emotion_191":"dingtalk/emotion_191.png","emotion_192":"dingtalk/emotion_192.png","aini":"QQ/aini.gif","aixin":"QQ/aixin.gif","aoman":"QQ/aoman.gif","baiyan":"QQ/baiyan.gif","bangbangtang":"QQ/bangbangtang.gif","baojin":"QQ/baojin.gif","baoquan":"QQ/baoquan.gif","bishi":"QQ/bishi.gif","bizui":"QQ/bizui.gif","cahan":"QQ/cahan.gif","caidao":"QQ/caidao.gif","chi":"QQ/chi.gif","ciya":"QQ/ciya.gif","dabing":"QQ/dabing.gif","daku":"QQ/daku.gif","dan":"QQ/dan.gif","deyi":"QQ/deyi.gif","doge":"QQ/doge.gif","fadai":"QQ/fadai.gif","fanu":"QQ/fanu.gif","fendou":"QQ/fendou.gif","ganga":"QQ/ganga.gif","gouyin":"QQ/gouyin.gif","guzhang":"QQ/guzhang.gif","haixiu":"QQ/haixiu.gif","hanxiao":"QQ/hanxiao.gif","haobang":"QQ/haobang.gif","haqian":"QQ/haqian.gif","hecai":"QQ/hecai.gif","hexie":"QQ/hexie.gif","huaixiao":"QQ/huaixiao.gif","jie":"QQ/jie.gif","jingkong":"QQ/jingkong.gif","jingxi":"QQ/jingxi.gif","jingya":"QQ/jingya.gif","juhua":"QQ/juhua.gif","keai":"QQ/keai.gif","kelian":"QQ/kelian.gif","koubi":"QQ/koubi.gif","ku":"QQ/ku.gif","kuaikule":"QQ/kuaikule.gif","kulou":"QQ/kulou.gif","kun":"QQ/kun.gif","lanqiu":"QQ/lanqiu.gif","leiben":"QQ/leiben.gif","lenghan":"QQ/lenghan.gif","liuhan":"QQ/liuhan.gif","liulei":"QQ/liulei.gif","nanguo":"QQ/nanguo.gif","OK":"QQ/OK.gif","penxue":"QQ/penxue.gif","piezui":"QQ/piezui.gif","pijiu":"QQ/pijiu.gif","qiang":"QQ/qiang.gif","qiaoda":"QQ/qiaoda.gif","qinqin":"QQ/qinqin.gif","qiudale":"QQ/qiudale.gif","quantou":"QQ/quantou.gif","saorao":"QQ/saorao.gif","se":"QQ/se.gif","shengli":"QQ/shengli.gif","shouqiang":"QQ/shouqiang.gif","shuai":"QQ/shuai.gif","shui":"QQ/shui.gif","tiaopi":"QQ/tiaopi.gif","touxiao":"QQ/touxiao.gif","tu":"QQ/tu.gif","tuosai":"QQ/tuosai.gif","weiqu":"QQ/weiqu.gif","weixiao":"QQ/weixiao.gif","woshou":"QQ/woshou.gif","wozuimei":"QQ/wozuimei.gif","wunai":"QQ/wunai.gif","xia":"QQ/xia.gif","xiaojiujie":"QQ/xiaojiujie.gif","xiaoku":"QQ/xiaoku.gif","xiaoyanger":"QQ/xiaoyanger.gif","xieyanxiao":"QQ/xieyanxiao.gif","xigua":"QQ/xigua.gif","xu":"QQ/xu.gif","yangtuo":"QQ/yangtuo.gif","yinxian":"QQ/yinxian.gif","yiwen":"QQ/yiwen.gif","youhengheng":"QQ/youhengheng.gif","youling":"QQ/youling.gif","yun":"QQ/yun.gif","zaijian":"QQ/zaijian.gif","zhayanjian":"QQ/zhayanjian.gif","zhemo":"QQ/zhemo.gif","zhouma":"QQ/zhouma.gif","zhuakuang":"QQ/zhuakuang.gif","zuohengheng":"QQ/zuohengheng.gif","d_aoteman":"weibo/d_aoteman.png","d_baibai":"weibo/d_baibai.png","d_baobao":"weibo/d_baobao.png","d_beishang":"weibo/d_beishang.png","d_bingbujiandan":"weibo/d_bingbujiandan.png","d_bishi":"weibo/d_bishi.png","d_bizui":"weibo/d_bizui.png","d_chanzui":"weibo/d_chanzui.png","d_chigua":"weibo/d_chigua.png","d_chijing":"weibo/d_chijing.png","d_dahaqi":"weibo/d_dahaqi.png","d_dalian":"weibo/d_dalian.png","d_ding":"weibo/d_ding.png","d_doge":"weibo/d_doge.png","d_erha":"weibo/d_erha.png","d_feijie":"weibo/d_feijie.png","d_feizao":"weibo/d_feizao.png","d_ganmao":"weibo/d_ganmao.png","d_guile":"weibo/d_guile.png","d_guzhang":"weibo/d_guzhang.png","d_haha":"weibo/d_haha.png","d_haixiu":"weibo/d_haixiu.png","d_han":"weibo/d_han.png","d_hehe":"weibo/d_hehe.png","d_heiheihei":"weibo/d_heiheihei.png","d_heixian":"weibo/d_heixian.png","d_heng":"weibo/d_heng.png","d_huaixiao":"weibo/d_huaixiao.png","d_huaxin":"weibo/d_huaxin.png","d_jiyan":"weibo/d_jiyan.png","d_keai":"weibo/d_keai.png","d_kelian":"weibo/d_kelian.png","d_ku":"weibo/d_ku.png","d_kulou":"weibo/d_kulou.png","d_kun":"weibo/d_kun.png","d_landelini":"weibo/d_landelini.png","d_lang":"weibo/d_lang.png","d_lei":"weibo/d_lei.png","d_miao":"weibo/d_miao.png","d_nanhaier":"weibo/d_nanhaier.png","d_nu":"weibo/d_nu.png","d_numa":"weibo/d_numa.png","d_nvhaier":"weibo/d_nvhaier.png","d_qian":"weibo/d_qian.png","d_qinqin":"weibo/d_qinqin.png","d_shayan":"weibo/d_shayan.png","d_shengbing":"weibo/d_shengbing.png","d_shenshou":"weibo/d_shenshou.png","d_shiwang":"weibo/d_shiwang.png","d_shuai":"weibo/d_shuai.png","d_shuijiao":"weibo/d_shuijiao.png","d_sikao":"weibo/d_sikao.png","d_taikaixin":"weibo/d_taikaixin.png","d_tanshou":"weibo/d_tanshou.png","d_tian":"weibo/d_tian.png","d_touxiao":"weibo/d_touxiao.png","d_tu":"weibo/d_tu.png","d_tuzi":"weibo/d_tuzi.png","d_wabishi":"weibo/d_wabishi.png","d_weiqu":"weibo/d_weiqu.png","d_wu":"weibo/d_wu.png","d_xiaoku":"weibo/d_xiaoku.png","d_xingxingyan":"weibo/d_xingxingyan.png","d_xiongmao":"weibo/d_xiongmao.png","d_xixi":"weibo/d_xixi.png","d_xu":"weibo/d_xu.png","d_yinxian":"weibo/d_yinxian.png","d_yiwen":"weibo/d_yiwen.png","d_youhengheng":"weibo/d_youhengheng.png","d_yun":"weibo/d_yun.png","d_yunbei":"weibo/d_yunbei.png","d_zhuakuang":"weibo/d_zhuakuang.png","d_zhutou":"weibo/d_zhutou.png","d_zuiyou":"weibo/d_zuiyou.png","emoji_0x1f31f":"weibo/emoji_0x1f31f.png","emoji_0x1f349":"weibo/emoji_0x1f349.png","emoji_0x1f357":"weibo/emoji_0x1f357.png","emoji_0x1f384":"weibo/emoji_0x1f384.png","emoji_0x1f44f":"weibo/emoji_0x1f44f.png","emoji_0x1f47b":"weibo/emoji_0x1f47b.png","emoji_0x1f47f":"weibo/emoji_0x1f47f.png","emoji_0x1f48a":"weibo/emoji_0x1f48a.png","emoji_0x1f4a3":"weibo/emoji_0x1f4a3.png","emoji_0x1f4a9":"weibo/emoji_0x1f4a9.png","emoji_0x1f631":"weibo/emoji_0x1f631.png","emoji_0x1f643":"weibo/emoji_0x1f643.png","emoji_0x1f645":"weibo/emoji_0x1f645.png","emoji_0x1f648":"weibo/emoji_0x1f648.png","emoji_0x1f649":"weibo/emoji_0x1f649.png","emoji_0x1f64a":"weibo/emoji_0x1f64a.png","emoji_0x1f64b":"weibo/emoji_0x1f64b.png","emoji_0x1f64f":"weibo/emoji_0x1f64f.png","emoji_0x1f913":"weibo/emoji_0x1f913.png","emoji_0x1f917":"weibo/emoji_0x1f917.png","emoji_0x26a1":"weibo/emoji_0x26a1.png","h_buyao":"weibo/h_buyao.png","h_good":"weibo/h_good.png","h_haha":"weibo/h_haha.png","h_jiayou":"weibo/h_jiayou.png","h_lai":"weibo/h_lai.png","h_ok":"weibo/h_ok.png","h_quantou":"weibo/h_quantou.png","h_ruo":"weibo/h_ruo.png","h_woshou":"weibo/h_woshou.png","h_ye":"weibo/h_ye.png","h_zan":"weibo/h_zan.png","h_zuoyi":"weibo/h_zuoyi.png"},
      enableQQ: true,
      path: window.location.pathname,
      master: 'b2f3474b26c9372f87af129721d45682,e1552ee12e1548c30208f62a1e553629'.split(','),
      friends: ''.split(','),
      tagMeta: '博主,小伙伴,访客'.split(',')
    }

    if (true) { 
      initData.requiredFields= ('nick,mail'.split(','))
    }
    
    if (false) {
      const otherData = false
      initData = Object.assign(initData, otherData)
    }
    
    const valine = new Valine(initData)
  }

  if (typeof Valine === 'function') initValine() 
  else getScript('https://cdn.jsdelivr.net/gh/Eurkon/CDN/hexo/js/Valine.min.js').then(initValine)
}

if ('Valine' === 'Valine' || !true) {
  if (true) btf.loadComment(document.getElementById('vcomment'),loadValine)
  else setTimeout(loadValine, 0)
} else {
  function loadOtherComment () {
    loadValine()
  }
}</script><script>(()=>{
  const $countDom = document.getElementById('twikoo-count')
  const init = () => {
    let initData = {
      el: '#twikoo-wrap',
      envId: 'twikoo-8g3bxox957905a8c',
      region: ''
    }

    if (false) {
      const otherData = false
      initData = Object.assign(initData, otherData)
    }
    
    twikoo.init(initData)
  }

  const getCount = () => {
    twikoo.getCommentsCount({
      envId: 'twikoo-8g3bxox957905a8c',
      region: '',
      urls: [window.location.pathname],
      includeReply: false
    }).then(function (res) {
      $countDom.innerText = res[0].count
    }).catch(function (err) {
      console.error(err);
    });
  }

  const loadTwikoo = (bool = false) => {
    if (typeof twikoo === 'object') {
      init()
      bool && $countDom && setTimeout(getCount,0)
    } else {
      getScript('https://cdn.jsdelivr.net/npm/twikoo/dist/twikoo.all.min.js').then(()=> {
        init()
        bool && $countDom && setTimeout(getCount,0)
      })
    }
  }

  if ('Valine' === 'Twikoo' || !true) {
    if (true) btf.loadComment(document.getElementById('twikoo-wrap'), loadTwikoo)
    else loadTwikoo(true)
  } else {
    window.loadOtherComment = () => {
      loadTwikoo()
    }
  }
})()</script></div><script src="https://cdn.jsdelivr.net/npm/blueimp-md5@2.17.0/js/md5.min.js"></script><script>window.addEventListener('load', () => {
  const changeContent = (content) => {
    if (content === '') return content

    content = content.replace(/<img.*?src="(.*?)"?[^\>]+>/ig, '[图片]') // replace image link
    content = content.replace(/<a[^>]+?href=["']?([^"']+)["']?[^>]*>([^<]+)<\/a>/gi, '[链接]') // replace url
    content = content.replace(/<pre><code>.*?<\/pre>/gi, '[代码]') // replace code
    content = content.replace(/<[^>]+>/g,"") // remove html tag

    if (content.length > 150) {
      content = content.substring(0,150) + '...'
    }
    return content
  }

  const getIcon = (icon, mail) => {
    if (icon) return icon
    let defaultIcon = '?d=monsterid'
    let iconUrl = `https://gravatar.loli.net/avatar/${md5(mail.toLowerCase()) + defaultIcon}`
    return iconUrl
  }

  const generateHtml = array => {
    let result = ''

    if (array.length) {
      for (let i = 0; i < array.length; i++) {
        result += '<div class=\'aside-list-item\'>'

        if (true) {
          const name = 'src'
          result += `<a href='${array[i].url}' class='thumbnail'><img ${name}='${array[i].avatar}' alt='${array[i].nick}'></a>`
        }

        result += `<div class='content'>
        <a class='comment' href='${array[i].url}'>${array[i].content}</a>
        <div class='name'><span>${array[i].nick} / </span><time datetime="${array[i].date}">${btf.diffDate(array[i].date, true)}</time></div>
        </div></div>`
      }
    } else {
      result += '没有评论'
    }

    let $dom = document.querySelector('#card-newest-comments .aside-list')
    $dom.innerHTML= result
    window.lazyLoadInstance && window.lazyLoadInstance.update()
    window.pjax && window.pjax.refresh($dom)
  }

  const getComment = () => {
    const serverURL = 'https://mdk10ra2.api.lncldglobal.com'

    var settings = {
      "method": "GET",
      "headers": {
        "X-LC-Id": 'mdK10Ra28S4hiWnWAgbmFnt2-MdYXbMMI',
        "X-LC-Key": 'rCmzIVxuQwj4k6b5R7wP42VR',
        "Content-Type": "application/json"
      },
    }

    fetch(`${serverURL}/1.1/classes/Comment?limit=6&order=-createdAt`,settings)
      .then(response => response.json())
      .then(data => {
        const valineArray = data.results.map(function (e) {
          return {
            'avatar': getIcon(e.QQAvatar, e.mail),
            'content': changeContent(e.comment),
            'nick': e.nick,
            'url': e.url + '#' + e.objectId,
            'date': e.updatedAt,
          }
        })
        saveToLocal.set('valine-newest-comments', JSON.stringify(valineArray), 10/(60*24))
        generateHtml(valineArray)
      }).catch(e => {
        const $dom = document.querySelector('#card-newest-comments .aside-list')
        $dom.innerHTML= "无法获取评论，请确认相关配置是否正确"
      }) 
  }

  const newestCommentInit = () => {
    if (document.querySelector('#card-newest-comments .aside-list')) {
      const data = saveToLocal.get('valine-newest-comments')
      if (data) {
        generateHtml(JSON.parse(data))
      } else {
        getComment()
      }
    }
  }

  newestCommentInit()
  document.addEventListener('pjax:complete', newestCommentInit)
})</script><script data-pjax src="/js/custom.js"></script><script data-pjax src="/js/history.js"></script><script data-pjax src="/js/historyroll.js"></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/gh/metowolf/MetingJS@1.2/dist/Meting.min.js"></script><script src="https://cdn.jsdelivr.net/npm/pjax/pjax.min.js"></script><script>let pjaxSelectors = [
  'title',
  '#config-diff',
  '#body-wrap',
  '#rightside-config-hide',
  '#rightside-config-show',
  '.js-pjax'
]

if (false) {
  pjaxSelectors.unshift('meta[property="og:image"]', 'meta[property="og:title"]', 'meta[property="og:url"]')
}

var pjax = new Pjax({
  elements: 'a:not([target="_blank"]):not([href="/about/"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof chatBtnFn === 'function' && chatBtnFn()
  typeof panguInit === 'function' && panguInit()

  if (typeof gtag === 'function') {
    gtag('config', '', {'page_path': window.location.pathname});
  }

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // Analytics
  if (false) {
    MtaH5.pgv()
  }

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()

  typeof preloader === 'object' && preloader.endLoading()
})


document.addEventListener('pjax:send', function () {
  typeof preloader === 'object' && preloader.initLoading()
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')

})

document.addEventListener('pjax:error', (e) => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>var gitcalendar = new Vue({
  el: '#gitcalendar',
  data: {
    simplemode: false,
    user: 'Eurkon',
    fixed: 'fixed',
    px: 'px',
    x: '',
    y: '',
    span1: '',
    span2: '',
    month: ['一月', '二月', '三月', '四月', '五月', '六月', '七月', '八月', '九月', '十月', '十一月', '十二月'],
    monthchange: [],
    oneyearbeforeday: '',
    thisday: '',
    amonthago: '',
    aweekago: '',
    weekdatacore: 0,
    datacore: 0,
    total: 0,
    datadate: '',
    data: [],
    positionplusdata: [],
    firstweek: [],
    lastweek: [],
    beforeweek: [],
    thisweekdatacore: 0,
    mounthbeforeday: 0,
    mounthfirstindex: 0,
    crispedges: 'crispedges',
    thisdayindex: 0,
    amonthagoindex: 0,
    amonthagoweek: [],
    firstdate: [],
    first2date: [],
    montharrbefore: [],
    monthindex: 0,
    color: ['#ebedf0', '#fdcdec', '#fc9bd9', '#fa6ac5', '#f838b2', '#f5089f', '#c4067e', '#92055e', '#540336', '#48022f', '#30021f']
  },
  methods: {
    selectStyle(data, event) {
      document.querySelector('.angle-wrapper').style.display = 'block'
      this.span1 = data.date;
      this.span2 = data.count;
      this.x = event.clientX - 100;
      this.y = event.clientY - 60
    },
    outStyle() {
      document.querySelector('.angle-wrapper').style.display = 'none'
    },
    thiscolor(x) {
      if (x === 0) {
        let i = parseInt(x / 2);
        return this.color[0]
      } else if (x < 2) {
        return this.color[1]
      } else if (x < 20) {
        let i = parseInt(x / 2);
        return this.color[i]
      } else {
        return this.color[9]
      }
    },
  }
});
var apiurl = 'https://github-calendar-python-api.vercel.app/api?' ? 'https://github-calendar-python-api.vercel.app/api?' : 'https://githubapi.ryanchristian.dev/user/'
var githubapiurl = apiurl + gitcalendar.user;
//canvas绘图
function responsiveChart() {
  let c = document.getElementById("gitcanvas");
  if (c) {
    let cmessage = document.getElementById("gitmessage");
    let ctx = c.getContext("2d");
    c.width = document.getElementById("gitcalendarcanvasbox").offsetWidth;
    let linemaxwitdh = 0.96 * c.width / gitcalendar.data.length;
    c.height = 9 * linemaxwitdh;
    let lineminwitdh = 0.8 * linemaxwitdh;
    let setposition = {
      x: 0.02 * c.width,
      y: 0.025 * c.width
    };
    for (let week in gitcalendar.data) {
      weekdata = gitcalendar.data[week];
      for (let day in weekdata) {
        let dataitem = {
          date: "",
          count: "",
          x: 0,
          y: 0
        };
        gitcalendar.positionplusdata.push(dataitem);
        ctx.fillStyle = gitcalendar.thiscolor(weekdata[day].count);
        setposition.y = Math.round(setposition.y * 100) / 100;
        dataitem.date = weekdata[day].date;
        dataitem.count = weekdata[day].count;
        dataitem.x = setposition.x;
        dataitem.y = setposition.y;
        ctx.fillRect(setposition.x, setposition.y, lineminwitdh, lineminwitdh);
        setposition.y = setposition.y + linemaxwitdh
      };
      setposition.y = 0.025 * c.width;
      setposition.x = setposition.x + linemaxwitdh
    };
    ctx.font = "600  Arial";
    ctx.fillStyle = '#aaa';
    ctx.fillText("日", 0, 1.9 * linemaxwitdh);
    ctx.fillText("二", 0, 3.9 * linemaxwitdh);
    ctx.fillText("四", 0, 5.9 * linemaxwitdh);
    ctx.fillText("六", 0, 7.9 * linemaxwitdh);
    let monthindexlist = c.width / 24;
    for (let index in gitcalendar.monthchange) {
      ctx.fillText(gitcalendar.monthchange[index], monthindexlist, 0.7 * linemaxwitdh);
      monthindexlist = monthindexlist + c.width / 12
    };
    cmessage.onmousemove = function(event) {
      document.querySelector('.angle-wrapper').style.display = 'none'
    };
    c.onmousemove = function(event) {
      document.querySelector('.angle-wrapper').style.display = 'none'
      getMousePos(c, event);
    };

    function getMousePos(canvas, event) {
      var rect = canvas.getBoundingClientRect();
      var x = event.clientX - rect.left * (canvas.width / rect.width);
      var y = event.clientY - rect.top * (canvas.height / rect.height);
      //console.log("x:"+x+",y:"+y);
      for (let item of gitcalendar.positionplusdata) {
        let lenthx = x - item.x;
        let lenthy = y - item.y;
        //console.log(lenthx,lenthy);
        if (0 < lenthx && lenthx < lineminwitdh) {
          if (0 < lenthy && lenthy < lineminwitdh) {
            //console.log(item.date,item.count)
            document.querySelector('.angle-wrapper').style.display = 'block'
            gitcalendar.span1 = item.date;
            gitcalendar.span2 = item.count;
            gitcalendar.x = event.clientX - 100;
            gitcalendar.y = event.clientY - 60
          }
        }
        //if(0< x - item.x <lineminwitdh&&0< y - item.y <lineminwitdh){
        //console.log(item.count,item.date);
        //}
      }
    }
  }
}
//数据统计算法
function addlastmonth() {
  if (gitcalendar.thisdayindex === 0) {
    thisweekcore(52);
    thisweekcore(51);
    thisweekcore(50);
    thisweekcore(49);
    thisweekcore(48);
    gitcalendar.thisweekdatacore += gitcalendar.firstdate[6].count;
    gitcalendar.amonthago = gitcalendar.firstdate[6].date
  } else {
    thisweekcore(52);
    thisweekcore(51);
    thisweekcore(50);
    thisweekcore(49);
    thisweek2core();
    gitcalendar.amonthago = gitcalendar.first2date[gitcalendar.thisdayindex - 1].date
  }
};

function thisweek2core() {
  for (let i = gitcalendar.thisdayindex - 1; i < gitcalendar.first2date.length; i++) {
    gitcalendar.thisweekdatacore += gitcalendar.first2date[i].count
  }
};

function thisweekcore(index) {
  for (let item of gitcalendar.data[index]) {
    gitcalendar.thisweekdatacore += item.count
  }
};

function addlastweek() {
  for (let item of gitcalendar.lastweek) {
    gitcalendar.weekdatacore += item.count
  }
};

function addbeforeweek() {
  for (let i = gitcalendar.thisdayindex; i < gitcalendar.beforeweek.length; i++) {
    gitcalendar.weekdatacore += gitcalendar.beforeweek[i].count
  }
};

function addweek(data) {
  if (gitcalendar.thisdayindex === 6) {
    gitcalendar.aweekago = gitcalendar.lastweek[0].date;
    addlastweek()
  } else {
    lastweek = data.contributions[51];
    gitcalendar.aweekago = lastweek[gitcalendar.thisdayindex + 1].date;
    addlastweek();
    addbeforeweek()
  }
}

fetch(githubapiurl)
  .then(data => data.json())
  .then(data => {
    gitcalendar.data = data.contributions;
    gitcalendar.total = data.total;
    gitcalendar.first2date = gitcalendar.data[48];
    gitcalendar.firstdate = gitcalendar.data[47];
    gitcalendar.firstweek = data.contributions[0];
    gitcalendar.lastweek = data.contributions[52];
    gitcalendar.beforeweek = data.contributions[51];
    gitcalendar.thisdayindex = gitcalendar.lastweek.length - 1;
    gitcalendar.thisday = gitcalendar.lastweek[gitcalendar.thisdayindex].date;
    gitcalendar.oneyearbeforeday = gitcalendar.firstweek[0].date;
    gitcalendar.monthindex = gitcalendar.thisday.substring(5, 7) * 1;
    gitcalendar.montharrbefore = gitcalendar.month.splice(gitcalendar.monthindex, 12 - gitcalendar.monthindex);
    gitcalendar.monthchange = gitcalendar.montharrbefore.concat(gitcalendar.month);
    addweek(data);
    addlastmonth();
    responsiveChart();
  })
  .catch(function(error) {
    console.log(error);
  });

//手机版更换为svg绘制
//- if (document.getElementById("gitcalendarcanvasbox").offsetWidth < 500) {
//-   gitcalendar.simplemode = false
//- }

//当改变窗口大小时重新绘制canvas
window.onresize = function() {
  if (gitcalendar.simplemode) responsiveChart()
}

//解决滚动滑轮时出现的标签显示
window.onscroll = function() {
  if (document.querySelector('.angle-wrapper')) {
    document.querySelector('.angle-wrapper').style.display = 'none'
  }
};</script></div></body></html>